<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Освещение, тени и фон &mdash; Руководство пользователя: Blend4Web v15.04</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '15.04',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="Об этих документах" href="about.html" />
    <link rel="top" title="Руководство пользователя: Blend4Web v15.04" href="index.html" />
    <link rel="next" title="Постпроцессинговые эффекты" href="postprocessing_effects.html" />
    <link rel="prev" title="Нодовые материалы" href="node_materials.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="index.html">
            <img class="logo" src="_static/b4w_logo.png" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="index.html">Руководство пользователя: Blend4Web v15.04</a></div>
        <div class="rel">
          <a href="node_materials.html" title="Нодовые материалы"
             accesskey="P">назад</a> |
          <a href="postprocessing_effects.html" title="Постпроцессинговые эффекты"
             accesskey="N">вперёд</a> |
          <a href="genindex.html" title="Алфавитный указатель"
             accesskey="I">указатель</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="lighting"></span><div class="section" id="index-0">
<span id="id1"></span><h1>Освещение, тени и фон<a class="headerlink" href="#index-0" title="Ссылка на этот заголовок">¶</a></h1>
<div class="section" id="index-1">
<span id="id2"></span><h2>Типы затенения<a class="headerlink" href="#index-1" title="Ссылка на этот заголовок">¶</a></h2>
<p>Результат расчета освещения (затенения) зависит от направления векторов нормалей. Поддерживаются стандартные типы затенения, использующиеся в Blender, <tt class="docutils literal"><span class="pre">Shading:</span> <span class="pre">Flat</span></tt> (используются нормали граней) и <tt class="docutils literal"><span class="pre">Shading:</span> <span class="pre">Smooth</span></tt> (используются интерполированные нормали вершин), а также их комбинации.</p>
<a class="reference internal image-reference" href="_images/flat_smooth_shading.png"><img alt="_images/flat_smooth_shading.png" class="align-center" src="_images/flat_smooth_shading.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Если желаемый результат недостижим стандартными средствами, можно воспользоваться <a class="reference internal" href="#normals-editor"><em>редактором нормалей</em></a>.</p>
<p>Результат применения различных типов затенения и использования редактора нормалей:</p>
<a class="reference internal image-reference" href="_images/different_shadings_comparison.jpg"><img alt="_images/different_shadings_comparison.jpg" class="align-center" src="_images/different_shadings_comparison.jpg" style="width: 100%;" /></a>
<ol class="arabic simple">
<li>Flat Shading</li>
<li>Smooth Shading</li>
<li>Smooth Shading + фаска</li>
<li>Smooth Shading + фаска + редактирование нормалей</li>
</ol>
<span class="target" id="normals-editor"></span></div>
<div class="section" id="index-2">
<span id="id3"></span><h2>Редактор нормалей<a class="headerlink" href="#index-2" title="Ссылка на этот заголовок">¶</a></h2>
<p>С помощью редактора нормалей можно достичь результат, схожий в результатом применения <a class="reference internal" href="textures.html#normal-map"><em>карт нормалей</em></a>. При этом метод редактирования нормалей является более предпочтительным с точки зрения потребления вычислительных ресурсов и видео-памяти.</p>
<p>Интерфейс редактора нормалей располагается на панели инструментов <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">B4W</span> <span class="pre">Vertex</span> <span class="pre">Normals</span> <span class="pre">Editor</span></tt>. Перед началом работы редактора для объекта необходимо включить режим затенения <tt class="docutils literal"><span class="pre">Shading:</span> <span class="pre">Smooth</span></tt>.</p>
<p>Пример работы редактора нормалей:</p>
<a class="reference internal image-reference" href="_images/functional_example.gif"><img alt="_images/functional_example.gif" class="align-center" src="_images/functional_example.gif" style="width: 100%;" /></a>
<ol class="arabic simple">
<li>Демонстрация бегунка Scale и кнопки Show/Hide</li>
<li>Демонстрация функции Face</li>
<li>Демонстрация функции Foliage</li>
<li>Демонстрация функции введения параметров вектора вручную (XYZ)</li>
</ol>
<p>Изменять нормали возможно только для выделенных вершин. Векторы выделенных вершин будут подкрашены ярко-голубым цветом, невыделенных - тусклым синим. Чтобы их выделить, следует перейти в режим редактирования, выделить нужные вершины и вернуться в объектный режим.</p>
<p>После того, как вектор отредактирован, его направление необходимо сохранить, т.к. при переходе в режим редактирования и обратно нормали возвращаются в стандартное положение. Вектор можно задать несколькими способами: вручную, копированием с существующего объекта с отредактированными нормалями и используя несколько имеющихся опций.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Если вы отредактировали группу нормалей и сохранили их, после выделения следующей группы необходимо нажать <tt class="docutils literal"><span class="pre">Reload</span> <span class="pre">Normals</span></tt>, чтобы уже отредактированные нормали вернулись в нужное положение, а потом уже переходить к следующей группе. В противном случае при повторном нажатии кнопки <tt class="docutils literal"><span class="pre">Save</span></tt> вы потеряете результаты предыдущего редактирования.</p>
</div>
<dl class="docutils">
<dt><em>Reload normals</em></dt>
<dd>Восстанавливает нормали в последнее сохраненное инструментом положение.</dd>
<dt><em>Clean Up</em></dt>
<dd>Отменяет все произведенные инструментом действия, &#8220;сбрасывая&#8221; нормали в первоначальное состояние.</dd>
<dt><em>Save</em> и <em>Autosave</em></dt>
<dd>Сохранение результатов редактирования нормалей. При активации <tt class="docutils literal"><span class="pre">Autosave</span></tt> результат каждого изменения сохраняется автоматически.</dd>
<dt><em>Size</em></dt>
<dd>Длина отрезка, визуализирующего направление нормали.</dd>
<dt><em>Show/Hide</em></dt>
<dd>Показать/скрыть нормали.</dd>
<dt><em>Inv Sel</em></dt>
<dd>Invert selection. Инвертированное выделение. Аналог CTRL+I в режиме редактирования.</dd>
<dt><em>Cycle Sel</em></dt>
<dd>Cycle selection. Циклическое выделение. Позволяет переходить к следующей по номеру вершине. Кнопка может быть полезной при повершинном редактировании.</dd>
<dt><em>Copy</em> и <em>Paste</em></dt>
<dd>Скопировать направление вектора и назначить его другой вершине. Работает только с одной вершиной за операцию.</dd>
<dt><em>Шкала XYZ и сфера направления</em></dt>
<dd>Инструменты для изменения направления векторов вручную.</dd>
<dt><em>Tree</em>, <em>Foliage</em> и <em>Face</em></dt>
<dd>Кнопка <tt class="docutils literal"><span class="pre">Tree</span></tt> задает всем выделенным нормалям направление от 3D-курсора, <tt class="docutils literal"><span class="pre">Foliage</span></tt> направляет нормали строго вверх (чаще всего используется для настройки частиц <a class="reference internal" href="particles_instancing.html#particles-grass"><em>травяного покрова</em></a> и <a class="reference internal" href="particles_instancing.html#particles-leaves"><em>листвы деревьев</em></a>), <tt class="docutils literal"><span class="pre">Face</span></tt> присваивает векторам направление нормали выделенного полигона.</dd>
<dt><em>Copy from source mesh</em> и <em>Approximate from source mesh</em></dt>
<dd>Кнопки копируют вектора нормалей с одного объекта на другой, при этом следует последовательно выделить исходный и целевой объекты. Разница между ними заключается в следующем. Первый способ требует точного соответствия этих объектов и копирует направление нормалей идеально точно. Вершины, не совпадающие с оригиналом, не затрагиваются. Второй способ работает с произвольной геометрией и приводит к приближенному результату. На практике второй способ часто бывает удобнее первого и работает с приемлемой точностью.</dd>
</dl>
<p>Пример использования функции <tt class="docutils literal"><span class="pre">Approximate</span> <span class="pre">from</span> <span class="pre">source</span> <span class="pre">mesh</span></tt>:</p>
<a class="reference internal image-reference" href="_images/approximate_example.gif"><img alt="_images/approximate_example.gif" class="align-center" src="_images/approximate_example.gif" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>В общем случае алгоритм редактирования нормалей следующий:</p>
<ol class="arabic simple">
<li>Переход в режим редактирования</li>
<li>Выделение нужных вершин</li>
<li>Переход в объектный режим</li>
<li><em>Reload Normals</em></li>
<li>Редактирование выделенных нормалей</li>
<li><em>Save</em> (если <em>Autosave</em> не активна)</li>
</ol>
<p>Необходимо учитывать, что привязка отредактированных нормалей к вершинам меша осуществляется по их номерам, которые могут измениться при редактировании геометрии меша. Это может привести к необходимости редактирования нормалей заново. Кроме того, результаты редактирования нормалей перекрываются некоторыми модификаторами, т.к. они меняют число или порядок вершин меша, поэтому желательно редактировать нормали после применения модификаторов. Модификатор <tt class="docutils literal"><span class="pre">Armature</span></tt> не влияет на работу инструмента.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Eсли необходимо изменить меш с отредактированными нормалями, и при этом сохранить результаты редактирования, можно поступить следующим образом. Временно скопируйте этот объект, отредактируйте меш оригинала, сбросьте на нем нормали кнопкой <tt class="docutils literal"><span class="pre">Clean</span> <span class="pre">Up</span></tt> и затем с копии объекта перенесите направления нормалей с помощью кнопок <tt class="docutils literal"><span class="pre">Copy</span> <span class="pre">from</span> <span class="pre">source</span> <span class="pre">mesh</span></tt> или <tt class="docutils literal"><span class="pre">Approximate</span> <span class="pre">from</span> <span class="pre">source</span> <span class="pre">mesh</span></tt>. Сохраните результаты копирования или аппроксимации.</p>
</div>
</div>
<div class="section" id="index-3">
<span id="id4"></span><h2>Освещение от источников света<a class="headerlink" href="#index-3" title="Ссылка на этот заголовок">¶</a></h2>
<p>На сцене может быть несколько (но не менее одного) источников света разного типа.</p>
<div class="section" id="id5">
<h3>Типы источников света<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>Поддерживаются источники света следующих типов:</p>
<dl class="docutils">
<dt><em>Point</em></dt>
<dd>Точечный. Свет распространяется из одной точки равномерно во все стороны, с постепенным затуханием.</dd>
<dt><em>Sun</em></dt>
<dd>&#8220;Солнце&#8221;. Свет распространяется из бесконечной плоскости прямолинейно в одном направлении, без затухания.</dd>
<dt><em>Spot</em></dt>
<dd>Прожектор. Свет распространяется из одной точки, с ограничением угла распространения, с постепенным затуханием.</dd>
<dt><em>Hemi</em></dt>
<dd>Полусфера. Свет распространяется из бесконечной полусферы, без затухания.</dd>
</dl>
</div>
<div class="section" id="id6">
<h3>Настройка источников света<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h3>
<p>Производится во вкладке <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">Data</span></tt> при выборе объекта-лампы.</p>
<a class="reference internal image-reference" href="_images/lighting_setup.jpg"><img alt="_images/lighting_setup.jpg" class="align-center" src="_images/lighting_setup.jpg" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="docutils">
<dt><em>Color</em></dt>
<dd>Цветовая характеристика света. Значение по умолчанию (1.0, 1.0, 1.0) (белый).</dd>
<dt><em>Energy</em></dt>
<dd>Интенсивность излучения. Значение по умолчанию 1.0.</dd>
<dt><em>Falloff</em></dt>
<dd>Тип затухания. Значение экспортируется, но в движке всегда используется <tt class="docutils literal"><span class="pre">Inverse</span> <span class="pre">Square</span></tt> (обратный квадратичный). Применяется для источников света типа <tt class="docutils literal"><span class="pre">Point</span></tt> и <tt class="docutils literal"><span class="pre">Spot</span></tt>. Значение по умолчанию <tt class="docutils literal"><span class="pre">Inverse</span> <span class="pre">Square</span></tt>.</dd>
<dt><em>Distance</em></dt>
<dd>Параметр затухания. Применяется для источников света типа <tt class="docutils literal"><span class="pre">Point</span></tt> и <tt class="docutils literal"><span class="pre">Spot</span></tt>. Значение по умолчанию 25.0.</dd>
<dt><em>Specular</em></dt>
<dd>Создание отблеска на объектах. По умолчанию включено.</dd>
<dt><em>Diffuse</em></dt>
<dd>Применение рассеянного освещения к объектам. По умолчанию включено.</dd>
<dt><em>Spot Shape &gt; Size</em></dt>
<dd>Угол конуса в градусах. Применяется для источников света типа <tt class="docutils literal"><span class="pre">Spot</span></tt>. Значение по умолчанию 45º.</dd>
<dt><em>Spot Shape &gt; Blend</em></dt>
<dd>Параметр смягчения края светового пятна. Применяется для источников света типа <tt class="docutils literal"><span class="pre">Spot</span></tt>. Значение по умолчанию 0.15.</dd>
<dt><em>Blend4Web &gt; Do not export</em></dt>
<dd>Не экспортировать. По умолчанию отключено.</dd>
<dt><em>Blend4Web &gt; Generate shadows</em></dt>
<dd>Источник света используется для расчета падающих теней. Применяется в случае наличия нескольких источников света. По умолчанию отключено.</dd>
<dt><em>Blend4Web &gt; Dynamic intesity</em></dt>
<dd>Источник света используется для расчета изменения времени суток. Применяется для источников света типа &#8220;Солнце&#8221;. По умолчанию отключено.</dd>
</dl>
</div>
</div>
<div class="section" id="environment-lighting">
<span id="id7"></span><h2>Освещение от окружающей среды<a class="headerlink" href="#environment-lighting" title="Ссылка на этот заголовок">¶</a></h2>
<p>Движок поддерживает 3 метода симуляции рассеянного освещения от окружающих объектов.</p>
<ol class="arabic simple">
<li>&#8220;Плоское&#8221; освещение белым цветом.</li>
<li>Полусферическая модель освещения, в которой задается цвет горизонта и цвет зенита, в результате чего объекты заливаются градиентом между этими цветами в зависимости от направления нормалей.</li>
<li>Освещение с помощью <a class="reference internal" href="textures.html#environment-map"><em>карты окружения</em></a> - т.н. методика image-based lighting.</li>
</ol>
<div class="section" id="id8">
<h3>Активация<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h3>
<p>Включить опцию <tt class="docutils literal"><span class="pre">Environment</span> <span class="pre">Lighting</span></tt> во вкладке <tt class="docutils literal"><span class="pre">World</span></tt>.</p>
<a class="reference internal image-reference" href="_images/lighting_environment.jpg"><img alt="_images/lighting_environment.jpg" class="align-center" src="_images/lighting_environment.jpg" style="width: 100%;" /></a>
</div>
<div class="section" id="id9">
<h3>Настройка<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h3>
<dl class="docutils">
<dt><em>World &gt; Environment Lighting &gt; Energy</em></dt>
<dd>Интенсивность освещения от окружающей среды. Значение по умолчанию 1.0.</dd>
<dt><em>World &gt; Environment Lighting &gt; Environment Color</em></dt>
<dd>Выбор метода симуляции рассеянного освещения: <tt class="docutils literal"><span class="pre">White</span></tt> - &#8220;плоское&#8221; освещение белым цветом, <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Color</span></tt> - полусферическая модель , <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Texture</span></tt> - освещение с помощью <a class="reference internal" href="textures.html#environment-map"><em>карты окружения</em></a>. Значение по умолчанию <tt class="docutils literal"><span class="pre">White</span></tt>.</dd>
<dt><em>World &gt; Horizon Color</em> и <em>World &gt; Zenith Color</em></dt>
<dd>Если выбрана полусферическая модель рассеянного освещения <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Color</span></tt>, цвет горизонта и цвет зенита задаются цветоподборщиками <tt class="docutils literal"><span class="pre">World</span> <span class="pre">&gt;</span> <span class="pre">Horizon</span> <span class="pre">Color</span></tt> (цвет горизонта) и <tt class="docutils literal"><span class="pre">World</span> <span class="pre">&gt;</span> <span class="pre">Zenith</span> <span class="pre">Color</span></tt> (цвет зенита). При выборе цвета рекомендуется активировать опцию <tt class="docutils literal"><span class="pre">World</span> <span class="pre">&gt;</span> <span class="pre">Blend</span> <span class="pre">Sky</span></tt>.</dd>
</dl>
</div>
<div class="section" id="id10">
<h3>Использование карты окружения<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h3>
<p>Для того, чтобы использовать карту окружения в целях реализации освещения от окружающей среды, необходимо:</p>
<ol class="arabic simple">
<li>Включить опцию <tt class="docutils literal"><span class="pre">Environment</span> <span class="pre">Lighting</span></tt> во вкладке <tt class="docutils literal"><span class="pre">World</span></tt>.</li>
<li>Выбрать метод <tt class="docutils literal"><span class="pre">Environment</span> <span class="pre">Lighting</span> <span class="pre">&gt;</span> <span class="pre">Environment</span> <span class="pre">Color</span> <span class="pre">&gt;</span> <span class="pre">Sky</span> <span class="pre">Texture</span></tt>.</li>
<li>Перейти из вкладки <tt class="docutils literal"><span class="pre">World</span></tt> во вкладку <tt class="docutils literal"><span class="pre">Texture</span></tt>.</li>
<li>Создать <a class="reference internal" href="textures.html#environment-map"><em>карту окружения</em></a>, загрузить в нее соответствующее изображение.</li>
<li>Для карты окружения на панели <tt class="docutils literal"><span class="pre">Blend4Web</span></tt> для значения <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">texture</span> <span class="pre">usage</span></tt> выбрать <tt class="docutils literal"><span class="pre">ENVIRONMENT_LIGHTING</span></tt> или <tt class="docutils literal"><span class="pre">BOTH</span></tt> (опция <tt class="docutils literal"><span class="pre">BOTH</span></tt> активирует также использование этой текстуры в качестве <a class="reference internal" href="textures.html#skydome-texture"><em>текстуры неба</em></a>).</li>
</ol>
<a class="reference internal image-reference" href="_images/lighting_environment_texture.jpg"><img alt="_images/lighting_environment_texture.jpg" class="align-center" src="_images/lighting_environment_texture.jpg" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="shadows">
<span id="id11"></span><h2>Тени<a class="headerlink" href="#shadows" title="Ссылка на этот заголовок">¶</a></h2>
<p>Тени - один из важнейших элементов при рендеринге конечного изображения. Они предоставляют зрителю не только информацию о силуэте объектов, но и об их высоте и взаимном расположении, положении источника света и т.д.</p>
<p>Платформой Blend4Web реализуются такие техники, как каскадные карты теней (CSM) и смягченные тени (PCF).</p>
<div class="section" id="id12">
<h3>Активация<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h3>
<ol class="arabic simple">
<li>На объектах, <strong>отбрасывающих</strong> тени, включить опцию <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Shadows:</span> <span class="pre">Cast</span></tt> во вкладке <tt class="docutils literal"><span class="pre">Object</span></tt>.</li>
<li>На объектах, <strong>получающих</strong> тени, включить опцию <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Shadows:</span> <span class="pre">Receive</span></tt> во вкладке <tt class="docutils literal"><span class="pre">Object</span></tt>.</li>
<li>Убедиться, что включена опция <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Render</span> <span class="pre">shadows</span></tt> во вкладке <tt class="docutils literal"><span class="pre">Scene</span></tt>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p>Объекты, имеющие <a class="reference internal" href="materials.html#alpha-blend"><em>прозрачные материалы с градиентом</em></a>, не отбрасывают теней.</p>
<a class="last reference internal image-reference" href="_images/alpha_shadows.jpg"><img alt="_images/alpha_shadows.jpg" class="align-center" src="_images/alpha_shadows.jpg" style="width: 100%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id13">
<h3>Настройка<a class="headerlink" href="#id13" title="Ссылка на этот заголовок">¶</a></h3>
<dl class="docutils">
<dt><em>Направление</em></dt>
<dd>В случае наличия нескольких источников света рекомендуется указать, какой именно источник света будет использоваться для расчета падающих теней, включив опцию <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Generate</span> <span class="pre">shadows</span></tt> во вкладке <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">Data</span></tt> при выборе объекта-лампы.</dd>
<dt><em>Цвет</em></dt>
<dd>Цвет тени определяется настройками <a class="reference internal" href="#environment-lighting"><em>освещения от окружающей среды</em></a>.</dd>
</dl>
<p>Во вкладке <tt class="docutils literal"><span class="pre">World</span></tt> на панели <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Shadow</span> <span class="pre">Settings</span></tt> находятся дополнительные настройки:</p>
<a class="reference internal image-reference" href="_images/b4w_shadow_settings.png"><img alt="_images/b4w_shadow_settings.png" class="align-center" src="_images/b4w_shadow_settings.png" style="width: 100%;" /></a>
<dl class="docutils">
<dt><em>Resolution</em></dt>
<dd>Разрешение используемой карты теней. Значение по умолчанию: 2048x2048px.</dd>
<dt><em>Self-shadow polygon offset</em></dt>
<dd>Коэффициент смещения полигона в зависимости от ориентации к источнику света. Значение по умолчанию: 1.</dd>
<dt><em>Self-shadow normal offset</em></dt>
<dd>Коэффициент смещения полигона по нормали. Значение по умолчанию: 0.01.</dd>
</dl>
<p>Последние две настройки служат для борьбы с артефактами самозатенения. Они проявляются на объектах, одновременно отбрасывающих и принимающих тени.
Параметр <tt class="docutils literal"><span class="pre">Self-shadow</span> <span class="pre">polygon</span> <span class="pre">offset</span></tt> лучше справляется с артефактами во внутренних областях полигонов, а <tt class="docutils literal"><span class="pre">Self-shadow</span> <span class="pre">normal</span> <span class="pre">offset</span></tt> - в приграничных.
Оба параметра приводят к искажению теней, поэтому рекомендуется держать их как можно меньшими.</p>
<a class="reference internal image-reference" href="_images/self_shadow_artifacts.png"><img alt="_images/self_shadow_artifacts.png" class="align-center" src="_images/self_shadow_artifacts.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="docutils">
<dt><em>Enable CSM</em></dt>
<dd>Включение каскадной модели теней; открывает доступ к расширенным настройкам. Отключено по умолчанию.</dd>
</dl>
<p>Эта опция позволяет выбрать один из следующих вариантов наложения теней:</p>
<ul class="simple">
<li>Стандартная модель, использующая одну оптимизированную карту теней, охватывающую всю сцену (<tt class="docutils literal"><span class="pre">Enable</span> <span class="pre">CSM</span></tt> отключена).</li>
<li>Каскады теней (<tt class="docutils literal"><span class="pre">Enable</span> <span class="pre">CSM</span></tt> включена).</li>
</ul>
<dl class="docutils">
<dt><em>Blur radius</em></dt>
<dd>Коэффициент размытия теней, позволяющий настроить cмягченные тени. Значение по умолчанию: 3. Коэффициент 0 даст жесткие тени.</dd>
</dl>
<a class="reference internal image-reference" href="_images/blur_radius.png"><img alt="_images/blur_radius.png" class="align-center" src="_images/blur_radius.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Смягченные тени могут повысить качество и реалистичность изображения. Они скрывают неизбежную при использовании основанных на изображениях техник зубчатость краев, особенно сильно проявляющуюся для карт теней низкого разрешения. Использование смягченных теней часто позволяет снизить разрешение без существенной потери качества.</p>
<div class="section" id="id14">
<h4>Стандартная модель<a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h4>
<p>Этот вариант больше подходит для маленьких сцен, состоящих из небольшого числа объектов. Благодаря оптимизации на таких сценах можно добиться более высокого качества теней по сравнению с каскадной моделью. Данный вариант проще и быстрее настроить, а использование всего лишь одной карты теней положительно сказывается на производительности.</p>
</div>
<div class="section" id="id15">
<h4>Каскады теней<a class="headerlink" href="#id15" title="Ссылка на этот заголовок">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Данные настройки поддерживаются только для источников освещения типа <tt class="docutils literal"><span class="pre">Sun</span></tt>. Для других источников каскады автоматически отключаются.</p>
</div>
<p>Для обеспечения приемлемого качества теней и одновременно покрытия значительных пространств необходимо использовать несколько стадий генерации теней (каскадов). При этом вблизи наблюдателя располагается каскад с наилучшим качеством, вдали от наблюдателя — с наихудшим.
Этот вариант больше подходит для сцен среднего и большого размера, например, игровых уровней.</p>
<p>При включении предоставляет расширенные настройки:</p>
<img alt="_images/b4w_shadow_settings_csm.png" class="align-center" src="_images/b4w_shadow_settings_csm.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="docutils">
<dt><em>CSM number</em></dt>
<dd>Количество каскадов теней. Поддерживается от 1 до 4 каскадов. Значение по умолчанию: 1.</dd>
<dt><em>CSM first cascade border</em></dt>
<dd>Размер первого каскада. Значение по умолчанию: 10.0.</dd>
<dt><em>CSM last cascade border</em></dt>
<dd>Размер последнего каскада. Значение по умолчанию: 100.0.</dd>
</dl>
<p>Размеры промежуточных каскадов интерполируются на основе последних двух параметров.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">При настройке следует помнить, что, увеличивая размер каскада, мы получаем на нем менее качественные тени. С другой стороны, уменьшение параметра <tt class="docutils literal"><span class="pre">CSM</span> <span class="pre">first</span> <span class="pre">cascade</span> <span class="pre">border</span></tt> приблизит к камере и сделает более заметными последующие менее детальные каскады. Уменьшение параметра <tt class="docutils literal"><span class="pre">CSM</span> <span class="pre">last</span> <span class="pre">cascade</span> <span class="pre">border</span></tt> приведет к исчезновению теней на более близком расстоянии от камеры. Однако, при использовании мягких теней качество в целом улучшится благодаря размытию на границах.</p>
</div>
<a class="reference internal image-reference" href="_images/csm_cascade_distance.png"><img alt="_images/csm_cascade_distance.png" class="align-center" src="_images/csm_cascade_distance.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="docutils">
<dt><em>CSM first cascade blur radius</em></dt>
<dd>Коэффициент размытия на первом каскаде. Значение по умолчанию: 3. Коэффициент 0 даст жесткие тени.</dd>
<dt><em>CSM last cascade blur radius</em></dt>
<dd>Коэффициент размытия на последнем каскаде. Значение по умолчанию: 1.5. Коэффициент 0 даст жесткие тени.</dd>
</dl>
<p>Радиус размытия каждого промежуточного каскада интерполируется на основе этих параметров.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Смягченные тени рекомендуется настраивать сначала на первом каскаде опцией <tt class="docutils literal"><span class="pre">CSM</span> <span class="pre">first</span> <span class="pre">cascade</span> <span class="pre">blur</span> <span class="pre">radius</span></tt>, а далее на всех остальных с помощью <tt class="docutils literal"><span class="pre">CSM</span> <span class="pre">last</span> <span class="pre">cascade</span> <span class="pre">blur</span> <span class="pre">radius</span></tt>. Часто на последнем каскаде может потребоваться размытие меньшее, нежели на первом. Это нужно для того, чтобы тени на последнем каскаде не стали слишком блеклыми из-за низкой детализации, к тому же это уменьшит нежелательные артефакты самозатенения.</p>
</div>
<dl class="docutils">
<dt><em>Fade-out last cascade</em></dt>
<dd>Плавное исчезновение последнего каскада. По умолчанию включено.</dd>
<dt><em>Blend between cascades</em></dt>
<dd>Сглаживание границ между каскадами. По умолчанию включено.</dd>
</dl>
<a class="reference internal image-reference" href="_images/blend_between_cascades.png"><img alt="_images/blend_between_cascades.png" class="align-center" src="_images/blend_between_cascades.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="index-4">
<span id="id16"></span><h2>Цвет фона<a class="headerlink" href="#index-4" title="Ссылка на этот заголовок">¶</a></h2>
<p>Цвет фона можно задать несколькими способами:</p>
<ol class="arabic simple">
<li>Установить параметры <tt class="docutils literal"><span class="pre">Horizon</span> <span class="pre">Color</span></tt> и <tt class="docutils literal"><span class="pre">Zenith</span> <span class="pre">Color</span></tt> на вкладке <tt class="docutils literal"><span class="pre">World</span></tt> в Blender, предварительно выставив опцию <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Settings</span> <span class="pre">&gt;</span> <span class="pre">Render</span> <span class="pre">Sky</span></tt>.</li>
<li>Поместить сцену внутрь модели (например, куба или сферы) с направленными внутрь нормалями, с материалом и опциональной текстурой.</li>
<li>Разместить перед камерой поверхность с материалом и опциональной текстурой, присоединить ее к камере связью родитель-потомок. При необходимости настроить расстояние до поверхности, переднюю и заднюю плоскости отсечения камеры.</li>
</ol>
<a class="reference internal image-reference" href="_images/parented_background.jpg"><img alt="_images/parented_background.jpg" class="align-center" src="_images/parented_background.jpg" style="width: 100%;" /></a>
<ol class="arabic" start="4">
<li><p class="first">Использовать <a class="reference internal" href="textures.html#skydome-texture"><em>текстуру неба</em></a>.</p>
</li>
<li><p class="first">Настроить динамически генерируемую <a class="reference internal" href="outdoor_rendering.html#atmosphere"><em>атмосферу</em></a>.</p>
</li>
<li><p class="first">Установить параметр движка <tt class="docutils literal"><span class="pre">background_color</span></tt>, используя программный метод <tt class="docutils literal"><span class="pre">config.set()</span></tt>, предварительно отключив опцию <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Settings</span> <span class="pre">&gt;</span> <span class="pre">Render</span> <span class="pre">Sky</span></tt> на вкладке <tt class="docutils literal"><span class="pre">World</span></tt> в Blender. Установленное значение используется в качестве аргумента метода WebGL <tt class="docutils literal"><span class="pre">clearColor()</span></tt>. Для получения корректных результатов рекомендуется отключить прозрачность контекста WebGL (параметр <tt class="docutils literal"><span class="pre">alpha</span></tt>). Такая конфигурация используется по умолчанию в стандартном веб-плеере движка.</p>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cfg</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_main</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">);</span>

<span class="c1">// gray</span>
<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">([</span><span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]));</span>
<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="nx">m_main</span><span class="p">.</span><span class="nx">init</span><span class="p">(...);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">В качестве фона можно использовать любой HTML контент, находящийся позади элемента <tt class="docutils literal"><span class="pre">canvas</span></tt>, который используется для рендеринга. Для это необходимо активировать прозрачность контекста WebGL (параметр <tt class="docutils literal"><span class="pre">alpha</span></tt>), предварительно отключив опцию <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Settings</span> <span class="pre">&gt;</span> <span class="pre">Render</span> <span class="pre">Sky</span></tt> на вкладке <tt class="docutils literal"><span class="pre">World</span></tt> в Blender. Для получения корректных результатов рекомендуется выставить полностью прозрачный черный цвет фона. Такая конфигурация используется по умолчанию в стандартном <a class="reference internal" href="viewer.html#viewer"><em>просмотрщике сцен</em></a> SDK движка.</p>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cfg</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_main</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">);</span>

<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]));</span>
<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">m_main</span><span class="p">.</span><span class="nx">init</span><span class="p">(...);</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">См.также</p>
<p class="last"><a class="reference internal" href="gamma_alpha.html#alpha-compositing"><em>Альфа-композитинг</em></a></p>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Оглавление</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">Общие сведения</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Функционал движка</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_steps.html">Экспресс-установка</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Развёртывание среды разработки</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Рабочий процесс</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewer.html">Просмотрщик сцен</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_player.html">Веб-плеер</a></li>
<li class="toctree-l1"><a class="reference internal" href="addon.html">Аддон</a></li>
<li class="toctree-l1"><a class="reference internal" href="objects.html">Объекты</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera.html">Камера</a></li>
<li class="toctree-l1"><a class="reference internal" href="materials.html">Материалы</a></li>
<li class="toctree-l1"><a class="reference internal" href="textures.html">Текстуры</a></li>
<li class="toctree-l1"><a class="reference internal" href="node_materials.html">Нодовые материалы</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Освещение, тени и фон</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#index-1">Типы затенения</a></li>
<li class="toctree-l2"><a class="reference internal" href="#index-2">Редактор нормалей</a></li>
<li class="toctree-l2"><a class="reference internal" href="#index-3">Освещение от источников света</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-lighting">Освещение от окружающей среды</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shadows">Тени</a></li>
<li class="toctree-l2"><a class="reference internal" href="#index-4">Цвет фона</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing_effects.html">Постпроцессинговые эффекты</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles.html">Система частиц. Флюиды</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles_instancing.html">Система частиц. Инстансинг</a></li>
<li class="toctree-l1"><a class="reference internal" href="animation.html">Анимация</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdoor_rendering.html">Рендеринг наружных сцен</a></li>
<li class="toctree-l1"><a class="reference internal" href="gamma_alpha.html">Гамма-коррекция и альфа-композитинг</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio.html">Звуковая подсистема</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">Физика</a></li>
<li class="toctree-l1"><a class="reference internal" href="nla.html">Нелинейная анимация</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Разработчикам приложений</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers_advanced.html">Разработчикам движка</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_short_manual.html">Работа в команде с использованием Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems_and_solutions.html">Проблемы и решения</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Замечания к релизам</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Поиск</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Искать" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Введите слова для поиска или имя модуля, класса или функции.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="node_materials.html" title="Нодовые материалы"
             >назад</a> |
          <a href="postprocessing_effects.html" title="Постпроцессинговые эффекты"
             >вперёд</a> |
          <a href="genindex.html" title="Алфавитный указатель"
             >указатель</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2015, ООО &#34;Триумф&#34;.
      Обновлено: 2015-04-29.
      Создано с помощью <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>