
Меши
****


Содержание
^^^^^^^^^^

* Меши

  * Статические и динамические объекты

  * Настройка

    * Override Bounding Volumes

  * Копирование объектов (инстансинг)

    * Простое копирование

    * Глубокое копирование

    * Удаление объектов

  * Выделение объектов

  * Морфинг


Статические и динамические объекты
==================================

Все объекты типа "MESH" можно разделить на статические и динамические.

**Статические объекты** - объекты, меши которых могут быть объединены
друг с другом, если они имеют одинаковый материал.

**Динамические объекты** - объекты, меши которых не могут быть
скомбинированы друг с другом.

Объединение статических объектов - т.н. батчинг (batching) -
осуществляется автоматически при загрузке сцены в целях оптимизации
количества вызовов отрисовки. Конвертация происходит, даже если на
сцене присутствует всего один объект. Центр получившегося в результате
конвертации меша находится в начале координат.

Объекты, имеющие анимацию, физику или родителя, являющегося
динамическим объектом, рассматриваются как динамические.

Перемещение посредством API возможно только в случае динамических
объектов. Чтобы обеспечить движение объекта, не имеющего настроек
динамического объекта, в его настройках следует активировать опцию
"Force Dynamic Object".


Настройка
=========

Меши обладают всеми параметрами объектов, а также некоторыми
дополнительными параметрами.


Override Bounding Volumes
-------------------------

Эта вкладка используется для настройки ограничивающих объёмов. Такие
объёмы используются при определении видимости объекта, для рассчёта
столкновений и физических взаимодействий. Манипулируя ими, можно
добиться различных эффектов.

[рисунок]

Раздел "Override Bounding Volumes" расположен на панели иструментов
"Blend4Web" (рядом с редактором нормалей).

*Show Boundings*

   [рисунок]

   Отобразить ограничивающий объём во вьюпорте Blender.  Работает
   только если активирована опция "Override Mesh Boundings". Объём
   может быть представлен в виде параллелепипеда либо в виде
   комбинации окружностей или эллипсов. Одновременно может работать
   более одного метода визуализации (в том числе все три).

Примечание: Метод визуализации не влияет на форму ограничивающего
  объёма, только на его представление во вьюпорте.



*Override Mesh Boundings*

   [рисунок]

   Эта кнопка включает использование нестандартного ограничивающего
   объёма. Ограничивающий объём имеет форму параллелпипеда, центр
   которого совпадает с точкой привязки объекта.

*MinX и  MaxX*
   Размеры ограничивающего объёма по оси Z. По умолчанию *MinZ* = -1,
   *MaxZ* = 1.

*MinY и  MaxY*
   Размеры ограничивающего объёма по оси Y. По умолчанию *MinY* = -1,
   *MaxY* = 1.

*MinZ и  MaxZ*
   Размеры ограничивающего объёма по оси Z. По умолчанию *MinZ* = -1,
   *MaxZ* = 1.


Копирование объектов (инстансинг)
=================================

Часто возникает необходимость копирования объектов (инстансинг) во
время работы приложения.

Существует ряд ограничений на копируемые объекты:
   * тип объекта должен быть "MESH"

   * объект должен быть динамическим (включить настройку "Rendering
     Properties > Force Dynamic Object")

   * объект должен принадлежать активной сцене


Простое копирование
-------------------

В случае простого копирования для объекта-копии будет использоваться
геометрия объекта, с которого осуществлялось копирование. При
изменении геометрии на исходном объекте, геометрия изменится и на
объекте-копии.


Глубокое копирование
--------------------

При глубоком копировании новый объект будет обладать уникальными для
него свойствами, а именно, он будет иметь свою собственную геометрию.
То есть при изменении геометрии на объекте-оригинале у объекта-копии
геометрия изменяться не будет. Также при глубоком копировании
canvas-текстуры на копиях - именно разные текстуры, в то время как при
простом копировании - одна и та же. Для такого типа копирования на
исходном объекте нужно дополнительно выставить опцию Rendering
Properties > Dynamic Geometry.

Для копирования объектов в модуле "objects.js" предусмотрена функция
"copy", в которую надо передать идентификатор копируемого объекта,
уникальное имя нового объекта и булеву переменную, определяющую тип
копирования: "true"- глубокое, "false" - простое. По умолчанию будет
осуществлено простое копирование.

Созданный при копировании объект необходимо добавить на сцену. Для
этого в модуле "scenes.js" существует функция "append_object", куда
нужно передать объект, полученный копированием.

   // ...
   var new_obj = m_objects.copy(obj, "New_name", true);
   m_scenes.append_object(new_obj);
   m_transform.set_translation(new_obj, 2, 0, 2);
   // ...


Удаление объектов
-----------------

Для удаления объектов, в модуле "scenes.js" предусмотрена функция
"remove_object", куда надо передать объект. Возможно удаление
динамических mesh- и empty-объектов.

   // ...
   m_objects.remove_object(new_obj);
   // ...


Выделение объектов
==================

Чтобы разрешить выделение конкретного объекта, необходимо установить
флаг "Selectable" в панели "Selection and Outlining".

Примечание: Следует убедится в том, что в панели "Scene > Object
  Outlining" установлено состояние "ON" или "AUTO".

Выделение объекта возможно программно через API, например, в модуле
"scenes.js" имеется функция "pick_object", которая по координатам в
canvas'е выделяет объект,

   // ...
   var x = event.clientX;
   var y = event.clientY;

   var obj = m_scenes.pick_object(x, y);
   // ...

или с использованием NLA-скрипта.

Если для выделяемого объекта в панели "Object > Selection and
Outlining" установлены флаги "Enable Outlining" и "Outline on Select",
то вызов функции "pick_object" приведет к активации Outline-анимации.

Примечание: Если выделяемый объект полупрозрачен (имеет тип
  прозрачности "Blend" "Add" или "Sort"), outline-анимация будет видна
  только на тех частях объекта, для которых значение прозрачности
  "Alpha" выше 0.5.


Морфинг
=======

Для создания ключей деформации (опорных фигур) перейдите во вкладку
"Mesh > Shape keys".

[рисунок]



Движком поддерживаются все опции типа "Relative" для ключей
деформации.

Для изменения значения ключа деформации, существует функция
"apply_shape_key" в модуле "geometry.js".

Примечание: На объекте должно стоять свойство *Export Shape Keys*.

   // ...
   var obj = m_scenes.get_object_by_name("Object");
   m_geometry.apply_shape_key(obj, "Key 1", 0.5);
   // ...
