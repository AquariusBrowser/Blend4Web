.. _release_notes:

*******************
Замечания к релизам
*******************

.. index:: замечания к релизам

v15.04
======

Новый функционал
----------------

* *Добавлена поддержка ключей деформации (Shape Keys).*

    Была осуществлена поддержка :ref:`ключей деформации <morphing>` (`Shape Keys <http://wiki.blender.org/index.php/Doc:2.6/Manual/Animation/Techs/Shape/Shape_Keys>`_) в Blender'e. Для применения ключей в модуль ``geometry.js`` была добавлена функция ``set_shape_key_value``. Пример использования данного функционала доступен в приложении :ref:`Code Snippets <code_snippets>`.

* *Добавлена поддержка фона с использованием Horizon Color и Zenith Color.*

    Теперь поддерживается настройка фона сцены с использованием ``Horizon Color`` и ``Zenith Color``, а также флагов ``Paper Sky``, ``Blend Sky`` и ``Real Sky``.

* *Добавлена поддержка ноды Gamma.*

    Силами команды Blend4Web в Blender v2.74 была добавлена поддержка ноды Gamma. Теперь эта нода также доступна и в движке.

* *Улучшения в инструменте для создания подписей Anchors.*

    В настройках в Blender добавлена возможность ограничивать размеры подписей. Реализована поддержка динамической загрузки/выгрузки подписей. Добавлена возможность сокрытия подписей с помощью штатных методов show()/hide() или в инструменте NLA Script.

* *Оптимизация шейдеров.*

    Улучшение шейдерного компилятора. Добавлен следующий функционал: оптимизация локальных переменных, удаление избыточных фигурных скобок. Улучшение производительности нодовых материалов.

* *Оптимизации физического движка uranium.js.*

    Модуль с физическим движком загружается только в тех случаях, когда это необходимо. Размер модуля сокращён на 20%.

* *Расширены инструменты для отладки физики.*

    Добавлен метод `physics_stat()` модуля `debug <https://www.blend4web.com/api_doc/module-debug.html>`_ для вывода статистики о количестве физических объектов (по типам), сложности геометрии и прочей информации. Для визуальной оценки производительности физической симуляции добавлена возможность вывода числа итераций: Physics FPS (активируется в модуле `config`).

* *Новый API для присоединения объектов к камере независимо от соотношений сторон и углов обзора камеры.*

    Реализуется с помощью метода `append_stiff_viewport()` модуля `constraints <https://www.blend4web.com/api_doc/module-constraints.html>`_.

* *Новый модуль для применения трансформаций "tsr.js".*

    Позволяет применять произвольные трансформации к объектам с помощью универсальных векторов TSR, включающих в себя перемещение, масштабирование и поворот. Данные векторы могут быть использованы в качестве более удобной и эффективной замены матриц.

* *Добавлена возможность игнорирования директорий для конвертера ресурсов.*

    Была добавлена возможность игнорирования директорий для :ref:`конвертера ресурсов <converter>`. Для этого надо разместить в этой директории файл с именем ``.b4w_no_conv``.

Изменения
---------

* *Изменен внешний вид документации API движка. Появились ссылки для быстрого перехода к описаниям методов и свойств.*

* *Скелетная анимация учитывает взаимное расположение арматуры и объекта.*

    Теперь поддерживается родное поведение Blender. Больше нет необходимости размещать арматуру и анимируемый объект в одной точке и с одинаковым поворотом и масштабом.

* *Объектная анимация теперь позволяет анимировать независимо перемещение, поворот и масштаб.*

    В объектной анимации теперь нет жесткой простановки ключей на все каналы, что позволяет сохранять изначальные значения в незатронутых каналах или изменять их через API.

* *Опциональная поддержка фона.*

    Активация фона или неба регулируется опцией ``Sky Settings > Render Sky`` на вкладке ``World``. По умолчанию отключено.

* *Физический движок Uranium теперь состоит из двух модулей.*

    Для работы физики теперь требуется два модуля: код движка uranium.js и файл инициализации памяти uranium.js.mem. Оба модуля должны находится в одной директории.

* *Эффект Glow и все связанные с ним компоненты движка были переименованы в Outline.*

    Новое имя более ясно описывает суть эффекта: подсвечивание объекта на его границах.

* *Применение ограничителя движения при помощи функции "append_semi_stiff_cam" модуля "constraints.js" теперь разрешено только для камер типа "EYE".*

* *Изменения локального сервера разработки в Blender.*

    В качестве :ref:`локального сервера <local_development_server>` теперь вместо стандартного SimpleHTTPServer на Python используется Tornado Web Server. Новый сервер имеет высокую производительность, а также содержит расширенные настройки для отключения кеширования браузерами.

* *Добавлено управление слайдерами с помощью клавиатуры в приложении Viewer.*

    Теперь управление слайдером осуществляется при помощи клавиш ``<`` и ``>``.

* *Изменения в методе "update_object_animation" модуля "animation.js".*
  
    Добавлен необязательный параметр "force_update", заставляющий обновлять состояние анимированного объекта даже при остановленной анимации.

* *Изменения API модуля mouse.js.*
    
    Добавлены методы: *enable_mouse_hover_outline*, *disable_mouse_hover_outline*.

    Следующие методы объявлены устаревшими и будут удалены в последующих релизах: *enable_mouse_hover_glow*, *disable_mouse_hover_glow*.

* *Изменения API модуля scenes.js.*
    
    Добавлены методы: *outlining_is_enabled*, *set_outline_intensity*, *get_outline_intensity*, *apply_outline_anim*, *apply_outline_anim_def*, *clear_outline_anim*, *set_outline_color*, *get_outline_color*.

    Следующие методы объявлены устаревшими и будут удалены в последующих релизах: *set_glow_intensity*, *get_glow_intensity*, *apply_glow_anim*, *apply_glow_anim_def*, *clear_glow_anim*, *set_glow_color*, *get_glow_color*.

* *В панели Object > Blend4Web изменены настройки.*

    Добавлен флаг *Enable Outline*, который устанавливает возможность использования эффекта :ref:`подсветки контура <outline>` на данном объекте. Так же добавлен флаг *Ouline on Select*, устанавливающий активацию анимации подсветки при выделении объекта (раньше данное поведение определялось флагом Selectable).

* *В панель Scene > Blend4Web добавлены новые настройки.*
    
    Добавлено поле *Enable Object Outlining*, которое управляет возможностью подсветки контура объектов. Аналогично, новое поле *Enable Object Selectable* управляет возможностью выделения объектов.

* *Теперь свойства объекта Apply Scale, Apply Modifiers, Export Vertex Animation, Export Edited Normals и Export Shape Keys взаимно исключают друг друга.*

* *Изменение API модулей.*

    В `API модуля util.js <https://www.blend4web.com/api_doc/module-util.html>`_ добавился метод *is_armature*, позволяющий проверить, является ли данный объект объектом типа ``ARMATURE``.
    
    В `API модуля constraints.js <https://www.blend4web.com/api_doc/module-constraints.html>`_ добавился метод *get_parent*, возвращающий для данного объекта родительский объект.

Исправления
-----------

* *Исправлена ошибка, приводящая к исчезновению описания объекта в модуле "anchors.js".*

* *Исправлена ошибка запекателя скелетной анимации при наличии арматурных объектов на скрытых слоях.*

* *Исправлено поведение камеры при использовании функции "append_semi_stiff_cam" модуля "constraints.js".*

   Исправлено вертикальное выравнивание камеры относительно родительского объекта. Также теперь учитывается начальная ориентация камеры, что может потребовать корректировки лимитов вращения, передаваемых в эту функцию.

* *Исправлена ошибка обновления плейлиста, если он оказывался пустым.*

* *Исправлено некорректное поведение физических объектов при удалении хотя бы одного из них со сцены.*

* *Исправлен баг при наличии нулевого масштабирования у объекта, размноженного через DupliGroup.*

* *Исправлена ошибка компиляции шейдера воды на Windows и некоторых мобильных устройствах.*

* *Исправлена ошибка при наличии дублированных ключей анимации.*

* *В анимации NLA теперь можно использовать акторы из разных файлов, имеющие одинаковое имя.*

* *Устранено размножение обработчиков перемещения мыши при многократном вызове "pointerlock".*

* *Исправлен тип прозрачности "Alpha Sort" для динамических объектов.*

* *Исправлена ошибка сборки аддона, приводящая к неработоспособности на системах Windows без установленного C++ 2010 runtime.*

* *Исправлен баг рендеринга billboard-объектов на iPad.*

v15.03
======

Новый функционал
----------------

* *Инструмент для создания подписей к трёхмерным объектам.*

    Теперь имеется возможность создавать подписи к трёхмерным объектам ("якори"). Данные якори могут быть трёх различных типов: Аннотации (Annotation) - используется информация из мета-тегов, назначенных на объектах, Элементы (Custom Element) - в качестве якоря можно назначить произвольный HTML-элемент с текущей веб-страницы и Общий (Generic) - якорь, положение которого можно определить с помощью API модуля anchors.

* *Анимация и возможность управления через API значениями нод типа Value и RGB.*

    Теперь помимо анимации нод типа Value возможна анимация нод RGB. Так же в модуле objects.js появились соответствующие функции для изменения значений таких нод.

* *Новое приложение "Code Snippets".*

    Это :ref:`приложение <code_snippets>` было создано для более быстрого и легкого просмотра уроков по функционалу движка. В нем также можно ознакомиться со скриптами, составляющими основу логики работы приведенных уроков. Приложение доступно из файла index.html, находящегося в корне Blend4Web SDK.

* *Новые функции управления эффектом Glow.*

    В модуль *scenes* были добавлены новые API: *get_glow_intensity()* и *get_glow_color()*.

* *Улучшения в просмотрщике сцен Viewer.*

    Изменён дизайн кнопки перехода на "домашнюю" сцену, добавлена кнопка "All objects selectable", позволяющая отключить автоматическое назначение свойства "Selectable" для всех объектов на сцене. Также в просмоторщике теперь можно увидеть суммарное количество шейдеров, выполняющихся на загруженной сцене.

* *Динамическое копирование объектов сцены.*

    Появилась возможность динамического :ref:`копирования и удаления <copy_obj>` объектов сцены (инстансинг).

* *Обработка ошибок, связанных со специальной нодой B4W_PARALLAX.*

    Добавлена обработка некорректного использования ноды B4W_PARALLAX в виде :ref:`некритической ошибки экспорта <export_errors_warnings>`.

* *Новые опции в сборщике приложений.*

    В сборщике приложений появились новые опции ``-j`` и ``-c``, которые позволяют добавлять в исключения, соответственно, скрипты и стили, не требующие компиляции.

* *Экспериментальный Blend4Web рендер движок.*

    Включается в настройках аддона: флаг "Register Blend4Web render engine (Experimental)". Предназначен для упрощения редактирования свойств объектов. Упрощает интерфейс, отключив неподдерживаемые аддоном панели. В данный момент в режиме Blend4Web рендера отсутствует возможность редактирования шейдерного нодового дерева. 

Изменения
---------

* *Изменение точки отсчета лимитов перемещения камеры.*

    Выставление лимитов перемещения камеры через API теперь полностью соответствует :ref:`отсчету значений <camera_api_notes>` в системе координат движка. Выставление в Blender'е горизонтальных лимитов для камеры типа ``TARGET`` в пространстве координат ``World Space`` изменилось, поэтому может потребовать перенастройки для старых сцен.

* *Обновление документации по настройкам камеры.*

* *Горизонтальные и вертикальные лимиты вращения камеры теперь полностью независимы друг от друга.*

* *Изменения API модуля camera.js.*

    `API <https://www.blend4web.com/api_doc/module-camera.html>`_ модуля camera.js претерпело ряд изменений. 
    
    Добавились новые методы: *is_target_camera*, *is_eye_camera*, *is_hover_camera*, *rotate_camera*, *rotate_target_camera*, *rotate_eye_camera*, *rotate_hover_camera*, *get_camera_angles*, *hover_cam_set_translation*. 

    Объявлены устаревшими и будут удалены в последующих релизах: *rotate_pivot*, *rotate_hover_cam*, *rotate*, *set_eye_params*, *get_angles*, *translate_hover_cam_v*, *set_hover_cam_angle*.

    Методы *set_ortho_scale* и *get_ortho_scale* при применении их к камере отличного от ``Orthographic`` типа теперь выводят сообщение об ошибке. Также изменено поведение метода *get_hover_angle_limits*, который теперь возвращает угловые лимиты для ``HOVER`` камеры в формате [down, up] вместо [up, down] как было раньше.

* *Значительно оптимизирована система освещения.*

    Многие свойства источников света теперь обрабатываются на этапе компиляции. Теперь нет ограничения в 4 источника для некоторых мобильных устройств.

* *Изменён способ вёрстки приложений, использующих модуль app.*

    При инициализации приложения с использованием модуля app размеры создаваемого элемента ``<canvas>`` теперь полностью определяются размерами элемента-контейнера. Это нужно иметь в виду, например, в случае использования элемента ``<div>`` в качестве контейнера, поскольку по умолчанию его высота равна нулю. Задать правильные размеры контейнера можно с использованием CSS, например с помощью inline-стиля. Также, при любых преобразованиях контейнера теперь необходимо вызывать функцию модуля *app* *resize_to_container()*. Аналогичного эффекта можно добиться, если задать опцию *autoresize* при инициализации приложения (в функции *app.init()*). Поддержка низкоуровневого метода изменения размеров элемента ``<canvas>`` с использованием функции *main.resize()* сохранена.

* *Функция модуля app enable_controls() теперь вызывается без параметров.*

* *Удалены устаревшие методы API.*

    Модуль `textures.js <https://www.blend4web.com/api_doc/module-textures.html>`_: *stop_video*.

    Модуль `scenes.js <https://www.blend4web.com/api_doc/module-scenes.html>`_: *add_object*, *get_screen_scenes*, *set_light_pos*, *set_light_direction*, *set_dir_light_color*, *get_lights_names*, *remove_all*, *check_collision*, *check_ray_hit*, *get_appended_objs*, *get_object_by_empty_name*.

    Модуль `physics.js <https://www.blend4web.com/api_doc/module-physics.html>`_: *set_character_dist_to_water*.

    Модуль `material.js <https://www.blend4web.com/api_doc/module-material.html>`_: *set_batch_param*, *set_max_bones*, *max_bones*.

    Модуль `main.js <https://www.blend4web.com/api_doc/module-main.html>`_: *set_shaders_dir*, *set_texture_quality*.

    Модуль `data.js <https://www.blend4web.com/api_doc/module-data.html>`_: *get_bpy_world*.

    Модуль `controls.js <https://www.blend4web.com/api_doc/module-controls.html>`_: *sensor_make_positive*, *sensor_make_negative*.

    Модуль `camera.js <https://www.blend4web.com/api_doc/module-camera.html>`_: *change_eye_target_dist* (также удалена устаревшая константа *MS_CONTROLS*).

* *Новые условия для изменения положения объектов через API.*

    Функции модуля ``transform.js``, связанные с изменением положения объекта, доступны только для :ref:`динамических объектов <static_dynamic_objects>`.

* *Разрешено использование ноды типа TEXTURE с отсутствующей текстурой.*

    Отображение нодового материала в этом случае целиком соответствует Blender'у.

* *Обновление механизма проверки совместимости версий экспортированных файлов и движка.*

    Движок будет сигнализировать о несовместимости загружаемой сцены специальными :ref:`сообщениями в консоли браузера<version_errors>`.

* *Свойство объекта "Do not batch" переименовано в "Force Dynamic Object"*

    Данная опция сообщает движку о том, что объект обязан быть динамическим независимо от других настроек. Теперь она носит более понятное имя.


Исправления
-----------

* *Исправлена ошибка автоповорота камеры в веб-плеере.*

* *Исправлена ошибка полноэкранного режима в веб-плеере.*

* *Исправлена ошибка определения угловых координат камеры в некоторых положениях.*

* *Исправлена ошибка автовращения камеры при наличии горизонтальных лимитов, ограничивающих поворот.*

* *Исправлена ошибка множественного добавления специальных нод в blend-файл.*

* *Исправлена ошибка замены материала на объекте функцией "inherit_material" из модуля "material.js".*

* *Исправлены ошибки при отражении зеркальной поверхностью объекта, имеющего свойства, измененные с использованием модуля "material.js".*

* *Исправлена генерация сферических WIREFRAME-объектов в режиме отладки сцены.*

* *Исправлена процедура оптимизации нод типа TEXTURE в нодовом материале.*

* *Исправлена работа опции "Clamp" в ноде типа MixRGB(Linear Light).*

* *Исправлена ошибка, возникающая при экспорте, если на сцене присутствуют объекты с разделяемым мешем и настройками "Apply Scale", "Apply Modifiers", "Export Vertex Animation" или "Export Edited Normals".*

* *Исправлена ошибка при использовании опции "Blend4Web > Preserve global orientation and scale" на ряде мобильных устройств.*

* *Исправлена ошибка рендеринга тумана в отдельных версиях Chrome и Firefox под Windows.*


Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender.*

    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

* *Не работают видеотекстуры в Firefox при экспорте сцены в формате HTML.*

v15.02
======

Новый функционал
----------------

* *Добавлена возможность запуска локального сервера разработки непосредственно из Blender.*

    При использовании Blend4Web SDK имеется возможность запуска :ref:`локального сервера разработки <local_development_server>`. Сервер предоставляет быстрый доступ к содержимому Blend4Web SDK, а также позволяет :ref:`автоматически открывать экспортированные сцены <run_in_viewer>` в просмотрщике сцен.

* *Поддержка теней от источников света типа Spot.*

    Ранее на лампах Spot тени строились так же, как для ламп типа Sun. Теперь расчет производится аналогично тому, как это делается в Blender, с учетом расхождения лучей света в пространстве.

* *Добавлена/расширена поддержка объектов типа "Metaball", "Surface" и "Curve".*

    Была добавлена поддержка объектов типа ``Metaball``, ``Surface`` и ``Curve``. Объекты этих типов автоматически конвертируются в меши при экспорте. Поддержка использования объектов типа ``Curve`` в модификаторах сохранена.

* *В веб-плеер добавлены кнопки социальных сетей.*

    Данные кнопки позволяют разместить ссылку на 3D сцену, а также ее описание в одной их четырёх популярных социальных сетей.

* *Добавлена возможность редактирования файла списка сцен для просмотрщика непосредственно в Blender.*

    Была добавлена возможность :ref:`быстрого редактирования файла assets.json <assets_json>` для приложения Viewer через Blender, если используется Blend4Web SDK.

* *Добавлена возможность изготовления скриншотов в приложении Viewer.*

* *В веб-плеер добавлена опция fallback_video.*

    С помощью опции ``fallback_video=/path/to/video/`` можно указывать видео-файл, который будет проигрываться вместо 3D контента на системах без поддержки WebGL.

* *Расширение функционала рендеринга в текстуру.*

    Добавлена поддержка рендеринга сцен сразу в несколько текстур. Сцены теперь могут иметь любую степень вложенности.

* *Для билбордов появилась возможность сохранять ориентацию и масштабирование объектов в мировом пространстве.*

    Для этого нужно выставить опцию :ref:`Blend4Web > Preserve global orientation and scale <billboarding_preserve>` на панели настроек объекта.

* *Улучшения на главной веб-странице SDK.*

    Теперь на главной странице можно узнать версию используемого SDK и проверить систему на совместимость с WebGL.

* *Добавлена поддержка флага Clamp в нодах MATH и MIX_RGB.*
    
    Функциональность была реализована сначала в Blender 2.73, и теперь в движке.

* *Улучшено качество рендеринга при отсутствии аппаратной поддержки текстуры глубины.*

    Увеличены возможности рендеринга для устройств, не поддерживающих текстуру глубины. Стали доступны эффекты, такие как отражение, свечение, засветка, размытие при движении, сглаживание.

* *Добавлена новая документация.*

    Добавлена документация по модулям ``vec3``, ``vec4``, ``quat``, ``mat3``, ``mat4``, а также глобальному пространству имён ``b4w``. Улучшен дизайн веб-страниц документации.

* *Добавлена возможность иметь несколько запущенных копий движка на одной странице.*

    Несколько приложений теперь могут работать одновременно, указывая имя пространства имён при инициализации.

* *Возможность использования SDK в Apple OS X.*

    В OS X теперь доступны все функции SDK, включая сборку движка и приложений, конвертацию ресурсов и генерирование документации.

* *В модуль camera добавлен метод set_trans_pivot().*

    Данная функция позволяет устанавливать произвольное положение опорной точки и положение камеры типа ``Target``.

* *В утилиту ``project.py`` добавлено новое свойство ``version``.*

    Использование данного свойства позволяет добавлять версию к скриптам и стилям скомпилированного приложения.


Изменения
---------

* *Теперь в приложение можно добавлять опции с одинаковыми именами через адресную строку браузера.*

    В функции ``get_url_params()`` модуля ``app`` появился необязательный параметр ``allow_param_array``, по умолчание равный ``false``.
    При назначении этом параметру ``true`` одинаковые опции будут объединены в массив, в противном случае будет использоваться последняя.

* *Улучшения работы источников звука типа ``Background Music``.*

    Теперь для таких источников поддерживается возможность указания параметров задержки и времени воспроизведения. Также появилась возможность зацикливать их воспроизведение.

* *Специальные ноды аддона Blend4Web теперь присутствуют в blend-файле по умолчанию.*

    Теперь нет необходимости добавлять :ref:`специальные ноды <custom_node_materials>` аддона в файл. Это доступно как при использовании Blend4Web SDK, так и при экспресс-установке аддона.

* *Изменен экспорт пустых объектов типа "Mesh".*

    Теперь объекты типа ``Mesh``, не имеющие полигонов, экспортируются как ``Empty``.

* *Изменения модуля "light.js".*

    Была добавлена новая функция ``get_light_type``, а также теперь в функции ``get_light_params`` и ``set_light_params`` передается не имя объекта, а сам объект типа ``LAMP``. Также теперь доступны для изменения через эти функции свойства ``spot_blend``, ``spot_size``, ``distance`` для источника света типа ``SPOT``. Для источника света типа ``POINT`` теперь доступно для изменения свойство ``distance``.

* *Улучшение рефракции при низких настройках качества.*

    При активации профиля качества ``LOW``, теперь используется упрощённая модель рефракции (без искажений).

* *Оптимизация нодовых шейдеров.*

* *Теперь режим автоматического вращения камеры отключается при касании сенсорного экрана.*


Исправления
-----------

* *Исправлено поведение прелоадера для веб-плеера.*

    При открытии веб-плеера в новой вкладке могли наблюдаться артефакты на логотипе ``B4W``.

* *Исправлена ошибка рендеринга однокаскадных теней, связанная с возникновением жесткой неосвещенной линии по границе всего каскада.*


* *Исправлена ошибка, связанная с коллизией имен при линковке объектов в Blender'e.*

* *Исправлена ошибка с недостаточной оптимизацией приложений из состава SDK.*

* *Исправлена проблема экспорта мешей с плоским шейдингом (flat shading) в Linux x32.*

* *Исправлено некорректное поведение Target камеры в отдельных случаях.*

* *Исправлена ошибка с попыткой использования карты теней размером большим, чем поддерживаемый конкретным устройством.*

* *Исправлена ошибка, приводящая к снижению FPS в Firefox 35/36 под Windows при включении теней.*


Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender.*

    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

* *Не работают видеотекстуры в Firefox при экспорте сцены в формате HTML.*


v15.01
======

Новый функционал
----------------

* *Поддержка режима панорамирования для устройств с сенсорным экраном.*

    Движение камеры в режиме панорамирования осуществляется параллельным перемещением двух пальцев по поверхности экрана.

* *Поддержка объектов типа "Text".*

    Данные объекты теперь автоматически конвертируются в меш при экспорте.

* *Расширение функционала инструмента NLA Script.*

    Добавлены новые логические слоты: ``Show Object`` и ``Hide Object`` используются для скрытия и отображения объектов, ``Page Redirect`` - для перенаправления на другие веб-страницы, ``Page Param`` - для сохранения произвольного параметра веб-страницы в выбранном числовом регистре. Упрощено использование слотов ``Select & Jump`` и ``Select & Play`` - теперь для выделяемых объектов нет необходимости указывать свойство ``Selectable``.  

* *Поддержка экранов сверхвысокого разрешения (HIDPI, Retina).*

    Режим HIDPI позволяет достичь существенного улучшения качества картинки на устройствах с высоким разрешением. Режим включается автоматически при запуске приложений с настройками качества ULTRA. При необходимости, высокое разрешение может быть включено и для других профилей качества.  

* *Поддержка масштабирования для ортографической камеры.*

    Добавлено API для изменения масштабирования камеры типа ``Orthographic`` (``Orthographic scale`` в Blender'e).

* *В веб-плеер добавлена опция autorotate.*

    :ref:`Опция <webplayer_attributes>` autorotate используется для автоматического включения вращения камеры сразу после загрузки сцены.

* *В функцию "enable_camera_controls" из аддона "app.js" добавлен облегченный режим управления с клавиатуры.*

    Включить режим можно передав необязательный параметр ``disable_letter_controls``. При этом будет отключено управление посредством алфавитно-цифровых клавиш клавиатуры (WASD и т.д.). Указанная функциональность может быть использована для тех случаев, когда в приложении необходимо использовать клавиши для целей, не связанных с перемещением камеры.

* *Поддержка работы с гироскопом на мобильном устройстве.*

    Добавлены два сенсора для работы с гироскопом на мобильных устройствах. Первый сенсор позволяет оперировать с разностью текущего положения устройства с предыдущим, создается функцией ``create_gyro_delta_sensor`` из модуля "controls.js". Второй сенсор - с текущим значением угла. Создается функцией ``create_gyro_angles_sensor`` из модуля "controls.js". Стоит отметить, что все значения вычисляются в радианах. Также был создан аддон "gyroscope.js", в котором реализовано движение камеры при угловых перемещениях устройства. С примером работы данного функционала для мобильных устройств можно ознакомиться в нашей программе "Viewer", включив опцию "Gyroscope" в меню программы.

* *Добавлено новое свойство ``Do not Render`` в настройках материала.*

    Включение данного свойства позволяет не отображать на сцене все объекты, использующие этот материал.

* *Поддержка видеотекстур на IE 11 и iPhone.*

    Поддержка добавлена посредством создания простого формата видео-секвенции ``*.seq``.  Более полную информацию можно посмотреть :ref:`в соответствующем разделе документации <seq>`.

* *Поддержка тега "title" в веб-плеере.*

    Тег "title" для веб-плеера, необходимый для вывода названия сцены в браузере, теперь берется из JSON-файла сцены. С более подробной информацией
    можно ознакомиться :ref:`в соответствующем разделе документации <wp_title>`.

* *Поддержка мета-тегов в Blender.*

    В Blender появилась возмосжность добавлять мета-теги к сцене и к объектам. Для сцены это "title" и "description", для
    объекта "title", "description" и "category".

* *Добавлена возможность вызова пользовательских функций каждый кадр.*

    Для возможности создания более сложных приложений в модуле "main.js" была добавлена функция ``append_loop_cb``, позволяющая вызывать переданную в нее функцию каждый кадр. При этом в эту функцию каждый кадр будут передаваться два параметра: время с начала старта приложения и разница во времени между текущим кадром и предыдущим. Обе величины измеряются в секундах. Для того, чтобы больше не вызывать переданную функцию необходимо удалить ее вызовом функции ``remove_loop_cb`` из модуля "main.js".

* *Добавлена анимация простого экрана загрузки приложения.*

    Для создания приложения с анимированным экраном загрузки в функцию ``create_simple_preloader`` из модуля "preloader.js" необходимо передать опцию "preloader_fadeout" со значением "true".

* *Добавлена возможность экспорта конвертированных медиаданных в HTML-файл.*

    Теперь при экспорте в html имеется возможность записать конвертированные данные в файл. Для этого при экспорте необходимо задать свойство "Export converted media" в :ref:`опциях экспорта <export_opts>`.

* *Добавлена возможность использования min50 и dds текстур при просмотре сцен через webplayer.*

    Для этого необходимо :ref:`передать атрибут <webplayer_attributes>` "compressed_textures" при запуске приложения.


Изменения
---------

* *Упрощена файловая структура SDK.*

    Директория ``external`` больше не существует, всё её содержимое перемещено на уровень выше - в кореневую директорию SDK. Файл со списком сцен для просмоторщика ``assets.json`` теперь находится в директории ``apps_dev/viewer``.

* *Изменено поведение автовращения камеры (экспериментально).*

    При наличии ограничений на горизонтальное вращение камера, приближаясь к границам, плавно замедляется и продолжает движение в обратном направлении.

* *Изменено поведение настройки ``Special: Collision`` в настройках материала.*

    Ранее включение опции автоматически приводило к сокрытию объектов, теперь для этой цели необходимо использовать настройку материала ``Do not Render``.

* *Изменен суффикс конвертированных медиаданных.*

    Суффикс ``*.lossconv.*`` заменен на ``*.altconv.*``.

* *Изменена работа опции "Do not render" на объекте.*

    Теперь выставление данной опции на объекте не приводит к потере физических свойств объекта. Объект всего лишь становится невидимым.

* *Доработана комплектация SDK.*

    В бесплатной и коммерческой версиях SDK были добавлены новые сцены с примерами использования движка; устаревшие и малоинформативные сцены исключены.

Исправления
-----------

* *При выставлении в Blender'е камере типа "Panoramic" в движке принудительно используется камера типа "Perspective".*

* *Исправлено дрожание камеры типа "Target" в отдельных случаях.*

* *Небольшие исправления в работе аддона "B4W Anim Baker".*

* *Исправлена проблема со звуком на сценах с несколькими камерами.*

* *В модуле "controls" улучшена стабильность работы сенсоров типа "Timer".*

* *Устранена ошибка, возникающая при просмотре сцены через IE при экспорте в HTML.*

* *Оптимизирована работа видеотекстуры. Теперь не производится обновление видеотекстуры при остановке видео.*

* *Исправлена ошибка рендеринга нодового материала, содержащего ноду ``REFRACTION``.*


Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender.*

    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

* *Не работают видеотекстуры в Firefox при экспорте сцены в формате HTML.*

* *Текущая реализация depth-текстур в Firefox 35 приводит к значительному снижению FPS и другим неисправностям.*
    
    В различных сценах наблюдается снижение FPS, например, при включении теней. Также некорректно отображаются тени для текстур с использованием прозрачности, например, ``ALPHA_CLIP``. Соответствующая `ошибка <https://bugzilla.mozilla.org/show_bug.cgi?id=1125445>`_, 
    возможно, будет исправлена в ближайшее время в будущих обновлениях браузера.


v14.12
======

Новый функционал
----------------

* *Поддержка настройки скоростей камеры.*

    Осуществлена поддержка пользовательской :ref:`настройки скоростей 
    <camera_velocity>` перемещения, вращения, масштабирования камер типа ``Target``, 
    ``Hover``, ``Eye``. Настройка может быть выполнена как в интерфейсе Blender'а, так и посредством API Blend4Web.

* *Поддержка MIP-текстурирования для Canvas-текстур.*

    Осуществлена поддержка MIP-текстурирования для :ref:`Canvas-текстур <render_to_texture_canvas>`.


* *Полная поддержка ноды "MAPPING".*

    Осуществлена поддержка всех возможных значений ``Vector type`` для ноды ``MAPPING``: ``Texture``, ``Point``, ``Vector`` и ``Normal``.

* *Glow-эффект при наведении курсора мыши на объект.*

    Для эффекта подсветки объекта под курсором мыши доступно API модуля ``mouse.js``. Управление эффектом осуществляется с помощью функций ``enable_mouse_hover_glow()`` и ``disable_mouse_hover_glow()``. При этом на объекте должно быть выставлено свойство ``Object > Blend4Web > Selectable``.

* *Новая система сборки приложений.*

    Теперь пользователи имеют возможность вести разработку приложений непосредственно в составе SDK, благодаря новой утилите ``project.py``. :ref:`Данный скрипт <app_building>` позволяет собирать приложения вместе с движком, минимизировать JavaScript и CSS-файлы, а также экспортировать готовое приложение для последующего развертывания на сервере.

Изменения
---------

* *Удалена поддержка устаревшей опции текстур "UV translation velocity".*

    Вместо неё рекомендуется использовать функционал нодовых материалов.

* *Удалена поддержка устаревшего интерфейса "Levels of Detail".*

    Аналогичный функционал теперь реализуется штатным инструментом Blender
    "Levels of Detail".

* *Аддон pointerlock.js переименован в mouse.js.*

* *Добавлено срабатывание события mouseup при покидании курсора мыши вьюпорта приложения.*

    Таким образом была исправлена наблюдавшаяся ранее проблема с нарушением контроля камеры.

* *Сообщение об ошибке "Clear parent inverse" более не появляется.* 

    Ранее при использовании отношения родитель-потомок требовалось сбрасывать перемещение, вращение и масштаб 
    объекта-потомка (``Object > Parent > Clear Parent Inverse``). Указанная трансформация теперь поддерживается движком.

* *Использование "Apply scale" теперь не приводит к применению модификаторов.*

    Для применения модификаторов по-прежнему следует использовать флаг :ref:`Apply modifiers <apply_modifiers>`.

* *Использование карты нормалей в нодовом материале больше не требует наличия нод Material или Extended Material.*
    
    В некоторых случаях (например, рефракция) карты нормалей могут применяться в материалах без освещения. 

Исправления
-----------

* *Исправлена ошибка воспроизведения звуков через инструмент NLA.*

    Ошибка проявлялась вследствие недостаточной точности чисел с плавающей
    запятой.

* *Исправлен некорректный рендеринг источников света на мобильных устройствах.*

* *Исправлено наложение тени при нескольких активных источниках освещения.*

    Теперь тень накладывается так же как в Blender, не затеняя те участки, куда попадает
    свет от других источников.

* *Исправлена ошибка отображения нодовых материалов.*

    Ошибка возникала при использовании нод ``MATERIAL`` и ``MATERIAL_EXT`` с добавленным по ссылке (из 
    другого .blend-файла) материалом.

* *Исправлен сброс позы арматуры при использовании "B4W Animation Bake".*

    Теперь при использовании инструмента :ref:`запекания анимации <animation_bake>`
    арматурный объект остаётся в позе, в которой он находился до запекания.

* *Исправлено резкое движение камеры после старта приложения.*

* *Исправлена ошибка, связанная с неверным определением лимитов горизонтального вращения камеры.*

* *Исправлена ошибка, связанная с экспортом неиспользуемых текстур.*

Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender.*

    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

* *Не работают видеотекстуры в Firefox при экспорте сцены в формате HTML.*


v14.11
======

Новый функционал
----------------

* *Поддержка видео-текстур.*

    Осуществлена поддержка :ref:`видео-текстур <video_texture>` для текстур типа ``Image or Movie``.

* *Частота кадров.*

    Добавлена поддержка изменения частоты кадров для анимации и видеотекстур. Частоту кадров можно задать опцией ``Scene > Dimensions > Frame rate``.

* *Поддержка текстур типа Canvas.*

    В качестве :ref:`текстуры <render_to_texture_canvas>` используется HTML-элемент Canvas. Работа с ней :ref:`описана <canvas_texture>` в документации.

* *Сamera panning.*

    В режиме вращающейся вокруг точки камеры (``Target``) теперь имеется возможность перемещения точки вращения в плоскости обзора (т.н. панорамирование) при зажатой правой или средней кнопках мыши. Функция включена по умолчанию и при необходимости выключается в настройках в Blender'е.

* *Новый режим управления камерой - Hover.*

    Реализован режим скольжения камеры над плоскостью (``Hover``), включающий возможность приближения и удаления. Этот режим камеры позволяет реализовывать сценарии удобного просмотра протяженных в двух измерениях сцен (помещений, игровых уровней).

* *В SDK добавлена корневая веб-страница index.html для упрощения навигации по
  дистрибутиву.*

* *Поддержка преобразования форматов видео-файлов в конвертере ресурсов.*

* *Добавлена система сборки, ранее отсутствовавшая в публичных дистрибутивах SDK.*

* *Поддержка режима экспорта "Strict mode" в аддоне.*

    Активация режима ``Strict mode`` позволяет вывести все возможные ошибки и
    предупреждения, связанные с некорректной настройкой сцены. Опция полезна для
    финальной отладки сцены с целью получения максимально корректных и
    оптимизированных ресурсных файлов.

* *Поддержка воспроизведения звуков на устройствах с iOS.*


Изменения
---------

* *Опция "bg" веб-плеера переименована в "fallback_image".*

    Также притерпела изменение логика поведения опции. При указании
    ``fallback_image`` информация об отсутствии поддержки WebGL теперь не
    выводится, вместо неё пользователю демонстрируется изображение.

* *В веб-плеере опция отключения звука теперь не показывается для сцен, не имеющих источников звука.*

* *Улучшена стабильность работы стековых материалов.*

* *В сенсор "mouse_down" добавлен код нажатой кнопки мыши, который доступен в поле payload сенсора.*

* *Значительно оптимизирован экспорт систем частиц типа Hair.*

Исправления
-----------

* *Карты нормалей теперь работают с типами текстурных координат Generated и Normal.*

    При использовании карт нормалей теперь нет необходимости использовать UV-развертку.

* *Исправлена проблема с неверными путями к физическому движку в веб-плеере.*

    Ошибка проявлялась при перемещении файла uranium.js из директории с главным
    HTML-файлом веб-плеера.

* *В аддоне исправлена проблема с упакованными текстурами, проявляющаяся при
  экспорте при включённой опции "Automatically Pack Into .blend".*

Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender.*

    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

v14.10
======

Новый функционал
----------------

* *Новый веб-плеер.*

    Новый минималистичный дизайн веб-плеера удачно сочетается с любыми трёхмерными
    сценами, имеет упрощённый интерфейс и встроенную подсказку по управлению.
    Веб-плеер работает на всём спектре оборудования, включая мобильные устройства.

* *Улучшение системы теней.*

    Добавлена возможность выбора некаскадной модели теней на основе одной
    оптимизированной карты теней. Такая модель проще в настройке и хорошо
    подходит для небольших сцен. Подробности в :ref:`документации <shadows>`.

* *Многочисленные улучшения в системе нелинейной анимации (NLA).*

    Появилась возможность создания сложной логики в инструменте NLA Script
    с помощью блоков ``Conditional Jump``, ``Register Store`` и ``Math
    Operation``, а также переменных, сохраняемых в регистрах.

    Возможность использования в NLA всех типов анимации, поддерживаемых движком,
    включая воспроизведение звуков, вертексную анимацию и эмиссию частиц.
    Анимацию различных типов теперь возможно проигрывать параллельно.

* *Поддержка биллбординга объектов.*

    Объектам добавлены :ref:`опции <objects_billboarding_properties>`, позволяющие настроить биллбординг.

* *Поддержка режима "XYZ Euler" для анимации поворота.*

    Объектная и скелетная анимация теперь поддерживают режим ``XYZ Euler`` для анимации поворота.

* *Поддержка текстурных координат типа GENERATED.*

* *Добавлена поддержка загрузки ресурсов с удаленного сервера (Cross-origin resource sharing).*

* *Упрощен процесс экспорта сцен.*

    Ряд ошибок, возникающих при экспорте материала, теперь не блокирует экспорт.
    Вместо этого при загрузке сцены данный материал будет
    отображаться розовым цветом. Более подробное описание ошибок доступно в
    :ref:`документации <export_errors_warnings>`.

* *Добавлена поддержка опции "Do not export" для системы частиц.*

* *Улучшена стабильность работы приложений на устройствах с мобильной
  операционной системой Apple iOS.*


Изменения
---------

* *В SDK изменился путь для настройки экспорта в HTML.*

    В настройках аддона, установленного через SDK, теперь достаточно указывать
    путь непосредственно к корневой директории SDK. Ранее требовалось указывать
    путь к приложению embed. Обратите внимание, старое поведение более не
    поддерживается.

* *Объявлена устаревшей опция текстур "UV translation velocity".*

    Опция будет удалена начиная с версии 14.12.

* *Удалена опция "Do not export" на панели "Object data".*

* *Опция Blend4Web>Animation>Cyclic на вкладке свойств объектов удалена.*

    Вместо неё следует использовать опцию ``Blend4Web > Animation >
    Behavior``, расположенную там же. В сценах, где циклическая анимация
    назначается по умолчанию, возможно нарушение работы анимации, соответственно
    в них необходимо установить поведение в ``Cyclic``.

* *Изменена реализация алгоритма SSAO.*

    Новая реализация работает значительно быстрее и показывает лучшее качество изображения.
    Параметры настройки алгоритма также изменились. Подробнее в :ref:`документации <ssao>`.

Исправления
-----------

* *Исправлена ошибка рендеринга материала типа HALO.*

* *Исправлена ошибка рендеринга объекта при выставлении опции "Force Dynamic Object", если он имел родительский объект.*

* *Исправлена ошибка назначения горячих клавиш на экспорт аддона Blend4Web.*

    Устранена ошибка, не позволяющая назначить горячие клавиши на экспорт в форматы JSON и HTML:
    ``File->Export->Blend4Web(.json)`` и ``File->Export->Blend4Web(.html)``.

* *Исправлена ошибка загрузки текстур, превышающих допустимый размер для данного устройства.*

* *Исправлены ошибки анимации нодовых материалов, приводившие к нестабильной работе движка.*

* *Устранена ошибка нодовых материалов, содержащих сложные группы нод (Node
  Groups).*

* *Исправлены ошибки компиляции шейдеров на устройствах с мобильной графикой
  Qualcomm Adreno 305.*

* *Исправлена ошибка рендеринга при использовании ноды REFRACTION на непрозрачных материалах.*

* *Исправлен сброс значения текущего кадра анимации после её запечения при
  помощи инструмента "B4W Vertex Anim Baker".*

Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender.*

    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

* *Карты нормалей не работают с типом текстурных координат Generated.*

    При использовании карт нормалей необходимо использовать UV-развертку.

v14.09
======

Новый функционал
----------------

* *Поддержка типа ABSOLUTE для ноды MATH.*

* *Поддержка специализированной ноды LEVELS_OF_QUALITY.*

    Позволяет управлять сложностью материала в зависимости от профиля качества,
    указанного пользователем при загрузке движка.

* *Поддержка специализированной ноды SMOOTHSTEP.*

    Упрощает создание некоторых эффектов в нодовом материале.

* *Поддержка нодовых групп.*

    `Нодовые группы <http://wiki.blender.org/index.php/Doc:2.6/Manual/Composite_Nodes/Node_Groups>`_ позволяют повторное использования блока нод одного материала в составе другого.

* *Возможность вывода промежуточных результатов рендеринга с целью отладки.*

    Результат рендеринга конкретной стадии теперь можно вывести поверх основного изображения. Настройка осуществляется в модуле ``config.js`` опциями группы ``debug_subs``.

* *Реализация логики управления NLA-анимацией в Blender с помощью визуального редактора.*

    В интерфейс Blender добавлен инструмент NLA Script, который позволяет с
    помощью визуальных блоков реализовывать простые сценарии, например
    осуществить управление текущей анимацией в ответ на действия пользователя.

* *Многочисленные улучшения системы сенсоров.*

    В модуле ``controls`` разрешено регистрировать *множества сенсоров*
    глобально, без привязки к конкретному объекту, для чего в соответствующие
    API необходимо подавать параметр ``null``. Обеспечена более предсказуемая и
    надёжная обработка логики сенсоров, в соответствии с последовательностью
    создания их *множеств*. Обработчики событий, связанных с действиями
    пользователя теперь назначаются с помощью функций вида
    ``register_<inputtype>_events()``. В данные функции теперь можно подавать
    флаг ``prevent_default``, позволяющий заблокировать стандартное поведение
    браузера, происходящее после возникновения соответствующих событий.

* *Поддержка использования физики в веб-плеере.*

    Работает только в версии веб-плеера с раздельной загрузкой JSON-файлов. В
    одиночных HTML файлах физика не поддерживается.

* *Поддержка смешивания различных скелетных анимаций.*

    В модуле ``animation.js`` добавились API, позволяющие осуществлять плавные
    переходы между скелетными анимациями: get_skel_mix_factor() - для получения
    текущего значения коэффициента смешинвания и set_skel_mix_factor() - для его
    назначения.

* *Поддержка анимации ноды Value в нодовых материалах.*

    Функциональность работает аналогично другим видам анимации. Поддерживается работа в NLA.

* *Поддержка параметров Specular и Diffuse в источниках освещения.*

* *Возможность рендеринга полупрозрачного объекта поверх остальных объектов на сцене.*

    Активируется с помощью опции ``Render above all`` для прозрачных материалов (т.е. не ``Opaque``).

* *Автоматическое применение масштаба к мешу объекта.*

    Реализуется включением опции ``Apply scale`` в настройках объекта.

* *Поддержка профиля высокого качества (включая тени, динамическое отражение и антиалиасинг) для iOS.*


Изменения
---------

* *Улучшение рендеринга теней.*

    Существенно изменена система отрисовки теней, которая теперь основывается на технике ``Stable Cascaded Shadow Maps``. Техника позволяет существенно уменьшить мерцание краев теней при движении камеры. Между каскадами реализовано сглаживание. Также тени последнего каскада плавно исчезают при удалении. Для рендеринга мягких теней реализована техника ``Percentage Closer Shadows``. Переработана и упрощена система пользовательских настроек теней. Теперь можно задавать размеры карт теней, степень размытия, настройки для компенсации ошибок самозатенения. Новые настройки подробно :ref:`документированы <shadows>`.

* *Настройка качества графики в веб-плеере теперь сохраняется для каждой сцены независимо.*

* *Изменено поведение настроек конфигурации приложения: physics_uranium_path, smaa_search_texture_path и smaa_area_texture_path.*

    Данные настройки конфигурации теперь рассчитываются автоматически в зависимости от местоположения запускаемого HTML-файла, если они не были переопределены при инициализации приложения.

* *Завершён переход на систему модулей, подключаемых через вызов b4w.require().*

    Это также означает, что начиная с текущей версии в релиз-версии движка
    модули нельзя вызывать с помощью устаревшего интерфейса ``b4w.<module>``.
    С целью совместимости создан аддон ``ns_compat.js``, подключение которого
    позволяет восстановить старое поведение.

* *Добавлена возможность сокрытия панели управления в веб-плеере.*

* *Скелетная анимация применяется только к объекту арматуры.*

    Нет необходимости применять скелетную анимацию к объектам типа ``MESH``.
    Eсли они привязаны к какой-либо анимированной арматуре, скиннинг будет происходить автоматически.

* *Демонстрационные приложения и обучающие материалы приведены в соответствие с новым функционалом.*

Исправления
-----------

* *Индикатор загрузки не скрывался, если в процессе происходила ошибка загрузки ресурса (текстуры либо звукового файла).*

* *Исправлены лаги при масштабировании и повороте на touch-устройствах.*

* *Устранено дрожание камеры типа TARGET при небольших поворотах.*

* *Исправлено управление камерой типа EYE на мобильных устройствах.*

* *Улучшено управление в приложении Ферма в браузере Safari.*

* *Исправлены ошибки при использовании неподдерживаемых моделей освещения на нодовых материалах.*

* *Для объектов без материалов теперь работает опция "Selectable".*

* *Более нет необходимости включать "Force Dynamic Object" для объектов, анимирующихся с использованием NLA.*

* *Исправлена ошибка для систем частиц, в которых дуплицируемый объект входит в иерархию с другими объектами.*

Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender.*

    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

* *Смешивание скелетной анимации не работает в некоторых браузерах.*

    Если при использовании API смешивания скелетной анимации возникают необработанные ошибки, следует переопределить стандартную функцию Math.sign следующим образом:

    .. code-block:: javascript

        var m_util  = require("util");
        Math.sign = m_util.sign;
