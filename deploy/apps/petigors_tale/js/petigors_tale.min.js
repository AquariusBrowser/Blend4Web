if(b4w.module_check("game_config"))throw"Failed to register module: game_config";
b4w.register("game_config",function(a,b){a.DEFAULT_POS=new Float32Array([0,-4,0]);a.LEVEL_LOAD_DELAY=1.5;a.GEM_OFFSET=new Float32Array([0,1,0]);a.GEM_ROT_OFFSET=new Float32Array([0,0,0,1]);a.GEM_SCALE_OFFSET=.6;a.GM_SPARE=0;a.GM_CARRIED=1;a.GM_LAYING=2;a.SHUTTER_EMITTER_EMPTY="shutter_glass";a.SHUTTER_EMITTER_NAME="glass_shutter_emitter";a.CL_BLUE=0;a.CL_PURPLE=1;a.CL_RED=2;a.CL_GREEN=3;a.CL_YELLOW=4;a.CL_MULTI=5;a.CHAR_EMPTY="petigor";a.CHAR_ARMAT="petigor_armature";a.CHAR_MODEL="petigor_model";
a.CHAR_PICKER="petigor_picker";a.CHAR_LIGHT="sword_light";a.CHAR_SPHERE="lava_shield_prot";a.CHAR_SWORD_SWITCHER="flaming_sword_switcher";a.MOUSE_ROT_MULT=2;a.TOUCH_ROT_MULT=.01;a.CAM_SOFTNESS=.2;a.CAM_OFFSET=new Float32Array([0,8,-15]);a.CHAR_RAY_LENGTH=1.2;a.MAX_CHAR_HP=100;a.CHAR_ATTACK_DIST=2;a.CHAR_ATTACK_STR=35;a.CHAR_ATTACK_ANIM_FRAME=12;a.CH_STILL=0;a.CH_RUN=1;a.CH_ATTACK=2;a.CH_JUMP=3;a.CH_VICTORY=4;a.LAVA_DAMAGE_INTERVAL=.02;a.BONUS_SPAWN_CHANCE=.5;a.BONUS_HP_INCR=30;a.BONUS_SHIELD_TIME=
10;a.BONUS_SHIELD_EFFECT=.33;a.BONUS_LAVA_PROT_TIME=15;a.BONUS_LIFETIME=15;a.BONUS_FLASH_SPEED=3;a.BTYPE_HP=0;a.BTYPE_LAVA=1;a.BTYPE_SHIELD=2;a.CHAR_IDLE_ANIM="petigor_idle_combat";a.CHAR_RUN_ANIM="petigor_run";a.CHAR_STRAFE="petigor_strafe";a.CHAR_JUMP_ANIM="petigor_jump";a.CHAR_DEATH_ANIMS=["petigor_death_01","petigor_death_02"];a.CHAR_ATTACK_ANIMS=["petigor_atack_01","petigor_atack_02","petigor_atack_03"];a.CHAR_VICTORY_ANIM="petigor_victory";a.CHAR_HEAL_PICK_ANIM="heal_pick";a.CHAR_LAVA_PROT_ANIM=
"lava_prot_pick";a.CHAR_SHIELD_PICK_ANIM="shield_pick";a.SHIELD_FLASH_LENGTH=.9;a.LAVA_FALL_LENGTH=1;a.GOLEM_SPEED=.8;a.GOLEM_ROT_SPEED=1;a.GOLEM_ATTACK_DIST=2;a.GOLEM_ATTACK_STRENGTH=20;a.GOLEM_ATTACK_ANIM_FRAME=30;a.GOLEMS_SPAWN_INTERVAL=3;a.GOLEM_HP=100;a.GS_WALKING=0;a.GS_ATTACKING=1;a.GS_GETTING_OUT=2;a.GS_NONE=3;a.EN_TYPE_GOLEM_LAVA=0;a.EN_TYPE_GOLEM_STONE=1;a.GT_POINT=0;a.GT_CHAR=1;a.GT_OBELISK=2;a.GOLEM_LAVA_DEATH_EMPTY=["golem_lava_death"];a.GOLEM_DEATH_RIG=["golem_death_armature"];a.GOLEM_DEATH_BLOW=
["golem_death_blow"];a.STONE_GOLEM_EMITTER_EMPTY="golem_stone_getout";a.STONE_GOLEM_EMITTER=["golem_stone_getout","golem_stone_getout_emitter"];a.HP_BONUSES_EMPTIES=["potion_hp","potion_hp.001","potion_hp.002"];a.SHIELD_BONUSES_EMPTIES=["potion_def"];a.LAVA_BONUSES_EMPTIES=["potion_lava"];a.CHAR_RUN_SPEAKER="speaker_petigor_run";a.CHAR_ATTACK_SPEAKER="speaker_petigor_sword_miss";a.CHAR_ATTACK_VOICE_SPKS=["speaker_petigor_voice_atack_01","speaker_petigor_voice_atack_02","speaker_petigor_voice_atack_03"];
a.CHAR_HURT_SPKS=["speaker_petigor_voice_hurt_01","speaker_petigor_voice_hurt_02"];a.CHAR_JUMP_SPKS=["speaker_petigor_voice_jump_01","speaker_petigor_voice_jump_02"];a.CHAR_SWORD_SPEAKER="speaker_petigor_sword_hit";a.CHAR_DEATH_SPEAKER="speaker_petigor_voice_death_01";a.CHAR_LANDING_SPEAKER="speaker_petigor_jump_ends";a.GEM_PICKUP_SPEAKER="speaker_petigor_gem_pickup";a.GEM_MOUNT_SPEAKER="speaker_petigor_gem_mount";a.CHAR_HEAL_SPEAKER="speaker_petigor_bonus_heal";a.CHAR_LAVA_SPEAKER="speaker_petigor_bonus_lava";
a.CHAR_SHIELD_SPEAKER="speaker_petigor_bonus_shield";a.GOLEM_WALK_SPEAKER="golem_walk";a.GOLEM_ATTACK_SPEAKER="golem_atack_miss";a.GOLEM_HIT_SPEAKER="golem_atack_hit";a.GOLEM_GETOUT_SPEAKER="golem_getout";a.GEM_DESTR_SPEAKER="gem_destroy";a.WIN_SPEAKER="final_win"});if(b4w.module_check("obelisks"))throw"Failed to register module: obelisks";
b4w.register("obelisks",function(a,b){function C(a){switch(a){case "BG":return k.CL_BLUE;case "RG":return k.CL_RED;case "GG":return k.CL_GREEN;case "YG":return k.CL_YELLOW;case "PG":return k.CL_PURPLE}}function v(){for(var a=0;a<h.NUM_OBELISKS;a++){var c=h.ISLES_SHIELD_DUPLI_NAME_LIST;c[2]="island_shield_"+a;c=u.get_object_by_dupli_name_list(c);z.stop(c);z.set_behavior(c,z.AB_FINISH_STOP)}}function p(a,c){var b="obelisk_"+a,l=x[a];if(0<c){var d=h.OBELISKS_GEMS_NAME[a]+"_0"+(l.num_gems+1),b=u.get_object_by_dupli_name(b,
d);u.show_object(b);q.play_def(g);l.gem_health=h.OBELISK_GEM_HEALTH}else if(0>c){d=h.OBELISKS_GEMS_NAME[a]+"_0"+l.num_gems;b=u.get_object_by_dupli_name(b,d);u.hide_object(b);var d=L,f=K;y.get_translation(b,d);y.get_rotation(b,f);m(d,f)}l.num_gems+=c;F(a)}function F(a){if(r(a)&&("volcano"!=h.LEVEL_NAME||!f.island_has_enemies(a))){var c=x[a];if(h.ISLES_SHIELD_DUPLI_NAME_LIST){var b=h.ISLES_SHIELD_DUPLI_NAME_LIST;b[2]="island_shield_"+a;b=u.get_object_by_dupli_name_list(b);z.play(b);a=u.get_object_by_dupli_name("obelisk_"+
a,h.ISLAND_SPEAKER);q.play_def(a)}c.shine_obj&&(z.set_behavior(c.shine_obj,z.AB_FINISH_STOP),z.play(c.shine_obj));a:{for(c=0;c<h.NUM_OBELISKS;c++)if(!r(c)){c=!1;break a}c=!0}c&&n()}}function m(c,a){var b=u.get_object_by_dupli_name(k.SHUTTER_EMITTER_EMPTY,k.SHUTTER_EMITTER_NAME);y.set_translation_v(b,c);y.set_rotation_v(b,a);u.show_object(b);z.play(b,function(){u.hide_object(b)});var g=u.get_object_by_dupli_name(k.SHUTTER_EMITTER_EMPTY,k.GEM_DESTR_SPEAKER);q.play_def(g)}function n(){var c=u.get_object_by_name(k.WIN_SPEAKER);
q.play_def(c);c=t.get_wrapper();z.apply(c.rig,k.CHAR_VICTORY_ANIM);z.set_behavior(c.rig,z.AB_CYCLIC);z.play(c.rig);c.state=k.CH_VICTORY;t.disable_controls();q.clear_playlist();l.show_victory_element(1);if("volcano"==h.LEVEL_NAME){var a=u.get_object_by_name(h.STAIRS_OBJ,h.STAIRS_OBJ),c=u.get_object_by_dupli_name(h.STAIRS_OBJ,h.STAIRS_EMITTER),b=u.get_object_by_dupli_name_list(h.ISLANDS_DOOR);u.show_object(c);z.apply(c,"dust");z.play(c);setTimeout(function(){u.show_object(a);u.hide_object(b)},1E3)}else"dungeon"==
h.LEVEL_NAME&&(c=u.get_object_by_dupli_name("lava_death_controller","lava_death_controller"),z.set_behavior(c,z.AB_FINISH_STOP),z.play(c));t.run_camera_victory_rotation()}function r(c){return x[c].num_gems==h.OBELISK_NUM_GEMS}function A(){for(var a=0;a<h.NUM_OBELISKS;a++){x[a].num_gems=0;for(var b=1;b<=h.OBELISK_NUM_GEMS;b++){var g=u.get_object_by_dupli_name("obelisk_"+a,h.OBELISKS_GEMS_NAME[a]+"_0"+b);g&&u.hide_object(g)}switch(h.LEVEL_NAME){case "volcano":b=h.ISLES_SHIELD_DUPLI_NAME_LIST;b[2]="island_shield_"+
a;b=u.get_object_by_dupli_name_list(b);z.set_frame(b,0);b=u.get_object_by_name(h.STAIRS_OBJ);g=u.get_object_by_dupli_name_list(h.ISLANDS_DOOR);u.show_object(g);u.hide_object(b);break;case "dungeon":b=u.get_object_by_dupli_name("level_02_enviroment",h.FLOOR_MAGIC_NAME),c.set_nodemat_value(b,["floor_magic_0"+(a+1),"Value"],0)}}}function B(c){for(var a=0;a<h.NUM_OBELISKS;a++)if(x[a].color==c)return a;return-1}var D=b("controls"),u=b("scenes"),z=b("animation"),q=b("sfx"),y=b("transform"),c=b("objects");
b("constraints");var k=b("game_config"),t=b("character"),f=b("enemies");b("environment");var l=b("interface"),h=null,g=null,L=new Float32Array(3),K=new Float32Array(4),x=[];a.init=function(a,b){h=b;var l=t.get_wrapper(),f=function(c,a,b){1==b&&l.gem_slot&&c.num_gems!=h.OBELISK_NUM_GEMS&&(a=l.gem_slot.color,a==c.color||a==k.CL_MULTI)&&(t.remove_gem(),c=B(c.color),p(c,1))};h.ISLES_SHIELD_DUPLI_NAME_LIST&&v();if(h.FLOOR_MAGIC_NAME)var d=u.get_object_by_dupli_name("level_02_enviroment",h.FLOOR_MAGIC_NAME),
q=function(a,b,g,l){g=l.num_gems/h.OBELISK_NUM_GEMS;var f=l.magic_val;a=D.get_sensor_value(a,b,0);f!=g&&(f<g?l.magic_val+=.25*a:f>g&&(l.magic_val-=.25*a),c.set_nodemat_value(d,["floor_magic_0"+(l.id+1),"Value"],l.magic_val))};for(var m=0;m<h.NUM_OBELISKS;m++){var n="obelisk_"+m,y=u.get_object_by_dupli_name(n,"obelisk_collision"),L=h.OBELISKS_GEMS_NAME[m],K={num_gems:0,gem_health:0,color:C(L),id:m,magic_val:0,shine_obj:null},y=D.create_collision_sensor(y,"CHARACTER");D.create_sensor_manifold(K,"FILL_OBELISK_"+
L,D.CT_TRIGGER,[y],null,f);h.FLOOR_MAGIC_NAME&&(c.set_nodemat_value(d,["floor_magic_0"+(m+1),"Value"],0),D.create_sensor_manifold(d,"FLOOR_MAGIC"+m,D.CT_CONTINUOUS,[a],null,q,K));h.OBELISK_SHINE&&(n=u.get_object_by_dupli_name(n,h.OBELISK_SHINE+"_0"+(m+1)),K.shine_obj=n,z.apply_def(n));x.push(K)}g=u.get_object_by_dupli_name(k.CHAR_EMPTY,k.GEM_MOUNT_SPEAKER);A()};a.try_to_capture=F;a.is_filled=r;a.num_gems=function(a){return x[a].num_gems};a.damage_obelisk=function(a){--x[a].gem_health||(x[a].gem_health=
h.OBELISK_GEM_HEALTH,p(a,-1))};a.reset=A;a.get_id_by_color=B});if(b4w.module_check("gems"))throw"Failed to register module: gems";
b4w.register("gems",function(a,b){function C(a){if(a.state!=n.GM_SPARE)return!1;if(a.color==n.CL_MULTI)return!0;a=r.get_id_by_color(a.color);return!r.is_filled(a)}var v=b("controls"),p=b("scenes");b("animation");b("sfx");var F=b("transform");b("util");var m=b("constraints");b("vec3");var n=b("game_config"),r=b("obelisks"),A=b("character"),B=[],D=null;a.init=function(a){D=a;a=function(a,c,b,h){1==b&&A.add_gem(h)};for(var b=0;b<D.GEMS_EMPTIES.length;b++){var q=D.GEMS_EMPTIES[b],m=D.GEMS_NAMES[b],c=
p.get_object_by_name(q),q=p.get_object_by_dupli_name(q,m);if(c&&q){switch(p.get_object_name(q)){case "gem_B":var k=n.CL_BLUE;break;case "gem_R":k=n.CL_RED;break;case "gem_G":k=n.CL_GREEN;break;case "gem_Y":k=n.CL_YELLOW;break;case "gem_P":k=n.CL_PURPLE;break;case "gem_M":k=n.CL_MULTI}c={empty:c,color:k,state:n.GM_SPARE};B.push(c);m=v.create_collision_sensor(q,"CHARACTER");v.create_sensor_manifold(q,"PICK_GEM",v.CT_TRIGGER,[m],null,a,c)}}};a.spawn=function(a){for(var b=0,q=0;q<B.length;q++)C(B[q])&&
b++;if(b)for(b=Math.floor(b*Math.random()),q=0;q<B.length;q++){var m=B[q];if(C(m)&&0==b--){F.set_translation_v(m.empty,a);m.state=n.GM_LAYING;break}}};a.reset=function(){for(var a=0;a<B.length;a++){var b=B[a],q=b.empty;m.remove(q);F.set_translation_v(q,n.DEFAULT_POS);b.state=n.GM_SPARE}}});if(b4w.module_check("interface"))throw"Failed to register module: interface";
b4w.register("interface",function(a,b){function C(a,b){function n(k,f,l){k=c-r.get_timeline();0>k?m.remove_sensor_manifold(null,"SHOW_"+a.id):a.style.opacity=1-k/b}a.style.visibility="visible";if(b){a.style.opacity=0;var c=r.get_timeline()+b;if(!m.check_sensor_manifold(null,"SHOW_"+a.id)){var k=m.create_elapsed_sensor();m.create_sensor_manifold(null,"SHOW_"+a.id,m.CT_CONTINUOUS,[k],null,n)}}else a.style.opacity=1}function v(a,b){function n(f,l,h){f=k-r.get_timeline();0>f?(a.style.visibility="hidden",
m.remove_sensor_manifold(null,"HIDE_"+a.id)):a.style.opacity=f/b*c}if(b){var c=a.style.opacity,k=r.get_timeline()+b;if(!m.check_sensor_manifold(null,"HIDE_"+a.id)){var t=m.create_elapsed_sensor();m.create_sensor_manifold(null,"HIDE_"+a.id,m.CT_CONTINUOUS,[t],null,n)}}else a.style.opacity=0,a.style.visibility="hidden"}var p=b("character"),F=b("game_config"),m=b("controls"),n=b("main"),r=b("time"),A=b("data"),B=b("config");b("mouse");var D=b("container"),u=B.get_std_assets_path()+"petigors_tale/";a.init=
function(a,b,y,c,k,t,f){function l(){n.resume();v(d,.5);v(T);k()}function h(){C(S)}function g(){C(Q)}function L(){n.resume();A.unload();v(V);v(I);v(d);v(T);v(w);v(H);v(U);v(N);C(e);X.removeEventListener("mouseup",k);n.detect_mobile()?(document.getElementById("canvas3d").removeEventListener("touchstart",touch_start_cb),document.getElementById("control_jump").removeEventListener("touchstart",touch_jump_cb),document.getElementById("control_attack").removeEventListener("touchstart",touch_attack_cb),document.getElementById("canvas3d").removeEventListener("touchmove",
touch_move_cb),document.getElementById("canvas3d").removeEventListener("touchend",touch_end_cb),A.load(u+"intro_LQ.json",y,c,!0)):A.load(u+"intro_HQ.json",y,c,!0)}function K(){n.resume();v(d);v(T);a(b);k()}function x(){v(B);v(W);a(b);k()}function p(){"visible"!=d.style.visibility&&(n.pause(),v(B),C(d),C(T))}function r(a){a.stopPropagation();a.preventDefault();v(W);v(w);v(U);v(N);switch(t){case "level_01":f("level_02");break;case "level_02":f("under_construction")}}var B=document.getElementById("replay"),
w=document.getElementById("life_bar"),d=document.getElementById("game_menu"),G=document.getElementById("menu_resume"),J=document.getElementById("menu_help"),O=document.getElementById("menu_restart"),E=document.getElementById("menu_exit"),M=document.getElementById("menu_credits"),N=document.getElementById("control_circle"),U=document.getElementById("controls"),H=document.getElementById("game_menu_calling"),Y=document.getElementById("next_level"),W=document.getElementById("victory"),S=document.getElementById("credits_panel"),
Q=document.getElementById("help_panel"),e=document.getElementById("preloader_cont"),V=document.getElementById("back_to_menu"),I=document.getElementById("under_construct"),T=document.getElementById("canvas_shadow"),X=D.get_canvas();n.detect_mobile()?(G.addEventListener("touchstart",l,!1),J.addEventListener("touchstart",g,!1),E.addEventListener("touchstart",L,!1),M.addEventListener("touchstart",h,!1),O.addEventListener("touchstart",K,!1),B.addEventListener("touchstart",x,!1),W.addEventListener("touchstart",
x,!1),S.addEventListener("touchstart",function(){v(S)},!1),Q.addEventListener("touchstart",function(){v(Q)},!1),Y.addEventListener("touchstart",r,!1),Q.setAttribute("mobile","1"),V.addEventListener("touchstart",L,!1),H.addEventListener("touchstart",p,!1)):(G.addEventListener("click",l,!1),J.addEventListener("click",g,!1),E.addEventListener("click",L,!1),M.addEventListener("click",h,!1),O.addEventListener("click",K,!1),B.addEventListener("click",x,!1),W.addEventListener("click",x,!1),S.addEventListener("click",
function(){v(S)},!1),Q.addEventListener("click",function(){v(Q)},!1),Y.addEventListener("click",r,!1),Q.setAttribute("mobile","0"),V.addEventListener("click",L,!1),H.addEventListener("click",p,!1));"under_construction"==t?(V=document.getElementById("back_to_menu"),I=document.getElementById("under_construct"),C(V),C(I)):(C(w),n.detect_mobile()&&C(H),m.create_kb_sensor_manifold(null,"SHOW_MENU",m.CT_SHOT,m.KEY_ESC,p))};a.update_hp_bar=function(a){a=p.get_wrapper().hp;var b=document.getElementById("life_bar_green"),
m=document.getElementById("life_bar_red");document.getElementById("life_bar_mid");var c=100/F.MAX_CHAR_HP,k=Math.max(a*c,0);a=Math.min((F.MAX_CHAR_HP-a)*c,100);b.style.width=k+"%";m.style.width=a+"%"};a.setup_touch_controls=function(a,b,n,c,k,t,f){function l(g){g.preventDefault();g=g.changedTouches;for(var d=0;d<g.length;d++)g[d].identifier==u?(m.set_custom_sensor(b,0),m.set_custom_sensor(c,0),m.set_custom_sensor(n,0),m.set_custom_sensor(a,0),v(A),v(B),u=null):g[d].identifier==p?p=null:g[d].identifier==
x?(m.set_custom_sensor(k,0),x=null):g[d].identifier==r&&(m.set_custom_sensor(t,0),r=null)}var h=new Float32Array(2),g=new Float32Array(2),u,p,x,r,A=document.getElementById("control_tap"),B=document.getElementById("control_circle"),w=document.getElementById("controls"),d=A.clientWidth/2,D=B.clientWidth/2;document.getElementById("canvas3d").addEventListener("touchstart",function(a){a.preventDefault();var c=window.innerWidth;a=a.changedTouches;for(var b=0;b<a.length;b++){var l=a[b],f=l.clientX,k=l.clientY;
f>c/2?(g[0]=f,g[1]=k,p=l.identifier):(h[0]=f,h[1]=k,u=l.identifier,A.style.left=f-d+"px",A.style.top=k-d+"px",C(A),B.style.left=f-D+"px",B.style.top=k-D+"px",C(B))}},!1);document.getElementById("control_jump").addEventListener("touchstart",function(a){a.preventDefault();a=a.changedTouches;for(var c=0;c<a.length;c++){var b=a[c];m.set_custom_sensor(k,1);x=b.identifier}},!1);document.getElementById("control_attack").addEventListener("touchstart",function(a){a.preventDefault();a=a.changedTouches;for(var c=
0;c<a.length;c++){var b=a[c];m.set_custom_sensor(t,1);r=b.identifier}},!1);document.getElementById("canvas3d").addEventListener("touchmove",function(l){l.preventDefault();m.set_custom_sensor(b,0);m.set_custom_sensor(c,0);m.set_custom_sensor(n,0);m.set_custom_sensor(a,0);var k=window.innerWidth;l=l.changedTouches;for(var t=0;t<l.length;t++){var x=l[t],r=x.clientX,v=x.clientY;if(r>k/2&&x.identifier==p){var H=r-g[0],x=v-g[1];g[0]=r;g[1]=v;f(F.TOUCH_ROT_MULT*H,F.TOUCH_ROT_MULT*x)}else if(x.identifier==
u){A.style.left=r-d+"px";A.style.top=v-d+"px";H=r-h[0];x=v-h[1];r=Math.sqrt(H*H+x*x);if(16>r)break;v=H/r;x=-x/r;v>Math.cos(3*Math.PI/8)?m.set_custom_sensor(a,1):v<-Math.cos(3*Math.PI/8)&&m.set_custom_sensor(n,1);x>Math.sin(Math.PI/8)?m.set_custom_sensor(b,1):x<-Math.sin(Math.PI/8)&&m.set_custom_sensor(c,1)}}},!1);document.getElementById("canvas3d").addEventListener("touchend",l,!1);w.addEventListener("touchend",l,!1);C(w)};a.show_replay_button=function(a){var b=document.getElementById("replay");C(b,
a)};a.hide_replay_button=function(a){var b=document.getElementById("replay");v(b,a)};a.show_victory_element=function(a){var b=document.getElementById("victory");C(b,a)};a.hide_victory_element=function(a){var b=document.getElementById("victory");v(b,a)};a.show_elem=C});if(b4w.module_check("bonuses"))throw"Failed to register module: bonuses";
b4w.register("bonuses",function(a,b){function C(a){function b(a,c,g,l){if(1==g)switch(F.set_translation_v(l.empty,p.DEFAULT_POS),l.type){case p.BTYPE_HP:A.apply_hp_potion();r.play_def(D);break;case p.BTYPE_LAVA:y<=p.LAVA_FALL_LENGTH&&A.apply_lava_protect();y=p.BONUS_LAVA_PROT_TIME;r.play_def(u);break;case p.BTYPE_SHIELD:q<=p.SHIELD_FLASH_LENGTH&&A.apply_shield(),q=p.BONUS_SHIELD_TIME,r.play_def(z)}}function t(a,b,c,g){a=m.get_sensor_value(a,b,0);g.lifetime-=a;0<g.lifetime?(a=g.lifetime,4<a||(g=g.body,
a*=p.BONUS_FLASH_SPEED,.5<(1>a?a:a%Math.floor(a))?n.hide_object(g):n.show_object(g))):(F.set_translation_v(g.empty,p.DEFAULT_POS),g.is_spawned=!1)}for(var f=0;f<B.length;f++){var l=B[f],h=l.body,g=m.create_collision_sensor(h,"CHARACTER");m.create_sensor_manifold(h,"BONUS",m.CT_TRIGGER,[g],null,b,l);m.create_sensor_manifold(h,"BONUS_LIFETIME",m.CT_CONTINUOUS,[a],null,t,l)}}function v(a,b,m){for(var f=0;f<a.length;f++){var l;var h=a[f];l=b;var g=m,q=n.get_object_by_name(h),h=n.get_object_by_dupli_name(h,
g);l=q&&h?{empty:q,body:h,lifetime:p.BONUS_LIFETIME,type:l,is_spawned:!1}:null;l&&B.push(l)}}var p=b("game_config"),F=b("transform"),m=b("controls"),n=b("scenes"),r=b("sfx"),A=b("character"),B=[],D=null,u=null,z=null,q=0,y=0;new Float32Array(3);a.init=function(a,b){D=n.get_object_by_dupli_name(p.CHAR_EMPTY,p.CHAR_HEAL_SPEAKER);u=n.get_object_by_dupli_name(p.CHAR_EMPTY,p.CHAR_LAVA_SPEAKER);z=n.get_object_by_dupli_name(p.CHAR_EMPTY,p.CHAR_SHIELD_SPEAKER);v(p.HP_BONUSES_EMPTIES,p.BTYPE_HP,"potion_HP");
v(p.LAVA_BONUSES_EMPTIES,p.BTYPE_LAVA,"potion_LAVA");v(p.SHIELD_BONUSES_EMPTIES,p.BTYPE_SHIELD,"potion_SHIELD");C(a);m.create_sensor_manifold(null,"BONUS_TIMER",m.CT_CONTINUOUS,[a],null,function(a,b){var c=m.get_sensor_value(a,b,0);0<q&&(q-c<p.SHIELD_FLASH_LENGTH&&A.remove_shield(),q-=c);0<y&&(y-c<p.LAVA_FALL_LENGTH&&A.remove_lava_protect(),y-=c)})};a.spawn=function(a){for(var b=Math.floor(3*Math.random()),m=0;m<B.length;m++){var f=B[m];if(!f.is_spawned&&f.type==b)return a[1]+=.05,F.set_translation_v(f.empty,
a),f.lifetime=p.BONUS_LIFETIME,f.is_spawned=!0,n.show_object(f.body),!0}return!1};a.reset=function(){function a(b){for(var c=0;c<b.length;c++){var f=n.get_object_by_name(b[c]);F.set_translation_v(f,p.DEFAULT_POS)}}a(p.HP_BONUSES_EMPTIES);a(p.SHIELD_BONUSES_EMPTIES);a(p.LAVA_BONUSES_EMPTIES)};a.set_shield_time=function(a){q=a};a.set_lava_protect_time=function(a){y=a};a.lava_protect_time_left=function(){return y};a.shield_time_left=function(){return q}});if(b4w.module_check("enemies"))throw"Failed to register module: enemies";
b4w.register("enemies",function(a,b){function C(a,b){var c=a.empty.name;a.walk_speaker=y.get_object_by_dupli_name(c,g.GOLEM_WALK_SPEAKER);a.attack_speaker=y.get_object_by_dupli_name(c,g.GOLEM_ATTACK_SPEAKER);a.hit_speaker=y.get_object_by_dupli_name(c,g.GOLEM_HIT_SPEAKER);a.getout_speaker=y.get_object_by_dupli_name(c,g.GOLEM_GETOUT_SPEAKER);switch(b){case "lava":a.type=g.EN_TYPE_GOLEM_LAVA;break;case "stone":a.type=g.EN_TYPE_GOLEM_STONE}a.death_anim="golem_death";a.walk_anim="golem_walk";a.atack_anim=
["golem_atack_01","golem_atack_02","golem_atack_03"];a.getout_anim="golem_"+b+"_getout";a.death_empty_name="golem_"+b+"_death";c=t.get_object_bounding_box(a.body);a.height=c.max_y-c.min_y}function v(a,b,d){if(0>=a.hp){b=a.empty;d=y.get_object_by_name(a.death_empty_name);var l=y.get_object_by_dupli_name(a.death_empty_name,g.GOLEM_DEATH_RIG),f=y.get_object_by_dupli_name(a.death_empty_name,g.GOLEM_DEATH_BLOW),e=G,h=E;t.get_translation(b,e);t.get_rotation(b,h);t.set_translation_v(d,e);t.set_rotation_v(d,
h);c.apply(l,a.death_anim);c.set_behavior(l,c.AB_FINISH_STOP);c.play(l);c.play(f);k.stop(a.walk_speaker);t.set_translation_v(b,g.DEFAULT_POS);R.spawn(e);"volcano"==w.LEVEL_NAME&&(b=a.island_id,a.island_id=-1,x.try_to_capture(b));a.hp=100;D(a,g.GS_NONE)}else if(L.get_wrapper().state!=g.CH_VICTORY)switch(d=q.get_sensor_value(a,b,1),a.dist_to_ground=10*d-a.height/2,a.state){case g.GS_ATTACKING:!a.attack_done&&c.get_frame(a.rig)>=g.GOLEM_ATTACK_ANIM_FRAME&&(a.last_target==g.GT_CHAR?K.check_attack(a.attack_point,
L.get_wrapper().phys_body,g.GOLEM_ATTACK_DIST)&&(b=g.GOLEM_ATTACK_STRENGTH,0<Z.shield_time_left()&&(b*=g.BONUS_SHIELD_EFFECT),L.change_hp(-b),k.play_def(a.hit_speaker)):a.last_target==g.GT_OBELISK&&(b=a.island_id,x.num_gems(b)&&x.damage_obelisk(b),k.play_def(a.hit_speaker)),a.attack_done=!0);break;case g.GS_WALKING:b=q.get_sensor_value(a,b,0),d=L.get_wrapper(),"volcano"==w.LEVEL_NAME?(l=a.island_id,d.island==l&&0<d.hp?(m(a,d.phys_body,b),a.last_target=g.GT_CHAR):x.num_gems(l)?(d=y.get_object_by_dupli_name("obelisk_"+
l,"obelisk"),m(a,d,b),a.last_target=g.GT_OBELISK):n(a,b)):"dungeon"==w.LEVEL_NAME?0<d.hp&&K.check_visibility(a,d)&&a.can_see_char?(m(a,d.phys_body,b),a.last_target=g.GT_CHAR):n(a,b):n(a,b)}}function p(a){for(var b=[],c=[],l=[],f=[],e=0;e<w.LAVA_GOLEM_SPAWN_POINTS.length;e++){var h=y.get_object_by_name(w.LAVA_GOLEM_SPAWN_POINTS[e]),I=t.get_translation(h),h=t.get_rotation(h);b.push(I);l.push(h)}if(w.STONE_GOLEM_SPAWN_POINTS)for(e=0;e<w.STONE_GOLEM_SPAWN_POINTS.length;e++)h=y.get_object_by_name(w.STONE_GOLEM_SPAWN_POINTS[e]),
I=t.get_translation(h),h=t.get_rotation(h),c.push(I),f.push(h);q.create_sensor_manifold(null,"GOLEMS_SPAWN",q.CT_CONTINUOUS,[a],null,function(a,e){var h;a:{for(h=0;h<d.length;h++){var H=d[h];if(H.state==g.GS_NONE){h=H;break a}}h=null}if(h&&(H=q.get_sensor_value(a,e,0),N-=H,0>=N)){N=g.GOLEMS_SPAWN_INTERVAL;if("volcano"==w.LEVEL_NAME){if(H=u(),null==H)return}else H=0;h.type==g.EN_TYPE_GOLEM_LAVA?F(h,H,b,l):F(h,H,c,f)}})}function F(a,b,c,d){var h=a.empty,e="volcano"==w.LEVEL_NAME?c.length/w.NUM_OBELISKS:
c.length,f=Math.floor(Math.random()*e),e=e*b+f;c=c[e];d=d[e];t.set_translation_v(h,c);t.set_rotation_v(h,d);D(a,g.GS_GETTING_OUT);k.play_def(a.getout_speaker);"volcano"==w.LEVEL_NAME?(a.island_id=b,l.copy(c,a.dest_pos)):r(a,c)}function m(a,b,d){var h=G,f=J;t.get_translation(a.empty,h);t.get_translation(b,f);f[1]=h[1];l.copy(f,a.dest_pos);b=l.distance(h,f);h=A(a,d);Math.abs(h)<Math.PI/6&&b>=g.GOLEM_ATTACK_DIST?B(a,d):Math.abs(h)<.05*Math.PI&&(d=a.empty,b=a.attack_point,h=G,f=J,c.set_speed(a.rig,2),
a.attack_done=!1,D(a,g.GS_ATTACKING),t.get_translation(d,h),l.scaleAndAdd(h,f,g.GOLEM_ATTACK_DIST,b),b[1]+=a.height/2,k.is_play(a.walk_speaker)&&k.stop(a.walk_speaker),k.play_def(a.attack_speaker))}function n(a,b){c.set_speed(a.rig,1);var d=a.dest_pos,h=G;t.get_translation(a.empty,h);var f=h[1];h[1]=d[1];d=l.distance(h,d);h[1]=f;if(!(.05<d&&a.last_target==g.GT_POINT)){if("volcano"==w.LEVEL_NAME)b:{for(var f=a.dest_pos,d=a.dest_point,e=a.island_id,m=w.GOLEM_PATROL_POINTS,I=m.length/w.NUM_OBELISKS,
k=Math.random(),n=Math.floor(I*k),q=0,k=0;k<I;k++)if(k!=d&&q++==n){e=y.get_object_by_name(m[I*e+k]);t.get_translation(e,f);f[1]=h[1];a.prev_dest=d;a.dest_point=k;break b}a.dest_point=-1}else a.last_target==g.GT_CHAR?r(a,h):(f=a.dest_pos,d=a.dest_point,e=w.GOLEM_PATROL_POINTS,m=w.GOLEM_PATROL_MAP[d],I=m.length-1,k=Math.random(),m=m[Math.floor(I*k)],e=y.get_object_by_name(e[m]),t.get_translation(e,f),f[1]=h[1],a.prev_dest=d,a.dest_point=m);a.last_target=g.GT_POINT}h=A(a,b);Math.abs(h)<Math.PI/6&&B(a,
b)}function r(a,b){for(var c=w.GOLEM_PATROL_POINTS,d=c.length,h=a.dest_pos,e=1E3,g=-1,f=0;f<d;f++){var k=y.get_object_by_name(c[f]);t.get_translation(k,J);k=l.distance(J,b);k<e&&(e=k,g=f,l.copy(J,h),h[1]=b[1])}a.dest_point=g}function A(a,b){var c=a.empty,d=a.dest_pos,k=G,e=J,m=O,I=E,n=M;t.get_translation(c,k);t.get_rotation(c,I);l.transformQuat(f.AXIS_Z,I,e);l.subtract(d,k,m);m[1]=0;l.normalize(m,m);h.rotationTo(e,m,n);h.multiply(n,I,n);d=l.dot(e,m);d=Math.acos(1<d?1:-1>d?-1:d);k=Math.abs(d)/Math.PI;
h.slerp(I,n,Math.min(b/k*g.GOLEM_ROT_SPEED,1),n);t.set_rotation_v(c,n);return d}function B(a,b){var c=G,d=J,h=E,e=a.empty,g=a.walk_speaker;t.get_rotation(e,h);t.get_translation(e,c);l.transformQuat(f.AXIS_Z,h,d);l.scaleAndAdd(c,d,a.speed*b,c);d=b/3;c[1]-=a.dist_to_ground>d?d:a.dist_to_ground<-d?-d:d;t.set_translation_v(e,c);k.is_play(g)||(k.play_def(g),k.cyclic(g,!0))}function D(a,b){var d=a.rig;switch(b){case g.GS_WALKING:c.apply(d,a.walk_anim);c.set_behavior(d,c.AB_CYCLIC);c.play(d);break;case g.GS_ATTACKING:var h=
Math.floor(a.atack_anim.length*Math.random());c.apply(d,a.atack_anim[h]);c.play(d,function(){a.state!=g.GS_NONE&&D(a,g.GS_WALKING)});break;case g.GS_GETTING_OUT:c.apply(d,a.getout_anim),c.play(d,function(){a.state!=g.GS_NONE&&D(a,g.GS_WALKING)})}a.state=b}function u(){for(var a=w.NUM_OBELISKS,b=0;b<d.length;b++)z(b)||a--;if(0==a)return null;for(var a=Math.floor(Math.random()*a),c=0,b=0;b<w.NUM_OBELISKS;b++)if(z(b)&&c++==a)return b;return null}function z(a){if(x.is_filled(a))return!1;for(var b=0;b<
d.length;b++)if(d[b].island_id==a)return!1;return!0}var q=b("controls"),y=b("scenes"),c=b("animation"),k=b("sfx"),t=b("transform"),f=b("util"),l=b("vec3"),h=b("quat"),g=b("game_config"),L=b("character"),K=b("combat"),x=b("obelisks"),Z=b("bonuses"),R=b("gems"),P=b("physics"),w=null,d=[],G=new Float32Array(3),J=new Float32Array(3),O=new Float32Array(3),E=new Float32Array(4),M=new Float32Array(4),N=0,U=new Float32Array(3);a.init=function(a,b){function c(a,b,d){b=q.get_sensor_value(a,"CHAR_RAY",0);d=
q.get_sensor_payload(a,"CHAR_RAY",0);a.can_see_char=0==b?!0:!1;b=d.ray_test_id;d=L.get_wrapper();d=t.get_translation(d.phys_body,G);a=t.get_translation(a.empty,J);P.change_ray_test_from_to(b,a,d)}w=b;N=g.GOLEMS_SPAWN_INTERVAL;for(var h=0;h<w.GOLEMS_EMPTIES.length;h++){var f=w.GOLEMS_EMPTIES[h],e=y.get_object_by_name(f),l=y.get_object_by_dupli_name(f,"golem_collider"),f=y.get_object_by_dupli_name(f,"golem_armature");l&&f&&e&&(e={body:l,rig:f,empty:e,height:0,type:g.EN_TYPE_GOLEM_LAVA,view_distance:10,
walk_speaker:null,attack_speaker:null,hit_speaker:null,getout_speaker:null,death_empty_name:null,hp:g.GOLEM_HP,speed:g.GOLEM_SPEED,island_id:-1,dest_point:-1,prev_dest:-1,dest_pos:new Float32Array(3),dist_to_ground:0,can_see_char:!1,last_target:g.GT_POINT,state:g.GS_NONE,attack_point:new Float32Array(3),attack_done:!1},f=-1!=l.name.indexOf("lava")?"lava":"stone",C(e,f),l=q.create_ray_sensor(l,U,[0,-10,0],"GROUND",!1,!1,!0),f=q.create_ray_sensor(null,U,[0,-10,0],"COMMON",!0,!1,!0),q.create_sensor_manifold(e,
"CHAR_RAY",q.CT_CONTINUOUS,[f],function(a){return!0},c),q.create_sensor_manifold(e,"GOLEM",q.CT_CONTINUOUS,[a,l],function(a){return!0},v),d.push(e),K.append_enemy(e))}p(a)};a.reset=function(){N=g.GOLEMS_SPAWN_INTERVAL;for(var a=0;a<d.length;a++){var b=d[a];b.island_id=-1;D(b,g.GS_NONE);t.set_translation_v(b.empty,g.DEFAULT_POS);k.stop(b.walk_speaker)}};a.island_has_enemies=function(a){for(var b=0;b<d.length;b++)if(d[b].island_id==a)return!0;return!1}});if(b4w.module_check("combat"))throw"Failed to register module: combat";
b4w.register("combat",function(a,b){function C(a,b,n){var u=m;v.get_translation(b,u);return p.distance(u,a)<n?!0:!1}var v=b("transform"),p=b("vec3"),F=b("game_config"),m=new Float32Array(3),n=new Float32Array(3),r=[];a.append_enemy=function(a){r.push(a)};a.process_attack_on_enemies=function(a,b){for(var m=0;m<r.length;m++){var n=r[m];if(!(0>=n.hp||n.state==F.GS_NONE)&&C(a,n.empty,b))return n.hp-=F.CHAR_ATTACK_STR,!0}return!1};a.check_attack=C;a.check_visibility=function(a,b){var r=v.get_translation(a.body,
m),u=v.get_translation(b.body,n);return p.distance(r,u)>a.view_distance?!1:!0}});if(b4w.module_check("character"))throw"Failed to register module: character";
b4w.register("character",function(a,b){function C(a){function b(){0<e.hp&&e.state!=d.CH_VICTORY&&(J.show_elem(c),J.show_elem(h),y.pause())}var c=document.getElementById("game_menu"),h=document.getElementById("canvas_shadow");a=P.get_canvas();0<e.hp&&!y.is_paused()&&e.state!=d.CH_VICTORY&&Z.request_pointerlock(a,null,b,null,null,function(a,b){V(d.MOUSE_ROT_MULT*a,d.MOUSE_ROT_MULT*b)})}function v(){M=k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_RUN_SPEAKER);N=k.get_object_by_dupli_name(d.CHAR_EMPTY,
d.CHAR_ATTACK_SPEAKER);U=k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_SWORD_SPEAKER);H=k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_LANDING_SPEAKER);Y=k.get_object_by_dupli_name(d.CHAR_EMPTY,d.GEM_PICKUP_SPEAKER);for(var a=0;a<d.CHAR_JUMP_SPKS.length;a++){var b=k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_JUMP_SPKS[a]);W.push(b)}for(a=0;a<d.CHAR_ATTACK_VOICE_SPKS.length;a++)b=k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_ATTACK_VOICE_SPKS[a]),S.push(b);for(a=0;a<d.CHAR_HURT_SPKS.length;a++)b=
k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_HURT_SPKS[a]),Q.push(b)}function p(){for(var a=0;a<d.CHAR_ATTACK_ANIMS.length;a++)I.push(d.CHAR_ATTACK_ANIMS[a]);for(a=0;a<d.CHAR_DEATH_ANIMS.length;a++)T.push(d.CHAR_DEATH_ANIMS[a])}function F(){for(var a=function(a,b,c){e.island=1==c?parseInt(b[b.length-1]):-1},b=0;b<E.NUM_OBELISKS;b++){var d=c.create_collision_sensor(e.picker,"ISLAND"+b);c.create_sensor_manifold(e.picker,"ISLE_COLL"+b,c.CT_TRIGGER,[d],null,a)}}function m(a){var b=c.create_ray_sensor(e.phys_body,
[0,0,0],[0,-d.CHAR_RAY_LENGTH,0],"GROUND",!0),h=c.create_ray_sensor(e.phys_body,[0,0,0],[0,-d.CHAR_RAY_LENGTH,0],"LAVA",!0),g=c.create_ray_sensor(e.phys_body,[0,0,0],[0,-d.CHAR_RAY_LENGTH,0],"COMMON",!0);c.create_sensor_manifold(e.phys_body,"GROUND SENS",c.CT_TRIGGER,[b,h,g],function(a){return a[0]||a[1]||a[2]},function(b,d,h){c.set_custom_sensor(a,1==h?1:0)})}function n(a,b,h,g,m){function k(a,b,h){if(e.state==d.CH_ATTACK)t.set_character_move_dir(a,0,0);else{var g=c.get_sensor_value(a,b,6);if(1==
h){switch(b){case "FORWARD":p.forw_back=1;break;case "BACKWARD":p.forw_back=-1;break;case "LEFT":p.left_right=1;break;case "RIGHT":p.left_right=-1}e.state!=d.CH_JUMP&&(e.state=d.CH_RUN)}else{switch(b){case "FORWARD":case "BACKWARD":p.forw_back=0;break;case "LEFT":case "RIGHT":p.left_right=0}e.state!=d.CH_JUMP&&(e.state=d.CH_STILL)}(p.forw_back||p.left_right)&&g?l.is_play(M)||l.play_def(M):l.is_play(M)&&l.stop(M);t.set_character_move_dir(a,p.forw_back,p.left_right)}}var n=c.create_keyboard_sensor(c.KEY_W),
I=c.create_keyboard_sensor(c.KEY_S),q=c.create_keyboard_sensor(c.KEY_UP),T=c.create_keyboard_sensor(c.KEY_DOWN),x=c.create_keyboard_sensor(c.KEY_A),r=c.create_keyboard_sensor(c.KEY_D);a=[n,q,a,I,T,b,m,x,h,r,g];var p=e.move_state;c.create_sensor_manifold(e.phys_body,"FORWARD",c.CT_CONTINUOUS,a,function(a){return a[0]||a[1]||a[2]},k);c.create_sensor_manifold(e.phys_body,"BACKWARD",c.CT_CONTINUOUS,a,function(a){return a[3]||a[4]||a[5]},k);c.create_sensor_manifold(e.phys_body,"LEFT",c.CT_CONTINUOUS,a,
function(a){return a[7]||a[8]},k);c.create_sensor_manifold(e.phys_body,"RIGHT",c.CT_CONTINUOUS,a,function(a){return a[9]||a[10]},k);c.create_sensor_manifold(e.phys_body,"CHAR_ANIM",c.CT_CONTINUOUS,[m],function(a){return!0},function(a,b,h){e.state!=d.CH_ATTACK&&(c.get_sensor_value(a,b,0),a=f.get_current_anim_name(e.rig),b=d.CHAR_IDLE_ANIM,e.state==d.CH_JUMP?b=d.CHAR_JUMP_ANIM:1==p.forw_back?b=d.CHAR_RUN_ANIM:-1==p.forw_back?(b=d.CHAR_RUN_ANIM,f.set_speed(e.rig,-1)):1==p.left_right?(b=d.CHAR_STRAFE,
f.set_speed(e.rig,-1)):-1==p.left_right&&(b=d.CHAR_STRAFE),a!=b&&(f.apply(e.rig,b),f.play(e.rig),f.set_behavior(e.rig,f.AB_CYCLIC)))});e.body&&(f.apply(e.body,d.CHAR_HEAL_PICK_ANIM),f.apply(e.body,d.CHAR_LAVA_PROT_ANIM,f.SLOT_1),f.apply(e.body,d.CHAR_SHIELD_PICK_ANIM,f.SLOT_2));l.stop(M)}function r(a,b){var h=c.create_keyboard_sensor(c.KEY_SPACE);c.create_sensor_manifold(e.phys_body,"JUMP",c.CT_TRIGGER,[h,a,b],function(a){return(a[0]||a[1])&&a[2]},function(a,b,c){1==c&&e.state!=d.CH_ATTACK&&(e.state=
d.CH_JUMP,t.character_jump(a),b=Math.floor(W.length*Math.random()),l.play_def(W[b]),f.apply(e.rig,d.CHAR_JUMP_ANIM),f.set_behavior(e.rig,f.AB_FINISH_STOP),f.play(e.rig),e.move_state.forw_back=0,e.move_state.left_right=0)});c.create_sensor_manifold(e.phys_body,"LANDING",c.CT_TRIGGER,[b],null,function(a,b,c){1==c&&(l.play_def(H),e.state!=d.CH_ATTACK&&(e.state=d.CH_STILL))})}function A(a,b){function h(a){f.apply(e.rig,d.CHAR_IDLE_ANIM);f.set_behavior(e.rig,f.AB_CYCLIC);f.play(e.rig);e.state=d.CH_STILL}
var k=c.create_mouse_click_sensor(),m=!1;c.create_sensor_manifold(e.phys_body,"ATTACK",c.CT_TRIGGER,[k,a],function(a){return a[0]||a[1]},function(a,b,c){1==c&&e.state!=d.CH_ATTACK&&(e.state=d.CH_ATTACK,e.move_state.forw_back=0,e.move_state.left_right=0,a=Math.floor(I.length*Math.random()),f.apply(e.rig,I[a]),f.set_behavior(e.rig,f.AB_FINISH_STOP),f.play(e.rig,h),t.set_character_move_dir(e.phys_body,0,0),m=!1,l.is_play(M)&&l.stop(M),l.play_def(N),a=Math.floor(S.length*Math.random()),l.play_def(S[a]))});
c.create_sensor_manifold(e.phys_body,"DAMAGE_GOLEMS",c.CT_CONTINUOUS,[b],null,function(a,b,c){if(e.state==d.CH_ATTACK&&!m&&f.get_frame(e.rig)>=d.CHAR_ATTACK_ANIM_FRAME){a=aa;b=da;c=ea;var h=ba,k=d.CHAR_ATTACK_DIST;g.get_translation(e.phys_body,a);g.get_rotation(e.phys_body,h);K.transformQuat(L.AXIS_Z,h,b);K.scaleAndAdd(a,b,k,c);G.process_attack_on_enemies(c,k)&&(l.play_def(U),f.play(e.hitsparks));m=!0}})}function B(){c.check_sensor_manifolds(e.phys_body)&&c.remove_sensor_manifold(e.phys_body);t.set_character_move_dir(e.phys_body,
0,0);l.stop(M);P.get_canvas();y.detect_mobile()||Z.exit_pointerlock()}function D(){O.set_lava_protect_time(0);w.set_nodemat_value(e.lava_shield_prot,["lava_shield_prot","lava_prot_switcher"],0)}function u(){O.set_shield_time(0);w.set_nodemat_value(e.lava_shield_prot,["lava_shield_prot","shield_switcher"],0)}function z(a){if(!(0>=e.hp)){var b=h.get_timeline();if(0>a&&X<b-.5){var c=Math.floor(Q.length*Math.random());l.play_def(Q[c]);X=b}e.hp+=a;e.hp=Math.min(e.hp,d.MAX_CHAR_HP);0>=e.hp&&(B(),E.MUSIC_SPEAKERS&&
(l.clear_playlist(),a=k.get_object_by_dupli_name("enviroment",E.MUSIC_INTRO_SPEAKER),l.stop(a),a=k.get_object_by_dupli_name("enviroment",E.MUSIC_END_SPEAKER),l.play_def(a)),a=k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_DEATH_SPEAKER),l.play_def(a),a=Math.floor(T.length*Math.random()),f.apply(e.rig,T[a]),f.set_behavior(e.rig,f.AB_FINISH_STOP),f.play(e.rig),J.show_replay_button(1),e.gem_slot&&q(),0<O.shield_time_left()&&u(),0<O.lava_protect_time_left()&&D());J.update_hp_bar()}}function q(){var a=
e.gem_slot.empty;x.remove(a);g.set_translation_v(a,d.DEFAULT_POS);g.set_scale(a,1);e.gem_slot.state=d.GM_SPARE;e.gem_slot=null}var y=b("main"),c=b("controls"),k=b("scenes"),t=b("physics"),f=b("animation"),l=b("sfx"),h=b("time"),g=b("transform"),L=b("util"),K=b("vec3"),x=b("constraints"),Z=b("mouse"),R=b("camera"),P=b("container"),w=b("objects");b("quat");var d=b("game_config"),G=b("combat"),J=b("interface"),O=b("bonuses");b("environment");var E=null,M=null,N=null,U=null,H=null,Y=null,W=[],S=[],Q=
[],e=null,V=null,I=[],T=[],X=-100,ca=new Float32Array(2),aa=new Float32Array(3),da=new Float32Array(3),ea=new Float32Array(3),ba=new Float32Array(4);a.init_wrapper=function(a,b){E=a;e={phys_body:k.get_first_character(),rig:k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_ARMAT),body:k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_MODEL),picker:k.get_object_by_dupli_name(d.CHAR_EMPTY,d.CHAR_PICKER),target:k.get_object_by_dupli_name(d.CHAR_EMPTY,"camera_target"),lava_shield_prot:k.get_object_by_dupli_name(d.CHAR_EMPTY,
d.CHAR_SPHERE),hitsparks:k.get_object_by_dupli_name(d.CHAR_EMPTY,"sword_hitsparks_emitter"),foot_smoke:k.get_object_by_dupli_name(d.CHAR_EMPTY,"foots_smoke_emitter"),hp:d.MAX_CHAR_HP,state:d.CH_STILL,move_state:{forw_back:0,left_right:0},gem_slot:null,island:-1};f.apply_def(e.hitsparks);f.set_behavior(e.hitsparks,f.AB_FINISH_RESET);w.set_nodemat_value(e.lava_shield_prot,["lava_shield_prot","lava_prot_switcher"],0);w.set_nodemat_value(e.lava_shield_prot,["lava_shield_prot","shield_switcher"],0);k.hide_object(e.foot_smoke);
"dungeon"==E.LEVEL_NAME&&w.set_nodemat_value(e.body,["petigor",d.CHAR_SWORD_SWITCHER],1)};a.setup_controls=function(a){function b(a,c){t.character_rotation_inc(e.phys_body,a,0);c&&(R.eye_rotate(w,0,c),R.get_camera_angles(w,aa),X[2]=-H*Math.cos(aa[1]),X[1]=-H*Math.sin(aa[1]),x.append_semi_stiff_cam(w,e.target,X,null,0,0,z,.01))}v();p();E&&"volcano"==E.LEVEL_NAME&&F();var h=c.create_custom_sensor(0),f=c.create_custom_sensor(0),l=c.create_custom_sensor(0),I=c.create_custom_sensor(0),q=c.create_custom_sensor(0),
T=c.create_custom_sensor(0),u=c.create_custom_sensor(0);m(u);var w=k.get_active_camera(),X=new Float32Array(d.CAM_OFFSET),H=K.length(X),z=Math.PI/3;V=b;y.detect_mobile()?J.setup_touch_controls(h,l,f,I,q,T,b):P.get_canvas().addEventListener("mouseup",C,!1);n(l,I,f,h,u);r(q,u);A(T,a);a=g.get_translation(e.target,aa);x.append_semi_stiff_cam(w,e.target,X,null,0,0,z,.01);R.eye_set_look_at(w,null,a)};a.pointerlock_cb=C;a.run_camera_victory_rotation=function(){var a=k.get_active_camera();x.remove(a);var b=
{pivot:g.get_translation(e.target)};R.target_setup(a,b);c.create_elapsed_sensor();c.create_sensor_manifold(a,"CAMERA_ROTATION",c.CT_CONTINUOUS,[c.create_elapsed_sensor()],null,function(a,b,d){d=R.get_camera_angles(a,ca);var h=R.target_get_distance(a);b=c.get_sensor_value(a,b,0);R.target_rotate(a,.1*b,d[1]<E.VICT_CAM_VERT_ANGLE?.05*b:0);h>E.VICT_CAM_DIST&&R.target_set_distance(a,h-b)})};a.disable_controls=B;a.reset=function(){e.state=d.CH_STILL;e.hp=d.MAX_CHAR_HP;e.island=-1;e.move_state.forw_back=
0;e.move_state.left_right=0;E&&(g.get_rotation(e.phys_body,ba),t.set_transform(e.phys_body,E.CHAR_DEF_POS,ba),t.set_character_move_dir(e.phys_body,0,0),k.hide_object(e.foot_smoke));var a=k.get_active_camera();c.check_sensor_manifold(a,"CAMERA_ROTATION")&&c.remove_sensor_manifold(a,"CAMERA_ROTATION");R.eye_setup(a)};a.apply_hp_potion=function(){z(d.BONUS_HP_INCR);f.play(e.body)};a.apply_lava_protect=function(){f.set_behavior(e.body,f.AB_FINISH_STOP,f.SLOT_1);f.play(e.body,null,f.SLOT_1);w.set_nodemat_value(e.lava_shield_prot,
["lava_shield_prot","lava_prot_switcher"],1)};a.remove_lava_protect=D;a.apply_shield=function(){f.set_behavior(e.body,f.AB_FINISH_STOP,f.SLOT_2);f.play(e.body,null,f.SLOT_2);w.set_nodemat_value(e.lava_shield_prot,["lava_shield_prot","shield_switcher"],1)};a.remove_shield=u;a.change_hp=z;a.add_gem=function(a){var b=a.empty;if(e.gem_slot){if(e.gem_slot==a)return;q()}b=a.empty;x.append_stiff(b,e.phys_body,d.GEM_OFFSET,d.GEM_ROT_OFFSET,d.GEM_SCALE_OFFSET);a.state=d.GM_CARRIED;e.gem_slot=a;l.play_def(Y)};
a.remove_gem=q;a.get_wrapper=function(){return e}});if(b4w.module_check("environment"))throw"Failed to register module: environment";
b4w.register("environment",function(a,b){function C(a){function b(a,c,h,g,f,d){y.spawn(f)&&(A.set_translation_v(k,f),m.play(p))}var c=n.create_timer_sensor(a.BONUS_SPAWN_PERIOD,!0),k=r.get_object_by_name(a.BONUS_SPAWN_SPHERE),p=r.get_object_by_dupli_name(a.BONUS_SPAWN_SPHERE,a.BONUS_SPAWN_SPHERE);m.set_behavior(p,m.AB_FINISH_RESET);m.set_frame(p,0);n.create_sensor_manifold(null,"BONUS_SPAWN",n.CT_SHOT,[c],null,function(a,c,g){a=t;a[0]=40*Math.random()-20;a[1]=20;a[2]=40*Math.random()-20;c=f;f[0]=
a[0];f[2]=a[2];f[1]=-10;u.append_ray_test_ext(null,a,c,"GROUND",b,!0,!1,!0,!1)})}function v(a,b){function g(a,b,d){b=n.get_sensor_value(a,b,0);d=r.get_object_name(a);k[d]+=b;k[d]<=c.ROCK_FALL_DELAY||(d=t,A.get_translation(a,d),d[1]-=c.ROCK_SPEED*b,A.set_translation_v(a,d))}function f(a,b,d,h){var g=t,l=h[0];h=h[1];var e=z.get_wrapper();A.get_translation(e.phys_body,g);d=n.get_sensor_value(a,b,0)?0:1;b=n.get_sensor_payload(a,b,d).coll_pos;g=B.distance(g,b);A.set_translation_v(l,b);m.set_frame(l,0,
m.SLOT_ALL);m.play(l,null,m.SLOT_ALL);g<c.ROCK_DAMAGE_RADIUS&&e.state!=q.CH_VICTORY&&(l=-c.ROCK_DAMAGE,0<y.shield_time_left()&&(l*=q.BONUS_SHIELD_EFFECT),z.change_hp(l));p(a);a=r.get_object_name(a);k[a]=0;(a=Math.random()<q.BONUS_SPAWN_CHANCE)&&0==d&&y.spawn(b);D.play_def(h)}function u(a,b,d,h){d=n.get_sensor_value(a,b,0)?0:1;b=n.get_sensor_payload(a,b,d).hit_fract;d=t;var g=r.get_object_name(a);k[g]<=c.ROCK_FALL_DELAY&&(A.get_translation(a,d),d[1]-=b*c.ROCK_RAY_LENGTH-.01,A.set_translation_v(h,d));
A.set_scale(h,1-b)}for(var x=0;x<c.ROCK_EMPTIES.length;x++)for(var v=c.ROCK_EMPTIES[x],C=0;C<c.ROCK_NAMES.length;C++){var F=c.ROCK_NAMES[C],w=c.BURST_EMITTER_NAMES[C],d=c.MARK_NAMES[C],G=r.get_object_by_dupli_name(v,F),w=r.get_object_by_dupli_name(v,w),d=r.get_object_by_dupli_name(v,d),J=r.get_object_by_dupli_name(v,c.ROCK_HIT_SPEAKERS[C]),O=n.create_collision_sensor(G,"LAVA",!0),E=n.create_collision_sensor(G,"GROUND",!0),M=n.create_ray_sensor(G,[0,0,0],[0,-c.ROCK_RAY_LENGTH,0],"GROUND",!0),N=n.create_ray_sensor(G,
[0,0,0],[0,-c.ROCK_RAY_LENGTH,0],"LAVA",!0);n.create_sensor_manifold(G,"ROCK_FALL",n.CT_CONTINUOUS,[a],null,g);n.create_sensor_manifold(G,"ROCK_CRASH",n.CT_SHOT,[E,O],function(a){return a[0]||a[1]},f,[w,J]);n.create_sensor_manifold(G,"MARK_POS",n.CT_CONTINUOUS,[M,N],function(a){return a[0]||a[1]},u,d);p(G);k[F]=0}}function p(a){var b=t;b[0]=32*Math.random()-16;b[1]=16*Math.random()+8;b[2]=32*Math.random()-16;A.set_translation_v(a,b)}function F(a){var b=0,g=z.get_wrapper(),f=n.create_ray_sensor(g.phys_body,
[0,0,0],[0,-q.CHAR_RAY_LENGTH,0],"LAVA",!0);n.remove_sensor_manifold(g.phys_body,"LAVA_COLLISION");n.create_sensor_manifold(g.phys_body,"LAVA_COLLISION",n.CT_CONTINUOUS,[f,a],function(a){return a[0]},function(a,c,f,l){1==f?(r.show_object(g.foot_smoke),a=n.get_sensor_value(a,c,1),b+=a,b>=q.LAVA_DAMAGE_INTERVAL&&(a=a<q.LAVA_DAMAGE_INTERVAL?1:Math.floor(a/q.LAVA_DAMAGE_INTERVAL),0>=y.lava_protect_time_left()&&z.change_hp(-a),b=0)):(r.hide_object(g.foot_smoke),b=0)});"dungeon"==c.LEVEL_NAME&&(a=r.get_object_by_dupli_name("level_02_enviroment",
"lava"),m.apply_def(a),m.set_behavior(a,m.AB_FINISH_STOP),m.stop(a),m.set_frame(a,0),a=r.get_object_by_dupli_name("lava_death_controller","lava_death_controller"),m.apply_def(a))}var m=b("animation"),n=b("controls"),r=b("scenes"),A=b("transform"),B=b("vec3"),D=b("sfx"),u=b("physics"),z=b("character"),q=b("game_config"),y=b("bonuses"),c=null,k={},t=new Float32Array(3),f=new Float32Array(3);a.init=function(a,b){c=b;F(a);c.ROCK_EMPTIES&&v(a,c);"dungeon"==c.LEVEL_NAME&&C(b)};a.reset=function(a){if("volcano"==
c.LEVEL_NAME)for(var b=0;b<c.ROCK_EMPTIES.length;b++)for(var g=c.ROCK_EMPTIES[b],f=0;f<c.ROCK_NAMES.length;f++){var m=c.ROCK_NAMES[f],n=r.get_object_by_dupli_name(g,m);p(n);k[m]=0}F(a)};a.disable_environment=function(){if(c.ROCK_EMPTIES)for(var a=0;a<c.ROCK_EMPTIES.length;a++)for(var b=c.ROCK_EMPTIES[a],g=0;g<c.ROCK_NAMES.length;g++){var f=c.MARK_NAMES[g],k=r.get_object_by_dupli_name(b,c.ROCK_NAMES[g]),f=r.get_object_by_dupli_name(b,f);n.remove_sensor_manifold(k);p(k);A.set_translation_v(f,q.DEFAULT_POS)}}});if(b4w.module_check("game_main"))throw"Failed to register module: game_main";
b4w.register("game_main",function(a,b){function C(){var a=n.get_object_by_dupli_name_list(["training_scene","training_dummy","training_dummy"]),b=n.get_object_by_dupli_name_list(["training_scene","Circle"]),c=B.create(),f=B.create();D.apply_constraint("GENERIC_6_DOF_SPRING",a,[0,-1.05,0],c,b,[-3.5,.1,-1.6],f,{use_limit_x:!0,use_limit_y:!0,use_limit_z:!0,use_angular_limit_x:!0,use_angular_limit_y:!0,use_angular_limit_z:!1,limit_max_x:0,limit_min_x:0,limit_max_y:0,limit_min_y:0,limit_max_z:0,limit_min_z:0,
limit_angle_max_x:.5,limit_angle_min_x:-.5,limit_angle_max_y:.5,limit_angle_min_y:-.5,limit_angle_max_z:.5,limit_angle_min_z:-.5},[0,0,0,200,200,200],[2,2,2,.01,.01,.01])}function v(a){m.remove_sensor_manifold(null,"PLAYLIST");z.reset();l&&(t.reset(),q.reset(),c.reset(),k.reset(),f.reset(a));z.setup_controls(a);y.update_hp_bar();p()}function p(){if(l&&l.MUSIC_SPEAKERS){var a=n.get_object_by_dupli_name("enviroment",l.MUSIC_INTRO_SPEAKER),b=n.get_object_by_dupli_name("enviroment",l.MUSIC_END_SPEAKER);
a&&b&&(r.play_def(a),r.stop(b),a=r.get_duration(a)*r.get_playrate(a),m.create_sensor_manifold(null,"PLAYLIST",m.CT_SHOT,[m.create_timer_sensor(a)],null,function(a,b,c){m.remove_sensor_manifold(null,"PLAYLIST");if(!(0>=z.get_wrapper().hp)){a=[];b=l.MUSIC_SPEAKERS;for(c=0;c<b.length;c++){var f=n.get_object_by_dupli_name("enviroment",b[c]);a.push(f)}r.apply_playlist(a,0,!0)}}))}}var F=b("app"),m=b("controls"),n=b("scenes");b("print");var r=b("sfx"),A=b("container"),B=b("quat"),D=b("physics");b("transform");
var u=b("game_config"),z=b("character");b("combat");var q=b("bonuses"),y=b("interface"),c=b("enemies"),k=b("obelisks"),t=b("gems"),f=b("environment"),l=null;new Float32Array(3);new Float32Array(3);new Float32Array(3);new Float32Array(3);new Float32Array(4);new Float32Array(4);a.level_load_cb=function(a,g,r,B,x){a=m.create_elapsed_sensor();if("under_construction"!=g){if("level_01"==g||"level_02"==g)l=b(g+"_config");if("level_02"!=g){var D=n.get_object_by_dupli_name(u.CHAR_EMPTY,u.CHAR_LIGHT);n.hide_object(D)}"training"==
g&&C();z.init_wrapper(l,g);z.setup_controls(a);l&&(q.init(a,l),c.init(a,l),t.init(l),f.init(a,l),k.init(a,l),p())}else F.enable_camera_controls();setTimeout(function(){A.get_container().style.opacity=1},1E3);y.init(v,a,B,r,z.pointerlock_cb,g,x)}});if(b4w.module_check("start_menu"))throw"Failed to register module: intro_main";
b4w.register("start_menu",function(a,b){function C(a,b){b?(E=a,y.enable_controls(a),document.getElementById("preloader_cont").style.visibility="visible",q.detect_mobile()?k.load(V+"intro_LQ.json",v,u,!0):k.load(V+"intro_HQ.json",v,u,!0)):h.log("b4w init failure")}function v(a){M=E.width/2;N=E.height/2;a=f.get_active_camera();c.get_camera_angles(a,U);c.target_get_pivot(a,H);L.enqueue([["config",L.AT_JSON,"js/intro_config.json"]],p,null);E.addEventListener("mousemove",r,!1);E.addEventListener("mousedown",
A,!1);setTimeout(function(){x.get_container().style.opacity=1},1E3)}function p(a,b,c,d){b=a.buttons_info;c=t.create_elapsed_sensor();for(d=0;d<b.length;d++){var e=b[d],h=f.get_object_by_dupli_name_list(e.button_name.split("*"));if(h){var h=h.name,k=f.get_object_by_dupli_name_list(e.mouse_over_speaker.split("*"));g.stop(k);var l=[],p=e.glow_obj_names;if("object"==typeof p)for(var r=0;r<p.length;r++){var u=f.get_object_by_dupli_name_list(p[r].split("*"));u&&l.push(u)}else l.push(f.get_object_by_dupli_name_list(p.split("*")));
w[h]={glow_objs:l,speaker:k,level_name:e.level_name,material:e.material,value_node_name:e.value_node_name,glow_grow_time:e.glow_grow_time,min_glow_value:e.min_glow_value,max_glow_value:e.max_glow_value,glow_curr_value:e.min_glow_value,outline_grow_time:e.outline_grow_time,min_outline_value:e.min_outline_value,max_outline_value:e.max_outline_value,outline_curr_value:e.min_outline_value,stop_playlist:e.stop_playlist_onclick}}}t.create_sensor_manifold(null,"GLOW",t.CT_CONTINUOUS,[c],null,m);t.create_sensor_manifold(null,
"ROT_CAMERA",t.CT_CONTINUOUS,[c],null,n);F(a);b=1;"ru"==W&&(b=0);c=f.get_object_by_dupli_name_list(a.language_obj.split("*"));K.set_nodemat_value(c,["main_menu_stone","language_switcher"],b);q.detect_mobile()||(S=f.get_object_by_name(a.back_to_menu_obj_name),Q=f.get_object_by_name(a.screen_saver_obj_name),K.set_nodemat_value(S,["back_to_main_menu","back_button_language"],b));Y=a.camera_rotation_fac}function F(a){G=f.get_object_by_dupli_name_list(a.intro_speaker.split("*"));O=f.get_object_by_dupli_name_list(a.end_speaker.split("*"));
a=a.playlist_speakers;for(var b=0;b<a.length;b++){var c=f.get_object_by_dupli_name_list(a[b].split("*"));g.stop(c);J.push(c);g.mute(c,!1)}a=g.get_duration(G)*g.get_playrate(G);g.mute(G,!1);g.mute(O,!1);g.stop(O);g.play_def(G);t.create_sensor_manifold(null,"PLAYLIST",t.CT_SHOT,[t.create_timer_sensor(a)],null,function(a,b,c){d||(g.stop(G),g.apply_playlist(J,0,!0))})}function m(a,b,c){a=t.get_sensor_value(a,b,0);for(var d in w){b=w[d];var e=b.glow_curr_value,g=b.min_glow_value,h=b.max_glow_value,k=a/
b.glow_grow_time;c=b.outline_curr_value;var l=b.min_outline_value,m=b.max_outline_value,n=a/b.outline_grow_time;P&&d==P.name&&(e<h&&(b.glow_curr_value+=k),void 0!==c&&c<m&&(b.outline_curr_value+=n));P&&d==P.name||(e>g&&(b.glow_curr_value-=k),void 0!==c&&c>l&&(b.outline_curr_value-=n));if(void 0!==e&&b.glow_curr_value!=e)for(e=0;e<b.glow_objs.length;e++)K.set_nodemat_value(b.glow_objs[e],[b.material,b.value_node_name],b.glow_curr_value);if(void 0!==c&&b.outline_curr_value!=c)for(e=0;e<b.glow_objs.length;e++)f.set_outline_intensity(b.glow_objs[e],
b.outline_curr_value)}}function n(a,b,d){d=f.get_active_camera();c.is_target_camera(d)&&(t.get_sensor_value(a,b,0),a=E.width/2,b=E.height/2,c.get_camera_angles(d,e),c.target_rotate(d,U[0]-(a-M)/E.width*Y,U[1]-(b-N)/E.height*Y,!0,!0))}function r(a){a.preventDefault&&a.preventDefault();var b=a.clientX;a=a.clientY;var c=f.pick_object(b,a);c&&c!=P?(P=c,(c=w[c.name])&&c.speaker&&g.play_def(c.speaker)):!c&&P&&(P=null);M=b;N=a}function A(a){a.preventDefault&&a.preventDefault();if(a=f.pick_object(a.clientX,
a.clientY)){f.get_object_name(a);var b=f.get_active_camera();a==Q&&c.static_setup(b);a==S&&c.target_setup(b,{pivot:H});if(w[a.name]){var d=w[a.name];d.stop_playlist&&B();d.level_name?setTimeout(function(){D(d.level_name)},1E3*Z.LEVEL_LOAD_DELAY):c.static_setup(b);E.removeEventListener("mouseup",A);E.removeEventListener("touchscreen",A);E.removeEventListener("mousemove",r)}}}function B(a){for(a=0;a<J.length;a++){var b=J[a];g.is_play(b)&&g.duck(b,0,1)}g.duck(G,0,1);setTimeout(function(){g.clear_playlist();
d=!0;g.play_def(O)},1E3)}function D(a){var b=V+a+".json";k.unload();document.getElementById("preloader_cont").style.visibility="visible";k.load(b,function(b){R.level_load_cb(b,a,u,v,D)},u,!0)}function u(a){var b=document.getElementById("prelod_dynamic_path"),c=b.nextElementSibling;b.style.width=a+"%";c.innerHTML=a+"%";100==a&&(document.getElementById("preloader_cont").style.visibility="hidden")}function z(){function a(b){p.setAttribute("lang",b);d.setAttribute("src","interface/start_game_"+b+".png");
W=b}function b(){e.style.display="inline-block"}function c(){e.style.display=""}var d=document.getElementById("start_game"),e=document.getElementById("start_game_hover"),f=document.getElementById("quality"),g=document.getElementById("start_cont"),h=document.getElementById("lang_ru"),k=document.getElementById("lang_en"),m=document.getElementById("low_qual"),n=document.getElementById("high_qual"),p=document.body;g.style.display="block";g.style.opacity=1;h.addEventListener("click",function(){a("ru")},
!1);k.addEventListener("click",function(){a("en")},!1);m.addEventListener("click",function(){f.setAttribute("quality","low")},!1);n.addEventListener("click",function(){f.setAttribute("quality","high")},!1);q.detect_mobile()?(d.addEventListener("touchstart",b),d.addEventListener("touchend",c)):(d.addEventListener("mousedown",b),d.addEventListener("mouseup",c),d.addEventListener("mouseleave",c));d.addEventListener("click",function(){g.style.visibility="hidden";var a=q.detect_mobile(),b="high"!=document.getElementById("quality").getAttribute("quality")||
a?l.P_LOW:l.P_HIGH;y.init({canvas_container_id:"canvas3d",callback:C,physics_enabled:!0,quality:b,console_verbose:!0,show_fps:!0,alpha:!1,physics_use_workers:!a,show_fps:!0,autoresize:!0})},!1)}var q=b("main"),y=b("app");b("camera_anim");var c=b("camera"),k=b("data"),t=b("controls"),f=b("scenes"),l=b("config"),h=b("print"),g=b("sfx");b("time");var L=b("assets"),K=b("objects"),x=b("container");b("util");b("vec3");b("quat");var Z=b("game_config"),R=b("game_main"),P=null,w={},d=!1,G=null,J=[],O=null,
E=null,M=0,N=0,U=new Float32Array(2),H=new Float32Array(3),Y=0,W="en",S=null,Q=null,e=new Float32Array(2),V=l.get_std_assets_path()+"petigors_tale/";a.init=function(){window.addEventListener("load",z)}});b4w.require("start_menu").init("en");
