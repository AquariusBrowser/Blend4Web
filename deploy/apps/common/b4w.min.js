var b4w="object"===typeof b4w?b4w:function(a){var p={};a.module=p;var d={};a.register=function(a,b){p[a]||(p[a]=b)};a.require=function(a,b){if(!p[a])throw Error('Module "'+a+'" not found');b=b||"__b4w_default";d[b]||(d[b]=function(a){return function(b){var c=p[b];if(!c)throw Error('Module "'+b+'" not found');c.cj||(c.cj={});c.cj[a]||(c.cj[a]={},c(c.cj[a],d[a]));return c.cj[a]}}(b));return d[b](a)};a.module_check=function(a){return p[a]?!0:!1};a.get_namespace=function(a){for(var b in d)if(d[b]==a)return b;
return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.no&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function p(){var a=d,c=a.getDate(),c=10>c?"0"+String(c):String(c),f=a.getMonth()+1,f=10>f?"0"+String(f):String(f),n=String(a.getFullYear()),l=a.getHours(),l=10>l?"0"+String(l):String(l),u=a.getMinutes(),u=10>u?"0"+String(u):String(u),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return c+"."+f+"."+n+" "+l+":"+u+":"+a}var d=new Date(2015,8,30,10,21,14),c=[15,9];a.version=function(){return c};a.version_str=function(){for(var a="",d=0;d<c.length;d++)a=1==d?a+(10>c[d]?
"0"+c[d]:c[d]):a+c[d],d!=c.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return d};a.date_str=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.no&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function d(){return b4w.module_check(a.hc.kl)}function c(){for(var c=a.hc,d=null,l=document.getElementsByTagName("script"),k=0;k<l.length;k++){for(var e=l[k].src,h=0;h<c.Jt.length;h++)if(0<=e.indexOf(c.Jt[h])){d=e;break}if(null!==d)break}d||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),d=document.location.href);c=d.indexOf("?");0<=c&&(d=d.substring(0,c));return d.substring(0,d.lastIndexOf("/")+1)}var b=p("__print"),
k=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.iz=k.na(a.context);a.q={alpha_sort:!0,alpha_sort_threshold:.1,gn:!1,Tg:[5,6],Dd:1E4,console_verbose:!1,do_not_load_resources:!1,Sm:!1,Ls:1.5,AA:10,background_color:[0,0,0,0],Pg:.01,render_resolution_factor:1,canvas_resolution_factor:1,Jm:3,allow_cors:!1,so:!1,Zk:!0,show_hud_debug_info:!1,oH:!0,xi:!0,anaglyph_use:!1,qk:!0,kc:!0,de:!0,Ih:!0,Th:!0,il:!0,Ug:!0,Eh:!0,antialiasing:!0,smaa:!1,
wireframe_debug:!1,hw:!1,Nh:!0,jk:!0,Fb:!0,rm:!0,water_dynamic:!0,shore_smoothing:!0,yi:!0,Vb:1024,di:512,Ov:!0,precision:"highp",quality:a.P_HIGH,fn:!0,LC:!1,Xu:!1,ws:!1,Yv:!1,uf:!1,fo:!1,es:!1,wt:!1,In:!1,EI:!1,vk:!1,allow_hidpi:!1,gyro_use:!1,Is:!1,np:!1,enable_selectable:!0,enable_outlining:!0,Ee:!0,Ut:128,No:!1,yt:!1,uC:!1,fp:[0,0],Dj:!1,Au:!0};a.Zz=k.na(a.q);a.lg={Ll:-1,Ms:!1,Gg:1};a.controls={JC:1/120};a.Od={dir:"ASSETS=../../assets/",DC:15,Fp:!0,lp:!1,ao:!1};a.my=k.na(a.Od);a.hc={shaders_dir:"",
iE:"include/",BI:"postprocessing/",kl:"built_in_data",Jt:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js USER_DEFINED_MODULE".split(" "),Ku:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.m={enabled:!0,Dd:60,Gk:"",Cn:!1,ping:!1,Kk:!0};a.WC=k.na(a.m);a.wi={Ol:1024,xl:384,ns:32,Sz:128,Rz:256,su:.25,cD:.5,bD:1};a.JD=k.na(a.wi);a.A={Pq:!0,fm:!1,xr:!1,Wr:!1,xs:!1};a.hE=k.na(a.A);a.tb={outlining_overview_mode:!1,Le:[1,.4,.05],qi:.2,ri:3.8,si:1};a.bo={enabled:!1,
KE:"MAIN_OPAQUE",JE:0,lE:"DEPTH"};a.Vz=k.na(a.bo);a.iy=function(){var b=a.q,c=a.m,d=a.wi;switch(b.quality){case a.P_ULTRA:b.xi=!0;b.shore_smoothing=!0;b.de=!0;b.Ih=!0;b.Th=!0;b.il=!0;b.qk=!0;b.kc=!0;b.Nh=!0;b.jk=!0;b.Fb=!0;b.rm=!0;b.render_resolution_factor=1.75;d.Ol=2048;b.Jm=3;b.Zk=!0;b.Sm=!1;b.precision="highp";b.water_dynamic=!0;b.yi=!0;b.antialiasing=!0;b.smaa=!0;b.Eh=!0;b.Ug=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.Ee=!0;c.Dd=120;break;case a.P_HIGH:b.xi=!0;b.shore_smoothing=!0;b.de=!0;b.Ih=
!0;b.Th=!0;b.il=!0;b.qk=!0;b.kc=!0;b.Nh=!0;b.jk=!0;b.Fb=!0;b.rm=!0;b.render_resolution_factor=1;d.Ol=1024;b.Jm=3;b.Zk=!0;b.Sm=!1;b.precision="highp";b.water_dynamic=!0;b.yi=!0;b.antialiasing=!0;b.smaa=!1;b.Eh=!0;b.Ug=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.Ee=!0;c.Dd=60;break;case a.P_LOW:b.xi=!1,b.shore_smoothing=!1,b.de=!1,b.Ih=!1,b.Th=!1,b.il=!1,b.qk=!1,b.kc=!1,b.Nh=!1,b.jk=!1,b.Fb=!1,b.rm=!1,b.render_resolution_factor=1,d.Ol=512,b.Jm=2,b.Zk=!1,b.Sm=!0,b.precision="mediump",b.water_dynamic=
!1,b.yi=!1,b.antialiasing=!1,b.smaa=!1,b.Eh=!1,b.Ug=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.Ee=!1,c.Dd=60}};a.set=function(c,d){switch(c){case "allow_cors":a.q.allow_cors=d;break;case "allow_hidpi":a.q.allow_hidpi=d;break;case "alpha":a.context.alpha=d;break;case "alpha_sort":a.q.alpha_sort=d;break;case "alpha_sort_threshold":a.q.alpha_sort_threshold=d;break;case "anaglyph_use":a.q.anaglyph_use=d;break;case "animation_framerate":a.lg.Ll=d;break;case "antialiasing":a.q.antialiasing=d;break;case "assets_dds_available":a.Od.ao=
d;break;case "assets_min50_available":a.Od.lp=d;break;case "audio":a.A.Pq=d;break;case "background_color":a.q.background_color=d;break;case "built_in_module_name":a.hc.kl=d;break;case "canvas_resolution_factor":a.q.canvas_resolution_factor=d;break;case "console_verbose":a.q.console_verbose=d;break;case "do_not_load_resources":a.q.do_not_load_resources=d;break;case "gyro_use":a.q.gyro_use=d;break;case "physics_enabled":a.m.enabled=d;break;case "physics_uranium_path":a.m.Gk=d;break;case "physics_calc_fps":a.m.Cn=
d;break;case "physics_use_workers":a.m.Kk=d;break;case "precision":a.q.precision=d;break;case "quality":a.q.quality=d;break;case "render_resolution_factor":a.q.render_resolution_factor=d;break;case "sfx_mix_mode":a.A.fm=d;break;case "shaders_dir":a.hc.shaders_dir=d;break;case "show_hud_debug_info":a.q.show_hud_debug_info=d;break;case "smaa":a.q.smaa=d;break;case "smaa_search_texture_path":a.hc.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.hc.smaa_area_texture_path=d;break;case "wireframe_debug":a.q.wireframe_debug=
d;break;case "enable_selectable":a.q.enable_selectable=d;break;case "enable_outlining":a.q.enable_outlining=d;break;case "outlining_overview_mode":a.tb.outlining_overview_mode=d;break;case "glow_materials":a.q.Ee=d;break;default:b.error("Unknown config property: "+c)}};a.get=function(c){switch(c){case "allow_cors":return a.q.allow_cors;case "allow_hidpi":return a.q.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.q.alpha_sort;case "alpha_sort_threshold":return a.q.alpha_sort_threshold;
case "anaglyph_use":return a.q.anaglyph_use;case "animation_framerate":return a.lg.Ll;case "antialiasing":return a.q.antialiasing;case "assets_dds_available":return a.Od.ao;case "assets_min50_available":return a.Od.lp;case "audio":return a.A.Pq;case "background_color":return a.q.background_color;case "built_in_module_name":return a.hc.kl;case "canvas_resolution_factor":return a.q.canvas_resolution_factor;case "console_verbose":return a.q.console_verbose;case "do_not_load_resources":return a.q.do_not_load_resources;
case "gyro_use":return a.q.gyro_use;case "physics_enabled":return a.m.enabled;case "physics_uranium_path":return a.m.Gk;case "physics_calc_fps":return a.m.Cn;case "physics_use_workers":return a.m.Kk;case "precision":return a.q.precision;case "quality":return a.q.quality;case "render_resolution_factor":return a.q.render_resolution_factor;case "sfx_mix_mode":return a.A.fm;case "shaders_dir":return a.hc.shaders_dir;case "show_hud_debug_info":return a.q.show_hud_debug_info;case "smaa":return a.q.smaa;
case "smaa_search_texture_path":return a.hc.smaa_search_texture_path;case "smaa_area_texture_path":return a.hc.smaa_area_texture_path;case "wireframe_debug":return a.q.wireframe_debug;case "enable_selectable":return a.q.enable_selectable;case "enable_outlining":return a.q.enable_outlining;case "outlining_overview_mode":return a.tb.outlining_overview_mode;case "glow_materials":return a.q.Ee;default:b.error("Unknown config property: "+c)}};a.reset=function(){a.context=k.na(a.iz);a.q=k.na(a.Zz);a.Od=
k.na(a.my);a.m=k.na(a.WC);a.wi=k.na(a.JD);a.A=k.na(a.hE);a.bo=k.na(a.Vz)};a.LB=d;a.ZD=function(){var b=a.hc,n=a.m;d()||""!=b.shaders_dir||(b.shaders_dir=c()+"../shaders/");if(d())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path){var l=c()+b.Ku;b.smaa_search_texture_path=b.smaa_search_texture_path||l+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||l+
"smaa_area_texture.png"}n.enabled&&""==n.Gk&&(l=c()+b.Ku,n.Gk=l+"uranium.js")};a.get_std_assets_path=function(){return a.Od.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function d(a,g){var t=document.createElement("div"),d=t.style;d.position="absolute";d.backgroundColor="black";d.borderRadius="20px 20px 20px 0px";d.boxShadow="0px 0px 10px rgb(180, 180, 200)";d.opacity=1;d.padding="8px 12px";d.lineHeight="15px";d.visibility="hidden";d.fontSize="12px";var q=e.get_container();q.appendChild(t);var r=h.get_meta_tags(a),F=document.createElement("span"),v=F.style;F.innerHTML=r.title||a.name;v.fontWeight="bold";v.fontSize="12px";v.lineHeight=
"15px";v.color="#fff";v.fontFamily="Arial";k(F);t.appendChild(F);var w=r.description;if(w){var r=document.createElement("div"),f=r.style;f.position="absolute";f.bottom="0px";f.left="0px";f.backgroundColor="#000";f.borderRadius="20px 20px 20px 0px";f.boxShadow="0px 0px 10px rgb(180, 180, 200)";f.visibility="hidden";f.padding="8px 12px";f.overflow="hidden";f.lineHeight="15px";f.fontSize="12px";f.zIndex="2";t.appendChild(r);var x=document.createElement("span"),n=x.style;x.innerHTML=w;n.fontSize="12px";
n.fontFamily="Arial";n.fontWeight="bold";n.lineHeight="15px";n.color="#fff";n.visibility="hidden";r.appendChild(x);var z=!1,l=!1;q.addEventListener("click",function(a){if(!(z||l||D))if(a.target!=F&&a.target!=t||"hidden"!=f.visibility||1!=d.opacity)"visible"==f.visibility&&(d.visibility="visible",v.visibility="visible",f.visibility="hidden",n.visibility="hidden");else{d.visibility="hidden";v.visibility="hidden";f.visibility="visible";z=l=!0;a=t.offsetWidth-24;var x=t.offsetHeight-16,m=Math.min(g,c(w)),
e=b(w,m);e==x&&(f.height=e+"px");m!=a?G.animate(a,m,200,function(a){a==m&&("visible"==f.visibility&&(n.visibility="visible"),z=!1);f.width=a+"px"}):z=!1;e!=x?G.animate(x,e,200,function(a){a==e&&("visible"==f.visibility&&(n.visibility="visible"),l=!1);f.height=a+"px"}):l=!1;l||z||(n.visibility="visible")}},!1)}return t}function c(a){var b=document.createElement("div"),g=document.createElement("span"),c=b.style;g.innerHTML=a;g.style.fontSize="12px";g.style.fontFamily="Arial";g.style.fontWeight="bold";
g.style.color="#fff";g.style.visibility="hidden";c.lineHeight="15px";b.appendChild(g);c.position="absolute";c.visibility="hidden";c.fontSize="12px";c.display="inline-block";c.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function b(a,b){var g=document.createElement("div"),c=document.createElement("span"),d=g.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";c.style.color="#fff";c.style.visibility=
"hidden";d.lineHeight="15px";g.appendChild(c);d.position="absolute";d.visibility="hidden";d.fontSize="12px";d.display="inline-block";d.width=b+"px";d.lineHeight="15px";document.body.appendChild(g);c=g.offsetHeight;document.body.removeChild(g);return c}function k(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}
function f(){for(var a=0,b=0;b<B.length;b++)B[b].Gh&&a++;v=new Float32Array(3*a)}function n(a,b){return b.depth-a.depth}var l=p("__batch"),u=p("__camera"),e=p("__container"),h=p("__objects"),g=p("__print"),q=p("__renderer"),z=p("__scenes"),G=p("__time");p("__util");p("__config");var D=!1,B=[],v=new Float32Array(0),E=new Uint8Array(16),A=new Float32Array(2),r=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<B.length;b++)if(B[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.anchor.Gh&&Boolean(z.ea(z.Sh(),
"ANCHOR_VISIBILITY"));b={type:a.anchor.type,obj:a,x:0,y:0,depth:0,yh:"out",Gh:b,element:null,ii:null,Nx:a.anchor.EC,pr:0,Fl:a.anchor.Fl};switch(b.type){case "ANNOTATION":b.element=d(a,b.Nx);b.pr=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.anchor.Fl),b.element||(g.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}B.push(b);f()}};a.remove=function(a){for(var b=0;b<B.length;b++){var g=B[b];if(g.obj==a){"ANNOTATION"==g.type&&(a=g,e.get_container().removeChild(a.element));
B.splice(b,1);f();break}}};a.update=function(){for(var a=0,b=B.length;b--;){var g=B[b];g.Gh&&(v.set(g.obj.f.i,3*a),a++);var c,d=g,e=r;c=z.Pj(z.Sh());c=e=u.project_point(c,d.obj.f.i,e);d=c[0];e=c[1];c=c[2];if(d!=g.x||e!=g.y||c!=g.depth){switch(g.type){case "ANNOTATION":var F=g.element;F.style.left=Math.floor(d)+"px";F.style.top=Math.floor(e-g.pr)+"px";break;case "ELEMENT":var F=g.element,q=F.getBoundingClientRect();F.style.cssText+="left:"+Math.floor(d-q.width/2)+"px;top:"+Math.floor(e-q.height/2)+
"px;"}g.x=d;g.y=e;g.depth=c;g.ii&&g.ii(d,e,g.yh,g.obj,F)}}B.sort(n);for(b=0;b<B.length;b++)g=B[b],"GENERIC"!=g.type&&(g.element.style.zIndex=b);0<a&&(a=z.ea(z.Sh(),"ANCHOR_VISIBILITY").p[0].C,l.YE(a,v))};a.xF=function(){for(var a=e.get_container(),b=B.length;b--;){var g=B[b],c=g.obj,d=g.x,r=g.y,F=g.depth,F=0>d||0>r||0>F||1<F||z.is_hidden(c)||d>=a.clientWidth||r>=a.clientHeight?"out":"visible";if(g.Gh&&"out"!=F){var F=g,h=z.ea(z.Sh(),"ANCHOR_VISIBILITY").j,w=e.Gn(F.x,F.y,A,h);q.Gu(h.Ce,w[0],h.height-
w[1],2,2,E);F=1020==E[0]+E[4]+E[8]+E[12]?"visible":"out"==F.yh||0==E[0]+E[4]+E[8]+E[12]?"covered":F.yh}if(F!=g.yh){switch(g.type){case "ANNOTATION":case "ELEMENT":var f=g.element;if(!f)break;"out"==F?(f.style.visibility="hidden",f.children.length&&(f.children[0].style.visibility="hidden"),"ANNOTATION"==g.type&&1<f.children.length&&(h=f.children[1],h.style.visibility="hidden",h.children.length&&(h.children[0].style.visibility="hidden"))):"visible"==F?(f.style.visibility="visible",f.children.length&&
(f.children[0].style.visibility="visible"),f.style.opacity=1):(f.style.visibility="visible",f.style.opacity=.1,f.children.length&&(f.children[0].style.visibility="visible"),"ANNOTATION"==g.type&&1<f.children.length&&(h=f.children[1],h.style.visibility="hidden",h.children.length&&(h.children[0].style.visibility="hidden")))}g.yh=F;g.ii&&g.ii(d,r,g.yh,c,f)}}};a.attach_move_cb=function(a,b){for(var g=0;g<B.length;g++)B[g].obj==a&&(B[g].ii=b)};a.detach_move_cb=function(a){for(var b=0;b<B.length;b++)B[b].obj==
a&&(B[b].ii=null)};a.cleanup=function(){for(var a=0;a<B.length;a++){var b=B[a];"ANNOTATION"==b.type&&e.get_container().removeChild(b.element)}B.length=0};a.is_anchor=function(a){for(var b=0;b<B.length;b++)if(B[b].obj==a)return!0;return!1};a.get_element_id=function(a){for(var b=0;b<B.length;b++)if(B[b].obj==a)return B[b].Fl;return!1};a.pause=function(){D=!0};a.resume=function(){D=!1}};b4w.module.__armature=function(a,p){function d(a){a=a.f;for(var b=a.Fm,g=a.Vt,c=0;c<b.length;c++){for(var d=b[c],e=g[c],q=0;q<e.length;q+=2)for(var r=e[q],m=e[q+1],f=0;4>f;f++)d.vc[r+f]=a.vc[m+f],d.Tc[r+f]=a.Tc[m+f],d.Ac[r+f]=a.Ac[m+f],d.Zc[r+f]=a.Zc[m+f];d.md=a.md}}function c(a,b,g,d){var q=a.zq,f=a.Vf,h=a.Dk,r=a.zp;r?(r=r.Dk,b?k.multiply(r,q,h):(b=e,k.invert(r,b),k.multiply(b,h,q))):b?k.copy(q,h):k.copy(h,q);q=u;k.invert(f,q);k.multiply(h,q,q);f=a.df;g[4*f]=q[0];g[4*f+1]=q[1];g[4*f+2]=q[2];g[4*
f+3]=q[3];d[4*f]=q[4];d[4*f+1]=q[5];d[4*f+2]=q[6];d[4*f+3]=q[7];a=a.vs;for(f=0;f<a.length;f++)h=a[f],h.Ja||c(h,!0,g,d)}var b=p("__util"),k=p("__tsr"),f=p("__quat"),n=p("__mat4"),l=p("__vec3"),u=new Float32Array(8),e=new Float32Array(8),h=new Float32Array(4),g=new Float32Array(4),q=new Float32Array(4);a.mh=function(a,g){for(var c=a.data.bones,d=a.pose.bones,e={},q=0;q<d.length;q++){var f=d[q],h=f.bone,m=h.name,y=e[m]={df:0,Zv:-1,zp:null,vs:[],nl:[],Ja:null,Ck:k.create(),zq:k.create(),Vf:k.create(),
Dk:k.create(),Mm:k.create(),Aq:k.create(),Nm:!1,Bv:new Float32Array(3)},m=new Float32Array(h.matrix_local),t=new Float32Array(16);n.invert(m,t);var f=new Float32Array(f.matrix_basis),p=y.Bv;l.subtract(h.tail_local,h.head_local,p);b.SF(p,t,p);k.from_mat4(m,y.Vf);k.from_mat4(f,y.Mm);k.copy(y.Vf,y.Dk)}for(q=0;q<c.length;q++){m=c[q].name;f=b.keysearch("name",m,d);y=e[m];h=f.parent_recursive;y.nl.push(y);for(t=0;t<h.length;t++)f=h[t],f=f.name,f=e[f],y.nl.push(f);h.length?(f=h[0],f=f.name,f=e[f],y.zp=f,
k.invert(f.Vf,u),k.multiply(u,y.Vf,y.Ck),f.vs.push(y)):k.copy(y.Vf,y.Ck);y.df=q;y.name=m;k.multiply(y.Ck,y.Mm,y.zq)}g.f.fd=e};a.get_bone_tsr=function(a,b,c,d,v){var n=a.f,l=n.md;b=n.fd[b];var r=b.df;a=b.Vf;var m=n.Ac,y=n.Zc,t=n.vc,n=n.Tc,p=m[4*r+1],C=m[4*r+2],I=m[4*r+3],F=y[4*r+1],N=y[4*r+2],w=y[4*r+3];h[0]=(1-l)*m[4*r]+l*y[4*r];h[1]=(1-l)*p+l*F;h[2]=(1-l)*C+l*N;h[3]=(1-l)*I+l*w;g[0]=t[4*r];g[1]=t[4*r+1];g[2]=t[4*r+2];g[3]=t[4*r+3];q[0]=n[4*r];q[1]=n[4*r+1];q[2]=n[4*r+2];q[3]=n[4*r+3];f.slerp(g,q,
l,g);l=u;k.set_transcale(h,l);k.set_quat(g,l);c?(c=e,k.translate(a,b.Bv,c),k.multiply(l,c,l)):k.multiply(l,a,l);if(d){if(d=b.zp)c=e,k.invert(d.Dk,c),k.multiply(c,l,l);d=e;k.invert(b.Ck,d);k.multiply(d,l,l)}k.copy(l,v)};a.set_bone_tsr=function(a,b,g,e){var f=a.f;b=f.fd[b];var q=f.Ac,h=f.vc;e?k.multiply(b.Ck,g,b.zq):k.copy(g,b.Dk);c(b,e,q,h);f.md=0;d(a)};a.uF=d;a.eF=c;a.mj=function(a,b){return b in a.f.fd}};b4w.module.__boundings=function(a,p){function d(a,b){for(var c=a[0],d=a[1],e=a[2],f=a[0],h=a[1],n=a[2],l=3;l<a.length;l+=3)var r=a[l],m=a[l+1],y=a[l+2],c=Math.max(c,r),d=Math.max(d,m),e=Math.max(e,y),f=Math.min(f,r),h=Math.min(h,m),n=Math.min(n,y);b.max_x=c;b.max_y=d;b.max_z=e;b.min_x=f;b.min_y=h;b.min_z=n;return b}function c(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,e=a.max_z,f=a.min_x,h=a.min_y,n=a.min_z;b[0]=f;b[1]=h;b[2]=n;b[3]=c;b[4]=h;b[5]=n;b[6]=c;b[7]=d;b[8]=n;b[9]=f;b[10]=
d;b[11]=n;b[12]=f;b[13]=h;b[14]=e;b[15]=c;b[16]=h;b[17]=e;b[18]=c;b[19]=d;b[20]=e;b[21]=f;b[22]=d;b[23]=e;return b}function b(a,b,c){n.add(b,c,a.G);n.scale(a.G,.5,a.G);a.Pa=n.distance(a.G,b);return a}var k=p("__tsr"),f=p("__util"),n=p("__vec3"),l=new Float32Array(24),u=new Float32Array(3),e=new Float32Array(3),h=new Float32Array(3);a.tl=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.VG=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,
min_y:-1E12,max_z:1E12,min_z:-1E12}};a.td=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Bs=function(a,b){var c=a.max_y,d=a.max_z,e=a.min_x,f=a.min_y,h=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,e);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,h)};a.uy=d;a.yn=function(b,e,h){h||(h=a.td());b=c(b,l);f.Gf(b,e,b);return d(b,h)};a.rA=c;a.DI=function(b,c,d){d||(d=a.td());
var e=c.min_x,f=c.max_x,h=c.min_y,v=c.max_y,n=c.min_z;c=c.max_z;if(e>=b.max_x||f<=b.min_x||h>=b.max_y||v<=b.min_y||n>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,e);d.max_x=Math.min(b.max_x,f);d.min_y=Math.max(b.min_y,h);d.max_y=Math.min(b.max_y,v);d.min_z=Math.max(b.min_z,n);d.max_z=Math.min(b.max_z,c);return d};a.HI=function(b,c,d){d||(d=a.td());var e=b.max_x-b.min_x,f=b.max_y-b.min_y,h=b.max_z-b.min_z;d.min_x=b.min_x-
.5*(c-1)*e;d.max_x=b.max_x+.5*(c-1)*e;d.min_y=b.min_y-.5*(c-1)*f;d.max_y=b.max_y+.5*(c-1)*f;d.min_z=b.min_z-.5*(c-1)*h;d.max_z=b.max_z+.5*(c-1)*h;return d};a.An=function(b,c,d){d||(d=a.Nk());n.transformMat4(b.G,c,d.G);d.Pa=b.Pa*f.jp(c);return d};a.zn=function(a,b,c){c||(c={Pd:new Float32Array(3),Qd:new Float32Array(3),Rd:new Float32Array(3),G:new Float32Array([0,0,0])});k.transform_vec3(a.G,b,c.G);n.copy(a.Pd,c.Pd);n.copy(a.Qd,c.Qd);n.copy(a.Rd,c.Rd);k.transform_dir_vec3(c.Pd,b,c.Pd);k.transform_dir_vec3(c.Qd,
b,c.Qd);k.transform_dir_vec3(c.Rd,b,c.Rd);return c};a.vl=function(a,b){return{Pa:a,G:new Float32Array(b)}};a.Nk=function(){return{G:new Float32Array([0,0,0]),Pa:0}};a.ul=function(a,b,c,d){return{Pd:new Float32Array(a),Qd:new Float32Array(b),Rd:new Float32Array(c),G:new Float32Array([d[0],d[1],d[2]])}};a.vy=function(){return{G:new Float32Array([0,0,0]),Pa:1E12}};a.nA=function(a,b){var c=n.subtract(b.G,a.G,n.create());0==n.length(c)&&n.set(1,0,0,c);var d=n.normalize(c,n.create()),c=n.scale(d,a.Pa,n.create());
n.add(c,a.G,c);var e=n.scale(d,-a.Pa,n.create());n.add(e,a.G,e);var f=n.scale(d,b.Pa,n.create());n.add(f,b.G,f);var h=n.scale(d,-b.Pa,n.create());n.add(h,b.G,h);c=[c,e,f,h];d=n.normalize(d,n.create());e=c[0];f=c[0];for(h=1;h<c.length;h++){var l=n.dot(c[h],d);l<n.dot(e,d)&&(e=c[h]);l>n.dot(f,d)&&(f=c[h])}d=[e,f];c=d[0];d=d[1];a.G=n.scale(n.add(c,d,n.create()),.5,n.create());a.Pa=n.length(n.subtract(d,c,n.create()))/2};a.fs=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d-2*a);return{Pa:a,height:e,
G:new Float32Array([0,(c+d)/2,0])}};a.hs=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{Pa:a,height:e,G:new Float32Array([0,(c+d)/2,0])}};a.gs=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{Pa:a,height:e,G:new Float32Array([0,(c+d)/2,0])}};a.ZG=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.oD=function(a){for(var b=0,c=0,d=0,e=0,f=0,h=0,n=0,l=0,r=0;r<a.submeshes.length;r++){var m=
a.submeshes[r];if(m.position.length){b=e=m.position[0];c=f=m.position[1];d=h=m.position[2];break}}for(r=0;r<a.submeshes.length;r++)for(var m=a.submeshes[r],m=m.position,y=0;y<m.length/3;y++)var t=m[3*y],k=m[3*y+1],C=m[3*y+2],b=Math.max(t,b),c=Math.max(k,c),d=Math.max(C,d),e=Math.min(t,e),f=Math.min(k,f),h=Math.min(C,h),n=Math.max(Math.sqrt(t*t+k*k+C*C),n),l=Math.max(Math.sqrt(t*t+C*C),l);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=
d;a.b4w_bounding_box.min_z=h;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=e;a.b4w_bounding_box_source.max_y=c;a.b4w_bounding_box_source.min_y=f;a.b4w_bounding_box_source.max_z=d;a.b4w_bounding_box_source.min_z=h;a.b4w_bounding_sphere_radius=n;a.b4w_bounding_cylinder_radius=l};a.iB=function(c){var d=c.subarray(0,3),l=c.subarray(6,9),k=c.subarray(12,15),D=c.subarray(18,21);c=n.subtract(l,d,u);n.normalize(c,c);var B=f.mB(d,l,k,e),B=n.cross(B,c,B);n.normalize(B,B);var v=n.create(),
E=n.create();n.subtract(l,d,h);E[0]=n.dot(h,c);E[1]=n.dot(h,B);l=n.create();n.subtract(k,d,h);l[0]=n.dot(h,c);l[1]=n.dot(h,B);k=n.create();n.subtract(D,d,h);k[0]=n.dot(h,c);k[1]=n.dot(h,B);D=a.Nk();k=[v,E,l,k];v=b(D,k[0],k[1]);for(D=2;D<k.length;D++)if(n.distance(v.G,k[D])>v.Pa){for(var A=v,v=k,E=k[D],l=D-1,A=b(A,E,v[0]),r=1;r<=l;r++)if(n.distance(A.G,v[r])>A.Pa){for(var m=A,A=v,y=E,t=v[r],p=r-1,m=b(m,y,t),C=0;C<=p;C++)if(n.distance(m.G,A[C])>m.Pa){var I=y,F=t,N=A[C],w=n.subtract(F,N,h),w=n.squaredLength(w),
K=n.subtract(I,N,h),x=n.squaredLength(K),K=n.subtract(I,F,h),V=n.squaredLength(K),K=w*(x+V-w),U=x*(V+w-x),w=V*(w+x-V),x=K+U+w;n.copy(I,m.G);n.scale(m.G,K/x,m.G);n.scaleAndAdd(m.G,F,U/x,m.G);n.scaleAndAdd(m.G,N,w/x,m.G);m.Pa=n.distance(m.G,I)}A=m}v=A}D=v;c=n.scale(c,D.G[0],h);n.scaleAndAdd(c,B,D.G[1],c);n.add(c,d,D.G);return D}};b4w.module.__compat=function(a,p){function d(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function c(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var k=p("__config"),f=p("__extensions"),n=p("__print");
p("__util");a.cA=function(a){a.getError()==a.INVALID_ENUM&&n.warn("Possible Tegra invalid enum issue detected, ignoring")};a.RD=function(a){var u=k.lg,e=k.q,h=k.context,g=k.wi,q=k.A,z=k.m;e.Ut=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);e.Vb=a.getParameter(a.MAX_TEXTURE_SIZE);e.di=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var p=Boolean(f.dB());d("Firefox/28.0")&&(d("Linux")||d("Macintosh"))&&(n.warn("Firefox 28 detected, applying depth hack"),p=!1);d("Windows Phone")||(d("iPad")||d("iPhone")?(n.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
h.alpha||(e.background_color[3]=1),e.Yv=!0,e.smaa=!1,e.de=!1,e.precision="highp",e.wt=!0,e.yt=!0):d("Mac OS X")&&d("Safari")&&!d("Chrome")&&(n.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),q.xr=!0,q.Wr=!0));d("Windows")&&(d("Chrome/40")||d("Firefox/33")||d("Firefox/34")||d("Firefox/35")||d("Firefox/36"))&&(n.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),e.In=!0);c()&&(n.warn("Mobile detected, applying various hacks for video textures."),
e.uf=!0,d("iPad")||d("iPhone")||d("Windows Phone")||(n.warn("Mobile (not iOS) detected, disable playback rate for video textures."),q.xs=!0));(d("Firefox/35.0")||d("Firefox/36.0"))&&d("Windows")&&(n.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),e.Is=!0);if(d("iPhone")||b()||d("Edge"))n.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),e.vk=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(n.warn("Not enough varyings, disable shadows on blend objects"),
e.ws=!0);d("Windows Phone")&&(n.warn("Windows Phone detected. Disable wireframe mode, glow materials, ssao, smaa, shadows, reflections, refractions."),e.wireframe_debug=!1,e.precision="highp",e.Ee=!1,e.de=!1,e.smaa=!1,e.xi=!1,e.qk=!1,e.kc=!1,e.Au=!1);d("Firefox")&&e.uf&&(n.warn("Mobile FireFox detected, applying depth hack"),p=z.Kk=!1);if(h=f.ft())d("Macintosh")&&-1<a.getParameter(h.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(n.warn("OS X / Intel HD 3000 detected, applying depth hack"),
p=!1),-1<a.getParameter(h.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(h.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(n.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),p=!1,u.Ms=!0),-1<a.getParameter(h.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(h.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(n.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),e.precision="highp",e.xi=!1),-1<a.getParameter(h.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&
-1<a.getParameter(h.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(n.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),e.precision="highp",e.de=!1),-1<a.getParameter(h.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(h.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(n.warn("Qualcomm Adreno detected, applying shader constants hack."),e.Xu=!0,-1<a.getParameter(h.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(n.warn('Qualcomm Adreno305 detected, set "highp" precision.'),e.precision=
"highp"),-1<a.getParameter(h.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(n.warn('Qualcomm Adreno330 detected, set "highp" precision.'),e.precision="highp")),-1<a.getParameter(h.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(h.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(n.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),e.so=!0),d("Windows")&&d("Chrome")&&!d("Edge")&&a.getParameter(h.UNMASKED_RENDERER_WEBGL).match(/NVIDIA GeForce 8..0/)&&(n.warn("Chrome / Windows / NVIDIA GeForce 8000 series detected, setting max cubemap size to 256."),
e.di=256);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(n.warn("Vertex textures are not allowed. Disabling vertex textures"),e.fn=!1);e.allow_hidpi&&1<window.devicePixelRatio&&(n.log("%cENABLE HIDPI MODE","color: #00a"),e.render_resolution_factor=1,e.smaa=!1);p||(e.Nh=!1,e.jk=!1,e.Fb=!1,e.water_dynamic=!1,e.shore_smoothing=!1,e.yi=!1,e.smaa=!1);e.Ov=Boolean(f.gt());e.yj=p;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(e.precision="mediump");b()&&(n.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),
g.xl=512);if(b()&&d("Touch")||d("Edge"))n.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),e.No=!0;128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(n.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),e.so=!0);d("Chrome")&&!d("Edge")&&(n.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),e.es=!0);if(d("Chrome")&&!d("Edge")||d("Firefox"))e.fo=!0;if(b()||d("iPad"))n.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),
e.gn=!0;c()&&d("Firefox")&&(n.log("Mobile firefox detected. Applying autoplay media hack."),e.np=!0);d("Edge")&&(n.warn("Microsoft Edge detected, set up new minimal texture size."),e.Dj=!0)};a.detect_mobile=c;a.gy=function(){d("Firefox/35.0")&&d("Windows")&&(n.warn("Windows/Firefox 35 detected, forcing context's alpha"),k.context.alpha=!0)};a.To=b};b4w.module.__constraints=function(a,p){function d(a){var b={};b.type=a;return b}function c(a,c){a.Ja&&a.Ja.N&&b(a.Ja.N,a);if(c.N){var d=c.N;if(-1==d.xd.indexOf(a))d.xd.push(a);else throw"Descendant object override is forbidden";}a.Ja=c}function b(a,b){var c=a.xd.indexOf(b);if(-1!=c)a.xd.splice(c,1);else throw"No descendant object";}function k(a,b,c){switch(b.type){case 1:var w=a.f.quat,d=b.N.f.aa;c=b.N.f.quat;b.Zb?(h.copy(b.Zb,w),h.multiply(c,w,w)):h.copy(c,w);z.transformMat4(b.offset,d,a.f.i);a.f.scale=
b.uk*b.N.f.scale;break;case 9:var x=a.f.i,w=a.f.quat,d=b.N.f.aa;c=b.N.f.quat;h.multiply(h.invert(b.bh,b.bh),w,w);h.multiply(c,w,w);z.transformMat4(b.offset,d,x);h.copy(c,b.bh);break;case 10:x=a.f.i;w=a.f.quat;d=b.N.f.aa;c=b.N.f.quat;h.multiply(h.invert(b.bh,b.bh),w,w);h.multiply(c,w,w);z.transformMat4(b.offset,d,x);h.copy(c,b.bh);x=a.f.quat;w=h.multiply(b.N.f.quat,b.Zb,m);w=u.Ws(w,D);x=u.Ws(x,B);u.rotate_eye_camera(a,q.ef(x[0],w[0]+b.bz,w[0]+b.az),q.ef(x[1],w[1]+b.$y,w[1]+b.cz));break;case 13:var x=
a.f.i,w=a.f.quat,d=b.N.f.aa,f=b.N.f.i,r=b.nE,k=v,A=m;z.transformMat4(b.offset,d,k);q.smooth_v(k,x,c,r,x);d=v;z.sub(f,x,d);z.normalize(d,d);var E=w,x=y,f=x.subarray(0,3),k=x.subarray(3,6),p=x.subarray(6,9);z.copy(d,k);z.negate(k,k);z.normalize(k,k);Boolean(.999999<Math.abs(z.dot(d,q.AXIS_Y)))?(d=e.fromQuat(h.normalize(E,A),t),z.copy(d.subarray(0,3),f)):z.cross(q.AXIS_Y,k,f);z.normalize(f,f);z.cross(f,k,p);z.normalize(p,p);h.fromMat3(x,A);h.normalize(A,A);q.iv(A,w,c,.16*r,w);break;case 2:w=a.f.quat;
c=J;G.get_bone_tsr(b.N,b.qg,!0,!1,c);g.multiply(b.N.f.za,c,c);w[0]=c[4];w[1]=c[5];w[2]=c[6];w[3]=c[7];b.Zb&&(h.copy(b.Zb,w),h.multiply(w,b.Zb,w));a.f.scale=b.uk*c[3];g.transform_vec3(b.offset,c,a.f.i);break;case 3:x=a.f.i;w=a.f.quat;c=b.N.f.i;n(x,w,c);break;case 4:x=a.f.i;w=a.f.quat;c=b.target;n(x,w,c);break;case 5:x=a.f.i;w=a.f.quat;c=b.N.f.i;n(x,w,c);w=z.dist(x,c);if(w=w>b.dist_max?w-b.dist_max:w<b.Aj?w-b.Aj:0)z.sub(c,x,v),z.normalize(v,v),z.scale(v,w,v),z.add(x,v,x);break;case 6:x=a.f.i;w=a.f.quat;
c=b.target;n(x,w,c);w=z.dist(x,c);if(w=w>b.dist_max?w-b.dist_max:w<b.Aj?w-b.Aj:0)z.sub(c,x,v),z.normalize(v,v),z.scale(v,w,v),z.add(x,v,x);break;case 7:d=b.N.f.aa;z.transformMat4(b.offset,d,a.f.i);break;case 8:f=b.N.f.i;x=a.f.i;z.add(f,b.offset,x);break;case 14:w=a.f.quat;d=b.N.f.aa;c=b.N.f.quat;b.Zb?(h.copy(b.Zb,w),h.multiply(c,w,w)):h.copy(c,w);z.transformMat4(b.offset,d,a.f.i);break;case 11:x=b.N.f;c=g.create_sep(x.i,x.scale,x.quat,J);x=b.Om;g.multiply(c,x,c);x=a.f.i;x[0]=c[0];x[1]=c[1];x[2]=c[2];
a.f.scale=c[3];w=a.f.quat;w[0]=c[4];w[1]=c[5];w[2]=c[6];w[3]=c[7];break;case 12:x=b.Om;c=J;G.get_bone_tsr(b.N,b.qg,!0,!1,c);g.multiply(b.N.f.za,c,c);g.multiply(c,x,c);x=a.f.i;x[0]=c[0];x[1]=c[1];x[2]=c[2];a.f.scale=c[3];w=a.f.quat;w[0]=c[4];w[1]=c[5];w[2]=c[6];w[3]=c[7];break;case 15:c=b.N,w=u.gB(c),x=a.f.i,r=u.Nl(w,"TOP"),A=u.Nl(w,"BOTTOM"),d=r-A,b.Nt?(f=u.Nl(w,"LEFT"),x[0]=f+d*b.Zo):(f=u.Nl(w,"RIGHT"),x[0]=f-d*b.Zo),x[2]=b.Ev?-(r-d*b.uq):-(A+d*b.uq),u.TB(w)?x[1]=-b.distance:(x[1]=-1,z.normalize(x,
x),z.scale(x,b.distance/Math.abs(x[1]),x)),g.transform_dir_vec3(x,c.f.za,x),z.add(c.f.i,x,x),w=a.f.quat,b.Zb?(h.copy(b.Zb,w),h.multiply(c.f.quat,w,w)):h.copy(c.f.quat,w)}"CAMERA"==a.f.type&&(x=q.AXIS_Y,10==b.type&&(c=b.N.f.quat,x=z.transformQuat(x,c,C)),u.Cq(a),l(a,x))}function f(a,b){switch(b.type){case 1:var c=b.target.f.za,w=J;g.invert(a.f.za,w);g.multiply(w,c,w);G.set_bone_tsr(a,b.qg,w,!1)}a.qp=!0}function n(a,b,c){var w=v;q.quat_to_dir(b,q.AXIS_MY,w);z.normalize(w,w);var d=E;z.subtract(c,a,d);
z.normalize(d,d);a=q.ED(w,d,r);h.multiply(a,b,b);h.normalize(b,b)}function l(a,b){var c=a.f,w=c.quat,d=q.quat_to_dir(c.quat,q.AXIS_Y,v);z.normalize(d,d);if(.999999<Math.abs(z.dot(b,d)))d=h.identity(m);else{var x=z.cross(b,d,E);z.normalize(x,x);if(c.Da==u.MS_TARGET_CONTROLS)c.rq&&z.negate(x,x);else{var e=q.quat_to_dir(c.quat,q.AXIS_Z,A);0<z.dot(e,b)&&z.negate(x,x)}c=q.quat_to_dir(c.quat,q.AXIS_X,A);z.normalize(c,c);var e=q.clamp(z.dot(c,x),-1,1),g=Math.acos(e),d=-.999999>=e?h.setAxisAngle(d,g,m):h.rotationTo(c,
x,m);h.normalize(d,d)}h.multiply(d,w,w);u.Cq(a)}var u=p("__camera"),e=p("__mat3"),h=p("__quat"),g=p("__tsr"),q=p("__util"),z=p("__vec3"),G=p("__armature");a.uG=1;a.tG=2;a.yG=3;a.zG=4;a.oG=5;a.pG=6;a.vG=7;a.nG=8;a.sG=9;a.rG=10;a.lG=11;a.mG=12;a.qG=13;a.wG=14;a.xG=15;a.kG=1;var D=new Float32Array(2),B=new Float32Array(2),v=new Float32Array(3),E=new Float32Array(3),A=new Float32Array(3),r=new Float32Array(4),m=new Float32Array(4),y=new Float32Array(9),t=new Float32Array(9),J=new Float32Array(8),C=new Float32Array(3);
a.qr=function(a,b,e,w,g){var x=d(1);x.N=b;x.offset=new Float32Array(e);x.Zb=w?new Float32Array(w):null;x.uk=g;c(a,x);k(a,x,0)};a.Zx=function(a,b,e,w,g,x){var f=d(2);f.N=b;f.qg=e;f.offset=new Float32Array(w);f.Zb=g?new Float32Array(g):null;f.uk=x;c(a,f);k(a,f,0)};a.Yx=function(a,b,e,w){var g=d(9),x=a.f.quat,f=b.f.quat;g.N=b;g.offset=new Float32Array(e);g.bh=new Float32Array(f);w&&(h.copy(w,x),h.multiply(f,x,x));c(a,g);k(a,g,0)};a.Xx=function(a,b,e,w,g,x,f,m){var t=d(10),r=a.f.quat,C=b.f.quat;t.N=b;
t.offset=new Float32Array(e);t.bh=new Float32Array(C);t.az=q.angle_wrap_0_2pi(g);t.bz=q.angle_wrap_0_2pi(x);t.cz=q.angle_wrap_periodic(f,-Math.PI,Math.PI);t.$y=q.angle_wrap_periodic(m,-Math.PI,Math.PI);w?(t.Zb=new Float32Array(w),h.copy(w,r),h.multiply(C,r,r)):t.Zb=h.create();c(a,t);k(a,t,0)};a.Wx=function(a,b,e,w){var g=d(13);g.N=b;g.offset=new Float32Array(e);g.nE=w;c(a,g);k(a,g,0)};a.by=function(a,b,e,w){var g=d(14);g.N=b;g.offset=new Float32Array(e);g.uk=1;g.Zb=w?new Float32Array(w):null;c(a,
g);k(a,g,0)};a.wI=b;a.cy=function(a,b){var e=d(3);e.N=b;c(a,e);k(a,e,0)};a.dy=function(a,b){var e=d(4);e.target=new Float32Array(b);c(a,e);k(a,e,0)};a.Sx=function(a,b,e,w){var g=d(5);g.N=b;g.Aj=e;g.dist_max=w;c(a,g);k(a,g,0)};a.Tx=function(a,b,e,w){var g=d(6);g.target=new Float32Array(b);g.Aj=e;g.dist_max=w;c(a,g);k(a,g,0)};a.ay=function(a,b,e){var w=d(7);w.N=b;w.offset=new Float32Array(e);c(a,w);k(a,w,0)};a.Rx=function(a,b,e){var w=d(8);w.N=b;w.offset=new Float32Array(e);c(a,w);k(a,w,0)};a.Px=function(a,
b,e){var w=d(11);w.N=b;w.Om=new Float32Array(e);c(a,w);k(a,w,0)};a.Qx=function(a,b,e,w){var g=d(12);g.N=b;g.qg=e;g.Om=new Float32Array(w);c(a,g);k(a,g,0)};a.append_stiff_viewport=function(a,b,e){var w=d(15);w.N=b;if("left"in e)w.Nt=!0,w.Zo=e.left;else if("right"in e)w.Nt=!1,w.Zo=e.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}if("top"in e)w.Ev=!0,w.uq=e.top;else if("bottom"in e)w.Ev=!1,w.uq=e.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");
return}"distance"in e?(w.distance=e.distance,w.Zb="rotation"in e?new Float32Array(e.rotation):null,c(a,w),k(a,w,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.kF=function(a,b){a.Ja&&k(a,a.Ja,b)};a.$x=function(a,b,c,w,e){var x=d(1);x.qg=c;x.target=b;x.offset=new Float32Array(w);x.Zb=e?new Float32Array(e):null;x.uk=1;b=x.target;c=x.qg;w=a.f.fd[c];e=b.Pn;for(var g=0;g<e;g++){var h=e[g];if(h[0]==a&&h[1]==c){e.splice(g,1);break}}b.Pn.push([a,c]);w.Ja=x;f(a,x)};a.dF=function(a,
b){var c=a.f.fd[b];c.Ja&&f(a,c.Ja)};a.DD=n;a.correct_up=l;a.Sy=function(a){return a.Ja?!0:!1};a.remove=function(a){a.Ja.N&&b(a.Ja.N,a);a.Ja=null};a.OH=function(a){return a.Ja?a.Ja.type:null};a.od=function(a){a=a.Ja;return!a||11!=a.type&&12!=a.type?!1:!0};a.Ml=function(a){if((a=a.Ja)&&11==a.type)return a.N.f.za;if(a&&12==a.type){var b=J;G.get_bone_tsr(a.N,a.qg,!0,!1,b);g.multiply(a.N.f.za,b,b);return b}return null};a.nd=function(a){a=a.Ja;return!a||11!=a.type&&12!=a.type?null:a.Om}};b4w.module.__container=function(a,p){var d,c,b,k,f;function n(a,b){d=a;c=b}function l(){var a=h.getBoundingClientRect();n(a.left,a.top)}var u=p("__print"),e=p("__util"),h=null,g=null,q=!1;k=b=0;f=1;d=c=0;a.get_canvas=function(){return h};a.get_container=function(){return g};a.init=function(a){a&&a.parentNode?(h=a,g=a.parentNode):e.ba("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":g.insertBefore(a,g.firstElementChild);break;case "JUST_BEFORE_CANVAS":g.insertBefore(a,
h);break;case "JUST_AFTER_CANVAS":h.nextElementSibling?g.insertBefore(a,h.nextElementSibling):g.appendChild(a,h);break;case "LAST":g.appendChild(a,h);break;default:u.error(b+" invalid stack order")}};a.vB=function(){return b};a.uB=function(){return k};a.set_canvas_offsets=n;a.update_canvas_offsets=l;a.gE=function(a,c,d){b=a;k=c;f=d;l()};a.force_offsets_updating=function(){q=!0};a.client_to_canvas_coords=function(a,b,e){e||(e=new Float32Array(2));var g=e;q&&(l(),q=!1);g[0]=a-d;a=e;q&&(l(),q=!1);a[1]=
b-c;return e};a.Gn=function(a,c,d,e){d||(d=new Float32Array(2));d[0]=a*f;d[1]=c*f;e&&(a=e.width/b,d[0]*=a,d[1]*=a);return d};a.YF=function(a,c,d,e){d||(d=new Float32Array(2));d[0]=a/f;d[1]=c/f;e&&(a=e.width/b,d[0]/=a,d[1]/=a)};a.At=function(b){return b&&b.parentNode?b.parentNode==g?!0:a.At(b.parentNode):!1};a.Hs=function(a){var b=document.getElementsByTagName("script");a=e.ck(a);for(var c=0;c<b.length;c++)if(b[c].src==a)return b[c];return null}};b4w.module.__controls=function(a,p){function d(a){return{type:a,value:0,ia:null,zd:!1,key:0,gb:"",Td:!1,Ln:null,Kn:function(){},Jn:null,Yr:function(){},Oe:null,from:new Float32Array(3),to:new Float32Array(3),zt:!1,Sl:!1,Fu:0,Eu:function(){},axis:"",Yc:0,Ni:new Float32Array(3),tm:new Float32Array(4),threshold:0,Bu:new Float32Array(4),el:0,cl:0,Mu:0,fl:0,Rc:0,repeat:!1,yr:!1,Rl:0,Ql:0,Pl:0,Io:0,Ho:0,Go:0}}function c(a,b){a.value=Number(b)}function b(a){for(var b=a.Id,c=a.MD,w=0;w<b.length;w++)c[w]=
b[w].value;return a.tC(c)}function k(a){a=w.indexOf(a);-1<a?w.splice(a,1):m.error("Wrong object")}function f(a,b){for(var c=0,w=0;w<b.length;w++)for(var d=b[w].Jf,x=0;x<d.length;x++)for(var e=d[x].Id,g=0;g<e.length;g++)e[g]===a&&c++;return c}function n(a,b){switch(a.type){case 80:y.remove_collision_test(a.Ln,a.gb,a.Kn);a.zd=!0;break;case 90:y.clear_collision_impulse_test(a.Jn);a.zd=!0;break;case 100:y.remove_ray_test(a.Fu);a.zd=!0;break;case 130:a.zd=!0}var c=b.indexOf(a);-1<c&&b.splice(c,1)}function l(a){for(var b=
0;b<K.length;b++){var w=K[b];20==w.type&&a.keyCode==w.key&&c(w,1)}O&&a.preventDefault();ga&&ga(a)}function u(a){for(var b=0;b<K.length;b++){var w=K[b];20==w.type&&0==a.keyCode&&16==w.key&&c(w,0);20==w.type&&a.keyCode==w.key&&c(w,0)}O&&a.preventDefault();ga&&ga(a)}function e(a){var b=!1,w=null;R=!0;ba=a.clientX;ea=a.clientY;U=a.clientX;aa=a.clientY;for(var d=0;d<K.length;d++){var x=K[d];50==x.type&&(c(x,1),x.ia=a.which);160==x.type&&(b||(b=A.client_to_canvas_coords(a.clientX,a.clientY,oa),w=r.pick_object(b[0],
b[1]),b=!0),x.value=w==x.Oe?1:0)}S&&a.preventDefault();fa&&fa(a)}function h(a){for(var b=0;b<K.length;b++){var w=K[b];50==w.type&&c(w,0);160==w.type&&w.yr&&(w.value=0)}R=!1;S&&!ia&&a.preventDefault();fa&&fa(a)}function g(a){var b=a.clientX,w=a.clientY;U=b;aa=w;if(!N.No||R)for(var d=b-ba,x=w-ea,H=Math.sqrt(d*d+x*x),e=0;e<K.length;e++){var g=K[e];if(40===g.type)switch(g.axis){case "X":c(g,d);g.ia=b;break;case "Y":c(g,x);g.ia=w;break;case "XY":c(g,H),g.ia[0]=b,g.ia[1]=w}}S&&!ia&&a.preventDefault();fa&&
fa(a)}function q(a){A.At(a.relatedTarget)||h(a)}function z(a){var b=a.wheelDelta||-40*a.detail,b=b*F.JC;V+=b;for(b=0;b<K.length;b++){var w=K[b];30===w.type&&c(w,V)}ra&&a.preventDefault();ka&&ka(a)}function G(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.clientX,c=c.clientY,w=!1,d=null,x=0;x<K.length;x++){var e=K[x];160==e.type&&(w||(w=A.client_to_canvas_coords(b,c,oa),d=r.pick_object(w[0],w[1]),w=!0),e.value=d==e.Oe)}T[0]=b;T[1]=-1;ca[0]=c;ca[1]=-1}else 1<b.length&&(na=ma=v(b),T[0]=
b[0].clientX,T[1]=b[1].clientX,ca[0]=b[0].clientY,ca[1]=b[1].clientY);X.set(T);Q.set(ca);da&&da(a)}function D(b){var w=b.targetTouches;if(0!==w.length){if(1===w.length){X[0]=w[0].clientX;X[1]=-1;Q[0]=w[0].clientY;Q[1]=-1;var w=X[0]-T[0],d=Q[0]-ca[0],x=Math.sqrt(w*w+d*d);if(-1!=T[1]&&-1!=ca[1]){var e=X[0]-T[1],H=Q[0]-ca[1],g=Math.sqrt(e*e+H*H);g<x&&(w=e,d=H,x=g)}for(g=0;g<K.length;g++){var f=K[g];if(60===f.type)switch(f.ia=a.PL_SINGLE_TOUCH_MOVE,f.axis){case "X":c(f,w);break;case "Y":c(f,d);break;
case "XY":c(f,x)}}}else if(1<w.length){X[0]=w[0].clientX;X[1]=w[1].clientX;Q[0]=w[0].clientY;Q[1]=w[1].clientY;na=v(w);x=na-ma;e=oa;e[0]=(X[0]+X[1])/2;e[1]=(Q[0]+Q[1])/2;H=ha;H[0]=(T[0]+T[1])/2;H[1]=(ca[0]+ca[1])/2;var h,w=e[0],d=e[1],g=H[0],f=H[1];h=Math.sqrt((w-g)*(w-g)+(d-f)*(d-f));for(g=0;g<K.length;g++)if(f=K[g],70===f.type&&Math.abs(h)<Math.abs(x)&&(f.ia=a.PL_MULTITOUCH_MOVE_ZOOM,c(f,x)),60===f.type&&Math.abs(h)>Math.abs(x))switch(f.ia=a.PL_MULTITOUCH_MOVE_PAN,f.axis){case "X":w=e[0]-H[0];c(f,
w);break;case "Y":d=e[1]-H[1];c(f,d);break;case "XY":c(f,h)}}P&&b.preventDefault();da&&da(b)}}function B(a){for(var b=0;b<K.length;b++){var w=K[b];if(170==w.type||180==w.type)w.Ql=a.beta,w.Rl=a.gamma,w.Pl=a.alpha,w.value||(w.Io=a.gamma,w.Ho=a.beta,w.Go=a.alpha,c(w,1))}}function v(a){var b=a[0],w=a[1];a=b.clientX;var b=b.clientY,c=w.clientX,w=w.clientY;return Math.sqrt((a-c)*(a-c)+(b-w)*(b-w))}var E=p("__config"),A=p("__container"),r=p("__objects"),m=p("__print"),y=p("__physics"),t=p("__quat"),J=p("__time"),
C=p("__util"),I=p("__vec3"),F=E.controls,N=E.q,w=[],K=[],x={},V=0,U=0,aa=0,ba=0,ea=0,R=!1,X=new Float32Array(2),Q=new Float32Array(2),T=new Float32Array(2),ca=new Float32Array(2),oa=new Float32Array(2),ha=new Float32Array(2),na=0,ma=0,W=!1,M=0,O=!1,S=!1,ra=!1,P=!1,ia=!1,ga=null,fa=null,ka=null,da=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.CT_CHANGE=50;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(d,e){for(var g=0;g<K.length;g++){var f=
K[g],h=d,H=e;if(H)switch(f.type){case 110:var m=f.Oe,r=m.f.i,m=m.f.quat,q=I.dist(f.Ni,r),v=f.Bu;t.invert(f.tm,v);t.multiply(m,v,v);t.normalize(v,v);v=Math.abs(2*Math.acos(v[3]));q/=H;f.el=C.smooth(q,f.el,H,.3);f.ia[0]=q;q=v/H;f.cl=C.smooth(q,f.cl,H,.3);f.ia[1]=q;f.el>=f.threshold||f.cl>=f.Mu?c(f,1):c(f,0);I.copy(r,f.Ni);t.copy(m,f.tm);f.Yc=h;break;case 120:m=f.Oe;r=m.f.i;m=Math.abs(r[1]-f.Ni[1])/H;f.fl=C.smooth(m,f.fl,H,.3);f.ia=m;f.fl>=f.threshold?c(f,1):c(f,0);I.copy(r,f.Ni);f.Yc=h;break;case 130:!f.zd&&
0<=f.Rc&&h-f.Yc>=f.Rc&&(c(f,1),f.repeat?f.Yc=h:f.Rc=-f.Rc);break;case 140:f.Yc||(f.Yc=h);c(f,h-f.Yc);f.Yc=h;break;case 150:c(f,h);break;case 170:f.ia[0]=Math.PI*(f.Rl-f.Io)/180;f.ia[1]=Math.PI*(f.Ql-f.Ho)/180;f.ia[2]=Math.PI*(f.Pl-f.Go)/180;f.Io=f.Rl;f.Ho=f.Ql;f.Go=f.Pl;break;case 180:f.ia[0]=Math.PI*f.Rl/180,f.ia[1]=Math.PI*f.Ql/180,f.ia[2]=Math.PI*f.Pl/180}}for(g=0;g<w.length;g++)for(H=w[g],f=H.Jf,h=0;h<f.length;h++)if(r=f[h],r.Hv!=M){r.Hv=M;v=r;m=0;switch(v.type){case a.CT_CONTINUOUS:m=v.Ge;(q=
b(v))?(m=1,v.Ge=1):1==m?(m=-1,v.Ge=-1):m=0;break;case a.CT_TRIGGER:m=v.Ge;(q=b(v))&&-1==m?(m=1,v.Ge=1):q||1!=m?m=0:(m=-1,v.Ge=-1);break;case a.CT_SHOT:m=v.Ge;(q=b(v))&&-1==m?(m=1,v.Ge=1):q||1!=m?m=0:(m=0,v.Ge=-1);break;case a.CT_LEVEL:q=b(v);v.Kt!=q?(m=1,v.Kt=q):m=0;break;case a.CT_CHANGE:for(var q=v.Id,v=v.ZB,n=0;n<q.length;n++){var F=q[n].value;m||F==v[n]||(m=1);v[n]=F}break;default:C.ba("Wrong sensor manifold type: "+v.type)}if(m&&(q=H==x?null:H,W=!1,r.callback(q,r.id,m,r.Hy),W)){g=-1;break}}for(g=
0;g<w.length;g++)for(H=w[g],f=H.Jf,h=0;h<f.length;h++)for(r=f[h],H=r.Id,r=0;r<H.length;r++)switch(m=H[r],m.type){case 30:c(m,0);break;case 40:c(m,0);break;case 60:c(m,0);break;case 70:c(m,0);break;case 130:c(m,0)}V=0;ba=U;ea=aa;T.set(X);ca.set(Q);ma=na;M++};a.create_custom_sensor=function(a){var b=d(10);c(b,a);return b};a.create_keyboard_sensor=function(a){var b=d(20);b.key=a;return b};a.create_collision_sensor=function(a,b,w){if(!a||!y.K(a))return m.error("Wrong collision object"),null;var x=d(80);
x.Ln=a;x.gb=b;x.Td=w;x.ia={coll_obj:null,coll_pos:w?new Float32Array(3):null,coll_norm:w?new Float32Array(3):null,coll_dist:0};x.Kn=function(a,b,w,d,e){c(x,a);a=x.ia;a.coll_obj=b;x.Td&&(a.coll_pos.set(w),a.coll_norm.set(d),a.coll_dist=e)};x.zd=!0;return x};a.create_collision_impulse_sensor=function(a){if(!a||!a.m)return m.error("Wrong collision impulse object"),null;var b=d(90);b.Jn=a;b.Yr=function(a){c(b,a)};b.zd=!0;return b};a.create_ray_sensor=function(a,b,w,x,e,f,g){var h=d(100);h.Oe=a;h.from=
b;h.to=w;h.gb=x;h.zt=e;h.Td=f;h.Sl=g;h.ia={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};h.Eu=function(a,b,w,d,x,e){h.zt?c(h,-1==b?0:1):c(h,b);h.ia.hit_fract=b;h.ia.obj_hit=w;h.ia.hit_time=d;h.Td&&(h.ia.hit_pos.set(x),h.ia.hit_norm.set(e))};h.zd=!0;return h};a.create_mouse_click_sensor=function(){return d(50)};a.create_mouse_wheel_sensor=function(){return d(30)};a.create_mouse_move_sensor=function(a){var b=d(40);b.axis=a||"XY";b.ia="XY"==b.axis?new Float32Array(2):
0;return b};a.create_touch_move_sensor=function(a){var b=d(60);b.axis=a||"XY";b.ia=0;return b};a.create_touch_zoom_sensor=function(){var a=d(70);a.ia=0;return a};a.create_motion_sensor=function(a,b,w){if(!a)return m.error("Wrong collision object"),null;var c=d(110);c.Oe=a;var x=a.f.i;a=a.f.quat;c.Bu=new Float32Array(4);c.Ni=new Float32Array(x);c.tm=new Float32Array(a);c.el=0;c.cl=0;c.threshold=b||.1;c.Mu=w||.1;c.Yc=0;c.ia=new Float32Array([0,0]);return c};a.create_vertical_velocity_sensor=function(a,
b){if(!a)return m.error("Wrong collision object"),null;var w=d(120);w.Oe=a;var c=a.f.quat;w.Ni=new Float32Array(a.f.i);w.tm=new Float32Array(c);w.fl=0;w.threshold=b||1;w.Yc=0;w.ia=0;return w};a.create_timer_sensor=function(a,b){var w=d(130);w.Rc=a;w.repeat=b;w.zd=!0;return w};a.reset_timer_sensor=function(a,b,w,c){a=a||x;a=a.Hd;if(!a||!a[b])return m.error("reset_timer_sensor(): wrong object"),null;b=a[b].Id[w];if(!b)return m.error("reset_timer_sensor(): sensor not found"),null;b.Yc=J.get_timeline();
b.Rc=c};a.create_elapsed_sensor=function(){var a=d(140);a.Yc=0;return a};a.create_gyro_delta_sensor=function(){var a=d(170);a.ia=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=d(180);a.ia=new Float32Array(3);return a};a.create_timeline_sensor=function(){return d(150)};a.create_selection_sensor=function(a,b){var w=d(160);w.Oe=a;w.yr=b;return w};a.LD=c;a.get_sensor_value=function(a,b,w){a=a||x;a=a.Hd;if(!a||!a[b])return m.error("get_sensor_value(): wrong object"),null;b=
a[b].Id[w];return b?b.value:(m.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,w){a=a||x;a=a.Hd;if(!a||!a[b])return m.error("get_sensor_payload(): wrong object"),null;b=a[b].Id[w];return b?b.ia:(m.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){w=[];K=[];x={}};a.check_sensor_manifold=function(a,b){a=a||x;if(!a.Hd)return!1;if(b&&a.Hd[b])return!0;if(!b)for(var w in a.Hd)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||
x;var c=a.Hd;if(c){var d=a.Jf;if(b){var e=c[b];if(e){for(var g=e.Id,h=0;h<g.length;h++)1===f(g[h],w)&&n(g[h],K);delete c[b];e=d.indexOf(e);-1<e?d.splice(e,1):C.ba("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||k(a)}}else{for(b in c){e=c[b];g=e.Id;for(h=0;h<g.length;h++)1===f(g[h],w)&&n(g[h],K);delete c[b];e=d.indexOf(e);-1<e?d.splice(e,1):C.ba("Incorrect manifolds array")}k(a);W=!0}}};a.create_sensor_manifold=function(a,b,c,d,e,g,h){a=a||x;a.Jf=a.Jf||[];a.Hd=a.Hd||{};var m=a.Hd,
r=a.Jf,t=m[b];if(t){d=t.Id;for(var v=0;v<d.length;v++)1===f(d[v],w)&&n(d[v],K);t=r.indexOf(t);-1<t?r.splice(t,1):C.ba("Incorrect manifolds array")}c={id:b,type:c,Id:d.slice(0),tC:e,MD:Array(d.length),callback:g,Hy:h,Ge:-1,Kt:0,ZB:Array(d.length),Hv:-1};m[b]=c;r.push(c);-1==w.indexOf(a)&&w.push(a);a=c.Id;for(b=0;b<a.length;b++){m=a[b];if(m.zd){switch(m.type){case 80:y.append_collision_test(m.Ln,m.gb,m.Kn,m.Td);break;case 90:y.apply_collision_impulse_test(m.Jn,m.Yr);break;case 100:m.Fu=y.append_ray_test(m.Oe,
m.from,m.to,m.gb,m.Eu,!1,!1,m.Td,m.Sl);break;case 130:m.Yc=J.get_timeline(),0>m.Rc&&(m.Rc=-m.Rc)}m.zd=!1}-1==K.indexOf(m)&&K.push(m)}W=!0};a.ss=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.Yz=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<w.length;a++){var b=w[a],c=b.Hd,b=b.Jf,d;for(d in c)delete c[d];b.splice(0,b.length)}for(a=0;a<K.length;a++)n(K[a],K),a--;w.splice(0,w.length)};a.debug=function(){m.log(String(w.length)+
" objects with manifolds",w);m.log(String(K.length)+" sensors",K);for(var a=[],b=[],c=0;c<K.length;c++){var d=K[c];80==d.type&&a.push(d);100==d.type&&b.push(d)}m.log(String(a.length)+" collision sensors",a);m.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",l,!1);a.addEventListener("keyup",u,!1);O=b};a.register_mouse_events=function(a,b,w){if(w)var c=window;else c=a,c.addEventListener("mouseout",q,!1);a.addEventListener("mousedown",e,!1);
c.addEventListener("mousemove",g,!1);c.addEventListener("mouseup",h,!1);S=b;ia=w};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",z,!1);a.addEventListener("DOMMouseScroll",z,!1);ra=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",G,!1);a.addEventListener("touchmove",D,!1);document.addEventListener("touchstart",function(){});P=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&N.gyro_use&&window.addEventListener("deviceorientation",
B,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",l,!1);a.removeEventListener("keyup",u,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",e,!1);a.removeEventListener("mousemove",g,!1);a.removeEventListener("mouseout",q,!1);a.removeEventListener("mouseup",h,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",z,!1);a.removeEventListener("DOMMouseScroll",z,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",
G,!1);a.removeEventListener("touchmove",D,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&N.gyro_use&&window.removeEventListener("deviceorientation",B,!1)};a.OG=function(a){ga=a};a.PG=function(a){fa=a};a.RG=function(a){ka=a};a.QG=function(a){da=a}};b4w.module.__curve=function(a,p){function d(a,b,c,d,e){var h=d.length;e||(e=new Float32Array(h));for(var g=h+a,q=new Float32Array(g),k=1;k<=g-1;k++)q[k-1]=b>=c[k-1]&&b<c[k+1-1]?1:0;for(var p=2;p<=a;p++)for(k=1;k<=g-p;k++)q[k-1]=(0!=q[k-1]?(b-c[k-1])*q[k-1]/(c[k+p-1-1]-c[k-1]):0)+(0!=q[k+1-1]?(c[k+p-1]-b)*q[k+1-1]/(c[k+p-1]-c[k+1-1]):0);b==c[g-1]&&(q[h-1]=1);a=0;for(k=1;k<=h;k++)a+=q[k-1]*d[k-1];for(k=1;k<=h;k++)e[k-1]=0!=a?q[k-1]*d[k-1]/a:0;return e}function c(a){a=a.$l;return a[a.length-1]}function b(a){a=
a.os;return a[a.length-1]}p("__print");var k=p("__util");a.Iz=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var k=a.order_u;b.Af=k;a=a.points;var e=a.length/5,h=[],g=e+k,e=e+2;h[0]=0;for(var q=2;q<=g;q++)h[q-1]=q>k&&q<e?h[q-2]+1:h[q-2];b.$l=h;if("2D"==c.dimensions)b.tf=!1;else if("3D"==c.dimensions)b.tf=!0;else throw"Wrong curve dimensions";k=[];h=[];for(c=0;c<a.length;c+=5)k.push(a[c]),k.push(a[c+1]),k.push(a[c+2]),b.tf&&k.push(a[c+3]),h.push(a[c+
4]);b.Rn=k;b.Qq=h;a=[];for(var c=b.Rn,k=b.tf?4:3,h=b.Qq,g=b.$l,e=b.Af,q=c.length/k,z=q+e,p=0,D=g[z-1]/999,B=0;1E3>B;B++){5E-6>g[z-1]-p&&(p=g[z-1]);for(var v=d(e,p,g,h),E=0;E<k;E++)for(var A=a[k*B+E]=0;A<q;A++)a[k*B+E]+=v[A]*c[k*A+E];p+=D}k=b.tf?4:3;h=new Float32Array(1E3);h[0]=0;for(c=1;1E3>c;c+=1)g=a[(c-1)*k],e=a[(c-1)*k+1],q=a[(c-1)*k+2],z=a[c*k],p=a[c*k+1],D=a[c*k+2],h[c]=h[c-1]+Math.sqrt((z-g)*(z-g)+(p-e)*(p-e)+(D-q)*(D-q));b.os=h;return b};a.zE=function(a,b,k){k||(k=[]);var u=b,e=Math.max(u,
0);b=e=Math.min(u,c(a));var u=a.Rn,e=a.tf?4:3,h=a.Qq,g=a.$l,q=a.Af;a=u.length/e;var z=a+q;5E-6>g[z-1]-b&&(b=g[z-1]);z=new Float32Array(a);d(q,b,g,h,z);for(b=0;b<e;b++)for(h=k[b]=0;h<a;h++)k[b]+=z[h]*u[e*h+b]};a.wE=function(a,b,c){c||(c=[]);var d=a.Rn,e=a.tf?4:3,h=a.Qq,g=a.$l,q=a.Af;a=d.length/e;var k=a+q;5E-6>g[k-1]-b&&(b=g[k-1]);var k=new Float32Array(a),p=b;b=k;var D=h.length;b||(b=new Float32Array(D));var B=new Float32Array(D),v=new Float32Array(D),E=B,A=v;E||(E=new Float32Array(D));A||(A=new Float32Array(D));
for(var r=D+q,m=new Float32Array(r),y=new Float32Array(r),t=1;t<=r-1;t++)m[t-1]=p>=g[t-1]&&p<g[t+1-1]?1:0;p==g[r-1]&&(m[D-1]=1);for(var J=2;J<=q;J++)for(t=1;t<=r-J;t++){var C=0!=m[t-1]?m[t-1]/(g[t+J-1-1]-g[t-1]):0,I=0!=m[t+1-1]?-m[t+1-1]/(g[t+J-1]-g[t+1-1]):0,F=0!=y[t-1]?(p-g[t-1])*y[t-1]/(g[t+J-1-1]-g[t-1]):0,N=0!=y[t+1-1]?(g[t+J-1]-p)*y[t+1-1]/(g[t+J-1]-g[t+1-1]):0;m[t-1]=(0!=m[t-1]?(p-g[t-1])*m[t-1]/(g[t+J-1-1]-g[t-1]):0)+(0!=m[t+1-1]?(g[t+J-1]-p)*m[t+1-1]/(g[t+J-1]-g[t+1-1]):0);y[t-1]=C+I+F+N}for(t=
1;t<=D;t++)E[t-1]=m[t-1],A[t-1]=y[t-1];g=0;for(q=1;q<=D;q++)g+=B[q-1]*h[q-1];p=0;for(q=1;q<=D;q++)p+=v[q-1]*h[q-1];for(q=1;q<=D;q++)b[q-1]=0!=g?v[q-1]*h[q-1]/g+B[q-1]*h[q-1]*p/(g*g):0;for(h=0;h<e;h++)for(g=c[h]=0;g<a;g++)c[h]+=k[g]*d[e*g+h]};a.FI=c;a.yE=b;a.xE=function(a,d){if(0>=d)return 0;var l=c(a);if(d>=b(a))return l;var u=a.os,e=k.hl(u,d,0,u.length-1);return l*(e+(d-u[e])/(u[e+1]-u[e]))/1E3}};b4w.module.__dds=function(a,p){function d(a,b,c,d){var e=new Uint16Array(4),f=new Uint16Array(c*d),n=0,v=0,k=0,l=v=n=0,r=0,m=0,y=0,t=c/4;d/=4;for(var u=0;u<d;u++)for(var C=0;C<t;C++)k=b+4*(u*t+C),e[0]=a[k],e[1]=a[k+1],n=e[0]&31,v=e[0]&2016,l=e[0]&63488,r=e[1]&31,m=e[1]&2016,y=e[1]&63488,e[2]=5*n+3*r>>3|5*v+3*m>>3&2016|5*l+3*y>>3&63488,e[3]=5*r+3*n>>3|5*m+3*v>>3&2016|5*y+3*l>>3&63488,n=a[k+2],v=4*u*c+4*C,f[v]=e[n&3],f[v+1]=e[n>>2&3],f[v+2]=e[n>>4&3],f[v+3]=e[n>>6&3],v+=c,f[v]=e[n>>8&3],f[v+1]=e[n>>
10&3],f[v+2]=e[n>>12&3],f[v+3]=e[n>>14],n=a[k+3],v+=c,f[v]=e[n&3],f[v+1]=e[n>>2&3],f[v+2]=e[n>>4&3],f[v+3]=e[n>>6&3],v+=c,f[v]=e[n>>8&3],f[v+1]=e[n>>10&3],f[v+2]=e[n>>12&3],f[v+3]=e[n>>14];return f}function c(a,b,c,k){var p=new Int32Array(c,0,31),D,B,v,E,A,r;if(542327876!=p[0])return n.error("Invalid magic number in DDS header"),0;if(!p[20]&4)return n.error("Unsupported format, must contain a FourCC code"),0;D=p[21];switch(D){case l:B=8;v=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case u:B=16;v=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case e:B=16;v=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return n.error("Unsupported FourCC code:",f(D)),null}r=1;p[2]&131072&&!1!==k&&(r=Math.max(1,p[7]));E=p[4];A=p[3];p=p[1]+4;if(b)for(D=0;D<r;++D)k=Math.max(4,E)/4*Math.max(4,A)/4*B,b=new Uint8Array(c,p,k),a.compressedTexImage2D(a.TEXTURE_2D,D,v,E,A,0,b),p+=k,E=Math.max(.5*E,1),A=Math.max(.5*A,1);else if(D==l)Math.max(4,E),Math.max(4,A),b=new Uint16Array(c),c=d(b,p/2,E,A),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,E,A,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),k&&a.generateMipmap(a.TEXTURE_2D);else return n.error("No manual decoder for",f(D),"and no native support"),0;return r}function b(a,b,d,e,f,n){var k=new XMLHttpRequest;k.open("GET",d,!0);k.responseType="arraybuffer";k.onload=function(){if(200==k.status){a.bindTexture(a.TEXTURE_2D,e);var d=c(a,b,k.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}n&&
n(e)};k.send(null);return e}function k(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var n=p("__print"),l=k("DXT1"),u=k("DXT3"),e=k("DXT5");a.rH=d;a.yF=c;a.jt=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.bB=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case l:b=6;break;case u:case e:b=4;break;default:n.error("Unsupported FourCC code:",f(a))}return b};
a.lI=b;a.kI=function(a,c,d,e){var f=a.createTexture();b(a,c,d,f,!0,e);return f}};b4w.module.__debug=function(a,p){function d(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a,b){typeof a!=typeof b&&l.ba("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var c in a)c in b||l.ba("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||l.ba("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&l.ba("Structure assertion failed: incompatible types for key "+
c)}}var b=p("__extensions"),k=p("__print"),f=p("__textures"),n=p("__time"),l=p("__util"),u=null,e={},h=!1,g={},q=[],z=-1,G=null,D=!1;a.WM_NONE=0;a.WM_OPAQUE_WIREFRAME=1;a.WM_TRANSPARENT_WIREFRAME=2;a.WM_FRONT_BACK_VIEW=3;a.WM_DEBUG_SPHERES=4;a.Jd=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(e[a[d]]=d)}u=a};a.Uy=function(a){if(h){var b=u.getError();b!=u.NO_ERROR&&(b in e?
l.ba("GL Error: "+b+", gl."+e[b]+" ("+a+")"):l.ba("Unknown GL error: "+b+" ("+a+")"))}};a.Py=function(){if(h)switch(u.checkFramebufferStatus(u.FRAMEBUFFER)){case u.FRAMEBUFFER_COMPLETE:break;case u.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case u.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case u.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case u.FRAMEBUFFER_UNSUPPORTED:k.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:k.error("FRAMEBUFFER CHECK FAILED")}};a.Sr=function(){if(-1!=z)return z;u.bindFramebuffer(u.FRAMEBUFFER,u.createFramebuffer());var a=f.wl("DEBUG",f.bj);f.resize(a,1,1);u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,a.cc,a.mb,0);u.checkFramebufferStatus(u.FRAMEBUFFER)!=u.FRAMEBUFFER_COMPLETE?(z=!0,k.warn("depth-only issue was found")):z=!1;u.bindFramebuffer(u.FRAMEBUFFER,null);return z};
a.Vy=function(a,b,c){if(h&&!u.getShaderParameter(a,u.COMPILE_STATUS))throw c=d(c),k.error("shader compilation failed:\n"+c+"\n"+u.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.Wy=function(a,c,e,g,f,q){if(h&&!u.getProgramParameter(a,u.LINK_STATUS)){var t=b.Ys();t&&(f=t.getTranslatedShaderSource(e),q=t.getTranslatedShaderSource(g));f=d(f);q=d(q);k.error("shader linking failed:\n"+f+"\n\n\n"+q+"\n"+u.getProgramInfoLog(a)+" ("+c+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){h=a};a.sH=function(a){g[a]=a in g?g[a]+1:1};a.update=function(){for(var a in g)k.log(a,g[a]),g[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(l.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}q.push(a)};a.msg=function(){for(var a=1,b=0;b<q.length;b++){var c=q[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],l.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);
else c.push(arguments[b]);q.push(c)};var B=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),e=0;e<q.length;e++){var g=q[e];a=g[0];if(!(a<d)){var f=String(g[1]);c[f]||(c[f]=B[b++%B.length]);a=["%c"+(a/1E3).toFixed(6),c[f],f];for(f=2;f<g.length;f++)a.push(g[f]);k.log.apply(this,a)}}q.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-
1E3*a),d=0;d<q.length;d++){var e=q[d];a=e[0];if(!(a<c))for(var g=2;g<e.length;g++){var f=String(e[1]);3<e.length&&(f+="_"+String(g-2));b[f]||(b[f]=f+"\n");b[f]+=String(a)+" "+e[g]+"\n"}}a="";for(f in b)a+=b[f]+"\n\n";k.log(a);q.splice(0)};a.$G=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(l.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.LG=function(a,b){a.constructor!=b&&l.ba("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.MG=c;a.NG=function(a){D?c(a,G):D=!0;G=a};a.fake_load=
function(a,b,c,d,e){(a=a||null)||l.ba("Stage load callback is undefined");b=b||5E3;c=c||0;d=d||100;100<d&&l.ba("Max percentage must be less than 100");0>c&&l.ba("Min percentage must be greater than 0");c>d&&l.ba("Max percentage must be greater than min percentage");var g=n.animate(c,d,b,function(b){b=b.toFixed();a(b);100==b&&(n.clear_animation(g),e&&e())})}};b4w.module.__extensions=function(a,p){function d(a){if(a in k)return k[a];var d=b.getExtension(a)||null;k[a]=d;c.log("%cGET EXTENSION","color: #"+(d?"0a0":"a00"),a);return d}var c=p("__print"),b=null,k={};a.Jd=function(a){b=a};a.gt=function(){return d("WEBGL_compressed_texture_s3tc")||d("WEBKIT_WEBGL_compressed_texture_s3tc")||d("MOZ_WEBGL_compressed_texture_s3tc")};a.dB=function(){return d("WEBGL_depth_texture")||d("WEBKIT_WEBGL_depth_texture")||d("MOZ_WEBGL_depth_texture")};a.WA=function(){return d("EXT_texture_filter_anisotropic")||
d("WEBKIT_EXT_texture_filter_anisotropic")||d("MOZ_EXT_texture_filter_anisotropic")};a.Ys=function(){return d("WEBGL_debug_shaders")};a.ft=function(){return d("WEBGL_debug_renderer_info")};a.Zs=function(){return d("OES_element_index_uint")};a.qB=function(){return d("OES_standard_derivatives")};a.cleanup=function(){k={}}};b4w.module.__graph=function(a,p){function d(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.J.push(b,d)}function c(a,b){for(var c=a.J,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,d,e){e||(e=null);if(c(a,b)&&c(a,d))a.Y.push(b,d,e);else throw"Wrong node IDs";}function k(a,b){if(!c(a,b))throw"Node not found";for(var d=a.J,e=0;e<d.length;e+=2)d[e]==b&&(d.splice(e,2),e-=2)}function f(a,b,c,d){if(!t(a,b,c))throw"Edge not found";a=a.Y;for(var e=0,g=0;g<a.length;g+=
3)if(a[g]==b&&a[g+1]==c){if(-1==d)a.splice(g,3);else{if(d==e){a.splice(g,3);break}e++}g-=3}}function n(a){a=a.J;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function l(a,b){for(var c=a.J,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function u(a){var b=[],c={};e(a,c);for(var d=a.J,g=0;g<d.length;g+=2)0==r(a,d[g])&&h(a,d[g],c,b);return{J:b,Y:a.Y.slice(0)}}function e(a,b){for(var c=a.J,d=0;d<c.length;d+=2)b[c[d]]=!1}function h(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<A(a,b);e++)h(a,
m(a,b,e),c,d);d.unshift(b,E(a,b))}}function g(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<A(a,b);e++){var f=m(a,b,e);g(a,f,c,d)}if(20==d||30==d)for(e=0;e<r(a,b);e++)f=y(a,b,e),g(a,f,c,d)}}function q(a){for(var b=[],c=a.J,d=0;d<c.length;d+=2){var e=c[d];A(a,e)||b.push(e)}return b}function z(a){var b=a.J;a=a.Y;for(var c=[],d=[],e=[],g=0;g<b.length;g++)e[b[2*g]]=g,c.push(g,b[2*g+1]);for(g=0;g<a.length;g+=3)d.push(e[a[g]],e[a[g+1]],a[g+2]);return{J:c,Y:d}}function G(a,b,c){if(c.Ud==c.yf){for(var d=
0,e=0;d<c.yf;d++)-1!=c.ue[d]&&(a[e]=d,b[e]=c.ue[d],e++);return!0}if(c.yf>c.ki||c.Qf>c.Rf||c.Ki>c.Mi||c.Ji>c.Li)return!1;for(var e=d=-1,g=!1;!g&&D(c,N,d,e);)if(d=N[0],e=N[1],B(c,d,e)){var f;f=c;g={};g.Mj=f.Mj;g.Nj=f.Nj;g.sp=f.sp;g.El=f.El;g.yf=f.yf;g.ki=f.ki;g.Af=f.Af;g.Ud=g.im=f.Ud;g.Ji=f.Ji;g.Ki=f.Ki;g.Qf=f.Qf;g.Li=f.Li;g.Mi=f.Mi;g.Rf=f.Rf;g.ej=-1;g.ue=f.ue;g.vg=f.vg;g.Jg=f.Jg;g.Kg=f.Kg;g.Zg=f.Zg;g.$g=f.$g;g.Dm=f.Dm;f.Dm[0]+=1;var g=f=g,h=d,t=e,C=g.Mj,q=g.Nj,F=g.yf,n=g.ki,k=g.ue,l=g.vg,I=g.Jg,z=
g.Kg,u=g.Zg,M=g.$g;v(h<F);v(t<n);v(g.Ud<F);v(g.Ud<n);F=++g.Ud;g.ej=h;I[h]||(I[h]=F,g.Ji++,u[h]&&g.Qf++);u[h]||(u[h]=F,g.Ki++,I[h]&&g.Qf++);z[t]||(z[t]=F,g.Li++,M[t]&&g.Rf++);M[t]||(M[t]=F,g.Mi++,z[t]&&g.Rf++);k[h]=t;l[t]=h;for(k=0;k<r(C,h);k++)l=y(C,h,k),I[l]||(I[l]=F,g.Ji++,u[l]&&g.Qf++);for(k=0;k<A(C,h);k++)l=m(C,h,k),u[l]||(u[l]=F,g.Ki++,I[l]&&g.Qf++);for(k=0;k<r(q,t);k++)l=y(q,t,k),z[l]||(z[l]=F,g.Li++,M[l]&&g.Rf++);for(k=0;k<A(q,t);k++)l=m(q,t,k),M[l]||(M[l]=F,g.Mi++,z[l]&&g.Rf++);g=G(a,b,f);
v(1>=f.Ud-f.im);v(-1!=f.ej);l=f.Mj;h=f.Nj;t=f.Ud;C=f.ej;q=f.ue;I=f.vg;F=f.Jg;z=f.Kg;n=f.Zg;u=f.$g;if(f.im<t){F[C]==t&&(F[C]=0);for(M=0;M<r(l,C);M++)k=y(l,C,M),F[k]==t&&(F[k]=0);n[C]==t&&(n[C]=0);for(M=0;M<A(l,C);M++)k=m(l,C,M),n[k]==t&&(n[k]=0);l=q[C];z[l]==t&&(z[l]=0);for(M=0;M<r(h,l);M++)k=y(h,l,M),z[k]==t&&(z[k]=0);u[l]==t&&(u[l]=0);for(M=0;M<A(h,l);M++)k=m(h,l,M),u[k]==t&&(u[k]=0);q[C]=-1;I[l]=-1;f.Ud=f.im;f.ej=-1}}return g}function D(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.Qf,g=a.Rf,f=a.Ki,
h=a.Mi,m=a.Ji,t=a.Li,r=a.Ud,C=a.yf,q=a.ki,F=a.ue,v=a.vg,n=a.Jg,k=a.Kg,l=a.Zg,M=a.$g;if(e>r&&g>r)for(;c<C&&(-1!=F[c]||0==l[c]||0==n[c]);)c++,d=0;else if(f>r&&h>r)for(;c<C&&(-1!=F[c]||0==l[c]);)c++,d=0;else if(m>r&&t>r)for(;c<C&&(-1!=F[c]||0==n[c]);)c++,d=0;else if(0==c&&0!=a.Af){for(n=0;n<C&&-1!=F[c=a.Af[n]];)n++;n==C&&(c=C)}else for(;c<C&&-1!=F[c];)c++,d=0;if(e>r&&g>r)for(;d<q&&(-1!=v[d]||0==M[d]||0==k[d]);)d++;else if(f>r&&h>r)for(;d<q&&(-1!=v[d]||0==M[d]);)d++;else if(m>r&&t>r)for(;d<q&&(-1!=v[d]||
0==k[d]);)d++;else for(;d<q&&-1!=v[d];)d++;return c<C&&d<q?(b[0]=c,b[1]=d,!0):!1}function B(a,b,c){var d=a.Mj,e=a.Nj,g=a.ki,f=a.ue,h=a.vg,C=a.Jg,q=a.Kg,F=a.Zg,n=a.$g;v(b<a.yf);v(c<g);v(-1==f[b]);v(-1==h[c]);if(!(0,a.sp)(E(d,b),E(e,c)))return!1;for(var k=g=0,l=0,N=0,I=0,z=0,u=0;u<A(d,b);u++){var M=m(d,b,u);if(-1!=f[M]){var O=f[M];if(!t(e,c,O)||!J(a.El,d,b,M,e,c,O))return!1}else C[M]&&l++,F[M]&&g++,C[M]||F[M]||I++}for(u=0;u<r(d,b);u++)if(M=y(d,b,u),-1!=f[M]){if(O=f[M],!t(e,O,c)||!J(a.El,d,M,b,e,O,c))return!1}else C[M]&&
l++,F[M]&&g++,C[M]||F[M]||I++;for(u=0;u<A(e,c);u++)if(O=m(e,c,u),-1!=h[O]){if(M=h[O],!t(d,b,M))return!1}else q[O]&&N++,n[O]&&k++,q[O]||n[O]||z++;for(u=0;u<r(e,c);u++)if(O=y(e,c,u),-1!=h[O]){if(M=h[O],!t(d,M,b))return!1}else q[O]&&N++,n[O]&&k++,q[O]||n[O]||z++;return l<=N&&g<=k&&I<=z}function v(a){if(!a)throw"Assertion failed";}function E(a,b){for(var c=a.J,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function A(a,b){for(var c=a.Y,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function r(a,
b){for(var c=a.Y,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function m(a,b,c){a=a.Y;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function y(a,b,c){a=a.Y;for(var d=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function t(a,b,c){a=a.Y;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function J(a,b,c,d,e,g,f){for(var h=C(b,c,d),m=C(e,g,f),t=0;t<h;t++){for(var r=!1,q=0;q<m;q++)if(a(I(b,c,d,t),I(e,g,f,q))){r=!0;break}if(!r)return!1}return!0}
function C(a,b,c){var d=0;a=a.Y;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function I(a,b,c,d){a=a.Y;for(var e=0,g=0;g<a.length;g+=3)if(a[g]==b&&a[g+1]==c){if(e==d)return a[g+2];e++}return null}p("__print");var F=p("__util"),N=[-1,-1];a.Zq=-1;a.BG=10;a.Zm=20;a.EG=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{J:b,
Y:c}};a.clone=function(a,b,c){if(b)for(var d=Array(a.J.length),e=0;e<a.J.length;e+=2)d[e]=a.J[e],d[e+1]=b(a.J[e+1]);else d=F.na(a.J);if(c)for(b=Array(a.Y.length),e=0;e<a.Y.length;e+=3)b[e]=a.Y[e],b[e+1]=a.Y[e+1],b[e+2]=c(a.Y[e+2]);else b=F.na(a.Y);return a={J:d,Y:b}};a.hH=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{J:c,Y:d}};a.zh=d;a.TH=c;a.Tb=b;a.gh=k;a.fh=f;a.xm=function(a,b,c,d){if(!t(a,b,c))throw"Edge not found";
a=a.Y;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c&&a[e+2][0]==d[0]&&a[e+2][1]==d[1]){a.splice(e,3);break}};a.u=function(a,b){if(-1==l(a,b)){var c=n(a);d(a,c,b);return c}throw"Non-unique attribute";};a.xD=function(a,b,c,d,e){a=a.Y;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&a[g+2]==d&&(a[g+2]=e)};a.Oj=n;a.Vg=l;a.n=function(a,c,d,e){c=l(a,c);d=l(a,d);if(-1!=c&&-1!=d)b(a,c,d,e);else throw"Attributes not found";};a.V=function(a,b){for(var c=a.J,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.ie=function(a,
b){for(var c=a.Y,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Te=function(a,b,c){for(var d=a.Y,e=0;e<d.length;e+=3)if(d[e+1]==b){var g=d[e];if(c(g,E(a,g),d[e+2]))break}};a.Uf=function(a,b,c){for(var d=a.Y,e=0;e<d.length;e+=3)if(d[e]==b){var g=d[e+1];if(c(g,E(a,g),d[e+2]))break}};a.vq=u;a.QE=function(a){a=u(a).J;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.bI=function(){};a.kq=function(a,b,d){if(!c(a,b))throw"No such node";var f={};e(a,f);g(a,b,f,d);b=[];for(var h in f)f[h]&&(h=
Number(h),b.push(h,E(a,h)));a={J:b,Y:a.Y.slice(0)};f=a.Y;for(h=0;h<f.length;h+=3)b=f[h+1],c(a,f[h])&&c(a,b)||(f.splice(h,3),h-=3);return a};a.pB=function(a){for(var b=[],c=a.J,d=0;d<c.length;d+=2){var e=c[d];r(a,e)||b.push(e)}return b};a.it=q;a.match=function(a,b,c,d){var e={};e.Mj=z(a);e.Nj=z(b);e.sp=c||function(a,b){return a==b};e.El=d||function(a,b){return a==b};d=a.J.length/2;var g=b.J.length/2;e.yf=d;e.ki=g;e.Af=0;e.Ud=e.im=0;e.Qf=e.Ji=e.Ki=0;e.Rf=e.Li=e.Mi=0;e.ej=-1;e.ue=Array(d);e.vg=Array(g);
e.Jg=Array(d);e.Kg=Array(g);e.Zg=Array(d);e.$g=Array(g);e.Dm=[1];for(c=0;c<d;c++)e.ue[c]=-1,e.Jg[c]=0,e.Zg[c]=0;for(c=0;c<g;c++)e.vg[c]=-1,e.Kg[c]=0,e.$g[c]=0;g=Array(d);d=Array(d);if(G(g,d,e)){for(c=0;c<g.length;c++)g[c]=a.J[2*g[c]],d[c]=b.J[2*d[c]];return[g,d]}return null};a.Ta=E;a.Bf=A;a.Oo=r;a.pf=m;a.Rj=y;a.IH=C;a.De=I;a.replace=function(a,b,c){for(var e=a.Y,g=n(a),f=0;f<b.length;f++){var h=b[f];k(a,h);for(var m=0;m<e.length;m+=3)e[m]==h&&(e[m]=g),e[m+1]==h&&(e[m+1]=g),e[m]==e[m+1]&&(e.splice(m,
3),m-=3)}d(a,g,c)};a.pD=function(a,b,c,d,e){if(!t(a,b,c))throw"Edge not found";a=a.Y;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&(a[g]=d,a[g+1]=e)};a.lA=function(a,b){function c(a,b){if(-1!=m.indexOf(a)){var d=m.slice(m.indexOf(a));if(-1!=e[d[d.length-1]].indexOf(d[0])){t.push([a,d[d.length-1]]);return}}m.push(a);for(d=0;d<b.length;d++)b[d]in e&&c(b[d],e[b[d]])}b||(b=q(a)[0]);var d=a.Y;if(d.length){for(var e={},g=0,h=0;h<d.length;h+=3)d[h+1]in e?e[d[h+1]].push(d[h]):e[d[h+1]]=[d[h]],g++;var m=
[],t=[];c(b,e[b]);for(h=0;h<t.length;h++)for(var r=g=0;r<d.length;r+=3)t[h][1]==d[r+1]&&t[h][0]==d[r]&&f(a,d[r],d[r+1],g),g++}};a.kH=function(a,b,c){var d=a.J;a=a.Y;var e;e="digraph debug {\n    node [shape=box];\n";for(var g=0;g<d.length;g+=2){var f=d[g],h=d[g+1],h=b?b(f,h):String(f);e+="    ";e+=String(f)+' [label="'+h.replace(/\"/g,'\\"')+'"];\n'}for(g=0;g<a.length;g+=3)b=a[g],d=a[g+1],h=a[g+2],e+="    ",e+=String(b)+" -> "+String(d),c&&(e+=' [label="'+c(b,d,h)+'"]'),e+=";\n";return e+="}"}};b4w.module.__ipc=function(a,p){function d(a,b,c){for(var d=0;d<g.length;d+=2)g[d+1]==a&&(h[d+Number(!b)]=c)}function c(a){for(var b=0;b<a.length;b++){var c=a[b],d=0,e;for(e in c){var g=c[e];switch(g.constructor){case Float32Array:d+=g.length;break;case Number:d+=1}}--d;c.len=d}}a.zw=0;var b=a.rw=1,k=a.tw=2;a.sw=3;a.vw=4;a.ww=5;a.xw=6;a.Aw=7;var f=a.Cw=8,n=a.Yq=9,l=a.Dw=10;a.Ew=11;var u=a.Fw=12;a.Gw=13;a.Bw=14;a.yw=15;a.uw=16;a.gx=100;a.Iw=101;a.Jw=102;a.Kw=103;a.Lw=104;a.Nw=105;a.Mw=106;a.Ow=107;
a.Pw=108;a.Qw=109;a.Rw=110;a.Sw=111;a.Tw=112;a.Vw=113;a.Ww=114;a.jx=115;a.Xw=116;a.Yw=117;a.Zw=118;a.ax=119;a.bx=120;a.cx=121;a.ex=122;a.fx=123;a.hx=124;a.Uw=125;a.lx=126;a.$w=127;a.ar=128;a.kx=129;a.mx=130;a.nx=131;a.ox=132;a.px=133;a.qx=134;a.rx=135;a.sx=136;a.tx=137;a.ux=138;a.vx=139;a.br=140;var e=a.Sk=141;a.wx=142;a.$q=143;a.xx=144;a.yx=145;a.ix=146;a.dx=147;a.zx=148;var h=b4w.worker_listeners,g=b4w.worker_namespaces,q={Qc:u,v:0,time:0,i:new Float32Array(3),quat:new Float32Array(4),Yd:new Float32Array(3),
Nd:new Float32Array(3),len:0},z={Qc:f,Hn:0,Gp:0,i:new Float32Array(3),quat:new Float32Array(4),len:0},G={Qc:n,id:0,Ch:0,hit_fract:0,hit_time:0,len:0},D={Qc:l,id:0,Ch:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},B={Qc:b,og:0,pg:0,result:0,len:0},v={Qc:k,og:0,pg:0,result:0,ug:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},E={Qc:e,v:0,i:new Float32Array(3),quat:new Float32Array(4),len:0},A=[q,z,G,D,B,v,E];a.Oz=function(a,b){var c={Zl:a?
!0:!1,dg:null,Sd:[],Be:""};if(b)if(c.dg={addEventListener:function(a,b){"message"!=a&&panic("Wrong web worker event");d(c.Be,c.Zl,b)},removeEventListener:function(a){"message"!=a&&panic("Wrong web worker event");d(c.Be,c.Zl,null)},postMessage:function(a){var b;a:{for(b=0;b<g.length;b+=2)if(g[b+1]==c.Be){b=h[b+Number(!!c.Zl)];break a}b=null}b({data:a})},terminate:function(){for(var a=0;a<g.length;a+=2)if(g[a+1]==c.Be){h.splice(a,2);g.splice(a,2);break}}},c.Zl){var e=p("__util"),f=p("__container"),
C=b4w.get_namespace(p),e=e.Oi(C+"_worker");g.push(C);g.push(e);h.push(null);h.push(null);c.Be=e;f.Hs(a)?(f=f.Hs(a),f.addEventListener("load",function(){b4w.require("__bindings",c.Be)},!1)):(f=document.createElement("script"),f.src=a,f.defer="defer",f.async="async",f.addEventListener("load",function(){b4w.require("__bindings",c.Be)},!1),document.head.appendChild(f))}else c.Be=b4w.get_namespace(p);else c.dg=a?new Worker(a):self;return c};a.ry=function(a,d){function g(c){if(c.constructor==ArrayBuffer)c=
new Float32Array(c);else if(c[0].constructor==ArrayBuffer){for(var h=0;h<c.length;h++)g(c[h]);return}h=c[0]|0;switch(h){case u:var C=q;C.v=c[1]|0;C.time=c[2];C.i[0]=c[3];C.i[1]=c[4];C.i[2]=c[5];C.quat[0]=c[6];C.quat[1]=c[7];C.quat[2]=c[8];C.quat[3]=c[9];C.Yd[0]=c[10];C.Yd[1]=c[11];C.Yd[2]=c[12];C.Nd[0]=c[13];C.Nd[1]=c[14];C.Nd[2]=c[15];break;case f:C=z;C.Hn=c[1]|0;C.Gp=c[2]|0;C.i[0]=c[3];C.i[1]=c[4];C.i[2]=c[5];C.quat[0]=c[6];C.quat[1]=c[7];C.quat[2]=c[8];C.quat[3]=c[9];break;case n:C=G;C.id=c[1]|
0;C.Ch=c[2]|0;C.hit_fract=c[3];C.hit_time=c[4];break;case l:C=D;C.id=c[1]|0;C.Ch=c[2]|0;C.hit_fract=c[3];C.hit_time=c[4];C.hit_pos[0]=c[5];C.hit_pos[1]=c[6];C.hit_pos[2]=c[7];C.hit_norm[0]=c[8];C.hit_norm[1]=c[9];C.hit_norm[2]=c[10];break;case b:C=B;C.og=c[1]|0;C.pg=c[2]|0;C.result=!!c[3];break;case k:C=v;C.og=c[1]|0;C.pg=c[2]|0;C.result=!!c[3];C.ug[0]=c[4];C.ug[1]=c[5];C.ug[2]=c[6];C.coll_norm[0]=c[7];C.coll_norm[1]=c[8];C.coll_norm[2]=c[9];C.coll_dist=c[10];break;case e:C=E;C.v=c[1]|0;C.i[0]=c[2];
C.i[1]=c[3];C.i[2]=c[4];C.quat[0]=c[5];C.quat[1]=c[6];C.quat[2]=c[7];C.quat[3]=c[8];break;default:C=c}d(a,h,C)}c(A);a.dg.addEventListener("message",function(a){g(a.data)},!1)};a.cleanup=function(){};a.w=function(a,c){if(a)switch(c){case u:var d=q,g=new Float32Array(d.len);g[0]=d.Qc;g[1]=d.v;g[2]=d.time;g[3]=d.i[0];g[4]=d.i[1];g[5]=d.i[2];g[6]=d.quat[0];g[7]=d.quat[1];g[8]=d.quat[2];g[9]=d.quat[3];g[10]=d.Yd[0];g[11]=d.Yd[1];g[12]=d.Yd[2];g[13]=d.Nd[0];g[14]=d.Nd[1];g[15]=d.Nd[2];a.Sd.push(g.buffer);
break;case f:d=z;g=new Float32Array(d.len);g[0]=d.Qc;g[1]=d.Hn;g[2]=d.Gp;g[3]=d.i[0];g[4]=d.i[1];g[5]=d.i[2];g[6]=d.quat[0];g[7]=d.quat[1];g[8]=d.quat[2];g[9]=d.quat[3];a.Sd.push(g.buffer);break;case n:d=G;g=new Float32Array(d.len);g[0]=d.Qc;g[1]=d.id;g[2]=d.Ch;g[3]=d.hit_fract;g[4]=d.hit_time;a.Sd.push(g.buffer);break;case l:d=D;g=new Float32Array(d.len);g[0]=d.Qc;g[1]=d.id;g[2]=d.Ch;g[3]=d.hit_fract;g[4]=d.hit_time;g[5]=d.hit_pos[0];g[6]=d.hit_pos[1];g[7]=d.hit_pos[2];g[8]=d.hit_norm[0];g[9]=d.hit_norm[1];
g[10]=d.hit_norm[2];a.Sd.push(g.buffer);break;case b:d=B;g=new Float32Array(d.len);g[0]=d.Qc;g[1]=d.og;g[2]=d.pg;g[3]=d.result;a.Sd.push(g.buffer);break;case k:d=v;g=new Float32Array(d.len);g[0]=d.Qc;g[1]=d.og;g[2]=d.pg;g[3]=d.result;g[4]=d.ug[0];g[5]=d.ug[1];g[6]=d.ug[2];g[7]=d.coll_norm[0];g[8]=d.coll_norm[1];g[9]=d.coll_norm[2];g[10]=d.coll_dist;a.Sd.push(g.buffer);break;case e:d=E;g=new Float32Array(d.len);g[0]=d.Qc;g[1]=d.v;g[2]=d.i[0];g[3]=d.i[1];g[4]=d.i[2];g[5]=d.quat[0];g[6]=d.quat[1];g[7]=
d.quat[2];g[8]=d.quat[3];a.Sd.push(g.buffer);break;default:g=[];for(d=1;d<arguments.length;d++)g.push(arguments[d]);a.dg.postMessage(g)}};a.fD=function(a){a&&a.Sd.length&&(a.dg.postMessage(a.Sd),a.Sd.length=0)};a.dt=function(a){switch(a){case u:return q;case f:return z;case n:return G;case l:return D;case b:return B;case k:return v;case e:return E;default:return null}};a.terminate=function(a){a.dg.terminate();a.dg=null};a.Wl=function(a){return!!a.dg};a.Bt=function(a){return!!a.Be}};b4w.module.__hud=function(a,p){function d(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){b(' SCENE "'+a.name+'"');if(a.k){var c=0,d=0;l.V(a.k.pb,function(a,e){if("SINK"==e.type)b(" (F)",e.type);else{var g=e.type,f=Math.round(e.j.width)+"x"+Math.round(e.j.height),h=e.p.length,n=e.wj;"MAIN_CUBE_REFLECT"==e.type&&(h*=6);var r=e.enqueue&&e.ob;r?b(" (A)",g,e.dk,f,n,"of",h):b(" (P)",g,e.dk,f,n,"of",h);e.wj=0;r&&(c+=h,d+=n)}});return[c,d]}b("No INFO")}
function b(){for(var a=80+20*h[0],b=arguments[0],c=1;c<arguments.length;c++){for(var d="",f=0;f<u[c]-String(arguments[c]).length;f++)d+=" ";b+=d+arguments[c]}h[0]++;e.fillText(b,30,a)}function k(a,b,c){b*=a.Qa;c.x=a.x+b;c.y=a.y;c.Qa=a.Qa-2*b;c.Ga=a.Ga}function f(a){return a.x+a.Qa/2}function n(a){var b=e,c={x:0,y:0,Qa:0,Ga:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.Qa=d;c.Ga=b;k(c,.01,c);d=.02*c.Ga;c.x=c.x;c.y+=d;c.Qa=c.Qa;c.Ga-=2*d;d=c.Qa/8;c.x+=d*a;c.y=c.y;c.Qa=d;c.Ga=c.Ga;k(c,.02,c);return c}
var l=p("__graph");p("__print");var u=[5,19,3,10,4,3,5],e=null,h=[0,0];a.init=function(a){a=a.getContext("2d");d(a);return e=a};a.Pi=function(){e&&d(e)};a.reset=function(){var a=e;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),h[0]=0,h[1]=0)};a.kE=function(a,d){var f=e;if(f){f.textAlign="left";f.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/d).toFixed(2));h[0]++;for(var n=f=0,k=0;k<a.length;k++){var l=c(a[k]),f=f+l[0],n=
n+l[1];h[0]++}b(" -----------------------------------------------");b("    ","TOTAL ACTIVE","","",n,"of",f)}};a.print=function(){var a=e;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,h,k,v){var l=e;if(l){b=n(b);var u=b.Ga/5;b.x=b.x;b.y+=4*u;b.Qa=b.Qa;b.Ga=u;l.textAlign="center";l.fillStyle="#00FF00";e.fillText(a,f(b),b.y-10);l.strokeStyle="#00FF00";l.lineWidth=.5;l.beginPath();l.moveTo(b.x,b.y);l.lineTo(b.x+b.Qa,b.y);l.lineTo(b.x+b.Qa,
b.y+b.Ga);l.lineTo(b.x,b.y+b.Ga);l.closePath();l.stroke();if(!k&&!v)for(k=1E6,v=-1E6,a=0;a<c.length;a++)k=Math.min(k,c[a]),v=Math.max(v,c[a]);l.textAlign="right";e.fillText(String(k),b.x-10,b.y+b.Ga);e.fillText(String(v),b.x-10,b.y);l.textAlign="center";e.fillText(String(d),b.x,b.y+b.Ga+15);e.fillText(String(h),b.x+b.Qa,b.y+b.Ga+15);l.strokeStyle="#FF0000";l.lineWidth=1.5;l.beginPath();d=b.Qa/(c.length-1);v=b.Ga/(v-k);for(a=0;a<c.length;a++)h=b.x+d*a,u=b.y+b.Ga-(c[a]-k)*v,0==a?l.moveTo(h,u):l.lineTo(h,
u);l.stroke()}};a.draw_mixer_strip=function(a,b,c,d,h,k,v){var l=e;if(l)for(l.textAlign="center",l.fillStyle="#00FF00",l.font="bold 12px Courier",c=n(c),e.fillText(b?"["+a+"]":a,f(c),c.y),0<=k&&e.fillText(k?"[M]":"[ ]",f(c)-15,c.y+30),0<=v&&e.fillText(v?"[S]":"[ ]",f(c)+15,c.y+30),a={x:0,y:0,Qa:0,Ga:0},b=0;b<d.length;b++){k=d[b];var u="VOLUME"==k[0];if(u){v=c.y+350;var r=c.Qa,m=a;m.x=c.x;m.y=v;m.Qa=r;m.Ga=250}else{v=c.y+10+50*b;var r=c.Qa,m=c.Ga,y=a;y.x=c.x;y.y=v;y.Qa=r;y.Ga=m}v=l;var r=a,y=b==h,
t=k[0],m=k[1],p=k[2],C=k[3],I=(C-p)/k[4],I=1>I?Math.floor(1/I-1E-5).toFixed(0).length:0;k=k[5]?Math.log(m/p)/Math.log(C/p):(m-p)/(C-p);v.textAlign="center";y?v.fillText("["+t+"]",f(r),r.y):v.fillText(t,f(r),r.y);v.strokeStyle="#00FF00";v.lineWidth=u?3:1;u?(v.textAlign="right",v.fillText(C.toFixed(I),f(r)-10,r.y+15),v.textAlign="right",v.fillText(p.toFixed(I),f(r)-10,r.y+r.Ga-15)):(v.textAlign="right",v.fillText(p.toFixed(I),r.x+28,r.y+15),v.textAlign="left",v.fillText(C.toFixed(I),r.x+r.Qa-28,r.y+
15));v.beginPath();if(u){var F=r.y+15+(r.Ga-30)*(1-k);v.moveTo(f(r),r.y+15);v.lineTo(f(r),r.y+r.Ga-15);v.moveTo(f(r)-5,r.y+15);v.lineTo(f(r)+5,r.y+15);v.moveTo(f(r)-5,r.y+r.Ga-15);v.lineTo(f(r)+5,r.y+r.Ga-15);v.moveTo(f(r)-5,F);v.lineTo(f(r)+5,F)}else{var N=r.x+30+(r.Qa-60)*k;v.moveTo(r.x+30,r.y+15);v.lineTo(r.x+r.Qa-30,r.y+15);v.moveTo(r.x+30,r.y+15-5);v.lineTo(r.x+30,r.y+15+5);v.moveTo(r.x+r.Qa-30,r.y+15-5);v.lineTo(r.x+r.Qa-30,r.y+15+5);v.moveTo(N,r.y+15-5);v.lineTo(N,r.y+15+5)}v.stroke();"EQ_Q"==
t?(k=Math.log(1+1/(2*m*m)+Math.sqrt((2+1/(m*m))*(2+1/(m*m))/4-1))/Math.log(2),u?(v.textAlign="left",v.fillText(m.toFixed(I),f(r)+10,F),v.textAlign="left",v.fillText("("+k.toFixed(I+1)+")",f(r)+10,F+10)):(v.textAlign="right",v.fillText(m.toFixed(I),N,r.y+30),v.textAlign="left",v.fillText("("+k.toFixed(I+1)+")",N,r.y+30))):u?(v.textAlign="left",v.fillText(m.toFixed(I),f(r)+10,F)):(v.textAlign="center",v.fillText(m.toFixed(I),N,r.y+30))}}};b4w.module.__renderer=function(a,p){function d(a){for(var c=a.j,d=a.p,e=0;e<d.length;e++){var f=d[e];if(f.ob){var h=a,C=c,q=f.Ed,F=f.C,n=F.lc;v.useProgram(n.nk);for(var f=F.R,w=F.wr,l=n.Fv,x=l.length;x--;){var u=l[x];u.wo(v,u.Og,h,q,F,C)}C=F.Zr;v.colorMask(C,C,C,C);v.depthMask(F.da);F.Wa?v.enable(v.CULL_FACE):v.disable(v.CULL_FACE);C=F.U;for(F=0;F<C.length;F++)l=C[F],v.activeTexture(v.TEXTURE0+F),v.bindTexture(l.cc,l.mb);if("SKY"==h.type){C=h;n=n.Ek;F=C.j.sb.mb;l=C.vj;for(x=0;6>x;x++)if(u=k(x),g.In?
(v.bindTexture(v.TEXTURE_CUBE_MAP,F),v.texImage2D(u,0,v.RGBA,1,1,0,v.RGBA,v.UNSIGNED_BYTE,B)):(v.uniformMatrix4fv(n.u_cube_view_matrix,!1,l[x]),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,u,F,0),b(f,w,q.Jq)),C.gm&&3!=x){var u=C,z=x,p=E;g.In?p.set(B):(v.readPixels(191,191,1,1,v.RGBA,v.UNSIGNED_BYTE,p),255!=p[0]&&255!=p[1]&&255!=p[2]||v.readPixels(191,220,1,1,v.RGBA,v.UNSIGNED_BYTE,p));var D=p[0],G=p[1],p=p[2],D=D/255,G=G/255,p=p/255;2===z?(u.Ic[3]=D,u.Ic[7]=G,u.Ic[11]=p):2>z?(u.Ic[4*z]=
D,u.Ic[4*z+1]=G,u.Ic[4*z+2]=p):(u.Ic[4*(z-2)]=D,u.Ic[4*(z-2)+1]=G,u.Ic[4*(z-2)+2]=p)}h.wj+=6}else b(f,w,q.Jq),h.wj++}}}function c(a){if(a){var b=(a.ma?v.COLOR_BUFFER_BIT:0)|(a.ua?v.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=D;break;case "SHADOW_CAST":a=q;break;case "DEPTH":a=z;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=G;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=D;break;default:a=g.background_color}}else b=
v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT,a=g.background_color;v.colorMask(!0,!0,!0,!0);v.depthMask(!0);v.clearColor(a[0],a[1],a[2],a[3]);v.clear(b)}function b(a,b,c){v.bindBuffer(v.ARRAY_BUFFER,a.Xf);for(var d=0;d<b.length;d++){var e=b[d];v.enableVertexAttribArray(e.Og);v.vertexAttribPointer(e.Og,e.$d,v.FLOAT,!1,0,e.sy+e.BA*c)}a.Fe?(v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,a.Fe),v.drawElements(a.mode,a.count,a.Mo,0)):v.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],v.disableVertexAttribArray(e.Og)}
function k(a){switch(a){case 0:return v.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return v.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return v.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return v.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return v.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return v.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function f(a){var b=a.Ek,c=[],d=[],e={},g;for(g in b){var f=!1;switch(g){case "u_proj_matrix":var h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Ba)},f=!0;break;case "u_view_matrix":case "u_view_matrix_frag":h=
function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.ya)};f=!0;break;case "u_shadow_cast_billboard_view_matrix":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Zu)};f=!0;break;case "u_view_proj_prev":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.lD)};f=!0;break;case "u_view_proj_inverse":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Yi)};f=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.be)};f=!0;break;case "u_camera_eye":case "u_camera_eye_frag":h=function(a,
b,c,d,e,g){a.uniform3fv(b,g.of)};f=!0;break;case "u_camera_eye_last":h=function(a,b,c,d,e,g){a.uniform3fv(b,g.Gs)};f=!0;break;case "u_camera_quat":h=function(a,b,c,d,e,g){a.uniform4fv(b,g.quat)};f=!0;break;case "u_view_max_depth":h=function(a,b,c,d,e,g){a.uniform1f(b,g.hb)};f=!0;break;case "u_camera_range":h=function(a,b,c,d,e,g){a.uniform2f(b,g.ib,g.hb)};break;case "u_csm_center_dists":h=function(a,b,c,d,e,g){a.uniform4fv(b,g.ms)};break;case "u_cam_water_depth":h=function(a,b,c){a.uniform1f(b,c.En)};
f=!0;break;case "u_waves_height":h=function(a,b,c){a.uniform1f(b,c.cg)};break;case "u_waves_length":h=function(a,b,c){a.uniform1f(b,c.uh)};break;case "u_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.dc)};break;case "u_fog_params":h=function(a,b,c){a.uniform4fv(b,c.Kl)};break;case "u_underwater_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.Ld)};break;case "u_bloom_key":h=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":h=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};
break;case "u_time":h=function(a,b,c){a.uniform1f(b,c.time)};f=!0;break;case "u_wind":h=function(a,b,c){a.uniform3fv(b,c.Ue)};f=!0;break;case "u_sky_tex_dvar":h=function(a,b,c){a.uniform1f(b,c.ev)};break;case "u_sky_tex_fac":h=function(a,b,c){a.uniform4fv(b,c.fv)};break;case "u_sky_tex_color":h=function(a,b,c){a.uniform3fv(b,c.dv)};break;case "u_horizon_color":h=function(a,b,c){a.uniform3fv(b,c.rf)};break;case "u_zenith_color":h=function(a,b,c){a.uniform3fv(b,c.eg)};break;case "u_environment_energy":h=
function(a,b,c){a.uniform1f(b,c.nf)};break;case "u_sky_color":h=function(a,b,c){a.uniform3fv(b,c.Ai)};break;case "u_rayleigh_brightness":h=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":h=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":h=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":h=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":h=function(a,b,c){a.uniform1f(b,
c.rayleigh_strength)};break;case "u_mie_strength":h=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":h=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":h=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":h=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":h=function(a,b,c){a.uniform3fv(b,c.bm)};break;case "u_light_directions":h=function(a,b,c){a.uniform3fv(b,
c.bp)};break;case "u_light_color_intensities":h=function(a,b,c){a.uniform3fv(b,c.ap)};break;case "u_light_factors":h=function(a,b,c){a.uniform4fv(b,c.cp)};break;case "u_sun_quaternion":h=function(a,b,c){a.uniform4fv(b,c.xv)};break;case "u_sun_intensity":h=function(a,b,c){a.uniform3fv(b,c.wv)};break;case "u_sun_direction":h=function(a,b,c){a.uniform3fv(b,c.mq)};break;case "u_height":h=function(a,b,c,d,e,g){a.uniform1f(b,g.height)};f=!0;break;case "u_model_matrix":h=function(a,b,c,d){a.uniformMatrix4fv(b,
!1,d.aa)};f=!0;break;case "u_transb":h=function(a,b,c,d){a.uniform4fv(b,d.Ac)};f=!0;break;case "u_transa":h=function(a,b,c,d){a.uniform4fv(b,d.Zc)};f=!0;break;case "u_arm_rel_trans":h=function(a,b,c,d){a.uniform4fv(b,d.ln)};f=!0;break;case "u_arm_rel_quat":h=function(a,b,c,d){a.uniform4fv(b,d.kn)};f=!0;break;case "u_quat":h=function(a,b,c,d){a.uniform4fv(b,d.quat)};f=!0;break;case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,d.vc)};f=!0;break;case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,d.Tc)};
f=!0;break;case "u_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.md)};f=!0;break;case "au_center_pos":h=function(){};f=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.ke)};f=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.Ve)};f=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.we)};f=!0;break;case "au_detail_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.ve)};f=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,
d.qe)};f=!0;break;case "u_node_values":h=function(a,b,c,d){a.uniform1fv(b,d.Ie)};f=!0;break;case "u_node_rgbs":h=function(a,b,c,d){a.uniform3fv(b,d.Pc)};f=!0;break;case "u_diffuse_color":h=function(a,b,c,d,e){a.uniform4fv(b,e.pc)};f=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,e){a.uniform1f(b,e.lf)};f=!0;break;case "u_diffuse_params":h=function(a,b,c,d,e){a.uniform2fv(b,e.Kc)};f=!0;break;case "u_emit":h=function(a,b,c,d,e){a.uniform1f(b,e.Ae)};f=!0;break;case "u_ambient":h=function(a,b,
c,d,e){a.uniform1f(b,e.oe)};f=!0;break;case "u_specular_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.ce)};f=!0;break;case "u_specular_alpha":h=function(a,b,c,d,e){a.uniform1f(b,e.eq)};f=!0;break;case "u_specular_params":h=function(a,b,c,d,e){a.uniform3fv(b,e.zc)};f=!0;break;case "u_reflect_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.reflect_factor)};f=!0;break;case "u_mirror_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.mp)};f=!0;break;case "u_grass_map_dim":h=function(a,b,c,d,e){a.uniform3fv(b,
e.qc)};f=!0;break;case "u_grass_size":h=function(a,b,c,d,e){a.uniform1f(b,e.Fo)};f=!0;break;case "u_scale_threshold":h=function(a,b,c,d,e){a.uniform1f(b,e.kt)};f=!0;break;case "u_cube_fog":h=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Ic)};break;case "u_jitter_amp":h=function(a,b,c,d,e){a.uniform1f(b,e.Ht)};f=!0;break;case "u_jitter_freq":h=function(a,b,c,d,e){a.uniform1f(b,e.It)};f=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":h=
function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":h=function(a,b,c){a.uniform2fv(b,c.UB)};f=!0;break;case "u_subsample_indices":h=function(a,b,c){a.uniform4fv(b,c.VB)};f=!0;break;case "u_refr_bump":h=function(a,b,c,d,e){a.uniform1f(b,e.Iu)};f=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d,e){a.uniform3fv(b,e.Xo)};break;case "u_lamp_light_directions":h=function(a,b,c,d,e){a.uniform3fv(b,e.Vo)};break;case "u_lamp_light_color_intensities":h=function(a,
b,c,d,e){a.uniform3fv(b,e.Uo)};break;case "u_lamp_light_factors":h=function(a,b,c,d,e){a.uniform4fv(b,e.Wo)};break;case "u_halo_size":h=function(a,b,c,d,e){a.uniform1f(b,e.qt)};f=!0;break;case "u_halo_hardness":h=function(a,b,c,d,e){a.uniform1f(b,e.nt)};f=!0;break;case "u_halo_rings_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.pt)};f=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.ot)};f=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d,e){a.uniform1f(b,e.rt)};f=!0;
break;case "u_halo_stars_height":h=function(a,b,c,d,e){a.uniform1f(b,e.st)};f=!0;break;case "u_fresnel_params":h=function(a,b,c,d,e){a.uniform4fv(b,e.Bd)};f=!0;break;case "u_texture_scale":h=function(a,b,c,d,e){a.uniform3fv(b,e.Sf)};f=!0;break;case "u_parallax_scale":h=function(a,b,c,d,e){a.uniform1f(b,e.parallax_scale)};f=!0;break;case "u_color_id":h=function(a,b,c,d){a.uniform3fv(b,d.pl)};f=!0;break;case "u_line_points":h=function(a,b,c,d,e){a.uniform3fv(b,e.jI)};f=!0;break;case "u_diffuse_color_factor":h=
function(a,b,c,d,e){a.uniform1f(b,e.kf)};f=!0;break;case "u_alpha_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.af)};f=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.kh)};f=!0;break;case "u_normal_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.cu)};f=!0;break;case "u_normalmap0_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.Wg[0])};f=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.Wg[1])};f=!0;break;case "u_normalmap2_scale":h=function(a,b,c,
d,e){a.uniform2fv(b,e.Wg[2])};f=!0;break;case "u_normalmap3_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.Wg[3])};f=!0;break;case "u_foam_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};f=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,e){a.uniform2fv(b,e.Ks)};f=!0;break;case "u_foam_mag":h=function(a,b,c,d,e){a.uniform2fv(b,e.Js)};f=!0;break;case "u_foam_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.ro)};f=!0;break;case "u_water_norm_uv_velocity":h=function(a,b,c,d,e){a.uniform1f(b,
e.Zi)};f=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};f=!0;break;case "u_shore_water_col":h=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};f=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};f=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};f=!0;break;case "u_p_length":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.Cv)};f=!0;break;case "u_p_cyclic":h=
function(a,b,c,d,e){a.uniform1i(b,e.sa.cyclic)};f=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.Ot)};f=!0;break;case "u_p_fade_in":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.Cg)};f=!0;break;case "u_p_fade_out":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.Lc)};f=!0;break;case "u_p_size":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.size)};f=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.or)};f=!0;break;case "u_p_alpha_end":h=function(a,b,c,d,e){a.uniform1f(b,
e.sa.nr)};f=!0;break;case "u_p_nfactor":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.rp)};f=!0;break;case "u_p_gravity":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.lt)};f=!0;break;case "u_p_mass":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.Zd)};f=!0;break;case "u_p_size_ramp":h=function(a,b,c,d,e){a.uniform2fv(b,e.sa.av)};f=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,e){a.uniform4fv(b,e.sa.$r)};f=!0;break;case "u_p_wind_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.iw)};f=!0;break;case "u_texel_size":h=
function(a,b,c){a.uniform2fv(b,c.tq)};f=!0;break;case "u_p_time":h=function(a,b,c,d,e){a.uniform1f(b,e.sa.time)};f=!0;break;case "u_position":h=function(a,b,c,d,e){a.uniform3fv(b,e.ui)};f=!0;break;case "u_va_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.Tv)};f=!0;break;case "u_perspective_cast_far_bound":h=function(a,b,c){a.uniform1f(b,c.VC)};break;case "u_normal_offset":h=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":h=function(a,b,c,d,e,g){a.uniform4fv(b,
g.om)};break;case "u_v_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Sv)};f=!0;break;case "u_b_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Br)};break;case "u_p_light_matrix0":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ah[0])};f=!0;break;case "u_p_light_matrix1":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ah[1])};f=!0;break;case "u_p_light_matrix2":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ah[2])};f=!0;break;case "u_p_light_matrix3":h=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.ah[3])};f=!0;break;case "u_motion_blur_exp":h=function(a,b,c){a.uniform1f(b,c.Wt)};f=!0;break;case "u_motion_blur_decay_threshold":h=function(a,b,c){a.uniform1f(b,c.mb_decay_threshold)};f=!0;break;case "u_refl_plane":h=function(a,b,c,d){a.uniform4fv(b,d.ic)};f=!0;break;case "u_radial_blur_step":h=function(a,b,c){a.uniform1f(b,c.vm)};break;case "u_god_rays_intensity":h=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":h=function(a,b,c){a.uniform1f(b,c.Ei)};
break;case "u_ssao_blur_discard_value":h=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};f=!0;break;case "u_ssao_influence":h=function(a,b,c){a.uniform1f(b,c.Di)};break;case "u_ssao_dist_factor":h=function(a,b,c){a.uniform1f(b,c.Ci)};break;case "u_dof_dist":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_distance)};f=!0;break;case "u_dof_front":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_front)};f=!0;break;case "u_dof_rear":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_rear)};f=!0;break;case "u_outline_intensity":h=
function(a,b,c,d){a.uniform1f(b,d.Cf)};f=!0;break;case "u_outline_color":h=function(a,b,c){a.uniform3fv(b,c.Le)};break;case "u_draw_outline":h=function(a,b,c){a.uniform1f(b,c.io)};f=!0;break;case "u_glow_mask_small_coeff":h=function(a,b,c){a.uniform1f(b,c.small_glow_mask_coeff)};f=!0;break;case "u_glow_mask_large_coeff":h=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};f=!0;break;case "u_brightness":h=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":h=function(a,b,c){a.uniform1f(b,
c.contrast)};break;case "u_exposure":h=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":h=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:h=null}h&&(h={name:g,wo:h,Og:b[g]},f?c.push(h):(d.push(h),e[g]=h))}a.Fv=c;a.lk=d;a.Bp=e}var n=p("__camera"),l=p("__config"),u=p("__debug"),e=p("__textures"),h=p("__util"),g=l.q,q=[1,1,1,1],z=[1,1,1,1],G=[0,0,0,1],D=[0,0,0,0],B=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,
1,1,0]);new Float32Array([2,2,2,0]);var v=null,E=new Uint8Array(4);a.Jd=function(a){var b=g.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);v=a};a.Bj=function(a){if(a.ob){var b=a.j;v.bindFramebuffer(v.FRAMEBUFFER,b.Ce);if(a.mn){var e=b.sb;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,e.cc,e.mb,0)}v.viewport(0,
0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&c(a);a.Ia?v.enable(v.BLEND):v.disable(v.BLEND);a.Mb?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST);if(a.wa){for(var b=a.j,e=a.p,h=0;h<e.length;h++){var q=e[h],l=q.C,C=l.lc;v.useProgram(C.nk);q=q.Ed;C.lk.length||f(C);for(var C=C.lk,z=C.length;z--;){var F=C[z];F.wo(v,F.Og,a,q,l,b)}}a.wa=!1}switch(a.type){case "DEPTH":g.yt?(v.enable(v.POLYGON_OFFSET_FILL),v.polygonOffset(5,5)):v.disable(v.POLYGON_OFFSET_FILL);v.cullFace(v.BACK);break;case "SHADOW_CAST":v.enable(v.POLYGON_OFFSET_FILL);
v.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);v.cullFace(v.BACK);break;case "MAIN_PLANE_REFLECT":v.disable(v.POLYGON_OFFSET_FILL);v.cullFace(v.FRONT);break;default:v.disable(v.POLYGON_OFFSET_FILL),v.cullFace(v.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.j,e=b.sb.mb,h=0;6>h;h++){l=k(h);b.ya=a.vj[h];n.Dn(b);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,l,e,0);c(a);l=a.p;for(q=0;q<l.length;q++)l[q].ob=l[q].ho[h];d(a)}else d(a);u.Uy("draw subscene: "+a.type);v.bindFramebuffer(v.FRAMEBUFFER,
null)}};a.clear=function(a){v.bindFramebuffer(v.FRAMEBUFFER,a.j.Ce);c(a)};a.sr=function(a){var b=a.wr;b.length=0;var c=a.R;a=a.lc;c&&a||h.ba("Incomplete batch");c=c.Nb;a=a.attributes;for(var d in a){var e=c[d];b.push({Og:a[d],sy:4*e.offset,BA:1<e.frames?4*e.length:0,$d:e.$d})}};a.qy=f;a.ur=function(a){var b=a.lc,c=a.U;a=a.Ob;v.useProgram(b.nk);for(var d=0;d<c.length;d++)v.uniform1i(b.Ek[a[d]],d)};a.Gu=function(a,b,c,d,e,g){d||(d=1);e||(e=1);g||(g=new Uint8Array(4*d*e));g.length!=4*d*e&&h.ba("read_pixels(): Wrong storage");
v.bindFramebuffer(v.FRAMEBUFFER,a);v.readPixels(b,c,d,e,v.RGBA,v.UNSIGNED_BYTE,g);v.bindFramebuffer(v.FRAMEBUFFER,null);return g};a.cF=function(a){var b=a.lc;v.useProgram(b.nk);b.lk.length||f(b);b=b.Bp.u_cube_fog;b.wo(v,b.Og,null,null,a,null)};a.wD=function(a,b){var c=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,c);if(a){var d=a,g=d.mb,d=d.cc==v.TEXTURE_CUBE_MAP?v.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.cc;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,d,g,0)}e.Dt(b)?v.framebufferRenderbuffer(v.FRAMEBUFFER,
v.DEPTH_ATTACHMENT,v.RENDERBUFFER,b.$f):e.Zj(b)&&(d=b,g=d.mb,d=d.cc,v.framebufferTexture2D(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,d,g,0));u.Py();v.bindFramebuffer(v.FRAMEBUFFER,null);return c};a.vD=function(a,b,c,d,g){null==a?(v.bindFramebuffer(v.FRAMEBUFFER,a),v.viewport(0,0,d,g),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT)):(e.Zj(b)&&v.deleteTexture(b.mb),e.Dt(c)?v.deleteRenderbuffer(c.$f):e.Zj(c)&&v.deleteTexture(c.mb),v.deleteFramebuffer(a))};a.WH=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function d(a,b,d){var e=a.mf;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=d;return}e.push([b,d])}function c(a,b){for(var c=a.mf,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(v[c])return v[c];if(E){var d=E[b];if(!d)return null;d=p("__gpp_parser").tI.parse(d)}else if(d=p("shader_texts")[b],!d)return null;return v[c]=d}function k(a,c,d){function e(c){c=c.a;for(var d=0;d<c.length;d++){var q=
c[d];switch(q.type){case "condition":a:for(var q=q.a,C=0;C<q.length;C++){var l=q[C];switch(l.type){case "if":case "elif":if(g(l.c)){e(l.group);break a}break;case "else":e(l.group);break a;case "ifdef":l.name in x&&e(l.group);break;case "ifndef":l.name in x||e(l.group)}}break;case "include":q=b(D.shaders_dir,D.iE+q.file);e(q);break;case "var":case "export":case "import":break;case "define":C=q.name;x[C]=q.b;q.O&&(k[C]=q.O);break;case "error":throw"Shader error: #error "+q.b.join(" ");case "line":break;
case "pragma":r.push("#pragma "+q.name+" "+q.b.join(" "));break;case "undef":q=q.name;delete x[q];delete k[q];break;case "warning":z.warn("Shader warning: #warning "+q.b.join(" "));break;case "extension":q=f(q.b,x,k,!1);r.push("#extension "+q.join(" "));break;case "#":break;case "node":n[q.name]=q;break;case "nodes_global":q=m;for(C=0;C<q.length;C++){var l=q[C],V=n[l.id];if(V)for(var p=0,M=0;M<V.h.length;M++){var O=V.h[M];"node_param"==O.type&&(O=O.qualifier.join(" ")+" ","vert"==a?O+=l.Zf[p]:"frag"==
a&&(O+=l.O[p],null!==l.lm[p]&&(O+=" = "+l.lm[p])),O+=";",r.push(O),p++)}}break;case "nodes_main":q=m;for(C=0;C<q.length;C++)if(l=q[C],V=n[l.id]){p={};M={};for(O=0;O<l.kd.length;O++)M[l.kd[O][0]]=[l.kd[O][1]];E=y=u=0;for(var O=l,S=V.h,A=p,B=M,J=0;J<S.length;J++){var G=S[J];switch(G.type){case "node_in":var ea=O.D[u];if(null!==O.Qo[u]){if(("MATERIAL_BEGIN"==O.id&&3===u||!B.MATERIAL_EXT&&("MATERIAL_BEGIN"==O.id&&4===u||"MATERIAL_END"==O.id&&3===u||"MATERIAL_END"==O.id&&4===u||"MATERIAL_END"==O.id&&5===
u)||"TEXTURE_COLOR"==O.id||"TEXTURE_NORMAL"==O.id)&&G.e){A[G.name]=O.Qo[u];u++;continue}var ka=G.qualifier.join(" ")+" ",ka=ka+ea,ka=ka+(" = "+O.Qo[u]),ka=ka+";";r.push(ka)}A[G.name]=ea;u++;break;case "node_out":ea=O.ra[y];if(!G.e||-1<v.indexOf(ea))ka=G.qualifier.join(" ")+" ",ka+=ea,ka+=";",r.push(ka),A[G.name]=ea;-1<v.indexOf(ea)&&(B["USE_OUT_"+G.name]=[1]);y++;break;case "node_param":"vert"==a?ea=O.Zf[E]:"frag"==a&&(ea=O.O[E]),A[G.name]=ea,E++}}r.push("{");h(l,V.g,p,M);r.push("}")}break;case "textline":q=
f(q.b,x,k,!1);r.push(q.join(" "));break;default:throw"Unknown element type: "+q.type;}}}function g(a,b){var c;c=f(a,x,k,!0,b);for(var d=[],e=0;e<c.length;e++)if(c[e]instanceof Object)switch(c[e].type){case "conditional_expr":var h=d.pop(),m=d.pop();d.pop()?d.push(m):d.push(h);break;case "logical_or_expr":h=d.pop();for(m=0;m<c[e].d-1;m++)w=d.pop(),h=h||w;d.push(h);break;case "logical_and_expr":h=d.pop();for(m=0;m<c[e].d-1;m++)w=d.pop(),h=h&&w;d.push(h);break;case "logical_bitor_expr":h=d.pop();for(m=
0;m<c[e].d-1;m++)h|=d.pop();d.push(h);break;case "logical_bitxor_expr":h=d.pop();for(m=0;m<c[e].d-1;m++)h^=d.pop();d.push(h);break;case "logical_bitand_expr":h=d.pop();for(m=0;m<c[e].d-1;m++)h&=d.pop();d.push(h);break;case "equal_expr":h=d.pop();m=d.pop();d.push(m==h);break;case "non_equal_expr":h=d.pop();m=d.pop();d.push(m!=h);break;case "le_expr":h=d.pop();m=d.pop();d.push(m<=h);break;case "ge_expr":h=d.pop();m=d.pop();d.push(m>=h);break;case "l_expr":h=d.pop();m=d.pop();d.push(m<h);break;case "g_expr":h=
d.pop();m=d.pop();d.push(m>h);break;case "left_shift_expr":m=d.pop();h=d.pop();d.push(m<<h);break;case "right_shift_expr":m=d.pop();h=d.pop();d.push(m>>h);break;case "add_expr":m=d.pop();h=d.pop();d.push(m+h);break;case "sub_expr":m=d.pop();h=d.pop();d.push(m-h);break;case "mul_expr":m=d.pop();h=d.pop();d.push(m*h);break;case "div_expr":m=d.pop();h=d.pop();d.push(m/h);break;case "mod_expr":m=d.pop();h=d.pop();d.push(m%h);break;case "pre_inc_expr":case "post_inc_expr":w=d.pop();d.push(++w);break;case "pre_dec_expr":case "post_dec_expr":w=
d.pop();d.push(--w);break;case "positive_expr":w=d.pop();d.push(+w);break;case "negative_expr":w=d.pop();d.push(-w);break;case "one_compl_expr":w=d.pop();d.push(~w);break;case "logic_negative_expr":w=d.pop();d.push(!w);break;default:G.ba("Unknown operation type: "+c[e].type)}else{var w=c[e];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(w)?d.push(0):d.push(parseFloat(c[e]))}1==d.length?c=d[0]:(G.ba("Incorrect expression: "+c.join(" ")),c=void 0);return c}function h(a,b,c,d){for(var e=0;e<b.length;e++){var m=b[e];
switch(m.type){case "node_condition":a:for(var w=a,m=m.a,q=c,n=d,v=0;v<m.length;v++){var l=m[v];switch(l.type){case "node_if":case "node_elif":if(g(l.c,n)){h(w,l.g,q,n);break a}break;case "node_else":h(w,l.g,q,n);break a;case "node_ifdef":(l.name in x||l.name in n)&&h(w,l.g,q,n);break;case "node_ifndef":l.name in x||l.name in n||h(w,l.g,q,n)}}break;case "textline":w=[];for(q=0;q<m.b.length;q++)n=m.b[q],n in c?w.push(c[n]):w.push(n);w=f(w,x,k,!0,d);r.push(w.join(" "))}}}var m=d.zf;d=d.mf||[];for(var r=
[],x={},q=0;q<d.length;q++)x[d[q][0]]=[d[q][1]];for(q=0;q<m.length;q++)x["USE_NODE_"+m[q].id]=[1];var k={},n={},v=[];for(q in m)for(var l in m[q].D)v.push(m[q].D[l]);e(c);var u=0,y=0,E=0;return r.join("\n")}function f(a,b,c,d,e){var g=[];n(a,b,c,d,g,e);return g}function n(a,b,c,d,e,g){for(var f=0;f<a.length;f++){var h=a[f];h in b||g&&h in g?(h=g&&g[h]||b[h],0==h.length&&d?e.push(0):n(h,b,c,d,e,g)):e.push(h)}}function l(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);q.Vy(d,b,c);
return d}function u(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return e(a);case 2:return"vec2("+e(a[0])+","+e(a[1])+")";case 3:return"vec3("+e(a[0])+","+e(a[1])+","+e(a[2])+")";case 4:return"vec4("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+")";case 9:return"mat3("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+","+e(a[4])+","+e(a[5])+","+e(a[6])+","+e(a[7])+","+e(a[8])+")";case 16:return"mat4("+e(a[0])+","+e(a[1])+","+e(a[2])+","+e(a[3])+","+e(a[4])+","+e(a[5])+","+e(a[6])+","+e(a[7])+
","+e(a[8])+","+e(a[9])+","+e(a[10])+","+e(a[11])+","+e(a[12])+","+e(a[13])+","+e(a[14])+","+e(a[15])+")";default:throw"Wrong glsl value dimension";}}function e(a){return a%1?String(a):String(a)+".0"}var h=p("__assets"),g=p("__config"),q=p("__debug"),z=p("__print"),G=p("__util"),D=g.hc,B={},v={},E=null,A="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv main.glslf main.glslv main_stack.glslf main_stack.glslv particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/anaglyph.glslf postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf include/blending.glslf include/caustics.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/gamma.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
r=[],m=null,y=!1;a.Jd=function(a){m=a};a.H=d;a.eB=c;a.cI=function(a,b){for(var c=a.mf,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.OD=function(a){a.mf=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PERSPECTIVE_SHADOW_CAST PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var e=b[c],h;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PERSPECTIVE_SHADOW_CAST":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":h=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":h=1;break;case "SHADOW_TEX_RES":h=u(2048);break;case "AA_METHOD":h="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":h="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":h="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":h="POST_EFFECT_NONE";break;case "SHADOW_USAGE":h="NO_SHADOWS";break;case "SSAO_QUALITY":h=
"SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":h="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":h="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":h=g.q.precision;break;case "EPSILON":h="highp"==g.q.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":h="u_va_frame_factor";break;default:z.error("Unknown directive ("+a.Wi+", "+a.Oh+"): "+e)}d(a,e,h)}};a.QH=function(a){return a.Wi};a.$s=function(a){return a.Oh};a.XH=function(a,b){for(var e=b.mf,g=0;g<e.length;g++){var h=e[g][0],f=
e[g][1];c(a,h)&&d(a,h,f)}};a.aB=function(a){var c=JSON.stringify(a),d=B[c];if(d)return d;var e=a.Oh,d=b(D.shaders_dir,a.Wi),e=b(D.shaders_dir,e);if(!d||!e)return null;var g=k("vert",d,a),h=k("frag",e,a),d=m,f=l(d,c,g,d.VERTEX_SHADER),r=l(d,c,h,d.FRAGMENT_SHADER),e=d.createProgram();d.attachShader(e,f);d.attachShader(e,r);d.linkProgram(e);d.validateProgram(e);d.getProgramParameter(e,d.VALIDATE_STATUS)==d.AG&&z.error("shader program is not valid",c);q.Wy(e,c,f,r,g,h);a={Oq:f,Ns:r,nk:e,attributes:{},
Ek:{},lk:[],Bp:{},Fv:[],ab:a};h=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES);for(g=0;g<h;g++)f=d.getActiveAttrib(e,g).name,a.attributes[f]=d.getAttribLocation(e,f);h=d.getProgramParameter(e,d.ACTIVE_UNIFORMS);for(g=0;g<h;g++)f=d.getActiveUniform(e,g).name.split("[0]").join(""),a.Ek[f]=d.getUniformLocation(e,f);return B[c]=d=a};a.mC=function(){y=!1;if(b4w.module_check("shader_texts"))y=!0;else{for(var a=[],b=h.AT_TEXT,c=0;c<A.length;c++){var d=G.ck(D.shaders_dir+A[c]);a.push([A[c],b,d])}b=function(a,
b){E||(E={});E[b]=a};a.length?h.enqueue(a,b,function(){y=!0}):z.error("Shaders have not been found.")}};a.Xy=function(){return y};a.lH=function(){return r};a.Xs=function(){return B};a.cleanup=function(){for(var a in B){var b=B[a];m.deleteProgram(b.nk);m.deleteShader(b.Oq);m.deleteShader(b.Ns);delete B[a]}for(var c in v)delete v[c];for(var d in r)delete r[d]};a.mH=function(a){var b=a.mf;z.log("Shader: "+a.Wi+" "+a.Oh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)z.log("  "+b[a][0],
b[a][1])};a.r=u;a.Vr=function(a,b){return b in a.Ek?!0:!1};a.tB=function(a){return(m.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function d(a){return 65536<a.P?r.Zs()?!1:!0:!1}function c(a){return 0<a.pa.length?!0:!1}function b(a,b,d){if(!c(a))return a;d||m.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.P*(b||1)+", will use drawArrays","color: #aa0");b=a.pa;d=a.P;var e=a.L,g=a.B,h;for(h in e){var f=e[h],q=z(f,d);e[h]=k(b,f,q)}for(e=0;e<g.length;e++){var r=g[e];for(h in r)f=r[h],q=z(f,d),r[h]=k(b,f,q)}for(e=0;e<a.ca.length;e++){h=a.ca[e].ec;for(var n in h)f=h[n],
q=z(f,d),h[n]=k(b,f,q)}a.P=b.length;a.pa=new Uint16Array(0);return a}function k(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var g=a[e],h=0;h<c;h++)d[c*e+h]=b[c*g+h];return d}function f(a,b){var c=a.ad,d=a.Nb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function n(b,c){var d,e;switch(c){case a.aj:case a.Rk:d=N.TRIANGLES;e=N.STATIC_DRAW;break;case a.Xq:d=N.POINTS;e=N.STATIC_DRAW;
break;case a.Qk:d=N.TRIANGLES;e=N.DYNAMIC_DRAW;break;case a.Wq:d=N.POINTS;e=N.DYNAMIC_DRAW;break;case a.ow:d=N.LINES;e=N.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.Hk=e}function l(a){a.sf?(a.Fe||(a.Fe=N.createBuffer()),N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,a.Fe),N.bufferData(N.ELEMENT_ARRAY_BUFFER,a.sf,a.Hk),a.zl=a.sf.byteLength):a.zl=0;a.Xf||(a.Xf=N.createBuffer());N.bindBuffer(N.ARRAY_BUFFER,a.Xf);N.bufferData(N.ARRAY_BUFFER,a.ad,a.Hk);a.rs=a.ad.byteLength}function u(a){for(var b=
t.xb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].pa.length;b.pa=new Uint32Array(c);var e=c=0,g=0;if(0<a[0].ca.length)for(var h=0;h<a[0].ca.length;h++){for(d=0;d<a.length;d++)c+=a[d].ca[h].ec.a_position.length,e+=a[d].ca[h].ec.a_normal.length,g+=a[d].ca[h].ec.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(g)};b.ca.push({Vl:a[0].ca[h].Vl,ec:d})}for(d=c=0;d<a.length;d++)c+=a[d].P;b.P=c;var e=a[0],f;for(f in e.L){for(d=c=0;d<
a.length;d++)c+=a[d].L[f].length;b.L[f]=new Float32Array(c)}for(f in e.B[0]){for(d=c=0;d<a.length;d++)c+=a[d].B[0][f].length;for(d=0;d<e.B.length;d++)b.B[d]=b.B[d]||{},b.B[d][f]=new Float32Array(c)}for(f=e=c=0;f<a.length;f++){for(var g=a[f],m=g.pa,h=g.P,q=g.L,d=0;d<m.length;d++)b.pa[c+d]=m[d]+e;var c=c+m.length,r;for(r in q){var m=q[r],n=e*z(m,h);b.L[r].set(m,n)}for(d=0;d<g.B.length;d++){var q=g.B[d],k=b.B[d];for(r in q)m=q[r],n=e*z(m,h),k[r].set(m,n)}e+=h}if(0<b.ca.length)for(f=0;f<b.ca.length;f++)for(r=
b.ca[f].ec,d=g=e=c=0;d<a.length;d++)h=a[d].ca[f].ec,r.a_position.set(h.a_position,c),r.a_normal.set(h.a_normal,e),r.a_tangent.set(h.a_tangent,g),c+=h.a_position.length,e+=h.a_normal.length,g+=h.a_tangent.length;return b}function e(a,c,d,e,f,r){var n=t.xb("SUBMESH_"+a.name+"_"+c),k=a.submeshes[c],l=k.base_length,C=a.materials[c];n.P=l;var u=!1;if(g(d,"a_texcoord")){var z=null,y=a.materials[c];c=a.submeshes[c];if(y.texture_slots.length)switch(y=y.texture_slots[0],y.texture_coords){case "UV":y=a.uv_textures.indexOf(y.uv_layer);
0==y?z=new Float32Array(c.texcoord):1==y&&(z=new Float32Array(c.texcoord2));break;case "ORCO":for(var F=a.b4w_bounding_box_source,z=new Float32Array(2*c.base_length),y=(F.max_x+F.min_x)/2,E=(F.max_z+F.min_z)/2,p=F.max_x-F.min_x,F=F.max_z-F.min_z,A=0,I=0;I<c.position.length;I+=3)z[A++]=(c.position[I]-y)/p+.5,z[A++]=(E-c.position[I+2])/F+.5}null===z&&(z=new Float32Array(2*c.base_length));c=z}else c=new Float32Array(0);if(g(d,"a_orco_tex_coord")){z=a.b4w_bounding_box_source;y=new Float32Array(3*k.base_length);
E=z.max_x-z.min_x;p=z.max_y-z.min_y;F=z.max_z-z.min_z;for(I=A=0;I<k.position.length;I+=3)0==E?y[A++]=.5:y[A++]=t.clamp(parseFloat(((k.position[I]-z.min_x)/E).toFixed(5)),0,1),0==F?y[A++]=.5:y[A++]=t.clamp(parseFloat(((z.max_z-k.position[I+2])/F).toFixed(5)),0,1),0==p?y[A++]=.5:y[A++]=t.clamp(parseFloat(((k.position[I+1]-z.min_y)/p).toFixed(5)),0,1);z=y}else z=new Float32Array(0);var M,y=k.group;if(g(d,"a_influence")&&e){E=new Float32Array(4*l);p=y.length/l;F=new Float32Array(p);for(A=0;A<p;A++)for(M in F[A]=
-1,e)if(I=e[M],I.Zv===A){F[A]=I.co;break}var O=3<p?p:4;e=new Float32Array(O);M=new Uint32Array(O);for(var A=new Float32Array(4),I=new Float32Array(O),O=new Uint32Array(O),S=new Float32Array(4),B=0;B<l;B++)e.set(I),M.set(O),A.set(S),E.set(q(y,p,B,l,F,e,M,A),4*B)}else E=new Float32Array(0);M=E;e=f?t.na(f):{};e.a_color={Hg:!0};e.a_color.src=g(d,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,pd:7}]:[];f={a_texcoord:c,a_influence:M,a_orco_tex_coord:z};M=k.vertex_colors;c=k.color;z=a.name;y=[];
for(E=0;E<M.length;E++)y.push(M[E].name);for(var N in e)if(E=e[N].src,E.length){for(F=p=0;F<E.length;F++)p+=t.hh(E[F].pd);f[N]=new Float32Array(p*l);for(F=A=0;F<E.length;F++){var D=E[F].name,I=E[F].pd,O=t.Lu(I),G=y.indexOf(D);-1==G&&t.ba('vertex color "'+D+'" for mesh "'+z+'" not found.');S=M[G].mask;B=t.hh(S);(I&S)!==I&&m.error("Wrong color extraction from "+D+" to "+N+".");for(var J=D=0;J<G;J++)D+=t.hh(M[J].mask);G=D*l;for(D=0;D<l;D++)for(J=0;3>J;J++)O[J]&&(f[N][D*p+(A+t.tk(I,J))]=c[G+D*B+t.tk(S,
J)]);A+=B}}else f[N]=new Float32Array(0);N=a.uv_textures;e=k.texcoord;M=k.texcoord2;if(r)for(var ka in r){c=N.indexOf(ka);if(0==c)var da=new Float32Array(e);else 1==c&&(da=new Float32Array(M));f[r[ka]]=da}n.L=f;n.pa=new Uint32Array(k.indices);r=k.position.length/l/3;da=(ka=g(d,"a_normal")&&k.normal.length?!0:!1)&&g(d,"a_tangent")&&k.tangent.length?!0:!1;N=C.texture_slots[0];N=ka&&C.texture_slots.length&&g(d,"a_tangent")&&"ORCO"==N.texture_coords&&N.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&
(u=!0);for(f=0;f<r;f++){C=h(k,d,l,ka,da,N,f,a.name);if(u)if(e={},e.name=a.b4w_shape_keys[f].name,n.ca.push(e),0!=f){e.ec=C;e.Vl=a.b4w_shape_keys[f].value;continue}else e.ec=h(k,d,l,ka,da,N,f,a.name),e.Vl=1;n.B.push(C)}if(1<r&&!u){a=n.B[0];var C={},Y;for(Y in a)C[Y]=new Float32Array(a[Y]);n.B.push(C)}g(d,"a_polyindex")&&(b(n,1,!0),n.L.a_polyindex=v(n));return n}function h(a,b,c,d,e,h,f,r){var q={},n=new Float32Array(3*c),k=new Float32Array(d?3*c:0),l=new Float32Array(e||h?4*c:0),v=f*c*3;n.set(a.position.subarray(v,
v+3*c),0);d&&(v=f*c*3,k.set(a.normal.subarray(v,v+3*c),0));if(e)v=f*c*4,l.set(a.tangent.subarray(v,v+4*c),0);else if(h)for(a=l,m.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+r+'". Please add a UV-map.'),r=0;r<c;r++)b=C,d=I,b[0]=k[3*r],b[1]=k[3*r+1],b[2]=k[3*r+2],J.cross(b,t.AXIS_Z,d),0==J.length(d)&&J.cross(b,t.AXIS_X,d),J.normalize(d,d),a[4*r]=d[0],a[4*r+1]=d[1],a[4*r+2]=d[2],a[4*r+3]=1;else if(d&&g(b,"a_tangent"))for(l=new Float32Array(4*c),
c=0;c<l.length;c++)l[c]=1;q.a_position=n;q.a_normal=k;q.a_tangent=l;return q}function g(a,b){return-1<a.indexOf(b)?!0:!1}function q(b,c,d,e,g,h,f,m){for(var r=!0,q=0;q<c;q++){var k=b[q*e+d];if(-1!==k){var n=g[q];-1!==n&&(h[q]=k,f[q]=n,r=!1)}}if(r)return m;G(h,f,a.bn,!1);for(q=b=0;4>q;q++)b+=h[q];if(.01>b)return m;for(q=0;4>q;q++)h[q]/=b;if(.01>Math.abs(h[0]-1))m[0]=f[0]+1;else for(q=0;4>q;q++)m[q]=f[q]+h[q];return m}function z(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+
c+", base length="+b;return d}function G(b,c,d,e){for(var g=b.length,h=g,f=!1,m=e?-1:1;1<h||f;){1<h&&(h=Math.floor(h/1.247330950103979));for(var f=!1,q=0;h+q<g;q++)if(d==a.bn?0>m*(b[q]-b[q+h]):b[q]<b[q+h]&&e)f=b[q],b[q]=b[q+h],b[q+h]=f,f=c[q],c[q]=c[q+h],c[q+h]=f,f=!0}}function D(a,b,c){var d=[],e=[];J.subtract(b,a,d);J.subtract(c,a,e);J.normalize(d,d);J.normalize(e,e);return Math.acos(J.dot(d,e))}function B(a,b,d){b||(b=[]);d=d?a.B[0].a_normal:a.B[0].a_position;if(c(a)){a=a.pa;for(var e=a.length/
3,g=0;g<e;g++){var h=new Float32Array(9),f=a[3*g];h[0]=d[3*f];h[1]=d[3*f+1];h[2]=d[3*f+2];f=a[3*g+1];h[3]=d[3*f];h[4]=d[3*f+1];h[5]=d[3*f+2];f=a[3*g+2];h[6]=d[3*f];h[7]=d[3*f+1];h[8]=d[3*f+2];b[g]=h}}else for(g=0;g<d.length;g++)h=new Float32Array(9),h[0]=d[9*g],h[1]=d[9*g+1],h[2]=d[9*g+2],h[3]=d[9*g+3],h[4]=d[9*g+4],h[5]=d[9*g+5],h[6]=d[9*g+6],h[7]=d[9*g+7],h[8]=d[9*g+8],b[g]=h;return b}function v(a){for(var b=new Float32Array(a.P),c=0;c<a.P;c++)b[c]=c%3;return b}function E(a,b,c){var d=J.dist(a,
b);a=J.dist(a,c);b=J.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function A(a,b,c,d,e){c-=b;for(var g=0;g<c;g+=d)g%d==e&&vec3.normalize(a.subarray(g+b-e,g+b+1),a.subarray(g+b-e,g+b+1))}var r=p("__extensions"),m=p("__print"),y=p("__tsr"),t=p("__util"),J=p("__vec3"),C=new Float32Array(3),I=new Float32Array(3),F=new Float32Array(3);a.ne=10;a.fr=20;a.FG=30;a.Rk=10;a.Xq=20;a.Qk=30;a.Wq=40;a.ow=50;a.bn=0;a.Ax=1;a.aj=a.Rk;var N=null;a.Jd=function(a){N=a};a.nH=function(a){var b=_buffers[a];N.deleteBuffer(b.Fe);
N.deleteBuffer(b.Xf);delete _buffers[a]};a.IE=function(e,g,h,f){d(e)&&b(e);var m=e.pa,q=e.P,r=e.B,k={},v;for(v in e.L)v in f&&!f[v].Hg||(k[v]=e.L[v]);f={sf:null,ad:null,Mo:0,count:0,Nb:{},mode:0,Hk:0,zl:0,rs:0,Xf:null,Fe:null,Tl:null,ca:null};if(0<e.ca.length){v=r[0];for(var C=1;C<e.ca.length;C++){for(var t=e.ca[C].ec,u=t.a_position,y=t.a_normal,F=v.a_position,E=v.a_normal,p=u.length,A=e.ca[C].Vl,I=0;I<p;I++)F[I]+=A*u[I],E[I]+=A*y[I];t=t.a_tangent;u=v.a_tangent;y=t.length;for(I=0;I<y;I++)u[I]+=A*
t[I]}}if(m.length)if(v=m.length,65536>=q)var C=new Uint16Array(m),M=N.UNSIGNED_SHORT;else C=new Uint32Array(m),M=N.UNSIGNED_INT;else v=q,C=null;var A=0,I=r.length,O;for(O in r[0])t=r[0][O],A+=t.length*I;for(O in k)t=k[O],A+=t.length;O=new Float32Array(A);var A=0,I={},S;for(S in k)if(u=k[S],t=u.length)O.set(u,A),I[S]={SG:S,$d:z(u,q),offset:A,frames:1,length:t},A+=t;k=r.length;for(S in r[0])if(u=r[0][S],t=u.length,u=z(u,q),t)for(I[S]={$d:u,offset:A,frames:k,length:t},1<k&&(I[S+"_next"]={$d:u,offset:A+
t,frames:k,length:t}),y=0;y<k;y++)u=r[y][S],O.set(u,A),A+=t;f.count=v;f.sf=C;f.ad=O;f.Mo=M;f.Nb=I;n(f,h);l(f);g!=a.ne&&c(e)&&(f.Tl={GC:new Float32Array(m.length),HC:new Float32Array(m.length),eA:new Float32Array(m.length/3),type:g});f.ca=e.ca;return f};a.QB=d;a.PB=c;a.Im=b;a.gF=function(a,b,c){n(a,b);a.count=c.length;a.sf=c;a.Mo=c instanceof Uint16Array?N.UNSIGNED_SHORT:N.UNSIGNED_INT};a.Qm=function(a,b,c,d){var e=a.ad,g=a.Nb,h=g[b];h?(c&&h.$d!=c&&t.ba('invalid num_comp for "'+b+'"'),e.set(d,h.offset)):
(e=e.length,h=new Float32Array(e+d.length),h.set(a.ad),h.set(d,e),a.ad=h,g[b]={$d:c,offset:e});l(a)};a.qA=f;a.oI=function(a){a.Hk=N.STATIC_DRAW};a.xC=function(a){a.Hk=N.DYNAMIC_DRAW};a.Kv=l;a.Xr=function(a){a.Fe&&N.deleteBuffer(a.Fe);a.Xf&&N.deleteBuffer(a.Xf)};a.tt=function(a,b){return a.submeshes[b].base_length?!1:!0};a.uv=function(a,b){for(var c=0;c<a.B.length;c++){var d=a.B[c].a_position;y.transform_vectors(d,b,d,0);d=a.B[c].a_normal;0<d.length&&y.transform_dir_vectors(d,b,d,0);d=a.B[c].a_tangent;
0<d.length&&y.transform_tangents(d,b,d,0)}(c=a.L.au_center_pos)&&c.length&&y.transform_vectors(c,b,c,0);return a};a.GE=function(a,b){var c=a.L.au_center_pos;if(c&&c.length){var d=new Float32Array(c);y.transform_vectors(d,b,d,0);for(var e=0;e<a.B.length;e++)for(var g=0;g<d.length;g++)a.B[e].a_position[g]+=d[g]-c[g];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.FE=function(a,b){var c=a.P,d;for(d in b){var e=b[d].length;a.L[d]=new Float32Array(e*c);for(var g=0;g<c;g++)for(var h=
0;h<e;h++)a.L[d][g*e+h]=b[d][h]}};a.HE=u;a.wC=function(a,c,d){if(!a.P)return t.xb("EMPTY");var e=d.length;65536<a.P*e&&!r.Zs()&&b(a,e);var g=a.pa,h=a.P,f=a.L;a=a.B;for(var m in c){var q=c[m].length,k=q*h;f[m]=new Float32Array(k);for(var n=0;n<h;n++)for(k=0;k<q;k++)f[m][n*q+k]=c[m][k]}c=t.xb("CLONE_"+e+"_SUBMESHES");c.P=h*e;c.pa=new Uint32Array(g.length*e);for(n=0;n<e;n++)for(q=g.length*n,m=h*n,k=0;k<g.length;k++)c.pa[q+k]=g[k]+m;for(var v in f)for(g=f[v],k=g.length*e,q=z(g,h),c.L[v]=new Float32Array(k),
n=0;n<e;n++)m=h*q*n,c.L[v].set(g,m);for(v in a[0])for(n=0;n<a.length;n++)for(g=a[n][v],k=g.length*e,q=z(g,h),c.B[n]=c.B[n]||{},c.B[n][v]=new Float32Array(k),k=0;k<e;k++)switch(f=d[k],m=h*q*k,v){case "a_position":y.transform_vectors(g,f,c.B[n][v],m);break;case "a_normal":y.transform_dir_vectors(g,f,c.B[n][v],m);break;case "a_tangent":y.transform_tangents(g,f,c.B[n][v],m);break;default:throw"Wrong attribute name: "+v;}return c};a.Es=e;a.tA=function(a){var b=a.P,c=a.B[0].a_position,d=new Float32Array(12*
b),e=new Float32Array(8*b);a=new Uint16Array(4*a.pa.length);for(var g=0;g<b;g++)d[12*g]=c[3*g],d[12*g+1]=c[3*g+1],d[12*g+2]=c[3*g+2],d[12*g+3]=c[3*g],d[12*g+4]=c[3*g+1],d[12*g+5]=c[3*g+2],d[12*g+6]=c[3*g],d[12*g+7]=c[3*g+1],d[12*g+8]=c[3*g+2],d[12*g+9]=c[3*g],d[12*g+10]=c[3*g+1],d[12*g+11]=c[3*g+2],e[8*g]=-.5,e[8*g+1]=-.5,e[8*g+2]=-.5,e[8*g+3]=.5,e[8*g+4]=.5,e[8*g+5]=.5,e[8*g+6]=.5,e[8*g+7]=-.5,a[6*g]=4*g+2,a[6*g+1]=4*g+1,a[6*g+2]=4*g,a[6*g+3]=4*g+2,a[6*g+4]=4*g,a[6*g+5]=4*g+3;c=t.xb("HALO");c.B=
[];c.B[0]={};c.P=4*b;c.B[0].a_position=d;c.L.a_halo_bb_vertex=e;c.pa=a;return c};a.zB=g;a.Fs=function(a,b,c){for(var d=[],g=0;g<a.submeshes.length;g++){var h=e(a,g,b,null,c,null);h.P&&d.push(h)}return 0==d.length?t.xb("EMPTY"):1==d.length?d[0]:u(d)};a.fF=function(a,b,c){for(var d=a.sf,e=f(a,"a_position"),g=a.Tl,h=g.GC,m=g.HC,g=g.eA,q=d,r=q.length/3,k=0;k<r;k++){var n=q[3*k],v=q[3*k+1],l=q[3*k+2],C=e[3*n+1],u=e[3*n+2],y=e[3*v+1],z=e[3*v+2],M=e[3*l+1],O=e[3*l+2];h[3*k]=(e[3*n]+e[3*v]+e[3*l])/3;h[3*
k+1]=(C+y+M)/3;h[3*k+2]=(u+z+O)/3}t.Gf(h,b,m);b=m.length/3;for(e=0;e<b;e++)h=m[3*e]-c[0],q=m[3*e+1]-c[1],r=m[3*e+2]-c[2],g[e]=h*h+q*q+r*r;c=d;d=g.length;if(!(2>d))for(m=d,e=!1;1<m||e;)for(1<m&&(m=Math.floor(m/1.247330950103979)),e=!1,b=0;m+b<d;b++)0>g[b]-g[b+m]&&(e=g[b],g[b]=g[b+m],g[b+m]=e,e=c,h=b,q=b+m,r=e[3*h],k=e[3*h+1],n=e[3*h+2],e[3*h]=e[3*q],e[3*h+1]=e[3*q+1],e[3*h+2]=e[3*q+2],e[3*q]=r,e[3*q+1]=k,e[3*q+2]=n,e=!0);d=c;N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,a.Fe);N.bufferData(N.ELEMENT_ARRAY_BUFFER,
d,N.DYNAMIC_DRAW)};a.jv=G;a.Jr=function(a,b,c){for(var d=b.length/3,e=a.length/3,g=[],h=Array(3),f=Array(3),m=Array(3),q=0;q<e;q++){for(var r=a[3*q],k=a[3*q+1],n=a[3*q+2],v=0;3>v;v++)h[v]=b[3*r+v],f[v]=b[3*k+v],m[v]=b[3*n+v];if(c)var v=D(h,f,m),l=D(f,m,h),C=Math.PI-v-l;else C=l=v=1;var t=g,u;u=h;var M=m,O=[],S=[],y=[];J.subtract(f,u,O);J.subtract(M,u,S);J.cross(O,S,y);J.normalize(y,y);u=y;for(M=0;3>M;M++)O=3*k+M,S=3*n+M,t[3*r+M]=v*u[M],t[O]=l*u[M],t[S]=C*u[M]}if(c)for(var z in c)for(q=c[z],a=0;3>
a;a++){b=3*q[0]+a;for(e=1;e<q.length;e++)h=3*q[e]+a,g[b]+=g[h];for(e=1;e<q.length;e++)h=3*q[e]+a,g[h]=g[b]}for(q=0;q<d;q++){c=q;z=g;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=z[e];J.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,z[e]=a[b]}return g};a.Kr=function(a,b,c){for(var d={},e=b.length/3,g=0;g<e;g++){var h=String(b[3*g])+String(b[3*g+1])+String(b[3*g+2]);d[h]=[]}e=a.length;for(g=0;g<e;g++)b=a[g],h=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),h in d&&d[h].push(b);return d};a.yo=function(a,
b,c,d){var e=B(a,null,!1);if(c)var g=B(a,null,!0);var h=e.length,f=new Float32Array(h),m=C,q=I;for(a=0;a<h;a++){var r=e[a];m.set(r.subarray(0,3));q.set(r.subarray(3,6));F.set(r.subarray(6));f[a]=Math.sqrt(E(m,q,F))}m=new Float32Array(h);m[0]=f[0];for(a=1;a<h;a++)m[a]=m[a-1]+f[a];h=m[f.length-1];f=[];for(a=0;a<b;a++){var q=h*t.rd(d),q=t.hl(m,q,0,m.length-1),r=c?g[q]:e[q],q=a,k=r,n=d,r=void 0,r=new Float32Array(3),v=k[0],l=k[1],u=k[2],y=k[3],z=k[4],M=k[5],O=k[6],S=k[7],A=k[8],k=t.rd(n),n=t.rd(n);1<
k+n&&(k=1-k,n=1-n);var p=1-k-n,l=p*l+k*z+n*S,u=p*u+k*M+n*A;r[0]=p*v+k*y+n*O;r[1]=l;r[2]=u;f[q]=r}return f};a.tH=B;a.po=v;a.KI=E;a.Nu=function(a,b,c){a=a.B[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.rr=function(a,b,c){var d=a.W[0].T;a=a.f.Lf;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=c);for(e=0;e<d.length;e++)if(!d[e].Fg&&d[e].je&&!d[e].xg){c=d[e].R.Nb;b=d[e].R.ad;N.bindBuffer(N.ARRAY_BUFFER,d[e].R.Xf);
var g=c.a_position,h=d[e],f=b,m=a;if(g){for(var q=g.offset,g=g.length+q,r=h.R.ca[0].ec.a_position,k=q;k<g;k++)f[k]=r[k-q];for(k=1;k<h.R.ca.length;k++){var r=h.R.ca[k].ec.a_position,n=m[k].value;if(n)for(var v=q;v<g;v++)f[v]+=n*r[v-q]}N.bufferSubData(N.ARRAY_BUFFER,4*q,f.subarray(q))}g=c.a_normal;h=d[e];f=b;m=a;if(g){q=g.offset;g=g.length+q;r=h.R.ca[0].ec.a_normal;for(k=q;k<g;k++)f[k]=r[k-q];for(k=1;k<h.R.ca.length;k++)if(r=h.R.ca[k].ec.a_normal,n=m[k].value)for(v=q;v<g;v++)f[v]+=n*r[v-q];A(f,q,g,
3,2);N.bufferSubData(N.ARRAY_BUFFER,4*q,f.subarray(q))}m=c.a_tangent;c=d[e];h=a;if(m){f=m.offset;m=m.length+f;g=c.R.ca[0].ec.a_tangent;for(q=f;q<m;q++)b[q]=g[q-f];for(q=1;q<c.R.ca.length;q++)if(g=c.R.ca[q].ec.a_tangent,k=h[q].value)for(r=f;r<m;r++)b[r]+=k*g[r-f];A(b,f,m,4,3);N.bufferSubData(N.ARRAY_BUFFER,4*f,b.subarray(f))}}};a.check_shape_keys=function(a){return a.f.je};a.get_shape_keys_names=function(a){var b=[];if(a.f)for(var c=1;c<a.f.Lf.length;c++)b.push(a.f.Lf[c].name);return b};a.get_shape_key_value=
function(a,b){if(a.f)for(var c=1;c<a.f.Lf.length;c++)if(b==a.f.Lf[c].name)return a.f.Lf[c].value;return 0};a.Ko=function(a,b){var c=a.f.Lf;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.Uh=function(a){return a&&a.f&&a.f.Vd?!0:!1}};b4w.module.__objects=function(a,p){function d(a){a.f.Cf=0;a=ha.indexOf(a);-1!=a&&ha.splice(a,1)}function c(a){if(a.Lh)for(var b=a.W,c=0;c<b.length;c++)K.mF(b[c].xa,a)}function b(a,b){for(var c=a.W,d=b.W,e=0;e<c.length;e++){for(var g=!1,h=0;h<d.length;h++)if(c[e].xa==d[h].xa){g=!0;break}g||k(b,c[e].xa)&&J.al(b,c[e].xa)}}function k(a,b){return!b.ir&&"SPEAKER"==a.type||!b.Hx&&("LAMP"==a.type||"CAMERA"==a.type)?!1:!0}function f(a,b){if(a.dg_parent&&a.dg_parent.gr||a.parent&&a.parent.gr)return!0;switch(a.type){case "MESH":var c=
a.b4w_do_not_batch,d=a.b4w_collision,e=a.b4w_vehicle,g=a.b4w_floating,h=a.b4w_character,f=C.BB(a),m=t.Hr(a),q=0<a.data.b4w_shape_keys.length,r=a.b4w_dynamic_geometry;if(!(c=D.Ir(a,b)||c||d||e||q||g))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=!0;break a}c=!1}return c||f||h||m||r;case "EMPTY":return h=t.Hr(a),f=a.b4w_do_not_batch,D.Ir(a,b)||h||f;default:return!0}}function n(a,b,c,d,e,g,h,f,m){for(var q=0;q<a.nodes.length;q++){var r=a.nodes[q];if("VALUE"==
r.type){var k=u(b,r.name);d.push(r.outputs[0].default_value);e.push(k,e.length/2)}else"RGB"==r.type?(k=u(b,r.name),r=r.outputs[0].default_value.slice(0,3),h.push(r[0],r[1],r[2]),f.push(k,f.length/2)):"GROUP"==r.type&&(k=r.node_group.node_tree,n(k,u(b,r.name),k.animation_data,d,e,g,h,f,m))}if(c)for((a=c.action)&&a.k.type==D.Vq&&l(a,b,g,e,m,f),c=c.nla_tracks,d=0;d<c.length;d++)for(h=c[d].strips,q=0;q<c[d].strips.length;q++)(a=h[q].action)&&a.k.type==D.Vq&&l(a,b,g,e,m,f)}function l(a,b,c,d,g,h){var f=
a.k.O,m;for(m in f){var q=u(b,m.match(/"(.*?)"/)[1]),f=e(d,q);null!=f?(q=u(a.name,m),c.push(q,f)):(f=e(h,q),null!=f&&(q=u(a.name,m),g.push(q,f)))}}function u(a,b){return a+"%join%"+b}function e(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function h(a,b){for(var c=a.f.Sg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function g(a,b){for(var c=a.f.Rg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function q(a,b,c){b=Q[b]||[];for(var d=[],e=0;e<b.length;e++){var g=
b[e];if(g.f.oc==c||-1==c)for(var h=g.W,f=0;f<h.length;f++)h[f].xa==a&&d.push(g)}return d}function z(a,b,c,d){for(var e=null,g=0;g<b.length;g++){var h=b[g];if((c?h.Yg:h.name)==a&&(h.f.oc==d||-1==d)&&(e=h,!J.get_dg_parent(e)))break}return e}function G(a){Q.ALL.push(a);Q[a.type]||(Q[a.type]=[]);Q[a.type].push(a);var b=a.f.Sc;if(null!=b)for(var c=0;c<oa.length;c++){var d=oa[c];d.f.Sc==b&&d.rk.push(a)}}var D=p("__animation"),B=p("__batch"),v=p("__boundings"),E=p("__camera"),A=p("__config"),r=p("__constraints"),
m=p("__geometry"),y=p("__lights"),t=p("__nla"),J=p("__obj_util"),C=p("__particles"),I=p("__physics"),F=p("__print"),N=p("__primitives"),w=p("__quat"),K=p("__scenes"),x=p("__sfx"),V=p("__transform"),U=p("__tsr"),aa=p("__util"),ba=p("__vec3"),ea=p("__armature"),R=A.q,X=A.tb,Q={ALL:[]},T=0,ca=0,oa=[],ha=[],na=new Float32Array(3),ma=new Float32Array(4);a.an=0;a.$m=1;a.Ze=2;a.DATA_ID_ALL=-1;a.update=function(a){for(var b=Q.ALL,c=Q.ARMATURE,e=0;e<b.length;e++)for(var g=b[e],h=g.W,f=0;f<h.length;f++){var m=
h[f].xa;if(m.k.outline){if(-1!=ha.indexOf(g)){var q=g,r=a,k=0,n=q.ku;0==n.Km&&(n.Km=r);r-=n.Km;if(n.Mp&&r/n.Rc>=n.Mp)d(q);else{r%=n.Rc;if(r<n.xp)switch(n=r/(n.xp/5),r=Math.floor(n),r){case 0:k=(n-r)/2;break;case 1:k=(n-r)/2+.5;break;case 2:k=1;break;case 3:k=1-(n-r)/2;break;case 4:k=.5-(n-r)/2}q.f.Cf=k}}g.f.Cf&&K.zD(m)}}if(c)for(e=0;e<c.length;e++)a=c[e],a.qp&&(V.o(a),a.qp=!1)};a.apply_outline_anim=function(a,b,c,d){var e=a.ku;e.Km=0;e.xp=b;e.Rc=c;e.Mp=d;-1==ha.indexOf(a)&&ha.push(a)};a.clear_outline_anim=
d;a.mh=function(a,b){var c=a.animation_data,d=a.data.animation_data;c&&c.action&&(c=c.action,(c.k.type==D.nw||c.k.type==D.mw&&"ARMATURE"==b.type)&&b.actions.push(c));d&&d.action&&"SPEAKER"==b.type&&b.actions.push(d.action);"MESH"==b.type&&b.actions.push.apply(b.actions,D.ZA(a));a.gr=b.qa=f(a,b);a.GG=!0;b.rc=a.b4w_vehicle;b.is_character=a.b4w_character;b.Lg=a.b4w_floating;b.Si=a.b4w_collision;d=a.game;b.Fd={pm:d.physics_type,Jk:d.use_ghost,Rv:d.use_sleep,Zd:d.mass,Wv:d.velocity_min,Vv:d.velocity_max,
$n:d.damping,Rp:d.rotation_damping,nC:d.lock_location_x,oC:d.lock_location_y,pC:d.lock_location_z,qC:d.lock_rotation_x,rC:d.lock_rotation_y,sC:d.lock_rotation_z,qj:d.collision_margin,oj:d.collision_group,rj:d.collision_mask,Fq:d.use_collision_bounds,ol:d.collision_bounds_type,Ik:d.use_collision_compound};if(d=a.b4w_vehicle_settings)b.Bc={name:d.name,tc:d.part,LE:d.suspension_rest_length,nq:d.suspension_compression,pq:d.suspension_stiffness,oq:d.suspension_damping,Rq:d.wheel_friction,Pp:d.roll_influence,
kp:d.max_suspension_travel_cm,Hj:d.force_max,jj:d.brake_max,Gi:d.steering_max,gi:d.max_speed_angle,xj:d.delta_tach_angle,xk:d.speed_ratio,Ak:d.steering_ratio,Uj:d.inverse_control,Dg:d.floating_factor,sh:d.water_lin_damp,th:d.water_rot_damp,yv:d.synchronize_position};if(d=a.b4w_floating_settings)b.Mh={name:d.name,tc:d.part,Dg:d.floating_factor,sh:d.water_lin_damp,th:d.water_rot_damp,yv:d.synchronize_position};if(d=a.b4w_character_settings)b.Rr={aG:d.walk_speed,FD:d.run_speed,CE:d.step_height,WB:d.jump_strength,
cG:d.waterline};for(d=0;d<a.constraints.length;d++)c=a.constraints[d],"RIGID_BODY_JOINT"==c.type&&b.Cp.push({target:c.target.Fc,YC:c.pivot_type,ZC:c.pivot_x,$C:c.pivot_y,aD:c.pivot_z,Pd:c.axis_x,Qd:c.axis_y,Rd:c.axis_z,EF:c.use_limit_x,FF:c.use_limit_y,GF:c.use_limit_z,zF:c.use_angular_limit_x,AF:c.use_angular_limit_y,BF:c.use_angular_limit_z,fC:c.limit_max_x,gC:c.limit_max_y,hC:c.limit_max_z,iC:c.limit_min_x,jC:c.limit_min_y,kC:c.limit_min_z,$B:c.limit_angle_max_x,aC:c.limit_angle_max_y,bC:c.limit_angle_max_z,
cC:c.limit_angle_min_x,dC:c.limit_angle_min_y,eC:c.limit_angle_min_z});d=b.f=J.Fh("MESH"===b.type?b.qa?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent.Fc,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.kk=a.parent_bone)):a.dg_parent&&(b.parent=a.dg_parent.Fc,b.Ef=!0);var c=a.location,e=a.scale[0];aa.Hp(a.rotation_quaternion,ma);V.set_translation(b,c);V.set_rotation(b,ma);V.set_scale(b,e);b.Rm=a.b4w_use_default_animation;b.Yk=D.Mx(a.b4w_anim_behavior);a.b4w_object_tags&&(b.em={title:a.b4w_object_tags.title,
description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});switch(a.type){case "ARMATURE":ea.mh(a,b);var c=d.fd,g=D.Fy(c);a.b4w_animation_mixing?(d.vc=new Float32Array(g.ka),d.Tc=new Float32Array(g.ka),d.Ac=new Float32Array(g.i),d.Zc=new Float32Array(g.i)):(d.vc=g.ka,d.Tc=g.ka,d.Ac=g.i,d.Zc=g.i);for(var h in c)e=c[h],1==e.nl.length&&ea.eF(e,!0,g.i,g.ka);d.Dp=g;d.md=0;d.kg=a.b4w_animation_mixing;break;case "MESH":d.Cl=a.b4w_do_not_render;d.Bh=B.ty(a.data.b4w_bounding_box);d.Ne=
X.outlining_overview_mode||a.b4w_selectable;d.km=a.b4w_selectable;d.tb=X.outlining_overview_mode||a.b4w_outlining;d.jm=a.b4w_outlining;d.lu=X.outlining_overview_mode||a.b4w_outline_on_select;d.vd=a.b4w_billboard;d.tn=a.b4w_pres_glob_orientation;d.hj="BASIC";d.gj="SPHERICAL"==a.b4w_billboard_geometry;h=d.pi;h.qi=a.b4w_outline_settings.outline_duration;h.ri=a.b4w_outline_settings.outline_period;h.si=a.b4w_outline_settings.outline_relapses;d.Ne&&(d.pl=aa.Os(T),T++);for(h=0;h<a.data.b4w_vertex_anim.length;h++)c=
a.data.b4w_vertex_anim[h],b.Qb.push({name:c.name,I:c.frame_start,Z:c.frame_end,TG:c.averaging,UG:c.averaging_interval,Kx:c.allow_nla});b.f.Qb=b.Qb.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;h=b.f;if(a.data.b4w_shape_keys.length)for(h.je=!0,c=0;c<a.data.b4w_shape_keys.length;c++)e={},e.value=a.data.b4w_shape_keys[c].value,e.name=a.data.b4w_shape_keys[c].name,h.Lf.push(e);else h.je=!1;if(h=D.Vs(a)){var m=h.Fc,c=m.f.Dp,e=b.f,q=a.data;b.bl=m;q=q.vertex_groups;if(q.length){var m=
m.f.fd,r=0,k={};for(g in m){var l=aa.keysearch("name",g,q);l&&(k[g]={Zv:l.index,df:m[g].df,co:r++})}e.Dh=k;g=r;q=D.ct();e.Je=g;g>2*q?(e.$h=!1,F.error('too many bones for "'+a.name+'" / '+e.Je+" bones (max "+q+" with blending, "+2*q+" without blending). Skinning will be disabled.")):e.$h=!0}g=D.uA(c.i,c.ka,d.Dh);h.b4w_animation_mixing?(d.vc=new Float32Array(g.ka),d.Tc=new Float32Array(g.ka),d.Ac=new Float32Array(g.i),d.Zc=new Float32Array(g.i)):(d.vc=g.ka,d.Tc=g.ka,d.Ac=g.i,d.Zc=g.i);d.ln=new Float32Array(4);
d.kn=w.create();d.Dp=g;d.md=0}g=b.f;h=a.data.materials;c=[];e=[];q=[];m=[];r=[];k=[];for(l=0;l<h.length;l++){var C=h[l],t=C.node_tree;t&&n(t,C.name,t.animation_data,c,e,q,m,r,k)}g.Ie=c;g.Sg=e;g.cm=q;g.Pc=m;g.Rg=r;g.dm=k;d.Vc=a.b4w_shadow_cast;d.yc=a.b4w_shadow_receive;d.xc=a.b4w_shadow_cast_only&&d.Vc;d.jc=a.b4w_reflexible;d.Yb=a.b4w_reflexible_only&&d.jc;d.wc=a.b4w_reflective;d.ae=a.b4w_reflection_type;d.se=a.b4w_caustics;d.bd=a.b4w_wind_bending;d.Mk=a.b4w_wind_bending_angle;g=B.dG(a.b4w_wind_bending_angle,
d.Bh,a.scale[0]);d.ke=g;d.Ve=a.b4w_wind_bending_freq;d.we=a.b4w_detail_bending_freq;d.ve=a.b4w_detail_bending_amp;d.qe=a.b4w_branch_bending_amp;d.Wh=!1;d.He=a.b4w_main_bend_stiffness_col;g=a.b4w_detail_bend_colors;d.Ub={};d.Ub.Mt=g.leaves_stiffness_col;d.Ub.Lt=g.leaves_phase_col;d.Ub.mu=g.overall_stiffness_col;d.Hh=a.b4w_do_not_cull;d.Bl=a.b4w_disable_fogging;d.Vd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";g=a.data.materials[0];d.Kj=g.physics.friction;d.Ej=g.physics.elasticity;
d.bk=0;d.wf=1E4;d.Pg=a.b4w_lod_transition;d.am=!0;break;case "CAMERA":E.Iy(a,b);E.ny(b);break;case "LAMP":y.XB(a,b);break;case "SPEAKER":b.A=x.Fz();d=!1;for(g=0;g<b.W.length;g++)if(b.W[g].xa.b4w_enable_audio){d=!0;break}d&&x.mh(a,b);break;case "EMPTY":d.Kb=v.td(),g=v.Nk(),d.gd=g,a.field&&(b.Lh={type:a.field.type,sv:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,Gh:a.b4w_anchor.detect_visibility,Fl:a.b4w_anchor.element_id,EC:a.b4w_anchor.max_width})}G(b)};a.pF=function(a){var c=
a.f;if(a.parent){var d=c.i,e=c.quat,g=c.scale;!a.Ef&&a.Fd.Ik&&a.parent.Fd.Ik&&(a.Si=!1);var h=a.Fd;a.rc||a.Lg||I.is_character(a)||a.Si&&!h.Jk&&0<h.Zd&&("DYNAMIC"==h.pm||"RIGID_BODY"==h.pm)?(d=a.Ef?U.create_sep(d,g,e):c.za,U.multiply(a.parent.f.za,d,c.za),V.set_translation(a,U.get_trans_view(c.za)),V.set_scale(a,U.get_scale(c.za)),V.set_rotation(a,U.get_quat_view(c.za))):a.Ef||!a.kk?(d=U.create_sep(d,g,e),r.Px(a,a.parent,d)):(d=U.create_sep(d,g,e),r.Qx(a,a.parent,a.kk,d))}if("ARMATURE"==a.type)for(d=
a.Ha.pose.bones,e=0;e<d.length;e++)if(g=d[e],h=g.constraints)for(var f=0;f<h.length;f++){var m=h[f];"COPY_TRANSFORMS"!=m.type||m.subtarget||m.mute||r.$x(a,m.target.Fc,g.name,aa.dr,aa.cr)}if("MESH"==a.type&&c.wc)if(c=a.f,"CUBE"==c.ae)c.hd=ca++;else if("PLANE"==c.ae){a:{d=a.Ha.constraints;for(e=0;e<d.length;e++)if(g=d[e],"LOCKED_TRACK"==g.type&&"REFLECTION PLANE"==g.name){d=g.target.Fc;break a}d=null}d||(d=aa.Oi("%reflection%"),d=J.Tn(d,"EMPTY"),e=J.Fh("EMPTY"),d.f=e,b(a,d),r.qr(d,a,[0,0,0],null,1),
G(d));e=null;for(g=0;g<oa.length;g++)if(oa[g]==d){e=g;break}null==e&&(e=oa.length,oa.push(d));d.f.Sc=e;c.Sc=e;d.rk.push(a)}};a.Jv=c;a.eH=b;a.Ry=k;a.qF=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.f||"DYNAMIC"!=c.f.type&&"CAMERA"!=c.f.type||V.o(c);c.Rm&&D.ju(c)&&(D.apply_def(c),c.F.length&&D.play(c,null,D.SLOT_ALL))}};a.get_meta_tags=function(a){return aa.na(a.em)};a.cleanup=function(){ca=T=0;oa=[];ha.length=0;Q={ALL:[]}};a.copy=function(a,c,d){var e=c,g=J.get_dg_parent(a);c=g?J.Ps(g.name,
c):c;if(z(c,Q.ALL,!1,-1)){for(var g=1,h;;){h="."+(3>String(g).length?("000"+String(g)).slice(-3):String(g));if(!z(c+h,Q.ALL,!1,-1))break;g++}F.error('Object "'+c+'" already exists. Name was replaced by "'+c+h+'".');e+=h;c+=h}e=J.Tn(c,a.type,e);e.qa=a.qa;e.Yj=a.Yj;e.Rm=a.Rm;e.f=J.hf(a.f);e.em=J.hf(a.em);b(a,e);e.xh=J.Qn(a.xh);e.parent=J.Qn(a.parent);e.Ef=a.Ef;e.kk=a.kk;e.Ha=a.Ha;!a.m||a.rc||a.is_character||a.Lg||(e.Si=a.Si,e.m=J.hf(a.m));e.Fd=J.hf(a.Fd);c=[];g=aa.Qs();for(h=0;h<a.W.length;h++){var f=
e.W[h],q=a.W[h].T;if(d){for(var f=f.T,r=0;r<q.length;r++)q[r].Fg||(f.push(J.hf(q[r])),c.push(q[r].R));for(r=0;r<q.length;r++)if(q[r].Fg){var k=J.hf(q[r]);f.push(k);for(var n=0;n<c.length;n++)c[n]==q[r].R&&(k.R=f[n].R)}for(r=0;r<f.length;r++)f[r].R&&m.Kv(f[r].R),f[r].oi=g,B.$E(f[r],B.Gy(e.f))}else f.T=J.Qn(q)}J.Tp(e,!1);G(e);e.f.So=!0;e.f.pl=aa.Os(T);T++;return e};a.PH=h;a.LH=g;a.update_boundings=function(a){for(var b=a.f,c=a.W[0].T,d,e,g,h,f,q,r=0;r<c.length;r++){var k=c[r];if("MAIN"==k.type){var k=
k.R.ad,n=c[r].R.Nb,l=n.a_position.offset,n=n.a_position.length+l;d=h=k[l];e=f=k[l+1];g=q=k[l+2];for(var C=l;C<n;C+=3){var l=k[C],t=k[C+1],x=k[C+2];d=Math.max(l,d);e=Math.max(t,e);g=Math.max(x,g);h=Math.min(l,h);f=Math.min(t,f);q=Math.min(x,q)}}}var H={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(e.toFixed(3)),max_z:parseFloat(g.toFixed(3)),min_x:parseFloat(h.toFixed(3)),min_y:parseFloat(f.toFixed(3)),min_z:parseFloat(q.toFixed(3))},w=d-h,u=e-f,y=g-q;h=.5*(d+h);var z=.5*(e+f),F=.5*(g+q),xa=h,tb=
F;f=Math.max(w,Math.max(u,y))/2;q=Math.max(w,y)/2;var E=[h/(w?w:1),z/(u?u:1),F/(y?y:1)],A=.5;if(b.vd)l=Math.max(Math.abs(H.max_x),Math.abs(H.min_x)),t=Math.max(Math.abs(H.max_y),Math.abs(H.min_y)),x=Math.max(Math.abs(H.max_z),Math.abs(H.min_z)),f=Math.sqrt(l*l+t*t+x*x),q=Math.sqrt(l*l+t*t),H.max_x=H.max_y=H.max_z=f,H.min_x=H.min_y=H.min_z=-f,h=new Float32Array([0,0,0]),y=new Float32Array([f,f,f]),u=new Float32Array([0,0,0]);else{for(r=0;r<c.length;r++)if(k=c[r],"MAIN"==k.type)for(k=k.R.ad,n=c[r].R.Nb,
l=n.a_position.offset,n=n.a_position.length+l,C=l;C<n;C+=3){var l=k[C],t=k[C+1],x=k[C+2],ta=Math.sqrt((h-l)*(h-l)+(z-t)*(z-t)+(F-x)*(F-x));if(ta>f){var p=h-f*(l-h)/ta,I=z-f*(t-z)/ta,ta=F-f*(x-F)/ta;h=(p+l)/2;z=(I+t)/2;F=(ta+x)/2;f=Math.sqrt((h-l)*(h-l)+(z-t)*(z-t)+(F-x)*(F-x))}I=Math.sqrt((xa-l)*(xa-l)+(tb-x)*(tb-x));I>q&&(p=xa-q*(l-xa)/I,ta=tb-q*(x-tb)/I,xa=(p+l)/2,tb=(ta+x)/2,q=Math.sqrt((xa-l)*(xa-l)+(tb-x)*(tb-x)));l/=w?w:1;t/=u?u:1;x/=y?y:1;ta=Math.sqrt((E[0]-l)*(E[0]-l)+(E[1]-t)*(E[1]-t)+(E[2]-
x)*(E[2]-x));ta>A&&(p=E[0]-A*(l-E[0])/ta,I=E[1]-A*(t-E[1])/ta,ta=E[2]-A*(x-E[2])/ta,E[0]=(p+l)/2,E[1]=(I+t)/2,E[2]=(ta+x)/2,A=Math.sqrt((E[0]-l)*(E[0]-l)+(E[1]-t)*(E[1]-t)+(E[2]-x)*(E[2]-x)))}r=w?w*E[0]:d;e=u?u*E[1]:e;g=y?y*E[2]:g;w*=A;u*=A;y*=A;h=new Float32Array([h,z,F]);y=new Float32Array([w,u,y]);u=new Float32Array([r,e,g]);q=parseFloat(q.toFixed(3))}b.Kb=H;B.XD(b,q,q,H);H=v.vl(f,h);b.gd=H;H=v.ul([y[0],0,0],[0,y[1],0],[0,0,y[2]],u);b.cf=H;V.o(a);if(R.wireframe_debug)for(r=0;r<c.length;r++)if("WIREFRAME"===
c[r].type&&c[r].xg){a=N.xo(1,H.G);m.Nu(a,[H.Pd[0],H.Qd[1],H.Rd[2]],H.G);m.Im(a,1,!0);a.L.a_polyindex=m.po(a);B.ZE(c[r],a);break}};a.oa=q;a.nB=function(a,b){for(var c=Q.ALL||[],d=[],e=0;e<c.length;e++){var g=c[e];if((g.f.oc==b||-1==b)&&g.Ha)for(var h=g.W,f=0;f<h.length;f++)h[f].xa==a&&d.push(g)}return d};a.get_all_objects=function(a){var b=Q.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.f.oc==a&&c.push(e)}return c};a.pE=function(a){var b=q(a,"LAMP",-1);if(b.length==a.k.rI){for(var c=
[],d=0;d<b.length;d++){var e=b[d],e=J.Ma(e,a);c[e.ak]=d}for(d=0;d<c.length-1;d++)for(e=d+1;e<c.length;e++){var g=b[c[d]].Na,h=b[c[e]].Na;if(h.Ri&&h.oh&&(!g.Ri||!g.oh)||!g.Ri&&(h.Ri||!g.oh&&h.oh))g=c[d],c[d]=c[e],c[e]=g}for(d=0;d<c.length;d++)e=b[c[d]],J.Ma(e,a).ak=d,K.Wf(b[c[d]],a)}};a.XE=function(a){for(var b=q(a,"LAMP",-1),c=q(a,"MESH",-1),d=0;d<c.length;d++)for(var e=J.Ma(c[d],a).T,g=0;g<e.length;g++){var h=e[g];"MAIN"==h.type&&(B.aF(h,b,a),B.ub(h))}};a.oB=function(){for(var a=[],b=Q.MESH,c=0;c<
b.length;c++){var d=b[c];d.f.Ne&&a.push(d)}return a};a.Cd=function(b,c,d,e){var g=null,h=Q.ALL;switch(b){case a.an:g=z(c,h,!0,d);break;case a.$m:a:{for(b=0;b<h.length;b++)if(g=h[b],g.Yg==d&&(g.f.oc==e||-1==e)){var f=J.get_dg_parent(g);if(f&&f.Yg==c)break a}g=null}break;case a.Ze:a:{for(e=0;e<h.length;e++){b=h[e];for(var g=c.length-1,f=b,m=!0;0<=g&&m;)m=f&&f.Yg==c[g]&&(f.f.oc==d||-1==d),f&&(f=J.get_dg_parent(f)),g--;if(m&&!f){g=b;break a}}g=null}}return g};a.pick_object=function(b,c){var d=K.Sh();
if(!d)return F.error("No active scene"),null;var e=K.XC(d,b,c);if(!e)return null;for(var d=q(d,"MESH",-1),g=0;g<d.length;g++){var h=d[g].f,f=h.pl;if(f&&3>Math.abs(255*f[0]-e[0])&&3>Math.abs(255*f[1]-e[1])&&3>Math.abs(255*f[2]-e[2]))return h.tb&&h.lu&&(X.outlining_overview_mode?a.apply_outline_anim(d[g],X.qi,X.ri,X.si):(e=h.pi,a.apply_outline_anim(d[g],e.qi,e.ri,e.si))),d[g]}return null};a.set_wind_params=function(a,b){for(var d=q(a,"EMPTY",-1),e=0;e<d.length;e++){var g=d[e];if(g.Lh&&"WIND"===g.Lh.type)var h=
g}if(!h)return F.error("There is no wind on the scene"),0;"number"==typeof b.wind_dir&&(ba.set(-Math.PI/2,b.wind_dir/180*Math.PI,0,na),aa.euler_to_quat(na,ma),V.set_rotation(h,ma),c(h));"number"==typeof b.wind_strength&&(h.Lh.sv=b.wind_strength,c(h));K.Dq(a)};a.remove_object=function(a){r.Sy(a)&&r.remove(a);var b=Q.ALL,c=Q[a.type],d=b.indexOf(a);a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)};a.QC=G;a.RC=function(a){return Q[a.type]&&-1<Q[a.type].indexOf(a)};a.set_nodemat_rgb=function(a,
b,c,d,e){b=b.join("%join%");var h=g(a,b);null!=h?(a.f.Pc[3*h]=c,a.f.Pc[3*h+1]=d,a.f.Pc[3*h+2]=e):F.error('The RGB node "'+b+'" was not found in the object "'+a.name+'".')};a.set_nodemat_value=function(a,b,c){b=b.join("%join%");var d=h(a,b);null!=d?a.f.Ie[d]=c:F.error('The Value node "'+b+'" was not found in the object "'+a.name+'".')}};b4w.module.__obj_util=function(a,p){function d(a,b,c){c||(c=a);return{name:a,Yg:c,type:b,SB:!1,qa:!1,Yj:!1,Rm:!1,f:null,Ja:null,A:null,Na:null,bl:null,anchor:null,Lh:null,em:null,W:[],Qb:[],xd:[],Pn:[],F:[],rk:[],qd:[],xh:[],Hd:null,Jf:[],parent:null,Ef:!1,kk:"",Si:!1,rc:!1,is_character:!1,Lg:!1,m:null,l:null,ld:null,Bc:null,Mh:null,Rr:null,Cp:[],Fd:{pm:"NO_COLLISION",Jk:!1,Rv:!1,Zd:0,Wv:0,Vv:0,$n:0,Rp:0,nC:!1,oC:!1,pC:!1,qC:!1,rC:!1,sC:!1,qj:0,oj:0,rj:0,Fq:!1,ol:"BOX",Ik:!1},ku:{Km:0,xp:0,Rc:0,Mp:0},
Yk:0,actions:[],qp:!1,Ha:null}}function c(a){if(!(a instanceof Object))return a;var b=null,d=null,f=null;a.U&&(b=a.U,a.U=null);a.Ob&&(d=a.Ob,a.Ob=null);a.ca&&(f=a.ca,a.ca=null);var k;k=a.constructor;switch(k){case Float32Array:case Uint32Array:case Uint16Array:k=new k(a);break;case Array:k=new k(a.length);for(var n=0;n<a.length;n++)k[n]=c(a[n]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:k=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:k=null;break;case Function:k=
a;break;default:for(n in k=new k,a)k[n]=c(a[n])}b&&(k.U=b,a.U=b);d&&(k.Ob=d,a.Ob=d);f&&(k.ca=f,a.ca=f);return k}function b(a,b){for(var c=a.W,d=0;d<c.length;d++){var f=c[d];if(f.xa==b)return f}return null}function k(a){return a.Ef?a.parent:a.parent?k(a.parent):null}var f=p("__mat4");p("__print");var n=p("__quat"),l=p("__tsr"),u=p("__vec4");new Float32Array(4);new Float32Array(4);new Float32Array(4);new Float32Array(8);new Float32Array(8);a.Fh=function(a){a={type:a,oc:0,yB:[0,0],i:new Float32Array(3),
quat:new Float32Array(4),za:new Float32Array(8),aa:new Float32Array(16),xt:new Float32Array(16),Xb:new Float32Array(3),gc:new Float32Array(3),Xh:0,Yh:0,So:!1,pl:null,Cf:0,rq:!1,Pv:!1,Da:0,Lq:1,Kq:1,Mq:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ye:null,Gv:!1,xe:0,zg:0,lb:!1,fc:null,mc:null,Ib:null,jo:!0,S:null,pi:{qi:1,ri:1,si:0},hd:null,Sc:null,ic:new Float32Array(4),Kj:0,Ej:0,bk:0,Pg:0,Cl:!1,Vc:!1,yc:!1,xc:!1,jc:!1,Yb:!1,wc:!1,ae:"",se:!1,bd:!1,Bl:!1,Vd:!1,Fb:!1,Hh:!1,Wh:!1,am:!1,Ne:!1,
km:!1,tb:!1,jm:!1,lu:!1,Yl:!1,is_visible:!1,uo:!1,Mk:0,ke:0,Ve:0,we:0,ve:0,qe:0,He:"",Ub:null,gl:!1,vd:!1,tn:!1,hj:"",gj:!1,md:0,time:0,Jq:0,Tv:0,Je:0,Jj:!1,Qb:!1,je:!1,Lf:[],$h:!1,kg:!1,bf:1,jn:0,hn:1,Pm:new Int8Array([-1,-1]),Fm:[],Vt:[],cv:[],vc:null,Tc:null,Ac:null,Zc:null,fd:null,Dh:null,Dp:null,ln:null,kn:null,Ie:null,Sg:null,cm:null,Pc:null,Rg:null,dm:null,Bh:null,Kb:null,qn:null,on:null,pn:null,nb:null,gd:null,Lb:null,cf:null,ng:null,scale:1,wf:1E4};n.identity(a.quat);l.identity(a.za);f.identity(a.aa);
f.identity(a.xt);return a};a.Tn=d;a.ks=function(a){a=d(a,"MESH");a.SB=!0;return a};a.Qn=function(a){return a instanceof Array?a.slice():a};a.hf=c;a.qa=function(a){return a.qa};a.Vj=function(a){return"MESH"==a.type&&a.qa};a.al=function(a,b){a.W.push({xa:b,Wl:!1,T:[],Ff:null,jf:null,$u:[],ak:0,iu:!1})};a.$k=function(a,c,d){b(a,c).T.push(d)};a.xI=function(a,b){for(var c=a.W,d=0;d<c.length;d++)if(c[d].xa==b){c.splice(d,1);break}};a.Ma=b;a.Mv=function(a,b){for(var c=0;c<a.length;c++)u.copy(b,a[c].f.ic)};
a.Tp=function(a,b,c){for(var d=0;d<a.W.length;d++){var f=a.W[d];c&&f.xa!=c||(f.Wl=b)}};a.Co=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.Na.Ss)return c}return null};a.Ps=function(a,b){return a+"*"+b};a.get_parent=function(a){return a.Ef?null:a.parent};a.get_dg_parent=k;a.Ao=function(a,b){for(var c=[],d=0;d<b.length;d++){var f=b[d];k(f)==a&&c.push(f)}return c};a.is_mesh=function(a){return"MESH"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===
a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===a.type};a.is_empty=function(a){return"EMPTY"===a.type}};b4w.module.__particles=function(a,p){function d(){throw"_rand() undefined";}function c(a,b,c,d,f,k,l){var u=a.Al,A=a.Ad,r=a.time;a=a.wu;for(var m=b?4:1,y=0;y<u.length;y+=m){var t=u[y];if(r>a&&r>=t&&t>a||r<a&&(t>a||r>=t))for(t=0;8>t;t++)A[8*y+t]=f[t];for(t=0;8>t;t++)e[t]=A[8*y+t];t=h;t[0]=c[3*y];t[1]=c[3*y+1];t[2]=c[3*y+2];n.transform_vec3(t,e,t);k[3*y]=t[0];k[3*y+1]=t[1];k[3*y+2]=t[2];var p=h;p[0]=d[3*y];p[1]=d[3*y+1];p[2]=d[3*y+2];n.transform_dir_vec3(p,e,p);l[3*y]=p[0];l[3*y+1]=p[1];l[3*y+2]=p[2];
if(b)for(t=1;4>t;t++)k[3*(y+t)]=k[3*y],k[3*(y+t)+1]=k[3*y+1],k[3*(y+t)+2]=k[3*y+2],l[3*(y+t)]=p[0],l[3*(y+t)+1]=p[1],l[3*(y+t)+2]=p[2]}}function b(a){a?(l.AE(a),d=function(){return l.nD()}):d=function(){return Math.random()}}p("__config");var k=p("__geometry");p("__scenes");var f=p("__time"),n=p("__tsr"),l=p("__util"),u=p("__vec3"),e=new Float32Array(8),h=new Float32Array(3);a.ni=function(a){a=a.W;for(var b=0;b<a.length;b++)for(var c=a[b].T,d=0;d<c.length;d++)if(c[d].sa)return!0;return!1};a.wp=function(a){a=
a.W;for(var b=0;b<a.length;b++)for(var c=a[b].T,d=0;d<c.length;d++){var e=c[d].sa;if(e&&"EMITTER"==e.yp)return!0}return!1};a.Cy=function(a){return 0<a.particle_systems.length};a.By=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.BB=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.HB=function(a,b,c){var d=a.sa={name:b.name,
yp:b.settings.type,time:0,wu:-1,Iq:!1,I:0,Z:0,Cv:0,$o:0,Ot:0,cyclic:!1,Zd:0,rp:0,lt:0,Cg:0,Lc:0,iw:0,size:0,or:0,nr:0,bv:0,as:0,av:new Float32Array(8),$r:new Float32Array(16),ui:null,tu:null,du:null,eu:null,Al:null,eo:null,Ad:null};d.I=b.settings.frame_start;d.Z=b.settings.frame_end;d.Cv=(d.Z-d.I)/f.Hb();d.$o=b.settings.lifetime;d.Ot=d.$o/f.Hb();d.cyclic=b.settings.b4w_cyclic?1:0;d.Zd=b.settings.mass;d.rp=b.settings.normal_factor;d.lt=9.81*b.settings.effector_weights.gravity;d.Cg=b.settings.b4w_fade_in/
f.Hb();d.Lc=b.settings.b4w_fade_out/f.Hb();d.iw=b.settings.effector_weights.wind;d.Iq="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var e,h;a.Ig?(a=c.halo.size,e=c.halo.hardness,30>e?(e=.5,h=.9):40>e?(e=.1,h=1):50>e?(e=0,h=.8):(e=0,h=.5)):(a=b.settings.particle_size,h=e=1);d.size=a;d.or=e;d.nr=h;a=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(a[0]&&a[0].use_map_size&&a[0].texture&&"BLEND"==a[0].texture.type&&a[0].texture.use_color_ramp){a=a[0].texture.color_ramp.elements;e=Math.min(2*a.length,
b.length);for(h=0;h<e;h+=2){var k=a[h/2];b[h]=k.position;b[h+1]=(k.color[0]+k.color[1]+k.color[2])/3}d.bv=a.length}d.av.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){a=b[0].texture.color_ramp.elements;e=Math.min(4*a.length,c.length);for(h=0;h<e;h+=4)k=a[h/4],c[h]=k.position,c[h+1]=k.color[0],c[h+2]=k.color[1],c[h+3]=k.color[2];d.as=a.length}d.$r.set(c)};a.LA=function(a,
e,h,n){var p=a.sa,B=h.settings.count,v=h.settings.frame_start/f.Hb(),E=h.settings.frame_end/f.Hb(),A=h.settings.lifetime/f.Hb(),r=h.settings.lifetime_random,m=h.settings.emit_from,y=h.settings.factor_random,t=h.settings.angular_velocity_mode,J=h.settings.angular_velocity_factor,C=h.settings.b4w_randomize_emission,I=h.settings.b4w_cyclic,F=!a.Ig;b(h.seed);e=k.Fs(e,["a_position","a_normal"],null);switch(m){case "VERT":h=e.B[0].a_position;e=e.B[0].a_normal;for(var N=h.length/3,m=[],w=0;w<B;w++){var K=
Math.round((N-1)*d());m.push(K);F&&(m.push(K),m.push(K),m.push(K))}N=[];for(w=0;w<m.length;w++)N.push(h[3*m[w]]),N.push(h[3*m[w]+1]),N.push(h[3*m[w]+2]);h=new Float32Array(N);N=[];for(w=0;w<m.length;w++)N.push(e[3*m[w]]),N.push(e[3*m[w]+1]),N.push(e[3*m[w]+2]);m=new Float32Array(N);break;case "FACE":h=[];m=[];w=[];l.Ul(0,w);N=k.yo(e,B,!1,w);l.Ul(0,w);e=k.yo(e,B,!0,w);for(w=0;w<N.length;w++)h.push(N[w][0],N[w][1],N[w][2]),F&&(h.push(N[w][0],N[w][1],N[w][2]),h.push(N[w][0],N[w][1],N[w][2]),h.push(N[w][0],
N[w][1],N[w][2])),m.push(e[w][0],e[w][1],e[w][2]),F&&(m.push(e[w][0],e[w][1],e[w][2]),m.push(e[w][0],e[w][1],e[w][2]),m.push(e[w][0],e[w][1],e[w][2]));h=new Float32Array(h);m=new Float32Array(m);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}m=[h,m];e=m[0];m=m[1];p.ui=new Float32Array(e);p.du=new Float32Array(m);p.tu=new Float32Array(e.length);p.eu=new Float32Array(m.length);h=[];E=(E-v)/B;for(N=0;N<B;N++)w=C?E*N+10*E*(.5-d()):E*N,
I||(w+=v),h.push(w),F&&(h.push(w),h.push(w),h.push(w));v=new Float32Array(h);p.Al=new Float32Array(v);p.eo=new Float32Array(v);p.Ad=new Float32Array(8*v.length);for(C=0;C<8*v.length;C++)for(I=0;8>I;I++)p.Ad[8*C+I]=n[I];p.Iq&&c(p,F,e,m,n,e,m);n=l.xb("EMITTER_PARTICLES");p=l.yd();p.a_position=e;p.a_normal=m;n.B[0]=p;if(F){a.ze=k.Qk;a=[];for(p=0;p<B;p++)a.push(4*p,4*p+2,4*p+1,4*p,4*p+3,4*p+2);a=new Uint16Array(a);n.pa=a;a=n.L;p=[];for(C=0;C<B;C++)p.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);p=new Float32Array(p);
a.a_p_bb_vertex=p}else a.ze=k.Wq,n.pa=new Uint16Array(0);n.P=e.length/3;n.L.a_p_delay=v;a=n.L;p=[];r*=A;for(v=0;v<B;v++)C=r*d(),p.push(A-C),F&&(p.push(A-C),p.push(A-C),p.push(A-C));A=new Float32Array(p);a.a_p_lifetime=A;A=n.L;r=[];for(a=0;a<B;a++){p=[d()-.5,d()-.5,d()-.5];u.normalize(p,p);r.push(y*p[0]);r.push(y*p[1]);r.push(y*p[2]);switch(t){case "NONE":r.push(0);break;case "SPIN":case "VELOCITY":r.push(J);break;case "RAND":r.push(2*J*(d()-.5));break;default:throw"Undefined velocity factor";}if(F)for(p=
r.slice(-4),v=0;12>v;v++)r.push(p[v%4])}B=new Float32Array(r);A.a_p_vels=B;return n};a.lF=function(a,b){for(var d=0;d<b.length;d++){var e=b[d],h=b[d].sa;if(h){var f=e.R;if(!h.Iq)break;var n=h.tu,l=h.eu;c(h,!e.Ig,h.ui,h.du,a.f.za,n,l);k.xC(f);k.Qm(f,"a_position",3,n);k.Qm(f,"a_normal",3,l)}}};a.aE=function(a,b,c){a=a.W;for(var d=0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var f=e[h].sa;f&&f.name==b&&(f.wu=f.time,f.time=c)}};a.hD=function(a){for(var b=a.P,c=a.B[0].a_position,d=a.L.a_texcoord,
e=[],h=[],f=0;f<b;f++)h.push(c[3*f]),h.push(c[3*f+1]),e.push(c[3*f+2]);e=new Float32Array(e);h=new Float32Array(h);a.L.a_lf_dist=e;a.L.a_lf_bb_vertex=h;a.L.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.W;for(var d=0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var f=e[h].sa;f&&f.name==b&&(f.size=c)}};a.set_normal_factor=function(a,b,c){a=a.W;for(var d=0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var f=e[h].sa;f&&f.name==b&&(f.rp=c)}};a.set_factor=function(a,b,c){a=a.W;for(var d=
0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var f=e[h],n=f.sa;if(n&&n.name==b){var l=n.Al;if(1==c)n=l;else if(0==c)for(var r=!f.Ig,m=r?4:1,n=n.eo,u=0;u<n.length;u+=m)n[u]=1E4,r&&(n[u+1]=n[u],n[u+2]=n[u],n[u+3]=n[u]);else for(var t=1/c,n=n.eo,m=(r=!f.Ig)?4:1,p=0,u=0;u<n.length;u+=m)u>=p?(n[u]=l[u],p+=t):n[u]=1E4,r&&(n[u+1]=n[u],n[u+2]=n[u],n[u+3]=n[u]);k.Qm(f.R,"a_p_delay",1,n)}}};a.wF=function(a,b,c){a=a.W;for(var d=0;d<a.length;d++)for(var e=a[d].T,h=0;h<e.length;h++){var f=e[h].sa;if(f)for(var k=
0;k<8*f.Al.length;k++)f.Ad[8*k]=b[0],f.Ad[8*k+1]=b[1],f.Ad[8*k+2]=b[2],f.Ad[8*k+3]=b[3],f.Ad[8*k+4]=c[0],f.Ad[8*k+5]=c[1],f.Ad[8*k+6]=c[2],f.Ad[8*k+7]=c[3]}}};b4w.module.__primitives=function(a,p){function d(a,b,c,d){for(var f=[],k=[],n=[],u=[],v=2*c/(a-1),p=2*d/(b-1),A=0;A<a;A++)for(var r=-c+A*v,m=0;m<b;m++)if(k.push(r,0,-d+m*p),n.push(0,1,0),u.push(A/(a-1),m/(b-1)),A&&m){var y=A*b+m,t=y-1,J=(A-1)*b+m,C=J-1;f.push(y,t,J);f.push(t,C,J)}a=l.yd();a.a_position=new Float32Array(k);a.a_normal=new Float32Array(n);n=l.xb("GRID_PLANE");n.B[0]=a;n.L.a_texcoord=new Float32Array(u);n.pa=new Uint32Array(f);n.P=k.length/3;return n}function c(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=4){var n=a[f+1],u=a[f+2],p=a[f+3];k(a[f],d);k(n,d);k(u,d);k(p,d);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=l.yd();a.a_position=new Float32Array(d);b=l.xb("FROM_QUADS");b.B[0]=a;b.pa=new Uint32Array(c);b.P=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function k(a,b){b.push(a[0],a[1],a[2])}var f=p("__config"),n=p("__geometry");p("__print");var l=p("__util"),u=f.q;a.FH=function(a){for(var b=l.xb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);
d=l.yd();d.a_point=new Float32Array(c);b.B[0]=d;b.pa=new Uint32Array(c);b.P=2*a;return b};a.GH=function(a,b){var c=d(2,2,a,b);c.name="PLANE";return c};a.EH=d;a.QA=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==B-1)||1==b%2&&(0==a||a==p-1)?!0:!1}var f=c/=Math.pow(2,a-1),k=c,p=b+1,B=b+1;b=[];c=[];for(var v=0,E=0,A=-1,r=[],m=0;m<a;m++){for(var y=2*f/(p-1),t=2*k/(B-1),J=[],C=[],I=0,F=0;F<p;F++){for(var N=-f+F*y,w=[],K=0;K<B;K++){var x=-k+K*t;if(N>-v&&N<v&&x>-E&&x<E)w.push(-1),I++;else{for(var V=
null,U=0;U<r.length;U+=3)if(N==r[U]&&x==r[U+1]){V=r[U+2];break}U=null!==V?V:A+1;d(F,K)?(w.push(-2),I++):(null==V&&(0==K||K==B-1||0==F||F==p-1?(V=m==a-1?y:2*y,J.push(N,x,U)):V=y,c.push(N,V,x),A++),w.push(U));if(F&&K)if(1==F)if(d(F-1,K)){if(1<K){var x=U-1,V=C[F-1][K+1],aa=V-1;b.push(U,x,aa)}else V=C[F-1][K+1],aa=V-1;b.push(U,aa,V)}else d(F,K)||(x=U-1,V=C[F-1][K],b.push(U,x,V));else if(F==p-1){if(!d(F,K))if(K==B-1)x=U-1,V=C[F-1][K-1],aa=C[F-2][K],b.push(U,x,V),b.push(U,V,aa);else{var x=U-1,V=C[F-1][K],
aa=V-1,ba=V+1;b.push(U,x,aa);b.push(U,aa,V);b.push(U,V,ba);2==K&&(ba=C[F-2][K-2],b.push(x,ba,aa))}}else 1==K?d(F,K-1)?(x=C[F-1][K],V=C[F-1][K-1],b.push(U,V,x)):(x=w[K-1],V=C[F-1][K],aa=C[F-2][K-1],b.push(U,x,V),b.push(x,aa,V)):K==B-1?d(F,K)||(x=w[K-1],V=C[F-1][K-1],aa=C[F-2][K],b.push(U,x,V),b.push(U,V,aa)):-1!=C[F-1][K]&&-1!=C[F-1][K-1]&&-1!=w[K-1]?(x=w[K-1],V=C[F-1][K],aa=C[F-1][K-1],b.push(U,x,V),b.push(x,aa,V),K==B-2&&d(F,K+1)&&(ba=C[F-1][K+1],b.push(U,V,ba))):K==B-2&&d(F,K+1)&&(V=C[F-1][K],ba=
C[F-1][K+1],b.push(U,V,ba))}}C.push(w)}r=J;v=f;E=k;f*=2;k*=2}2E4>v&&(a=-(2*v)/(p-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-v,a,-E),c.push(-v,a,E),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(v,a,-E),c.push(v,a,E),U=A+1,b.push(U+3,U+2,U+1,U+2,U+0,U+1,U+6,U+4,U+2,U+4,U+0,U+2,U+5,U+7,U+1,U+7,U+3,U+1,U+5,U+4,U+7,U+7,U+4,U+6));a=l.yd();a.a_position=new Float32Array(c);f=l.xb("multigrid_plane");f.B[0]=a;f.pa=new Uint32Array(b);f.P=c.length/3;u.hw&&(n.Im(f,1,!0),a.a_polyindex=n.po(f));return f};a.DH=
function(a){var b=a.length;if(b%3)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=3){var n=a[f+1],u=a[f+2];k(a[f],d);k(n,d);k(u,d);c.push(f,f+1,f+2)}a=l.yd();a.a_position=new Float32Array(d);b=l.xb("FROM_TRIANGLES");b.B[0]=a;b.pa=new Uint32Array(c);b.P=d.length/3;return b};a.CH=c;a.MA=function(a){a=l.TF(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";
return a};a.yb=function(){var a=l.xb("FULLSCREEN_TRI"),b=l.yd();b.a_position=new Float32Array([0,0,1,0,0,1]);a.B[0]=b;a.pa=new Uint32Array([0,1,2]);a.P=3;return a};a.NA=function(){var a=l.xb("FULLSCREEN_QUAD"),b=l.yd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.B[0]=b;a.pa=new Uint32Array([0,2,1,1,2,3]);a.P=4;return a};a.IA=function(){var a=l.xb("BILLBOARD"),b=l.yd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.B[0]=b;a.pa=new Uint32Array([0,2,1,0,3,2]);a.P=4;return a};
a.JA=function(){var a=l.xb("CUBEMAP_BOARD"),b=l.yd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.B[0]=b;a.pa=new Uint32Array([0,2,1,0,3,2]);a.P=4;return a};a.xo=function(a,c){var d=l.xb("UV_SPHERE"),f,u,p=[],D=[],B=[];for(u=0;8>=u;u++)for(f=0;16>=f;f++){var v=f/16,E=u/8;D.push(-a*Math.cos(2*v*Math.PI)*Math.sin(E*Math.PI)+c[0],a*Math.cos(E*Math.PI)+c[1],a*Math.sin(2*v*Math.PI)*Math.sin(E*Math.PI)+c[2])}for(u=v=0;8>u;u++)for(f=0;16>f;f++){var E=b(D,17*u+f+1),A=b(D,17*u+f),r=b(D,17*(u+1)+
f),m=b(D,17*(u+1)+f+1);Math.abs(E[1])==a+c[1]?(k(E,p),k(r,p),k(m,p),B.push(v,v+1,v+2),v+=3):Math.abs(r[1])==a+c[1]?(k(E,p),k(A,p),k(r,p),B.push(v,v+1,v+2),v+=3):(k(E,p),k(A,p),k(r,p),k(m,p),B.push(v,v+1,v+2),B.push(v,v+2,v+3),v+=4)}f={};f.a_position=p;D=n.Kr(B,D,p);f.a_normal=n.Jr(B,p,D);f.a_tangent=[];d.L.a_influence=[];d.L.a_color=[];d.L.a_texcoord=[];d.B[0]=f;d.pa=B;d.P=p.length/3;return d};a.Rs=function(a){var b=l.xb("INDEX"),c=l.yd();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=
d;b.B[0]=c;b.pa=new Uint16Array(0);b.P=a;return b}};b4w.module.__prerender=function(a,p){function d(a,c){var d=a.Ed,e=c.j;d.is_visible=!1;var f;if(!(f=!d||d.Wh)){var k=e.of,l=d.Lb.G;f=d.wf;k=Math.sqrt((l[0]-k[0])*(l[0]-k[0])+(l[1]-k[1])*(l[1]-k[1])+(l[2]-k[2])*(l[2]-k[2]));l=d.Pg*d.Lb.Pa;f=!(k>=d.bk&&k<f+l)}if(f)return!1;d.is_visible=!0;(f="OUTLINE_MASK"==c.type&&!Boolean(d.Cf))||(e=e.Lj,d.Hh?f=!1:("STATIC"===d.type?(f=d.Lb,d=f.G,d=n.vE(d,e,f.Pa)):(f=d.ng,d=f.G,d=n.kA(d,e,f.Pd,f.Qd,f.Rd)),f=d));return f?!1:"WIREFRAME"==c.type?a.C.wireframe_mode==b.WM_DEBUG_SPHERES?
a.C.xg:!a.C.xg:!0}var c=p("__config"),b=p("__debug"),k=p("__geometry"),f=p("__renderer"),n=p("__util"),l=p("__vec3"),u=c.q,e="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Ep=function(a){if(-1<e.indexOf(a.type)){for(var b=!1,c=a.p,n=0;n<c.length;n++){var p=c[n];if("MAIN_CUBE_REFLECT"==a.type)for(var D=0;6>D;D++)a.j.Lj=a.Wn[D],p.ho[D]=d(p,a),p.ho[D]&&(b=!0);else p.ob=d(p,a),p.ob&&
(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?a.ob=!0:(a.ob&&f.clear(a),a.ob=!1)}}if("MAIN_BLEND"==a.type&&u.alpha_sort&&a.p){b=a.j.of;c=l.dist(b,a.lw)>u.alpha_sort_threshold;for(n=0;n<a.p.length;n++)if(D=a.p[n],p=D.Ed,p.uo||c){var B=D.C;if(B&&B.Ia&&B.Ye!=k.ne){B=B.R;if(!B||!D.ob)continue;(D=B.Tl)&&D.type==k.fr&&k.fF(B,p.aa,b)}p.uo=!1}c&&l.copy(b,a.lw)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}var d=!1,c=0,b=0;a.bE=function(a){d=a};a.gp=function(){console.log.apply(console,arguments)};a.log=function(){if(d){var a=p(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){c++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){b++;var a=p(arguments,"B4W WARN");console.warn.apply(console,
a)};a.info=function(){var a=p(arguments,"B4W INFO");console.info.apply(console,a)};a.oA=function(){c++;var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.pA=function(){b++;var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){d&&console.time.apply(console,arguments)};a.timeEnd=function(){d&&console.timeEnd.apply(console,arguments)};a.group=function(){d&&console.group.apply(console,arguments)};a.groupCollapsed=function(){d&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){d&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.wB=function(){return b};a.fB=function(){return c};a.clear_errors_warnings=function(){c=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function d(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function c(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.strips.length;e++){var f=d.strips[e];"action"in f||(f.action=null,b("strip",f,"action"));"action_frame_start"in f||(f.action_frame_start=0,b("strip",f,"action_frame_start"));"action_frame_end"in f||(f.action_frame_end=f.frame_end-f.frame_start,b("strip",f,"action_frame_end"));"repeat"in f||(f.repeat=1,b("strip",f,"repeat"));"use_reverse"in f||(f.use_reverse=!1,b("strip",f,"use_reverse"));"scale"in f||(f.scale=1,b("strip",
f,"scale"))}}function b(a,b,c){c=c+">>"+a;c in D||(D[c]={jq:[],Ju:"undefined",type:a});D[c].jq.push(b.name)}function k(a,b,c){c=c+">>"+a;c in D||(D[c]={jq:[],Ju:"deprecated",type:a});D[c].jq.push(b.name)}function f(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=g.sg(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=g.nj(d[c]);e.submeshes.push(f)}return e}var n=p("__boundings"),l=
p("__curve"),u=p("__mat4"),e=p("__print"),h=p("__quat"),g=p("__util"),q=p("__vec3"),z=p("__vec4"),G=[5,4],D={};a.Ur=function(a){return-1!=g.Xv(a,G)};a.Qy=function(a){D={};var f=a.worlds;if(0==f.length){e.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var h={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,
intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};f.push(h)}for(var f=a.worlds,n=0;n<f.length;n++){h=f[n];"use_sky_blend"in h||(b("world",h,"use_sky_blend"),h.use_sky_blend=!1);"use_sky_paper"in h||(b("world",h,"use_sky_paper"),h.use_sky_paper=!1);"use_sky_real"in h||(b("world",h,"use_sky_real"),h.use_sky_real=!1);"b4w_sky_settings"in h&&"rayleigh_brightness"in h.b4w_sky_settings||
(b("world",h,"rayleigh_brightness"),h.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in h||(b("world",h,"fog_settings"),h.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},
"b4w_fog_color"in h&&(h.fog_settings.use_custom_color=!0,h.fog_settings.color=h.b4w_fog_color),"b4w_fog_density"in h&&0<h.b4w_fog_density&&(h.fog_settings.depth=1/h.b4w_fog_density));"render_sky"in h.b4w_sky_settings||(b("world",h,"render_sky"),h.b4w_sky_settings.render_sky=!1);for(var r=h.texture_slots,h=0;h<r.length;h++){var m=r[h];"blend_type"in m||(m.blend_type="MIX",b("world_texture_slot",m,"blend_type"));"use_map_blend"in m||(m.use_map_blend=!1,b("world_texture_slot",m,"use_map_blend"));"use_map_horizon"in
m||(m.use_map_horizon=!0,b("world_texture_slot",m,"use_map_horizon"));"use_map_zenith_up"in m||(m.use_map_zenith_up=!1,b("world_texture_slot",m,"use_map_zenith_up"));"use_rgb_to_intensity"in m||(m.use_rgb_to_intensity=!1,b("world_texture_slot",m,"use_rgb_to_intensity"));"invert"in m||(m.invert=!1,b("world_texture_slot",m,"invert"));"color"in m||(m.color=[1,0,1],b("world_texture_slot",m,"color"));"blend_factor"in m||(m.blend_factor=0,b("world_texture_slot",m,"blend_factor"));"horizon_factor"in m||
(m.horizon_factor=1,b("world_texture_slot",m,"horizon_factor"));"zenith_up_factor"in m||(m.zenith_up_factor=0,b("world_texture_slot",m,"zenith_up_factor"));"zenith_down_factor"in m||(m.zenith_down_factor=0,b("world_texture_slot",m,"zenith_down_factor"));"default_value"in m||(m.default_value=1,b("world_texture_slot",m,"default_value"))}}h=a.scenes;for(n=0;n<h.length;n++)r=h[n],m=r.world,"timeline_markers"in r||(r.timeline_markers=null,b("scene",r,"timeline_markers")),"b4w_reflection_quality"in r||
(r.b4w_reflection_quality="MEDIUM",b("scene",r,"b4w_reflection_quality")),"b4w_use_nla"in r||(r.b4w_use_nla=!1,b("scene",r,"b4w_use_nla")),"fps"in r||(r.fps=24,b("scene",r,"fps")),"b4w_nla_cyclic"in r||(r.b4w_nla_cyclic=!1,b("scene",r,"b4w_nla_cyclic")),"b4w_logic_nodes"in r||(r.b4w_logic_nodes=[],b("scene",r,"b4w_logic_nodes")),"b4w_detect_collisions"in r&&(k("scene",r,"b4w_detect_collisions"),delete r.b4w_detect_collisions),"audio_doppler_speed"in r||(r.audio_doppler_speed=343.3),"audio_doppler_factor"in
r||(r.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in r||(r.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",r,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in r||(r.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in r||(r.b4w_enable_bloom=!1,b("scene",r,"b4w_enable_bloom")),"b4w_enable_motion_blur"in r||(r.b4w_enable_motion_blur=!1,b("scene",r,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in r||(r.b4w_enable_color_correction=
!1,b("scene",r,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in r||(r.b4w_enable_antialiasing=!0,b("scene",r,"b4w_enable_antialiasing")),"b4w_tags"in r||(r.b4w_tags={title:"",description:""},b("scene",r,"b4w_tags")),"b4w_enable_object_selection"in r||(r.b4w_enable_object_selection="AUTO",b("scene",r,"b4w_enable_object_selection")),"b4w_enable_outlining"in r||(r.b4w_enable_outlining="AUTO",b("scene",r,"b4w_enable_outlining")),"b4w_enable_glow_materials"in r||(r.b4w_enable_glow_materials=
"AUTO",b("scene",r,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in r||(r.b4w_enable_anchors_visibility="AUTO",b("scene",r,"b4w_enable_anchors_visibility")),"b4w_outline_color"in r||(r.b4w_outline_color=[1,1,1],b("scene",r,"b4w_outline_color")),"b4w_outline_factor"in r||(r.b4w_outline_factor="b4w_glow_factor"in r?r.b4w_glow_factor:1,b("scene",r,"b4w_outline_factor")),"b4w_shadow_settings"in r||(b("scene",r,"b4w_shadow_settings"),f=m.b4w_shadow_settings,r.b4w_shadow_settings=f?f:{csm_resolution:2048,
self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),f=r.b4w_shadow_settings,"csm_resolution"in f||(b("scene",r,"b4w_shadow_settings.csm_resolution"),f.csm_resolution=2048),"self_shadow_polygon_offset"in f||(b("scene",r,"b4w_shadow_settings.self_shadow_polygon_offset"),f.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in f||
(b("scene",r,"b4w_shadow_settings.self_shadow_normal_offset"),f.self_shadow_normal_offset=.01),"b4w_enable_csm"in f||(b("scene",r,"b4w_shadow_settings.b4w_enable_csm"),f.b4w_enable_csm=!1),"csm_num"in f||(b("scene",r,"b4w_shadow_settings.csm_num"),f.csm_num=1),"csm_first_cascade_border"in f||(b("scene",r,"b4w_shadow_settings.csm_first_cascade_border"),f.csm_first_cascade_border=10),"first_cascade_blur_radius"in f||(b("scene",r,"b4w_shadow_settings.first_cascade_blur_radius"),f.first_cascade_blur_radius=
3),"csm_last_cascade_border"in f||(b("scene",r,"b4w_shadow_settings.csm_last_cascade_border"),f.csm_last_cascade_border=100),"last_cascade_blur_radius"in f||(b("scene",r,"b4w_shadow_settings.last_cascade_blur_radius"),f.last_cascade_blur_radius=1.5),"fade_last_cascade"in f||(b("scene",r,"b4w_shadow_settings.fade_last_cascade"),f.fade_last_cascade=!0),"blend_between_cascades"in f||(b("scene",r,"b4w_shadow_settings.blend_between_cascades"),f.blend_between_cascades=!0),"b4w_ssao_settings"in r||(b("scene",
r,"b4w_ssao_settings"),f=m.b4w_ssao_settings,r.b4w_ssao_settings=f?f:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),f=r.b4w_ssao_settings,"dist_factor"in f||(b("scene",r,"b4w_ssao_settings.dist_factor"),f.dist_factor=0),"samples"in f||(b("scene",r,"b4w_ssao_settings.samples"),f.samples=16),"hemisphere"in f||(b("scene",r,"b4w_ssao_settings.hemisphere"),f.hemisphere=!1),"blur_depth"in f||(b("scene",r,"b4w_ssao_settings.blur_depth"),f.blur_depth=!1),"blur_discard_value"in
f||(b("scene",r,"b4w_ssao_settings.blur_discard_value"),f.blur_discard_value=1),"b4w_bloom_settings"in r||(b("scene",r,"b4w_bloom_settings"),f=m.b4w_bloom_settings,r.b4w_bloom_settings=f?f:{key:.2,blur:4,edge_lum:1}),"key"in r.b4w_bloom_settings||(b("scene",r,"b4w_bloom_settings.key"),r.b4w_bloom_settings.key=.2),"blur"in r.b4w_bloom_settings||(b("scene",r,"b4w_bloom_settings.blur"),r.b4w_bloom_settings.blur=4),"edge_lum"in r.b4w_bloom_settings||(b("scene",r,"b4w_bloom_settings.edge_lum"),r.b4w_bloom_settings.edge_lum=
1),"b4w_motion_blur_settings"in r||(b("scene",r,"b4w_motion_blur_settings"),f=m.b4w_motion_blur_settings,r.b4w_motion_blur_settings=f?f:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in r.b4w_motion_blur_settings||(b("scene",r,"b4w_motion_blur_settings.motion_blur_factor"),r.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in r.b4w_motion_blur_settings||(b("scene",r,"b4w_motion_blur_settings.motion_blur_decay_threshold"),r.b4w_motion_blur_settings.motion_blur_decay_threshold=
.01),"b4w_color_correction_settings"in r||(b("scene",r,"b4w_color_correction_settings"),f=m.b4w_color_correction_settings,r.b4w_color_correction_settings=f?f:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in r||(b("scene",r,"b4w_god_rays_settings"),f=m.b4w_god_rays_settings,r.b4w_god_rays_settings=f?f:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in r.b4w_god_rays_settings||(b("scene",r,"b4w_god_rays_settings.steps_per_pass"),r.b4w_god_rays_settings.steps_per_pass=
10),"b4w_glow_settings"in r||(b("scene",r,"b4w_glow_settings"),r.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},f=r.b4w_glow_settings,"b4w_render_glow_over_blend"in m&&(f.render_glow_over_blend=m.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in m&&(f.small_glow_mask_coeff=m.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in m&&(f.large_glow_mask_coeff=m.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in
m&&(f.small_glow_mask_width=m.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in m&&(f.large_glow_mask_width=m.b4w_large_glow_mask_width)),m=r.b4w_render_shadows,"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(r.b4w_render_shadows=m?"ON":"OFF"),m=r.b4w_render_reflections,"OFF"!=m&&"ON"!=m&&(r.b4w_render_reflections=m?"ON":"OFF"),m=r.b4w_render_refractions,"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(r.b4w_render_refractions=m?"ON":"OFF"),r.b4w_nla_script&&k("scene",r,"b4w_nla_script");r=a.meshes;for(n=0;n<r.length;n++){m=
r[n];m.b4w_bounding_box||(b("mesh",m,"b4w_bounding_box"),m.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});m.b4w_bounding_box_source||(b("mesh",m,"b4w_bounding_box_source"),m.b4w_bounding_box_source=m.b4w_bounding_box);m.uv_textures||(b("mesh",m,"uv_textures"),m.uv_textures=[]);m.b4w_bounding_sphere_center||(m.b4w_bounding_sphere_center=[0,0,0]);m.b4w_bounding_cylinder_center||(m.b4w_bounding_cylinder_center=[0,0,0]);m.b4w_bounding_ellipsoid_center||(m.b4w_bounding_ellipsoid_center=
[0,0,0]);m.b4w_bounding_ellipsoid_axes||(h=m.b4w_bounding_box,m.b4w_bounding_ellipsoid_axes=[(h.max_x-h.min_x)/2,(h.max_y-h.min_y)/2,(h.max_z-h.min_z)/2]);"b4w_shape_keys"in m||(m.b4w_shape_keys=[],b("mesh",m,"b4w_shape_keys"));for(var h=m,f=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],l=null,q=0;q<f.length;q++)h[f[q]]&&(l?(h[f[q]]=!1,e.warn('WARNING property "'+f[q]+'" of object "'+h.name+'" has been set to "false". Foreground property "'+
l+'" already exists.')):l=f[q]);for(h=0;h<m.b4w_vertex_anim.length;h++)f=m.b4w_vertex_anim[h],"allow_nla"in f||(b('mesh["b4w_vertex_anim"]',m,"allow_nla"),f.allow_nla=!0)}h=a.cameras;for(n=0;n<h.length;n++)r=h[n],r.type||(r.type="PERSP",b("camera",r,"type")),"b4w_eye_target_dist"in r&&(delete r.b4w_eye_target_dist,k("camera",r,"b4w_eye_target_dist")),"b4w_hover_zero_level"in r||(r.b4w_hover_zero_level=0,b("camera",r,"b4w_hover_zero_level")),"b4w_trans_velocity"in r||(r.b4w_trans_velocity=1,b("camera",
r,"b4w_trans_velocity")),"b4w_rot_velocity"in r||(r.b4w_rot_velocity=1,b("camera",r,"b4w_rot_velocity")),"b4w_zoom_velocity"in r||(r.b4w_zoom_velocity=.1,b("camera",r,"b4w_zoom_velocity")),"b4w_use_distance_limits"in r||(r.b4w_use_distance_limits=!1,b("camera",r,"b4w_use_distance_limits")),"b4w_distance_min"in r||(r.b4w_distance_min=1,b("camera",r,"b4w_distance_min")),"b4w_distance_max"in r||(r.b4w_distance_max=100,b("camera",r,"b4w_distance_max")),"b4w_horizontal_translation_min"in r||(r.b4w_horizontal_translation_min=
-100,b("camera",r,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in r||(r.b4w_horizontal_translation_max=100,b("camera",r,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in r||(r.b4w_vertical_translation_min=-100,b("camera",r,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in r||(r.b4w_vertical_translation_max=100,b("camera",r,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in r||(r.b4w_use_horizontal_clamping=!1,b("camera",r,"b4w_use_horizontal_clamping")),
"b4w_rotation_left_limit"in r||(r.b4w_rotation_left_limit=-Math.PI,b("camera",r,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in r||(r.b4w_rotation_right_limit=Math.PI,b("camera",r,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in r||(r.b4w_horizontal_clamping_type="LOCAL",b("camera",r,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in r||(r.b4w_use_vertical_clamping=!1,b("camera",r,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in r||(r.b4w_rotation_down_limit=
-Math.PI/2,b("camera",r,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in r||(r.b4w_rotation_up_limit=Math.PI/2,b("camera",r,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in r||(r.b4w_vertical_clamping_type="LOCAL",b("camera",r,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in r||(r.b4w_hover_angle_min=Math.PI/6,b("camera",r,"b4w_hover_angle_min")),"b4w_hover_angle_max"in r||(r.b4w_hover_angle_max=Math.PI/6,b("camera",r,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in r||
(r.b4w_enable_hover_hor_rotation=!0,b("camera",r,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in r||(r.b4w_use_panning=!0,b("camera",r,"b4w_use_panning"));h=a.lamps;for(n=0;n<h.length;n++)r=h[n],"b4w_generate_shadows"in r||(r.b4w_generate_shadows=!1,b("lamp",r,"b4w_generate_shadows")),"b4w_dynamic_intensity"in r||(r.b4w_dynamic_intensity=!1,b("lamp",r,"b4w_dynamic_intensity")),"use_diffuse"in r||(r.use_diffuse=!0,b("lamp",r,"use_diffuse")),"use_specular"in r||(r.use_specular=!0,b("lamp",r,"use_specular"));
h=a.speakers;for(n=0;n<h.length;n++)r=h[n],"b4w_behavior"in r||(r.b4w_behavior=r.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in r||(r.b4w_disable_doppler=!1),"b4w_delay"in r||(r.b4w_delay=0),"b4w_delay_random"in r||(r.b4w_delay_random=0),"b4w_volume_random"in r||(r.b4w_volume_random=0),"b4w_pitch_random"in r||(r.b4w_pitch_random=0),"b4w_fade_in"in r||(r.b4w_fade_in=0),"b4w_fade_out"in r||(r.b4w_fade_out=0),"b4w_loop"in r||(r.b4w_loop=!1),"b4w_loop_count"in r||(r.b4w_loop_count=
0),"b4w_loop_count_random"in r||(r.b4w_loop_count_random=0),"b4w_playlist_id"in r||(r.b4w_playlist_id=""),r.animation_data&&c(r.animation_data);h=a.textures;for(n=0;n<h.length;n++)r=h[n],"b4w_anisotropic_filtering"in r||(r.b4w_anisotropic_filtering="OFF",b("texture",r,"b4w_anisotropic_filtering")),"b4w_water_foam"in r||(r.b4w_water_foam=!1,b("texture",r,"b4w_water_foam")),"b4w_foam_uv_freq"in r||(r.b4w_foam_uv_freq=[1,1],b("texture",r,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in r||(r.b4w_foam_uv_magnitude=
[1,1],b("texture",r,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in r||(r.b4w_parallax_steps=5,b("material",r,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in r||(r.b4w_parallax_lod_dist=10,b("material",r,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in r||(r.b4w_shore_dist_map=!1,b("texture",r,"b4w_shore_dist_map")),"b4w_shore_boundings"in r||(r.b4w_shore_boundings=new Float32Array(4),r.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",r,"b4w_shore_boundings")),"b4w_max_shore_dist"in r||(r.b4w_max_shore_dist=
100,b("texture",r,"b4w_max_shore_dist")),"b4w_disable_compression"in r||(r.b4w_disable_compression=!1,b("texture",r,"b4w_disable_compression")),"b4w_source_type"in r||(r.b4w_source_type="",b("texture",r,"b4w_source_type")),"b4w_source_id"in r||(r.b4w_source_id="",b("texture",r,"b4w_source_id")),"b4w_source_size"in r||(r.b4w_source_size=1024,b("texture",r,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in r||(r.b4w_enable_canvas_mipmapping=!0,b("texture",r,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in
r||(r.b4w_nla_video=!1,b("texture",r,"b4w_nla_video"));f=a.materials;for(n=0;n<f.length;n++){l=f[n];"b4w_node_mat_type"in l&&k("material",l,"b4w_node_mat_type");"b4w_skydome"in l&&k("material",l,"b4w_skydome");"b4w_procedural_skydome"in l&&k("material",l,"b4w_procedural_skydome");l.b4w_water&&("b4w_water_shore_smoothing"in l||(l.b4w_water_shore_smoothing=!1,b("material",l,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in l||(l.b4w_water_dynamic=!1,b("material",l,"b4w_water_dynamic")),"b4w_waves_height"in
l||(l.b4w_waves_height=1,b("material",l,"b4w_waves_height")),"b4w_waves_length"in l||(l.b4w_waves_length=1,b("material",l,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in l||(l.b4w_water_dst_noise_scale0=.05,b("material",l,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in l||(l.b4w_water_dst_noise_scale1=.03,b("material",l,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in l||(l.b4w_water_dst_noise_freq0=1.3,b("material",l,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in
l||(l.b4w_water_dst_noise_freq1=1,b("material",l,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in l||(l.b4w_water_dir_min_shore_fac=.4,b("material",l,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in l||(l.b4w_water_dir_freq=.5,b("material",l,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in l||(l.b4w_water_dir_noise_scale=.05,b("material",l,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in l||(l.b4w_water_dir_noise_freq=.07,b("material",l,"b4w_water_dir_noise_freq")),
"b4w_water_dir_min_noise_fac"in l||(l.b4w_water_dir_min_noise_fac=.5,b("material",l,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in l||(l.b4w_water_dst_min_fac=.2,b("material",l,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in l||(l.b4w_water_waves_hor_fac=5,b("material",l,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in l||(l.b4w_water_absorb_factor=6,b("material",l,"b4w_water_absorb_factor")),"b4w_water_fog_color"in l||(l.b4w_water_fog_color=new Float32Array(3),l.b4w_water_fog_color=
[.5,.7,.7],b("material",l,"b4w_water_fog_color")),"b4w_foam_factor"in l||(l.b4w_foam_factor=5,b("material",l,"b4w_foam_factor")),"b4w_generated_mesh"in l||(l.b4w_generated_mesh=!1,b("material",l,"b4w_generated_mesh")),"b4w_water_num_cascads"in l||(l.b4w_water_num_cascads=5,b("material",l,"b4w_water_num_cascads")),"b4w_water_subdivs"in l||(l.b4w_water_subdivs=64,b("material",l,"b4w_water_subdivs")),"b4w_water_detailed_dist"in l||(l.b4w_water_detailed_dist=1E3,b("material",l,"b4w_water_detailed_dist")),
"b4w_water_enable_caust"in l||(l.b4w_water_enable_caust=!1,b("material",l,"b4w_water_enable_caust")),"b4w_water_caust_scale"in l||(l.b4w_water_caust_scale=.25,b("material",l,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in l||(l.b4w_water_caust_brightness=.5,b("material",l,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in l||(l.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in l||(l.b4w_dynamic_grass_color="");"diffuse_intensity"in l||(l.diffuse_intensity=1,b("material",l,"diffuse_intensity"));
"b4w_use_ghost"in l||(l.b4w_use_ghost=!1);"b4w_collision_margin"in l||(l.b4w_collision_margin=.04,b("material",l,"b4w_collision_margin"));"b4w_collision_group"in l||(l.b4w_collision_group=128,b("material",l,"b4w_collision_group"));"b4w_collision_mask"in l||(l.b4w_collision_mask=127,b("material",l,"b4w_collision_mask"));"b4w_do_not_render"in l||(l.b4w_do_not_render=!1,b("material",l,"b4w_do_not_render"));"HALO"!=l.type||"b4w_halo_sky_stars"in l||(l.b4w_halo_sky_stars=!1,b("material",l,"b4w_halo_sky_stars"));
"HALO"!=l.type||"b4w_halo_stars_blend_height"in l||(l.b4w_halo_stars_blend_height=10,b("material",l,"b4w_halo_stars_blend_height"));"HALO"!=l.type||"b4w_halo_stars_min_height"in l||(l.b4w_halo_stars_min_height=0,b("material",l,"b4w_halo_stars_min_height"));"specular_shader"in l||(l.specular_shader="COOKTORR",b("material",l,"specular_shader"));"diffuse_shader"in l||(l.diffuse_shader="LAMBERT",b("material",l,"diffuse_shader"));"roughness"in l||(l.roughness=.5,b("material",l,"roughness"));"diffuse_fresnel"in
l||(l.diffuse_fresnel=.1,b("material",l,"diffuse_fresnel"));"diffuse_fresnel_factor"in l||(l.diffuse_fresnel_factor=.5,b("material",l,"diffuse_fresnel_factor"));"specular_slope"in l||(l.specular_slope=.2,b("material",l,"specular_slope"));"specular_toon_size"in l||(l.specular_toon_size=.5,b("material",l,"specular_toon_size"));"specular_toon_smooth"in l||(l.specular_toon_smooth=.1,b("material",l,"specular_toon_smooth"));"specular_alpha"in l||(l.specular_alpha=1,b("material",l,"specular_alpha"));"b4w_wettable"in
l||(l.b4w_wettable=!1,b("material",l,"b4w_wettable"));"b4w_refractive"in l||(l.b4w_refractive=!1,b("material",l,"b4w_refractive"));"b4w_refr_bump"in l||(l.b4w_refr_bump=0,b("material",l,"b4w_refr_bump"));"b4w_shallow_water_col"in l||(l.b4w_shallow_water_col=[0,.8,.3],b("material",l,"b4w_shallow_water_col"));"b4w_shore_water_col"in l||(l.b4w_shore_water_col=[0,.9,.2],b("material",l,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in l||(l.b4w_shallow_water_col_fac=1,b("material",l,"b4w_shallow_water_col_fac"));
"b4w_shore_water_col_fac"in l||(l.b4w_shore_water_col_fac=.5,b("material",l,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in l||(l.b4w_water_sss_strength=5.9,b("material",l,"b4w_water_sss_strength"));"b4w_water_sss_width"in l||(l.b4w_water_sss_width=.45,b("material",l,"b4w_water_sss_width"));"b4w_render_above_all"in l||(l.b4w_render_above_all=!1,b("material",l,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in l||(l.b4w_water_norm_uv_velocity=.05,b("material",l,"b4w_water_norm_uv_velocity"));
"specular_ior"in l||(l.specular_ior=1,b("material",l,"specular_ior"));"darkness"in l||(l.darkness=0,b("material",l,"darkness"));"diffuse_toon_size"in l||(l.diffuse_toon_size=0,b("material",l,"diffuse_toon_size"));"diffuse_toon_smooth"in l||(l.diffuse_toon_smooth=0,b("material",l,"diffuse_toon_smooth"));r=l.texture_slots;for(h=0;h<r.length;h++)m=r[h],"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"));if(l.node_tree){r=l.node_tree.nodes;for(h=0;h<r.length;h++)d(r[h]);l.node_tree.animation_data&&
c(l.node_tree.animation_data)}}m=a.node_groups;for(n=0;n<m.length;n++)for(r=m[n].node_tree.nodes,h=0;h<r.length;h++)d(r[h]);r=a.objects;for(n=0;n<r.length;n++){m=r[n];switch(m.type){case "MESH":"b4w_dynamic_geometry"in m||(m.b4w_dynamic_geometry=!1);"b4w_reflexible"in m||(m.b4w_reflexible=!1);"b4w_reflexible_only"in m||(m.b4w_reflexible_only=!1);"b4w_reflective"in m||(m.b4w_reflective=!1);"b4w_reflection_type"in m||(m.b4w_reflection_type="PLANE",b("object",m,"b4w_reflection_type"));"b4w_wind_bending"in
m||(m.b4w_wind_bending=!1,b("object",m,"b4w_wind_bending"));"b4w_wind_bending_angle"in m||(m.b4w_wind_bending_angle=10,m.b4w_wind_bending_freq=.25,b("object",m,"wind bending params"));"b4w_detail_bending_amp"in m||(m.b4w_detail_bending_amp=.1,m.b4w_branch_bending_amp=.3,b("object",m,"detail bending params"));"b4w_detail_bending_freq"in m||(m.b4w_detail_bending_freq=1,b("object",m,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in m||(m.b4w_main_bend_stiffness_col="",b("object",m,"b4w_main_bend_stiffness_col"));
"b4w_detail_bend_colors"in m||(m.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",m,"b4w_detail_bend_colors"));"b4w_caustics"in m||(m.b4w_caustics=!1);"vertex_groups"in m&&m.vertex_groups.length&&m.data&&0==m.data.vertex_groups.length&&(m.data.vertex_groups=m.vertex_groups,delete m.vertex_groups,b("object",m,"vertex_groups"));"b4w_vertex_anim"in m&&m.b4w_vertex_anim.length&&m.data&&0==m.data.b4w_vertex_anim.length&&(m.data.b4w_vertex_anim=m.b4w_vertex_anim,
delete m.b4w_vertex_anim,b("object",m,"b4w_vertex_anim"));"b4w_do_not_render"in m||(m.b4w_do_not_render=!1);"use_ghost"in m.game||(m.game.use_ghost=!1);"use_sleep"in m.game||(m.game.use_sleep=!1);"velocity_min"in m.game||(m.game.velocity_min=0);"velocity_max"in m.game||(m.game.velocity_max=0);"collision_group"in m.game||(m.game.collision_group=1);"collision_mask"in m.game||(m.game.collision_mask=255);"b4w_vehicle_settings"in m?m.b4w_vehicle_settings&&("steering_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_ratio=
10),"steering_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_max=1),"inverse_control"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.inverse_control=!1),"force_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.force_max=1500),"brake_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.brake_max=100),"speed_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_speed_angle=Math.PI),
"delta_tach_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_rot_damp=.9)):(m.b4w_vehicle_settings=
null,b("object",m,"b4w_vehicle_settings"));"b4w_floating_settings"in m?m.b4w_floating_settings&&("floating_factor"in m.b4w_floating_settings||(m.b4w_floating_settings.floating_factor=3),"water_lin_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_rot_damp=.8)):(m.b4w_floating_settings=null,b("object",m,"b4w_floating_settings"));"b4w_character_settings"in m?m.b4w_character_settings&&("walk_speed"in
m.b4w_character_settings||(m.b4w_character_settings.walk_speed=4),"run_speed"in m.b4w_character_settings||(m.b4w_character_settings.run_speed=8),"step_height"in m.b4w_character_settings||(m.b4w_character_settings.step_height=.25),"jump_strength"in m.b4w_character_settings||(m.b4w_character_settings.jump_strength=5),"waterline"in m.b4w_character_settings||(m.b4w_character_settings.waterline=0)):(m.b4w_character_settings=null,b("object",m,"b4w_character_settings"));"b4w_selectable"in m||(m.b4w_selectable=
!1,b("object",m,"b4w_selectable"));"b4w_outlining"in m||(m.b4w_outlining=!1,b("object",m,"b4w_outlining"));"b4w_outline_on_select"in m||(m.b4w_outline_on_select=!1,b("object",m,"b4w_outline_on_select"));"b4w_billboard"in m||(m.b4w_billboard=!1,b("object",m,"b4w_billboard"));"b4w_billboard_geometry"in m||(m.b4w_billboard_geometry="SPHERICAL",b("object",m,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in m||(m.b4w_pres_glob_orientation=!1,b("object",m,"b4w_pres_glob_orientation"));"b4w_outline_settings"in
m||("b4w_glow_settings"in m?m.b4w_outline_settings=m.b4w_glow_settings:(m.b4w_outline_settings={},m.b4w_outline_settings.outline_duration=1,m.b4w_outline_settings.outline_period=1,m.b4w_outline_settings.outline_relapses=0),b("object",m,"b4w_outline_settings"));"b4w_lod_transition"in m||(m.b4w_lod_transition=.01,b("object",m,"b4w_lod_transition"));"lod_levels"in m||(m.lod_levels=[],b("object",m,"lod_levels"));"b4w_animation_mixing"in m||(m.b4w_animation_mixing=!1,b("object",m,"b4w_animation_mixing"));
break;case "EMPTY":"b4w_anchor"in m||(m.b4w_anchor=null,b("object",m,"b4w_anchor")),!m.b4w_anchor||"max_width"in m.b4w_anchor||(m.b4w_anchor.max_width=250)}"collision_margin"in m.game||(m.game.collision_margin=.04,b("object",m,"collision_margin"));"b4w_anim_behavior"in m||(m.b4w_anim_behavior=m.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",m,"b4w_anim_behavior"));if(!("rotation_quaternion"in m)){h=[0,0,0,1];g.euler_to_quat(m.rotation_euler,h);var f=h,l=h[0],q=h[1],u=h[2];f[0]=h[3];f[1]=l;
f[2]=q;f[3]=u;m.rotation_quaternion=h;b("object",m,"rotation_quaternion")}"webgl_do_not_batch"in m&&(m.b4w_do_not_batch=m.webgl_do_not_batch)&&k("object",m,"webgl_do_not_batch");"b4w_shadow_cast_only"in m||(m.b4w_shadow_cast_only=!1,b("object",m,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in m||(m.b4w_correct_bounding_offset="AUTO",b("object",m,"b4w_correct_bounding_offset"));f=m.particle_systems;for(h=0;h<f.length;h++)l=f[h],q=l.settings,"use_rotation_dupli"in q||(q.use_rotation_dupli=
!1,b("object",q,"use_rotation_dupli")),"use_whole_group"in q||(q.use_whole_group=!1,b("object",q,"use_whole_group")),l.transforms||(l.transforms=new Float32Array,b("particle_system",l,"transforms")),"b4w_billboard_align"in q||(q.b4w_billboard_align="VIEW",b("particle_settings",q,"b4w_billboard_align")),"b4w_dynamic_grass"in q||(q.b4w_dynamic_grass=!1,b("object",q,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in q||(q.b4w_dynamic_grass_scale_threshold=.01,b("object",q,"b4w_dynamic_grass_scale_threshold")),
"b4w_initial_rand_rotation"in q||(q.b4w_initial_rand_rotation=!1,b("particle_settings",q,"b4w_initial_rand_rotation")),"b4w_rotation_type"in q||(q.b4w_rotation_type="Z",b("particle_settings",q,"b4w_rotation_type")),"b4w_rand_rotation_strength"in q||(q.b4w_rand_rotation_strength=1,b("particle_settings",q,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in q||(q.b4w_hair_billboard=!1,b("particle_settings",q,"b4w_hair_billboard")),"b4w_hair_billboard_type"in q||(q.b4w_hair_billboard_type="BASIC",b("particle_settings",
q,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in q||(q.b4w_hair_billboard_jitter_amp=0,b("particle_settings",q,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in q||(q.b4w_hair_billboard_jitter_freq=0,b("particle_settings",q,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in q||(q.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",q,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in q||(q.b4w_wind_bend_inheritance="PARENT",b("particle_settings",
q,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in q||(q.b4w_shadow_inheritance="PARENT",b("particle_settings",q,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in q||(q.b4w_reflection_inheritance="PARENT",b("particle_settings",q,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in q||(q.b4w_vcol_from_name="",b("particle_settings",q,"b4w_vcol_from_name")),"b4w_vcol_to_name"in q||(q.b4w_vcol_to_name="",b("particle_settings",q,"b4w_vcol_to_name")),"b4w_coordinate_system"in q||(q.b4w_coordinate_system=
"LOCAL",b("particle_settings",q,"b4w_coordinate_system")),"b4w_allow_nla"in q||(q.b4w_allow_nla=!0,b("particle_settings",q,"b4w_allow_nla")),"b4w_enable_soft_particles"in q||(q.b4w_enable_soft_particles=!1,b("particle_settings",q,"b4w_enable_soft_particles")),"b4w_particles_softness"in q||(q.b4w_particles_softness=1,b("particle_settings",q,"b4w_particles_softness"));"constraints"in m||(m.constraints=[],b("object",m,"constraints"));f=m.modifiers;for(h=0;h<f.length;h++){a:{l=f[h];switch(l.type){case "ARRAY":if(!("fit_type"in
l)){e.error("WARNING Incomplete modifier "+String(l.type)+' for "'+m.name+'", reexport "'+a.b4w_filepath_blend+'" scene');l=!1;break a}}l=!0}l||(f.splice(h,1),h--)}"animation_data"in m||(m.animation_data={action:null,nla_tracks:[]},b("object",m,"animation_data"));m.animation_data&&("action"in m.animation_data||(m.animation_data.action=null,e.warn("no action in animation data "+m.name)),"nla_tracks"in m.animation_data||(m.animation_data.nla_tracks=[],e.warn("no NLA in animation data "+m.name)),c(m.animation_data));
"b4w_collision_id"in m||(m.b4w_collision_id="",b("material",m,"b4w_collision_id"));if(0>m.scale[0]||0>m.scale[1]||0>m.scale[2])e.warn("negative scale for object "+m.name+", using positive scale instead"),m.scale[0]=Math.abs(m.scale[0]),m.scale[1]=Math.abs(m.scale[1]),m.scale[2]=Math.abs(m.scale[2]);h=m.scale;0==h[0]&&0==h[1]&&0==h[2]?h=!0:(f=Math.abs((h[1]-h[2])/h[1]),h=.005>Math.abs((h[0]-h[1])/h[0])&&.005>f);h||e.warn("non-uniform scale for object "+m.name)}for(var C in D)n=D[C],h=C.match(/.*?(?=>>|$)/i)[0],
e.warn('Property "'+String(h)+'" is '+n.Ju+' for "'+n.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.Ny=function(a,b){"num_channels"in a||(a.num_channels=1,e.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.hy=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=f(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=
b,m=e,k=0,t=0,p=0,C=new Float32Array(16),e=[],I=1;I<m.count;I++){m.use_constant_offset&&(k+=m.constant_offset_displace[0],t+=m.constant_offset_displace[1],p+=m.constant_offset_displace[2]);if(m.use_relative_offset)var F=d.b4w_bounding_box,k=k+(F.max_x-F.min_x)*m.relative_offset_displace[0],t=t+(F.max_y-F.min_y)*m.relative_offset_displace[1],p=p+(F.max_z-F.min_z)*m.relative_offset_displace[2];g.RE(k,t,p,C);for(var N=F=f(d),w=C,K=0;K<N.submeshes.length;K++){var x=N.submeshes[K];g.Gf(x.position,w,x.position,
0);g.UF(x.normal,w,x.normal);g.ME(x.tangent,w,x.tangent)}e.push(F)}for(I=0;I<e.length;I++)for(m=d,k=e[I],t=0;t<m.submeshes.length;t++){p=m.submeshes[t];C=k.submeshes[t];F=p.base_length;N=p.indices.length;p.base_length+=C.base_length;for(var V in p)if("base_length"!=V)if("indices"==V)for(p[V]=g.VE(p[V],C[V]),w=N;w<p.indices.length;w++)p.indices[w]+=F;else"vertex_colors"!=V&&(p[V]=g.zA(p[V],C[V]))}break;case "CURVE":for(var d=b,I=l.Iz(e.object),m=new Float32Array(16),t=I.tf?4:3,k=new Float32Array(t),
t=new Float32Array(t),p=new Float32Array(3),C=new Float32Array(4),F=new Float32Array(4),N=new Float32Array(3),w=new Float32Array(3),K=new Float32Array(3),x=new Float32Array(4),U=new Float32Array(4),D=0;D<d.submeshes.length;D++){var G=d.submeshes[D],ea=G.position,R=G.normal,G=G.tangent,X;a:switch(X=e.deform_axis,X){case "POS_X":case "NEG_X":X=0;break a;case "POS_Y":case "NEG_Y":X=1;break a;case "POS_Z":case "NEG_Z":X=2;break a;default:throw"Wrong deform axis value "+X;}N[0]=0;N[1]=0;N[2]=0;N[X]=1;
for(var Q=l.yE(I),T=0;T<ea.length/3;T++){K[0]=ea[3*T];K[1]=ea[3*T+1];K[2]=ea[3*T+2];var ca=K[X],oa=l.xE(I,ca);l.zE(I,oa,k);p[0]=k[0];p[1]=k[1];p[2]=k[2];l.wE(I,oa,t);w[0]=t[0];w[1]=0;w[2]=t[2];q.normalize(w,w);h.rotationTo(N,w,C);0>ca?(k[0]=w[0],k[1]=w[1],k[2]=w[2],q.scale(k,ca,k),q.add(p,k,p)):ca>Q&&(k[0]=w[0],k[1]=w[1],k[2]=w[2],q.scale(k,ca-Q,k),q.add(p,k,p));u.fromRotationTranslation(C,p,m);I.tf&&(h.setAxisAngle(N,k[3],F),q.transformQuat(K,F,K));K[X]=0;q.transformMat4(K,m,K);ea[3*T]=K[0];ea[3*
T+1]=K[1];ea[3*T+2]=K[2];R.length&&(x[0]=R[3*T],x[1]=R[3*T+1],x[2]=R[3*T+2],x[3]=0,z.transformMat4(x,m,x),R[3*T]=x[0],R[3*T+1]=x[1],R[3*T+2]=x[2]);G.length&&(U[0]=G[3*T],U[1]=G[3*T+1],U[2]=G[3*T+2],U[3]=0,z.transformMat4(U,m,U),G[3*T]=U[0],G[3*T+1]=U[1],G[3*T+2]=U[2])}}}n.oD(b)}return b};a.gH=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,
fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,
b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.oy=function(a,b){for(var c=b.b4w_logic_nodes,d=0;d<c.length;d++)for(var f=c[d],h=0;h<
f.length;h++){var g=f[h],l={register1:"variable1",register2:"variable2",registerd:"variabled"},k;for(k in l)k in g&&(g[l[k]]=g[k]);switch(g.type){case "SELECT":for(l=0;l<a.length;l++){var n=a[l];n.name==g.object&&(n.b4w_selectable=!0)}g.bools||(g.bools={});g.bools.not_wait||(g.bools.not_wait=!1);break;case "SELECT_PLAY":e.warn('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport scene "'+b.name+'"');g.object.mute=!0;break;case "SHOW":case "HIDE":case "PLAY_ANIM":case "SET_SHADER_NODE_PARAM":for(l=
0;l<a.length;l++)n=a[l],n.name==g.object&&(n.b4w_do_not_batch=!0)}}}};b4w.module.__scenegraph=function(a,p){function d(a){a=qa.hf(a);a.Ce=null;a.sb=null;a.jd=null;return a}function c(a,c){var d=[];L.ie(a,function(b,c,e){-1<d.indexOf(e)?L.xD(a,b,c,e,k(e)):d.push(e)});L.V(a,function(b,e){for(var f=0;f<e.ta.length;f++){var h=e.ta[f];c||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&"MAIN_XRAY"!=e.type||(h.nh=!0);-1<d.indexOf(h)?e.ta[f]=k(h):d.push(h)}"ANTIALIASING"==e.type&&L.Te(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ta.length;c++){var d=
b.ta[c];d.ha=H.t;d.ga=H.t}});c||L.Te(a,b,function(a,b,c){"DEPTH"==c.from&&(c.nh=!0)})});L.V(a,function(c){var d={};b(a,c,d);for(var e in d){c=d[e];for(var f=c[0],h=0;h<c.length;h++)if(c[h].ha==H.t){f=c[h];break}for(var g=c[0],h=0;h<c.length;h++)if(c[h].ga==H.t){g=c[h];break}for(var m=c[0],h=0;h<c.length;h++)if(!c[h].nh){m=c[h];break}for(h=0;h<c.length;h++)c[h].ha=f.ha,c[h].ga=g.ga,c[h].nh=m.nh}})}function b(a,c,d){L.Te(a,c,function(c,e,f){f.eb&&f.from==f.to&&(d[f.from]=d[f.from]||[],-1==d[f.from].indexOf(f)&&
d[f.from].push(f),b(a,c,d))});L.Uf(a,c,function(a,b,c){c.eb&&(d[c.from]=d[c.from]||[],-1==d[c.from].indexOf(c)&&d[c.from].push(c))});c=L.Ta(a,c);if("MOTION_BLUR"==c.type)for(var e=0;e<c.ta.length;e++){var f=c.ta[e];d[f.from].push(f)}}function k(a){if(a.Ca)throw"Failed to clone slink with attached texture";return hb.sg(a)}function f(a){var b=L.vq(a),c=[];L.V(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var f=[];break;
default:f=c}for(var g=0;g<d.ta.length;g++){var m=d.ta[g],H=h(f,m,l(m));m.Ca=H;d.ge[g]=H}for(g=0;g<d.ge.length;g++)H=d.ge[g],e(f,H);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":f=[]}L.Uf(b,a,function(c,d,e){if(!e.Ca){if((c=u(b,a,e.from))&&e.eb&&!e.Ca){d=f;for(var g=c,m=0;m<d.length;m++){var H=d[m];H.sq===g&&H.pk++}}else c=h(f,e,l(e));e.Ca=c}});L.Te(b,a,function(a,b,c){e(f,c.Ca)});L.Uf(b,a,function(a,b,c){c.Ca&&"NONE"==c.to&&e(f,c.Ca)})})}
function n(a){q(a,function(b,c,d){b.Pi&&(ra(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ra(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.Pf*=ya.render_resolution_factor)})}function l(a){a=hb.sg(a);delete a.to;delete a.eb;delete a.Ca;return JSON.stringify(a)}function u(a,b,c){var d=null;L.Te(a,b,function(a,b,e){if(e.eb&&e.from==e.to&&e.from==c&&e.Ca)return d=e.Ca,!0});L.Uf(a,b,function(a,b,e){if(e.eb&&e.from==c&&e.Ca)return d=e.Ca,!0});return d}function e(a,b){for(var c=
0;c<a.length;c++){var d=a[c];d.sq===b&&d.pk&&d.pk--}}function h(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.pk){d=f;break}}if(d&&!ya.uC)return d.pk++,d.sq;b=g(b);a.push({id:c,pk:1,sq:b});return b}function g(a){var b=a.Pf*a.size;switch(a.from){case "COLOR":var c=H.wl("COLOR",H.wh);H.resize(c,b,b);H.wk(c,a.ha,a.ga);return c;case "DEPTH":return a.nh?(c=H.wl("DEPTH_RBUF",H.vh),H.resize(c,b,b)):(c=H.wl("DEPTH_TEX",H.bj),H.resize(c,b,b),H.wk(c,a.ha,a.ga)),c;case "CUBEMAP":return c=
H.qz(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.from;}}function q(a,b){var c=!1;L.ie(a,function(d,e,f){if(f&&(d=L.Ta(a,d),e=L.Ta(a,e),b(f,!1,d,e)))return c=!0});c||L.V(a,function(a,c){for(var d=0;d<c.ta.length;d++)if(b(c.ta[d],!0,c,null))return!0})}function z(a){L.V(a,function(b,c){if("SINK"!=c.type){var d=c.j;L.Uf(a,b,function(a,b,c){c.eb&&c.Ca&&(da.Am(d,c.from,c.Ca),c.from==c.to&&b.j&&da.Am(b.j,c.from,c.Ca))});for(var e=0;e<c.ta.length;e++){var f=c.ta[e];f.eb&&f.from==f.to&&
da.Am(d,f.from,c.ge[e])}!d.sb&&!d.jd||d.Ce||(d.Ce=la.wD(d.sb,d.jd))}})}function G(a){var b=null,c=0;L.V(a,function(a,d){if(d.type==ua.KE){if(c==ua.JE)return b=d,!0;c++}});return b}function D(a,b){var c=L.Vg(a,b),d=y("NONE"),e=L.u(a,d),f=L.it(a)[0];L.ie(a,function(b,c){c==f&&L.pD(a,b,f,b,e)});L.ie(a,function(e,f,h){if(e==c)return L.n(a,b,d,A(ua.lE,"u_color",h.size,h.Pf,h.Pi)),!0});L.Tb(a,e,f,A("SCREEN","NONE",.5,.5,!0))}function B(a,b){a.dk=b;a.bp=new Float32Array(3*b);a.bm=new Float32Array(3*b);a.ap=
new Float32Array(3*b);a.cp=new Float32Array(0==b%2?2*b:2*b+2)}function v(a,b,c){var d=E("SHADOW_CAST");d.Un=a;d.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Mg){case "SPOT":case "POINT":d.j=da.wb(da.Rb);da.Cm(d.j,180*b.Qe/Math.PI,.1,2*b.distance);break;default:d.j=da.wb(da.fg)}B(d,c);return d}function E(a){a={type:a,Ua:"",Ia:!1,nu:!1,mn:!1,gm:!1,wj:0,time:0,j:null,vj:null,Wn:[],p:[],ta:[],ge:[],Ue:new Float32Array(3),lw:new Float32Array(3),qc:new Float32Array(3),dc:new Float32Array(4),
Kl:new Float32Array(4),Ic:new Float32Array(16),ev:0,nf:0,dk:0,bp:null,bm:null,ap:null,cp:null,rf:new Float32Array(3),eg:new Float32Array(3),fv:new Float32Array(4),wv:new Float32Array([0,0,0]),mq:new Float32Array(3),xv:new Float32Array(4),dv:new Float32Array(3),gk:0,io:0,Xj:!1,Le:new Float32Array(3),ag:0,rb:null,Tm:!1,Mf:new Float32Array(2),Nf:new Float32Array(2),zi:0,fi:0,En:0,Ld:null,cg:0,uh:0,bg:0,se:!1,Or:0,Pr:new Float32Array(2),Nr:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,
rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Ai:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,Ei:0,Di:0,Ci:0,ov:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,ei:0,vm:0,Ii:0,Un:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Sv:null,Br:null,ah:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,
vn:0,oo:0,mb_decay_threshold:0,mb_factor:0,Wt:0,qm:"",UB:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,tq:new Float32Array(2),Va:new Float32Array(2),ob:!0,enqueue:!0,ma:!0,ua:!0,Mb:!0,wa:!0,Se:1};a.Va[0]=1;a.Va[1]=1;return a}function A(a,b,c,d,e){return{from:a,to:b,size:c,Pf:d,Pi:e,eb:!0,Ca:null,nh:!1,ha:H.Dc,ga:H.Dc}}function r(a,b){for(var c=0,d=ia(a,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=f.j,b.VC=f.hb/(f.hb-
f.ib),b.Sv=f.ya,b.Br=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.ah=b.ah||[],b.ah[c]=f.Ba,c++)}}function m(){var a=E("GRASS_MAP");a.j=da.wb(da.$e);return a}function y(a){var b=E("POSTPROCESSING");b.ma=!1;b.ua=!1;b.Mb=!1;b.j=da.wb(da.Db);b.qm=a;switch(a){case "NONE":b.Va[0]=1;b.Va[1]=1;break;case "GRAYSCALE":b.Va[0]=1;b.Va[1]=1;break;case "X_BLUR":b.Va[0]=1;b.Va[1]=0;break;case "Y_BLUR":b.Va[0]=0;b.Va[1]=1;break;case "X_GLOW_BLUR":b.Va[0]=1;b.Va[1]=0;break;case "Y_GLOW_BLUR":b.Va[0]=
0;b.Va[1]=1;break;case "X_EXTEND":b.Va[0]=1;b.Va[1]=0;break;case "Y_EXTEND":b.Va[0]=0;b.Va[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function t(a){var b=E("BLOOM_BLUR");b.ma=!1;b.ua=!1;b.Mb=!1;b.j=da.wb(da.Db);b.qm=a;switch(a){case "X_BLUR":b.Va[0]=1;b.Va[1]=0;break;case "Y_BLUR":b.Va[0]=0;b.Va[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}return b}function J(a,b){var c=E("GLOW_COMBINE");c.ma=!1;c.ua=!1;c.Mb=!1;c.small_glow_mask_coeff=b.qf.small_glow_mask_coeff;
c.large_glow_mask_coeff=b.qf.large_glow_mask_coeff;c.small_glow_mask_width=b.qf.small_glow_mask_width;c.large_glow_mask_width=b.qf.large_glow_mask_width;c.j=a;return c}function C(a,b,c,d,e,f,h,g,m){var l=E("MAIN_"+a);if("OPAQUE"===a)l.ma=!0,l.ua=c,l.Ia=!1;else if("BLEND"===a)l.ma=!1,l.ua=!1,l.Ia=!0;else if("XRAY"===a)l.ma=!1,l.ua=!0,l.Ia=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)l.ma=!0,l.ua=!0,l.Ia=!1;else if("GLOW"===a)l.ma=!0,l.ua=!1,l.Ia=!1;else throw"wrong main subscene type";l.Ia&&
g&&(l.self_shadow_normal_offset=g.self_shadow_normal_offset);l.j=b;if(a=h.bq)l.fv.set([a.wy,a.DB,a.gG,a.fG]),l.dv.set(a.color),l.ev=a.La;l.rf.set(h.rf);l.eg.set(h.eg);l.nf=h.nf;l.dc=f.dc;l.Kl=f.Kl;d&&(l.rb=d,d.dc&&(l.Ld=new Float32Array(d.dc)),l.cg=d.waves_height,l.uh=d.waves_length,l.bg=d.bg,d.se&&m&&(l.se=!0,l.Or=d.Ky,l.Pr.set(d.Ly),l.Nr=d.Jy),d.Em&&(l.Tm=!0,f=d.jE,l.Mf[0]=(f[0]+f[1])/2,l.Mf[1]=(f[2]+f[3])/2,l.Nf[0]=f[0]-f[1],l.Nf[1]=f[2]-f[3],l.zi=d.zi,l.fi=d.fi));B(l,e);return l}function I(a,
b,c){var d=E("COLOR_PICKING");b&&(d.type+="_XRAY",d.ma=!1,d.ua=!0);d.enqueue=!1;d.j=a;B(d,c);return d}function F(a){var b=E("WIREFRAME");b.ob=!1;b.ma=!1;b.ua=!1;b.j=a;return b}function N(a){var b=E("ANCHOR_VISIBILITY");b.ma=!0;b.ua=!1;b.j=a;return b}function w(a,b){var c=E("DEPTH");c.j=a;B(c,b);return c}function K(a,b,c){var d=E("SSAO");d.ma=!1;d.ua=!1;d.Mb=!1;d.j=a;d.dc=b.dc;d.Ld=new Float32Array(b.dc);d.Ei=c.radius_increase;d.ssao_hemisphere=c.CB;d.Di=c.influence;d.Ci=c.dist_factor;d.ov=c.GD;return d}
function x(a,b){var c=E("SSAO_BLUR");c.ma=!1;c.ua=!1;c.Mb=!1;c.j=a;c.ssao_blur_depth=b.zy;c.ssao_blur_discard_value=b.Gr;return c}function V(){var a=E("ANTIALIASING");a.ma=!1;a.ua=!1;a.Mb=!1;a.Se=1/ya.render_resolution_factor;a.j=da.wb(da.Db);return a}function U(a){var b=E(a);b.ma="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ua=!1;b.Mb=!1;b.Se=1/ya.render_resolution_factor;b.j=da.wb(da.Db);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.VB=new Float32Array(4));return b}function aa(a,
b,c,d){var e=E("COMPOSITING");e.ma=!1;e.ua=!1;e.Mb=!1;e.j=da.wb(da.Db);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function ba(a,b){var c=E("MOTION_BLUR");c.ma=!1;c.ua=!1;c.Mb=!1;c.j=da.wb(da.Db);c.mn=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function ea(a){var b=E("DOF");b.ma=!1;b.ua=!1;b.Mb=!1;b.j=a;b.Se=b.j.dof_power;return b}function R(a,b){var c=E("OUTLINE_MASK");c.Mb=!1;c.j=a;B(c,b);return c}function X(a){var b=E("OUTLINE");wa.outlining_overview_mode?b.Le.set(wa.Le):
b.Le.set(a.Le);b.gk=a.gk;b.oo=5;b.vn=3;b.Mb=!1;b.j=da.wb(da.Db);return b}function Q(){var a=E("REFRACT");a.ma=!1;a.ua=!1;a.Mb=!1;a.j=da.wb(da.Db);return a}function T(a,b,c,d,e,f,h){var g=E("GOD_RAYS");g.ma=!1;g.ua=!1;g.Mb=!1;g.rf=new Float32Array([1,1,1]);g.eg=new Float32Array([1,1,1]);g.nf=1;g.nu=d;g.ag=b;g.vm=e;g.ei=c;g.Ii=h;g.j=a;B(g,f);return g}function ca(a,b){var c=E("GOD_RAYS_COMBINE");c.ma=!1;c.ua=!1;c.Mb=!1;c.j=da.wb(da.Db);c.god_rays_intensity=a;B(c,b);return c}function oa(a,b){var c=E("SKY");
c.enqueue=!1;c.ma=!1;c.ua=!1;c.Mb=!1;var d=da.wb(da.Db);d.width=Sa.xl;d.height=Sa.xl;c.j=d;c.vj=hb.KA();B(c,a);c.rf=new Float32Array([1,1,1]);c.eg=new Float32Array([1,1,1]);c.nf=1;c.Ai.set(b.Ai);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=
b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ha(){var a=E("COPY");a.ma=!1;a.ua=!1;a.j=da.wb(da.Db);return a}function na(){var a=E("ANAGLYPH");a.ma=!1;a.ua=!1;a.j=da.wb(da.Db);return a}function ma(){var a=E("LUMINANCE");a.ma=!1;a.ua=!1;a.j=da.wb(da.Db);return a}function W(){var a=E("AVERAGE_LUMINANCE");a.ma=!1;a.ua=!1;a.j=da.wb(da.Db);return a}function M(a,b,c,d){var e=E("LUMINANCE_TRUNCED");
e.ma=!1;e.ua=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;B(e,c);return e}function O(a){var b=E("BLOOM");b.ma=!1;b.ua=!1;b.j=da.wb(da.Db);b.bloom_blur=a;return b}function S(){var a=E("SINK");a.enqueue=!1;return a}function ra(a,b,c){if(b.type===c)return!0;b=ga(a,b);for(var d=0;d<b.length;d++)if(ra(a,b[d],c))return!0;return!1}function P(a,b,c){if(b.type===c)return!0;b=ia(a,b);for(var d=0;d<b.length;d++)if(P(a,b[d],c))return!0;return!1}function ia(a,b){var c=L.Vg(a,b);if(c==L.Zq)throw"Subscene not in graph";
for(var d=[],e=L.Oo(a,c),f=0;f<e;f++){var h=L.Rj(a,c,f);h!=c&&d.push(L.Ta(a,h))}return d}function ga(a,b){var c=L.Vg(a,b);if(c==L.Zq)throw"Subscene not in graph";for(var d=[],e=L.Bf(a,c),f=0;f<e;f++){var h=L.pf(a,c,f);h!=c&&d.push(L.Ta(a,h))}return d}function fa(a){var b=[],c=[];q(a,function(a){a.Ca&&-1==b.indexOf(a.Ca)&&(b.push(a.Ca),c.push(a.Ca,b.length-1))});return c}function ka(a,b){var c;c=""+(a.from+"\\n");c+="NONE"!=a.to?a.to+"\\n":"";c+="(";if(a.Pi){var d=a.Pf;Math.round(d)!=d&&(d=d.toFixed(2));
d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.from){c+=" ";if(a.nh)c+="RR";else{var d=a.ha,e=a.ga,f="";d==H.t?f+="L":d==H.Dc&&(f+="N");e==H.t?f+="L":e==H.Dc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.Ca&&(c+=" "+b[d+1])}return c+")\\n"}var da=p("__camera"),Y=p("__config"),sa=p("__debug"),L=p("__graph"),qa=p("__obj_util"),la=p("__renderer"),H=p("__textures"),hb=p("__util"),ua=Y.bo,ya=Y.q,wa=Y.tb,Sa=Y.wi;a.Yy=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;
default:return!0}};a.UE=q;a.Cz=function(a,b,e){function h(c,e){var f=d(Ja[e]);b.S.push(f);f=C(c,f,!1,ga,la,Tb,dc,Ub,a.lh);k.push(f);L.u(g,f);L.n(g,l[e],f,u[e]);"XRAY"==c?f.ta.push(A("DEPTH","DEPTH",1,1,!0)):L.n(g,l[e],f,p[e]);Xa&&(L.n(g,Xa,f,lb),L.n(g,Xa,f,Lb));if(Vb){for(var m=0;m<ra.length;m++)L.n(g,ra[m],f,qa[m]);if(Xc.kc&&jb||fa||Ib){var m=Wb[e],n=d(m.j);b.S.push(n);var r=E("DEPTH_PACK");r.ma=!1;r.ua=!1;r.j=n;L.u(g,r);var n=A("DEPTH","u_depth",1,1,!0),q=A("COLOR","u_scene_depth",1,1,!0);q.ha=
H.Dc;q.ga=H.Dc;L.n(g,m,r,n);L.n(g,r,f,q)}}if(wa.length)for(r=wa.length/Ja.length,m=0;m<r;m++)n=r*e+m,L.n(g,wa[n],f,ka[n]);if(Y.length)for(m=0;m<Y.length;m++)L.n(g,Y[m],f,ia[m]);B.length&&L.n(g,B[e],f,P[e]);return f}var g=L.create(),l=[],k=[],q=[],u=[],p=[],wa=[],ka=[],B=[],P=[],ra=[],qa=[],Y=[],ia=[],la=a.YB,ga=a.rb,fa=a.shore_smoothing,Ib=a.mE,Ua=a.de,Zb=a.Th,Xc=a.BC,Jb=a.vi,Bc=a.yy,Oc=a.Ug,rc=a.Eh,Pc=a.antialiasing,dc=a.Sq,Tb=a.kw,Ub=a.bc,Cc=a.FC,kc=a.My,Dc=a.xB,ad=a.TC,ed=a.Ih,Vb=a.bA,jb=a.kc,
$a=Boolean(e.length),Ja=[];if(a.anaglyph_use&&!$a){var ec=b.S[0],ub=d(ec);da.Tt(ec,da.Eb);da.Tt(ub,da.Jb);Ja.push(ec,ub);b.S.push(ub)}else{var Aa=b.S[0];Ja.push(Aa)}if(Ub){da.Bq(Ja[0],Ub);for(var qb=Ub.csm_num,Z=0;Z<qb;Z++){var db=v(Z,Ub,la);L.u(g,db);ra.push(db);var Ca=Ub.csm_resolution,Aa=db.j;Aa.width=Ca;Aa.height=Ca;db.ma=!1;qa.push(A("DEPTH","u_shadow_map"+Z,Ca,1,!1));(sa.Sr()||ya.Is)&&db.ta.push(A("COLOR","COLOR",Ca,1,!1))}}if(Jb&&Jb.gu&&!$a)for(Z=0;Z<Jb.gu;Z++){Aa=da.wb(da.Rb);Aa.width=a.wg;
Aa.height=a.wg;da.Cm(Aa,90,.1,100);da.Kf(Aa,Aa.Fa);var va=C("CUBE_REFLECT",Aa,!1,ga,la,Tb,dc,null,a.lh);va.vj=hb.OA();for(var Fa=0;6>Fa;Fa++)va.Wn.push(da.tz());L.u(g,va);var Ga=A("CUBEMAP","u_cube_reflection",a.wg,1,!1);Ga.ha=H.t;Ga.ga=H.t;var fc=A("DEPTH","DEPTH",a.wg,1,!1);ia.push(Ga);va.ta.push(fc);Y.push(va);Jb.jf.push(va)}if(Jb&&0<Jb.Hu.length&&!$a)for(Z=0;Z<Ja.length;Z++)for(Fa=0;Fa<Jb.Hu.length;Fa++)Aa=d(Ja[Z]),Aa.ic=new Float32Array(4),b.S.push(Aa),va=C("PLANE_REFLECT",Aa,!1,ga,la,Tb,dc,
null,a.lh),L.u(g,va),Ga=A("COLOR","u_plane_reflection",1,a.mk,!0),Ga.ha=H.t,Ga.ga=H.t,fc=A("DEPTH","DEPTH",1,a.mk,!0),ka.push(Ga),va.ta.push(fc),wa.push(va),Jb.Ff.push(va);l=[];k=[];if(a.Fb){var Xa=m();L.u(g,Xa);Ca=Sa.Ol;Xa.j.width=Ca;Xa.j.height=Ca;var lb=A("DEPTH","u_grass_map_depth",Ca,1,!1);lb.ha=H.t;lb.ga=H.t;var Lb=A("COLOR","u_grass_map_color",Ca,1,!1);Lb.ha=H.t;Lb.ga=H.t}else Lb=lb=Xa=null;for(var Cb=[],sc=[],Wb=[],$b=[],Z=0;Z<Ja.length;Z++){var Aa=Ja[Z],ab={};p.push(A("DEPTH","DEPTH",1,1,
!0));if(Vb){var vb=d(Aa);b.S.push(vb);ab=w(vb,la);Wb.push(ab);L.u(g,ab);if(Ub){ab.self_shadow_normal_offset=Ub.self_shadow_normal_offset;for(Fa=0;Fa<ra.length;Fa++)db=ra[Fa],L.n(g,db,ab,qa[Fa]);var gc=A("COLOR","u_color",1,1,!0),Ec=A("DEPTH","u_depth",1,1,!0);if(Ua){var Mb=d(Aa);b.S.push(Mb);var rb=a.BE,sb=K(Mb,Tb,rb);L.u(g,sb);var Qa=A("COLOR","u_ssao_mask",1,1,!0);L.n(g,ab,sb,gc);L.n(g,ab,sb,Ec);var Va=d(Aa);b.S.push(Va);var Db=x(Va,rb);L.u(g,Db);var hc=A("COLOR","u_shadow_mask",1,1,!0);L.n(g,sb,
Db,Qa);L.n(g,ab,Db,Ec)}}else sa.Sr()&&ab.ta.push(A("COLOR","COLOR",1,1,!0));Xa&&(L.n(g,Xa,ab,lb),L.n(g,Xa,ab,Lb))}va=C("OPAQUE",Aa,!Vb,ga,la,Tb,dc,null,a.lh);L.u(g,va);k.push(va);sc.push(va);Vb&&(L.n(g,ab,va,p[Z]),Qa?L.n(g,Db,va,hc):Ub&&L.n(g,ab,va,A("COLOR","u_shadow_mask",1,1,!0)));var tc=A("COLOR","u_color",1,1,!0);u.push(A("COLOR","COLOR",1,1,!0));Xa&&(L.n(g,Xa,va,lb),L.n(g,Xa,va,Lb));if(wa.length)for(var eb=wa.length/Ja.length,Fa=0;Fa<eb;Fa++){var uc=eb*Z+Fa;L.n(g,wa[uc],va,ka[uc])}if(Y.length)for(Fa=
0;Fa<Y.length;Fa++)L.n(g,Y[Fa],va,ia[Fa])}l=k;k=[];if(!$a&&a.ez){Aa=d(l[0].j);b.S.push(Aa);var Nb=I(Aa,!1,la);L.u(g,Nb);if(a.We){Aa=d(l[0].j);b.S.push(Aa);var fb=I(Aa,!0,la);L.u(g,fb);L.n(g,Nb,fb,A("COLOR","COLOR",1,1,!0));L.n(g,Nb,fb,A("DEPTH","DEPTH",1,1,!0))}}else Nb=null;if(Xc.kc&&!$a)for(Z=0;Z<Ja.length;Z++){var Ma=Q();L.u(g,Ma);L.n(g,l[Z],Ma,tc);B.push(Ma);P.push(A("COLOR","u_refractmap",1,1,!0))}if(a.Eo){for(Z=0;Z<Ja.length;Z++)va=h("BLEND",Z),Cb.push(va);l=k;k=[]}if(a.Ee){for(Z=0;Z<Ja.length;Z++){var wb=
d(Ja[Z]);b.S.push(wb);var gb=C("GLOW",wb,!1,ga,la,Tb,dc);L.u(g,gb);L.n(g,sc[Z],gb,p[Z]);var Oa=y("X_GLOW_BLUR");Oa.Ua="GLOW_MASK_SMALL";Oa.Se=a.qf.small_glow_mask_width;var Ha=A("COLOR","u_color",1,1,!0);Ha.ha=H.t;Ha.ga=H.t;L.u(g,Oa);L.n(g,gb,Oa,Ha);var mb=y("Y_GLOW_BLUR");mb.Ua="GLOW_MASK_SMALL";mb.Se=a.qf.small_glow_mask_width;var za=A("COLOR","u_color",1,.5,!0);za.ha=H.t;za.ga=H.t;L.u(g,mb);L.n(g,Oa,mb,za);var nb=y("X_GLOW_BLUR");nb.Ua="GLOW_MASK_LARGE";nb.Se=a.qf.large_glow_mask_width;var ob=
A("COLOR","u_color",1,.5,!0);ob.ha=H.t;ob.ga=H.t;L.u(g,nb);L.n(g,mb,nb,ob);var xb=y("Y_GLOW_BLUR");xb.Ua="GLOW_MASK_LARGE";xb.Se=a.qf.large_glow_mask_width;var Na=A("COLOR","u_color",1,.25,!0);Na.ha=H.t;Na.ga=H.t;L.u(g,xb);L.n(g,nb,xb,Na);var Ob=d(Ja[Z]);b.S.push(Ob);var bb=J(Ob,a);L.u(g,bb);a.Eo?L.n(g,Cb[Z],bb,A("COLOR","u_src_color",1,1,!0)):L.n(g,sc[Z],bb,A("COLOR","u_src_color",1,1,!0));var lc=A("COLOR","u_glow_mask_small",1,.5,!0);lc.ha=H.t;lc.ga=H.t;L.n(g,mb,bb,lc);var Xb=A("COLOR","u_glow_mask_large",
1,.25,!0);Xb.ha=H.t;Xb.ga=H.t;L.n(g,xb,bb,Xb);q.push(bb)}l=q;k=[]}if(!a.Eo){for(Z=0;Z<Ja.length;Z++)va=h("BLEND",Z),Cb.push(va);l=k;k=[]}if(a.We){for(Z=0;Z<Ja.length;Z++){var Eb=h("XRAY",Z);$b.push(Eb)}l=k;k=[]}if(ya.wireframe_debug){for(Z=0;Z<Ja.length;Z++){Aa=d(Ja[Z]);b.S.push(Aa);var Fb=F(Aa);k.push(Fb);L.u(g,Fb);L.n(g,l[Z],Fb,u[Z]);L.n(g,l[Z],Fb,p[Z]);Xa&&(L.n(g,Xa,Fb,lb),L.n(g,Xa,Fb,Lb))}l=k;k=[]}if(!$a&&a.Lx){Aa=d(Ja[0]);b.S.push(Aa);var kb=N(Aa);L.u(g,kb);L.n(g,l[0],kb,p[0])}if(Zb&&Vb&&!$a){for(Z=
0;Z<Ja.length;Z++){var Kb=Dc.ei,ac=Dc.Ro,Za=Dc.Ii,Ea=l[Z],Pa=ga?1:0,mc=A("DEPTH","u_input",1,1,!0);mc.ha=H.t;mc.ga=H.t;var Gb=A("COLOR","u_input",1,.25,!0);Gb.ha=H.t;Gb.ga=H.t;var Pb=Kb/Za,yb=d(Ja[Z]);b.S.push(yb);var Ra=T(yb,Pa,Kb,!0,Pb,la,Za);L.u(g,Ra);L.n(g,Ea,Ra,mc);var Pb=Kb/Za*.5,ic=d(Ja[Z]);b.S.push(ic);var cb=T(ic,Pa,Kb,!1,Pb,la,Za);L.u(g,cb);L.n(g,Ra,cb,Gb);var Pb=Kb/Za*.25,zb=d(Ja[Z]);b.S.push(zb);var vc=T(zb,Pa,Kb,!1,Pb,la,Za);L.u(g,vc);L.n(g,cb,vc,Gb);var nc=ca(ac,la);k.push(nc);L.u(g,
nc);L.n(g,Ea,nc,A("COLOR","u_main",1,1,!0));L.n(g,vc,nc,A("COLOR","u_god_rays",1,1,!0))}l=k;k=[]}if(Bc&&!$a){for(Z=0;Z<Ja.length;Z++){var Ea=l[Z],bc=ma();L.u(g,bc);L.n(g,Ea,bc,A("COLOR","u_input",1,1,!0));var cc=W();L.u(g,cc);cc.j.width=ya.Dj?2:1;cc.j.height=ya.Dj?2:1;var jc=A("COLOR","u_input",1,.25,!0);jc.ha=H.t;jc.ga=H.t;var wc=A("COLOR","u_luminance",1,.25,!0);wc.ha=H.t;wc.ga=H.t;L.n(g,bc,cc,jc);var Hc=Bc.key,xc=Bc.hA,oc=d(Ja[Z]);b.S.push(oc);var Ab=M(Hc,xc,la,oc);L.u(g,Ab);L.n(g,Ea,Ab,A("COLOR",
"u_main",1,1,!0));L.n(g,bc,Ab,wc);L.n(g,cc,Ab,A("COLOR","u_average_lum",1,1,!1));var Ka=A("COLOR","u_color",1,.25,!0);Ka.ha=H.t;Ka.ga=H.t;Oa=t("X_BLUR");L.u(g,Oa);L.n(g,Ab,Oa,Ka);mb=t("Y_BLUR");L.u(g,mb);L.n(g,Oa,mb,Ka);var Wa=O(Bc.blur);L.u(g,Wa);var Qc=A("COLOR","u_bloom",1,.25,!0);Qc.ha=H.t;Qc.ga=H.t;L.n(g,mb,Wa,Qc);L.n(g,Ea,Wa,A("COLOR","u_main",1,1,!0));k.push(Wa)}l=k;k=[]}if(Oc&&!$a){for(Z=0;Z<l.length;Z++){var pc=l[Z],Yc=ba(Cc.mb_decay_threshold,Cc.mb_factor);k.push(Yc);L.u(g,Yc);L.n(g,pc,
Yc,A("COLOR","u_mb_tex_curr",1,1,!0));Yc.ta.push(A("COLOR","u_mb_tex_accum",1,1,!0))}l=k;k=[]}if(ed&&Vb&&!$a){for(Z=0;Z<l.length;Z++){var Ea=l[Z],Fc=d(Ja[Z]);b.S.push(Fc);Ka=A("COLOR","u_color",1,1,!0);Ka.ha=H.t;Ka.ga=H.t;var yc=y("X_BLUR");L.u(g,yc);L.n(g,Ea,yc,Ka);var Qb=y("Y_BLUR");L.u(g,Qb);L.n(g,yc,Qb,Ka);var ab=Cb[Z],zc=ea(Fc);Fc.dof_distance=b.dof_distance;Fc.ye=b.ye;Fc.dof_front=b.dof_front;Fc.dof_rear=b.dof_rear;Fc.dof_power=b.dof_power;Fc.dof_on=1;k.push(zc);L.u(g,zc);L.n(g,Ea,zc,A("COLOR",
"u_sharp",1,1,!0));L.n(g,Qb,zc,A("COLOR","u_blurred",1,1,!0));L.n(g,ab,zc,A("DEPTH","u_depth",1,1,!0))}l=k;k=[]}if(!$a&&a.outline){for(Z=0;Z<Ja.length;Z++){var Ea=l[Z],Rc=d(Ja[Z]);b.S.push(Rc);var Sc=R(Rc,la);L.u(g,Sc);var Rb=y("X_EXTEND"),fd=A("COLOR","u_color",1,1,!0),bd=A("COLOR","u_outline_mask",1,1,!0);Rb.Xj=!0;L.u(g,Rb);L.n(g,Sc,Rb,fd);var Ic=A("COLOR","u_color",1,.5,!0);Ic.ha=H.t;Ic.ga=H.t;var Tc=y("Y_EXTEND");Tc.Xj=!0;L.u(g,Tc);L.n(g,Rb,Tc,Ic);yc=y("X_BLUR");yc.Xj=!0;L.u(g,yc);L.n(g,Tc,yc,
Ic);var Uc=A("COLOR","u_color",1,.25,!0);Uc.ha=H.t;Uc.ga=H.t;var Jc=A("COLOR","u_outline_mask_blurred",1,.25,!0);Jc.ha=H.t;Jc.ga=H.t;Qb=y("Y_BLUR");Qb.Xj=!0;L.u(g,Qb);L.n(g,yc,Qb,Uc);var Ac=X(ad);L.u(g,Ac);L.n(g,Ea,Ac,A("COLOR","u_outline_src",1,1,!0));L.n(g,Sc,Ac,bd);L.n(g,Qb,Ac,Jc);k.push(Ac)}l=k;k=[]}if(rc&&!$a){for(Z=0;Z<l.length;Z++){var Ea=l[Z],Zc=aa(kc.brightness,kc.contrast,kc.exposure,kc.saturation);L.u(g,Zc);L.n(g,Ea,Zc,A("COLOR","u_color",1,1,!0));k.push(Zc)}l=k;k=[]}if(Pc){for(Z=0;Z<l.length;Z++)if(Ea=
l[Z],ya.smaa){var Kc=A("COLOR","u_color",1,1,!0);Kc.ha=H.t;Kc.ga=H.t;var $c=U("SMAA_EDGE_DETECTION");L.u(g,$c);L.n(g,Ea,$c,Kc);var Lc=U("SMAA_BLENDING_WEIGHT_CALCULATION");L.u(g,Lc);L.n(g,$c,Lc,Kc);var ld=A("COLOR","u_search_tex",1,1,!1),md=A("COLOR","u_area_tex",1,1,!1);ld.ha=H.t;ld.ga=H.t;md.ha=H.t;md.ga=H.t;Lc.ta.push(ld);Lc.ta.push(md);var gd=U("SMAA_NEIGHBORHOOD_BLENDING");L.u(g,gd);L.n(g,Ea,gd,Kc);var nd=A("COLOR","u_blend",1,1,!0);nd.ha=H.t;nd.ga=H.t;L.n(g,Lc,gd,nd);k.push(gd)}else{var hd=
V();L.u(g,hd);var jd=A("COLOR","u_color",1,1,!0);jd.ha=H.t;jd.ga=H.t;L.n(g,Ea,hd,jd);if(1<ya.render_resolution_factor){var od=y("NONE");L.u(g,od);L.n(g,hd,od,jd);k.push(od)}else k.push(hd)}l=k;k=[]}if(a.anaglyph_use&&!$a){var kd=na();L.u(g,kd);L.n(g,l[0],kd,A("COLOR","u_sampler_left",1,1,!0));L.n(g,l[1],kd,A("COLOR","u_sampler_right",1,1,!0));k.push(kd)}else k.push(l[0]);var ud=L.Vg(g,l[0]);if("MOTION_BLUR"==l[0].type)var pd=!0;else pd=!1,L.Te(g,ud,function(a,b,c){if(c.from==c.to)return pd=!0});if(pd){var Vc=
ha();L.u(g,Vc);L.n(g,l[0],Vc,A("COLOR","u_color",1,1,!0));l=k;k=[];k.push(Vc)}Nb&&(fb?k.push(fb):k.push(Nb));kb&&k.push(kb);if(!$a&&a.Gm.procedural_skydome){var qd=oa(la,a.Gm);L.u(g,qd);k.push(qd)}var Nc=S();L.u(g,Nc);for(Z=0;Z<k.length;Z++){var cd=k[Z];switch(cd.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":L.n(g,cd,Nc,A("COLOR","NONE",1,1,!0));L.n(g,cd,Nc,A("DEPTH","NONE",1,1,!0));break;case "SKY":L.n(g,cd,Nc,A("CUBEMAP","u_sky",Sa.xl,1,!1));break;case "ANCHOR_VISIBILITY":L.n(g,cd,Nc,A("COLOR",
"NONE",1,1,!0));break;default:if($a){var rd=e[0].k,dd=A("COLOR","OFFSCREEN",1,1,!0);dd.Ca=rd;L.n(g,k[Z],Nc,dd);for(Fa=1;Fa<e.length;Fa++){var sd=e[Fa].k,Vc=ha();L.u(g,Vc);L.n(g,k[Z],Vc,A("COLOR","u_color",1,1,!0));dd=A("COLOR","OFFSCREEN",1,sd.jh/rd.jh,!0);dd.Ca=sd;L.n(g,Vc,Nc,dd)}}else L.n(g,k[Z],Nc,A("SCREEN","NONE",1,1,!0))}}if(ua.enabled){var td=G(g);td&&D(g,td)}c(g,Vb);1<ya.render_resolution_factor&&n(g);f(g);z(g);if(Ub){for(Z=0;Z<Wb.length;Z++)r(g,Wb[Z]);for(Z=0;Z<Cb.length;Z++)r(g,Cb[Z]);for(Z=
0;Z<$b.length;Z++)r(g,$b[Z])}return g};a.ZH=E;a.Uc=function(a,b,c){var d=a.Se;a.tq[0]=b*a.Va[0]*d;a.tq[1]=c*a.Va[1]*d};a.ac=function(a,b){a.Se=b};a.wH=function(a){var b=null;L.V(a,function(a,c){return c.j&&null===c.j.Ce?(b=c,!0):!1});return b};a.Ra=function(a,b,c){a=ia(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.SH=ra;a.UH=P;a.kB=ia;a.KH=ga;a.Sa=function(a,b){var c=null;L.V(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Uz=function(a){var b="digraph scenegraph {\n",
b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=fa(a);L.V(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.qm.replace(/_/g," ")+")");if(d.j){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.j.sb&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.j.jd&&(f+="D"+c[g+1])}d.ta.length&&(f+="\\n-----\\n");for(g=0;g<d.ta.length;g++)f+=ka(d.ta[g],c);g="SINK"==d.type?"dotted":
d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});L.ie(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ka(e,c)+'" style="'+(e.eb?"solid":"dotted")+'"];\n'});return b+="}"};a.Dz=function(a){a=L.QE(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function d(){return{name:"",type:0,source:"",dq:"",width:0,height:0,On:1,Xk:!0,jh:1024,As:!1,re:null,cc:0,mb:null,$f:null,Ix:null,Zh:!1,Cc:-1,M:null,ji:0,Xd:0,I:0,Aa:0,Ph:0,$b:null,Wp:0,Vp:0,ih:-1,Xp:!1,zm:-1,Wm:!1,CF:!1,Qi:!1,Hq:!1}}function c(c,e,f,g){var h=c.type,l=new Uint8Array([204,204,204,255]),k=d();switch(h){case "DATA_TEX2D":case "IMAGE":var n=t.createTexture(),r=t.TEXTURE_2D;t.bindTexture(r,n);t.texImage2D(r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,l);c.image&&
"MOVIE"==c.image.source&&(k.Zh=!0,k.I=c.frame_start,k.Aa=c.frame_offset,k.Ph=c.frame_duration,k.CF=c.use_auto_refresh,k.Qi=c.use_cyclic,k.ji=c.movie_length,k.Hq=c.b4w_nla_video,0!=k.Aa&&B.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":n=t.createTexture();r=t.TEXTURE_2D;t.bindTexture(r,n);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(f=E.keysearch("name",c.b4w_source_id,
f)))k.jh=c.b4w_source_size,f.Md=f.Md||[],f.Md.push(c),t.texImage2D(r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,l);else return null;break;case "ENVIRONMENT_MAP":n=t.createTexture();r=t.TEXTURE_CUBE_MAP;t.bindTexture(r,n);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var q=0;6>q;q++)t.texImage2D(t["TEXTURE_CUBE_MAP_"+f[q]],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,l);break;case "BLEND":return null;default:return B.error('texture "'+c.name+'" has unsupported type "'+h+
'"'),null}"NONE"==h&&(!c.b4w_enable_canvas_mipmapping||"CANVAS"!=c.b4w_source_type)||"DATA_TEX2D"==h||"IMAGE"==h&&"MOVIE"==c.image.source?t.texParameteri(r,t.TEXTURE_MIN_FILTER,t.LINEAR):t.texParameteri(r,t.TEXTURE_MIN_FILTER,J[A.Jm]);t.texParameteri(r,t.TEXTURE_MAG_FILTER,t.LINEAR);l=r;f=c.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=e);"OFF"!==f&&A.Zk&&(e=D.WA())&&(f=parseFloat(f.split("x")[0]),t.texParameterf(l,e.TEXTURE_MAX_ANISOTROPY_EXT,f));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(t.texParameteri(r,
t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(r,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):(t.texParameteri(r,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(r,t.TEXTURE_WRAP_T,t.REPEAT));k.type=a.wh;k.width=1;k.height=1;k.mb=n;k.cc=r;"CANVAS"==c.b4w_source_type&&"NONE"==h?(h=c.b4w_source_id,n=c.b4w_source_size,k.As=c.b4w_enable_canvas_mipmapping,k.dq=h,k.source="CANVAS",r=document.createElement("canvas"),r.width=n,r.height=n,k.re=r.getContext("2d"),g in m||(m[g]={}),m[g][h]=k,b(k)):"SCENE"==c.b4w_source_type&&
"NONE"==h?(k.dq=c.b4w_source_id,k.source="SCENE"):(k.source=h,t.generateMipmap(r),t.bindTexture(r,null));k.name=c.name;return c.k=k}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.cc;t.bindTexture(b,a.mb);var c=n(a),d=l(a),e=a.re.canvas;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);t.texImage2D(b,0,c,c,d,e);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);a.As&&t.generateMipmap(b);t.bindTexture(b,null);a.width=e.width;a.height=e.height}function k(a){t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);
t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.LINEAR)}function f(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function n(b){switch(b.type){case a.wh:b=t.RGBA;break;case a.cn:b=t.RGB;break;case a.Tk:b=t.RGBA;break;case a.Uk:b=t.RGB;break;case a.bj:b=t.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function l(b){switch(b.type){case a.wh:b=
t.UNSIGNED_BYTE;break;case a.cn:b=t.UNSIGNED_BYTE;break;case a.Tk:b=t.FLOAT;break;case a.Uk:b=t.FLOAT;break;case a.bj:b=t.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function u(a,b){if(b in y&&a in y[b]){var c=y[b][a];c.M?c.M.play():c.$b&&(c.Xp=!0);return!0}return!1}function e(a,b){if(b in y&&a in y[b]){var c=y[b][a];c.M?c.M.pause():c.$b&&(c.Xp=!1);return!0}return!1}function h(a,b){if(b in y&&a in y[b]){var c=y[b][a];c.M?c.M.currentTime=c.Aa/c.Xd:c.$b&&(c.ih=q(c,c.Aa));return!0}return!1}
function g(a){return a.M?!a.M.paused:a.$b?a.Xp:!1}function q(a,b){return Math.round(b*a.Wp/a.ji)}var z=p("__config"),G=p("__dds"),D=p("__extensions"),B=p("__print"),v=p("__time"),E=p("__util"),A=z.q,r=z.A;a.Dc=0;a.t=0;a.Ex=0;a.Cx=0;a.Dx=0;a.Bx=0;a.wh=10;a.cn=20;a.Tk=30;a.Uk=40;a.bj=50;a.vh=60;var m={},y={},t=null,J;a.Jd=function(b){J=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.Dc=b.NEAREST;a.t=b.LINEAR;a.Ex=b.NEAREST_MIPMAP_NEAREST;a.Cx=b.LINEAR_MIPMAP_NEAREST;
a.Dx=b.NEAREST_MIPMAP_LINEAR;a.Bx=b.LINEAR_MIPMAP_LINEAR;t=b};a.$A=function(a,b){return b in m&&a in m[b]?m[b][a].re:null};a.jF=function(a,c){return c in m&&a in m[c]?(b(m[c][a]),!0):!1};a.wl=function(b,c){var e=d();e.name=b;e.type=c;e.source="NONE";if(c==a.vh)e.$f=t.createRenderbuffer();else{var f=t.TEXTURE_2D,g=t.createTexture();t.bindTexture(f,g);t.texParameteri(f,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(f,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(f,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);
t.texParameteri(f,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindTexture(f,null);e.cc=f;e.mb=g}return e};a.qz=function(b){var c=t.createTexture(),e=t.TEXTURE_CUBE_MAP;t.bindTexture(e,c);t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
g=0;6>g;g++)t.texImage2D(t[f[g]],0,t.RGBA,b,b,0,t.RGBA,t.UNSIGNED_BYTE,null);t.bindTexture(e,null);e=d();e.name="CUBEMAP";e.type=a.wh;e.source="NONE";e.width=3*b;e.height=2*b;e.On=1;e.mb=c;e.cc=t.TEXTURE_CUBE_MAP;return e};a.wk=function(b,c,d){if(b.type!=a.vh){var e=b.cc;t.bindTexture(e,b.mb);c&&t.texParameteri(e,t.TEXTURE_MIN_FILTER,c);d&&t.texParameteri(e,t.TEXTURE_MAG_FILTER,d);t.bindTexture(e,null)}};a.JH=function(b){if(b.type==a.vh)return{min:a.Dc,vC:a.Dc};var c=b.cc;t.bindTexture(c,b.mb);b=
t.getTexParameter(c,t.TEXTURE_MIN_FILTER);var d=t.getTexParameter(c,t.TEXTURE_MAG_FILTER);t.bindTexture(c,null);return{min:b,vC:d}};a.resize=function(b,c,d){c=Math.max(c,A.Dj?2:1);d=Math.max(d,A.Dj?2:1);if(b.width!=c||b.height!=d){if(b.type==a.vh)t.bindRenderbuffer(t.RENDERBUFFER,b.$f),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,c,d),t.bindRenderbuffer(t.RENDERBUFFER,null);else{var e=b.cc;t.bindTexture(e,b.mb);var f=n(b),g=l(b);t.texImage2D(e,0,f,c,d,0,f,g,null);t.bindTexture(e,null)}c>
A.Vb||d>A.Vb?B.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+A.Vb+"x"+A.Vb+"."):(b.width=c,b.height=d)}};a.Lz=c;a.Eq=function(a){var b=a.cc;t.bindTexture(b,a.mb);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);4!=a.M.length?t.texImage2D(b,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.M):t.texImage2D(b,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,a.M);t.bindTexture(b,null)};a.Nv=function(a){var b=a.cc;t.bindTexture(b,a.mb);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);t.texImage2D(b,0,t.RGBA,
t.RGBA,t.UNSIGNED_BYTE,a.$b[a.ih]);t.bindTexture(b,null)};a.Fk=function(a,b,c,d,e){var g=a.source,h=a.cc;t.bindTexture(h,a.mb);if(4==b.length){var l=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(l)t.texImage2D(h,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=G.jt(b);if(c.width>A.Vb||c.height>A.Vb){B.error('Texture "'+d+'" has unsupported size: '+c.width+"x"+c.height+". Max available: "+A.Vb+"x"+A.Vb+".");return}G.yF(t,D.gt(),b,!0);f(c.width,
c.height)&&(a.Ar||B.warn("using NPOT texture",d),k(h));a.width=c.width;a.height=c.height;a.On=G.bB(b)}else{t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>A.Vb||b.height>A.Vb){B.error('Texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+A.Vb+"x"+A.Vb+".");return}a.Zh?A.vk?b&&(e in y||(y[e]={}),y[e][a.name]=a,a.$b=b,a.Wp=b.length,a.Xd=a.Vp*a.ji/b.length,t.texImage2D(h,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.$b[0])):(b&&(e in y||(y[e]={}),y[e][a.name]=a),a.M=b,a.M.loop=a.Qi,
a.Xd=b.duration?a.ji/b.duration:v.Hb(),r.xs||(b.playbackRate=v.Hb()/a.Xd,r.Wr&&2<b.playbackRate&&(b.playbackRate=2)),t.texImage2D(h,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.M)):t.texImage2D(h,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,b);a.Zh?A.vk?(a.width=b[0].width,a.height=b[0].height):(a.width=b.videoWidth,a.height=b.videoHeight):(a.width=b.width,a.height=b.height);f(a.width,a.height)?(a.Ar||(a.Zh?B.warn("using NPOT video texture",d):B.warn("using NPOT texture",d)),k(h)):a.Zh||t.generateMipmap(h)}else if("ENVIRONMENT_MAP"==
g)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],l){for(l=0;6>l;l++)e=c[l],t.texImage2D(t["TEXTURE_CUBE_MAP_"+e[0]],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);g=b.width/3;if(g>A.di){B.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+3*A.di+"x"+2*A.di+". Reduced image size will be used.");var m=A.di/g*g}else m=g;for(l=
0;6>l;l++){e=c[l];var n=document.createElement("canvas");n.width=m;n.height=m;var q=n.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(q.translate(0,m),q.scale(1,-1)):(q.translate(m,0),q.scale(-1,1));q.drawImage(b,e[1]*g,e[2]*g,g,g,0,0,m,m);t.texImage2D(t["TEXTURE_CUBE_MAP_"+e[0]],0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}a.width=3*m;a.height=2*m;f(b.width/3,b.height/2)?(B.warn("using NPOT cube map texture",d),k(h)):t.generateMipmap(h)}else"DATA_TEX2D"==g&&(t.texImage2D(h,0,t.RGBA,b.width,b.height,
0,t.RGBA,t.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);t.bindTexture(h,null)};a.aA=function(a){t.deleteTexture(a)};a.Zj=function(a){return a&&a.name&&(a.mb||a.$f)?!0:!1};a.Dt=function(a){return a&&a.name&&a.$f?!0:!1};a.dI=function(b){return b.type==a.Tk||b.type==a.Uk?!0:!1};a.sB=function(b){var c=0;switch(b.type){case a.wh:case a.cn:c=4;break;case a.Tk:case a.Uk:c=16;break;case a.bj:c=3;break;case a.vh:c=2}return c};a.SA=function(a){var b=null,b={name:"special_ssao_texture",type:"DATA_TEX2D",
extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};c(b,null,a,0);b.image={filepath:null};return b};a.cleanup=function(){if(!A.vk)for(var a in y)for(var b in y[a])y[a][b].M.pause(),y[a][b].M.src="",y[a][b].M.load();m={};y={}};a.pause=function(){for(var a in y)for(var b in y[a]){var c=y[a][b];g(c)&&(e(b,a),c.Wm=!0)}};a.reset=function(){for(var a in y)for(var b in y[a])h(b,a),y[a][b].Wm=!1};a.play=function(a){for(var b in y)for(var c in y[b]){var d=y[b][c];if(!a||d.Wm)u(c,b),d.Wm=!1}};a.play_video=
u;a.pause_video=e;a.reset_video=h;a.Bm=function(a,b,c){c in y&&a in y[c]&&(a=y[c][a],a.M?a.M.currentTime=b/a.Xd:a.$b&&(a.ih=b))};a.bw=g;a.cw=function(a){return a.M||a.$b?a.M?2<=a.M.readyState:!0:0};a.VF=function(a){return a.M||a.$b?a.M?Math.round(a.M.currentTime*a.Xd):a.ih:0};a.XF=function(a){return a.M||a.$b?a.M?a.Aa:q(a,a.Aa):0};a.WF=function(a){if(!a.M&&!a.$b)return 0;var b=Math.min(a.Ph,a.ji-a.Aa);return a.M?a.Aa+b:q(a,a.Aa+b)};a.Ru=function(a,b){return Math.round(v.Hb()/a.Xd*a.Vp*b)};a.aw=function(a){return Math.min(a.Ph,
a.ji-a.Aa)};a.$v=q};b4w.module.__assets=function(a,p){function d(){return G.LB()?p(G.hc.kl).data:null}function c(){var a={Vk:null,Jx:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Vk=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=d();b&&a.Vk in b&&(a.status=200,b[a.Vk]&&(a.response=a.Jx(b[a.Vk])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,d=0;d<b.length;d++){var g=b[d];20===g.state&&c++;if(c>=m.DC)break;if(10===g.state)switch(g.state=20,c++,g.type){case a.AT_ARRAYBUFFER:k(g,"arraybuffer");break;case a.AT_JSON:k(g,"json");break;case a.AT_TEXT:k(g,"text");break;case a.AT_AUDIOBUFFER:f(g);break;case a.AT_IMAGE_ELEMENT:n(g);
break;case a.AT_AUDIO_ELEMENT:l(g);break;case a.Pk:u(g);break;case a.Ok:e(g);break;default:E.ba("Wrong asset type: "+g.type)}}}function k(a,b){var e=d(),f=e&&a.s in e?new c:new XMLHttpRequest;f.open("GET",a.s,!0);"text"==b?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==b?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=b;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var c=f.response;if(c){if("json"==b&&
"string"==typeof c)try{c=JSON.parse(c)}catch(d){B.error(d+" (parsing JSON "+a.s+")");a.vb(null,a.uri,a.type,a.s,a.Ab);return}a.vb(c,a.uri,a.type,a.s,a.Ab)}else B.error("empty responce when trying to get "+a.s),a.vb(null,a.uri,a.type,a.s,a.Ab)}else B.error(f.status+" when trying to get "+a.s),a.vb(null,a.uri,a.type,a.s,a.Ab);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.zu(b.loaded/b.total)},!1);f.send(null)}function f(a){var b=d(),e=b&&a.s in b?new c:new XMLHttpRequest;
e.open("GET",a.s,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?v.Xz(b,function(b){a.vb(b,a.uri,a.type,a.s,a.Ab);a.state=30},function(){a.vb(null,a.uri,a.type,a.s,a.Ab);B.error("failed to decode "+a.s);a.state=30}):(a.vb(null,a.uri,a.type,a.s,a.Ab),B.error("empty responce when trying to get "+a.s),a.state=30)}else a.vb(null,a.uri,a.type,a.s,a.Ab),B.error(e.status+" when trying to get "+a.s),a.state=
30};e.send(null)}function n(a){var b=document.createElement("img");r.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.vb(b,a.uri,a.type,a.s,a.Ab),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.vb(null,a.uri,a.type,a.s,a.Ab),B.error("could not load image: "+a.s),a.state=30)},!1);var c=d();if(c&&a.s in c)if(c[a.s]){var e=g(a.s);b.src="data:"+e+";base64,"+c[a.s]}else D.To()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=
new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s}function l(a){var b=document.createElement("audio");if(r.allow_cors||r.es)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.vb(b,a.uri,a.type,a.s,a.Ab),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.vb(null,a.uri,a.type,a.s,a.Ab),B.error("could not load sound: "+a.s),a.state=30)},!1);var c=d();if(c&&a.s in c)if(c[a.s]){var e=q(a.s);b.src="data:"+e+";base64,"+c[a.s];40!=a.state&&(a.vb(b,
a.uri,a.type,a.s,a.Ab),a.state=30)}else D.To()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s,r.uf&&b.load();r.np&&(b.autoplay=!0,b.pause());setTimeout(function(){b.oE=1},5E3)}function u(a){function b(){40!=a.state&&(a.vb(null,a.uri,a.type,a.s),B.error("could not load video: "+a.s,a.Ab),a.state=30)}var c=document.createElement("video");c.muted=!0;if(r.allow_cors||r.uf)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",
function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.vb(c,a.uri,a.type,a.s,a.Ab),a.state=30)},!1);c.addEventListener("error",b,!1);var e=d();if(e&&a.s in e)if(e[a.s]){var f=z(a.s);c.src="data:"+f+";base64,"+e[a.s];40!=a.state&&c.addEventListener("loadeddata",function(){a.vb(c,a.uri,a.type,a.s,a.Ab);a.state=30},!1)}else D.To()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),c.dispatchEvent(e);else c.src=a.s,r.uf&&c.load();r.np&&(c.autoplay=
!0,c.pause());setTimeout(function(){c.oE=1},1E4)}function e(a){function b(c){a.vb(c,a.uri,a.type,a.s,a.Ab)}var e=d(),f=e&&a.s in e?new c:new XMLHttpRequest;f.open("GET",a.s,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var c=f.response;c?h(c,b):(a.vb(null,a.uri,a.type,a.s,a.Ab),B.error("empty responce when trying to get "+a.s))}else a.vb(null,a.uri,a.type,a.s,a.Ab),B.error(f.status+" when trying to get "+a.s);a.state=
30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.zu(b.loaded/b.total)},!1);f.send(null)}function h(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],Fr:[],Xd:c[4]},g=20,h=0;h<e;h++){var l=c[g/4],m=new Blob([d.subarray(g+4,g+4+l)],{type:"image/jpg"}),k=document.createElement("img");k.src=window.URL.createObjectURL(m);f.images.push(k);f.Fr.push(m);g+=l+8-l%4}k.onload=function(){for(var a=0;a<f.images.length;a++)window.URL.revokeObjectURL(f.images[a].src);delete f.Fr;
b(f)}}function g(a){var b="image";switch(E.Bo(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function q(a){var b="audio";switch(E.Bo(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function z(a){var b="video";switch(E.Bo(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var G=p("__config"),D=p("__compat"),
B=p("__print"),v=p("__sfx"),E=p("__util"),A=p("__version"),r=G.q,m=G.Od;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Pk=70;a.Ok=80;var y=[],t=0,J={};a.yk=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.NH=function(a){if(J[a])return J[a];var b=m.Fp?a+A.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=
c.responseText;if(b.length)return J[a]=b;E.ba("Error XHR: responce is empty, GET "+a)}else E.ba("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<y.length;a++)y[a].state=40;y=[];t=0;J={}};a.enqueue=function(a,c,e,f){for(var g=0;g<a.length;g++){var h=a[g],h={uri:h[0],type:h[1],s:h[2],Ab:h[3],state:10,vb:c||function(){},ou:e||function(){},zu:f||function(){},pu:t};if(m.Fp){var l=d();l&&h.s in l||(h.s+=A.timestamp())}y.push(h)}b(y);t++};a.update=function(){b(y);for(var a=y,c=0,d=
!0,e=0;e<a.length;e++){var f=a[e];f.pu===a[c].pu?30!==f.state&&(d=!1):(d&&(a[e-1].ou(),d=e-c,a.splice(c,d),e-=d),c=e,d=30===a[e].state?!0:!1);e===a.length-1&&d&&(a[e].ou(),a.splice(c))}}};b4w.module.__loader=function(a,p){function d(b,d,e,f){var h=v,l=G.create(),k;for(k in d){var n=c(d[k]);(f&&n.Za||!b&&n.qb)&&g(n);G.u(l,n)}for(k in d)for(n=d[k],n.name=k,b=0;b<n.D.length;b++)G.n(l,d[n.D[b]],n,null);d=c({name:"out",Oa:a.pw,fb:function(a,b,c,d,e){0===b.id&&(h.iq=!0);z(b)||(b.status=2);b.Rt(b.id,!0);e(b,c);D.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},$a:5});var q=[];if(e)for(e=G.it(l),b=0;b<e.length;b++)q.push(G.Ta(l,e[b]));else G.V(l,function(a,b){b.Xa||q.push(b)});G.u(l,
d);for(b=0;b<q.length;b++)d.D.push(q[b].name),G.n(l,q[b],d,null);return l}function c(a){a.Xa=a.Xa||!1;a.Oa||0===a.Oa||(a.Oa=a.cd);a.D=a.D||[];a.Wj=a.Wj||!1;a.$p=a.$p||!1;a.$a=a.$a||0;a.Za=a.Za||!1;a.qb=a.qb||!1;a.status=0;a.mI=0;a.ep=0;a.rg=a.rg||null;return a}function b(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];G.Ta(a.ee,f).Wj&&(G.Uf(a.ee,f,function(d){var e=!0;G.Te(a.ee,d,function(a,b){if(!b.Wj)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function k(a){function c(b,d){var e=G.Ta(a.ee,b),f=G.Ta(a.ee,d),g=f.Oa-e.Oa;0==g&&(g=e.Xa-f.Xa);return g}var d=[],e=a.Re,f=!1;do{var g=b(a,e);d.push.apply(d,e);0<g.length&&(f=!0);e=g}while(0<g.length);f&&d.sort(c);a.Re=d;return a.Re.length}function f(a,b,c){if(b.$p)return b.Wj=!0,l(a,b),!1;if(!b.fb&&!b.ff&&!b.kj)return l(a,b),!1;if(0==b.status&&(b.status++,b.fb))return b.fb(c,a,b,b.rg,l,u),!0;if(1==b.status){if(b.ff)return b.ff(c,a,b,b.rg,l,u),!0;b.status++}return 2==
b.status&&(b.status++,b.kj)?(b.kj(c,a,b,b.rg,l,u),!0):!1}function n(a){if(0==a.Hm)return 100;var b=0;G.V(a.ee,function(c,d){a.do_not_load_resources&&d.Za||(b+=d.ep*d.$a)});return B.trunc(100*b/a.Hm)}function l(a,b){b.Wj=!0;b.status=3;e(a,b,1)}function u(a,b,c){1>c?e(a,b,c):b.status++}function e(a,b,c){var d=v;if(b.fb||b.ff||b.kj)if(b.ep=c,b=n(a),a.ps!=b||1==c)a.hq(b,performance.now()-a.Dv),a.ps=b,d.hp=!0}function h(a,b){var c=null;G.V(a.ee,function(a,d){if(d.name==b)return c=d,1});return c}function g(a){a.$p=
!0;a.ep=1}function q(a){a.hq=null;a.Nn=null;a.ee=null;a.Re=null}function z(a){return a&&(3==a.status||4==a.status)}var G=p("__graph"),D=p("__print"),B=p("__util");a.cd=0;a.le=1;a.pw=2;var v=null;a.ht=function(){return v};a.Ez=function(){var a={he:[],Zn:0,Wk:0,iq:!1,hp:!1};return v=a};a.Mz=function(a,b,c,e,f,g,h,l){var k=v,n={id:k.he.length,status:0,s:b,Dr:"",Rt:c||function(){},Qt:l||!1,OI:g,Dv:0,ps:0,Hm:0,Np:!1,hq:e||function(){},Nn:f||function(){},ee:null,Re:null,Lo:!1,Jo:!1,Po:!1};a=d(0===n.id,
a,g,h);n.ee=a;b=[];c=G.pB(a);for(e=0;e<c.length;e++)b.push(c[e]);n.Re=b;G.V(a,function(a,b){!(b.fb||b.ff||b.kj)||n.do_not_load_resources&&b.Za||(n.Hm+=b.$a)});k.he.push(n);k.Wk++;return n.id};a.tF=function(b){var c=v;if(c&&0!=v.Wk)if(c.hp)c.hp=!1;else{var d=performance.now();do{var e=c.he[c.Zn],g=b[e.id];if(!z(e))if(0==e.status&&(e.status=1,e.Dv=performance.now(),e.hq(0,0)),k(e)){var h=e,l=h.Re.length;do{var n=G.Ta(h.ee,h.Re[0]),u=f(h,n,g);n.Oa==a.le&&(h.Np=!0);n=h.Re.shift();h.Re.push(n);l--}while(!u&&
0!=l)}else h=c,l=e,l.Nn(g,l),l.status=3,h.Wk--,q(l);c.iq&&(c.Zn=(c.Zn+1)%c.he.length);if(e.Np){e.Np=!1;break}}while(16>performance.now()-d)}};a.jr=function(a){var b=v;a.Nn(null,a);a.status=3;b.Wk--;q(a);a.status=4;0===a.id&&(b.iq=!0);a.Rt(a.id,!1)};a.GI=u;a.aq=function(a,b){var c=h(a,b);null!==c&&g(c)};a.PE=z;a.is_primary_loaded=function(a){var b=v;if(!b)return!1;a|=0;return b.he[a]&&(3==b.he[a].status||2==b.he[a].status)};a.cleanup=function(){v=null}};b4w.module.__logic_nodes=function(a,p){function d(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];for(var f=0;f<c.Qu;f++)if(u.get_sensor_value(a,b,f)&&f==c.Pu){if(e.li&&e.mi==c.NE)c.state=-1;else if(!d.Tf.un||c.wd.no_wait)c.state=1;return}c.state=0}}function c(a,b,c){switch(b.state){case 1:n.error("Unknown node type: "+a.type);break;case 2:c.Ka=a.jb}}function b(a){return k.Cd(k.Ze,a.gA,0)}var k=p("__objects"),f=p("__scenes"),n=p("__print"),l=p("__nla");p("__config");var u=p("__controls"),e=p("__util"),
h=p("__animation"),g=p("__assets"),q=p("__batch"),z=p("__geometry"),G=p("__time"),D=[],B={ENTRYPOINT:function(a,b,c){switch(b.state){case 2:c.Ka=a.jb}},HIDE:function(a,c,d){switch(c.state){case 1:a.obj=b(a);break;case 2:f.hide_object(a.obj),d.Ka=a.jb}},SHOW:function(a,c,d){switch(c.state){case 1:a.obj=b(a);break;case 2:f.show_object(a.obj),d.Ka=a.jb}},PAGEPARAM:function(a,b,c){switch(b.state){case 2:a:{b=location.href.toString();if(-1!=b.indexOf("?")){b=b.split("?")[1].split("&");for(var d=0;d<b.length;d++){var e=
b[d].split("=");if(1<e.length&&e[0]==a.UC){b=Number(e[1]);break a}}}b=0}c.Pb[a.Ui]=b;c.Ka=a.jb}},SELECT:function(a,c,e){switch(c.state){case 1:e=c.Qg[e.OE];var f=b(a),g=k.oB(),h=g.indexOf(f);if(-1==h)n.error("logic script error: non-selectable object:",a.dupli_name_list[a.dupli_name_list.length-1]);else{a.state=-1;a.Qu=g.length;a.Pu=h;for(var h=[],l=0;l<g.length;l++)h.push(u.create_selection_sensor(g[l],!0));u.create_sensor_manifold(f,"LOGIC_NODES_SELECT_"+a.label,u.CT_SHOT,h,u.Yz,d(),[a,c,e])}break;
case 2:if(-1<a.state){e.Ka=a.state?a.hv:a.jb;a.state=-1;break}a.wd.not_wait&&(e.Ka=a.jb)}},PLAY:function(a,b,c,d,e,f){switch(b.state){case 1:b.Yt=!1;break;case 2:if(b.li&&!a.Tj){if(b.Xn==b.mi)break;b.li=!1;for(e=0;e<b.Qg.length;e++){var g=b.Qg[e];g==b.mi&&(g.Tf.Ka=g.J[g.Tf.Ka].jb)}e=b.mi.J;for(g=0;g<e.length;g++)e[g].Tj=!1}d=l.Ey(b.xa.X,d,!1,f);a.Tj?d>=a.Z&&(a.Tj=!1,b.li=!1,b.mi=null,c.Ka=a.jb):(l.Su(b.xa,l.at(b.xa)+(a.I-d)),a.Tj=!0,b.mi=b.Xn,b.li=!0)}},REDIRECT:function(a,b){switch(b.state){case 2:window.location.href=
a.url,b.state=3}},MATH:function(a,b,c){switch(b.state){case 2:b=-1==a.Um?a.up:c.Pb[a.Um];var d=-1==a.Vm?a.fu:c.Pb[a.Vm];switch(a.SC){case "ADD":c.Pb[a.Ui]=b+d;break;case "MUL":c.Pb[a.Ui]=b*d;break;case "SUB":c.Pb[a.Ui]=b-d;break;case "DIV":0==d&&e.ba("Division by zero in Logic script"),c.Pb[a.Ui]=b/d}c.Ka=a.jb}},CONDJUMP:function(a,b,c){switch(b.state){case 2:b=-1==a.Um?a.up:c.Pb[a.Um];var d=-1==a.Vm?a.fu:c.Pb[a.Vm],e=!1;switch(a.hz){case "EQUAL":b==d&&(e=!0);break;case "NOTEQUAL":b!=d&&(e=!0);break;
case "LESS":b<d&&(e=!0);break;case "GREATER":b>d&&(e=!0);break;case "LEQUAL":b<=d&&(e=!0);break;case "GEQUAL":b>=d&&(e=!0)}c.Ka=e?a.hv:a.jb}},REGSTORE:function(a,b,c){switch(b.state){case 2:c.Pb[a.Ui]=a.up,c.Ka=a.jb}},PLAY_ANIM:function(a,c,d){var e=h.SLOT_ALL;""==!a.ud&&(e=h.SLOT_0);switch(c.state){case 1:a.obj=b(a);break;case 2:switch(h.is_play(a.obj,e)||0!=a.state||(a.state=1),a.state){case -1:""==a.ud?h.apply_def(a.obj):h.apply(a.obj,a.ud,e);a.wd.not_wait||(d.un=!0);h.set_behavior(a.obj,h.AB_FINISH_STOP,
e);h.set_first_frame(a.obj,e);h.play(a.obj,null,e);a.state=0;break;case 0:a.wd.not_wait&&(d.Ka=a.jb,a.state=-1);break;case 1:a.wd.not_wait||(d.un=!1);d.Ka=a.jb;a.state=-1;break;default:a.state=-1}}},SELECT_PLAY:function(a,b,c){switch(b.state){case 2:c.Ka=a.jb}},SEND_REQ:function(a,b,c){function d(a,b,c,e,f){for(var g in a)for(var h in f[0].qu)g==f[0].qu[h]&&(f[1][g]=a[g]);f[0].state=1}switch(b.state){case 2:switch(a.state){case -1:a.state=0;g.enqueue([[a.url,g.AT_JSON,a.url,[a,c.Pb]]],d,null,null);
break;case 1:a.state=-1,c.Ka=a.jb}}},INHERIT_MAT:function(a,b,c){switch(b.state){case 1:for(b=0;2>b;b++)a.Wb["id"+b]=k.Cd(k.Ze,a.ek["id"+b],0);break;case 2:q.inherit_material(a.Wb.id0,a.ip.id0,a.Wb.id1,a.ip.id1),c.Ka=a.jb}},SET_SHADER_NODE_PARAM:function(a,b,c){switch(b.state){case 1:a.ek.id0&&(a.Wb.id0=k.Cd(k.Ze,a.ek.id0,0),a.tp.id0.unshift(a.ip.id0));break;case 2:"ShaderNodeRGB"==a.Yu&&k.set_nodemat_rgb(a.Wb.id0,a.tp.id0,a.wd.id0?c.Pb[a.Vi.id0]:a.Eg.id0,a.wd.id1?c.Pb[a.Vi.id1]:a.Eg.id1,a.wd.id2?
c.Pb[a.Vi.id2]:a.Eg.id2),"ShaderNodeValue"==a.Yu&&k.set_nodemat_value(a.Wb.id0,a.tp.id0,a.wd.id0?c.Pb[a.Vi.id0]:a.Eg.id0),c.Ka=a.jb}},DELAY:function(a,b,c,d,e){switch(b.state){case 2:-1==a.state?(a.state=0,a.Lm=0):0==a.state&&(a.Lm+=e,a.Eg.dl<a.Lm&&(a.state=-1,c.Ka=a.jb))}},APPLY_SHAPE_KEY:function(a,b,c){switch(b.state){case 1:b=a.Wb.id0=k.Cd(k.Ze,a.ek.id0,0);c=a.Mn.sk;z.check_shape_keys(b)?z.Ko(b,c)||(n.error("Wrong key name:",c),a.mute=!0):(n.error("No shape keys in object:",b.name),a.mute=!0);
break;case 2:z.rr(a.Wb.id0,a.Mn.sk,a.wd.skv?c.Pb[a.Vi.skv]:a.Eg.skv),c.Ka=a.jb}},OUTLINE:function(a,b,c){switch(b.state){case 1:b=a.Wb.id0=k.Cd(k.Ze,a.ek.id0,0);b&&b.f&&b.f.tb||(n.error("Can't evaluate 'Outline' logic node: wrong object"),a.mute=!0);break;case 2:b=a.Wb.id0;switch(a.Mn.outline_operation){case "PLAY":var d=b.f.pi;k.apply_outline_anim(b,d.qi,d.ri,d.si);break;case "STOP":k.clear_outline_anim(b);break;case "INTENSITY":b.f.Cf=a.wd["in"]?c.Pb[a.Vi["in"]]:a.Eg["in"]}c.Ka=a.jb}}};a.FB=function(a,
b){var d={oc:b,ID:a.name,state:0,li:!1,Yt:!0,mi:null,xa:a,Xn:null,Qg:[]};a.HG=d;var e=a.b4w_logic_nodes,f=d.Qg;d.state=1;for(var g=0;g<e.length;g++){var h={J:[],Tf:{xa:a,Ka:0,un:!1,OE:g,Pb:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};f.push(h);for(var l=f[f.length-1],k=e[g],n=0;n<k.length;n++){var q=k[n],q={type:q.type,label:q.label,jb:q.slot_idx_order,hv:q.slot_idx_jump,I:q.frame_range[0],Z:q.frame_range[1],Tj:!1,state:-1,Qu:-1,Pu:-1,hz:q.condition,Um:q.variable1,Vm:q.variable2,up:q.number1,fu:q.number2,
Ui:q.variabled,url:q.url,UC:q.param_name,SC:q.operation,mute:q.mute,gA:q.object,obj:null,Wb:{},ud:q.anim_name,qu:q.parse_resp_list,ek:q.objects_paths,tp:q.nodes_paths,Eg:q.floats,wd:q.bools,Vi:q.variables,ip:q.materials_names,Yu:q.shader_nd_type,Mn:q.common_usage_names,NE:l,yu:B[q.type]?B[q.type]:c,sm:!1,Lm:0};l.J.push(q)}for(k=0;k<l.J.length;k++)q=l.J[k],q.yu(q,d,h.Tf,0,0)}d.state=2;D.push(d)};a.update=function(a,b){var c=l.rB();if(!(0>=c))for(var d=0;d<D.length;d++){for(var e=d,f=a,g=b,h=c,k=D[e],
n=0;n<D[e].Qg.length;n++){k.Xn=D[e].Qg[n];var q=D[e].Qg[n],u=k,w=f,p=g,x=h,z=q.J;if(z.length){for(var B=0;B<z.length;B++)z[B].sm=!1;for(B=0;B<z.length;B++){if(0<=q.Tf.Ka)var aa=z[q.Tf.Ka];else break;if(aa.sm)break;if(aa.mute)if("ENTRYPOINT"==aa.type)break;else q.Tf.Ka=aa.jb,aa.sm=!0;else aa.yu(aa,u,q.Tf,w,p,x),aa.sm=!0}}}k.li||k.Yt||l.Su(k.xa,l.at(k.xa)-G.Hb()*g)}};a.cleanup=function(){D=[]}};b4w.module.__nla=function(a,p){function d(a,b,c){for(var d=0;d<a.length;d++){var e=a[d],f=c+" ["+e.I+":"+e.Z+"]",g=Math.max(b.I,e.I);e.hg+=g-e.I;e.I=g;e.Z=Math.min(b.Z+1,e.Z);e.I>e.Z?(B.warn("NLA: out of scene range: "+f),a.splice(d,1),d--):e.ud||"CLIP"!=e.type||(B.warn('NLA: no action in strip for object "'+c+'".'),a.splice(d,1),d--)}}function c(a,b){for(var c=0;c<a.length;c++){for(var d=a[c],e=b.I,f=b.Z+1,g=0;g<a.length;g++){var h=a[g];d.Sb==h.Sb&&(h.Z<=d.I&&(e=d.I),h.I>=d.Z&&(f=Math.min(f,h.I)))}d.Ds=
e;d.Cs=f}}function b(){return{type:"CLIP",I:0,Z:0,Me:!1,paused:!1,ud:"",fj:"",Sb:0,hg:0,dj:0,Ds:0,Cs:0,Qv:!1,scale:1,repeat:1}}function k(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;if(c)for(var d=0;d<c.length;d++)b.push(c[d])}c=a.nodes;for(d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&k(e,b)}}function f(a,b){var c=Math.round(a)-b.I;b.Qi&&(c%=b.Ph,0>c&&(c+=b.Ph));return b.Aa+c}function n(a,b,c,d){b=(b-d)*r.Hb()+a.Aa;b>a.I&&(b-=a.I,a.cyclic&&c&&(b%=a.Z-a.I+
1),b+=a.I);return b}function l(a,b){a=m.clamp(a,b.I,b.Z);var c=a-b.I,d=(b.Z-b.I)/b.repeat,c=c/d&&0==c%d?b.dj:b.hg+c%d/b.scale;b.Qv&&(c=b.dj-c+b.hg);return c}function u(a,c){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],l=b();l.type=h.type;l.I=h.frame_start;l.Z=h.frame_end;l.Sb=c;l.hg=h.action_frame_start;l.dj=h.action_frame_end;l.Qv=h.use_reverse;l.scale=h.scale;l.repeat=h.repeat;h.action&&(l.ud=h.action.name,l.fj=h.action.uuid);d.push(l)}}return d}
function e(a){return"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function h(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c=c.use_nodes&&d)a:{if(d.animation_data&&(c=d.animation_data.nla_tracks)&&c.length){c=!0;break a}d=d.nodes;for(c=0;c<d.length;c++);c=!1}if(c)return!0}return!1}function g(a){return a.b4w_use_nla||a.b4w_use_logic_editor}function q(a,b){var c=v.get_active();
c.X&&(c.X.Aa-=n(c.X,b,!0,t)-a,c.X.Ij=!0)}var z=p("__animation");p("__camera");p("__controls");p("__config");p("__lights");p("__loader");var G=p("__objects"),D=p("__obj_util"),B=p("__print"),v=p("__scenes"),E=p("__sfx"),A=p("__textures"),r=p("__time"),m=p("__util"),y=[],t=-1;a.mh=function(a,c){var d;d=null;for(var f=c.W.length-1;0<=f;f--){var h=c.W[f];if(g(h.xa)&&(d=h,h.xa.ir))break}if(d){d.iu=!0;var l=0;if((f=a.animation_data)&&f.nla_tracks.length){var n=f.nla_tracks;if(D.is_armature(c)||D.is_camera(c)||
D.is_mesh(c)||D.is_empty(c)||D.is_lamp(c)||D.is_speaker(c))n=u(n,l),n.length&&(c.qd=c.qd.concat(n),l++)}e(a)&&(n=a.data.animation_data.nla_tracks,n=u(n,l),n.length&&(c.qd=c.qd.concat(n),l++));if(D.is_mesh(c))for(h=a.data.materials,f=0;f<h.length;f++){var q=h[f];if(q.use_nodes&&q.node_tree&&(n=[],k(q.node_tree,n),n=u(n,l),n.length)){for(var q=l,r=n,t=z.Ts(),p=[],v=0,y=0;y<r.length;y++){var A=r[y];""!=A.fj?A=m.keysearch("uuid",A.fj,t):(A=A.ud,A=m.keysearch("name",A,t)||m.keysearch("name",A+"_B4W_BAKED",
t));if(A){var A=A.fcurves,B=[],G;for(G in A)B.push(G);p.push(B)}}for(y=0;y<p.length;y++){t=!1;for(A=0;A<y;A++)if(m.ly(p[y],p[A])){r[y].Sb=r[A].Sb;t=!0;break}t||(r[y].Sb=l+v++)}l=q+v;c.qd=c.qd.concat(n)}}for(f=0;f<a.particle_systems.length;f++)h=a.particle_systems[f],G=h.settings,"EMITTER"==G.type&&G.b4w_allow_nla&&(G=b(),G.type="CLIP",G.I=d.xa.frame_start,G.Z=d.xa.frame_end+1,G.ud=h.name,G.Sb=l,G.hg=G.I,G.dj=G.Z,c.qd.push(G),l++);h=l+1;for(f=0;f<c.Qb.length;f++)n=c.Qb[f],n.Kx&&(l=h,G=b(),G.type="CLIP",
G.I=d.xa.frame_start,G.Z=d.xa.frame_end+1,G.ud=n.name,G.Sb=l,G.hg=G.I,G.dj=G.Z,c.qd.push(G))}};a.sF=function(a,e,f){a.X||(a.X={I:a.frame_start,Z:a.frame_end,Aa:0,$j:-1,wm:a.frame_end,Jp:a.frame_start,Ti:null,cyclic:e,Wb:[],U:[],ID:a.name,vf:!1,Ij:!1,Op:!0});e=a.X;for(var g=G.nB(a,f),h=0;h<g.length;h++){var l=g[h];if(l.qd.length){for(var k=0;k<l.W.length;k++){var n=l.W[k];n.xa==a&&n.iu&&e.Wb.push(l)}d(l.qd,e,l.name);c(l.qd,e)}}a=a.k.Xi;for(h=0;h<a.length;h++){var q=a[h].k;q.Hq&&(q.M||q.$b)&&q.Cc==
f&&(g=b(),g.type="VIDEO",q.Qi?(g.I=0,g.Z=e.Z):(g.I=m.clamp(q.I,0,e.Z),g.Z=m.clamp(q.I+q.Ph,0,e.Z)),g.ud=a[h].name,q.Ix=g,e.U.push(q),q.M&&(q.M.sI=function(){A.Eq(q)}))}y.push(e)};a.start=function(){t=0};a.rB=function(){return t};a.at=function(a){return a.X?a.X.Aa:null};a.Su=function(a,b){a.X&&(a.X.Aa=b)};a.update=function(a,b){if(!(0>t)){0==t&&(t=a);for(var c=0;c<y.length;c++){var d=y[c];d.vf&&(d.Aa-=r.Hb()*b);var e=n(d,a,!0,t);if((!d.vf||d.Ij)&&e>=d.wm)if(d.cyclic){var e=d,g=a;e.Ti&&e.Ti();q(e.Jp,
g);e.Op=!0;e=n(e,g,!0,t)}else{var g=d,h=e;g.vf=!0;g.Aa-=h-g.wm;g.Ti&&g.Ti()}if(!d.vf||d.Ij){for(var g=d,h=e,k=0;k<g.Wb.length;k++){for(var u=g.Wb[k],p=u.qd,v=0;v<p.length;v++){var B=p[v];"SOUND"==B.type&&h<g.$j-1E-6&&(B.Me=!1)}for(v=0;v<p.length;v++)switch(B=p[v],B.type){case "CLIP":if(B.Ds<=h&&h<B.Cs&&!B.Me){var D=u,G=B;""!=G.fj?z.fy(D,G.fj,G.Sb):z.apply(D,G.ud,G.Sb);z.set_behavior(D,z.AB_FINISH_STOP,G.Sb);var X=l(G.I,G);z.set_frame(D,X,G.Sb);for(D=0;D<p.length;D++)p[D]!=B&&p[D].Sb==B.Sb&&(p[D].Me=
!1);B.Me=!0}B.Me&&(D=u,G=l(h,B),X=z.get_current_frame_float(D,B.Sb),1E-6<Math.abs(G-X)&&z.set_frame(D,G,B.Sb));break;case "SOUND":(h<g.$j-1E-6||g.$j<B.I)&&B.I<=h&&h<B.Z&&!B.Me&&(E.play(u,(B.I-h)/r.Hb(),(B.Z-B.I)/r.Hb()),B.Me=!0),g.$j<B.Z&&B.Z<=h&&B.Me&&(B.Me=!1)}}g=a;h=d;k=e;for(u=0;u<h.U.length;u++)if(p=h.U[u],p.M||p.$b){B=!1;D=m.clamp(f(k,p),p.Aa,p.Aa+A.aw(p)-1);v=A.$v(p,D);v==p.Wp&&v--;if(h.Ij||h.Op)p.M?A.Bm(p.name,D,p.Cc):A.Bm(p.name,v,p.Cc),B=!0;h.vf||(p.Qi&&(p.M?D==p.Aa&&(A.Bm(p.name,p.Aa,p.Cc),
B=!0):(G=A.$v(p,p.Aa),v==G&&(A.Bm(p.name,v,p.Cc),B=!0))),G=f(k,p),G=p.Aa<=G&&G<=p.Aa+A.aw(p),X=A.bw(p),G&&!X?(A.play_video(p.name,p.Cc),p.$b&&(B=!0)):X&&!G?p.M?Math.round(p.M.currentTime*p.Xd)<D?B=!0:A.pause_video(p.name,p.Cc):A.pause_video(p.name,p.Cc):X&&G&&(B=!0));A.cw(p)&&B&&(p.M?A.Eq(p):(B=A.Ru(p,g),B!=p.zm&&(p.ih=v,A.Nv(p)),p.zm=B))}d.$j=e}d.Ij=!1;d.Op=!1}}};a.Ey=n;a.cleanup=function(){y.length=0;t=-1};a.Hr=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||e(a)||h(a)?!0:!1};
a.Ou=g;a.set_frame=q;a.get_frame=function(a){var b=v.get_active();return b.X?n(b.X,a,!0,t):-1};a.DE=function(){var a=v.get_active();a.X&&(a.X.vf=!0);for(var a=a.X.U,b=0;b<a.length;b++){var c=a[b];A.pause_video(c.name,c.Cc)}};a.eD=function(a){var b=v.get_active();b.X&&(b.X.vf=!1,b.X.Ti=a?a:null)};a.get_frame_start=function(){var a=v.get_active();return a.X?a.X.I:-1};a.get_frame_end=function(){var a=v.get_active();return a.X?a.X.Z:-1};a.is_play=function(){var a=v.get_active();return a.X?!a.X.vf:!1};
a.check_nla=function(){var a=v.get_active();return a.X?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=v.get_active();return a.X?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=v.get_active();if(c.X)c.X.Jp=a,c.X.wm=b;else return!1};a.reset_range=function(){var a=v.get_active();if(a.X)a=a.X,a.Jp=a.I,a.wm=a.Z;else return!1};a.set_cyclic=function(a){var b=v.get_active();if(b.X)b.X.cyclic=a;else return!1};a.clear_callback=function(){var a=v.get_active();a.X&&(a.X.Ti=null)}};b4w.module.__camera=function(a,p){function d(b){b=b.f;switch(b.Da){case a.MS_TARGET_CONTROLS:b.Xh=T.dist(b.i,b.Xb);b.Yh=b.S[0].top;break;case a.MS_HOVER_CONTROLS:b.lb&&(b.Xh=T.dist(b.i,b.gc),b.Yh=b.S[0].top)}}function c(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),ib:new Float32Array([0,0,0,0]),hb:new Float32Array([0,0,0,0])}}function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function k(b){var d={type:b,name:"",Pf:1,width:0,height:0,Ce:null,sb:null,jd:null,Fa:0,Nc:0,ib:0,hb:0,left:0,right:0,top:0,bottom:0,of:new Float32Array(3),Gs:new Float32Array(3),quat:new Float32Array(4),ya:new Float32Array(16),WG:new Float32Array(16),Ba:new Float32Array(16),Yi:new Float32Array(16),lD:new Float32Array(16),be:new Float32Array(16),Zu:new Float32Array(16),Kd:new Float32Array(16),
dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ye:null,dof_on:0,Lj:c(),Bk:0,fe:0,ic:null,uj:null,Vn:null,ms:new Float32Array(4),om:new Float32Array(4)};if(b==a.Db)return d;switch(b){case a.Rb:u(d,40,.1,1E3);break;case a.dd:u(d,2.5,.1,1E3);break;case a.me:break;case a.$e:break;case a.fg:break;case a.Eb:case a.Jb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return d}function f(b,c,d){if(b.type!=a.Eb&&b.type!=a.Jb)throw"set_stereo_params(): wrong camera type";
b.Bk=c;b.fe=d;m(b,b.Fa);if(R.ja()&&(c=R.get_active(),b=c.k.bc))for(c=R.Pj(c).f.S,d=0;d<c.length;d++)I(c[d],b)}function n(a,b){return l(a.f.quat,b)}function l(a,b){var c=Q.quat_to_dir(a,Q.AXIS_Y,ma),d=Q.quat_to_dir(a,Q.AXIS_Z,W),e=-Math.asin(c[1]/T.length(c)),c=Math.abs(e)>Math.PI/4?T.scale(d,-Q.sign(e),M):T.scale(c,-Q.sign(d[1]),M),f=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=Q.sign(e)*Math.PI-e);d=f;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function u(b,c,d,e,f){switch(b.type){case a.Rb:case a.Eb:case a.Jb:b.Nc=
c;b.Fa=1;break;case a.dd:b.top=c;b.Fa=1;break;case a.me:delete b.Nc;b.Nc=c;b.Fa=f/c;break;case a.$e:b.top=c;b.Fa=f/c;break;default:ba.error("set_frustum(): Unsupported camera type: "+b.type)}b.ib=d;b.hb=e}function e(b,c){var d=c.f.i,e=c.f.quat,f=ga;U.rotateX(c.f.aa,-Math.PI/2,f);U.invert(f,b.ya);if(b.ic){var f=b.ic[0],g=b.ic[1],h=b.ic[2],l=b.ic[3],k=ga;k[0]=1-2*f*f;k[1]=-2*f*g;k[2]=-2*f*h;k[3]=0;k[4]=-2*f*g;k[5]=1-2*g*g;k[6]=-2*g*h;k[7]=0;k[8]=-2*f*h;k[9]=-2*g*h;k[10]=1-2*h*h;k[11]=0;k[12]=-2*f*l;
k[13]=-2*g*l;k[14]=-2*h*l;k[15]=1;U.multiply(b.ya,k,b.ya);m(b,b.Fa,!0);f=ra;g=ga;U.invert(b.ya,g);U.transpose(g,g);ca.transformMat4(b.ic,g,f);g=P;g[0]=(Q.sign(f[0])+b.Ba[8])/b.Ba[0];g[1]=(Q.sign(f[1])+b.Ba[9])/b.Ba[5];g[2]=-1;g[3]=(1+b.Ba[10])/b.Ba[14];ca.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.Ba[2]=f[0];b.Ba[6]=f[1];b.Ba[10]=f[2]+1;b.Ba[14]=f[3]}b.type==a.Eb?b.ya[12]+=b.fe/2:b.type==a.Jb&&(b.ya[12]-=b.fe/2);U.multiply(b.Ba,b.ya,b.Kd);t(b);y(b);T.copy(b.of,b.Gs);T.copy(d,b.of);ea.copy(e,
b.quat)}function h(b,c,d,e){U.lookAt(c,d,e,b.ya);b.type==a.Eb?b.ya[12]+=b.fe/2:b.type==a.Jb&&(b.ya[12]-=b.fe/2);U.multiply(b.Ba,b.ya,b.Kd);t(b);y(b);T.copy(c,b.of)}function g(a){var b=a.f.S;if(!b)throw"Wrong object";for(var c=a.f,d=0;d<b.length;d++){var f=b[d];e(f,a);Q.Hl(f.Kd,f.Lj);if(f.ye)if(f.dof_on){var g=c.i,h=X.get_translation(f.ye,ma),g=T.dist(g,h);f.dof_distance=g}else f.dof_distance=0}}function q(b){b=b.f;if(b.Da==a.MS_TARGET_CONTROLS){var c=Q.quat_to_dir(b.quat,Q.AXIS_Z,ma);b.rq=0<c[1]}}
function z(b,c){var d=b.f,e=d.fc;!e||d.Da!=a.MS_EYE_CONTROLS&&d.Da!=a.MS_TARGET_CONTROLS||(c&&(d=n(b,ha),e.left+=d[0],e.right+=d[0]),e.left=Q.angle_wrap_0_2pi(e.left),e.right=Q.angle_wrap_0_2pi(e.right))}function G(b,c){var d=b.f,e=d.mc;!e||d.Da!=a.MS_EYE_CONTROLS&&d.Da!=a.MS_TARGET_CONTROLS||(c&&(d=n(b,ha),e.kb+=d[1],e.Ya+=d[1]),e.kb=Q.angle_wrap_periodic(e.kb,-Math.PI,Math.PI),e.Ya=Q.angle_wrap_periodic(e.Ya,-Math.PI,Math.PI))}function D(b){var c=b.f;if(aa.is_camera(b)){var d=c.S;if(d[0].type===
a.dd){if(c.Da===a.MS_TARGET_CONTROLS)var e=T.dist(c.i,c.Xb),c=e/c.Xh*c.Yh;else c.lb&&c.Da===a.MS_HOVER_CONTROLS?(e=T.distance(c.i,c.gc),c=e/c.Xh*c.Yh):c=d[0].top;for(e=0;e<d.length;e++){var f=d[e];f.top=c;m(f,f.Fa)}g(b)}}}function B(a,b,c,d,e){var f=a.f,g=b,h=c;if(d||e)a=n(a,na),d&&(g=b-a[0]),e&&(h=c-a[1]);if(g||h)b=ea.identity(O),g&&(g=ea.setAxisAngle(Q.AXIS_Y,g,S),ea.multiply(b,g,b)),h&&(g=Q.quat_to_dir(f.quat,Q.AXIS_X,ma),h=ea.setAxisAngle(g,h,S),ea.normalize(h,h),ea.multiply(b,h,b)),ea.multiply(b,
f.quat,f.quat)}function v(a,b,c,d,e){var f=a.f,g=b,h=c;if(d||e){var l=n(a,na);d&&(g=b-l[0]);e&&(h=c-l[1])}A(a,a.f.Xb,g,h);a=n(a,na);a=Q.angle_wrap_periodic(a[1],-Math.PI,Math.PI);f.rq=Math.abs(a)>Math.PI/2}function E(a,b,c,d,e){var f=a.f,g=b,h=c;if(d||e){var l=n(a,na);d&&(g=b-l[0]);e&&(h=c-l[1])}f.jo||(g=0);A(a,f.gc,g,h);h&&r(a)}function A(a,b,c,d){var e=a.f;if(c||d){var f=ea.identity(O);c&&(c=ea.setAxisAngle(Q.AXIS_Y,c,S),ea.multiply(f,c,f));a=C(a);d&&(!a||a&&e.lb)&&(a=Q.quat_to_dir(e.quat,Q.AXIS_X,
ma),d=ea.setAxisAngle(a,d,S),ea.normalize(d,d),ea.multiply(f,d,f));Q.CD(e.i,b,f,e.i);ea.multiply(f,e.quat,e.quat)}}function r(a){var b=a.f;if(b.lb){var c=n(a,ha)[1];a=a.f;a.Ib.Ya-a.Ib.kb?(c=(a.Ib.Ya-c)/(a.Ib.Ya-a.Ib.kb),c=Math.max(c,0)):c=0;c=c*(a.zg-a.xe)+a.xe;a=Q.quat_to_dir(b.quat,Q.AXIS_MY,ma);T.normalize(a,a);T.scale(a,c,a);T.subtract(b.gc,a,b.i)}}function m(b,c,d){switch(b.type){case a.Rb:if(!c)throw"No aspect ratio";b.Fa=c;case a.me:U.perspective(Q.um(b.Nc),b.Fa,b.ib,b.hb,b.Ba);break;case a.dd:if(!c)throw"No aspect ratio";
b.Fa=c;case a.$e:c=b.top*b.Fa;U.ortho(-c,c,-b.top,b.top,b.ib,b.hb,b.Ba);break;case a.fg:U.ortho(b.left,b.right,b.bottom,b.top,b.ib,b.hb,b.Ba);break;case a.Eb:case a.Jb:if(!c)throw"No aspect ratio";b.Fa=c;var e=Math.tan(b.Nc*Math.PI/360);c=b.ib*e;var f=b.Fa*b.Bk*e;b.type==a.Eb?(e=f-b.fe/2,f+=b.fe/2):(e=f+b.fe/2,f-=b.fe/2);e=-(b.ib/b.Bk*e);f*=b.ib/b.Bk;U.frustum(e,f,-c,c,b.ib,b.hb,b.Ba);b.left=e;b.right=f;break;case a.Db:return;default:throw"Wrong camera type: "+b.type;}d||(U.multiply(b.Ba,b.ya,b.Kd),
t(b),y(b))}function y(a){U.copy(a.ya,a.be);a.be[12]=0;a.be[13]=0;a.be[14]=0;a.be[15]=1;U.multiply(a.Ba,a.be,a.be);U.invert(a.be,a.be)}function t(a){U.copy(a.ya,a.Yi);U.multiply(a.Ba,a.Yi,a.Yi);U.invert(a.Yi,a.Yi)}function J(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.ib);d||(d=b.hb);var g,h,l,k,n,m,q,r;switch(b.type){case a.Db:throw"Extraction from NONE camera is not possible";case a.Rb:case a.me:g=c*Math.tan(b.Nc*Math.PI/360);k=-g;h=g*b.Fa;l=-h;n=d/c*g;r=-n;m=n*b.Fa;q=-m;break;case a.dd:case a.$e:l=
b.top*b.Fa;g=n=b.top;h=m=l;k=r=-b.top;l=q=-l;break;case a.fg:g=n=b.top;h=m=b.right;k=r=b.bottom;l=q=b.left;break;case a.Eb:case a.Jb:n=c/b.ib;g=c*Math.tan(b.Nc*Math.PI/360);k=-g;h=b.right*n;l=b.left*n;q=d/c;n=g*q;r=-n;m=h*q;q*=l;break;default:throw"Wrong camera type: "+b.type;}e[0]=l;e[1]=k;e[2]=-c;e[3]=h;e[4]=k;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=l;e[10]=g;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=n;e[17]=-d;e[18]=m;e[19]=n;e[20]=-d;e[21]=m;e[22]=r;e[23]=-d;f&&(c=ga,U.invert(b.ya,c),Q.Gf(e,
c,e,0));return e}function C(b){return aa.is_camera(b)&&b.f&&b.f.Da==a.MS_HOVER_CONTROLS?!0:!1}function I(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.uj){var d=b.csm_num;a.uj=Array(d);for(var e=0;e<d;e++)a.uj[e]=new Float32Array(3);a.Vn=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.ib:F(b,a,d-1),f=F(b,a,d),e=J(a,e,f,fa),e=w.iB(e);a.uj[d].set(e.G);a.Vn[d]=e.Pa;a.ms[d]=T.length(e.G);a.om[d]=N(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.om[0]=b.first_cascade_blur_radius}function F(a,
b,c){var d=a.csm_num,e=Q.clamp(a.csm_first_cascade_border,b.ib,b.hb);a=Q.clamp(a.csm_last_cascade_border,b.ib,b.hb);return Q.clamp(N(e,a,d,c),b.ib,b.hb)}function N(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var w=p("__boundings");p("__config");var K=p("__constraints"),x=p("__container"),V=p("__mat3"),U=p("__mat4"),aa=p("__obj_util"),ba=p("__print"),ea=p("__quat"),R=p("__scenes"),X=p("__transform"),Q=p("__util"),T=p("__vec3"),ca=p("__vec4");
a.Db=10;a.Rb=20;a.dd=30;a.me=40;a.$e=50;a.fg=60;a.Eb=70;a.Jb=80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var oa=Math.PI/180/2,ha=new Float32Array(2),na=new Float32Array(2),ma=new Float32Array(3),W=new Float32Array(3),M=new Float32Array(3),O=new Float32Array(4),S=new Float32Array(4),ra=new Float32Array(4),P=new Float32Array(4),ia=new Float32Array(16),ga=new Float32Array(16),fa=new Float32Array(24);a.Iy=function(c,e){var f=e.f,g=c.data;switch(g.type){case "PERSP":var h=
k(a.Rb);if(g.angle_y)var l=g.angle_y/Math.PI*180;u(h,l,g.clip_start,g.clip_end);break;case "ORTHO":h=k(a.dd),u(h,g.ortho_scale/2,g.clip_start,g.clip_end)}h.name=e.name;f.Gv=!1;f.Da=b(g.b4w_move_style);f.dof_distance=g.dof_distance;l=g.dof_object;f.ye=l?l.Fc:null;f.dof_front=g.b4w_dof_front;f.dof_rear=g.b4w_dof_rear;f.dof_power=g.b4w_dof_power;f.jo=g.b4w_enable_hover_hor_rotation;f.S=[h];f.Lq=g.b4w_trans_velocity;f.Kq=g.b4w_rot_velocity;f.Mq=g.b4w_zoom_velocity;f.Da==a.MS_TARGET_CONTROLS&&(f.Xb.set(g.b4w_target),
q(e));var m=e.Ha,g=e.f,l=g.Da;if(l===a.MS_TARGET_CONTROLS||l===a.MS_EYE_CONTROLS||l===a.MS_HOVER_CONTROLS){var m=m.data,H=null,p=null,x=null;l===a.MS_TARGET_CONTROLS||l===a.MS_EYE_CONTROLS?(m.b4w_use_panning&&(g.Pv=m.b4w_use_panning),m.b4w_use_horizontal_clamping&&(H={left:m.b4w_rotation_left_limit,right:m.b4w_rotation_right_limit}),m.b4w_use_vertical_clamping&&(p={Ya:m.b4w_rotation_down_limit,kb:m.b4w_rotation_up_limit}),l===a.MS_TARGET_CONTROLS&&(g.lb=m.b4w_use_distance_limits&&m.b4w_distance_min<=
m.b4w_distance_max,g.lb&&(g.xe=m.b4w_distance_min,g.zg=m.b4w_distance_max))):l===a.MS_HOVER_CONTROLS&&(m.b4w_use_horizontal_clamping&&m.b4w_horizontal_translation_min<=m.b4w_horizontal_translation_max&&(H={left:m.b4w_horizontal_translation_min,right:m.b4w_horizontal_translation_max}),m.b4w_use_vertical_clamping&&m.b4w_vertical_translation_min<=m.b4w_vertical_translation_max&&(p={Ya:m.b4w_vertical_translation_min,kb:m.b4w_vertical_translation_max}),g.lb=m.b4w_use_distance_limits&&m.b4w_hover_angle_min<=
m.b4w_hover_angle_max&&m.b4w_distance_min<=m.b4w_distance_max,g.lb&&(x={Ya:m.b4w_hover_angle_min,kb:m.b4w_hover_angle_max},g.xe=m.b4w_distance_min,g.zg=m.b4w_distance_max));var t=H;t&&l==a.MS_EYE_CONTROLS&&(t.left*=-1,t.right*=-1);if(t=p)switch(l){case a.MS_TARGET_CONTROLS:t.Ya*=-1;t.kb*=-1;break;case a.MS_HOVER_CONTROLS:var v=-t.Ya;t.Ya=-t.kb;t.kb=v}(t=x)&&l==a.MS_HOVER_CONTROLS&&(t.Ya*=-1,t.kb*=-1);g.fc=H;g.mc=p;g.Ib=x;z(e,"LOCAL"==m.b4w_horizontal_clamping_type);G(e,"LOCAL"==m.b4w_vertical_clamping_type)}if(f.Da===
a.MS_HOVER_CONTROLS)if(f=e.f,f.lb){l=e.Ha;g=e.f;m=Q.quat_to_dir(g.quat,Q.AXIS_MY,ma);H=ra;H.set(Q.AXIS_Y);H[3]=0;l=Q.line_plane_intersect(H,-l.data.b4w_hover_zero_level,g.i,m,g.gc);m=n(e,ha)[1];if(!l||Math.abs(m)<oa)ba.warn("Active hover camera view vector and the supporting plane are parallel to each other. Set hover pivot based on the camera position."),g.gc[0]=g.i[0],g.gc[1]=0,g.gc[2]=g.i[2];g=n(e,ha);f=Q.ef(g[1],f.Ib.kb,f.Ib.Ya);0<g[1]&&ba.warn("Active hover camera has wrong orientation");f?E(e,
0,f):r(e)}else f.jo=!1;h.type==a.dd&&d(e)};a.GB=d;a.tz=c;a.wb=k;a.XG=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.sb);case "DEPTH":return Boolean(a.jd);case "SCREEN":return!Boolean(a.sb)&&!Boolean(a.jd);default:throw"Wrong attachment type: "+b;}};a.Am=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.sb=c;break;case "DEPTH":a.jd=c;break;case "SCREEN":a.sb=null;a.jd=null;break;default:throw"Wrong attachment type: "+b;}};a.HH=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.sb;
case "DEPTH":return a.jd;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Tt=function(b,c){if(b.type!=a.Rb||c!=a.Eb&&c!=a.Jb)throw"make_stereo(): wrong camera type";b.type=c;f(b,6,.065)};a.$D=f;a.get_camera_angles=n;a.Ws=l;a.get_camera_angles_char=function(a,b){n(a,b);b[0]=Q.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.f,d=Q.quat_to_dir(c.quat,Q.AXIS_MY,ma),e=Math.asin(d[1]/T.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=
0>=e?Q.quat_to_dir(c.quat,Q.AXIS_MZ,W):Q.quat_to_dir(c.quat,Q.AXIS_Z,W)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.Cm=u;a.QD=function(b,c,d,e,f,g,h){switch(b.type){case a.fg:b.left=c;b.right=d;b.bottom=e;b.top=f;b.ib=g;b.hb=h;break;default:ba.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.f.Da};a.cE=e;a.AI=h;a.Vu=function(a,b,c){var d=ma;d[0]=0;d[1]=-1;d[2]=0;T.transformQuat(d,
c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=W;e[0]=0;e[1]=0;e[2]=-1;T.transformQuat(e,c,e);h(a,b,d,e)};a.vA=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];U.lookAt(a,b,c,ga);U.invert(ga,ga);U.rotateX(ga,Math.PI/2,ga);V.fromMat4(ga,ia);ea.fromMat3(ia,e)};a.iF=g;a.hF=function(b){var c=b.f,d=b.f;if(d.Da===a.MS_TARGET_CONTROLS||d.Da===a.MS_EYE_CONTROLS){if(d.fc){var e=d.fc.left,f=d.fc.right,g=n(b,ha);(g=d.Da==a.MS_TARGET_CONTROLS?Q.ef(g[0],e,f):Q.ef(g[0],f,e))&&(d.Da==a.MS_TARGET_CONTROLS?v(b,g,0):
B(b,g,0))}d.mc&&(e=d.mc.Ya,f=d.mc.kb,g=n(b,ha),(g=d.Da==a.MS_TARGET_CONTROLS?Q.ef(g[1],f,e):Q.ef(g[1],e,f))&&(d.Da==a.MS_TARGET_CONTROLS?v(b,0,g):B(b,0,g)));d.Da===a.MS_TARGET_CONTROLS&&d.lb&&(g=b.f,e=T.subtract(g.i,g.Xb,ma),f=T.length(e),f>g.zg?(T.scale(e,g.zg/f,e),T.add(g.Xb,e,g.i)):f<g.xe&&(f=Q.quat_to_dir(g.quat,Q.AXIS_MY,W),T.scale(f,100*g.xe,f),T.add(e,f,e),T.scale(e,-g.xe/T.length(e),e),T.add(g.Xb,e,g.i)))}d.Da===a.MS_HOVER_CONTROLS&&(d=b.f,g=d.lb?d.gc:d.i,d.fc&&(e=Q.clamp(g[0],d.fc.left,d.fc.right)-
g[0],g[0]+=e,d.lb&&(d.i[0]+=e)),d.mc&&(e=Q.clamp(g[2],d.mc.Ya,d.mc.kb)-g[2],g[2]+=e,d.lb&&(d.i[2]+=e)),d=b.f,d.lb&&d.Ib&&(g=n(b,ha)[1],g=Q.ef(g,d.Ib.kb,d.Ib.Ya),Q.quat_to_dir(d.quat,Q.AXIS_MY,ma),g&&E(b,0,g)));D(b);switch(c.Da){case a.MS_TARGET_CONTROLS:K.DD(c.i,c.quat,c.Xb);K.correct_up(b,Q.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.Ja||K.correct_up(b,Q.AXIS_Y)}q(b)};a.Cq=q;a.gD=z;a.kD=G;a.rF=D;a.rotate_eye_camera=B;a.rotate_target_camera=v;a.rotate_hover_camera=E;a.EB=r;a.eI=function(b){switch(b.type){case a.Rb:case a.dd:case a.Eb:case a.Jb:return!0;
default:return!1}};a.UA=function(b){b=b.f.S[0];switch(b.type){case a.Rb:case a.me:case a.Eb:case a.Jb:return Math.PI*b.Nc/180;default:return ba.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Kf=m;a.Dn=y;a.Mr=t;a.sA=J;a.ny=function(a){a=a.f;var b=w.td();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Kb=b;var c=w.vl(1,[0,0,0]);a.gd=c;a.on=w.fs(1,b);a.qn=w.hs(1,b);a.pn=w.gs(1,b)};a.is_target_camera=function(b){return aa.is_camera(b)&&b.f&&b.f.Da==a.MS_TARGET_CONTROLS?
!0:!1};a.is_eye_camera=function(b){return aa.is_camera(b)&&b.f&&b.f.Da==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=C;a.Bq=I;a.Qz=F;a.project_point=function(b,c,d){b=b.f.S[0];switch(b.type){case a.Rb:case a.me:case a.dd:case a.$e:case a.Eb:case a.Jb:var e=ra;e.set(c);e[3]=1;ca.transformMat4(e,b.Kd,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;x.YF(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return ba.error("Non-compatible camera"),d}};a.gB=function(a){return a.f.S[0]};
a.Nl=function(b,c){switch(b.type){case a.Rb:case a.me:case a.Eb:case a.Jb:var d=Math.tan(Q.um(b.Nc)/2);switch(c){case "LEFT":return-d*b.Fa;case "RIGHT":return d*b.Fa;case "TOP":return d;case "BOTTOM":return-d}break;case a.dd:case a.$e:switch(c){case "LEFT":return-b.top*b.Fa;case "RIGHT":return b.top*b.Fa;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.fg:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:Q.ba("Unknown camera type")}};
a.TB=function(b){switch(b.type){case a.dd:case a.$e:case a.fg:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.Rb:case a.me:case a.Eb:case a.Jb:var d=Q.um(b.Nc);return c?d*b.Fa:d;default:return 0}}};b4w.module.__lights=function(a,p){function d(a){b.scale(a.color,a.Jh,a.ql)}p("__print");var c=p("__util"),b=p("__vec3"),k=new Float32Array(3);a.XB=function(a,n){var l=a.data,u=n.Na={name:"",type:l.type,uu:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),ql:new Float32Array(3),ts:0,Qe:0,zk:0,Ss:!1,Xt:!1,zs:!1,Ri:!0,oh:!0,Jh:1,distance:25,vH:"INVERSE_SQUARE"};u.name=n.name;u.Ri=l.use_diffuse;u.oh=l.use_specular;var e=c.quat_to_dir(n.f.quat,c.AXIS_Y,k);b.normalize(e,e);u.direction.set(e);
u.color[0]=l.color[0];u.color[1]=l.color[1];u.color[2]=l.color[2];u.Jh=u.ts=l.energy;d(u);u.distance=l.distance;if("POINT"===u.type||"SPOT"===u.type)u.distance=l.distance;"SPOT"===u.type?(u.zk=l.spot_blend,u.Qe=l.spot_size):"POINT"===u.type&&(u.Qe=Math.PI/2);u.Ss=l.b4w_generate_shadows;u.zs=l.b4w_dynamic_intensity};a.TD=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];d(a)};a.VD=function(a,b){a.zk=b};a.UD=function(a,b){a.distance=b};a.WD=function(a,b){a.Qe=b};a.Tu=function(a,b){a.Jh=
b;d(a)};a.nF=function(a){if("LAMP"!=a.type)throw"Wrong light object";var d=a.Na;if(d){c.quat_to_dir(a.f.quat,c.AXIS_Y,d.direction);b.normalize(d.direction,d.direction);if("SUN"==d.type){a=Math.acos(b.dot(d.uu,c.er));var l=Math.acos(b.dot(d.direction,c.er));d.Xt=Math.floor(a/.025)!=Math.floor(l/.025)?!0:!1}b.copy(d.direction,d.uu)}}};b4w.module.__scenes=function(a,p){function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.Md||!c.Md.length)return c}return null}function c(){if(!Ib)throw"No active scene available";return Ib}function b(a,c,d){for(var e=0;e<a.length;e++){var f=a[e];"ALL"!=c&&c!=f.type||d.push(f);(f=f.dupli_group)&&b(f.objects,c,d)}}function k(a,b,c){if(!Ia.yj||!f(a,b,c))return null;a=a.b4w_shadow_settings;c={};a.csm_resolution>Ia.Vb?(c.csm_resolution=Ia.Vb,ta.error("Shadow map texture has unsupported size. Changed to "+
Ia.Vb+".")):c.csm_resolution=a.csm_resolution;c.self_shadow_polygon_offset=a.self_shadow_polygon_offset;c.self_shadow_normal_offset=a.self_shadow_normal_offset;c.enable_csm=a.b4w_enable_csm;if(b=xa.Co(b)||b[0])c.Mg=b.Na.type,c.Qe=b.Na.Qe,c.distance=b.Na.distance,"SPOT"!=c.Mg&&"POINT"!=c.Mg||!c.enable_csm||(ta.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),c.enable_csm=!1);c.enable_csm?(c.csm_num=a.csm_num,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=
a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,c.last_cascade_blur_radius=a.last_cascade_blur_radius,c.fade_last_cascade=a.fade_last_cascade,c.blend_between_cascades=a.blend_between_cascades):(c.csm_num=1,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,c.last_cascade_blur_radius=a.last_cascade_blur_radius,c.fade_last_cascade=!1,c.blend_between_cascades=
!1);return c}function f(a,b,c){if(Ia.xi)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=Ia.de&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var f=c[b].Ha;f.b4w_shadow_cast&&(d=!0);f.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function n(a){for(var b=0;b<a.length;b++)if("SUN"==a[b].Na.type)return!0;return!1}function l(a){if(!Ia.shore_smoothing)return!1;a=ha(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&
c.b4w_water_shore_smoothing)return!0}return!1}function u(a){for(var b=0;b<a.length;b++)for(var c=a[b].Ha.particle_systems,d=0;d<c.length;d++){var e=c[d].settings;if(e.b4w_enable_soft_particles&&0<e.b4w_particles_softness)return!0}return!1}function e(a){for(var b=ha(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var f={},g=0;g<a.length;g++)for(var h=a[g].Ha,l=h.data.materials,k=0;k<l.length;k++)l[k]==e&&(f.bg=h.location[1]);f.dc=e.b4w_water_fog_color.slice(0);f.dc.push(e.b4w_water_fog_density);
e.b4w_water_dynamic?(f.Cj=!0,f.waves_height=e.b4w_waves_height,f.waves_length=e.b4w_waves_length,f.dst_noise_scale0=e.b4w_water_dst_noise_scale0,f.dst_noise_scale1=e.b4w_water_dst_noise_scale1,f.dst_noise_freq0=e.b4w_water_dst_noise_freq0,f.dst_noise_freq1=e.b4w_water_dst_noise_freq1,f.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,f.dir_freq=e.b4w_water_dir_freq,f.dir_noise_scale=e.b4w_water_dir_noise_scale,f.dir_noise_freq=e.b4w_water_dir_noise_freq,f.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,
f.dst_min_fac=e.b4w_water_dst_min_fac,f.waves_hor_fac=e.b4w_water_waves_hor_fac):(f.Cj=!1,f.waves_height=0,f.waves_length=0);f.se=e.b4w_water_enable_caust;f.Ky=e.b4w_water_caust_scale;f.Jy=e.b4w_water_caust_brightness;f.Ly=new Float32Array([.3,.7]);f.Em=null;e=e.texture_slots;for(g=0;g<e.length;g++)h=e[g].texture,!0===h.b4w_shore_dist_map&&(f.Em=h.image,f.zi=h.image.size[0],f.jE=h.b4w_shore_boundings,f.fi=h.b4w_max_shore_dist);c.push(f)}}if(0<c.length){f=c[0];if(!f.Cj)for(d=0;d<c.length;d++)c[d].Cj&&
(f=c[d]);return f}return null}function h(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.kc=!0)}}}var c={kc:!1};a=ha(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.kc=!0);e.node_tree&&b(e.node_tree)}return c}function g(a,b){if(Ia.qk)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=[],d=0,e=0;e<b.length;e++){var f=b[e];
f.f.wc&&"CUBE"==f.f.ae&&d++;if(f.rk.length){for(var g=null,h=0;h<c.length;h++)if(c[h]==f){g=h;break}null==g&&c.push(f)}}return{Hu:c,gu:d,jf:[],Ff:[]}}function q(a,b){var c=a.b4w_sky_settings,d={};d.uD=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.Ai=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=
c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.jc=c.reflexible;d.Yb=c.reflexible_only;!b&&c.procedural_skydome&&ta.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function z(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.CB=a.hemisphere;b.zy=a.blur_depth;b.Gr=a.blur_discard_value;b.influence=a.influence;
b.dist_factor=a.dist_factor;b.GD=a.samples;return b}function G(a){if(!(Ia.il&&a.b4w_enable_bloom&&a.k.lh))return null;var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.hA=a.edge_lum;b.key=a.key;return b}function D(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function B(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}
function v(a){var b={};a=a.b4w_god_rays_settings;b.Ro=a.intensity;b.ei=a.max_ray_length;b.Ii=a.steps_per_pass;return b}function E(a){var b={};b.Le=a.b4w_outline_color;b.gk=a.b4w_outline_factor;return b}function A(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function r(a,b){var c=a.light_settings,d={};d.nf=c.environment_energy;
d.Gq=c.use_environment_light;d.ko=c.environment_color;d.rf=a.horizon_color.slice(0);d.eg=a.zenith_color.slice(0);d.NF=a.use_sky_paper;d.MF=a.use_sky_blend;d.OF=a.use_sky_real;d.gv=null;d.bq=null;d.lo=null;if(d.Gq&&"SKY_TEXTURE"==d.ko&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=a.texture_slots[e];break}c?d.lo=c:(ta.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),
d.Gq=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=a.texture_slots[e];d.gv=c;d.bq={wy:c.blend_factor,DB:c.horizon_factor,gG:c.zenith_up_factor,fG:c.zenith_down_factor,color:c.color,La:c.default_value,invert:c.invert,LF:c.use_rgb_to_intensity,xy:c.blend_type,HF:c.use_map_blend,IF:c.use_map_horizon,KF:c.use_map_zenith_up,JF:c.use_map_zenith_down};break}return d}function m(a){var b=a.fog_settings,c={};c.DF=b.use_fog;c.Ro=b.intensity;c.depth=b.depth;c.start=
b.start;c.height=b.height;c.wA=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);a=c.color;c.dc=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.Kl=new Float32Array([c.Ro,c.depth,c.start,c.height]);return c}function y(a){if(!Ia.Fb)return!1;for(var b=!1,c=!1,d=0;d<a.length;d++){for(var e=a[d].Ha,f=e.data.materials,g=0;g<f.length;g++)f[g].b4w_terrain&&(b=!0);e=e.particle_systems;for(g=0;g<e.length;g++)f=e[g].settings,"HAIR"==f.type&&f.b4w_dynamic_grass&&(c=!0);if(b&&c)return!0}return!1}
function t(a,b){if(ib.outlining_overview_mode)return!0;if(Ia.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].f.Ne)return!0;return!1}else return!1}function J(a,b){if(ib.outlining_overview_mode)return!0;if(Ia.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].f.tb)return!0;return!1}else return!1}function C(a,b){if(Ia.Ee)switch(a.b4w_enable_glow_materials){case "OFF":return!1;
case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].Ha.data.materials,e=0;e<d.length;e++)if(Sa.Tr(d[e]))return!0;return!1}else return!1}function I(a,b){if(Ia.kc)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.kc}else return!1}function F(a){for(var b=0;b<a.length;b++)for(var c=a[b].Ha.data.materials,d=0;d<c.length;d++){var e=c[d],f=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f)return!0}return!1}function N(a,
b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0}for(var c=0;c<b.length;c++){var d=b[c];if(d.anchor&&d.anchor.Gh)return!0}return!1}function w(a,b,c){var d=ua.Vg(a,b);ua.Te(a,d,function(a,b,d){if(d.eb){switch(d.from){case "COLOR":case "CUBEMAP":a=b.j.sb;break;case "DEPTH":a=b.j.jd;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "u_cube_reflection":case "u_plane_reflection":break;
default:if(!a)throw"Connection of SCREEN is forbidden";if(a.$f)throw"Batch texture can't use renderbuffer";pa.Vr(c.lc,d.to)&&Y.Ah(c,a,d.to)}}});for(a=0;a<b.ta.length;a++){var d=b.ta[a],e=b.ge[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(e.$f)throw"Batch texture can't use renderbuffer";pa.Vr(c.lc,d.to)&&Y.Ah(c,e,d.to)}}}function K(a,b){return{ob:!0,ho:[!0,!0,!0,!0,!0,!0],Ed:a,C:b}}function x(a,b,c,d,e,f){function g(a,b){return a==
b?0:a>b?1:-1}for(var h=b.f,l=xa.Ma(b,e).T,k=0;k<l.length;k++){var m=l[k];m.xc||m.Yb||"MAIN"!=m.type&&"NODES_GLOW"!=m.type&&"PARTICLES"!=m.type||!("OPAQUE"==m.Ua&&"OPAQUE"==d||"BLEND"==m.Ua&&"BLEND"==d||"XRAY"==m.Ua&&"XRAY"==d||"NODES_GLOW"==m.type&&"GLOW"==d)||(f||(V(m,a,b,c,d,e),Y.ub(m),U(m)),a.p.push(K(h,m)),w(c,a,m),aa(m))}a.p.sort(function(a,b){return a.C&&b.C?-g(a.C.Ia,b.C.Ia)||-g(a.C.jg,b.C.jg)||g(a.C.Xg,b.C.Xg):0})}function V(a,b,c,d,e,f){var g=c.f,h=xa.Ma(c,f),l="NO_SHADOWS";if((c=ja.Sa(d,
"SHADOW_CAST"))&&a.yc){switch(e){case "OPAQUE":l="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":l="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":l="NO_SHADOWS";break;case "DEPTH":l="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}Y.tr(a,f.k.bc,c)}c=a.ab;pa.H(c,"SHADOW_USAGE",l);a.Fb&&(l=ja.Sa(d,"GRASS_MAP"))&&ba(a,l,g);if("DEPTH"!=a.type&&"COLOR_ID"!=e||a.Vh)if(e=b.dk,pa.H(c,"NUM_LIGHTS",e),pa.H(c,"NUM_LFACTORS",0==e%2?e/2:Math.floor(e/2)+1),"special_skydome.glslf"==
pa.$s(c)&&pa.H(c,"REFLECTION_PASS",0),pa.H(c,"SSAO_ONLY",0),b.rb&&b.Ld?pa.H(c,"WATER_EFFECTS",1):pa.H(c,"WATER_EFFECTS",0),b.rb&&b.se&&g.se?(pa.H(c,"CAUSTICS",1),pa.H(c,"CAUST_SCALE",pa.r(b.Or)),pa.H(c,"CAUST_SPEED",pa.r(b.Pr,2)),pa.H(c,"CAUST_BRIGHT",pa.r(b.Nr))):pa.H(c,"CAUSTICS",0),b.rb&&(pa.H(c,"WAVES_HEIGHT",pa.r(b.cg)),pa.H(c,"WAVES_LENGTH",pa.r(b.uh)),pa.H(c,"WATER_LEVEL",pa.r(b.bg))),g=h.jf,h=h.Ff,-1!==a.Ob.indexOf("u_mirrormap")?pa.H(c,"REFLECTION_TYPE","REFL_MIRRORMAP"):a.wc&&g?(g=g.j.sb,
Y.Ah(a,g,"u_cube_reflection"),pa.H(c,"REFLECTION_TYPE","REFL_CUBE")):a.wc&&h?(g=h.j.sb,Y.Ah(a,g,"u_plane_reflection"),pa.H(c,"REFLECTION_TYPE","REFL_PLANE")):pa.H(c,"REFLECTION_TYPE","REFL_NONE"),(h=ja.Sa(d,"SKY"))?a.xu?(g=h.j.sb,Y.Ah(a,g,"u_sky")):Ia.rm?(a.Ic=h.Ic,pa.H(c,"PROCEDURAL_FOG",1)):pa.H(c,"PROCEDURAL_FOG",0):pa.H(c,"PROCEDURAL_FOG",0),g=f.k.Sq,g.Gq&&(pa.H(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==g.ko?(g=g.lo?Y.YA(g.lo,!1):h.j.sb,pa.H(c,"SKY_TEXTURE",1),Y.Ah(a,g,"u_sky_texture")):"SKY_COLOR"==
g.ko&&pa.H(c,"SKY_COLOR",1)),g=f.k.kw,g.DF&&(pa.H(c,"USE_FOG",1),pa.H(c,"FOG_TYPE",g.wA)),a.Lp?(Ia.yj&&pa.H(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.Vh||"NODES_GLOW"==a.type?(pa.H(c,"REFRACTIVE",1),f.k.kc?pa.H(c,"USE_REFRACTION",1):pa.H(c,"USE_REFRACTION",0)):f.k.kc?pa.H(c,"REFRACTIVE",1):pa.H(c,"REFRACTIVE",0)):(pa.H(c,"REFRACTIVE",0),pa.H(c,"USE_REFRACTION",0),pa.H(c,"USE_REFRACTION_CORRECTION",0)),a.ag&&(Ia.shore_smoothing&&a.Xm&&ja.Sa(d,"DEPTH")?pa.H(c,"SHORE_SMOOTHING",1):pa.H(c,"SHORE_SMOOTHING",
0),a.water_dynamic&&b.rb&&b.cg?pa.H(c,"DYNAMIC",1):pa.H(c,"DYNAMIC",0)),"PARTICLES"==a.type&&(pa.H(c,"SIZE_RAMP_LENGTH",a.sa.bv),pa.H(c,"COLOR_RAMP_LENGTH",a.sa.as)),!a.Fg)for(a=a.U,b=0;b<a.length;b++)if(g=a[b],"SCENE"==g.source)for(d=0;d<Ua.length;d++)for(c=Ua[d],h=Ua[d].Md,e=0;e<h.length;e++)h[e].k==g&&ua.n(Zb,c,f,null)}function U(a){var b=a.lc.attributes,c=a.R.Nb,d;for(d in b)c[d]||La.ba('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=pa.tB(a.lc.Oq),10<b&&("MAIN"==
a.type&&ta.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Oc.join(", ")+'"'),"MAIN"==a.type&&a.Vh||"NODES_GLOW"==a.type))d=c=0,a.ph&&(c=La.Qj(a.ph)),a.Cb&&(d=La.Qj(a.Cb)),ta.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Oc.join(", ")+'"')}function aa(a){8<a.U.length&&ta.warn(a.type,"too many textures used - "+a.U.length+' (max 8), materials "'+a.Oc.join(", ")+'"')}function ba(a,b,c){a.qc=b.qc;var d=b.qc[0],e=b.qc[1],f=b.qc[2];c=
c.Kb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.qc[2]=f;b=b.j;L.Cm(b,f/2,-e,-d,f/2);L.Kf(b);d=a.Fo||0;d=0==d?c:Math.max(d,c);a.Fo=d}function ea(a){var b=W(a,"MAIN_OPAQUE"),c=!0,d=a.k.bc;ua.V(a.k.pb,function(a,e){"SHADOW_CAST"===e.type&&(X(e,b.j,e.p,d,c),c=!1)})}function R(a){ua.V(a.k.pb,function(a,b){"OUTLINE"===b.type&&(b.io=1)})}function X(a,b,c,d,e){if(0!=c.length){var f=a.j;Ta.copy(b.of,f.of);wa.copy(b.ya,f.Zu);if("SUN"===d.Mg||"HEMI"===d.Mg){var g=Tb;sa.td(g);for(var h=
0;h<c.length;h++){var l=c[h].Ed;0==h?sa.tl(l.nb,g):sa.Bs(g,l.nb)}c=sa.rA(g,Pc);La.Gf(c,f.ya,c);if(d.enable_csm){d=Ta.copy(b.uj[a.Un],Bc);g=wa.invert(b.ya,rc);La.Gf(d,g,d);La.Gf(d,f.ya,d);a=b.Vn[a.Un];if(e)for(Cc=0,kc=-Infinity,e=2;e<c.length;e+=3)Cc=Math.min(Cc,c[e]),kc=Math.max(kc,c[e]);e=Tb;e.max_x=d[0]+a;e.max_y=d[1]+a;e.max_z=kc;e.min_x=d[0]-a;e.min_y=d[1]-a;e.min_z=Cc}else{a=e=Tb;b=dc;b.set(c);c=Xc/9;d=wa.identity(rc);wa.rotate(d,c,La.AXIS_MZ,d);h=g=-1;for(l=0;10>l;l++){var k=sa.uy(b,Ub),m=(k.max_x-
k.min_x)*(k.max_y-k.min_y);if(-1==g||m<g)g=m,h=l,sa.tl(k,a);La.Gf(b,d,b)}c*=h;0<c&&(a=wa.identity(rc),wa.rotate(a,c,La.AXIS_MZ,a),wa.multiply(a,f.ya,f.ya));c=e.max_x-e.min_x;a=e.max_y-e.min_y;c&&a&&(b=Math.abs(c-a)/2,2<c/a?(e.max_y+=b,e.min_y-=b):2<a/c&&(e.max_x+=b,e.min_x-=b));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}L.QD(f,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);L.Kf(f);La.Hl(f.Kd,f.Lj)}else"SPOT"!==d.Mg&&"POINT"!==d.Mg||L.Kf(f,f.Fa)}}function Q(a,
b,c,d,e){for(var f=b.f,g=xa.Ma(b,d).T,h=0;h<g.length;h++){var l=g[h];"COLOR_ID"==l.type&&(e||(V(l,a,b,c,"COLOR_ID",d),Y.ub(l),U(l)),"COLOR_PICKING"==a.type&&"COLOR_ID"==l.Ua||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==l.Ua)&&(e||(Y.la(l,"USE_OUTLINE",0),Y.ub(l),U(l)),a.p.push(K(f,l)))}}function T(a,b,c,d,e){d||(e.Fb&&(d=ja.Sa(c,"GRASS_MAP"))&&ba(e,d,b),Y.ub(e),U(e));a.p.push(K(b,e));w(c,a,e);aa(e)}function ca(a,b){for(var c=ma(b,pb),d=a.Na,e=a.f,f=xa.Ma(a,b),g=f.ak,h=0;h<c.length;h++){var l=c[h];
l.bm.set(e.i,3*g);l.bp.set(d.direction,3*g);l.ap.set(d.ql,3*g);switch(d.type){case "SUN":l.xv.set(e.quat);l.wv=d.ql;"SKY"===l.type?(l.gm=d.Xt,Ta.copy(d.direction,l.mq),oa(b,l)):Ta.copy(d.direction,l.mq);break;case "HEMI":case "POINT":case "SPOT":break;default:ta.error("Unknown light type: "+d.type+'".')}var k=Jb;k[0]=d.Ri?1:0;k[1]=d.oh?1:0;l.cp.set(k,2*g);l.wa=!0;for(k=0;k<l.p.length;k++){var m=l.p[k].C;m.ai&&Y.SD(m,a)}}c=W(b,"MAIN_OPAQUE").j;f=f.$u;d=b.k.bc;for(h=0;h<f.length;h++)l=f[h],L.Vu(l.j,
e.i,e.quat),X(l,c,l.p,d,!0)}function oa(a,b){Ba.Bj(b);if(b.gm)for(var c=ma(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].p,f=0;f<e.length;f++){var g=e[f];g.ob&&(g=g.C,Y.Oy(g)&&Ba.cF(g))}}function ha(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].Ha.data,e=0;e<d.materials.length;e++){var f=d.materials[e];-1==b.indexOf(f)&&b.push(f)}return b}function na(a,b,c){for(var d=a.k,e=a.gg.f.S,f=0;f<e.length;f++){var g=e[f];L.Kf(g,b/c);d.bc&&L.Bq(g,d.bc)}d.bc&&
(d.hm=!0,W(a,"DEPTH").wa=!0,W(a,"MAIN_BLEND").wa=!0);var h=d.pb;ja.UE(h,function(d,e,f){if(d.Pi){var g=d.Pf*b,l=d.Pf*c;if(e)for(e=0;e<f.ta.length;e++)f.ta[e]==d&&Bb.resize(d.Ca,g,l);else switch(Bb.Zj(d.Ca)&&Bb.resize(d.Ca,g,l),d=f.j,d.width=g,d.height=l,f.type){case "DOF":M(a,{dof_power:f.j.dof_power,dof_on:f.j.dof_on});break;case "GLOW_COMBINE":S(a,{small_glow_mask_width:f.small_glow_mask_width,large_glow_mask_width:f.large_glow_mask_width});break;case "BLOOM":O(a,{bloom_blur:f.bloom_blur});break;
case "OUTLINE":f=ja.Ra(h,f,"POSTPROCESSING");g=ja.Ra(h,f,"POSTPROCESSING");l=ja.Ra(h,g,"POSTPROCESSING");d=ja.Ra(h,l,"POSTPROCESSING");ja.Uc(f,1/b,1/c);ja.Uc(g,1/b,1/c);ja.Uc(l,1/b,1/c);ja.Uc(d,1/b,1/c);break;default:ja.Uc(f,1/b,1/c)}}})}function ma(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];ua.V(a.k.pb,function(a,b){b.type==e&&c.push(b)})}return c}function W(a,b){return ja.Sa(a.k.pb,b)}function M(a,b){var c=W(a,"DOF");if(!c)return ta.error("DOF is not enabled on the scene. Check camera settings"),
0;var d=a.k.pb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;var e=ja.Ra(d,c,"POSTPROCESSING"),d=ja.Ra(d,e,"POSTPROCESSING");ja.ac(e,c.j.dof_power);ja.Uc(e,1/c.j.width,1/c.j.height);ja.ac(d,c.j.dof_power);ja.Uc(d,1/c.j.width,1/c.j.height)}c.wa=!0}
function O(a,b){var c=W(a,"LUMINANCE_TRUNCED"),d=W(a,"BLOOM");if(!c||!d)return ta.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.wa=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.wa=!0);if("number"==typeof b.bloom_blur){var e=a.k.pb,c=ja.Ra(e,d,"BLOOM_BLUR"),e=ja.Ra(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ja.ac(c,b.bloom_blur);ja.Uc(c,1/d.j.width,1/d.j.height);ja.ac(e,b.bloom_blur);ja.Uc(e,1/d.j.width,1/d.j.height)}}
function S(a,b){var c=W(a,"GLOW_COMBINE");if(!c)return ta.error("Glow is not enabled on the scene"),null;for(var d=a.k.pb,e=ja.kB(d,c),f=0;f<e.length;++f){var g=e[f];if("POSTPROCESSING"===g.type&&"GLOW_MASK_LARGE"===g.Ua)var h=g;if("POSTPROCESSING"===g.type&&"GLOW_MASK_SMALL"===g.Ua)var l=g}e=ja.Ra(d,h,"POSTPROCESSING");d=ja.Ra(d,l,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.wa=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=
b.large_glow_mask_coeff,c.wa=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ja.ac(l,b.small_glow_mask_width),ja.Uc(l,1/c.j.width,1/c.j.height),l.wa=!0,ja.ac(d,b.small_glow_mask_width),ja.Uc(d,1/c.j.width,1/c.j.height),d.wa=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ja.ac(h,b.large_glow_mask_width),ja.Uc(h,1/c.j.width,1/c.j.height),h.wa=!0,ja.ac(e,b.large_glow_mask_width),ja.Uc(e,1/c.j.width,1/c.j.height),
e.wa=!0)}function ra(a,b){var c=W(Ib,"MAIN_OPAQUE");if(!c||!c.rb)return ta.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.cg,e=c.uh,f=c.bg,g=c.rb;if(!d||!g.Cj)return g.bg;var h=Ta.length(c.Ue),l=c.time;h&&(l*=h);var k=Jb;k[0]=20/e*(a-.25*l);k[1]=20/e*(b-.25*l);h=La.Qr(k);k[0]=17/e*(b+.1*l);k[1]=17/e*(a+.1*l);var k=La.Qr(k),h=h+k-1,m=g.dst_noise_scale0,k=g.dst_noise_scale1,n=g.dst_noise_freq0,H=g.dst_noise_freq1,q=Jb;q[0]=m*(a+n*l);q[1]=m*(b+n*l);m=La.cq(q);q[0]=k*
(b-H*l);q[1]=k*(a-H*l);k=La.cq(q);k*=d*m;if(c.Tm)if(H=(a-c.Mf[0])/c.Nf[0],q=(c.Mf[1]+b)/c.Nf[1],H+=.5,q+=.5,1<H||0>H||1<q||0>q)d=k;else var H=La.Us(Ib.k.Yp,c.zi,H,q),m=g.dir_freq,r=g.dir_noise_scale,u=g.dir_noise_freq,n=g.dir_min_noise_fac,q=g.dst_min_fac,c=e/c.fi/Math.PI,r=[r/e*(a+u*l),r/e*(b+u*l)],e=Math.sqrt(H),d=d*Math.max(H,g.dir_min_shore_fac)*Math.sin(e/c+m*l)*Math.max(La.cq(r),n),g=Math.max(e,q),d=d*(1-g)+k*g,h=h*H;else d=k;return f+(d+.05*h)}function P(a,b){a.Xj&&"POSTPROCESSING"==a.type&&
b.ob!=a.ob&&(a.ob=b.ob);b.ob||"OUTLINE"!=a.type||(a.io=0)}function ia(a,b,c,d){var e=ua.Ta(a,b);L.Am(e.j,c,d);e.mn=!0;ua.Uf(a,b,function(b,e,f){f.eb&&f.from==c&&ja.Yy(f)&&ga(a,b,f.to,d)});ua.Te(a,b,function(b,e,f){f.eb&&f.from==c&&f.from==f.to&&ia(a,b,c,d)})}function ga(a,b,c,d){a=ua.Ta(a,b).p;for(b=0;b<a.length;b++)Y.yD(a[b].C,d,c)}function fa(a){var b=W(a,"GRASS_MAP");if(b){var c=b.j,d=a.gg.f,e=d.i;a=Bc;a[0]=0;a[1]=-b.qc[2]/2;a[2]=0;Ta.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=Oc;
b[0]=0;b[1]=0;b[2]=0;b[3]=1;L.Vu(c,a,b)}}function ka(a,b){ua.V(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.ta[0]||!d.ge[0])throw"Wrong MOTION_BLUR subscene";var e=d.ta[0],f=d.ge[0];d.ge[0]=d.j.sb;ua.Uf(a,c,function(b,c,d){d.eb&&ga(a,b,d.to,f)});ia(a,c,e.from,f);ga(a,c,e.to,d.ge[0]);d.Wt=Math.exp(-b/d.mb_factor)}})}function da(a){return a.k.Ue}var Y=p("__batch"),sa=p("__boundings"),L=p("__camera"),qa=p("__config"),la=p("__container");p("__constraints");var H=p("__debug"),hb=p("__geometry"),ua=
p("__graph"),ya=p("__hud"),wa=p("__mat4"),Sa=p("__nodemat"),xa=p("__obj_util"),tb=p("__physics"),Sb=p("__prerender"),Da=p("__primitives"),ta=p("__print"),Ba=p("__renderer"),ja=p("__scenegraph"),qc=p("__sfx"),pa=p("__shaders"),Bb=p("__textures"),La=p("__util"),Ta=p("__vec3"),Ia=qa.q,ib=qa.tb,Hb=qa.wi,Ya="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.CG=Ya;var pb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED DEPTH SHADOW_CAST COLOR_PICKING COLOR_PICKING_XRAY OUTLINE_MASK".split(" "),
Gc="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Wc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),Mc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Yb=null,Ib=null,Ua=[],Zb=null,Xc=Math.PI/2,Jb=new Float32Array(2),Bc=new Float32Array(3),Oc=new Float32Array(4),rc=new Float32Array(16),
Pc=new Float32Array(24),dc=new Float32Array(24),Tb=sa.td(),Ub=sa.td(),Cc=0,kc=-Infinity;a.iH=function(){return{}};a.set_active=function(a){Ib=a;qc.ND(a)};a.jD=function(a,b){var c=a.k,d=ja.Dz(c.pb);if(a==b){na(a,la.vB(),la.uB());for(var e=0;e<d.length;e++)a.k.eh.push(d[e])}else for(e=a.Md[0],na(a,e.k.jh,e.k.jh),e=0;e<d.length;e++)b.k.eh.push(d[e]);d=ma(a,Wc);for(e=0;e<d.length;e++)d[e].Ue.set(c.Ue);for(e=0;e<c.eh.length;e++)"SHADOW_CAST"==c.eh[e].type&&Ba.Bj(c.eh[e])};a.Sh=function(){Yb||(Yb=d(Ua));
return Yb};a.Il=d;a.get_active=c;a.ja=function(){return Ib?!0:!1};a.Pj=function(a){return a.gg};a.Rh=function(){return Ua};a.et=function(){if(1==Ua.length)return Ua;for(var a=0;a<Ua.length;a++){var b=Ua[a].k.pb;ua.V(b,function(b,c){for(var d=0;d<c.p.length;d++){for(var e=c.p[d].C.U,f=null,g=0;g<e.length;g++)if("SCENE"==e[g].source&&e[g].dq==Ua[a].name&&"COPY"!=c.type){ta.error('Texture-scene loop detected. A scene is rendered to texture "'+e[g].name+'" yet this texture belongs to the same scene.');
ua.Vg(Zb,Ua[a]);f=c.p[d].C;break}f&&(f.U=[],f.Ob=[],Y.bF(f,null),Y.ub(f))}})}for(var c=[],a=0;a<Ua.length;a++)if(b=Ua[a],!b.Md.length){b=ua.Vg(Zb,b);ua.lA(Zb,b);b=ua.kq(Zb,b,ua.Zm);b=ua.vq(b);ua.V(b,function(a,b){c.push(b)});break}return c};a.Ux=function(a,b,c,d,f){a.Md=a.Md||[];a.X=null;var H=a.k,p=a.gg.f;H.Xi=[];var x=a.world;H.YB=c.length;H.lh=n(c);H.Gm=q(x,H.lh);H.Sq=r(x,H.Gm);H.kw=m(x);H.Lx=N(a,f);p.S[0].type!=L.Rb&&Ia.anaglyph_use?(ta.warn("Anaglyph stereo is disabled for the non-perspective camera"),
f=!1):f=Ia.anaglyph_use;H.anaglyph_use=f;H.vi=g(a,b);H.yy=G(a);H.FC=D(a);H.My=B(a);H.xB=v(a);H.TC=E(a);H.qf=A(a);H.Ih=Ia.Ih&&(0<p.dof_distance||p.ye);H.Ug=Ia.Ug&&a.b4w_enable_motion_blur;H.Eh=Ia.Eh&&a.b4w_enable_color_correction;H.antialiasing=Ia.antialiasing&&a.b4w_enable_antialiasing;H.de=Ia.de&&a.b4w_enable_ssao;H.Th=Ia.Th&&a.b4w_enable_god_rays&&H.lh;H.bA=Ia.yj;H.Eo=a.world.b4w_render_glow_over_blend;H.BE=z(a);f=h(d);H.BC=f;H.kc=I(a,f);H.bc=k(a,c,d);H.rb=e(d);H.We=F(d);H.mE=u(d);H.shore_smoothing=
l(d);H.Fb=y(d);H.ez=t(a,d);H.outline=J(a,d);H.Ee=C(a,d);switch(a.b4w_reflection_quality){case "LOW":H.wg=Hb.ns;H.mk=Hb.su;break;case "MEDIUM":H.wg=Hb.Sz;H.mk=Hb.cD;break;case "HIGH":H.wg=Hb.Rz;H.mk=Hb.bD;break;default:H.wg=Hb.ns,H.mk=Hb.su}c=a.Md.sort(function(a,b){return b.k.jh-a.k.jh});H.pb=ja.Cz(H,p,c);H.eh=[];H.hm=!1;H.op=!1;H.pp=!1;H.Ue=new Float32Array(3);Ua.push(a);Zb||(Zb=ua.create());ua.u(Zb,a);for(H=0;H<b.length;H++)xa.Tp(b[H],!0,a)};a.Vx=function(a,b,c){for(var d=0;d<b.length;d++)b[d].k&&
b[d].k.Zh&&(b[d].k.Cc=c,a.k.Xi.push(b[d]))};a.fz=function(a){var c="ALL",d=[];b(a.objects,c,d);return d};a.bt=function(a){return a.k.pb};a.HA=function(a){ua.V(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=Y.ls(c.qm);break;case "SSAO":d=Y.Jz(c);break;case "SSAO_BLUR":d=Y.Kz(c);break;case "DEPTH_PACK":d=Y.rz();break;case "REFRACT":case "COPY":d=Y.ls("NONE");break;case "GOD_RAYS":ja.Ra(a,c,"WIREFRAME")||ja.Ra(a,c,"MAIN_BLEND")||ja.Ra(a,c,"GOD_RAYS");d=Y.vz(c.nu,c.ag,c.Ii);break;case "GOD_RAYS_COMBINE":ja.Ra(a,
c,"WIREFRAME")||ja.Ra(a,c,"MAIN_BLEND");ja.Ra(a,c,"GOD_RAYS");d=Y.wz();break;case "MOTION_BLUR":d=Y.zz();break;case "DOF":var d=Y.sz(),e=ja.Ra(a,c,"POSTPROCESSING"),f=ja.Ra(a,e,"POSTPROCESSING");ja.ac(e,c.j.dof_power);ja.ac(f,c.j.dof_power);break;case "OUTLINE":var d=Y.Az(),e=ja.Ra(a,c,"POSTPROCESSING"),f=ja.Ra(a,e,"POSTPROCESSING"),g=ja.Ra(a,f,"POSTPROCESSING"),h=ja.Ra(a,g,"POSTPROCESSING");ja.ac(f,c.vn);ja.ac(e,c.vn);ja.ac(h,c.oo*c.gk);ja.ac(g,c.oo*c.gk);break;case "GLOW_COMBINE":d=Y.uz();break;
case "COMPOSITING":d=Y.pz();break;case "ANTIALIASING":d=Y.lz();break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=Y.Hz(c.type);break;case "ANAGLYPH":d=Y.jz();break;case "SKY":d=Y.Bz();break;case "LUMINANCE":d=Y.xz();break;case "AVERAGE_LUMINANCE":d=Y.mz();break;case "LUMINANCE_TRUNCED":d=Y.yz();break;case "BLOOM_BLUR":d=Y.nz();break;case "BLOOM":d=ja.Ra(a,c,"BLOOM_BLUR");e=ja.Ra(a,d,"BLOOM_BLUR");ja.ac(d,c.bloom_blur);ja.ac(e,
c.bloom_blur);d=Y.oz();break;case "VELOCITY":d=Y.Nz();break;case "ANCHOR_VISIBILITY":d=Y.kz()}d&&(e=K(xa.Fh("NONE"),d),U(d),c.p.push(e),w(a,c,d),aa(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a.k.pb,e=b.f;!ja.Sa(d,"SHADOW_CAST")&&e.yc&&(e.yc=!1);e=ma(a,Ya);c&&tb.K(b)&&tb.append_object(b,a);for(var f=0;f<e.length;f++){var g=e[f],h=b,l=d,k=a,m=c;switch(g.type){case "MAIN_OPAQUE":x(g,h,l,"OPAQUE",k,m);break;case "MAIN_BLEND":x(g,h,l,"BLEND",k,m);break;case "MAIN_XRAY":x(g,
h,l,"XRAY",k,m);break;case "MAIN_GLOW":x(g,h,l,"GLOW",k,m);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var H=h.f,n=xa.Ma(h,k).T,q=0;q<n.length;q++){var r=n[q];if(("MAIN"==r.type||"PARTICLES"==r.type)&&"REFLECT"==r.Ua){if("MAIN_PLANE_REFLECT"==g.type){var u;a:{u=k.k.vi.Ff;for(var p=0;p<u.length;p++)if(u[p]==g){u=p;break a}u=null}if(u==H.Sc)continue}else{a:{if(k.k.vi)for(u=k.k.vi.jf,p=0;p<u.length;p++)if(u[p]==g){u=p;break a}u=null}if(u==H.hd)continue}m||(V(r,g,h,l,"REFLECT",k),u=r.ab,
pa.H(u,"DISABLE_FOG",0),pa.H(u,"WATER_EFFECTS",0),"special_skydome.glslf"==pa.$s(u)&&pa.H(u,"REFLECTION_PASS",1),pa.H(u,"TEXTURE_NORM",0),Y.ub(r),U(r));g.p.push(K(H,r))}}break;case "DEPTH":H=xa.Ma(h,k).T;for(n=0;n<H.length;n++)q=H[n],"DEPTH"!=q.type||q.xc||"DEPTH"!=q.Ua&&"NODES"!=q.Ua||(m||(V(q,g,h,l,"DEPTH",k),Y.ub(q),U(q)),g.p.push(K(h.f,q)),w(l,g,q),aa(q));break;case "SHADOW_CAST":H=!1;n=h.f;h=xa.Ma(h,k).T;q=ja.Sa(l,"GRASS_MAP");for(r=0;r<h.length;r++)u=h[r],"DEPTH"==u.type&&"SHADOW_CAST"==u.Ua&&
(H=!0,m||(p=g.dk,Y.la(u,"NUM_LIGHTS",p),Y.la(u,"NUM_LFACTORS",0==p%2?p/2:Math.floor(p/2)+1),pa.H(u.ab,"SHADOW_USAGE","SHADOW_CASTING"),u.Fb&&q&&ba(u,q,n),Y.la(u,"SHADOW_TEX_RES",pa.r(k.k.bc.csm_resolution)),Y.ub(u),U(u)),g.p.push(K(n,u)));H&&(h=k.k.bc,k=ja.Sa(l,"MAIN_OPAQUE"),X(g,k.j,g.p,h,!0));break;case "COLOR_PICKING":Q(g,h,l,k,m);break;case "COLOR_PICKING_XRAY":Q(g,h,l,k,m);break;case "OUTLINE_MASK":l=h.f;h=xa.Ma(h,k).T;for(k=0;k<h.length;k++)H=h[k],"COLOR_ID"==H.type&&"OUTLINE"==H.Ua&&(m||(Y.la(H,
"USE_OUTLINE",1),Y.ub(H),U(H)),g.p.push(K(l,H)));break;case "GRASS_MAP":l=h.f;h=xa.Ma(h,k).T;for(k=0;k<h.length;k++)H=h[k],"GRASS_MAP"==H.type&&(m||(Y.ub(H),U(H)),g.p.push(K(l,H)),H=g.j,u=l.nb,n=g.qc[0],q=g.qc[1],r=g.qc[2],0==n&&0==q?(n=u.min_y,q=u.max_y):(n=Math.min(n,u.min_y),q=Math.max(q,u.max_y)),u=1E-4*(q-n),g.qc[0]=n-u,g.qc[1]=q+u,L.Cm(H,r/2,-q,-n,r/2),L.Kf(H));break;case "WIREFRAME":for(H=h.f,h=xa.Ma(h,k).T,k=0;k<h.length;k++)n=h[k],"WIREFRAME"==n.type&&T(g,H,l,m,n)}}break;case "LAMP":ca(b,
a)}xa.Tp(b,!0,a)};a.Up=function(a){a.k.hm=!0};a.cB=function(a,b){for(var c=a.k.bc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=L.Qz(c,b,e);return d};a.JG=T;a.hide_object=function(a){a.f.Wh=!0};a.show_object=function(a){a.f.Wh=!1};a.is_hidden=function(a){return a.f.Wh};a.sD=function(a,b,c){b=b.f;a=ma(a,Ya);for(var d=0;d<a.length;d++)for(var e=a[d].p,f=e.length-1;0<=f;f--){var g=e[f];g.Ed==b&&(g.C&&c&&hb.Xr(g.C.R),e.splice(f,1))}};a.Wf=ca;a.cleanup=function(){for(var a=0;a<Ua.length;a++){var b=
Ua[a];ua.V(b.k.pb,function(a,b){if("SINK"!=b.type){var c=b.j;Ba.vD(c.Ce,c.sb,c.jd,c.width,c.height);for(var c=b.p,d=0;d<c.length;d++){var e=c[d].C;e&&Y.dz(e)}}});b.k.pb=[];b.k.eh=[]}Ib=Yb=null;Ua.length=0;Zb=null};a.St=function(a,b,c){a=L.sA(a,a.ib,a.hb,null,!0);var d=Da.MA(a);a=xa.Fh("DYNAMIC");a.nb=a.Kb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.Lb=a.gd=sa.vy();var e=a.Lb.Pa;a.ng=a.cf=sa.ul([e,0,0],[0,e,0],[0,0,e],a.Lb.G);c=Y.Gz(d,c);b.p.push(K(a,c))};a.MH=function(a){return[a.frame_start,
a.frame_end]};a.Wu=function(a,b,c){la.gE(a,b,c);Ib&&na(Ib,a,b)};a.vv=ma;a.ea=W;a.get_environment_colors=function(a){a=ma(a,pb)[0];var b=a.rf,c=a.eg,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.nf,d,e]};a.set_environment_colors=function(a,b,c,d){a=ma(a,pb);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.nf=b);c&&f.rf.set(c);d&&f.eg.set(d);f.wa=!0}};a.get_sky_params=function(a){if(a=W(a,"SKY")){var b={};b.color=Array(3);Ta.copy(a.Ai,b.color);b.procedural_skydome=
a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=
W(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.Ai.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&
(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.wa=!0,c.gm=!0,oa(a,c))};a.get_fog_color_density=
function(a,b){var c=b||[],d=ma(a,Gc)[0].dc;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=ma(a,Gc),d=0;d<c.length;d++){var e=c[d];e.dc.set(b);e.wa=!0}};a.get_ssao_params=function(a){var b=W(a,"SSAO");a=W(a,"SSAO_BLUR");if(!b)return null;var c=b.p[0].C,d={};d.ssao_quality=Y.Gb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.Gr=a.ssao_blur_discard_value;d.radius_increase=b.Ei;d.influence=b.Di;d.dist_factor=
b.Ci;d.ssao_only=b.ssao_only;d.ssao_white=Y.Gb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=W(a,"SSAO"),d=W(a,"SSAO_BLUR");if(!c)return ta.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.p[0].C;Y.la(e,"SSAO_QUALITY",b.ssao_quality);Y.ub(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.p[0].C,Y.la(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),Y.ub(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.p[0].C,Y.la(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),
Y.ub(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.Ei&&(c.Ei=b.Ei);"number"==typeof b.Di&&(c.Di=b.Di);"number"==typeof b.Ci&&(c.Ci=b.Ci);if("number"==typeof b.ssao_only){c=W(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.p.length;f++)e=c.p[f].C,Y.la(e,"SSAO_ONLY",b.ssao_only),Y.ub(e,!0)}"number"==typeof b.ssao_white&&(e=c.p[0].C,Y.la(e,"SSAO_WHITE",b.ssao_white),Y.ub(e,!0));c.wa=!0;d.wa=!0};a.get_dof_params=function(a){a=
W(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;b.ye=a.j.ye;return b};a.set_dof_params=M;a.get_god_rays_params=function(a){var b=ma(a,["GOD_RAYS"]);a=W(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].ei;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=Y.Gb(b[0].p[0].C,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=ma(a,["GOD_RAYS"]),
d=W(a,"GOD_RAYS_COMBINE");if(!c||!d)return ta.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].ei=e,c[f].vm=e/c[f].Ii/(f+1),c[f].wa=!0;if("number"==typeof b.god_rays_steps)for(var g=pa.r(b.god_rays_steps,1),e=c[0].ei,f=0;f<c.length;f++){c[f].Ii=g;c[f].vm=e/g/(f+1);c[f].wa=!0;var h=c[f].p[0].C;Y.la(h,"STEPS_PER_PASS",
g);Y.ub(h,!0)}d.wa=!0};a.get_bloom_params=function(a){var b=W(a,"LUMINANCE_TRUNCED");a=W(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=O;a.get_glow_material_params=function(a){a=W(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=
a.large_glow_mask_width;return b};a.set_glow_material_params=S;a.get_wind_params=function(a){a=da(a);var b=Ta.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.KD=function(a){a.k.op=!0};a.get_water_surface_level=ra;a.get_water_mat_params=function(a,b){var c=W(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.cg,b.waves_length=c.uh,c.Ld)){b.water_fog_density=c.Ld[3];var d=b.water_fog_color=[];d[0]=c.Ld[0];d[1]=c.Ld[1];d[2]=c.Ld[2]}};a.set_water_params=
function(a,b){var c=W(a,"MAIN_OPAQUE");if(!c||!c.rb)return ta.error("set_water_params() - no water parameters on the scene"),null;c=c.rb;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);
"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Cj=b.water_dynamic);for(var d=ma(a,Mc),e=0;e<d.length;e++){var f=
d[e];"number"==typeof b.water_fog_density&&c.dc&&(f.Ld[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.dc&&f.Ld.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.cg=b.waves_height);"number"==typeof b.waves_length&&(f.uh=b.waves_length);f.wa=!0}};a.get_shore_dist=function(a,b){var c=W(Ib,"MAIN_OPAQUE");if(!c.Tm)return 100;var d=c.fi,e=c.bg,f=(a[0]-c.Mf[0])/c.Nf[0],g=(c.Mf[1]+a[2])/c.Nf[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*La.Us(Ib.k.Yp,c.zi,f,g),e=(e-a[1])*
b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var d=c().gg.f,e=0;e<Ua.length;e++){var f=Ua[e],g=f.k.pb,h=f.k;if(h.rb)var l=d.i[1]-ra(d.i[0],d.i[2]);for(var k=0;k<h.Xi.length;k++){var m=h.Xi[k].k,H=m.M,n=m.$b;if(!(f.b4w_use_nla&&m.Hq||!H&&!n)&&Bb.bw(m)){var q=Bb.VF(m),r=Bb.XF(m);H&&Ia.uf&&(r-=5);var u=Bb.WF(m);!m.Qi&&q>=u?Bb.pause_video(m.name,m.Cc):(n&&q>=u&&(q=m.ih=0),q<r&&Bb.reset_video(m.name,m.Cc),Bb.cw(m)&&(H?Bb.Eq(m):(H=Bb.Ru(m,a),H!=m.zm&&(Bb.Nv(m),m.ih++),m.zm=H)))}}ua.V(g,function(b,
c){-1<Wc.indexOf(c.type)&&(c.time=a);h.rb&&(c.En=l)})}for(e=0;e<Ua.length;e++)if(f=Ua[e],h=f.k,g=h.pb,d=h.eh,d.length)for(h.hm&&(ea(f),h.hm=!1),h.op&&(fa(f),h.op=!1),h.pp&&(R(f),h.pp=!1),h.Ug&&ka(g,b),f=ja.Sa(g,"OUTLINE_MASK"),k=0;k<d.length;k++)g=d[k],Sb.Ep(g),f&&P(g,f),Ba.Bj(g);Ia.show_hud_debug_info&&ya.kE(Ua,b)};a.zD=function(a){a.k.pp=!0};a.zo=function(a){var b=[];ua.V(a.k.pb,function(a,c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=W(Ib,"MAIN_BLEND"),b=Ib;return a||b.k.rb?a.En:
null};a.get_object_data_id=function(a){return a.f.oc};a.Dq=function(a){ua.V(a.k.pb,function(a,b){b.wa=!0})};a.eE=function(a,b){a.ob=b!=H.WM_NONE;for(var c=0;c<a.p.length;c++)a.p[c].C.wireframe_mode=b;a.Ia=b==H.WM_TRANSPARENT_WIREFRAME;a.wa=!0};a.dE=function(a,b){for(var c=0;c<a.p.length;c++)a.p[c].C.wireframe_edge_color=b,a.wa=!0};a.mF=function(a,b){var c=b.Lh,d=a.k.Ue;if(c&&"WIND"==c.type&&d){La.quat_to_dir(b.f.quat,La.AXIS_Y,d);Ta.normalize(d,d);Ta.scale(d,c.sv,d);for(var c=ma(a,Wc),e=0;e<c.length;e++)c[e].Ue.set(d)}};
a.XC=function(a,b,c){var d=W(a,"COLOR_PICKING");if(d)return b=la.Gn(b,c,Jb,d.j),Sb.Ep(d),Ba.Bj(d),(a=W(a,"COLOR_PICKING_XRAY"))?(Sb.Ep(a),Ba.Bj(a),d=a.j):d=d.j,b[1]=d.height-b[1],Ba.Gu(d.Ce,b[0],b[1]);ta.error("Object Selection is not available on the scene");return null};a.set_outline_color=function(a){var b=c();if(b=W(b,"OUTLINE"))b.Le.set(a),b.wa=!0};a.RH=da;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};
a.Iv=function(a,b){var c=Bc;Ta.negate(b,c);for(var d=0;6>d;d++){var e=a.vj[d],f=a.Wn[d],g=a.j;wa.translate(La.qw[d],c,e);wa.multiply(g.Ba,e,g.Kd);La.Hl(g.Kd,f)}};a.Lv=function(a,b,c){La.SE(b,c,La.AXIS_Y,a.j.ic)};a.py=function(a,b,c){var d=a.k.bc,e=a.k.vi;c=xa.Co(c)||c[0];for(var f=0;f<b.length;f++){var g=b[f],h=xa.Ma(g,a);if(e)if(null!=g.f.Sc){var l=e.Ff;if(l.length){var k=g.f.Sc;h.Ff=l[k]}}else null!=g.f.hd&&(l=e.jf,l.length&&(k=g.f.hd,h.jf=l[k]));d&&g==c&&(h.$u=ma(a,["SHADOW_CAST"]))}};a.marker_frame=
function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,p){function d(a,b){for(var c=a.xd,e=0;e<c.length;e++)c[e].Fd.Ik&&b.push(c[e]),d(c[e],b)}function c(a,b,c){for(var d=a.bb.p,e=0;e<d.length;e++)for(var f=d[e].m,g=0;g<f.nc.length;g++){var h=f.nc[g];"ANY"!=h.gb&&c!=h.gb||A(h,a,b)}}function b(a,b,c){if(x.Wl(a))switch(b){case x.zw:var d=k(a);d.bb.jw=!0;x.w(a,x.gx,Date.now()-performance.now(),oa.Dd,oa.Cn?ha.Ls:0);break;case x.Aw:aa.gp("URANIUM:",c.slice(1));break;case x.vw:aa.error(c);break;case x.ww:K.fbmsg.apply(this,c.slice(1));
break;case x.Fw:var e=f(c.v);if(e){a=c.i;d=c.quat;b=c.Yd;var g=c.Nd,e=e.m;e.yl=c.time;X.set_sep(a,1,d,e.Yn);T.copy(b,e.Yd);T.copy(g,e.Nd)}break;case x.Cw:(a=f(c.Hn))&&X.set_sep(c.i,1,c.quat,a.l.ok[c.Gp]);break;case x.xw:if(d=f(c[1]))a=c[4],d=d.ld.jl[c[2]],R.set_translation(d,c[3]),R.set_rotation(d,a),R.o(d);break;case x.Gw:if(e=f(c[1]))e.l.speed=c[2];break;case x.rw:d=k(a);n(d,c.og,c.pg,c.result,null,null,0);break;case x.tw:d=k(a);n(d,c.og,c.pg,c.result,c.ug,c.coll_norm,c.coll_dist);break;case x.sw:if(e=
f(c[1]))a=e.m,a.tg&&a.tg(c[2]);break;case x.Yq:case x.Dw:d=k(a);if(a=d.bb.Hf[c.id])if(d=f(c.Ch),b==x.Yq)b=a.callback,b(a.id,c.hit_fract,d,c.hit_time);else{b=c.hit_fract;var g=c.hit_time,e=c.hit_pos,h=a.callback;e?h(a.id,b,d,g,e,c.hit_norm):h(a.id,b,d,g)}break;case x.Ew:y(id);break;case x.Bw:a=W.indexOf(a);console.log("Physics #"+a+" Ping: OUT "+(c[2]-c[1]).toFixed(3)+" ms, IN "+(performance.now()-c[2]).toFixed(3)+" ms, ALL "+(performance.now()-c[1]).toFixed(3)+" ms");break;case x.yw:ma=c[1];break;
case x.uw:a=W.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:aa.error("Wrong message: "+b)}}function k(a){for(var b=0;b<W.length;b++)if(W[b]==a)return M[b]}function f(a){return O[a]||null}function n(a,b,c,d,e,g,h){a=a.bb.p;for(var k=0;k<a.length;k++)for(var m=a[k].m,n=0;n<m.nc.length;n++){for(var q=m.nc[n],r=q.Df,u=!1,p=0;p<r.length;p++){var x=r[p];if(x[0]===b&&x[1]===c){q.hk[p]=d;u=!0;break}}u&&(r=l(q),e&&q.wn!=b&&(u=e,p=g,x=h,u[0]+=p[0]*x,u[1]+=p[1]*x,u[2]+=p[2]*x,
p[0]*=-1,p[1]*=-1,p[2]*=-1),q.callback(r,r?q.wn==b?f(c):f(b):null,e,g,h))}}function l(a){a=a.hk;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function u(){P.body++;return P.body}function e(a){if("ANY"==a)return 0;var b=ra.indexOf(a);return-1==b?(ra.push(a),ra.length-1):b}function h(a){return{v:a,Zd:0,Xl:!1,Of:!0,rc:!1,is_character:!1,NB:!1,sl:null,gb:"",pj:0,cH:{},nc:[],tg:null,yl:0,Yn:new Float32Array([0,0,0,1,0,0,0,1]),Yd:new Float32Array(3),Nd:new Float32Array(3),ml:new Float32Array(3),ll:new Float32Array(4)}}
function g(a,b){switch(a){case "BOX":var c=b.Kb;break;case "CYLINDER":c=b.qn;break;case "CONE":c=b.pn;break;case "SPHERE":c=b.gd;break;case "CAPSULE":c=b.on}return c}function q(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.G&&(b.center=
a.G);"number"===typeof a.Pa&&(b.radius=a.Pa);"number"===typeof a.height&&(b.height=a.height);return b}function z(a,b,c,d,e){var f=a.f.i,g=b.f.aa,h=new Float32Array(16);V.invert(g,h);g=new Float32Array(3);T.transformMat4(f,h,g);switch(b.l.type){case 10:b=b.Bc;a=a.f.Kb;x.w(e,x.Kw,c,g,b.LE,b.Pp,(a.max_y-a.min_y)/2,d);break;case 20:x.w(e,x.Jw,c,g,a.II)}}function G(a){return a.m&&a.m.sl}function D(a,b,c,d,e,f,g,h,l,k){var m;P.Ja++;m=P.Ja.toString(16);var n=b.m.v;x.w(B(n),x.Rw,m,a,h,n,c,d,e.m.v,f,g,l,k);
b.m.sl=m}function B(a){for(var b=0;b<M.length;b++)for(var c=M[b].bb.p,d=0;d<c.length;d++)if(c[d].m.v==a)return W[b];return null}function v(a){var b=a.m;if(b&&(0===b.Zd||!0===b.Xl||!1===b.Of||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.f.i[0]!=a.m.ml[0]||a.f.i[1]!=a.m.ml[1]||a.f.i[2]!=a.m.ml[2]||a.f.quat[0]!=a.m.ll[0]||a.f.quat[1]!=a.m.ll[1]||a.f.quat[2]!=a.m.ll[2])){var b=a.m,c=a.f;T.copy(c.i,b.ml);ba.copy(c.quat,b.ll);var d=x.dt(x.Sk);d.v=b.v;d.i=c.i;"DYNAMIC"==b.type?ba.identity(d.quat):d.quat=
c.quat;x.w(B(b.v),x.Sk)}a=a.xd;for(b=0;b<a.length;b++)v(a[b])}function E(a,b,c,d,e){e=e||new Float32Array(3);a=a.f.quat;e[0]=b;e[1]=c;e[2]=d;T.transformQuat(e,a,e)}function A(a,b,c){var d=a.Df,e=a.hk,f=a.wn,g=[],h=a.gb;if(!g)throw"At least one destination required";for(var l=0;l<b.bb.p.length;l++){var k=b.bb.p[l];if("ANY"==h||k.m.gb==h)k=k.m.v,g&&-1==g.indexOf(k)&&g.push(k)}for(b=0;b<g.length;b++)h=g[b],f<h&&!r(d,f,h)?(d.push([f,h]),e.push(!1)):f>h&&!r(d,h,f)&&(d.push([h,f]),e.push(!1));x.w(c,x.Iw,
f);x.w(c,x.Qw,d,a.Td)}function r(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function m(a){a.m&&a.m.tg&&(a=a.m,x.w(B(a.v),x.cx,a.v),a.tg=null)}function y(a){var b=J(a),c=t(a).bb;c.Hf[a]&&(delete c.Hf[a],c.Kp.splice(c.Kp.indexOf,1),x.w(b,x.lx,a))}function t(a){for(var b=0;b<M.length;b++){var c=M[b];if(c.bb.Hf[a])return c}return null}function J(a){for(var b=0;b<M.length;b++)if(M[b].bb.Hf[a])return W[b];return null}function C(a,b,c){if(b.Hi){a=a.m.v;var d=b.Kh*b.Hj,
e=b.ij*b.jj,f=-b.Fi*b.Gi*2*Math.PI/b.Ak;b.Uj&&(f*=-1);switch(b.type){case 10:x.w(c,x.yx,a,d,e,f);break;case 20:x.w(c,x.xx,a,d,e,f)}}}function I(a){return a.rc&&"CHASSIS"==a.Bc.tc}function F(a){return a.rc&&"HULL"==a.Bc.tc}function N(a){return a.Lg&&"MAIN_BODY"==a.Mh.tc}var w=p("__config");p("__constraints");var K=p("__debug"),x=p("__ipc"),V=p("__mat4"),U=p("__obj_util"),aa=p("__print"),ba=p("__quat");p("__renderer");var ea=p("__scenes"),R=p("__transform"),X=p("__tsr"),Q=p("__util"),T=p("__vec3"),
ca=p("__version"),oa=w.m,ha=w.q,na=w.Od,ma=0,W=[],M=[],O={},S=[],ra=[],P={body:0,Ja:0,Du:0},ia=new Float32Array(3),ga=new Float32Array(4),fa=new Float32Array(4),ka=new Float32Array(16),da=new Float32Array(8),Y=new Float32Array(8);a.IB=function(a){a.bb={jw:!1,p:[],Hf:{},Kp:[]};var c=oa.Gk;na.Fp&&(c+=ca.timestamp());aa.log("%cLOAD PHYSICS","color: #0a0",oa.Kk?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+oa.Dd);aa.log("%cPHYSICS PATH","color: #0a0",c);var d=x.Oz(c,!oa.Kk);x.ry(d,
b);W.push(d);M.push(a);oa.ping&&setInterval(function(){x.w(d,x.ix,performance.now())},1E3)};a.Zy=function(a){return a.bb?a.bb.jw:!0};a.cleanup=function(){for(var a=0;a<W.length;a++)x.terminate(W[a]);W.length=0;M.length=0;O={};S.length=0;ra.length=0;for(var b in P)P[b]=0};a.append_object=function(a,b){if(!a.f)throw"No object render: "+a.name;var f;a:{for(var l=0;l<M.length;l++)if(M[l]==b){f=W[l];break a}f=void 0}var k=[];a.Fd.Ik&&d(a,k);var m=b.bb.p;if(I(a)||F(a)||a.is_character||N(a)||a.Si){var n,
r=a,p=f,t=r.Ha,v=r.f,w=r.Fd,y=w.pm,B=u();if("CAMERA"==r.type)var A=w.Fq?w.ol:"BOX",P=g(A,v),E=v.Kj,ra=v.Ej,E=.5,ra=0;else"EMPTY"==r.type?(A="EMPTY",P=null,ra=E=0):(A=w.Fq?w.ol:"BOX",P=g(A,v),E=v.Kj,ra=v.Ej);var K=v.i,J=v.quat,ia=w.Jk,ga=w.Rv,na=w.Zd,R=w.Wv,ma=w.Vv,Y=w.$n,da=w.Rp,ca=t.b4w_collision_id,X=e(ca),ha=w.qj,oa=w.oj,Ib=w.rj,Ua=v.gd.Pa,Zb=q(P),Xc=t.b4w_correct_bounding_offset,Jb;var Bc=A;if(k.length){var Oc=[],rc={};rc.quat=new Float32Array([0,0,0,1]);rc.trans=new Float32Array(3);rc.worker_bounding=
Zb;rc.bounding_type=Bc;Oc.push(rc);V.invert(v.aa,ka);ba.invert(v.quat,fa);for(var Pc=0;Pc<k.length;Pc++){var dc={},Tb=k[Pc],Ub=Tb.Fd.ol,Cc=new Float32Array(4),kc=new Float32Array(3);T.transformMat4(Tb.f.i,ka,kc);ba.multiply(fa,Tb.f.quat,Cc);dc.trans=kc;dc.quat=Cc;dc.bounding_type=Ub;dc.worker_bounding=q(g(Ub,Tb.f));Oc.push(dc)}Jb=Oc}else Jb=[];x.w(p,x.Nw,B,K,J,y,ia,ga,na,R,ma,Y,da,X,ha,oa,Ib,A,Zb,Ua,E,ra,Jb,Xc);O[B]=r;S.push(r);var Dc=h(B);Dc.type=y;Dc.Zd=na;Dc.Xl=ia;Dc.gb=ca;Dc.pj=X;n=Dc;a.m=n;var ad=
{C:null,m:n};m.push(ad);c(b,f,n.gb)}else for(var ed=U.Ma(a,b).T,Vb=0;Vb<ed.length;Vb++){var jb=ed[Vb],$a;if($a="PHYSICS"==jb.type){var Ja;a:{for(var ec=b.bb.p,ub=0;ub<ec.length;ub++){var Aa=ec[ub].C;if(Aa&&Aa.id==jb.id){Ja=!0;break a}}Ja=!1}$a=!Ja}if($a)if(jb.Xc.P)if(jb.ag&&b.k.rb){var qb=jb,Z=b,db=f,Ca=ea.ea(Z,"MAIN_OPAQUE");x.w(db,x.Ww,Ca.bg);if(Ca.rb&&qb.bG){var va={};va.dst_noise_scale0=qb.dst_noise_scale0;va.dst_noise_scale1=qb.dst_noise_scale1;va.dst_noise_freq0=qb.dst_noise_freq0;va.dst_noise_freq1=
qb.dst_noise_freq1;va.dir_min_shore_fac=qb.dir_min_shore_fac;va.dir_freq=qb.dir_freq;va.dir_noise_scale=qb.dir_noise_scale;va.dir_noise_freq=qb.dir_noise_freq;va.dir_min_noise_fac=qb.dir_min_noise_fac;va.dst_min_fac=qb.dst_min_fac;va.waves_hor_fac=qb.waves_hor_fac;var Fa=Ca.cg,Ga=Ca.uh;Ca.Tm?x.w(db,x.$q,va,Ca.Nf[0],Ca.Nf[1],Ca.Mf[0],Ca.Mf[1],Ca.fi,Fa,Ga,Ca.zi,Z.k.Yp):x.w(db,x.$q,va,0,0,0,0,0,Fa,Ga,0,null)}}else{var fc;if(jb.Jk){var Xa=a,lb=jb,Lb=f,Cb=u(),sc=lb.Xc,Wb=sc.B[0].a_position,$b=sc.pa||null,
ab=lb.gb,vb=e(ab);x.w(Lb,x.Tw,Cb,Wb,$b,Xa.f.i,vb,lb.qj,lb.oj,lb.rj);var gc=h(Cb);gc.Xl=!0;gc.gb=ab;gc.pj=vb;fc=gc}else{var Ec=a,Mb=jb,rb=f,sb=u(),Qa=Mb.Xc,Va=Qa.B[0].a_position,Db=Qa.pa||null,hc=Ec.f.i,tc=Mb.Kj,eb=Mb.Ej,uc=Mb.gb,Nb=e(uc);x.w(rb,x.Vw,sb,Va,Db,hc,tc,eb,Nb,Mb.qj,Mb.oj,Mb.rj);var fb=h(sb);fb.gb=uc;fb.pj=Nb;fc=fb}n=fc;ad={C:jb,m:n};m.push(ad);c(b,f,n.gb)}else aa.error("Object "+a.name+" has collision material with no assigned vertices")}if(I(a)||F(a)){var Ma=a,wb=f,gb=Ma.m.v;I(Ma)?(Ma.l.type=
10,x.w(wb,x.Ow,gb,Ma.l.nq,Ma.l.pq,Ma.l.oq,Ma.l.Rq,Ma.l.kp)):F(Ma)&&(Ma.l.type=20,x.w(wb,x.Mw,gb,Ma.l.Dg,Ma.l.sh,Ma.l.th));if(Ma.l.dh){var Oa=Ma.l.dh;switch(Ma.l.type){case 10:z(Oa[1],Ma,gb,!0,wb);z(Oa[0],Ma,gb,!0,wb);z(Oa[3],Ma,gb,!1,wb);z(Oa[2],Ma,gb,!1,wb);break;case 20:for(var Ha=0;Ha<Oa.length;Ha++)z(Oa[Ha],Ma,gb,!1,wb)}}C(a,a.l,f)}else if(a.is_character){var mb=f,za=a.f,nb=a.m,ob=za.Kb.max_y-za.Kb.min_y,xb=nb.v,Na=a.Rr,Ob=Na.aG,bb=Na.FD,lc=Na.CE,Xb=Na.WB,Eb=Na.cG,Fb=Q.dA(a);x.w(mb,x.Pw,xb,Fb,
ob,Ob,bb,lc,Xb,Eb);nb.is_character=!0}else if(N(a)){var kb=a,Kb=f,ac=kb.m.v;x.w(Kb,x.Sw,ac,kb.ld.Dg,kb.ld.sh,kb.ld.th);if(kb.ld.jl)for(var Za=kb.ld.jl,Ea=0;Ea<Za.length;Ea++){var Pa=Za[Ea],mc=Pa.f.i,Gb=kb.f.aa,Pb=new Float32Array(16);V.invert(Gb,Pb);var yb=new Float32Array(3);T.transformMat4(mc,Pb,yb);x.w(Kb,x.Lw,ac,yb,Pa.Ay)}kb.m.NB=!0}for(Vb=0;Vb<S.length;Vb++)if(a=S[Vb],a.m){var Ra=a;if(!G(Ra))for(var ic=0;ic<Ra.Cp.length;ic++){var cb=Ra.Cp[ic],zb=cb.target,vc=cb.YC;if(zb.m){var nc=new Float32Array([cb.ZC,
cb.$C,cb.aD]),bc,cc=new Float32Array([cb.Pd,cb.Qd,cb.Rd]);bc=Q.euler_to_quat(cc,new Float32Array(4));var jc=V.fromRotationTranslation(bc,nc,new Float32Array(16)),wc=V.multiply(Ra.f.aa,jc,new Float32Array(16)),Hc=V.invert(zb.f.aa,new Float32Array(16)),xc=V.multiply(Hc,wc,Hc),oc=Q.ci(xc),Ab=Q.matrix_to_quat(xc),Ka=cb,Wa={};Wa.use_limit_x=Ka.EF;Wa.use_limit_y=Ka.FF;Wa.use_limit_z=Ka.GF;Wa.use_angular_limit_x=Ka.zF;Wa.use_angular_limit_y=Ka.AF;Wa.use_angular_limit_z=Ka.BF;Wa.limit_max_x=Ka.fC;Wa.limit_min_x=
Ka.iC;Wa.limit_max_y=Ka.gC;Wa.limit_min_y=Ka.jC;Wa.limit_max_z=Ka.hC;Wa.limit_min_z=Ka.kC;Wa.limit_angle_max_x=Ka.$B;Wa.limit_angle_min_x=Ka.cC;Wa.limit_angle_max_y=Ka.aC;Wa.limit_angle_min_y=Ka.dC;Wa.limit_angle_max_z=Ka.bC;Wa.limit_angle_min_z=Ka.eC;D(vc,Ra,nc,bc,zb,oc,Ab,Wa,null,null)}}}};a.yA=f;a.update=function(a,b){for(var c=0;c<W.length;c++){var d=W[c],e=a;d&&x.Bt(d)&&x.w(d,x.zx,e,b);for(var f=0;f<S.length;f++){var g=S[f],h=g.m;if(h.Of&&h.yl){var l=x.Bt(d)?e-h.yl:performance.now()/1E3-h.yl,
l=Math.min(l,10/oa.Dd),l=l-1/oa.Dd;ha.LC&&(l=0);var k=da;X.JB(h.Yn,l,h.Yd,h.Nd,da);R.set_tsr(g,k);R.o(g);v(g);if(g.l)for(var h=g,l=h.l.dh,k=h.f.za,m=da,n=0;n<l.length;n++){var q=l[n];X.multiply(k,h.l.ok[n],m);R.set_tsr(q,m);R.o(q)}g.l&&g.l.Hi&&(h=g.l,l=h.Hi)&&(k=g.l.pv,q=ka,m=g.f.i,n=g.f.quat,Q.xq(g.l.qv,n,m,q),Q.ci(q,l.f.i),Q.matrix_to_quat(q,l.f.quat),q=ga,Q.yq(k,n,m,q),k=fa,ba.setAxisAngle(q,-h.Fi*h.Gi*2*Math.PI,k),ba.multiply(k,l.f.quat,l.f.quat),R.o(l));g.l&&g.l.gq&&(h=g.l,l=h.gq)&&(m=g.l.lv,
k=ka,n=g.f.i,q=g.f.quat,Q.xq(g.l.mv,q,n,k),Q.ci(k,l.f.i),Q.matrix_to_quat(k,l.f.quat),k=ga,Q.yq(m,q,n,k),m=fa,n=Math.abs(h.speed)*h.xk,n>h.gi&&(n=h.gi),ba.setAxisAngle(k,-n,m),ba.multiply(m,l.f.quat,l.f.quat),R.o(l));g.l&&g.l.qq&&(h=g.l,l=h.qq)&&(k=g.l.zv,q=ka,m=g.f.i,n=g.f.quat,Q.xq(g.l.Av,n,m,q),Q.ci(q,l.f.i),Q.matrix_to_quat(q,l.f.quat),g=ga,Q.yq(k,n,m,g),k=fa,ba.setAxisAngle(g,-Math.abs(h.Kh)*h.xj,k),ba.multiply(k,l.f.quat,l.f.quat),R.o(l))}}x.fD(d);d=ea.ea(M[c],"MAIN_OPAQUE");d.rb&&0<d.rb.waves_height&&
(e=T.length(d.Ue),x.w(W[c],x.wx,d.time*e))}};a.TA=function(){return M[0]};a.pause=function(){for(var a=0;a<W.length;a++)x.w(W[a],x.hx)};a.resume=function(){for(var a=0;a<W.length;a++)x.w(W[a],x.mx)};a.enable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(!a.Of){var b=a.v,c=B(b);a.Of=!0;x.w(c,x.fx,b)}};a.disable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(a.Of){var b=a.v,c=B(b);a.Of=!1;x.w(c,x.ex,b)}};a.ym=function(a){return Boolean(a.bb)};a.K=function(a){return Boolean(a.m)};
a.has_dynamic_physics=function(a){return(a=a.m)&&a.Of&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.Zd&&0==a.Xl?!0:!1};a.has_simulated_physics=function(a){return(a=a.m)&&a.Of?!0:!1};a.set_gravity=function(a,b){var c=a.m.v;x.w(B(c),x.vx,c,b)};a.AB=G;a.apply_constraint=D;a.clear_constraint=function(a){a=a.m;x.w(B(body_a),x.kx,a.sl);a.sl=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=X.create_sep(c,1,d,da);f=X.create_sep(f,1,g,Y);X.invert(c,c);X.multiply(f,c,c);R.get_tsr(e,f);X.multiply(f,
c,c);R.set_tsr(b,c);R.o(b);a.set_transform(b,b.f.i,b.f.quat)};a.set_transform=function(a,b,c){var d=a.m;X.set_sep(a.f.i,1,a.f.quat,d.Yn);a=x.dt(x.Sk);a.v=d.v;a.i=b;a.quat=c;x.w(B(d.v),x.Sk)};a.sync_transform=v;a.apply_velocity=function(a,b,c,d){E(a,b,c,d,ia);a=a.m.v;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(ia[0]),f=Math.abs(ia[1]),g=Math.abs(ia[2]);ia[0]=e?ia[0]/e*Math.max(e,b):0;ia[1]=f?ia[1]/f*Math.max(f,c):0;ia[2]=g?ia[2]/g*Math.max(g,d):0;x.w(B(a),x.br,a,ia[0],ia[1],ia[2])};a.apply_velocity_world=
function(a,b,c,d){a=a.m.v;x.w(B(a),x.br,a,b,c,d)};a.apply_force=function(a,b,c,d){E(a,b,c,d,ia);a=a.m.v;x.w(B(a),x.Xw,a,ia[0],ia[1],ia[2])};a.apply_torque=function(a,b,c,d){E(a,b,c,d,ia);a=a.m.v;x.w(B(a),x.Zw,a,ia[0],ia[1],ia[2])};a.set_character_move_dir=function(a,b,c){a=a.m.v;x.w(B(a),x.px,a,b,c)};a.set_character_move_type=function(a,b){var c=a.m.v;x.w(B(c),x.qx,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.m.v;x.w(B(c),x.ux,c,b)};a.set_character_run_velocity=function(a,b){var c=a.m.v;
x.w(B(c),x.sx,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.m.v;x.w(B(c),x.nx,c,b)};a.character_jump=function(a){a=a.m.v;x.w(B(a),x.ax,a)};a.character_rotation_inc=function(a,b,c){a=a.m.v;x.w(B(a),x.bx,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.m.v;x.w(B(a),x.rx,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.m.v;x.w(B(c),x.ox,c,b)};a.set_character_rotation_v=function(a,b){var c=a.m.v;x.w(B(c),x.tx,c,b)};a.append_collision_test=function(a,b,c,d){var e=a.m,f=e.v;b=b||
"ANY";for(var g=0;g<e.nc.length;g++)if(a=e.nc[g],a.gb==b&&a.callback==c)return;a={wn:f,Td:d||!1,gb:b,callback:c,Df:[],hk:[]};e.nc.push(a);b=B(f);A(a,k(b),b)};a.remove_collision_test=function(a,b,c){a=a.m;for(var d=B(a.v),e=k(d),f=0;f<a.nc.length;f++){var g=a.nc[f];if(g.gb==b&&g.callback==c){if(l(g)){var h=T.set(0,0,0,ia);g.callback(!1,null,h,h,0)}a.nc.splice(f,1);f--;for(var h=d,g=g.Df,m=e.bb.p,n=0;n<m.length;n++)for(var q=m[n].m,r=0;r<q.nc.length;r++)for(var u=q.nc[r],p=0;p<u.Df.length;p++)for(var t=
u.Df[p],v=0;v<g.length;v++){var w=g[v];t[0]==w[0]&&t[1]==w[1]&&(g.splice(v,1),v--)}g.length&&x.w(h,x.ar,g)}}};a.apply_collision_impulse_test=function(a,b){a.m&&a.m.tg&&m(a);var c=a.m;x.w(B(c.v),x.Yw,c.v);c.tg=b};a.clear_collision_impulse_test=m;a.append_ray_test=function(a,b,c,d,f,g,h,l,m){var n;P.Du++;n=P.Du;d=d||"ANY";a={id:n,v:a?a.m.v:0,from:new Float32Array(b),to:new Float32Array(c),gb:d,pj:e(d),zr:g,Dy:h,Td:l,Sl:m,callback:f};b=B(a.v)||W[0];c=k(b).bb;n=a.id;c.Hf[n]=a;c.Kp.push(a);x.w(b,x.Uw,
a.id,a.v,a.from,a.to,a.pj,a.zr,a.Dy,a.Td,a.Sl);return n};a.remove_ray_test=y;a.change_ray_test_from_to=function(a,b,c){var d=J(a),e=t(a).bb.Hf[a];e&&!e.zr&&(e.from.set(b),e.to.set(c),x.w(d,x.$w,a,b,c))};a.Ct=function(a){return t(a).bb.Hf[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.l;c.Kh=b;C(a,c,B(a.m.v))};a.vehicle_steer=function(a,b){var c=a.l;c.Fi=b;C(a,c,B(a.m.v))};a.vehicle_brake=function(a,b){var c=a.l;c.ij=b;C(a,c,B(a.m.v))};a.is_vehicle_chassis=I;a.is_vehicle_hull=F;a.MB=function(a){if(!a.rc)return!1;
a=a.Bc.tc;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.KB=function(a){return a.rc?"BOB"==a.Bc.tc?!0:!1:!1};a.OB=function(a){return a.Lg?"BOB"==a.Mh.tc?!0:!1:!1};a.Ft=function(a){return a.rc&&"STEERING_WHEEL"==a.Bc.tc?!0:!1};a.Et=function(a){return a.rc&&"SPEEDOMETER"==a.Bc.tc?!0:!1};a.Gt=function(a){return a.rc&&"TACHOMETER"==a.Bc.tc?!0:!1};a.get_vehicle_speed=function(a){return a.l.speed};a.eG=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;
case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.fI=N;a.hB=function(){return ma};a.Wz=function(){for(var a=0;a<W.length;a++)x.w(W[a],x.dx)};a.rD=function(a){var b=S.indexOf(a);-1==b&&aa.error("Object "+a.name+" doesn't have bounding physics");for(var c=a.m.v,d=B(c),e=k(d),f=e.bb.p,g=[],h=0;h<f.length;h++)for(var n=f[h].m,q=0;q<n.nc.length;q++)for(var r=n.nc[q],u=0;u<r.Df.length;u++){var p=r.Df[u],
t=r.hk[u];if(p[0]==c||p[1]==c)r.Df.splice(u,1),r.hk.splice(u,1),u--,t&&!l(r)&&(t=T.set(0,0,0,ia),r.callback(!1,null,t,t,0)),g.push(p)}g.length&&x.w(d,x.ar,g);a.m&&a.m.tg&&m(a);delete O[c];S.splice(b,1);a=e.bb.p;for(b=0;b<a.length;b++)a[b].m.v==c&&(a.splice(b,1),b--);x.w(d,x.jx,c)}};b4w.module.__data=function(a,p){function d(a,b){La[b.id]=null;Ta[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=P.jt(a));d=a.width;a=a.height;H.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Ia)&&c&&H.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,f){d=b.s;if(!d)throw"Nothing requested";M.enqueue([[d,M.AT_JSON,d]],function(d,f,g,h){if(d){H.log("%cLOAD METADATA","color: #616",h);f=Da.rv(d.b4w_format_version);
switch(Da.Xv(f,Ba.Tg)){case -1:f[0]<Ba.Tg[0]?Da.ba("JSON version is too old relative to B4W engine: "+Da.Yf(f)+", required: "+Da.Yf(Ba.Tg)+". Reexport scene with the latest B4W addon to fix it."):H.warn("JSON version is a bit old relative to B4W engine: "+ +Da.Yf(f)+", required: "+Da.Yf(Ba.Tg)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:f[0]>Ba.Tg[0]?Da.ba("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):
H.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Ba.fp=f;for(var l in d)a[l]=d[l];0===b.id&&(ib=a);(d=a.binaries[0].binfile)?b.Dr=d:(ga.aq(b,"load_binaries"),ga.aq(b,"prepare_bindata"));a==ib||ga.aq(b,"start_nla");d=a==ib;if(a.b4w_export_errors)for(l=0;l<a.b4w_export_errors.length;l++)f=a.b4w_export_errors[l],(d&&"PRIMARY"==f.type||"ALL"==f.type)&&H.oA(f.text);d=a==ib;if(a.b4w_export_warnings)for(l=0;l<a.b4w_export_warnings.length;l++)f=
a.b4w_export_warnings[l],(d&&"PRIMARY"==f.type||"ALL"==f.type)&&H.pA(f.text);e(b,c)}else ga.jr(b)},null,function(a){f(b,c,a)})}function k(a,b,c,d,e,f){d=T(b.s)+b.Dr;if(!d)throw"Binary data is missing";M.enqueue([[d,M.AT_ARRAYBUFFER,d]],function(d,f,g,h){d?(H.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,d=l(d),f=Da.rv(a.b4w_format_version),d[0]!=f[0]&&Da.ba("BIN version does not match to JSON version: "+Da.Yf(d)+", required: "+Da.Yf(Ba.Tg)+". Couldn't load the scene. Reexport scene to fix it."),
d[1]!=f[1]&&H.warn("BIN version does not match to JSON version: "+ +Da.Yf(d)+", required: "+Da.Yf(Ba.Tg)+". Some compatibility issues can occur. Reexport scene to fix it."),e(b,c)):ga.jr(b)},null,function(a){f(b,c,a)})}function f(a,b,c,d,e){Sa.Xy()&&e(b,c)}function n(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],g=a.objects,h=a.meshes;a=a.actions;for(var k=Da.Ty(),m=l(d),m=5<=m[0]&&4<m[1]?12:0,n=["indices"],q=["normal","tangent"],H=["color","group"],r=["position","texcoord","texcoord2"],p=0;p<h.length;p++)for(var t=
h[p].submeshes,x=0;x<t.length;x++)for(var v in t[x]){var w=t[x][v][1];if(-1!=n.indexOf(v)){var M=4*t[x][v][0]+f["int"]+m,hb=t[x],ya=v,z=d;if(k)var O=new Uint32Array(z,M,w);else for(var O=new Uint32Array(w),z=new DataView(z),ua=0;ua<w;ua++)O[ua]=z.getUint32(M+4*ua,!0);hb[ya]=O}else if(-1!=r.indexOf(v))M=4*t[x][v][0]+f["float"]+m,t[x][v]=u(d,M,w,k);else if(-1!=q.indexOf(v)){M=2*t[x][v][0]+f["short"]+m;hb=t[x];ya=v;z=d;O=new Float32Array(w);z=new DataView(z);for(ua=0;ua<w;ua++)O[ua]=z.getInt16(M+2*ua,
!0)/32767;hb[ya]=O}else if(-1!=H.indexOf(v)){M=2*t[x][v][0]+f.ushort+m;hb=t[x];ya=v;z=d;O=new Float32Array(w);z=new DataView(z);for(ua=0;ua<w;ua++)O[ua]=z.getUint16(M+2*ua,!0)/65535;hb[ya]=O}}for(v=0;v<g.length;v++)for(h=g[v].particle_systems,n=0;n<h.length;n++)q=h[n],q.transforms=u(d,4*q.transforms[0]+f["float"]+m,q.transforms[1],k);for(g=0;g<a.length;g++){v=a[g];h=v.fcurves;n=v.frame_range;H=n[0];r=n[1];p=W.XA(H,r);n=null;0>p&&(p=0);var x=t=!1,wa;for(wa in h)t|=-1<wa.indexOf("rotation_euler"),x|=
-1<wa.indexOf("rotation_quaternion");q=[];for(wa in h)if(t&&x&&-1<wa.indexOf("rotation_euler"))delete h[wa];else{var w=h[wa],y;for(y in w)M=w[y],hb=u(d,f["float"]+4*M.bin_data_pos[0]+m,M.bin_data_pos[1],k),ya=new Float32Array(p),null===n&&(n=new Int8Array(p)),W.jy(M,hb,ya,n,H,r),M.Gc=ya;-1<wa.indexOf("rotation_euler")&&(W.xA(h[wa]),q.push(wa))}for(H=0;H<q.length;H++)r=q[H],p=r.replace("euler","quaternion"),h[p]=h[r],delete h[r];v.Fx=n}e(b,c)}function l(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,
4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function u(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function e(a,b,c,d,e){var f=a.cameras,g=a.groups,h=a.materials,l=a.meshes,k=a.node_groups,m=a.objects,n=a.particles,r=a.scenes,u=a.speakers,p=a.textures,x=a.worlds;k||(H.warn('"node_groups" datablock undefined. reexport main scene.'),
k=a.node_groups=[]);for(var t="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),w={},M=0;M<t.length;M++)for(var z=a[t[M]],O=0;O<z.length;O++){var ua=z[O];w[ua.uuid]=ua}for(var y=0;y<r.length;y++){for(var S=r[y],A=S.objects,F=0;F<A.length;F++)v(A,F,w);S.camera&&v(S,"camera",w);S.world&&v(S,"world",w)}for(y=0;y<g.length;y++)for(var C=g[y].objects,F=0;F<C.length;F++)v(C,F,w);for(y=0;y<m.length;y++){var D=
m[y];D.dupli_group&&v(D,"dupli_group",w);D.parent&&v(D,"parent",w);D.dg_parent&&v(D,"dg_parent",w);if(D.animation_data){var ta=D.animation_data;ta.action&&v(ta,"action",w);if(ta.nla_tracks)for(F=0;F<ta.nla_tracks.length;F++)for(var Sa=ta.nla_tracks[F],G=0;G<Sa.strips.length;G++)Sa.strips[G].action&&v(Sa.strips[G],"action",w)}switch(D.type){case "MESH":if(!D.data)throw"mesh not found for object "+D.name;v(D,"data",w);for(var Sb=!1,P=D.modifiers,F=0;F<P.length;F++){var V=P[F];"ARMATURE"==V.type?(Sb&&
H.warn('Object "'+D.name+'" has more than one armature modifiers. Only the first one will be used.'),Sb=!0,v(V,"object",w)):"CURVE"==V.type&&v(V,"object",w)}var I=D.particle_systems;if(I)for(F=0;F<I.length;F++)v(I[F],"settings",w);break;case "ARMATURE":v(D,"data",w);for(var E=D.pose.bones,ra=D.data.bones,F=0;F<E.length;F++){var U=E[F];U.bone=ra[U.bone];var K=U.constraints;if(K)for(G=0;G<K.length;G++){var J=K[G];J.target&&v(J,"target",w)}for(var ja=U.parent_recursive,G=0;G<ja.length;G++)ja[G]=E[ja[G]]}break;
case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":v(D,"data",w)}if(K=D.constraints)for(F=0;F<K.length;F++)J=K[F],J.target&&v(J,"target",w);var ia=D.lod_levels;if(ia)for(F=0;F<ia.length;F++){var Bb=ia[F];Bb.object&&v(Bb,"object",w)}}for(y=0;y<l.length;y++)for(var aa=l[y].materials,F=0;F<aa.length;F++)v(aa,F,w);for(y=0;y<h.length;y++){for(var ga=h[y],Ba=ga.texture_slots,F=0;F<Ba.length;F++)v(Ba[F],"texture",w);var pa=ga.node_tree;pa&&B(pa,w)}for(y=0;y<k.length;y++)(pa=k[y].node_tree)&&B(pa,w);for(y=
0;y<p.length;y++){var na=p[y],ba=na.type;"IMAGE"!=ba&&"ENVIRONMENT_MAP"!=ba||v(na,"image",w)}for(y=0;y<f.length;y++){var La=f[y];La.dof_object&&v(La,"dof_object",w)}for(y=0;y<u.length;y++){var fa=u[y];fa.sound&&v(fa,"sound",w);if(fa.animation_data&&(ta=fa.animation_data,ta.action&&v(ta,"action",w),ta.nla_tracks))for(F=0;F<ta.nla_tracks.length;F++)for(Sa=ta.nla_tracks[F],G=0;G<Sa.strips.length;G++)Sa.strips[G].action&&v(Sa.strips[G],"action",w)}for(y=0;y<n.length;y++){for(var R=n[y],Ba=R.texture_slots,
F=0;F<Ba.length;F++)v(Ba[F],"texture",w);R.dupli_group&&v(R,"dupli_group",w);R.dupli_object&&v(R,"dupli_object",w)}for(y=0;y<x.length;y++)if(Ba=x[y].texture_slots)for(F=0;F<Ba.length;F++)v(Ba[F],"texture",w);hb.Qy(a);for(var ma=b.id,Ta=a.textures,Q=a==ib?a.scenes[0].b4w_anisotropic_filtering:q().b4w_anisotropic_filtering,ka=0;ka<Ta.length;ka++)a==ib||"SCENE"!=Ta[ka].b4w_source_type||(Ta[ka].b4w_source_id=""),xa.Lz(Ta[ka],Q,a.scenes,ma);for(var Ia={},Y=a.objects,ea=0;ea<Y.length;ea++){var T=Y[ea];
if("MESH"===T.type&&!T.particle_systems.length)for(var Ya=T.data,ca=Ya.name,X=Ya.submeshes,Hb=Ya.materials,ha=0;ha<X.length;ha++)0!==X[ha].base_length||Ia[ca]||(Hb[ha]&&H.warn('material "'+Hb[ha].name+'" is not assigned to any face (object "'+T.name+'").'),Ia[ca]=!0)}for(var Gc=a.meshes,qa=0;qa<Gc.length;qa++){var sa=Gc[qa];sa.materials.length||sa.uv_textures.length&&H.warn('mesh "'+sa.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",
diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,
b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,
b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var pb=a.meshes,Yb=Da.keysearch("name","DEFAULT",a.materials),Mc=0;Mc<pb.length;Mc++){var Fb=pb[Mc];0==Fb.materials.length&&Fb.materials.push(Yb)}for(var kb=a.actions,Kb=b.id,ac=0;ac<kb.length;ac++){var Za=kb[ac];Za.Gx=Kb;W.Ox(Za)}for(var Ea=a.scenes,Pa=0;Pa<Ea.length;Pa++){for(var mc=Ea[Pa],Gb=[],Pb=[],yb=Ea[Pa].objects,Ra=0;Ra<yb.length;Ra++){var ic=yb[Ra];N(yb,ic,Gb,Pb);var cb=ic.dupli_group;if(cb)for(var zb=cb.objects,vc=0;vc<
zb.length;vc++)N(zb,zb[vc],Gb,Pb)}for(Ra=0;Ra<Pb.length;Ra++)for(var nc=Pb[Ra],bc=[mc],cc=0;cc<bc.length;cc++){for(var jc=bc[cc].objects,wc=0;wc<jc.length;wc++){var Hc=jc[wc].dupli_group;if(Hc){var xc=Hc.objects,oc=xc.indexOf(nc);-1<oc&&xc.splice(oc,1)}}var oc=jc.indexOf(nc);-1<oc&&jc.splice(oc,1)}for(Ra=0;Ra<Gb.length;Ra++)Da.ey(Gb[Ra][0],Gb[Ra][1])}var Ab=a==ib;!Ab&&1<a.scenes.length&&(a.scenes=[ya.Il(a.scenes)],H.warn("loading data contains multiple scenes.","Only the first one will be loaded."));
var Ka=q(),Wa=Ab?Ka:ya.Il(a.scenes);tb.PD(Ka.fps);1<a.scenes.length&&(a.scenes.splice(a.scenes.indexOf(Ka),1),a.scenes.unshift(Ka));for(var Qc=0;Qc<a.scenes.length;Qc++){var pc=a.scenes[Qc];pc.k={};pc.ir=pc==Wa;pc.Hx=Ab;qc.enabled&&pc.b4w_enable_physics&&(Ab||!la.ym(q())&&pc==ya.Il(a))&&la.IB(pc);Ab?pc.b4w_enable_audio&&wa.vr(pc):pc.b4w_enable_audio&&!Ka.fa&&wa.vr(Ka)}for(var Yc=b.id,Fc=q(),yc=a==ib,Qb=0;Qb<a.scenes.length;Qb++){var zc=a.scenes[Qb],Rc=ya.fz(zc);da.Ou(zc)&&hb.oy(Rc,zc);for(var Sc=
0;Sc<Rc.length;Sc++){var Rb=Rc[Sc];L.Ry(Rb,zc,a)&&(Rb.ed||(Rb.ed=[]),Rb.ed.push(yc?zc:Fc))}for(var fd=Rc,bd=0;bd<fd.length;bd++){var Ic=fd[bd];if(Ic.ed)for(var Tc=Ic.particle_systems,Uc=0;Uc<Tc.length;Uc++){var Jc=Tc[Uc].settings;if("HAIR"==Jc.type)if("OBJECT"==Jc.render_type){var Ac=Jc.dupli_object;Ac.ed||(Ac.ed=Ic.ed.slice())}else if("GROUP"==Jc.render_type)for(var Zc=Jc.dupli_group,Kc=0;Kc<Zc.objects.length;Kc++)Ac=Zc.objects[Kc],Ac.ed||(Ac.ed=Ic.ed.slice())}}}for(var $c=oa(a,Yc),Qb=0;Qb<$c.length;Qb++)if(Rb=
$c[Qb],!yc&&Rb.parent&&-1<Wc.indexOf(Rb.parent.type)&&(Rb.parent=""),"MESH"==Rb.type){var Lc=hb.hy(Rb);Lc&&(a.meshes.push(Lc),Rb.data=Lc)}e(b,c)}function h(a,b,c,d,e){d=oa(a,b.id);for(var f=b.id,g=0;g<d.length;g++){var h=d[g];if(h.ed){for(var l=qa.Tn(h.name,h.type,h.origin_name),k=0;k<h.ed.length;k++)qa.al(l,h.ed[k]);l.Ha=h;h.Fc=l;L.mh(h,l);l.f.oc=f;l.Yj=h.hr||!1}}d=L.get_all_objects(b.id);for(f=0;f<d.length;f++)g=d[f],da.mh(g.Ha,g);if(a==ib)for(f=b.id,g=0;g<a.scenes.length;g++)for(var h=a.scenes[g],
l=0,k=L.oa(h,"LAMP",f),m=0;m<k.length;m++)qa.Ma(k[m],h).ak=l++;for(f=0;f<d.length;f++)g=d[f],g.Yj||(L.pF(g),Sb.o(g));for(a=0;a<d.length;a++)if(f=d[a],"MESH"==f.type&&(g=f.bl)){var g=g.f,h=f.f.Dh,l=[],n;for(n in h)k=h[n],l.push(4*k.co,4*k.df);g.Vt.push(l);g.Fm.push(f.f)}a=n=-1;f=W.ct();for(g=0;g<d.length;g++)h=d[g],l=h.f,qa.is_mesh(h)&&l.$h&&(h=l.Je,h>n&&(n=h),f>=h&&h>a&&(a=h));for(g=0;g<d.length;g++)h=d[g],l=h.f,qa.is_mesh(h)&&l.$h&&(l.Jj=!0,n<f?l.Je=n:l.Je<=f?l.Je=a:(H.warn('too many bones for "'+
h.name+'" / '+l.Je+" bones (max "+f+" with blending, "+2*f+" without blending). Blending between frames will be disabled."),l.Je=n,l.Jj=!1),l.Jj=l.Jj&&!pa.Ms);for(n=0;n<d.length;n++)if(a=d[n],f=a.Ha,qa.is_mesh(a)&&(g=f.lod_levels.length))for(h=a,l=0;l<g;l++)if(k=f.lod_levels[l].object){k=k.Fc;k.f.Pg=a.f.Pg;h.f.wf=f.lod_levels[l].distance;k.f.bk=f.lod_levels[l].distance;if(f.lod_levels[l+1])k.f.wf=f.lod_levels[l+1].distance;else{k.f.am=!0;k.f.wf=1E4;break}h.f.am=!1;h=k}else{h.f.am=!0;h.f.wf=f.lod_levels[l].distance;
break}for(n=0;n<d.length;n++)if(a=d[n],a.rc)if(f=a.Bc,"CHASSIS"==f.tc){a.l={};a.l.Hj=f.Hj;a.l.jj=f.jj;a.l.nq=f.nq;a.l.pq=f.pq;a.l.oq=f.oq;a.l.Rq=f.Rq;a.l.Pp=f.Pp;a.l.kp=f.kp;a.l.Kh=0;a.l.ij=1;a.l.Fi=0;a.l.speed=0;a.l.dh=[];a.l.ok=[];a.l.Hi=null;h=(g=qa.get_dg_parent(a))?qa.Ao(g,d):d;for(g=0;g<h.length;g++)l=h[g],l.rc&&(k=l.Bc,la.MB(l)&&f.name==k.name?(k=la.eG(l.Bc.tc),a.l.dh[k]=l,a.l.ok[k]=new Float32Array(8)):la.Ft(l)&&f.name==k.name?(a.l.Hi=l,a.l.Gi=k.Gi,a.l.Ak=k.Ak,a.l.Uj=k.Uj,k=fa.invert(a.f.aa,
new Float32Array(16)),l=fa.multiply(k,l.f.aa,k),a.l.qv=l,k=new Float32Array([1,0,0,0]),ta.transformMat4(k,l,k),a.l.pv=k):la.Et(l)&&f.name==k.name?(a.l.gq=l,a.l.xk=k.xk,a.l.gi=k.gi,k=fa.invert(a.f.aa,new Float32Array(16)),l=fa.multiply(k,l.f.aa,k),a.l.mv=l,k=new Float32Array([1,0,0,0]),ta.transformMat4(k,l,k),a.l.lv=k):la.Gt(l)&&f.name==k.name&&(a.l.qq=l,a.l.xj=k.xj,k=fa.invert(a.f.aa,new Float32Array(16)),l=fa.multiply(k,l.f.aa,k),a.l.Av=l,k=new Float32Array([1,0,0,0]),ta.transformMat4(k,l,k),a.l.zv=
k));if(4!=a.l.dh.length)throw"Not enough wheels for chassis "+a.name;}else if("HULL"==f.tc)for(a.l={},a.l.dh=[],a.l.ok=[],a.l.Hj=f.Hj,a.l.jj=f.jj,a.l.Dg=f.Dg,a.l.sh=f.sh,a.l.th=f.th,a.l.Kh=0,a.l.ij=1,a.l.Fi=0,a.l.speed=0,a.l.Hi=null,h=(g=qa.get_dg_parent(a))?qa.Ao(g,d):d,g=0;g<h.length;g++)l=h[g],l.rc&&(k=l.Bc,la.KB(l)&&f.name==k.name?(a.l.dh.push(l),a.l.ok.push(new Float32Array(8))):la.Ft(l)&&f.name==k.name?(a.l.Hi=l,a.l.Gi=k.Gi,a.l.Ak=k.Ak,a.l.Uj=k.Uj,k=fa.invert(a.f.aa,new Float32Array(16)),l=
fa.multiply(k,l.f.aa,k),a.l.qv=l,k=new Float32Array([1,0,0,0]),ta.transformMat4(k,l,k),a.l.pv=k):la.Et(l)&&f.name==k.name?(a.l.gq=l,a.l.xk=k.xk,a.l.gi=k.gi,k=fa.invert(a.f.aa,new Float32Array(16)),l=fa.multiply(k,l.f.aa,k),a.l.mv=l,k=new Float32Array([1,0,0,0]),ta.transformMat4(k,l,k),a.l.lv=k):la.Gt(l)&&f.name==k.name&&(a.l.qq=l,a.l.xj=k.xj,k=fa.invert(a.f.aa,new Float32Array(16)),l=fa.multiply(k,l.f.aa,k),a.l.Av=l,k=new Float32Array([1,0,0,0]),ta.transformMat4(k,l,k),a.l.zv=k));for(n=0;n<d.length;n++)if(a=
d[n],a.Lg&&(f=a.Mh,"MAIN_BODY"==f.tc))for(a.ld={},a.ld.Dg=f.Dg,a.ld.sh=f.sh,a.ld.th=f.th,a.ld.jl=[],g=(g=qa.get_dg_parent(a))?qa.Ao(g,d):d,h=0;h<g.length;h++)l=g[h],l.Lg&&(k=l.Mh,la.OB(l)&&f.name==k.name&&(a.ld.jl.push(l),l.Ay=l.Mh.yv));e(b,c)}function g(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];f.gg=f.camera.Fc}d=q();for(var f=a==ib,g=0;g<a.scenes.length;g++){var h=f?a.scenes[g]:d,l=L.oa(h,"ALL",b.id),k=f?L.oa(h,"LAMP",b.id):L.oa(h,"LAMP",0),m=L.oa(h,"MESH",b.id),n=L.oa(h,"EMPTY",
b.id);f&&(ya.Ux(h,l,k,m,n),h.k.Xi.length&&(b.Lo=!0));ya.Vx(h,a.textures,b.id);for(var H=0;H<n.length;H++)L.Jv(n[H]);n=[];ya.set_active(h);O.PA(h,m,k,n);l=ya.bt(h);if(f){H=h.k.Gm;if(H.uD||H.procedural_skydome)H=O.RA(h,H),n.push(H);ya.HA(l)}for(H=0;H<m.length;H++)O.js(m[H],l,h);for(H=0;H<n.length;H++)O.js(n[H],l,h),L.QC(n[H]);l=L.oa(h,"ALL",b.id);ya.py(h,l,k)}for(d=0;d<a.scenes.length;d++)delete a.scenes[d].camera;d=a.materials;if(ja.ao&&Ba.Ov)for(a=0;a<d.length;a++){h=d[a];k=h.texture_slots;for(f=
0;f<k.length;f++)if(m=k[f],n=m.texture,"IMAGE"==n.type||"ENVIRONMENT_MAP"==n.type)g=n.image,g.Ec||(-1<g.filepath.indexOf(".dds")?g.Ec=!0:(g.Ec=!n.b4w_disable_compression&&!m.use_map_normal&&"ENVIRONMENT_MAP"!=n.type&&!n.b4w_shore_dist_map&&"MOVIE"!=g.source,g.Ec&&(g.filepath+=".dds")));if(f=h.node_tree)for(h=f.nodes,f=0;f<h.length;f++)g=h[f],"TEXTURE"==g.type&&(k=g.texture)&&(g=k.image)&&!g.Ec&&(g.Ec=k.k.Xk&&!k.b4w_disable_compression&&"MOVIE"!=g.source,g.Ec&&(g.filepath+=".dds"))}else for(a=a.images,
d=0;d<a.length;d++)f=a[d],f.Ec=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function q(){return ya.Il(ib.scenes)}function z(a,b,c,d,e){d=a.groups;for(var f=a.objects,g={},h={},l={},k={},m=0;m<d.length;m++){var n=d[m];g[n.uuid]=n;l[n.uuid]=n}for(m=0;m<f.length;m++)n=f[m],h[n.uuid]=n,k[n.uuid]=n;a=a.scenes;for(m=0;m<a.length;m++)G(a[m].objects,null,k,l);for(var q in l)q in g||d.push(l[q]);for(q in k)q in h||f.push(k[q]);e(b,c)}function G(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=
a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var l=c[g.uuid],k=l.constraints,g=0;g<k.length;g++){var m=Da.sg(k[g]);m.name+="_CLONE";h.constraints.push(m)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(l.animation_data=Da.sg(h.animation_data)),l.b4w_use_default_animation=h.b4w_use_default_animation,l.b4w_auto_skel_anim=h.b4w_auto_skel_anim,l.b4w_anim_behavior=h.b4w_anim_behavior,l.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=
Da.jB(a,e[f]),-1<h&&a.splice(h,1);e={};if(b)for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],k=Da.sg(h),h="origin_name"in h?h.origin_name:h.name,k.name=qa.Ps(b.name,h),k.origin_name=h,k.dg_parent={uuid:b.uuid},D(k),c[k.uuid]=k,e[g.uuid]=k.uuid,g.uuid=k.uuid;for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,k=d[g.uuid],l=Da.sg(k),l.name=Da.Oi(k.name+"_CLONE"),l.uuid=ka.ut("Group"+l.name),d[l.uuid]=l,g.uuid=l.uuid,G(l.objects,h,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];
h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(H.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);k=h.constraints;for(g=0;g<k.length;g++)b=k[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);if(b=h.pose)for(d=b.bones,g=0;g<d.length;g++)if(k=d[g].constraints)for(l=0;l<k.length;l++)b=k[l],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in
e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var n in e)Hb[n]=e[n]}function D(a){a.uuid=ka.ut("Object"+a.name)}function B(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&v(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in Hb&&(e.lamp.uuid=Hb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&v(e,"node_group",b)}e=a.links;
for(d=0;d<e.length;d++){var f=e[d];E(f,"from_node",c);E(f,"to_node",c);A(f,"from_socket",f.from_node.outputs);A(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&v(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&v(e.strips[f],"action",b)}function v(a,b,c){(c=c[a[b].uuid])||H.error("Dangling link found:",b,a);a[b]=c}function E(a,b,c){c=Da.keysearch("name",a[b].name,c);a[b]=c}function A(a,b,c){c=Da.keysearch("identifier",
a[b].identifier,c);a[b]=c}function r(a,b,d,e,f,g){if(!Ba.do_not_load_resources){for(var h=T(b.s),l=a.images,k={},m=[],n=0;n<l.length;n++){var q=l[n],r=q.uuid;if("FILE"===q.source||"MOVIE"===q.source){var u=y(q,a.textures);if(!u.length)H.warn("image ",q.name," has no users.");else if(!u[0].b4w_shore_dist_map){u=Da.ck(h+q.filepath);if("FILE"===q.source){var p=q.Ec?M.AT_ARRAYBUFFER:M.AT_IMAGE_ELEMENT;ja.lp&&Ba.Sm&&(u=M.yk(u),"dds"==u[1]?(u=M.yk(u[0]),u=u[0]+".min50."+u[1]+".dds"):u=u[0]+".min50."+u[1])}else"MOVIE"===
q.source&&(Ba.vk?(u=M.yk(u),u=u[0]+".altconv.seq",p=M.Ok):(u=M.yk(u),p=wa.detect_video_container(u[1]),u=p!=u[1]?u[0]+".altconv."+p:u[0]+"."+p,p=M.Pk));m.push([r,p,u]);k[r]=q}}}m.length?(e.vt=0,M.enqueue(m,function(f,h,l,n){if(f){if(l==M.Pk||l==M.Ok){if(l==M.Pk)var q=f.videoWidth,r=f.videoHeight;else q=f.images[0].width,r=f.images[0].height;H.log("%cLOAD VIDEO "+q+"x"+r,"color: #"+(2048<q||2048<r?"a00":1024<q||1024<r?"aa0":"0a0"),n);-1==n.indexOf(Ia)&&H.warn("video",n,"is not from app root.")}else c(f,
n,!0);h=k[h];n=y(h,a.textures);for(q=0;q<n.length;q++){var r=n[q],u=r.image.filepath;l==M.Ok?(r.k.Vp=f.Xd,xa.Fk(r.k,f.images,h.Ec,u,b.id)):xa.Fk(r.k,f,h.Ec,u,b.id)}}f=++e.vt/m.length;g(b,d,f)},function(){H.log("%cLOADED ALL IMAGES","color: #0a0");f(b,d)})):f(b,d)}}function m(a,b,c,d,e){a=ya.et();for(d=0;d<a.length;d++){var f=a[d];da.Ou(f)&&da.sF(f,f.b4w_nla_cyclic,b.id)}e(b,c)}function y(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function t(a,b,c,d,e,f){if(!Ba.do_not_load_resources){a=
T(b.s);for(var g=[],h={},l=L.get_all_objects(b.id),k=0;k<l.length;k++){var m=l[k],n=m.Ha;if(J(m)){var q=n.data.sound,n=q.uuid;"BACKGROUND_MUSIC"==wa.Do(m)?(n=Da.Qs(),b.Jo=!0):"NONE"!=wa.Do(m)&&Ba.wt&&(b.Po=!0);if(!(n in h)){h[n]=[];q=Da.ck(a+q.filepath);switch(wa.kv(m)){case wa.Ym:var r=M.AT_AUDIOBUFFER;break;case wa.Tq:r=M.AT_AUDIO_ELEMENT}var q=M.yk(q),u=wa.detect_audio_container(q[1]),q=u!=q[1]?q[0]+".altconv."+u:q[0]+"."+u;g.push([n,r,q])}h[n].push(m)}}g.length?M.enqueue(g,function(a,e,l,k){if(a)for(H.log("%cLOAD SOUND",
"color: #0aa",k),-1==k.indexOf(Ia)&&H.warn("sound",k,"is not from app root."),e=h[e],l=0;l<e.length;l++)wa.vF(e[l],a);a=++d.qE/g.length;f(b,c,a)},function(){H.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,c)}}function J(a){return qa.is_speaker(a)&&wa.kv(a)!=wa.Uq}function C(a,b,c){a=L.oa(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];qa.is_speaker(d)&&(wa.is_cyclic(d)||c)&&wa.play_def(d)}}function I(a){for(var b=a.k.Xi,c=0;c<b.length;c++){var d=b[c].k;a.b4w_use_nla&&b[c].b4w_nla_video||
!b[c].use_auto_refresh||(xa.reset_video(d.name,d.Cc),xa.play_video(d.name,d.Cc))}}function F(a,b,c,d,e){da.start();H.log("%cSTART NLA","color: #0a0");e(b,c)}function N(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],h=g.object;if(h){var l=Da.nj(h);l.name=b.name+"_LOD_"+String(f+1);D(l);l.lod_levels=[];c.push([a,l]);d.push(h);g.object=l}}}function w(a,b,c,d,e){d=!0;for(var f=0;f<a.scenes.length;f++)if(!la.Zy(a.scenes[f])){d=!1;break}d&&
(e(b,c),H.log("%cPHYSICS READY","color: #0a0"))}function K(a,b,c,d,e){d=q();for(var f=0;f<a.scenes.length;f++){var g=a.scenes[f],h=a==ib?la.ym(g):la.ym(d)||la.ym(g);a==ib||(g=d);if(qc.enabled&&h)for(h=0;h<Mc.length;h++)for(var l=L.oa(g,Mc[h],b.id),k=0;k<l.length;k++){var m=l[k];m.f.oc==b.id&&(la.append_object(m,g),b.Qt&&la.K(m)&&la.disable_simulation(m))}}e(b,c)}function x(a,b,d,e,f){var g={};e=[];for(var h=a.scenes,l=0;l<a.scenes.length;l++){var k=h[l];if(k.k.rb&&(k=k.k.rb.Em)&&"FILE"===k.source){var m=
k.uuid,n=Da.ck(T(b.s)+k.filepath);e.push([m,k.Ec?M.AT_ARRAYBUFFER:M.AT_IMAGE_ELEMENT,n]);g[m]=k}}e.length?M.enqueue(e,function(d,e,f,l){if(d){c(d,l,!0);e=g[e];l=y(e,a.textures);for(f=0;f<l.length;f++){var k=l[f];xa.Fk(k.k,d,e.Ec,k.image.filepath,b.id)}for(f=0;f<h.length;f++)if(l=h[f],l.k.rb.Em===e){var m=d,n=document.createElement("canvas"),k=e.size[0],q=e.size[1];n.width=k;n.height=q;n=n.getContext("2d");n.drawImage(m,0,0);m=n.getImageData(0,0,k,q).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=
1/65025;n[2]=1/255;n[3]=1;for(var k=k*q,q=new Float32Array(k),H=0;H<k;H++)q[H]=n[1]*m[4*H+2]+n[2]*m[4*H+3];l.k.Yp=q}}},function(){f(b,d)}):f(b,d)}function V(a,b,d,e,f){if(Ba.antialiasing&&Ba.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var l=ya.ea(e,g[h]);l&&a.push(l)}if(a.length){e=[];h=M.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,S.hc.smaa_search_texture_path]);e.push(["AREA_TEXTURE",
h,S.hc.smaa_area_texture_path]);for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.ta;for(h=0;h<a.length;h++)if(g=a[h],"u_search_tex"==g.to)var k=g.Ca;else if("u_area_tex"==g.to)var m=g.Ca;break}e.length?M.enqueue(e,function(a,d,e,f){a&&(c(a,f,!1),d="SEARCH_TEXTURE"==d?k:m,d.source="IMAGE",d.Ar=!0,xa.Fk(d,a,-1!=f.indexOf(".dds")?1:0,f,b.id),xa.wk(d,xa.t,xa.t))},function(){f(b,d)}):f(b,d)}else f(b,d)}else f(b,d)}function U(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=
a.scenes[c];a==ib||(e=q());for(var f=L.oa(e,"LAMP",b.id),g=0;g<f.length;g++){var h=f[g];h.f.oc==b.id&&d.en.push({xa:e,obj:h})}f=L.oa(e,"ALL",b.id);for(g=0;g<f.length;g++)h=f[g],"LAMP"!=h.type&&h.f.oc==b.id&&(b.Qt&&qa.is_mesh(h)&&ya.hide_object(h),d.en.push({xa:e,obj:h}))}}function aa(a,b,c,d,e,f){var g=d.en;e=d.hu;if(g.length){a=g[e].obj;e=g[e].xa;var h=qa.Ma(a,e);ya.append_object(e,a,!1);a.anchor&&ma.append(a);d=++d.hu/g.length;"LAMP"==a.type&&L.pE(e);g=h.jf;null!=a.f.hd&&g&&ya.Iv(g,a.f.i);g=a.rk;
g.length&&e.k.vi&&(e=h.Ff,ya.Lv(e,a.f.i,a.f.quat),qa.Mv(g,e.j.ic))}else d=1;f(b,c,d)}function ba(a,b,c,d,e){if(a==ib){a=ya.Sh();d=ya.et();for(var f=0;f<d.length;f++){var g=d[f];ya.jD(g,a);g.b4w_use_logic_editor&&Y.FB(g,b.id)}ya.set_active(a)}else ya.Dq(q());a=L.get_all_objects(b.id);L.qF(a);e(b,c)}function ea(a,b,c,d,e){if(a==ib)for(d=0;d<a.scenes.length;d++)I(a.scenes[d]),C(a.scenes[d],b.id);else I(q()),C(q(),b.id);e(b,c)}function R(a,b,c,d,e){Ba.uf&&(b.Lo||b.Jo||b.Po)?Ya||X(a,e,b,c):e(b,c)}function X(a,
b,c,d){var e=Yb.parentElement;Gc=e.style.zIndex;e.style.zIndex="999";Ya=document.createElement("div");Ya.style.position="relative";Ya.style.height="88px";Ya.style.width="88px";var f=Math.round(Yb.offsetWidth/2-44);Ya.style.top=Math.round(Yb.offsetHeight/2-44).toString()+"px";Ya.style.left=f.toString()+"px";Ya.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
Ya.style.backgroundSize="88px";pb=document.createElement("div");pb.style.position="relative";pb.style.height=Yb.offsetHeight.toString()+"px";pb.style.width=Yb.offsetWidth.toString()+"px";pb.style.background="rgba(0, 0, 0, 0.5)";pb.style.zIndex="999";e.appendChild(pb);pb.appendChild(Ya);Ya.addEventListener("click",function(){c.Lo&&(xa.play(),xa.pause(),xa.reset());if(c.Jo){if(a==ib)for(var e=0;e<a.scenes.length;e++)C(a.scenes[e],c.id,!0);else C(q(),c.id,!0);wa.pause()}c.Po&&wa.dD();Q();b(c,d)},!1)}
function Q(){if(Ya){var a=Yb.parentElement;a.style.zIndex=Gc;pb.removeChild(Ya);a.removeChild(pb);Ya=pb=null;Gc=0}}function T(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function ca(a,b,c){W.is_animated(b)&&W.remove(b);L.clear_outline_anim(b);ra.check_sensor_manifold(b)&&ra.remove_sensor_manifold(b);la.K(b)&&la.rD(b);ya.sD(a,b,c);qa.is_speaker(b)&&wa.sE(b);ma.is_anchor(b)&&ma.remove(b)}function oa(a,b){if(!Ta[b]){for(var c=a.scenes,d=[],e=0;e<c.length;e++)ha(c[e].objects,0,a==ib,
d);Ta[b]=[];for(e=0;e<d.length;e++)for(var f=d[e],c=0;c<f.length;c++)for(var g=f[c],h=0;h<g.length;h++)Ta[b].push(g[h]);d=a.particles;for(e=0;e<d.length;e++){if(f=d[e].dupli_object)f.hr=!0,Ta[b].push(f);if(c=d[e].dupli_group)for(g=c.objects,c=0;c<g.length;c++)f=g[c],f.hr=!0,Ta[b].push(f)}}return Ta[b]}function ha(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],f=0;f<a.length;f++){var g=a[f],h=na(g);e[h]=e[h]||[];(c||-1==Wc.indexOf(g.type))&&-1==e[h].indexOf(g)&&e[h].push(g);(g=g.dupli_group)&&ha(g.objects,
b+1,c,d)}}function na(a){return(a=a.parent||W.Vs(a))?1+na(a):0}var ma=p("__anchors"),W=p("__animation"),M=p("__assets"),O=p("__batch");p("__camera");var S=p("__config"),ra=p("__controls"),P=p("__dds"),ia=p("__extensions");p("__lights");var ga=p("__loader"),fa=p("__mat4"),ka=p("__md5"),da=p("__nla"),Y=p("__logic_nodes"),sa=p("__nodemat"),L=p("__objects"),qa=p("__obj_util"),la=p("__physics"),H=p("__print"),hb=p("__reformer"),ua=p("__renderer"),ya=p("__scenes"),wa=p("__sfx"),Sa=p("__shaders"),xa=p("__textures"),
tb=p("__time"),Sb=p("__transform"),Da=p("__util"),ta=p("__vec4"),Ba=S.q,ja=S.Od,qc=S.m,pa=S.lg,Bb=S.A,La=null,Ta=null,Ia="",ib=null,Hb={},Ya=null,pb=null,Gc=0,Wc=["LAMP","CAMERA"],Mc=["MESH","CAMERA","EMPTY"],Yb=null;a.is_primary_loaded=function(a){return ga.is_primary_loaded(a)};a.update=function(){ga.tF(La)};a.fE=function(a){Yb=a};a.oF=function(a,b){if(Ya){pb.style.height=b.toString()+"px";pb.style.width=a.toString()+"px";var c=Math.round(a/2-44);Ya.style.top=Math.round(b/2-44).toString()+"px";
Ya.style.left=c.toString()+"px"}};a.load=function(a,c,l,q,H){var u={load_main:{Oa:ga.le,Xa:!1,D:[],Za:!1,$a:500,qb:!1,fb:b},duplicate_objects:{Oa:ga.cd,Xa:!1,D:["load_main"],Za:!1,$a:50,qb:!1,fb:z},load_binaries:{Oa:ga.le,Xa:!1,D:["load_main"],Za:!1,$a:500,qb:!1,fb:k},wait_for_shaders:{Oa:ga.le,Xa:!0,D:[],Za:!1,$a:50,qb:!0,ff:f},prepare_bindata:{Oa:ga.cd,Xa:!1,D:["duplicate_objects","load_binaries"],Za:!1,$a:0,qb:!1,fb:n},prepare_bpy_data:{Oa:ga.cd,Xa:!1,D:["duplicate_objects","prepare_bindata"],
Za:!1,$a:100,qb:!1,fb:e},process_objects:{Oa:ga.cd,Xa:!1,D:["prepare_bpy_data"],Za:!1,$a:100,qb:!1,fb:h},process_scenes:{Oa:ga.cd,Xa:!1,D:["process_objects","wait_for_shaders"],Za:!1,$a:300,qb:!1,fb:g},load_smaa_textures:{Oa:ga.le,Xa:!0,D:["process_scenes"],Za:!1,$a:10,qb:!0,fb:V},load_shoremap:{Oa:ga.le,Xa:!0,D:["process_scenes"],Za:!1,$a:10,qb:!0,fb:x},load_textures:{Oa:ga.le,Xa:!0,D:["process_scenes"],Za:!0,$a:500,qb:!1,fb:r,rg:{vt:0}},update_scenes_nla:{Oa:ga.cd,Xa:!1,D:["process_scenes","load_textures"],
Za:!1,$a:20,qb:!1,fb:m},wait_physics_workers:{Oa:ga.le,Xa:!0,D:["load_shoremap"],Za:!1,$a:20,qb:!1,ff:w},add_physics_objects:{Oa:ga.cd,Xa:!1,D:["wait_physics_workers"],Za:!1,$a:20,qb:!1,fb:K},add_objects:{Oa:ga.cd,Xa:!1,D:["add_physics_objects"],Za:!1,$a:800,qb:!1,fb:U,ff:aa,kj:ba,rg:{en:[],hu:0}},load_speakers:{Oa:ga.le,Xa:!0,D:["add_objects"],Za:!0,$a:30,qb:!1,fb:t,rg:{qE:0}},mobile_media_start:{Oa:ga.cd,Xa:!Ba.uf,D:["load_textures","update_scenes_nla","load_speakers"],Za:!0,$a:5,qb:!1,fb:R,ff:R},
synchronize_media:{Oa:ga.cd,Xa:!0,D:["mobile_media_start"],Za:!0,$a:70,qb:!1,fb:ea},start_nla:{Oa:ga.cd,Xa:!0,D:["mobile_media_start"],Za:!1,$a:5,qb:!1,fb:F}},p=ga.ht();p||(p=ga.Ez(),La={},Ta={},Hb={});La[p.he.length]={};return ga.Mz(u,a,c,l,d,q||Bb.xr,Ba.do_not_load_resources,H)};a.unload=function(a){var b=ga.ht();if(!b||!b.he.length||a&&!ga.PE(b.he[a]))H.error("Unable to unload data!");else{if(0==a)H.log("%cUNLOAD ALL","color: #00a"),ma.cleanup(),W.cleanup(),wa.cleanup(),da.cleanup(),ya.cleanup(),
ga.cleanup(),la.cleanup(),L.cleanup(),Da.cleanup(),ua.cleanup(),sa.cleanup(),Sa.cleanup(),ra.cleanup(),ia.cleanup(),M.cleanup(),xa.cleanup(),Y.cleanup(),Ta=null,Hb={},La=ib=null;else{H.log("%cUNLOAD DATA "+a,"color: #00a");W.qD(a);for(var b=ya.Rh(),c=0;c<b.length;c++)for(var d=b[c],e=L.oa(d,"ALL",a),f=e.length-1;0<=f;f--){var g=e[f];ca(d,g,!0);e.splice(f,1);var h=L.oa(d,g.type,a),g=h.indexOf(g);-1!=g&&h.splice(g,1)}}Q()}};a.iD=ca;a.set_debug_resources_root=function(a){Ia=a}};b4w.module.__batch=function(a,p){function d(a){a={type:a,Ua:"",id:0,tD:0,oi:"",U:[],Ob:[],Oc:[],sj:[],ph:null,Cb:{},lc:null,ab:{Wi:null,Oh:null,mf:[],zf:[]},wr:[],uI:null,R:null,je:!1,xg:!1,qs:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,Ht:0,It:0,kt:0,Fo:0,qc:new Float32Array(3),Ic:new Float32Array(16),jg:!1,Ia:!1,Zr:!1,da:!1,We:!1,Wa:!1,$c:!1,Vd:!1,Vc:!1,xc:!1,yc:!1,jc:!1,Yb:!1,wc:!1,Fb:!1,xu:!1,ze:ca.aj,Ye:ca.ne,Fn:!1,Fg:!1,mD:"",CI:"",mt:!1,qt:0,nt:0,rt:0,st:0,pt:new Float32Array(3),ot:new Float32Array(3),
Ig:!1,oe:0,Ae:0,lf:1,reflect_factor:0,kh:0,eq:1,parallax_scale:0,kf:0,af:1,cu:0,mp:0,Xg:0,Iu:0,Kc:Array(2),zc:new Float32Array(3),Sf:new Float32Array(3),ce:new Float32Array(3),pc:new Float32Array(4),Bd:new Float32Array(4),ai:null,Xo:null,Vo:null,Uo:null,Wo:null,Vh:!1,ag:!1,water_dynamic:!1,Xm:!1,ew:!1,fw:0,gw:0,dw:0,Zi:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Ks:new Float32Array(2),Js:new Float32Array(2),ro:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
Wg:null,Lp:!1,sa:null};a.pc[3]=1;a.Zr=!0;a.da=!0;return a}function c(a){switch(a.type){case "MAIN":case "PARTICLES":a.Ua=a.Ia?a.We?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.Ua=a.Vh?"NODES":"DEPTH";break;case "COLOR_ID":a.Ua=a.We?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.R;a.R=null;var c=na.hf(a);a.R=b;c.R=b;return c}function k(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=e.Ha,g=e.f,h=ea.td();ea.tl(g.Bh,h);var k=f.data.b4w_bounding_cylinder_radius,m=f.data.b4w_bounding_sphere_radius,
q=f.data.b4w_bounding_sphere_center,r=f.data.b4w_bounding_ellipsoid_axes,f=f.data.b4w_bounding_ellipsoid_center;if(g.vd){var k=Math.max(Math.abs(h.max_x),Math.abs(h.min_x)),m=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),u=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),u=Math.sqrt(k*k+m*m+u*u),k=Math.sqrt(k*k+m*m);h.max_x=h.max_y=h.max_z=u;h.min_x=h.min_y=h.min_z=-u;m=u;q[0]=q[1]=q[2]=0;r[0]=r[1]=r[2]=u;f[0]=f[1]=f[2]=0}g.Kb=h;u=ea.yn(h,g.aa);g.nb=u;l(g,k,k,h);h=ea.vl(m,q);g.gd=h;h=ea.An(h,g.aa);g.Lb=
h;r=ea.ul([r[0],0,0],[0,r[1],0],[0,0,r[2]],f);g.cf=r;r=ea.zn(r,g.za);g.ng=r;c=c.concat(n(e,g,b))}return c}function f(a,b,c){for(var d=[],e=[],f={},g=0;g<a.length;g++){var h=a[g],l=h.Ha,k=h.f,m=ea.td();ea.tl(k.Bh,m);var q=ea.yn(m,k.aa),r=ea.vl(l.data.b4w_bounding_sphere_radius,l.data.b4w_bounding_sphere_center),u=ea.An(r,k.aa),p=l.data.b4w_bounding_ellipsoid_axes,l=ea.ul([p[0],0,0],[0,p[1],0],[0,0,p[2]],l.data.b4w_bounding_ellipsoid_center),p=ea.zn(l,k.za);k.Kb=m;k.nb=q;k.gd=r;k.Lb=u;k.cf=l;k.ng=p;
m={};m.Vc=k.Vc;m.xc=k.xc;m.yc=k.yc;m.Ne=k.Ne;m.km=k.km;m.tb=k.tb;m.jm=k.jm;m.pi=k.pi;m.jc=k.jc;m.Yb=k.Yb;m.wc=k.wc;m.hd=k.hd;m.Sc=k.Sc;m.ae=k.ae;m.se=k.se;m.bd=k.bd;m.He=k.He;m.Ub=k.Ub;m.vd=k.vd;m.hj=k.hj;m.gj=k.gj;m.Fb=k.Fb;m.Hh=k.Hh;m.Bl=k.Bl;m.Ie=k.Ie;m.Sg=k.Sg;m.cm=k.cm;m.Pc=k.Pc;m.Rg=k.Rg;m.dm=k.dm;m.Vd=k.Vd;q=k.Lb.G;m.yB=0==c?[0,0]:[Math.floor(q[0]/c),Math.floor(q[2]/c)];m.wf=k.wf;m.bk=k.bk;m.Pg=k.Pg;m.Cl=k.Cl;k=JSON.stringify(m);f[k]=f[k]||[];f[k].push(h)}for(var x in f){m=JSON.parse(x);c=
f[x];var h=na.Fh("STATIC"),t;for(t in m)h[t]=m[t];h.oc=a[0].f.oc;h.ke=0;h.Ve=0;h.we=0;h.ve=0;h.qe=0;h.Wh=!1;for(g=0;g<c.length;g++)k=c[g],0==g?(h.nb=fa.na(k.f.nb),h.Lb=fa.na(k.f.Lb),h.cf=fa.na(k.f.cf),h.ng=fa.na(k.f.ng)):(ea.Bs(h.nb,k.f.nb),ea.nA(h.Lb,k.f.Lb));h.Kb=fa.na(h.nb);h.gd=fa.na(h.Lb);e.push({f:h,Wb:c})}for(a=0;a<e.length;a++)for(f=e[a].f,g=e[a].Wb,x=0;x<g.length;x++){t=g[x];c=t.Ha;h=n(t,f,b);t.f.vd&&!t.f.tn?(k=ga.create(),ga.set_trans(t.f.i,k)):(k=t.f,k=ga.create_sep(k.i,k.scale,k.quat));
m={};if(f.bd||f.vd)m.au_center_pos=[k[0],k[1],k[2]];f.bd&&(m.au_wind_bending_amp=[t.f.ke],m.au_wind_bending_freq=[c.b4w_wind_bending_freq],m.au_detail_bending_amp=[c.b4w_detail_bending_amp],m.au_detail_bending_freq=[c.b4w_detail_bending_freq],m.au_branch_bending_amp=[c.b4w_branch_bending_amp]);for(q=0;q<h.length;q++)l=h[q].f,r=h[q].Xc,u=h[q].C,l.Yl?l.vd?ca.GE(r,k):ca.uv(r,k):("COLOR_ID"==u.type&&(l=h[q].f=t.f,u.oi=c.uuid,A(u,l),l=N(l),F(u,l)),r=ca.uv(r,k),ca.FE(r,m));d=d.concat(h)}return d}function n(a,
b,c){var f=a.Ha,g=[],h=u(c,b),l=N(b),k=f.data,m=k.materials,n=Array(m.length),q=ra.Sa(c,"MAIN_OPAQUE"),r=!1;q&&(r=q.bm.length?!0:!1);for(var p=0;p<h.length;p++)for(var x=h[p],v=0;v<m.length;v++){var w=m[v];if(("LENS_FLARES"!=w.name||r)&&!ca.tt(k,v)){var M=d(x);"COLOR_ID"==x&&(M.Fn=!(f.b4w_do_not_render||w.b4w_do_not_render));"MAIN"==x&&(n[v]=M);if(I(M,w)){"DEPTH"==x&&n[v]&&(M.$c=n[v].$c);M.ze=b.je||b.Vd?ca.Qk:ca.aj;A(M,b);for(var z=M,y=f.particle_systems,S=0;S<y.length;S++){var B=y[S].settings.b4w_vcol_from_name,
D=y[S].settings.b4w_vcol_to_name;""!==B&&""!==D&&(z.Cb[B]={Hg:!1,src:[{name:B,pd:7}]})}"DYNAMIC"==b.type&&(M.oi=f.uuid);F(M,l);var G=ca.Es(k,v,M.sj,b.Dh,M.Cb,M.ph);"LENS_FLARES"==w.name&&(G=ma.hD(G));g.push({C:M,Xc:G,sc:[w.name],f:b,Gd:[a]})}}}var V=f.particle_systems;if(0<V.length&&g.length){for(var E=!1,U=!1,p=0;p<V.length;p++){var K=V[p],J=K.settings;J.use_render_emitter&&(E=!0);"HAIR"!=J.type||"OBJECT"!=J.render_type&&"GROUP"!=J.render_type&&K.transforms.length||(U=!0);if(E&&U)break}var ia=g[0].C.Cb,
aa;if(U){var L;if(1<m.length){for(var ga={},na=0;na<V.length;na++){var ba=V[na].settings;if("HAIR"==ba.type&&("OBJECT"==ba.render_type||"GROUP"==ba.render_type)){var W=ba.b4w_vcol_from_name,R=ba.b4w_vcol_to_name;""!==W&&""!==R&&(ga[W]=fa.na(ia[W]))}}"a_bending_col_main"in ia&&(ga.a_bending_col_main=fa.na(ia.a_bending_col_main));"a_bending_col_detail"in ia&&(ga.a_bending_col_detail=fa.na(ia.a_bending_col_detail));L=ca.Fs(k,[],ga)}else L=g[0].Xc;aa=L}else aa=null;for(var ea,T=aa,da=a.Ha,X=[],ha=da.particle_systems,
la=da.data,oa=0;oa<ha.length;oa++){var qa=ha[oa],sa=qa.settings;if(sa.count)if("EMITTER"==sa.type){if("DYNAMIC"==b.type){var jb=d("PARTICLES"),$a,Ja=la.materials,ec=qa.settings.material-1;ec>=Ja.length&&(Q.warn('Wrong material used for rendering particle system "'+qa.name+'"'),ec=0);$a=Ja[ec];"HALO"===qa.settings.render_type&&(jb.Ig=!0);e(jb,$a);var ub=jb,Aa=qa.settings;switch(Aa.b4w_billboard_align){case "VIEW":t(ub,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":t(ub,"BILLBOARD_ALIGN",
"BILLBOARD_ALIGN_XY");break;case "YZ":t(ub,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":t(ub,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}t(ub,"BILLBOARD",0);t(ub,"SOFT_PARTICLES",Aa.b4w_enable_soft_particles&&0<Aa.b4w_particles_softness&&Y.yj?1:0);t(ub,"SOFT_STRENGTH",P.r(Aa.b4w_particles_softness));P.H(ub.ab,"WORLD_SPACE","WORLD"==Aa.b4w_coordinate_system?1:0);jb.Vd=!0;jb.oi=a.name+"_"+sa.uuid;jb.mD=qa.name;F(jb,l);ma.HB(jb,qa,$a);var qb=ma.LA(jb,
la,qa,a.f.za);X.push({C:jb,Xc:qb,sc:[$a.name],f:b,Gd:[a]})}}else if("HAIR"==sa.type){var Z=fa.Ul(qa.seed);sa.b4w_dynamic_grass&&(b.Hh=!0);var db=O.Ur(Y.fp)&&!sa.b4w_initial_rand_rotation&&!sa.b4w_hair_billboard,Ca=4;db&&(Ca=8);if(qa.transforms.length)var va=qa.transforms;else for(var Fa=ca.yo(T,sa.count,!1,Z),va=new Float32Array(Fa.length*Ca),Ga=0;Ga<Fa.length;Ga++){var fc=.75+.5*fa.rd(Z);va[Ga*Ca]=Fa[Ga][0];va[Ga*Ca+1]=Fa[Ga][1];va[Ga*Ca+2]=Fa[Ga][2];va[Ga*Ca+3]=fc;db&&(va[Ga*Ca+4]=1,va[Ga*Ca+5]=
0,va[Ga*Ca+6]=0,va[Ga*Ca+7]=0)}var Xa=ra.Sa(c,"GRASS_MAP")?!0:!1;if("OBJECT"==sa.render_type)var lb=[u(c,sa.dupli_object.Fc.f,!0)],Lb=C(a,b,ia,T,[sa.dupli_object.Fc],lb,[va],sa,qa,Xa,Z,!1),X=X.concat(Lb);else if("GROUP"==sa.render_type){for(var Cb=[],sc=sa.dupli_group.objects,Ga=0;Ga<sc.length;Ga++)Cb.push(sc[Ga].Fc);for(var Wb=!1,lb=[],Ga=0;Ga<Cb.length;Ga++){var $b=u(c,sa.dupli_group.objects[Ga].Fc.f,!0);lb.push($b)}if(sa.use_whole_group){for(var ab,vb=va,gc=Cb,Ec=db,Mb=Ca,rb={},sb=new Float32Array([0,
0,0,1]),Qa=0;Qa<vb.length;Qa+=Mb)for(var Va=0;Va<gc.length;Va++){var Db=ka.create();ka.scale(gc[Va].f.i,gc[Va].f.scale,Db);var hc=ka.clone([vb[Qa],vb[Qa+1],vb[Qa+2]]);rb[Va]||(rb[Va]=new Float32Array(vb.length));Ec&&(rb[Va][Qa+4]=sb[0]=vb[Qa+4],rb[Va][Qa+5]=sb[1]=vb[Qa+5],rb[Va][Qa+6]=sb[2]=vb[Qa+6],rb[Va][Qa+7]=sb[3]=vb[Qa+7],fa.Hp(sb,sb),fa.TE(Db,sb,Db));ka.add(hc,Db,hc);rb[Va][Qa]=hc[0];rb[Va][Qa+1]=hc[1];rb[Va][Qa+2]=hc[2];rb[Va][Qa+3]=vb[Qa+3]}ab=rb;Wb=!0}else{var tc;if(sa.use_group_count){for(var eb=
va,uc=Cb,Nb=sa.dupli_weights,fb=Z,Ma=db,wb=Ca,gb={},Oa=[],Ha=0;Ha<uc.length;Ha++)for(var mb=uc[Ha],za=mb.Yg||mb.name,nb=0;nb<Nb.length;nb++){var ob=Nb[nb];za==ob.name&&Oa.push(ob)}Nb.length!=Oa.length&&Q.error("dupli weights match failed");for(Ha=0;Ha<eb.length;Ha+=wb){for(var xb,Na=Oa,Ob=[0],bb=0;bb<Na.length;bb++)Ob[bb+1]=Ob[bb]+Na[bb].count;for(var lc=Ob[Ob.length-1]*fa.rd(fb),Xb=0,bb=0;bb<Ob.length;bb++)if(lc>=Ob[bb]&&lc<Ob[bb+1]){Xb=bb;break}xb=Xb;gb[xb]=gb[xb]||[];gb[xb].push(eb[Ha],eb[Ha+1],
eb[Ha+2],eb[Ha+3]);Ma&&gb[xb].push(eb[Ha+4],eb[Ha+5],eb[Ha+6],eb[Ha+7])}for(xb in gb)gb[xb]=new Float32Array(gb[xb]);tc=gb}else{for(var Eb=va,Fb=Z,kb=db,Kb=Ca,ac=Cb.length,Za={},Ea=0;Ea<Eb.length;Ea+=Kb){var Pa=Math.floor(ac*fa.rd(Fb));Za[Pa]=Za[Pa]||[];Za[Pa].push(Eb[Ea],Eb[Ea+1],Eb[Ea+2],Eb[Ea+3]);kb&&Za[Pa].push(Eb[Ea+4],Eb[Ea+5],Eb[Ea+6],Eb[Ea+7])}for(Pa in Za)Za[Pa]=new Float32Array(Za[Pa]);tc=Za}ab=tc}Lb=C(a,b,ia,T,Cb,lb,ab,sa,qa,Xa,Z,Wb);X=X.concat(Lb)}"INSTANCE"==sa.b4w_wind_bend_inheritance&&
a.f.bd&&Q.warn('Emitter object "'+a.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}ea=X;g=E?g.concat(ea):ea}return g}function l(a,b,c,d){a.qn=ea.hs(b,d);a.on=ea.fs(c,d);a.pn=ea.gs(b,d)}function u(a,b,c){var d;b.Cl&&!c?(d=[],b.Ne&&ra.Sa(a,"COLOR_PICKING")&&d.push("COLOR_ID")):(d=["MAIN","NODES_GLOW"],(b.Ne&&ra.Sa(a,"COLOR_PICKING")||b.tb&&ra.Sa(a,
"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID"),ra.Sa(a,"WIREFRAME")&&d.push("WIREFRAME"),(ra.Sa(a,"DEPTH")||ra.Sa(a,"SHADOW_CAST"))&&d.push("DEPTH"),ra.Sa(a,"GRASS_MAP")&&d.push("GRASS_MAP"));d.push("PHYSICS");if(b.xc||b.Yb)for(a=null,b.xc&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.Yb&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?fa.ky(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function e(a,b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render)c=
!1;else{if(b.use_nodes)v(a,b,"MAIN");else{g(a,b);var d=b.game_settings.alpha_blend;a.We=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.Xg=b.offset_z;a.Sf.set([1,1,1]);var e=b.texture_slots;da.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.pc);switch(b.name){case "LENS_FLARES":K(a,"special_lens_flares.glslv","special_lens_flares.glslf");y(a,"a_position");y(a,"a_texcoord");var f=q(e[0],null);x(a,f);break;default:K(a,"main_stack.glslv","main_stack.glslf");b.use_shadeless||(c=
ha.Sn(b.uuid,b.name,{$c:b.use_shadeless,zj:b.diffuse_shader,Bi:b.specular_shader}),a.ab.zf=ha.rl(c));var l=z("use_map_color_diffuse",e),k=z("use_map_color_spec",e),m=z("use_map_normal",e),n=z("use_map_mirror",e),f=z("use_stencil",e);c=l[0];k=k[0];m=m[0];n=n[0];l=l[1];e=f[0]&&z("use_rgb_to_intensity",e)[0];if(c){switch(c.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}f=q(c,null);x(a,f,"u_colormap0");
Y.gn&&"CLIP"==d&&ia.wk(f,ia.Dc,ia.Dc);a.kf=c.diffuse_color_factor;a.af=c.use_map_alpha?c.alpha_factor:0;a.Sf.set(c.scale)}d=c&&c==k;k&&(d||(f=q(k,null),x(a,f,"u_specmap0")),a.kh=k.specular_color_factor);if(m&&(y(a,"a_normal"),y(a,"a_tangent"),f=q(m,null),x(a,f,"u_normalmap0"),a.cu=m.normal_factor,f=m.texture,f.b4w_use_map_parallax&&Y.jk)){var r=P.r(f.b4w_parallax_steps),u=P.r(f.b4w_parallax_lod_dist);t(a,"PARALLAX",1);t(a,"PARALLAX_STEPS",r);t(a,"PARALLAX_LOD_DIST",u);a.parallax_scale=f.b4w_parallax_scale}n&&
(f=q(n,null),x(a,f,"u_mirrormap"),a.mp=n.mirror_factor);if(n=c&&l&&e?1:0)f=q(l,null),x(a,f,"u_colormap1"),f=q(e,null),x(a,f,"u_stencil0");(f=c||k||m)&&a.Sf.set(f.scale);t(a,"TEXTURE_SPEC",void 0==k?0:1);t(a,"ALPHA_AS_SPEC",d?1:0);t(a,"TEXTURE_STENCIL_ALPHA_MASK",n);y(a,"a_position");y(a,"a_normal");(c||k||m)&&y(a,"a_texcoord");if(b.b4w_water){a.ag=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.Ia?(Q.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.Xm=
!1):a.Xm=b.b4w_water_shore_smoothing;K(a,"special_water.glslv","special_water.glslf");d=ha.Sn(b.uuid,b.name,{$c:!1,zj:b.diffuse_shader,Bi:b.specular_shader});a.ab.zf=ha.rl(d);y(a,"a_position");Y.hw?(y(a,"a_polyindex"),a.da=!0,a.wireframe_edge_color=[0,0,0],t(a,"DEBUG_WIREFRAME",1)):t(a,"DEBUG_WIREFRAME",0);n=b.texture_slots;d=z("use_map_normal",n);f=z("use_map_mirror",n)[0];d.length&&(r=q(d[0]),x(a,r,"u_normalmap0"),a.Zi=b.b4w_water_norm_uv_velocity);t(a,"NUM_NORMALMAPS",d.length);a.Wg=Array(d.length);
for(r=0;r<d.length;r++)a.Wg[r]=new Float32Array(2),a.Wg[r].set([d[r].scale[0],d[r].scale[1]]);f&&(r=q(f),x(a,r,"u_mirrormap"),a.mp=f.mirror_factor);f=null;if(Y.Nh)for(r=0;r<n.length;r++){var p=n[r];if(!0===p.texture.b4w_water_foam){f=p;break}}f?(t(a,"FOAM",1),r=q(f),x(a,r,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Ks.set(f.texture.b4w_foam_uv_freq),a.Js.set(f.texture.b4w_foam_uv_magnitude),a.ro[0]=f.scale[0],a.ro[1]=f.scale[1]):t(a,"FOAM",0);for(r=0;r<n.length;r++)if(p=n[r],!0===p.texture.b4w_shore_dist_map){var w=
p;break}w&&Y.fn?(w=q(w),x(a,w,"u_shore_dist_map"),t(a,"SHORE_PARAMS",1),w=p.texture.b4w_shore_boundings,t(a,"MAX_SHORE_DIST",P.r(p.texture.b4w_max_shore_dist)),t(a,"SHORE_MAP_SIZE_X",P.r(w[0]-w[1])),t(a,"SHORE_MAP_SIZE_Y",P.r(w[2]-w[3])),t(a,"SHORE_MAP_CENTER_X",P.r((w[0]+w[1])/2)),t(a,"SHORE_MAP_CENTER_Y",P.r((w[2]+w[3])/2))):t(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&Y.yj)t(a,"GENERATED_MESH",1),a.ew=!0,a.fw=b.b4w_water_num_cascads,a.gw=b.b4w_water_subdivs,a.dw=b.b4w_water_detailed_dist;else{y(a,
"a_normal");if(f||d.length)y(a,"a_texcoord"),y(a,"a_tangent");t(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){var p=P.r(b.b4w_water_dst_noise_scale0),w=P.r(b.b4w_water_dst_noise_scale1),d=P.r(b.b4w_water_dst_noise_freq0),n=P.r(b.b4w_water_dst_noise_freq1),f=P.r(b.b4w_water_dir_min_shore_fac),r=P.r(b.b4w_water_dir_freq),u=P.r(b.b4w_water_dir_noise_scale),M=P.r(b.b4w_water_dir_noise_freq),O=P.r(b.b4w_water_dir_min_noise_fac),S=P.r(b.b4w_water_dst_min_fac),F=P.r(b.b4w_water_waves_hor_fac);t(a,"DST_NOISE_SCALE_0",
p);t(a,"DST_NOISE_SCALE_1",w);t(a,"DST_NOISE_FREQ_0",d);t(a,"DST_NOISE_FREQ_1",n);t(a,"DIR_MIN_SHR_FAC",f);t(a,"DIR_FREQ",r);t(a,"DIR_NOISE_SCALE",u);t(a,"DIR_NOISE_FREQ",M);t(a,"DIR_MIN_NOISE_FAC",O);t(a,"DST_MIN_FAC",S);t(a,"WAVES_HOR_FAC",F)}D(a,b);B(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;t(a,"ABSORB",P.r(b.b4w_water_absorb_factor));t(a,
"SSS_STRENGTH",P.r(b.b4w_water_sss_strength));t(a,"SSS_WIDTH",P.r(b.b4w_water_sss_width))}"HALO"===b.type&&(p=b.halo,K(a,"halo.glslv","halo.glslf"),t(a,"NUM_RINGS",p.ring_count),t(a,"NUM_LINES",p.line_count),t(a,"NUM_STARS",p.star_tip_count),t(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.sj=["a_position"],a.qt=p.size,a.nt=p.hardness/20,a.pt.set(p.b4w_halo_rings_color),a.ot.set(p.b4w_halo_lines_color),a.rt=1/b.b4w_halo_stars_blend_height,a.st=b.b4w_halo_stars_min_height,a.mt=!0);t(a,"TEXCOORD",0);t(a,
"NORMAL_TEXCOORD",0);c&&h(a,c,"TEXTURE_COLOR0_CO");l&&h(a,l,"TEXTURE_COLOR1_CO");e&&h(a,e,"TEXTURE_STENCIL_ALPHA_MASK_CO");k&&h(a,k,"TEXTURE_SPEC_CO");m&&h(a,m,"TEXTURE_NORM_CO");t(a,"SHADELESS",b.use_shadeless?1:0);a.$c=b.use_shadeless}d=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===d?0:1);t(a,"ALPHA_CLIP","CLIP"===d?1:0);t(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(t(a,"VERTEX_COLOR",1),y(a,"a_color")):t(a,"VERTEX_COLOR",0);a.oe=b.ambient;a.lf=b.diffuse_intensity;
a.Ae=b.emit;a.ce.set(b.specular_color);a.eq=b.specular_alpha;D(a,b);B(a,b);b.b4w_wettable?t(a,"WETTABLE",1):t(a,"WETTABLE",0);G(a,b);a.Lp=b.b4w_refractive;a.Iu=b.b4w_refr_bump}c=!0}break;case "NODES_GLOW":c=v(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(g(a,b),a.Ia)c=!1;else{k=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==k?v(a,b,"DEPTH"):(K(a,"depth.glslv","depth.glslf"),da.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],
b.alpha,a.pc));y(a,"a_position");y(a,"a_normal");t(a,"ALPHA","OPAQUE"===k?0:1);a.Sf.set([1,1,1]);if((c=z("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===k){a.Sf.set(c.scale);t(a,"TEXTURE_COLOR",1);y(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)k=q(c),x(a,k,"u_colormap0");"NONE"==c.texture.k.source&&(k=q(c),x(a,k,"u_colormap0"))}else t(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.Jk=b.b4w_use_ghost,a.gb=b.b4w_collision_id,a.qj=b.b4w_collision_margin,
a.oj=b.b4w_collision_group,a.rj=b.b4w_collision_mask,a.Kj=b.physics.friction,a.Ej=b.physics.elasticity,c=!0):b.b4w_water?(a.ag=!0,a.bG=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,
a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||"HALO"===b.type)c=!1;else{g(a,b);a.Ye=ca.ne;a.da=!0;a.Ia=!1;k=b.game_settings.alpha_blend;a.We=b.b4w_render_above_all&&"OPAQUE"!=k&&"CLIP"!=k;b.use_nodes&&"CLIP"==k?v(a,b,"COLOR_ID"):(K(a,"color_id.glslv","color_id.glslf"),da.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.pc));y(a,"a_position");
t(a,"ALPHA","OPAQUE"===k?0:1);a.Sf.set([1,1,1]);if((c=z("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===k){a.Sf.set(c.scale);t(a,"TEXTURE_COLOR",1);y(a,"a_texcoord");if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)k=q(c),x(a,k,"u_colormap0");"NONE"==c.texture.k.source&&(k=q(c),x(a,k,"u_colormap0"))}else t(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(g(a,b),a.Ia=!1,a.Ye=ca.ne,a.da=!0,K(a,"grass_map.glslv","grass_map.glslf"),
y(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,k=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Cb.a_grass_size={Hg:!0,src:[]},c?(a.Cb.a_grass_size.src.push({name:c,pd:4}),t(a,"DYNAMIC_GRASS_SIZE",1)):t(a,"DYNAMIC_GRASS_SIZE",0),a.Cb.a_grass_color={Hg:!0,src:[]},k?(a.Cb.a_grass_color.src.push({name:k,pd:7}),t(a,"DYNAMIC_GRASS_COLOR",1)):t(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===
b.type?c=!1:(K(a,"wireframe.glslv","wireframe.glslf"),y(a,"a_position"),y(a,"a_normal"),y(a,"a_polyindex"),a.da=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=!1;else{c=b.texture_slots;if(a.Ig)K(a,"particles_color.glslv","particles_color.glslf");else if(K(a,"particles_texture.glslv","particles_texture.glslf"),k=ha.Sn(b.uuid,b.name,{$c:!1,zj:b.diffuse_shader,Bi:b.specular_shader}),a.ab.zf=ha.rl(k),c=z("use_map_color_diffuse",c)[0]){t(a,"TEXTURE_COLOR",
1);switch(c.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.kf=c.diffuse_color_factor;a.af=c.use_map_alpha?c.alpha_factor:0;c=q(c);x(a,c)}da.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.pc);a.oe=b.ambient;a.lf=b.diffuse_intensity;a.Ae=b.emit;a.ce.set(b.specular_color);a.eq=b.specular_alpha;y(a,"a_position");y(a,"a_normal");c=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===
c?0:1);t(a,"ALPHA_CLIP","CLIP"===c?1:0);t(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);D(a,b);B(a,b);g(a,b);c=b.game_settings.alpha_blend;a.We=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.Xg=b.offset_z;c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function h(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":t(a,c,"TEXTURE_COORDS_UV_ORCO");t(a,"TEXCOORD",1);break;case "NORMAL":t(a,c,"TEXTURE_COORDS_NORMAL");t(a,"NORMAL_TEXCOORD",1);break;default:t(a,c,0)}}function g(a,b){var c=
b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Ia=!0;a.Ye=ca.fr;a.da=!0;a.jg=!1;break;case "ALPHA":a.Ia=!0;a.Ye=ca.ne;a.da=!0;a.jg=!1;break;case "CLIP":a.Ia=!1;a.Ye=ca.ne;a.da=!0;a.jg=!0;break;case "ADD":a.Ia=!0;a.Ye=ca.ne;a.da=!1;a.jg=!1;break;case "OPAQUE":a.Ia=!1;a.Ye=ca.ne;a.da=!0;a.jg=!1;break;default:throw Error("Unknown alpha blend mode: "+d);}a.Wa=c.use_backface_culling}function q(a,b){var c=a.texture,d=c.k,c=c.image;d&&b&&c&&ia.Fk(d,b,c.Ec,c.filepath);return d}function z(a,
b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.k&&c.push(f)}return c}function G(a,b){var c=b.raytrace_transparency;a.Bd[0]=c.fresnel;a.Bd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.Bd[2]=c.fresnel;a.Bd[3]=1-c.fresnel_factor/5}function D(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;
break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:Q.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.zc[0]=b.specular_intensity;a.zc[1]=c;a.zc[2]=d}function B(a,b){switch(b.diffuse_shader){case "LAMBERT":a.Kc[0]=0;a.Kc[1]=0;break;case "OREN_NAYAR":a.Kc[0]=b.roughness;a.Kc[1]=0;break;case "FRESNEL":a.Kc[0]=b.diffuse_fresnel;a.Kc[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.Kc[0]=b.darkness;a.Kc[1]=0;break;case "TOON":a.Kc[0]=
b.diffuse_toon_size;a.Kc[1]=b.diffuse_toon_smooth;break;default:Q.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Kc[0]=0,a.Kc[1]=0}}function v(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":K(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":K(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":K(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":K(a,"color_id.glslv","color_id.glslf"),d=!1}c=ha.gz(b.node_tree,b.uuid,
!1,b.name,c);if(!c)return Q.error('Failed to create node graph for material "'+b.name+'", disable nodes'),E(a,b),!0;a.Vh=!0;t(a,"NODES",1);t(a,"NODES_GLOW",d?1:0);var e=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===e?0:1);t(a,"ALPHA_CLIP","CLIP"===e?1:0);t(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);y(a,"a_position");b.use_orco_tex_coord&&y(a,"a_orco_tex_coord");g(a,b);a.Xg=b.offset_z;e=b.game_settings.alpha_blend;a.We=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;da.set(b.diffuse_color[0],
b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.pc);a.Ae=b.emit;a.oe=b.ambient;G(a,b);b.b4w_wettable?t(a,"WETTABLE",1):t(a,"WETTABLE",0);a.ab.zf=ha.rl(c);var f=!1;oa.V(c,function(b,c){switch(c.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var d=c.data.name,g=c.data.value;a.ph||(a.ph={});a.ph[g]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.Cb[d]={Hg:!0,src:[{name:c.data.value}]};g=0;if("GEOMETRY_VC"==c.type)g=7;
else for(var h=0;h<c.ra.length;h++){var l="RGB".indexOf(c.ra[h].identifier);-1<l&&(g|=1<<2-l)}a.Cb[d].src[0].pd=g;break;case "TEX_COORD_NO":case "GEOMETRY_NO":y(a,"a_normal");break;case "MATERIAL_BEGIN":y(a,"a_normal");f=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;g=c.data.value;!1!==g.k.Xk&&(g.k.Xk="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);x(a,g.k,d);Y.gn&&"CLIP"==e&&ia.wk(c.data.value.k,ia.Dc,ia.Dc);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":t(a,"CALC_TBN_SPACE",1);y(a,
"a_normal");y(a,"a_tangent");d=c.data.name;g=c.data.value;g.k.Xk=!1;x(a,g.k,d);break;case "LAMP":c.data&&(a.ai=c.data);break;case "B4W_REFRACTION":a.Lp=!0}});f||(a.$c=!0);return!0}function E(a,b){switch(a.type){case "DEPTH":K(a,"depth.glslv","depth.glslf");break;case "COLOR_ID":K(a,"color_id.glslv","color_id.glslf");break;default:K(a,"main_stack.glslv","main_stack.glslf")}t(a,"SHADELESS",1);y(a,"a_position");y(a,"a_normal");da.set(1,0,1,1,a.pc);if(b){var c=b.game_settings.alpha_blend;t(a,"ALPHA",
"OPAQUE"===c?0:1);t(a,"ALPHA_CLIP","CLIP"===c?1:0);t(a,"VERTEX_COLOR",0);a.Xg=b.offset_z;g(a,b)}return!0}function A(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Yl?t(a,"AU_QUALIFIER","attribute"):t(a,"AU_QUALIFIER","uniform"),t(a,"STATIC_BATCH",0)):(t(a,"AU_QUALIFIER","attribute"),t(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(T.qB()?t(a,"WIREFRAME_QUALITY",1):t(a,"WIREFRAME_QUALITY",0),a.xg?(t(a,"DEBUG_SPHERE",1),a.qs?t(a,"DEBUG_SPHERE_DYNAMIC",1):t(a,"DEBUG_SPHERE_DYNAMIC",0)):t(a,"DEBUG_SPHERE",
0),t(a,"ALPHA",1));b.je&&(a.je=b.je);b.bd?(""!==b.He?(a.Cb.a_bending_col_main={Hg:!0,src:[{name:b.He,pd:4}]},y(a,"a_bending_col_main"),""!==b.Ub.Mt&&""!==b.Ub.Lt&&""!==b.Ub.mu?(a.Cb.a_bending_col_detail={Hg:!0,src:[{name:b.Ub.Mt,pd:4},{name:b.Ub.Lt,pd:2},{name:b.Ub.mu,pd:1}]},y(a,"a_bending_col_detail"),y(a,"a_normal"),t(a,"DETAIL_BEND",1)):t(a,"DETAIL_BEND",0),t(a,"MAIN_BEND_COL",1)):t(a,"MAIN_BEND_COL",0),t(a,"WIND_BEND",1)):t(a,"WIND_BEND",0);b.gl?t(a,"BEND_CENTER_ONLY",1):t(a,"BEND_CENTER_ONLY",
0);t(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.tn|0);b.vd?t(a,"BILLBOARD",1):t(a,"BILLBOARD",0);b.vd&&b.Yl?t(a,"HAIR_BILLBOARD",1):t(a,"HAIR_BILLBOARD",0);b.gj?t(a,"BILLBOARD_SPHERICAL",1):t(a,"BILLBOARD_SPHERICAL",0);switch(b.hj){case "RANDOM":t(a,"BILLBOARD_RANDOM",1);t(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":t(a,"BILLBOARD_RANDOM",0);t(a,"BILLBOARD_JITTERED",1);break;default:t(a,"BILLBOARD_RANDOM",0),t(a,"BILLBOARD_JITTERED",0)}b.Fb&&Y.fn?t(a,"DYNAMIC_GRASS",1):t(a,"DYNAMIC_GRASS",0);a.Fb=
b.Fb;a.Vd=b.Vd;a.Vc=b.Vc;a.xc=b.xc;a.yc=b.yc&&!a.$c&&!(a.Ia&&Y.ws);a.jc=b.jc;a.Yb=b.Yb;a.wc=b.wc;b.$h?(y(a,"a_influence"),t(a,"SKINNED",1),b.Jj?t(a,"FRAMES_BLENDING",1):t(a,"FRAMES_BLENDING",0),t(a,"MAX_BONES",b.Je)):(t(a,"SKINNED",0),t(a,"FRAMES_BLENDING",0));b.Qb?(t(a,"VERTEX_ANIM",1),Y.Yv?t(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):t(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):t(a,"VERTEX_ANIM",0);if(b.$h&&b.Qb)throw"Skinning and vertex animation are mutually exlusive";b.Bl?t(a,"DISABLE_FOG",
1):t(a,"DISABLE_FOG",0);if(a.Vh){for(var c=a.ab.zf,d=b.Sg,e=b.Rg,f=0;f<c.length;f++){var g=c[f];switch(g.id){case "VALUE":var h=g.lm[0];if(h)for(var l=0;l<d.length;l+=2)if(d[l]==h){g.kd.push(["VALUE_IND",d[l+1]]);break}break;case "RGB":if(h=g.lm[0])for(l=0;l<e.length;l+=2)if(e[l]==h){g.kd.push(["RGB_IND",e[l+1]]);break}}}t(a,"NUM_VALUES",b.Ie.length);t(a,"NUM_RGBS",b.Pc.length)}}}function r(a,b,c){if(b.length){for(var d=na.Co(b)||b[0],e=a.ab,f=0,g=0;g<a.ab.zf.length;g++){var h=a.ab.zf[g];if("LIGHTING_LAMP"==
h.id){var l=b[f++%b.length],k=l.Na;"AREA"==k.type&&(l=b[f++%b.length],k=l.Na);var n=na.Ma(l,c);if("SPOT"==k.type||"POINT"==k.type)var q=Math.cos(k.Qe/2);if("SPOT"==k.type)var r=k.zk*(1-q);n=n.ak;l=l==d?0:-1;h.kd=[["LAMP_TYPE",k.type],["LAMP_IND",n],["LAMP_LIGHT_FACT_IND",Math.floor(n/2)],["LAMP_FAC_CHANNELS",0==n%2?"rg":"ba"],["LAMP_SPOT_SIZE",P.r(q||.01)],["LAMP_SPOT_BLEND",P.r(r||.01)],["LAMP_LIGHT_DIST",P.r(k.distance)],["LAMP_SHADOW_MAP_IND",l]]}}if(a.ai){c=0;for(var u in a.ai)c++;a.Xo=new Float32Array(3*
c);a.Vo=new Float32Array(3*c);a.Uo=new Float32Array(3*c);a.Wo=new Float32Array(4*c);P.H(e,"NUM_LAMP_LIGHTS",c);for(g=0;g<b.length;g++)m(a,b[g])}}}function m(a,b){var c=b.Ha.uuid;if(c in a.ai){c=a.ai[c];a.Xo.set(b.f.i,3*c);a.Vo.set(b.Na.direction,3*c);a.Uo.set(b.Na.ql,3*c);var d=qa,e=b.Na;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.oh?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var f=d[0]=Math.cos(e.Qe/2);d[1]=e.zk*(1-f)}a.Wo.set(d,4*c)}}function y(a,b){var c=a.sj;-1==c.indexOf(b)&&
c.push(b)}function t(a,b,c){P.H(a.ab,b,c)}function J(a,b){if("PHYSICS"==a.type)a.Xc=b;else{var c=a.Ye,d=a.ze;a.mt&&(b=ca.tA(b));a.ew&&(b=W.QA(a.fw,a.gw,a.dw));c=ca.IE(b,c,d,a.Cb);a.R=c;a.Vd||c.Tl||a.je||(c.sf=null,c.ad=null);c=b.B.length;a.num_vertices=b.P*c;a:switch(a.ze){case ca.aj:case ca.Rk:case ca.Qk:d=!0;break a;default:d=!1}d?ca.PB(b)?a.num_triangles=b.pa.length/3*c:a.num_triangles=b.P/3*c:a.num_triangles=0}}function C(a,b,c,e,f,g,h,l,k,m,n,q){var r=[],u=l.b4w_dynamic_grass;if(!m&&u)return r;
for(var p="INSTANCE"==l.b4w_wind_bend_inheritance,t="INSTANCE"==l.b4w_shadow_inheritance,x="INSTANCE"==l.b4w_reflection_inheritance,v=[],w=[],z=0;z<f.length;z++){var y=f[z],S=fa.nj(b);S.vd=l.b4w_hair_billboard;S.hj=l.b4w_hair_billboard_type;S.gj="SPHERICAL"==l.b4w_hair_billboard_geometry;S.Fb=u;S.Yl=!0;S.Ie=y.f.Ie;S.Sg=y.f.Sg;S.Pc=y.f.Pc;S.Rg=y.f.Rg;p?(S.bd=y.f.bd,S.Mk=y.f.Mk,S.Ve=y.f.Ve,S.we=y.f.we,S.He=y.f.He,S.ve=y.f.ve,S.qe=y.f.qe,S.ke=y.f.ke,S.Ub=y.f.Ub,S.gl=!1):(S.bd=a.f.bd,S.Mk=a.f.Mk,S.Ve=
a.f.Ve,S.we=a.f.we,S.He=a.f.He,S.ve=a.f.ve,S.qe=a.f.qe,S.ke=a.f.ke,S.Ub=a.f.Ub,S.gl=!0);t?(S.Vc=y.f.Vc,S.xc=y.f.xc,S.yc=y.f.yc):(S.Vc=a.f.Vc,S.xc=a.f.xc,S.yc=a.f.yc);x?(S.jc=y.f.jc,S.Yb=y.f.Yb,S.wc=y.f.wc,S.hd=y.f.hd,S.Sc=y.f.Sc,S.ae=y.f.ae):(S.jc=a.f.jc,S.Yb=a.f.Yb,S.wc=a.f.wc,S.hd=a.f.hd,S.Sc=a.f.Sc,S.ae=a.f.ae);v.push(S);var B=h[z];B||(B=new Float32Array);q&&fa.Ul(k.seed,n);var D=new Float32Array(3),C=new Float32Array([0,0,0,1]),G=[],V=O.Ur(Y.fp)&&!l.b4w_initial_rand_rotation&&!l.b4w_hair_billboard,
P=4;V&&(P=8);for(var E=0;E<B.length;E+=P){D[0]=B[E];D[1]=B[E+1];D[2]=B[E+2];var U=B[E+3]*y.f.scale;if(l.b4w_initial_rand_rotation){switch(l.b4w_rotation_type){case "XYZ":var K=new Float32Array([fa.rd(n),fa.rd(n),fa.rd(n)]);ka.normalize(K,K);break;case "Z":K=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+l.b4w_rotation_type;}M.setAxisAngle(K,l.b4w_rand_rotation_strength*(2*Math.PI*fa.rd(n)-Math.PI),C)}else V&&(C.set(B.subarray(E+4,E+8)),fa.Hp(C,C),l.use_whole_group||
(l.use_rotation_dupli?M.multiply(C,y.f.quat,C):M.multiply(C,L,C)));var ra=ga.create_sep(D,U,C);G.push(ra)}w.push(G)}for(var J={},z=0;z<f.length;z++){var y=f[z],ia=y.Ha,aa=g[z],S=v[z],ba={};S.bd&&(ba.au_wind_bending_amp=[S.ke],ba.au_wind_bending_freq=[S.Ve],ba.au_detail_bending_freq=[S.we],ba.au_detail_bending_amp=[S.ve],ba.au_branch_bending_amp=[S.qe],S.ke=0,S.Ve=0,S.we=0,S.ve=0,S.qe=0);var na=N(S),G=w[z];if(G.length)for(var W=ia.data,R=W.materials,ma=Array(R.length),E=0;E<R.length;E++)if(!ca.tt(W,
E))for(var ea=0;ea<aa.length;ea++){var T=aa[ea],X=d(T),ha=R[E];"COLOR_ID"==T&&(X.Fn=!(ia.b4w_do_not_render||ha.b4w_do_not_render));"MAIN"==T&&(ma[E]=X);if(I(X,ha)){"DEPTH"==T&&ma[E]&&(X.$c=ma[E].$c);X.ze=ca.aj;A(X,S);X.oi=l.uuid;"JITTERED"==l.b4w_hair_billboard_type&&(X.Ht=l.b4w_hair_billboard_jitter_amp,X.It=l.b4w_hair_billboard_jitter_freq);u&&(X.kt=l.b4w_dynamic_grass_scale_threshold);p||(delete X.Cb.a_bending_col_main,delete X.Cb.a_bending_col_detail);F(X,na);var la=ca.Es(W,E,X.sj,b.Dh,X.Cb,X.ph),
sa=ca.wC(la,ba,G),qa=sa,oa=G;qa.L.au_center_pos=new Float32Array(3*qa.P);for(var ec=oa.length,ub=qa.P/ec,Aa=0;Aa<ec;Aa++)for(var qb=oa[Aa],Z=3*ub*Aa,db=0;db<ub;db++)qa.L.au_center_pos[Z+3*db]=qb[0],qa.L.au_center_pos[Z+3*db+1]=qb[1],qa.L.au_center_pos[Z+3*db+2]=qb[2];sa=qa;if(S.bd&&S.gl){var Ca=sa,va=a.f.aa;Ca.L.a_emitter_center=new Float32Array(3*Ca.P);var Fa=da.fromValues(0,0,0,1);da.transformMat4(Fa,va,Fa);for(var Ga=0;Ga<Ca.P;Ga++)Ca.L.a_emitter_center[3*Ga]=Fa[0],Ca.L.a_emitter_center[3*Ga+1]=
Fa[1],Ca.L.a_emitter_center[3*Ga+2]=Fa[2];sa=Ca}var fc=l.b4w_vcol_from_name,Xa=l.b4w_vcol_to_name,lb=X,Lb=c,Cb=!p,sc=W,Wb=[];if(""!==fc&&""!==Xa){var $b,ab=Xa,vb=lb.Cb,gc=[],Ec=void 0;for(Ec in vb)for(var Mb=vb[Ec].src,rb=0,sb=0;sb<Mb.length;sb++){var Qa=Mb[sb].pd;ab==Mb[sb].name&&gc.push(Ec,Qa,rb);rb+=fa.hh(Qa)}$b=gc;if(0<$b.length)for(var Va=0;Va<$b.length;Va+=3)Wb.push({Fj:fc,Gl:7,mm:$b[Va],nm:$b[Va+1],Dl:$b[Va+2]});else ca.zB(lb.sj,"a_color")&&Xa==sc.active_vcol_name&&Wb.push({Fj:fc,Gl:7,mm:"a_color",
nm:7,Dl:0})}Cb&&("a_bending_col_main"in Lb&&Wb.push({Fj:"a_bending_col_main",Gl:4,mm:"a_bending_col_main",nm:4,Dl:0}),"a_bending_col_detail"in Lb&&Wb.push({Fj:"a_bending_col_detail",Gl:7,mm:"a_bending_col_detail",nm:7,Dl:0}));for(var Db=sa,hc=G,tc=e,eb=Wb,uc=X.Cb,Nb=!1,fb=0;fb<eb.length;fb++){var Ma=eb[fb].Fj,wb=tc.L[Ma];if(wb&&0<wb.length){Nb=!0;break}}if(Nb){var gb,Oa=a.f.Kb,Ha=tc.B[0].a_position,mb=hc,za=J,nb=new Float32Array(3),ob=new Float32Array(3),xb=new Uint32Array(mb.length);if(!("verts_indices"in
za)){za.te=new Float32Array(3);za.pe=new Float32Array(3);za.Nq=new Uint32Array(Ha.length/3);za.fk=new Uint32Array(Ha.length/3);za.te[0]=(Oa.max_x-Oa.min_x)/20;za.te[1]=(Oa.max_y-Oa.min_y)/20;za.te[2]=(Oa.max_z-Oa.min_z)/20;za.pe[0]=Oa.min_x;za.pe[1]=Oa.min_y;za.pe[2]=Oa.min_z;for(var Na=0;Na<Ha.length/3;Na++){var Ob=fa.trunc((Ha[3*Na]-za.pe[0])/za.te[0]),bb=fa.trunc((Ha[3*Na+1]-za.pe[1])/za.te[1]),lc=fa.trunc((Ha[3*Na+2]-za.pe[2])/za.te[2]),Ob=fa.clamp(Ob,0,19),bb=fa.clamp(bb,0,19),lc=fa.clamp(lc,
0,19);za.Nq[Na]=Na;za.fk[Na]=lc*Math.pow(20,2)+20*bb+Ob}ca.jv(za.fk,za.Nq,ca.bn,!0);za.qh=new Uint32Array(Math.pow(20,3));for(Na=0;Na<za.fk.length;Na++)za.qh[za.fk[Na]]++;delete za.fk;for(Na=1;Na<za.qh.length;Na++)za.qh[Na]+=za.qh[Na-1]}for(var Xb=0;Xb<mb.length;Xb++){nb[0]=mb[Xb][0];nb[1]=mb[Xb][1];nb[2]=mb[Xb][2];for(var Eb=1E10,Fb=-1,kb=fa.trunc((nb[0]-za.pe[0])/za.te[0]),Kb=fa.trunc((nb[1]-za.pe[1])/za.te[1]),ac=fa.trunc((nb[2]-za.pe[2])/za.te[2]),kb=fa.clamp(kb,0,19),Kb=fa.clamp(Kb,0,19),ac=
fa.clamp(ac,0,19),Za=ac*Math.pow(20,2)+20*Kb+kb,Ea=za.qh[Za],Pa=0==Za?0:za.qh[Za-1];Pa<Ea;Pa++){var mc=za.Nq[Pa];ob[0]=Ha[3*mc];ob[1]=Ha[3*mc+1];ob[2]=Ha[3*mc+2];ka.sub(ob,nb,ob);var Gb=ka.sqrLen(ob);Gb<=Eb&&(Eb=Gb,Fb=mc)}if(-1==Fb)for(Pa=0;Pa<Ha.length/3;Pa++)ob[0]=Ha[3*Pa],ob[1]=Ha[3*Pa+1],ob[2]=Ha[3*Pa+2],ka.sub(ob,nb,ob),Gb=ka.sqrLen(ob),Gb<=Eb&&(Eb=Gb,Fb=Pa);xb[Xb]=Fb}gb=xb;for(var Pb=Db.P/hc.length,fb=0;fb<eb.length;fb++){var yb=eb[fb].mm,Ra=eb[fb].nm,Ma=eb[fb].Fj,ic=eb[fb].Gl,wb=tc.L[Ma];switch(yb){case "a_bending_col_main":var cb=
1;break;case "a_bending_col_detail":cb=3;break;case "a_color":cb=3;break;default:for(var zb=cb=0;zb<uc[yb].src.length;zb++)cb+=fa.hh(uc[yb].src[zb].pd)}if(wb&&0<wb.length){var vc=fa.hh(ic),nc=fa.hh(Ra),bc=ic&Ra,cc=fa.Lu(bc);bc!=Ra&&Q.error("Wrong color extraction from "+Ma+" to "+yb+".");if("a_bending_col_main"==yb||"a_bending_col_detail"==yb)Db.L[yb]=new Float32Array(Db.P*nc);for(zb=0;zb<hc.length;zb++){var jc=gb[zb],wc=jc*vc,Hc=zb*Pb*cb;if(-1!=jc)for(var xc=0;xc<Pb;xc++)for(var oc=xc*cb,Ab=0;Ab<
cc.length;Ab++)cc[Ab]&&(Db.L[yb][Hc+oc+(eb[fb].Dl+fa.tk(Ra,Ab))]=wb[wc+fa.tk(ic,Ab)])}}else Db.L[yb]=new Float32Array(0)}}sa=Db;r.push({C:X,Xc:sa,sc:[ha.name],f:S,Gd:[a]})}}}return r}function I(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=ha.Tr(b));return c=c&&e(a,b)}function F(a,b){for(var c=null,d=null,e=0;e<a.U.length;e++){var f=a.U[e].re;f&&(c||(c={}),c[e]=f,a.U[e].re=null);if(f=a.U[e].M)d||(d={}),d[e]=f,a.U[e].M=null}a.id=0;a.tD=b;a.id=fa.Lr(a,b);if(c)for(var g in c)a.U[g].re=c[g];if(d)for(g in d)a.U[g].M=
d[g]}function N(a){var b=a.fd;a.fd=null;var c=fa.Lr(a,0);a.fd=b;return c}function w(a,b,c,e,f){var g=d("WIREFRAME");K(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.xg=!0;g.da=!0;g.oi=c;f&&(g.qs=!0);A(g,b);b=N(b);F(g,b);e?(e=W.xo(1,a.G),ca.Nu(e,[a.Pd[0],a.Qd[1],a.Rd[2]],a.G)):e=W.xo(a.Pa,a.G);ca.Im(e,1,!0);e.L.a_polyindex=ca.po(e);J(g,e);return g}function K(a,b,c){a.ab.Wi=b;a.ab.Oh=c;P.OD(a.ab)}function x(a,b,c){1==a.U.length&&0==a.Ob.length&&a.Ob.push("default0");c=c||"default"+String(a.U.length);
-1==a.Ob.indexOf(c)&&(a.U.push(b),a.Ob.push(c));a.lc&&S.ur(a)}function V(a){if(!a.ab)throw"No shaders info for batch "+a.name;a.lc=P.aB(a.ab);S.qy(a.lc);S.sr(a);S.ur(a)}function U(a,b,c){a=a.W[0].T;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].Fg&&-1!=a[d].Oc.indexOf(b))return a[d];return null}function aa(a,b,c){a=a.W[0].T;for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].Fg&&-1!=a[d].Oc.indexOf(b))return a[d];return null}function ba(a,b){a.pc.set(b.pc);a.lf=b.lf;a.ce.set(b.ce);a.kh=b.kh;a.zc.set(b.zc);
a.Ae=b.Ae;a.oe=b.oe;a.kf=b.kf;a.af=b.af;a.reflect_factor=b.reflect_factor;a.Bd.set(b.Bd);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Zi=b.Zi}var ea=p("__boundings"),R=p("__camera"),X=p("__config"),Q=p("__print"),T=p("__extensions"),ca=p("__geometry"),oa=p("__graph"),ha=p("__nodemat"),na=p("__obj_util"),
ma=p("__particles"),W=p("__primitives"),M=p("__quat"),O=p("__reformer"),S=p("__renderer"),ra=p("__scenegraph"),P=p("__shaders"),ia=p("__textures"),ga=p("__tsr"),fa=p("__util"),ka=p("__vec3"),da=p("__vec4"),Y=X.q,sa=["MAIN"],L=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]),qa=new Float32Array(4);a.jG=la;var la="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" ");a.YH=d;a.PA=function(a,b,d,e){for(var g=a.k.pb,h=[],l=[],m=0;m<b.length;m++){var n=b[m];n.Yj||(na.qa(n)?
h.push(n):l.push(n))}for(var m=[],m=m.concat(k(h,g)),l=m=m.concat(f(l,g,a.b4w_batch_grid_size)),g=[],m=[],q={},n=0;n<l.length;n++){var u=l[n].C,p=l[n].f,t=null;if(u.id in q){for(var x=q[u.id],v=m[x].C,M=m[x].f,z=null,O=null,h=0;h<u.U.length;h++){var y=u.U[h].re;y&&(z||(z={}),z[h]=y,u.U[h].re=null);if(y=u.U[h].M)O||(O={}),O[h]=y,u.U[h].M=null}fa.tv(u,v)&&fa.tv(p,M)&&(t=m[x]);if(z)for(h in z)u.U[h].re=z[h];if(O)for(h in O)u.U[h].M=O[h];if(!t){do u.id++;while(q[u.id])}}t||(t={C:u,f:l[n].f,Gd:[],lq:[],
sc:[]},q[u.id]=m.length,m.push(t));t.Gd=t.Gd.concat(l[n].Gd);l[n].Xc&&l[n].Xc.P&&t.lq.push(l[n].Xc);if(t.sc.length)for(h=0;h<l[n].sc.length;h++)u=l[n].sc[h],-1==t.sc.indexOf(u)&&t.sc.push(u);else t.sc=l[n].sc;ca.jv(t.sc,t.lq,ca.Ax,!1)}for(n=0;n<m.length;n++){l=m[n].lq;if(0==l.length)h=fa.xb(fa.Oi("%empty"));else if(1==l.length)h=l[0];else{q=[];for(h=0;h<l.length;h++)ca.QB(l[h])||q.push(h);if(q.length<l.length)for(h=0;h<q.length;h++)ca.Im(l[q[h]]);h=ca.HE(l)}g.push({C:m[n].C,f:m[n].f,Xc:h,sc:m[n].sc,
Gd:m[n].Gd})}for(m=0;m<g.length;m++)if(l=g[m].C,l.Oc=g[m].sc,J(l,g[m].Xc),r(l,d,a),"STATIC"==g[m].f.type&&"COLOR_ID"!=l.type)n=fa.Oi("%meta%"+l.type+"%"+l.Oc.join("%")+"%"),n=na.ks(n),n.f=g[m].f,na.al(n,a),na.$k(n,a,l),e.push(n);else for(q=[],h=0;h<g[m].Gd.length;h++)n=g[m].Gd[h],-1==q.indexOf(n.name)&&(na.$k(n,a,l),q.push(n.name));if(Y.wireframe_debug){for(m=0;m<g.length;m++)if(d=g[m].f,"DYNAMIC"==d.type&&(n=g[m].Gd[0],-1<sa.indexOf(g[m].C.type))){h=na.Ma(n,a);l=h.T;q=!1;for(h=0;h<l.length;h++)l[h].xg&&
(q=!0);q||(d=w(d.cf,d,n.name,!0,!0),na.$k(n,a,d))}for(m=0;m<e.length;m++)n=e[m],d=n.f,h=na.Ma(n,a),l=h.T,-1<sa.indexOf(l[0].type)&&(d=w(d.gd,d,n.name,!1),na.$k(n,a,d))}for(m=0;m<b.length;m++)for(h=na.Ma(b[m],a),l=h.T,h=0;h<l.length;h++)c(l[h]);for(m=0;m<e.length;m++)for(h=na.Ma(e[m],a),l=h.T,h=0;h<l.length;h++)c(l[h])};a.RA=function(a,b){var e=a.k.Sq,f=d("MAIN");K(f,"special_skydome.glslv","special_skydome.glslf");if(b.procedural_skydome)t(f,"PROCEDURAL_SKYDOME",1),f.xu=!0;else{var g=e.bq;if(g){t(f,
"WO_SKYTEX",1);var h=q(e.gv,null);x(f,h,"u_sky");g.invert&&t(f,"MTEX_NEGATIVE",1);g.LF&&t(f,"MTEX_RGBTOINT",1);t(f,"BLENDTYPE",g.xy);g.HF&&t(f,"WOMAP_BLEND",1);g.IF&&t(f,"WOMAP_HORIZ",1);g.KF&&t(f,"WOMAP_ZENUP",1);g.JF&&t(f,"WOMAP_ZENDOWN",1)}e.MF&&t(f,"WO_SKYBLEND",1);e.NF&&t(f,"WO_SKYPAPER",1);e.OF&&t(f,"WO_SKYREAL",1)}b.jc&&(f.jc=!0,b.Yb&&(f.Yb=!0));f.Xg=99999;y(f,"a_position");e=W.NA();J(f,e);c(f);e=fa.Oi("%meta_sky%");e=na.ks(e);na.al(e,a);g=na.Ma(e,a);e.f=na.Fh("STATIC");e.f.Hh=!0;e.f.Kb=ea.td();
e.f.gd=ea.Nk();e.f.nb=ea.td();e.f.Lb=ea.Nk();g.T.push(f);return e};a.js=function(a,c,d){d=na.Ma(a,d).T;var e=[],f=ra.Sa(c,"SHADOW_CAST"),g=ra.Sa(c,"MAIN_PLANE_REFLECT"),h=ra.Sa(c,"MAIN_CUBE_REFLECT"),l=ra.Sa(c,"OUTLINE_MASK");c=ra.Sa(c,"COLOR_PICKING");for(var k=0;k<d.length;k++){var m=d[k],n=null;"DEPTH"==m.type&&f&&m.Vc&&(n=b(m),n.Ua="SHADOW_CAST");"MAIN"!=m.type&&"PARTICLES"!=m.type||!g&&!h||m.Ia||!m.jc||(n=b(m),n.Ua="REFLECT");"COLOR_ID"==m.type&&m.Fn&&l&&a.f.tb&&(c&&a.f.Ne?(n=b(m),n.Ua="OUTLINE"):
m.Ua="OUTLINE");n&&(n.Fg=!0,F(n,a.f.id),e.push(n))}d.push.apply(d,e)};a.XD=l;a.dG=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.ty=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.YA=q;a.bF=E;a.aF=r;a.SD=m;a.tr=function(a,b,c){c&&c.j.type==R.Rb&&t(a,"PERSPECTIVE_SHADOW_CAST",1);t(a,"CSM_SECTION0",0);t(a,"CSM_SECTION1",0);t(a,
"CSM_SECTION2",0);t(a,"CSM_SECTION3",0);if(b){for(c=0;c<b.csm_num;c++)t(a,"CSM_SECTION"+String(c),1);t(a,"SHADOW_TEX_RES",P.r(b.csm_resolution));t(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);t(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else t(a,"SHADOW_TEX_RES",0),t(a,"CSM_FADE_LAST_CASCADE",0),t(a,"CSM_BLEND_BETWEEN_CASCADES",0)};a.la=t;a.Gb=function(a,b){return P.eB(a.ab,b)};a.ZE=J;a.$E=F;a.Gy=N;a.fH=w;a.Ah=x;a.yD=function(a,b,c){c=a.Ob.indexOf(c);-1<c&&(a.U[c]=b)};a.Gz=
function(a,b){var c=d("MAIN");c.Ia=!0;da.set(b[0],b[1],b[2],.5,c.pc);c.ze=ca.Rk;J(c,a);K(c,"main_stack.glslv","main_stack.glslf");t(c,"SHADELESS",1);V(c);return c};a.ub=V;a.Oy=function(a){return a.lc.lk.length?a.lc.Bp.u_cube_fog?!0:!1:!1};a.rz=function(){var a=d("DEPTH_PACK");a.Wa=!0;a.da=!1;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");V(a);return a};a.ls=function(a){var b=d("POSTPROCESSING");K(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");
switch(a){case "NONE":t(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":t(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":t(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":t(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":t(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":t(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":t(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":t(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");
break;default:throw"Wrong postprocessing effect: "+a;}b.Wa=!0;b.da=!1;a=W.yb();J(b,a);V(b);return b};a.Jz=function(a){var b=d("SSAO");b.da=!1;b.Wa=!0;var c=W.yb();J(b,c);K(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");t(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.ov);t(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ia.SA(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,
216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=q(a,c);x(b,a,"u_ssao_special_tex");V(b);return b};a.Kz=function(a){var b=d("SSAO_BLUR");b.da=!1;b.Wa=!0;var c=W.yb();J(b,c);K(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");t(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);V(b);return b};a.sz=function(){var a=d("DOF");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");t(a,"DEPTH_RGBA",
1);V(a);return a};a.Az=function(){var a=d("OUTLINE");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");V(a);return a};a.uz=function(){var a=d("GLOW_COMBINE");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");V(a);return a};a.vz=function(a,b,c){var e=d("GOD_RAYS");e.da=!1;e.Wa=!0;var f=W.IA();J(e,f);K(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");t(e,"DEPTH_RGBA",
a?1:0);t(e,"WATER_EFFECTS",b?1:0);t(e,"STEPS_PER_PASS",P.r(c,1));V(e);return e};a.wz=function(){var a=d("GOD_RAYS_COM");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");V(a);return a};a.Bz=function(){var a=d("SKY");a.da=!1;a.Wa=!0;var b=W.JA();J(a,b);K(a,"procedural_skydome.glslv","procedural_skydome.glslf");t(a,"WATER_EFFECTS",1);V(a);return a};a.lz=function(){var a=d("ANTIALIASING");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv",
"postprocessing/antialiasing.glslf");Y.Au?t(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY"):t(a,"AA_METHOD","AA_METHOD_FXAA_LIGHT");V(a);return a};a.Hz=function(a){var b=d("SMAA"),c=W.yb();J(b,c);K(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");t(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");t(b,"SMAA_PASS",a);t(b,"SMAA_PREDICATION",0);t(b,"SMAA_REPROJECTION",0);V(b);b.da=!1;b.Wa=!0;return b};a.pz=function(){var a=d("COMPOSITING");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv",
"postprocessing/compositing.glslf");V(a);return a};a.zz=function(){var a=d("MOTION_BLUR");a.Wa=!0;a.da=!1;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");V(a);return a};a.jz=function(){var a=d("ANAGLYPH");a.Wa=!0;a.da=!1;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");V(a);return a};a.xz=function(){var a=d("LUMINANCE");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");
V(a);return a};a.mz=function(){var a=d("LUMINANCE");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");V(a);return a};a.yz=function(){var a=d("LUMINANCE_X_BLUR");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");V(a);return a};a.nz=function(){var a=d("POSTPROCESSING");a.Wa=!0;a.da=!1;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");
V(a);return a};a.oz=function(){var a=d("BLOOM");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");V(a);return a};a.Nz=function(){var a=d("VELOCITY");a.da=!1;a.Wa=!0;var b=W.yb();J(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");V(a);return a};a.kz=function(){var a=d("ANCHOR_VISIBILITY");a.da=!0;a.Wa=!0;a.ze=ca.Xq;K(a,"anchors.glslv","anchors.glslf");var b=W.Rs(1);J(a,b);t(a,"ANCHOR_NUM",1);V(a);a.ui=
new Float32Array([0,0,0]);return a};a.YE=function(a,b){var c=b.length/3;if(c!=a.ui.length/3){var d=W.Rs(c);J(a,d);t(a,"ANCHOR_NUM",c);V(a)}a.ui=b};a.va=U;a.Mc=aa;a.zI=ba;a.YG=function(a,b){for(var c=a.W[0].T,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.dz=function(a){for(var b=a.U,c=0;c<b.length;c++)ia.aA(b[c].mb);ca.Xr(a.R)};a.inherit_material=function(a,b,c,d){for(var e=["MAIN","DEPTH","COLOR_ID"],f=!1,g=0;g<e.length;g++){var h=e[g],l=U(a,b,h),k=U(c,d,h);if(l&&k){var f=!0,m=aa(c,d,h);
"MAIN"==h&&(ba(k,l),m&&ba(m,l));for(h=0;h<k.Ob.length;h++){var n=k.Ob[h];if(-1!==la.indexOf(n)){var q=l.Ob.indexOf(n);-1!==q&&(k.U[h]=l.U[q],m&&(n=m.Ob.indexOf(n),-1!==n&&(m.U[n]=l.U[q])))}}}}f||Q.error("Wrong objects for inheriting material!")}};b4w.module.__nodemat=function(a,p){function d(a,b,e,k,m){var r=Y.get_active(),r=f(b,m,r.PF);if(r in la)return la[r];if("DEPTH"!=m&&"COLOR_ID"!=m){var p=P.create(),x=a.nodes,v=a.links;b=a.animation_data;for(var w=0;w<x.length;w++)if(null==C(p,x[w],0,b,k,m))return la[r]=null;if(e&&-1==t(a,p,"GROUP_OUTPUT","group"))return null;w=ha(p);if(!na(p,v,w))return null;if(e)return p;for(w=0;w<v.length;w++){e=v[w];for(var x=q(e.from_node,p),M=q(e.to_node,p),O=0;O<x.length;O++)for(var H=0;H<M.length;H++){var S=
x[O],F=M[H],B=P.Ta(p,S),A=P.Ta(p,F);if(!ca(p,S,F,B,A,e))return la[r]=null}}g(p);a="GLOW"==m?t(a,p,"B4W_GLOW_OUTPUT","material",!0):t(a,p,"OUTPUT","material",!1,!0);-1==a&&(p=l(),a=0);z(p);a=P.kq(p,a,P.Zm);c(a,b,k);u(a);D(a);y(a);h(a,b,k,m)}else k=d(a,b,e,k,"MAIN"),k=P.clone(k,function(a){var b=sa.nj(a);b.D=sa.na(a.D);b.ra=sa.na(a.ra);return b}),a=t(a,k,"OUTPUT","material",!1,!0),n(k,a),a=P.kq(k,a,P.Zm),u(a);return la[r]=a}function c(a,c,d){var e=[];P.V(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=
b.type||e.push({OC:a,node:b})});for(var f=0;f<e.length;++f){var g=e[f].OC,h=e[f].node,l=P.Oj(a);P.zh(a,l,h.data.zC);var k=P.Oj(a);P.zh(a,k,h.data.AC);P.Tb(a,l,k,[4,2]);for(var m={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},n=P.Oo(a,g),q=[],r=[],u=[],p={},t=0;t<n;t++){var x=P.Rj(a,g,t);x in p||(p[x]=0);var v=P.De(a,x,g,p[x]++);q.push([x,g,v]);var w=m[v[1]];if(w)switch(w[0]){case "MATERIAL_END":r.push([x,k,[v[0],w[1]]]);break;case "LIGHTING_APPLY":u.push([x,
[v[0],w[1]]])}else r.push([x,l,v])}b(a,h.data.value,l,k,u,c,d);for(t=0;t<q.length;t++)P.xm(a,q[t][0],q[t][1],q[t][2]);for(t=0;t<r.length;t++)P.Tb(a,r[t][0],r[t][1],r[t][2]);h=P.Bf(a,g);l=[];m=[];n={};for(t=0;t<h;t++)q=P.pf(a,g,t),q in n||(n[q]=0),v=P.De(a,g,q,n[q]++),l.push([g,q,v]),m.push([k,q,v]);for(t=0;t<l.length;t++)P.xm(a,l[t][0],l[t][1],l[t][2]);for(t=0;t<m.length;t++)P.Tb(a,m[t][0],m[t][1],m[t][2]);P.gh(a,g)}}function b(a,b,c,d,e,f,g){var h={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},
l=C(a,h,0,f,g,null),m=l;k(a,c,l,"E");k(a,c,l,"A");k(a,c,l,"D");l=Y.get_active();l=fa.oa(l,"LAMP",fa.DATA_ID_ALL);if(!b.$c)for(var n,q,r=0;r<l.length;r++){var u=l[r].Na,h={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};n=C(a,h,0,f,g,null);h={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};q=C(a,h,0,f,g,null);k(a,m,q,"color");k(a,m,q,"specular");k(a,n,q,"ldir");k(a,c,q,"normal");k(a,c,q,"D");k(a,c,q,"S");k(a,n,q,"lcolorint");k(a,c,n,"shadow_factor");m="COOKTORR"==b.Bi?"SPECULAR_PHONG":"SPECULAR_"+b.Bi;h={name:m,
type:m};h=C(a,h,0,f,g,null);k(a,n,h,"ldir");k(a,n,h,"lfac");k(a,c,h,"normal");k(a,h,q,"sfactor");"SPECULAR_PHONG"!=m&&"SPECULAR_BLINN"!=m||k(a,n,h,"norm_fac");k(a,c,h,"sp_params");m="HEMI"==u.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.zj;h={name:m,type:m};h=C(a,h,0,f,g,null);k(a,n,h,"ldir");k(a,n,h,"lfac");k(a,c,h,"normal");k(a,n,h,"norm_fac");k(a,h,q,"lfactor");"DIFFUSE_LAMBERT"!=m&&k(a,c,h,"dif_params");for(n=0;n<e.length;n++)P.Tb(a,e[n][0],q,e[n][1]);m=q}k(a,m,d,"color");k(a,m,d,"specular")}function k(a,
b,c,d){for(var e=P.Ta(a,b),f=P.Ta(a,c),g,h=0;h<f.D.length;h++)if(d==f.D[h].identifier){g=h;break}for(var l,h=0;h<e.ra.length;h++)if(d==e.ra[h].identifier){l=h;break}void 0!=g&&void 0!=l&&P.Tb(a,b,c,[l,g])}function f(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "DEPTH":return a+c+"00";default:return a+c+"10"}}function n(a,b){P.ie(a,function(c,d,e){var f=P.Ta(a,d);d==b&&"Color"==f.D[e[1]].identifier&&P.xm(a,c,d,e)})}function l(){var a=P.create(),b={data:null,kd:[],O:[],D:[{La:new Float32Array([0,
0,0]),identifier:"Color",zb:!1,name:"Color"},{La:1,identifier:"Alpha",zb:!1,name:"Alpha"}],ra:[],type:"OUTPUT",Zf:[]};P.zh(a,0,b);return a}function u(a){P.V(a,function(b,c){for(var d=c.D,f=c.ra,g=0;g<d.length;g++)e(a,d[g],b,g,1);for(g=0;g<f.length;g++)e(a,f[g],b,g,0)})}function e(a,b,c,d,e){if(b.zb){var f=!0;P.ie(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.zb=!1)}}function h(a,b,c,d){var e=[];P.ie(a,function(f,g,h){var l=P.Ta(a,f),k=P.Ta(a,g),l=sa.is_vector(l.ra[h[0]].La),
k=sa.is_vector(k.D[h[1]].La);if(l!=k){var m,n={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},q={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};l&&!k?m=J("vector_to_scalar","B4W_VECTOSCAL",[n],[q]):!l&&k&&(m=J("scalar_to_vector","B4W_SCALTOVEC",[q],[n]));C(a,m,0,b,c,d);e.push([f,g,a.J[a.J.length-2],h])}});for(var f=0;f<e.length;++f)P.xm(a,e[f][0],e[f][1],e[f][3]),P.Tb(a,e[f][0],e[f][2],[e[f][3][0],0]),P.Tb(a,e[f][2],e[f][1],[0,e[f][3][1]])}function g(a){var b=
[];P.V(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":P.ie(a,function(a,e,f){a==c&&"Translucency"==d.ra[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)P.Tb(a,b[c],b[c+1],b[c+2])}function q(a,b){var c=[];P.V(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function z(a){var b=[];P.V(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var f=
G(a,d);if(-1!=f){var g=P.Rj(a,f,0);P.fh(a,f,d,-1);-1!=g&&P.fh(a,g,f,-1);d=P.Ta(a,f);e.data=d.data;e.O[0]=d.O[0];P.gh(a,f)}e.D.splice(1,1)}else if("REROUTE"==e.type){for(var e=P.Rj(a,d,0),h=P.Bf(a,d),f=[],g=[],l=[],k=0;k<h;k++){var m=P.pf(a,d,k),n=g.indexOf(m);-1!=n?l[n]+=1:(g.push(m),l.push(1),f.push(d,m))}if(-1!=e)for(h=P.De(a,e,d,0)[0],k=0;k<g.length;k++)for(m=0;m<l[k];m++)n=P.De(a,d,g[k],m)[1],P.Tb(a,e,g[k],[h,n]);for(k=0;k<f.length;k+=2)P.fh(a,f[k],f[k+1],-1)}}}function G(a,b){for(var c=a.Y,d=
0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function D(a){v(a);A(a);B(a)}function B(a){var b=[],c="",d="",e={};P.V(a,function(a,f){if("GEOMETRY_UV"==f.type||"UVMAP"==f.type||"TEX_COORD_UV"==f.type){b.push(a,f);var g=f.data.value;c?c==g||d||(d=g,e[d]=0):(c=g,e[c]=0);e[g]++}});for(var f in e)if(2>e[f]){for(var g=0;g<b.length;g+=2)b[g+1].data.value==f&&b.splice(g,2);delete e[f];c==f&&(c=d,d="");d==f&&(d="")}if(!(3>b.length)){var g={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,
name:"UV_geom"},h={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"};f=J("merged_uv","UV_MERGED",[],[g,h]);f.uv_layer=c;C(a,f,0,null,"",void 0);var l=a.J[a.J.length-2];f=a.J[a.J.length-1];if(d){h=J("merged_uv","UV_MERGED",[],[g,h]);h.uv_layer=d;C(a,h,0,null,"",void 0);var k=a.J[a.J.length-2],h=a.J[a.J.length-1]}else h=null;for(var n=-1,q=null,g=0;g<b.length;g+=2){var r=b[g],u=b[g+1];m(u,b[1])?(n=l,q=f):h&&(n=k,q=h);for(var p=[],t=P.Bf(a,r),x={},v=0;v<t;v++){var w=P.pf(a,
r,v);w in x||(x[w]=0);var M=P.De(a,r,w,x[w]++);p.push(r,w,M);M=M.splice(0,M.length);switch(u.type){case "GEOMETRY_UV":M[0]=0;q.ra[0].zb=!0;break;case "UVMAP":case "TEX_COORD_UV":M[0]=1,q.ra[1].zb=!0}P.Tb(a,n,w,M)}for(var v=0;v<p.length;v+=3)P.fh(a,p[v],p[v+1],0);P.gh(a,r)}}}function v(a){var b=[];P.V(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=
[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var l=c[h];if(r(f,l.Hc)){g=[];h=P.Bf(a,e);for(n=0;n<h;n++){var k=P.pf(a,e,n),m=P.De(a,e,k,0);g.push(e,k,m);P.Tb(a,l.id,k,m)}for(var n=0;n<g.length;n+=3)P.fh(a,g[n],g[n+1],0);P.gh(a,e);g=!1;break}}g&&(l={id:e,Hc:f},c.push(l))}}function E(a){for(var b={},c=0;c<a.J.length;c+=2)b[a.J[c]]=[];for(c=0;c<a.Y.length;c+=3){for(var d=a.Y[c],e=a.Y[c+1],f=b[e],g=d,h=0;h<=f.length;h++){if(h>=f.length||f[h]>g)f.splice(h,0,g);else if(f[h]!=
g)continue;break}for(var e=b[e],d=b[d],g=f=0,h=e.length+d.length,l=[],k=0;k<h;k++)f>e.length||e[f]>d[g]?l.push(d[g++]):l.push(e[f++])}return b}function A(a){var b=[];P.V(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=E(a),d=[],e=0;e<b.length;e+=2){for(var f=b[e],g=b[e+1],h=!0,l=0;l<d.length;l++){var k=d[l];if(!(3<=k.hi.length||!r(g,k.Hc)||-1<c[f].indexOf(k.id)||-1<c[k.id].indexOf(f))){for(var m=!1,n=0;n<k.hi.length;n++){var q=k.hi[n].id;if(-1<
c[f].indexOf(q)||-1<c[q].indexOf(f)){m=!0;break}}if(!m){for(var l=[],q=P.Oo(a,f),u={},n=0;n<q;n++)m=P.Rj(a,f,n),m in u||(u[m]=0),h=P.De(a,m,f,u[m]++),l.push(m,f,h);for(var q=[],u=P.Bf(a,f),p={},n=0;n<u;n++)m=P.pf(a,f,n),m in p||(p[m]=0),h=P.De(a,f,m,p[m]++),q.push(f,m,h);h=l.concat(q);for(n=0;n<h.length;n+=3)P.fh(a,h[n],h[n+1],0);P.gh(a,f);n={id:f,Hc:g,iA:l,jA:q};k.hi.push(n);h=!1;break}}}h&&(k={id:f,Hc:g,hi:[]},d.push(k))}for(e=0;e<d.length;e++){k=d[e];c=k.hi.length;for(l=0;l<c;l++){g=k.hi[l];n=
g.Hc;f=g.iA;g=g.jA;k.Hc.D[l+1].zb=n.D[0].zb;k.Hc.D[l+1].La=n.D[0].La;k.Hc.ra[2*(l+1)].zb=n.ra[0].zb;k.Hc.ra[2*(l+1)].La=n.ra[0].La;k.Hc.ra[2*(l+1)+1].zb=n.ra[1].zb;k.Hc.ra[2*(l+1)+1].La=n.ra[1].La;for(n=0;n<f.length;n+=3)m=f[n],h=f[n+2],h[1]+=l+1,P.Tb(a,m,k.id,h);for(n=0;n<g.length;n+=3)m=g[n+1],h=g[n+2],h[0]+=2*(l+1),P.Tb(a,k.id,m,h);k.Hc.kd.push(["USE_uv"+(l+2),1])}P.gh(a,k.id);P.zh(a,k.id,k.Hc)}}}function r(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==
b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function m(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function y(a){var b=[];P.V(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+
1],f=!1,g=[],h=[],l=[[],[],[]],k=P.Bf(a,d),m=0;m<k;m++){var n=P.pf(a,d,m);if("SEPRGB"!=P.Ta(a,n).type){f=!1;break}g.push(d,n);for(var q={},r=P.Bf(a,n),f=0;f<r;f++){var u=P.pf(a,n,f);u in q||(q[u]=0);var p=P.De(a,n,u,q[u]++);g.push(n,u);l[p[0]].push(d,u,p)}h.push(n);f=!0}if(f){for(m=d=k=0;m<l.length;m++)l[m].length&&(k++,d|=1<<2-m);if(k){e.type+=k;e.ra=[];for(m=0;m<l.length;m++)if(l[m].length)for(e.ra.push({La:0,identifier:"RGB"[m],zb:!0,name:"RGB"[m]}),f=0;f<l[m].length;f+=3)l[m][f+2][0]=sa.tk(d,
m);for(m=0;m<g.length;m+=2)P.fh(a,g[m],g[m+1],0);for(m=0;m<h.length;m++)P.gh(a,h[m]);for(m=0;m<l.length;m++)for(f=0;f<l[m].length;f+=3)P.Tb(a,l[m][f],l[m][f+1],l[m][f+2])}}}}function t(a,b,c,d,e,f){a=a.nodes;for(var g=null,h=0;h<a.length;h++){var l=a[h];e?"GROUP"==l.type&&l.node_tree_name==c&&(g=l):l.type==c&&(g=l)}return g?q(g,b)[0]:(f||ka.error('No "'+c+'" node in node '+d),-1)}function J(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function C(a,b,c,d,e,f){var g=b.name,h=b.type,l=[],k=[],m=
[],n=[],q=null,r=[];switch(h){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":k=
X(b);m=Q(b);ka.warn(h+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":k=X(b);m=Q(b);break;case "UVMAP":var u=b.uv_layer;u||(h="EMPTY_UV");if("EMPTY_UV"!=h){var q=w("param_"+h+"_a"),p=w("param_"+h+"_v");l.push(T(q));l.push(T(p));n.push(T(p));q={name:q,value:u}}m=Q(b);break;case "UV_MERGED":q=w("param_UV_MERGED_a");p=w("param_UV_MERGED_v");l.push(T(q));l.push(T(p));m.push(ba(b,"UV_geom"));m.push(ba(b,"UV_cycles"));n.push(T(p));q={name:q,value:b.uv_layer};
break;case "CAMERA":k=[];m=Q(b);break;case "COMBRGB":case "COMBHSV":k=X(b);m=Q(b);break;case "CURVE_RGB":k=X(b);m=Q(b);ka.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":k=X(b);m=Q(b);ka.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!K(b))return!0;h=x(b,c);if(!h)return ka.error("Geometry output is not supported"),null;switch(h){case "GEOMETRY_UV":(u=b.uv_layer)||(h="EMPTY_UV");"EMPTY_UV"!=h&&(q=w("param_GEOMETRY_UV_a"),p=w("param_GEOMETRY_UV_v"),l.push(T(q)),
l.push(T(p)),n.push(T(p)),q={name:q,value:u});m.push(ba(b,"UV"));break;case "GEOMETRY_VC":(u=b.color_layer)||(h="EMPTY_VC");"EMPTY_VC"!=h&&(q=w("param_GEOMETRY_VC_a"),p=w("param_GEOMETRY_VC_v"),l.push(T(q)),l.push(T(p)),n.push(T(p)),q={name:q,value:u});m.push(ba(b,"Vertex Color"));break;case "GEOMETRY_NO":m.push(ba(b,"Normal"));break;case "GEOMETRY_FB":m.push(ba(b,"Front/Back"));break;case "GEOMETRY_VW":m.push(ba(b,"View"));break;case "GEOMETRY_GL":m.push(ba(b,"Global"));break;case "GEOMETRY_LO":m.push(ba(b,
"Local"));break;case "GEOMETRY_OR":u=w("param_GEOMETRY_OR_v"),l.push(T(u)),m.push(ba(b,"Orco")),n.push(T(u))}break;case "TEX_COORD":if(!K(b))return!0;h=V(b,c);if(!h)return ka.error("Texture coordinate output is not supported"),null;switch(h){case "TEX_COORD_UV":(u=b.uv_layer)||(h="EMPTY_UV");"EMPTY_UV"!=h&&(q=w("param_TEX_COORD_UV_a"),p=w("param_TEX_COORD_UV_v"),l.push(T(q)),l.push(T(p)),n.push(T(p)),q={name:q,value:b.uv_layer});m.push(ba(b,"UV"));break;case "TEX_COORD_NO":m.push(ba(b,"Normal"));
break;case "TEX_COORD_GE":u=w("param_TEX_COORD_GE_v");l.push(T(u));m.push(ba(b,"Generated"));n.push(T(u));break;case "TEX_COORD_OB":m.push(ba(b,"Object"));ka.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":m.push(ba(b,"Camera"));break;case "TEX_COORD_WI":m.push(ba(b,"Window"));ka.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":m.push(ba(b,"Reflection")),ka.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":u=b.node_tree_name;switch(u){case "B4W_LINEAR_TO_SRGB":if(!I(b,[1],[1])){q=F(b,e,f);break}h="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!I(b,[1],[1])){q=F(b,e,f);break}h="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!I(b,[1],[1])){q=F(b,e,f);break}h="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!I(b,[1,1],[1])){q=F(b,e,f);break}h="B4W_REFLECT";break;case "B4W_REFRACTION":if(!I(b,[1,0],[1])){q=F(b,e,f);break}h="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!I(b,
[1,1,0,0,0],[1])){q=F(b,e,f);break}h="B4W_PARALLAX";p=w("temp_texture");n.push(T(p));break;case "B4W_CLAMP":if(!I(b,[1],[1])){q=F(b,e,f);break}h="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!I(b,[0,0,0,0,0],[0])){q=F(b,e,f);break}h="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!I(b,[],[0])){q=F(b,e,f);break}h="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!I(b,[0,0,0],[0])){q=F(b,e,f);break}h="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":h="B4W_GLOW_OUTPUT";break;default:q=F(b,e,f)}k=X(b);m=Q(b);"B4W_TRANSLUCENCY"==
u&&(u=R("TranslucencyParams","TranslucencyParams",[0,0,0,0]),u.zb=m[0].zb,m.push(u));break;case "LAMP":q=b.lamp;if(!q)return ka.error("There is no lamp in node: "+b.name),null;m.push(ba(b,"Color"));m.push(ba(b,"Light Vector"));m.push(ba(b,"Distance"));m.push(ba(b,"Visibility Factor"));q.uuid in H?r.push(["LAMP_INDEX",String(H[q.uuid])]):(H[q.uuid]=hb,r.push(["LAMP_INDEX",String(hb++)]));q=H;break;case "LIGHTING_AMBIENT":k=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0)];m=[R("color",
"color",[0,0,0],!0),R("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":m=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("dif_params","dif_params",[0,0],!0),R("sp_params","sp_params",[0,0],!0),R("shadow_factor","shadow_factor",0,!0),R("translucency_color","translucency_color",0,!0),R("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":k=[R("color","color",[0,0,0],!0),R("specular",
"specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":k=[R("shadow_factor","shadow_factor",0,!0)];m=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("lcolorint","lcolorint",[0,0,0],!0),R("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":k=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0)];m=[R("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":k=
[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0),R("dif_params","dif_params",[0,0],!0)];m=[R("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":k=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0),R("sp_params","sp_params",[0,0],!0)];m=[R("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":k=[R("ldir","ldir",[0,0,
0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("sp_params","sp_params",[0,0],!0)];m=[R("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":k=[R("color","color",[0,0,0,0],!0),R("specular","specular",[0,0,0],!0),R("lfactor","lfactor",0,!0),R("sfactor","sfactor",0,!0),R("ldir","ldir",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("translucency_params","translucency_params",[0,0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("lcolorint","lcolorint",[0,0,0],!0),R("translucency_color",
"translucency_color",0,!0)];m=[R("color","color",[0,0,0,0],!0),R("specular","specular",[0,0,0],!0)];break;case "NORMAL":k=X(b);m=Q(b);u=ba(b,"Normal");n.push(T(w("param_NORMAL_Normal"),u.La,3));break;case "MAPPING":u=b.vector_type;h="MAPPING";k.push(aa(b,"Vector"));m.push(ba(b,"Vector"));var p=b.rotation,t=b.scale,v=b.translation,M=ia.create(),z=sa.mA(p);"TEXTURE"==u&&(t[0]=t[0]||1,t[1]=t[1]||1,t[2]=t[2]||1);var O=new Float32Array([t[0],0,0,0,t[1],0,0,0,t[2]]);ia.multiply(z,O,M);M=sa.yC(M,ga.create());
switch(u){case "POINT":M[12]=v[0];M[13]=v[1];M[14]=v[2];break;case "TEXTURE":M[12]=v[0];M[13]=v[1];M[14]=v[2];M=ga.invert(M,M);break;case "NORMAL":ga.invert(M,M),ga.transpose(M,M)}switch(u){case "NORMAL":r.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":r.push(["MAPPING_TRS_MATRIX",da.r(M,16)]);break;case "POINT":0!==L.length(p)?r.push(["MAPPING_TRS_MATRIX",da.r(M,16)]):(0!==L.length(t)&&r.push(["MAPPING_SCALE",da.r(t,3)]),0!==L.length(v)&&r.push(["MAPPING_TRANSLATION",da.r(v,3)]));break;case "VECTOR":0!==
L.length(p)?r.push(["MAPPING_TRS_MATRIX",da.r(M,16)]):0!==L.length(t)&&r.push(["MAPPING_SCALE",da.r(t,3)])}b.use_min&&r.push(["MAPPING_MIN_CLIP",da.r(b.min,3)]);b.use_max&&r.push(["MAPPING_MAX_CLIP",da.r(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":q=[];u=[];p=[];t=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("dif_params","dif_params",[0,0],!0),R("sp_params","sp_params",[0,0],!0),R("shadow_factor","shadow_factor",
0,!0)];v=[R("color","color",[0,0,0],!0),R("specular","specular",[0,0,0],!0),R("normal","normal",[0,0,0],!0)];M=[ba(b,"Color"),ba(b,"Alpha"),ba(b,"Normal")];z=[];O=aa(b,"Color");O.La.splice(3);p.push(O);k.push(O);O=aa(b,"Spec");O.La.splice(3);p.push(O);k.push(O);p.push(R("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));k.push(O);var y=aa(b,"Normal");y.La.splice(3);p.push(y);k.push(y);"MATERIAL_EXT"==h?((O=aa(b,"Emit"))||(O=R("Emit","Emit",0)),p.push(O),k.push(O),(O=aa(b,"Translucency"))?
(O.La=0,O.name="Translucency",O.identifier="Translucency"):O=R("Translucency","Translucency",0),k.push(O),(O=aa(b,"Translucency"))?(O.La=[0,0,0,0],O.name="TranslucencyParams",O.identifier="TranslucencyParams"):O=R("TranslucencyParams","TranslucencyParams",[0,0,0,0]),k.push(O),m=aa(b,"Reflectivity"),O=aa(b,"Ray Mirror"),m?(O=m,m="Reflectivity"):O?m="Ray Mirror":(O=m,m="Reflectivity"),O||(O=R(m,m,0)),k.push(O),v.push(O),(O=aa(b,"SpecTra"))||(O=R("SpecTra","SpecTra",0)),k.push(O),v.push(O),(O=aa(b,"Alpha"))||
(O=R("Alpha","Alpha",b.alpha)),k.push(O),v.push(O),M.push(ba(b,"Diffuse")),M.push(ba(b,"Spec")),q.push(["MATERIAL_EXT",1]),u.push(["MATERIAL_EXT",1])):(p.push(R("emit_intensity","emit_intensity",0)),v.push(R("reflect_factor","reflect_factor",0)),v.push(R("specular_alpha","specular_alpha",0)),v.push(R("alpha_in","alpha_in",0)),M.push(R("diffuse_out","diffuse_out",0)),M.push(R("spec_out","spec_out",0)),q.push(["MATERIAL_EXT",0]),u.push(["MATERIAL_EXT",0]));z.push(T(w("param_MATERIAL_alpha"),b.alpha));
z.push(T(w("param_MATERIAL_spec_alpha"),b.specular_alpha));m=M;y.zb&&q.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(q.push(["USE_MATERIAL_DIFFUSE",1]),u.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&u.push(["USE_MATERIAL_SPECULAR",1]);var O=[],S=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":y=b.specular_hardness;break;case "WARDISO":y=b.specular_slope;break;case "TOON":y=b.specular_toon_size;S=b.specular_toon_smooth;break;case "BLINN":y=b.specular_ior;S=b.specular_hardness;break;
default:ka.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),y=b.specular_hardness}var B,A;switch(b.diffuse_shader){case "LAMBERT":A=B=0;break;case "OREN_NAYAR":B=b.roughness;A=0;break;case "FRESNEL":B=b.diffuse_fresnel;A=b.diffuse_fresnel_factor;break;case "MINNAERT":B=b.darkness;A=0;break;case "TOON":B=b.diffuse_toon_size;A=b.diffuse_toon_smooth;break;default:ka.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),
A=B=0}O.push(T(w("param_MATERIAL_diffuse"),[B,A],2));O.push(T(w("param_MATERIAL_spec"),[b.specular_intensity,y,S],3));q.push(["SHADELESS_MAT",b.use_shadeless?1:0]);y={name:b.name,value:{Bi:b.specular_shader,zj:b.diffuse_shader,$c:b.use_shadeless}};q={name:b.name,value:{Bi:b.specular_shader,zj:b.diffuse_shader,$c:b.use_shadeless},zC:{name:"material_begin",type:"MATERIAL_BEGIN",D:p,ra:t,O:O,data:y,kd:q,Zf:[]},AC:{name:"material_end",type:"MATERIAL_END",D:v,ra:M,O:z,data:y,kd:u,Zf:[]}};break;case "MATH":switch(b.operation){case "ADD":h=
"MATH_ADD";break;case "SUBTRACT":h="MATH_SUBTRACT";break;case "MULTIPLY":h="MATH_MULTIPLY";break;case "DIVIDE":h="MATH_DIVIDE";break;case "SINE":h="MATH_SINE";break;case "COSINE":h="MATH_COSINE";break;case "TANGENT":h="MATH_TANGENT";break;case "ARCSINE":h="MATH_ARCSINE";break;case "ARCCOSINE":h="MATH_ARCCOSINE";break;case "ARCTANGENT":h="MATH_ARCTANGENT";break;case "POWER":h="MATH_POWER";break;case "LOGARITHM":h="MATH_LOGARITHM";break;case "MINIMUM":h="MATH_MINIMUM";break;case "MAXIMUM":h="MATH_MAXIMUM";
break;case "ROUND":h="MATH_ROUND";break;case "LESS_THAN":h="MATH_LESS_THAN";break;case "GREATER_THAN":h="MATH_GREATER_THAN";break;case "MODULO":h="MATH_MODULO";break;case "ABSOLUTE":h="MATH_ABSOLUTE";break;default:return ka.error("Unsupported MATH operation: "+b.operation),null}r.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=X(b);m=Q(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":h="MIX_RGB_MIX";break;case "ADD":h="MIX_RGB_ADD";break;case "MULTIPLY":h="MIX_RGB_MULTIPLY";break;case "SUBTRACT":h=
"MIX_RGB_SUBTRACT";break;case "SCREEN":h="MIX_RGB_SCREEN";break;case "DIVIDE":h="MIX_RGB_DIVIDE";break;case "DIFFERENCE":h="MIX_RGB_DIFFERENCE";break;case "DARKEN":h="MIX_RGB_DARKEN";break;case "LIGHTEN":h="MIX_RGB_LIGHTEN";break;case "OVERLAY":h="MIX_RGB_OVERLAY";break;case "DODGE":h="MIX_RGB_DODGE";break;case "BURN":h="MIX_RGB_BURN";break;case "HUE":h="MIX_RGB_HUE";break;case "SATURATION":h="MIX_RGB_SATURATION";break;case "VALUE":h="MIX_RGB_VALUE";break;case "COLOR":h="MIX_RGB_COLOR";break;case "SOFT_LIGHT":h=
"MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":h="MIX_RGB_LINEAR_LIGHT";break;default:return ka.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}r.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);k=X(b);m=Q(b);break;case "OUTPUT":k=X(b);m=[];break;case "RGB":u=e+"%join%"+b.name;u={name:"-1",value:u};n.push(u);m.push(ba(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=X(b);m=Q(b);break;case "TEXTURE":h=U(b);if("TEXTURE_EMPTY"==h)m.push(ba(b,"Color")),m.push(ba(b,"Normal")),m.push(ba(b,"Value"));
else if("TEXTURE_ENVIRONMENT"==h)k.push(aa(b,"Vector")),m.push(ba(b,"Color")),m.push(ba(b,"Value"));else{if("TEXTURE_NORMAL"==h&&"ENVIRONMENT_MAP"==b.texture.type)return ka.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),null;for(q=0;4>q;++q)q?(O=R("Vector"+q,"Vector"+q,[0,0,0]),"TEXTURE_COLOR"==h&&(u=R("Color"+q,"Color"+q,[0,0,0]),p=R("Value"+q,"Value"+q,0)),"TEXTURE_NORMAL"==h&&(u=R("Normal"+q,"Normal"+q,[0,0,0]),p=R("Value"+q,"Value"+q,0))):(O=aa(b,"Vector"),"TEXTURE_COLOR"==h&&(u=ba(b,
"Color"),p=ba(b,"Value")),"TEXTURE_NORMAL"==h&&(u=ba(b,"Normal"),p=ba(b,"Value"))),k.push(O),m.push(u),m.push(p)}p=w("param_TEXTURE_texture");n.push(T(p));q={name:p,value:b.texture};break;case "VALTORGB":k=X(b);m=Q(b);ka.warn("VALTORGB node is not fully supported.");break;case "VALUE":h="VALUE";u=e+"%join%"+b.name;u={name:"-1",value:u};n.push(u);m.push(ba(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":h="VECT_MATH_ADD";break;case "SUBTRACT":h="VECT_MATH_SUBTRACT";break;case "AVERAGE":h=
"VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":h="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":h="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":h="VECT_MATH_NORMALIZE";break;default:return ka.error("Unsupported VECT_MATH operation: "+b.operation),null}k=X(b);m=Q(b);break;default:k=X(b),m=Q(b)}h={name:g,type:h,Zf:l,D:k,ra:m,O:n,data:q,kd:r};g=P.Oj(a);P.zh(a,P.Oj(a),h);if(!(h="GEOMETRY"!=b.type&&"TEX_COORD"!=b.type)){a:{h=b.outputs;for(k=l=0;k<h.length;k++)if(h[k].is_linked&&l++>c){h=!0;break a}h=
!1}h=!h}return h||null!=C(a,b,++c,d,e,f)?g:null}function I(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,g=0;g<b.length;g++){var h=d[g],l=b[g];if(!h||h.default_value instanceof Array!=l)return ka.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=e[g],d=c[g],!b||b.default_value instanceof Array!=d)return ka.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),
!1;return!0}function F(a,b,c){var e=a.node_group.node_tree,f={},g;for(g in e)if("links"==g||"nodes"==g){f[g]=[];for(var h=0;h<e[g].length;h++){f[g][h]={};for(var l in e[g][h])if("links"==g){f[g][h][l]={};for(var k in e[g][h][l])f[g][h][l][k]=N(e[g][h][l][k])}else f[g][h][l]=N(e[g][h][l])}}else f[g]=N(e[g]);e=a.node_tree_name;if("B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==e)g=J("Group input","GROUP_INPUT",[],a.inputs),h=J("Group output","GROUP_OUTPUT",a.outputs,[]),l=null,l="B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==
e&&(ua.quality==ra.P_LOW||ua.so)?{from_node:g,from_socket:g.outputs[1],to_node:h,to_socket:h.inputs[0]}:{from_node:g,from_socket:g.outputs[0],to_node:h,to_socket:h.inputs[0]},f.nodes=[g,h],f.links=[l];e=a.name;g=f.nodes;h=f.links;for(l=0;l<g.length;l++)g[l].name=oa(g[l].type,e,g[l].name);for(l=0;l<h.length;l++)h[l].from_node.name=oa(h[l].from_node.type,e,h[l].from_node.name),h[l].to_node.name=oa(h[l].to_node.type,e,h[l].to_node.name);return{MC:d(f,a.node_group.uuid,!0,b,c),NC:f.links}}function N(a){var b=
typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?sa.nj(a):a}function w(a){qa[a]||(qa[a]=0);var b=a+qa[a],b=b.replace(/ /g,"_").replace(/\//g,"_");qa[a]++;return b}function K(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function x(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";
case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function V(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";
default:return null}}}function U(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.is_linked)switch(g.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ka.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==
a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function aa(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return ea(e)}return null}function ba(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return ea(e)}return null}function ea(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=sa.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,zb:d,La:a}}function R(a,b,c,d){return{name:a,identifier:b,zb:d||!1,La:c}}function X(a){for(var b=
[],c=0;c<a.inputs.length;c++){var d=ea(a.inputs[c]);d.La.length&&d.La.splice(3);b.push(d)}return b}function Q(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=ea(a.outputs[c]);b.push(d)}return b}function T(a,b,c){b=null===b||void 0===b?null:da.r(b,c);return{name:a,value:b}}function ca(a,b,c,d,e,f){var g=[],h=f.from_socket.identifier;f=f.to_socket.identifier;var l=d.ra;for(d=0;d<l.length;d++)if(l[d].identifier==h){g.push(d);break}e=e.D;for(d=0;d<e.length;d++)if(e[d].identifier==f){g.push(d);break}2==
g.length&&P.Tb(a,b,c,g);return!0}function oa(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function ha(a){var b=[];P.V(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function na(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.MC,f=c[d].data.NC;if(!e)return!1;P.V(e,function(b,c){P.zh(a,P.Oj(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);S(c[d],b,a)}return!0}function ma(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function W(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function M(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function O(a,b,c,d){for(var e=
0;e<d.length;e++){for(var f=d[e],g,h=0;h<c.D.length;h++)if(f.from_socket.identifier==c.D[h].identifier){g=c.D[h].La;break}for(var h=f,l=b,k=g,m=q(h.to_node,l),n=0;n<m.length;n++)for(var r=P.Ta(l,m[n]),u=0;u<r.D.length;u++)if(r.D[u].identifier==h.to_socket.identifier){r.D[u].La=k;break}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function S(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],l=0;l<b.length;l++){var k=b[l];ma(k.from_node,d,k,e,g,h);ma(k.to_node,d,k,f,g,h)}f=W(b,f,g);e=W(b,h,e);M(b,f);O(b,c,a,f);if(e.length){var m;
P.V(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});O(b,c,m,e)}}var ra=p("__config"),P=p("__graph"),ia=p("__mat3"),ga=p("__mat4"),fa=p("__objects"),ka=p("__print"),da=p("__shaders"),Y=p("__scenes"),sa=p("__util"),L=p("__vec3"),qa={},la={},H={},hb=0;new Float32Array(4);var ua=ra.q;a.gz=d;a.Sn=function(a,c,d){var e=Y.get_active();if(f(a,"MAIN",e.PF)in la)return la[a];var e=P.create(),g={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},h=C(e,g,0,null,c,null),g={name:"LIGHTING_END",
type:"LIGHTING_END"},g=C(e,g,0,null,c,null);b(e,d,h,g,[[h,[8,10]],[h,[9,6]]],null,c);u(e);return la[a]=e};a.rl=function(a){var b=[],c={};qa={};var d=P.vq(a);P.V(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],l=[],k=[],m=0;m<d.D.length;m++){var n=d.D[m];if(n.zb)e.push(null),f.push(null);else{e.push(w("in_"+d.type+"_"+n.identifier));var q=da.r(n.La,0);ua.Xu&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==
n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier)&&(n=q,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=n=n.replace(/\s+/g,""));f.push(q)}}for(m=0;m<d.ra.length;m++)n=d.ra[m],n.zb?g.push(null):g.push(w("out_"+d.type+"_"+n.identifier));for(m=0;m<d.O.length;m++)n=d.O[m],h.push(n.name),l.push(n.value);for(m=0;m<d.Zf.length;m++)k.push(d.Zf[m].name);
e={id:d.type,D:e,Qo:f,ra:g,O:h,lm:l,Zf:k,kd:JSON.parse(JSON.stringify(d.kd))};b.push(e);c[a]=e});P.ie(d,function(a,b,e){var f=P.Ta(d,a);P.Ta(d,b);var g=f.ra[e[0]];a=c[a].ra;b=c[b].D;f=a[e[0]]||w("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.Tr=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in la)delete la[a];for(var b in H)delete H[b];
hb=0}};b4w.module.__animation=function(a,p){function d(a,b){var c=a.F[b];c&&c.qo&&c.Gj&&(c.Gj=!1,c.qo(a,b))}function c(a,b,c){c=a.F[c];c.type=30;var d=b.I,e=b.Z-d+1;c.start=d;c.length=e;c.Jc=d;c.mg=b.name;for(e=d=0;e<a.Qb.length;e++){var f=a.Qb[e];if(f==b)break;else d+=f.Z-f.I+1}c.Uv=d}function b(a,b,c){for(var d=a.W,e=0;e<d.length;e++)for(var f=d[e].T,g=0;g<f.length;g++){var h=f[g].sa;if(h&&h.name==b){var l=a.F[c];l.type=50;l.mg=h.name;l.start=h.I;l.length=h.Z-l.start;h.cyclic||(l.length+=h.$o)}}}function k(a){return a.replace(/_B4W_BAKED$/,
"")}function f(a,b){if(a.animation_data){var c=a.animation_data.action;c&&c.k.type==ia&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&f(e,b)}}function n(a){return U.is_mesh(a)&&a.f.Qb?!0:!1}function l(a,b,c){var d=a.F;if(-1==c)for(c=0;8>c;c++){var f=d[c];f&&(f.Jc=b,e(a,0,c,!0))}else if(f=d[c])f.Jc=b,e(a,0,c,!0)}function u(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function e(a,b,c,e){B(a,b,c,e);d(a,c);a.f.kg&&(A(a,
b),E(a,b))}function h(a,b,c){var d=b.frame_range;if(d[0]>d[1])return ea.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var e=b.k,f=a.F[c];f.mg=b.name;f.dn=d;f.lr=e.ru;f.kr=e.Cr;f.lj.set(e.lj);f.start=d[0];f.length=d[1]-d[0];f.Jc=d[0];switch(e.type){case S:if(U.is_armature(a)){f.type=10;var h=g(a,b);if(!h){for(var h=a.f.fd,d=[],l=[],k=b.k.vp,n=0;n<k;n++){for(var u in h){var p=h[u],t=p.Mm,x=b.k.xn[u];x?oa.copy(x.subarray(8*n,8*n+8),t):oa.identity(t);p.Nm=!1}p=r(h);
d.push(p.i);l.push(p.ka)}h={i:d,ka:l};a.xh.push(b,h)}f.i=h.i;f.ka=h.ka;f=h;u=a.f;h=u.Fm;l=a.F[c];d=l.Zp;a:{k=u.cv;for(n=0;n<k.length;n+=2)if(b==k[n]){k=k[n+1];break a}k=null}if(k)l.Zp=k;else{for(l=0;l<h.length;l++){for(var k=h[l].Dh,n=[],p=[],t=f.i,x=f.ka,v=0;v<t.length;v++){var w=m(t[v],x[v],k);n.push(w.i);p.push(w.ka)}d.push({i:n,ka:p})}u.cv.push(b,d)}u.kg&&(b=u.Pm,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),q(a))}break;case ra:U.is_speaker(a)&&(f.volume=e.O.volume||null,f.pitch=e.O.pitch||
null,f.type=40);break;case ia:if("MESH"==a.type){f.type=60;u=g(a,b);if(!u){u=[];d=[];l=[];k=[];n=b.k;p=a.f.cm;t=a.f.dm;for(h in n.O)x=b.name+"%join%"+h,G(h,x,n,d,u,p),G(h,x,n,k,l,t);u={QF:u,values:d,AD:l,BD:k};a.xh.push(b,u)}f.$t=u.QF;f.bu=u.values;f.Zt=u.AD;f.au=u.BD}break;case P:if(u=e.O.tsr){f.type=20;h=g(a,b);if(!h){h=b.k.vp;d=[];l=[];for(k=0;k<h;k++)d.push(u.subarray(8*k,8*k+4)),l.push(u.subarray(8*k+4,8*k+8));h={i:d,ka:l};a.xh.push(b,h)}f.i=h.i;f.ka=h.ka;aa.ni(a)&&aa.wF(a,f.i[0],f.ka[0])}else return ea.warn('Incompatible action "'+
b.name+'" has been applied to object "'+a.name+'"'),!1}U.is_armature(a)&&e.type!=S&&z(a,c);return!0}function g(a,b){for(var c=a.xh,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function q(a){var b=a.f.Pm;if(-1!=b[0]&&-1!=b[1]){var c=a.F;a=c[b[1]].Jc;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Jc;d=Math.floor(a);b.Jc=d+e}}function z(a,b){var c=a.f.Pm,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.F;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function G(a,
b,c,d,e,f){for(var g=0;g<f.length;g+=2)b==f[g]&&(e.push(f[g+1]),d.push(new Float32Array(c.O[a])))}function D(a){a=a.k;for(var b in a.O)if(-1!=b.indexOf("nodes"))return!0;return!1}function B(a,b,c,d){if((c=a.F[c])&&null!=c.type&&(c.play||d)){var e=a.f,f=c.Jc,g=c.start,h=c.length,f=f+c.speed*b*T.Hb(),l=c.type,k=c.speed;if(0<=k&&f>=g+h||0>k&&f<g)switch(d||(c.Gj=!0),c.behavior){case 10:f=0<=k?(f-g)%h+g:g+h-1E-6;break;case 20:f=0<=k?g:g+h-1E-6;c.play=!1;break;case 30:f=0<=k?g+h-1E-6:g,c.play=!1}c.Jc=f;
switch(l){case 10:if(!e.kg){d=v(c,f,ga);b=d[0];f=d[1];d=d[2];e.vc=c.ka[b];e.Tc=c.ka[f];e.Ac=c.i[b];e.Zc=c.i[f];e.md=d;d=e.Fm;c=c.Zp;for(g=0;g<d.length;g++)h=d[g],l=c[g],h.vc=l.ka[b],h.Tc=l.ka[f],h.Ac=l.i[b],h.Zc=l.i[f],h.md=e.md;ca.o(a)}break;case 20:d=v(c,f,ga);var e=fa,f=d[0],g=d[1],h=d[2],l=c.i,k=l[f][1],m=l[f][2],n=l[g][1],q=l[g][2];e[0]=(1-h)*l[f][0]+h*l[g][0];e[1]=(1-h)*k+h*n;e[2]=(1-h)*m+h*q;f=da;m=d[0];g=d[1];h=d[2];l=c.ka;k=Y;k[0]=l[m][0];k[1]=l[m][1];k[2]=l[m][2];k[3]=l[m][3];m=sa;m[0]=
l[g][0];m[1]=l[g][1];m[2]=l[g][2];m[3]=l[g][3];R.slerp(k,m,h,f);g=d[2];h=c.i;d=(1-g)*h[d[0]][3]+g*h[d[1]][3];c.wq&&(g=ka,ca.get_translation(a,g),ha.smooth_v(e,g,b,c.wq,e));c.Ip&&(g=Y,ca.get_rotation(a,g),ha.iv(f,g,b,c.Ip,f));c=c.lj;c[0]&&ca.set_translation_rel(a,e);c[1]&&ca.set_rotation_rel(a,f);c[2]&&ca.set_scale_rel(a,d);ca.o(a);ba.sync_transform(a);break;case 30:(a=ga)||(a=Array(3));f-=c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);d=b+1;f-=b;10!=c.behavior&&d==c.length&&(d=--b,f=
1);c=c.Uv;a[0]=b+c;a[1]=d+c;a[2]=f;d=ga;e.Jq=d[0];e.Tv=d[2];break;case 40:d=v(c,f,ga);b=d[0];e=d[1];d=d[2];c.volume&&Q.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&Q.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:aa.aE(a,c.mg,f/T.Hb());break;case 60:d=v(c,f,ga);b=d[0];e=d[1];d=d[2];l=c.bu;k=c.$t;f=c.au;c=c.Zt;for(g=0;g<k.length;g++)m=l[g],h=k[g],a.f.Ie[h]=(1-d)*m[b]+d*m[e];for(g=0;g<c.length;g++)l=f[g],h=c[g],l=na.lerp(l.subarray(3*b,3*b+3),l.subarray(3*e,3*e+3),d,fa),a.f.Pc[h]=
l[0],a.f.Pc[h+1]=l[1],a.f.Pc[h+2]=l[2];break;default:ha.ba("Unknown animation type:"+l)}}}function v(a,b,c){c||(c=Array(3));var d=a.dn[0],e=a.dn[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.lr;e=Math.floor(b);a=a.kr[e]?b-e:0;b=Math.ceil(e+a);c[0]=e;c[1]=b;c[2]=a;return c}function E(a,b){var c=a.f,d=c.bf,e=c.Pm,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.F[f];if(g.play||0==b){var h=v(g,g.Jc,ga),l=h[0],k=h[1];c.md=h[2];var h=g.ka[l],m=g.ka[k],l=g.i[l],k=g.i[k]}else d=1}else d=1;e=a.F[e];if(e.play||0==b){var f=
v(e,e.Jc,ga),n=f[0],q=f[1];c.md=f[2]}else if(-1!=f&&g.play)d=0;else return;f=e.ka[n];g=e.ka[q];n=e.i[n];q=e.i[q];if(1==d)c.vc.set(f),c.Tc.set(g),c.Ac.set(n),c.Zc.set(q);else if(0==d)c.vc.set(h),c.Tc.set(m),c.Ac.set(l),c.Zc.set(k);else{for(e=0;e<h.length;e+=4){for(var r=da,u=Y,p=0;4>p;p++)r[p]=h[e+p],u[p]=f[e+p];R.slerp(r,u,d,r);for(p=0;4>p;p++)c.vc[e+p]=r[p];for(p=0;4>p;p++)r[p]=m[e+p],u[p]=g[e+p];R.slerp(r,u,d,r);for(p=0;4>p;p++)c.Tc[e+p]=r[p]}ha.Er(l,n,d,c.Ac);ha.Er(k,q,d,c.Zc)}ca.o(a);ma.uF(a)}}
function A(a,b){var c=a.f,d=c.bf,e=c.jn;if(0!=e){var d=c.hn-d,f=e*b;ha.sign(d)==ha.sign(e)&&Math.abs(f)<Math.abs(d)?c.bf+=f:(c.bf=c.hn,c.jn=0)}}function r(a){var b=[],c=[],d=new Float32Array(4),e=new Float32Array(4),f;for(f in a){var g=a[f],h=d,l=e,k=g.nl,m=k[k.length-1],n=m.Aq;m.Nm||oa.identity(n);for(m=k.length-1;0<=m;m--){var q=k[m],r=q.Aq;if(q.Nm)n=r;else{var u=q.Vf,p=q.Mm;oa.invert(u,L);oa.multiply(p,L,L);oa.multiply(u,L,L);oa.multiply(n,L,r);n=r;q.Nm=!0}}k=q.Aq;h[0]=k[0];h[1]=k[1];h[2]=k[2];
h[3]=k[3];l[0]=k[4];l[1]=k[5];l[2]=k[6];l[3]=k[7];R.normalize(l,l);g=g.df;for(h=0;4>h;h++)l=4*g+h,b[l]=d[h],c[l]=e[h]}return{i:b,ka:c}}function m(a,b,c){var d=[],e=[];new Float32Array(4);new Float32Array(4);for(var f in c)for(var g=c[f],h=g.df,g=g.co,l=0;4>l;l++){var k=4*g+l,m=4*h+l;d[k]=a[m];e[k]=b[m]}d=new Float32Array(d);e=new Float32Array(e);return{i:d,ka:e}}function y(a){var b=a.k;b.type=b.xn?S:b.O?"volume"in b.O||"pitch"in b.O?ra:D(a)?ia:P:O}function D(a){if(a=a.k.O)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;
return!1}function t(a,b){b[0]=b[1]=b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1)}function J(a,b,c,d,e,f,g){var h=a+(b-a)/2,l=C(h,d,e,f,g)-c;return.02>Math.abs(l)?h:0<l?J(a,h,c,d,e,f,g):J(h,b,c,d,e,f,g)}function C(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function I(a,b){var c={type:null,mg:null,dn:null,lr:0,kr:null,lj:new Int8Array(3),ka:null,i:null,Zp:[],play:!1,behavior:20,Jc:0,start:0,length:0,wq:0,Ip:0,Gj:!1,Uv:null,speed:1,
volume:null,pitch:null,bu:[],$t:[],au:[],Zt:[]};if(!a.F.length)for(var d=0;8>d;d++)a.F.push(null);a.F[b]=c;-1==qa.indexOf(a)&&qa.push(a)}function F(a,b){ca.o(a);ba.sync_transform(a);e(a,0,b,!0)}function N(a,d,e){e=e||0;if(U.is_mesh(a)){var f=w(a,d);if(f)return I(a,e),c(a,f,e),F(a,e),!0;if((f=K(a,d))&&"EMITTER"==f.yp)return I(a,e),b(a,f.name,e),F(a,e),!0}if(f=ha.keysearch("name",d,la)||ha.keysearch("name",d+"_B4W_BAKED",la)){I(a,e);if(h(a,f,e))return F(a,e),!0;a.F[e]=null}ea.error('Unsupported object: "'+
a.name+'" or animation name: "'+d+'"');return!1}function w(a,b){for(var c=0;c<a.Qb.length;c++){var d=a.Qb[c];if(d.name===b)return d}return null}function K(a,b){for(var c=a.W,d=0;d<c.length;d++)for(var e=c[d].T,f=0;f<e.length;f++){var g=e[f].sa;if(g&&g.name===b)return g}return null}function x(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var V=p("__config"),U=p("__obj_util"),aa=p("__particles"),ba=p("__physics"),ea=p("__print"),R=p("__quat"),
X=p("__reformer"),Q=p("__sfx"),T=p("__time"),ca=p("__transform"),oa=p("__tsr"),ha=p("__util"),na=p("__vec3"),ma=p("__armature"),W=V.lg,M=V.q;a.Hw=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var O=a.hG=
0,S=a.mw=1,ra=a.iG=2,P=a.nw=3,ia=a.Vq=4,ga=Array(3),fa=new Float32Array(3),ka=new Float32Array(3),da=new Float32Array(4),Y=new Float32Array(4),sa=new Float32Array(4),L=new Float32Array(8);new Float32Array(16);var qa=[],la=[];a.ct=function(){return ha.trunc((M.Ut-50)/4)};a.frame_to_sec=function(a){return a/T.Hb()};a.update=function(a){for(var b=0;b<qa.length;b++){for(var c=qa[b],e=0;8>e;e++)B(c,a,e);c.f.kg&&(A(c,a),E(c,a))}for(b=0;b<qa.length;b++)for(c=qa[b],e=0;8>e&&c.F.length;e++)d(c,e)};a.Ts=function(){return la};
a.get_anim_names=function(a){var b=[];if(n(a))for(var c=0;c<a.Qb.length;c++)b.push(a.Qb[c].name);for(var d=[],c=0;c<la.length;c++){var e=la[c],f=e.k;f.type==P?d.push(e):f.type==S&&"ARMATURE"==a.type?d.push(e):f.type==ra&&"SPEAKER"==a.type&&d.push(e)}if("MESH"==a.type)for(c=0;c<a.actions.length;c++)e=a.actions[c],e.k.type==ia&&d.push(e);for(c=0;c<d.length;c++)b.push(k(d[c].name));if(aa.ni(a)&&aa.wp(a))for(a=a.W,c=0;c<a.length;c++)for(d=a[c].T,e=0;e<d.length;e++)(f=d[e].sa)&&b.push(f.name);return b};
a.EE=k;a.get_anim_type=function(a,b){var c=a.F[b];return c?c.type:0};a.apply_def=function(a){for(var d=0,e=a.W,f=0;f<e.length;f++)for(var g=e[f].T,l=0;l<g.length;l++){var k=g[l].sa;k&&"EMITTER"==k.yp&&(I(a,d),b(a,k.name,d),F(a,d),a.F[d].behavior=a.Yk,k.cyclic&&(a.F[d].behavior=10),d++)}e=a.actions.slice();for(f=0;f<e.length;f++)g=e[f],I(a,d),h(a,g,d)?(F(a,d),a.F[d].behavior=a.Yk,d++):a.F[d]=null;n(a)&&(I(a,d),c(a,a.Qb[0],d),F(a,d),a.F[d].behavior=a.Yk)};a.Mx=function(a){switch(a){case "CYCLIC":return 10;
case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ha.ba("Wrong animation behavior")}};a.ZA=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&f(d,b)}return b};a.play=function(a,b,c){u(a.F,c,function(a){a.play=!0;a.qo=b?b:null;a.Gj=!1});a.f.kg&&q(a)};a.stop=function(a,b){u(a.F,b,function(a){a.play=!1;a.qo=null;a.Gj=!1})};a.is_play=function(a,b){var c=a.F;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=c[b])return c.play;
return!1};a.set_frame=l;a.set_first_frame=function(a,b){b=b||0;u(a.F,b,function(c){l(a,c.start,b)})};a.get_current_frame_float=function(a,b){var c=a.F[b];return c&&c.Jc?c.Jc:0};a.is_cyclic=function(a,b){var c=a.F[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){u(a.F,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.F[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){u(a.F,d,function(a){a.wq=b||0;a.Ip=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=
0;8>c;c++)a.F[c]=null;else a.F[b]=null;a.f.kg&&z(a,b)};a.update_object_animation=e;a.ju=function(a){if("ARMATURE"==a.type||a.bl)return!0;for(var b=0;b<a.actions.length;b++){var c=a.actions[b].k.type;if(c==P||c==S||c==ra&&"SPEAKER"==a.type||c==ia&&"MESH"==a.type)return!0}return aa.ni(a)&&aa.wp(a)||"MESH"==a.type&&a.Qb.length?!0:!1};a.Ir=function(a,b){if("ARMATURE"==b.type||x(a))return!0;for(var c=0;c<b.actions.length;c++){var d=b.actions[c].k.type;if(d==P||d==S||d==ra&&"SPEAKER"==b.type||d==ia&&"MESH"==
b.type)return!0}return aa.Cy(a)&&aa.By(a)||"MESH"==b.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return Boolean(a.F.length)};a.Fy=r;a.uA=m;a.Ox=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);R.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,g,h){if(-1<c.search(e)){a=b;c=c.split('"')[1];var l=
f}else 8==h?(c="tsr",l=f):l=1<h?new Float32Array(h):0;if(!a[c]){h=a;b=c;if("object"==typeof l&&l.length)for(var k=l.length,m=new Float32Array(g*k),n=0;n<g;n++)for(var q=0;q<k;q++)m[n*k+q]=l[q];else if("number"==typeof l)for(m=new Float32Array(g),n=0;n<g;n++)m[n]=l;else ha.ba("Wrong storage default value");h[b]=m}return a[c]}var e=new RegExp(/pose.bones\[\".+\"\]/g),f=oa.create(),g=a.k={type:O,vp:0,ru:0,O:null,xn:null,Cr:null,lj:new Int8Array(3)};g.ru=1/W.Gg;var h=a.fcurves,l={},k={},m=0,n;for(n in h){var q=
h[n],r;for(r in q){var u=q[r],p=u.Gc;X.Ny(u,a);u=u.num_channels;m||(m=p.length);for(var u=d(l,k,n,m,u),x=u.length/m,v=c(n,r|0),w=0;w<m;w++)u[w*x+v]=p[w]}}if(ha.Qj(l)){for(var M in l)"tsr"==M&&b(l[M],m);g.O=l}if(ha.Qj(k)){for(var z in k)b(k[z],m);g.xn=k}g.vp=m;g.Cr=a.Fx;"tsr"in l&&t(h,g.lj);y(a);la.push(a)};a.XA=function(a,b){return(b-a)*W.Gg+1};a.jy=function(a,b,c,d,e,f){var g,h,l=new Float32Array(2),k=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),q=b[1],r=b[2],u=b[a.last_frame_offset+
1];a=b[a.last_frame_offset+2];for(var p=0,t=0,x=null;e<=f;e++)if(e<q)for(var v=0;v<W.Gg;v++)c[p++]=r;else if(e>u)for(v=0;v<W.Gg;v++)c[p++]=a;else{var w=b[t],M=3;0===w&&(M+=2);0===x&&(M+=2);var z=2===w?0:1;if(b[t+1]==b[t+M+1])x=w,t+=M;else{v=0;e==b[t+1]&&(z&&(d[p]=1),c[p]=b[t+2],p++,v++);if(e==u)for(;v<W.Gg;v++)c[p++]=a;else for(l[0]=b[t+1],l[1]=b[t+2],0!==w?(k[0]=0,k[1]=0):0===x?(k[0]=b[t+5],k[1]=b[t+6]):(k[0]=b[t+3],k[1]=b[t+4]),0!==w?(m[0]=0,m[1]=0):(m[0]=b[t+M+3],m[1]=b[t+M+4]),n[0]=b[t+M+1],n[1]=
b[t+M+2];v<W.Gg;v++){var O=e+v/W.Gg;switch(w){case 0:g=l;h=k;var y=m,S=n,B=[],F=[],A=void 0,D=void 0,G=void 0,A=void 0;B[0]=g[0]-h[0];B[1]=g[1]-h[1];F[0]=S[0]-y[0];F[1]=S[1]-y[1];G=S[0]-g[0];A=Math.abs(B[0]);D=Math.abs(F[0]);0!=A+D&&A+D>G&&(A=G/(A+D),h[0]=g[0]-A*B[0],h[1]=g[1]-A*B[1],y[0]=S[0]-A*F[0],y[1]=S[1]-A*F[1]);z&&(d[p]=1);c[p]=C(J(0,1,O,l[0],k[0],m[0],n[0]),l[1],k[1],m[1],n[1]);p++;break;case 1:h=l[0];y=l[1];g=S=(n[1]-y)/(n[0]-h);h=y-S*h;z&&(d[p]=1);c[p]=g*O+h;p++;break;case 2:z&&(d[p]=1);
c[p]=b[t+2];p++;break;default:ha.ba("Unknown keyframe intepolation mode: "+w)}}e+1==b[t+M+1]&&(x=w,t+=M)}}};a.apply=N;a.fy=function(a,b,c){c=c||0;var d=ha.keysearch("uuid",b,la);if(d){I(a,c);if(h(a,d,c)){F(a,c);return}a.F[c]=null}ea.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.RF=function(a,b){var c=ha.keysearch("name",b,la)||ha.keysearch("name",b+"_B4W_BAKED",la);if(c){if(c.k.type==O)return!1}else if(!(K(a,b)||U.is_mesh(a)&&w(a,b)))return!1;return!0};a.get_slot_num_by_anim=
function(a,b){for(var c=a.F,d=0;d<c.length;d++){var e=c[d];if(e&&k(e.mg)==k(b))return d}return-1};a.VA=function(a,b){var c=a.F[b];return c&&c.mg?k(c.mg):null};a.remove=function(a){a.F.length=0;a=qa.indexOf(a);-1!=a&&qa.splice(a,1)};a.qD=function(a){for(var b=la.length-1;0<=b;b--)la[b].Gx==a&&la.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.F.length)return N(a,b,0)?0:-1;for(var c=0;c<a.F.length;c++)if(!a.F[c])return N(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.f.jn=(b-a.f.bf)/
c;a.f.hn=b};a.set_speed=function(a,b,c){u(a.F,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.F[b].speed};a.get_anim_start_frame=function(a,b){return a.F[b].start};a.get_anim_length=function(a,b){return a.F[b].length};a.cleanup=function(){qa.length=0;la.length=0};a.xA=function(a){var b=(a[0]||a[1]||a[2]).Gc.length,c=da,d=fa,e=Boolean(a[0]);e||(a[0]={Gc:new Float32Array(b),num_channels:8});var f=Boolean(a[1]);f||(a[1]={Gc:new Float32Array(b),num_channels:8});var g=Boolean(a[2]);g||(a[2]=
{Gc:new Float32Array(b),num_channels:8});a[3]={Gc:new Float32Array(b),num_channels:8};for(var h=0;h<b;h++)d[0]=e?a[0].Gc[h]:0,d[1]=f?a[1].Gc[h]:0,d[2]=g?a[2].Gc[h]:0,ha.euler_to_quat(d,c),a[0].Gc[h]=c[3],a[1].Gc[h]=c[0],a[2].Gc[h]=c[1],a[3].Gc[h]=c[2]};a.Vs=x};b4w.module.__time=function(a,p){var d=p("__config");p("__print");p("__util");var c=0,b=0,k=[],f=0,n=0,l=[],u=-1;a.Uu=function(a){c=a;b=performance.now();for(a=0;a<k.length;a++){var d=k[a];c>d.mo&&(k.splice(a,1),a--,d.callback())}for(a=0;a<l.length;a++){var d=l[a],f=1-(d.mo-c)/d.duration,f=Math.min(f,1);d.callback(d.from+f*(d.to-d.from));1==f&&(l.splice(a,1),a--)}};a.get_timeline=function(){return c};a.set_timeout=function(a,d){var g;f++;g=f;k.push({id:g,callback:a,mo:c+(performance.now()-b+d)/1E3});
return g};a.clear_timeout=function(a){for(var b=0;b<k.length;b++)if(k[b].id==a){k.splice(b,1);break}};a.clear_animation=function(a){for(var b=l.length;b--;)if(l[b].id==a){l.splice(b,1);break}};a.animate=function(a,b,d,f){d/=1E3;var k;n++;k=n;l.push({id:k,callback:f,from:a,to:b,mo:c+d,duration:d});f(a);return k};a.reset=function(){b=c=0;k.length=0;n=f=l.length=0};a.Hb=function(){return-1!==d.lg.Ll?d.lg.Ll:u};a.PD=function(a){u=a}};b4w.module.__transform=function(a,p){function d(a,b){h.od(a)?v.set_trans(b,h.nd(a)):m.copy(b,a.f.i)}function c(a,b){var c=a.f;if(h.od(a)){v.set_quat(b,c.za);var d=h.Ml(a),d=v.invert(d,C);v.multiply(d,c.za,h.nd(a))}else G.copy(b,c.quat)}function b(a,b){h.od(a)?v.set_quat(b,h.nd(a)):G.copy(b,a.f.quat)}function k(a,b){h.od(a)?v.copy(b,h.nd(a)):f(a,b)}function f(a,b){var c=a.f;c.i[0]=b[0];c.i[1]=b[1];c.i[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function n(a,b){if(h.od(a))v.copy(h.nd(a),
b);else{var c=a.f;v.set_sep(c.i,c.scale,c.quat,b)}return b}function l(a){var b=a.f,c=a.W,d=a.type;"CAMERA"==d&&e.Cq(a);h.kF(a,F);"CAMERA"==d&&e.hF(a);var f=b.i,k=b.scale,m=b.quat;v.set_sep(f,k,m,b.za);var n=b.aa;q.fromQuat(m,n);"CAMERA"!=d&&r.HD(n,k,n);n[12]=f[0];n[13]=f[1];n[14]=f[2];q.invert(n,b.xt);b.Kb&&b.nb&&(u.yn(b.Kb,n,b.nb),u.An(b.gd,n,b.Lb),u.zn(b.cf,b.za,b.ng));switch(d){case "SPEAKER":B.uE(a,F);break;case "MESH":if(n=a.bl)v.invert(n.f.za,C),v.multiply(C,b.za,C),y.set(C[0],C[1],C[2],C[3],
b.ln),G.set(C[4],C[5],C[6],C[7],b.kn);break;case "CAMERA":e.iF(a);D.ja()&&(k=D.get_active(),D.Pj(k)==a&&B.lC(k,f,m,F));break;case "LAMP":g.nF(a)}for(k=0;k<c.length;k++){var p=c[k];if(p.Wl){var n=p.xa,t=n.k,I=p.T;switch(d){case "LAMP":D.Wf(a,n);break;case "CAMERA":D.KD(n);t.bc&&t.bc.enable_csm&&D.Up(n);break;case "MESH":b.Kb&&b.nb&&(b.Vc&&D.Up(n),t=p.jf,null!=b.hd&&t&&D.Iv(t,f));a.F.length&&z.wp(a)&&z.lF(a,I);break;case "EMPTY":E.Jv(a)}p=p.Ff;I=a.rk;I.length&&p&&(t=p.j,D.Lv(p,f,m),A.Mv(I,t.ic),e.cE(t,
D.Pj(n)),r.Hl(t.Kd,t.Lj))}}c=a.xd;for(k=0;k<c.length;k++)l(c[k]);a=a.Pn;for(k=0;k<a.length;k++)c=a[k],n=c[0],h.dF(n,c[1]);b.uo=!0}var u=p("__boundings"),e=p("__camera"),h=p("__constraints"),g=p("__lights");p("__mat3");var q=p("__mat4"),z=p("__particles"),G=p("__quat"),D=p("__scenes"),B=p("__sfx"),v=p("__tsr"),E=p("__objects"),A=p("__obj_util"),r=p("__util"),m=p("__vec3"),y=p("__vec4"),t=new Float32Array(3),J=new Float32Array(4);new Float32Array(9);var C=v.create(),I=v.create(),F=0;a.SPACE_WORLD=0;
a.SPACE_LOCAL=1;a.SPACE_PARENT=2;a.update=function(a){F=a};a.set_translation=function(a,b){var c=a.f;if(h.od(a)){v.set_trans(b,c.za);var d=h.Ml(a),d=v.invert(d,C);v.multiply(d,c.za,h.nd(a))}else m.copy(b,c.i)};a.set_translation_rel=d;a.get_translation=function(a,b){m.copy(a.f.i,b);return b};a.get_translation_rel=function(a,b){h.od(a)?m.copy(v.get_trans_view(h.nd(a)),b):m.copy(a.f.i,b);return b};a.set_rotation=c;a.set_rotation_rel=b;a.get_rotation=function(a,b){G.copy(a.f.quat,b);return b};a.get_rotation_rel=
function(a,b){h.od(a)?G.copy(v.get_quat_view(h.nd(a)),b):G.copy(a.f.quat,b);return b};a.set_rotation_euler=function(a,b){var d=r.euler_to_quat(b,J);c(a,d)};a.set_rotation_euler_rel=function(a,c){var d=r.euler_to_quat(c,J);b(a,d)};a.set_scale=function(a,b){var c=a.f;if(h.od(a)){var c=h.nd(a),d=v.get_scale(h.Ml(a));v.set_scale(b/d,c)}else c.scale=b};a.set_scale_rel=function(a,b){h.od(a)?v.set_scale(b,h.nd(a)):a.f.scale=b};a.get_scale=function(a){return a.f.scale};a.get_scale_rel=function(a){return h.od(a)?
v.get_scale(h.nd(a)):a.f.scale};a.set_tsr=function(a,b){var c=a.f;if(h.od(a)){v.set_trans(trans,c.za);var d=h.Ml(a),d=v.invert(d,C);v.multiply(d,c.za,h.nd(a))}else f(a,b)};a.set_tsr_rel=k;a.get_tsr=function(a,b){var c=a.f;v.set_sep(c.i,c.scale,c.quat,b);return b};a.get_tsr_rel=n;a.get_object_size=function(a){var b=a.f,c=b.Bh;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));
b?(a=a.f,m.copy(a.Lb.G,c)):(a=a.f,b=a.Bh,c[0]=(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,m.transformMat4(c,a.aa,c));return c};a.move_local=function(a,b,c,e){var f=n(a,C);t[0]=b;t[1]=c;t[2]=e;v.transform_vec3(t,f,t);d(a,t)};a.Qp=function(a,b){var c=n(a,C),d=v.set_quat(b,v.identity(I));v.multiply(c,d,d);k(a,d)};a.o=l;a.distance=function(a,b){return m.dist(a.f.i,b.f.i)};a.PC=function(a,b){return m.dist(a.f.i,b)};a.get_object_bounding_box=function(a){return{max_x:a.f.nb.max_x,
min_x:a.f.nb.min_x,max_y:a.f.nb.max_y,min_y:a.f.nb.min_y,max_z:a.f.nb.max_z,min_z:a.f.nb.min_z}}};b4w.module.__tsr=function(a,p){function d(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3];return d}function c(a,b,c){var d=b[0],f=b[1],l=b[2],k=b[3],n=b[4],u=b[5],p=b[6];b=b[7];var A=a[0]*k,r=a[1]*k,m=a[2]*k;a=b*A+u*m-p*r;var k=b*r+p*A-n*m,y=b*m+n*r-u*A,A=-n*A-u*r-p*m;c[0]=a*b+A*-n+k*-p-y*-u;c[1]=k*b+A*-u+y*-n-a*-p;c[2]=y*b+A*-p+a*-u-k*-n;c[0]+=d;c[1]+=f;c[2]+=l;return c}var b=p("__mat4"),k=p("__quat"),f=p("__util"),n=p("__vec3"),l=new Float32Array(3),u=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.from_values=function(a,b,c,d,f,l,k,n){var u=new Float32Array(8);u[0]=a;u[1]=b;u[2]=c;u[3]=d;u[4]=f;u[5]=l;u[6]=k;u[7]=n;return u};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,c,f){f||(f=new Float32Array(8));d(a,b,c,f);return f};
a.set_sep=d;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],f=a[1],l=a[2];u[0]=a[4];
u[1]=a[5];u[2]=a[6];u[3]=a[7];k.invert(u,u);var n=u[0],p=u[1],v=u[2],E=u[3],d=d*c,f=f*c,A=l*c,l=E*d+p*A-v*f,r=E*f+v*d-n*A,m=E*A+n*f-p*d,d=-n*d-p*f-v*A;b[0]=-(l*E+d*-n+r*-v-m*-p);b[1]=-(r*E+d*-p+m*-n-l*-v);b[2]=-(m*E+d*-v+l*-p-r*-n);b[3]=c;b[4]=n;b[5]=p;b[6]=v;b[7]=E;return b};a.to_mat4=function(a,c){var d=a[3];b.fromRotationTranslation(a.subarray(4),a.subarray(0,3),c);for(var f=0;12>f;f++)c[f]*=d;return c};a.from_mat4=function(a,b){var c=f.ci(a,l),k=f.jp(a),n=f.matrix_to_quat(a,u);d(c,k,n,b);return b};
a.multiply=function(a,b,d){c(b,a,d);d[3]=a[3]*b[3];var f=a[4],l=a[5],k=a[6];a=a[7];var n=b[4],u=b[5],p=b[6];b=b[7];d[4]=f*b+a*n+l*p-k*u;d[5]=l*b+a*u+k*n-f*p;d[6]=k*b+a*p+f*u-l*n;d[7]=a*b-f*n-l*u-k*p;return d};a.transform_vec3=c;a.transform_vec3_inv=function(a,b,c){var d=b[3],f=a[0]-b[0],l=a[1]-b[1],k=a[2]-b[2];a=b[4];var n=b[5],u=b[6];b=b[7];var p=a*a+n*n+u*u+b*b,p=p?1/p:0;a=-a*p;n=-n*p;u=-u*p;b*=p;var p=b*f+n*k-u*l,A=b*l+u*f-a*k,r=b*k+a*l-n*f,f=-a*f-n*l-u*k;c[0]=p*b+f*-a+A*-u-r*-n;c[1]=A*b+f*-n+
r*-a-p*-u;c[2]=r*b+f*-u+p*-n-A*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var f=a.length,l=b[0],k=b[1],n=b[2],u=b[3],p=b[4],A=b[5],r=b[6];b=b[7];for(var m=0;m<f;m+=3){var y=a[m]*u,t=a[m+1]*u,J=a[m+2]*u,C=b*y+A*J-r*t,I=b*t+r*y-p*J,F=b*J+p*t-A*y,y=-p*y-A*t-r*J;c[d+m]=C*b+y*-p+I*-r-F*-A;c[d+m+1]=I*b+y*-A+F*-p-C*-r;c[d+m+2]=F*b+y*-r+C*-A-I*-p;c[d+m]+=l;c[d+m+1]+=k;c[d+m+2]+=n}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var f=a.length,l=b[3],k=
b[4],n=b[5],u=b[6];b=b[7];for(var p=0;p<f;p+=3){var A=a[p]*l,r=a[p+1]*l,m=a[p+2]*l,y=b*A+n*m-u*r,t=b*r+u*A-k*m,J=b*m+k*r-n*A,A=-k*A-n*r-u*m;c[d+p]=y*b+A*-k+t*-u-J*-n;c[d+p+1]=t*b+A*-n+J*-k-y*-u;c[d+p+2]=J*b+A*-u+y*-n-t*-k}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],f=b[4],l=b[5],k=b[6];b=b[7];var n=a[0]*d,u=a[1]*d,p=a[2]*d;a=b*n+l*p-k*u;var d=b*u+k*n-f*p,A=b*p+f*u-l*n,n=-f*n-l*u-k*p;c[0]=a*b+n*-f+d*-k-A*-l;c[1]=d*b+n*-l+A*-f-a*-k;c[2]=A*b+n*-k+a*-l-d*-f;return c};a.transform_tangents=
function(a,b,c,d){d||(d=0);var f=a.length,l=b[3],k=b[4],n=b[5],u=b[6];b=b[7];for(var p=0;p<f;p+=4){var A=a[p]*l,r=a[p+1]*l,m=a[p+2]*l,y=b*A+n*m-u*r,t=b*r+u*A-k*m,J=b*m+k*r-n*A,A=-k*A-n*r-u*m;c[d+p]=y*b+A*-k+t*-u-J*-n;c[d+p+1]=t*b+A*-n+J*-k-y*-u;c[d+p+2]=J*b+A*-u+y*-n-t*-k;c[d+p+3]=a[p+3]}return c};a.translate=function(a,b,c){var d=a[3],f=a[4],l=a[5],k=a[6],n=a[7],u=b[0]*d,p=b[1]*d,A=b[2]*d;b=n*u+l*A-k*p;var d=n*p+k*u-f*A,r=n*A+f*p-l*u,u=-f*u-l*p-k*A;c[0]=a[0]+b*n+u*-f+d*-k-r*-l;c[1]=a[1]+d*n+u*-l+
r*-f-b*-k;c[2]=a[2]+r*n+u*-k+b*-l-d*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){d||(d=new Float32Array(8));n.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var f=a[3];d[3]=f+c*(b[3]-f);k.slerp(a.subarray(4),b.subarray(4),c,d.subarray(4));return d};a.uH=function(a,b,c,d){d||(d=new Float32Array(8));var f=a.subarray(0,3),l=b.subarray(0,3),n=d.subarray(0,3);n[0]=l[0]*(c+1)-f[0]*c;n[1]=l[1]*(c+1)-f[1]*c;n[2]=l[2]*(c+1)-f[2]*c;d[3]=b[3]*(c+1)-
a[3]*c;a=a.subarray(4);b=b.subarray(4);f=d.subarray(4);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;k.normalize(f,f);return d};a.JB=function(a,b,c,d,f){f[0]=a[0]+b*c[0];f[1]=a[1]+b*c[1];f[2]=a[2]+b*c[2];f[3]=a[3];c=d[0];var l=d[1];d=d[2];var k=a[4],n=a[5],u=a[6],p=a[7];f[4]=.5*(c*p+l*u-d*n);f[5]=.5*(l*p+d*k-c*u);f[6]=.5*(d*p+c*n-l*k);f[7]=.5*(-c*k-l*n-d*u);f[4]=a[4]+f[4]*b;f[5]=a[5]+f[5]*b;f[6]=a[6]+f[6]*b;f[7]=a[7]+f[7]*b;a=f[4];b=f[5];c=f[6];l=f[7];
a=a*a+b*b+c*c+l*l;0<a&&(a=1/Math.sqrt(a),f[4]*=a,f[5]*=a,f[6]*=a,f[7]*=a)}};b4w.module.__util=function(a,p){function d(a){return 0<a?1:0>a?-1:0}function c(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function b(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function k(a,b){var c=b;switch(typeof a){case "number":return f(a,c);case "string":return n(a,c);case "boolean":return f(a|0,c);case "function":case "undefined":return f(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==
a.byteLength)for(d=0;d<a.length;d++)c=f(a[d],c);else if(d)for(d=0;d<a.length;d++)c=k(a[d],c);else for(var e in a)c=k(a[e],c)}else c=f(0,c)}return c}function f(a,b){var c=b;V[0]=a;c=(c<<5)-c+U[0];c&=c;c=(c<<5)-c+U[1];return c&c}function n(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),c&=c;return c}function l(a){return(34*a+1)*a%289}function u(a){return a-Math.floor(a)}function e(a){return h((34*a+5)*a)}function h(a){return a-289*Math.floor(a/289)}function g(a){return a-7*Math.floor(a/
7)}function q(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function z(a){return q(a,0,2*Math.PI)}function G(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!D(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!D(a[f],
b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function D(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return G(a,b);default:return!0}}function B(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=
c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var v=p("__mat3"),E=p("__mat4"),A=p("__print"),r=p("__quat"),m=p("__vec3"),y=p("__vec4"),t=0,J={},C=new Float32Array(3),I=new Float32Array(3),F=new Float32Array(4),N=new Float32Array(4),w=new Float32Array(9),K=new Float32Array(16),x=new Float32Array(16),V=new Float64Array(1),U=new Uint32Array(V.buffer),aa=new Float32Array([0,0,0]),ba=new Float32Array([0,0,0,1]),ea=new Float32Array([0,0,0,1,0,0,0,1]),R=new Float32Array([1,1,1]),X=new Float32Array([1,
0,0]),Q=new Float32Array([0,1,0]),T=new Float32Array([0,0,1]),ca=new Float32Array([-1,0,0]),oa=new Float32Array([0,-1,0]),ha=new Float32Array([0,0,-1]),na=Math.floor(44488.07041494893),ma=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,
0,0,0,1])];a.dr=aa;a.cr=ba;a.DG=ea;a.er=R;a.AXIS_X=X;a.AXIS_Y=Q;a.AXIS_Z=T;a.AXIS_MX=ca;a.AXIS_MY=oa;a.AXIS_MZ=ha;a.qw=ma;a.keyfind=function(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d};a.zA=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.VE=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Ty=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,
!0)};a.ky=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=d;a.hI=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.gI=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.jB=function(a,b){for(var c=0;c<a.length;c++)if(a[c].uuid==
b)return c;return-1};a.ey=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.aH=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.RE=function(a,b,c,d){d||(d=new Float32Array(16));E.identity(d);d[12]=a;d[13]=b;d[14]=c};var W=1;a.nD=function(){W=(69069*W+5)%Math.pow(2,32);return Math.round(W/65536)%32768/32767};a.AE=function(a){W=a};a.rd=function(a){var b=a[0]%na*48271-3399*Math.floor(a[0]/na);a[0]=0<b?b:b+2147483647;return(a[0]-
1)/2147483646};a.Ul=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.mA=function(a){var b=v.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,l=c*a,k=f*e,m=f*a;b[0]=d*
e;b[1]=d*a;b[2]=-g;b[3]=g*k-l;b[4]=g*m+h;b[5]=d*f;b[6]=g*h+m;b[7]=g*l-k;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));m.transformQuat(b,a,c);return c};a.pH=
function(a,b,c){c||(c=new Float32Array(4));a=m.normalize(a,C);var d=m.dot(b,a);a=m.cross(b,a,I);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.SE=function(a,b,c,d){d||(d=new Float32Array(4));m.transformQuat(c,b,d);d[3]=-m.dot(a,d)};a.dA=function(a){var b=a.f.quat;switch(a.type){case "CAMERA":C[0]=0;C[1]=-1;C[2]=0;m.transformQuat(C,b,C);I[0]=0;I[1]=0;I[2]=-1;break;case "MESH":C[0]=0;C[1]=0;C[2]=1;m.transformQuat(C,b,C);I[0]=0;I[1]=
0;I[2]=1;break;case "EMPTY":C[0]=0,C[1]=1,C[2]=0,m.transformQuat(C,b,C),I[0]=0,I[1]=1,I[2]=0}C[1]=0;m.normalize(C,C);a=m.dot(C,I);return Math.acos(a)*(0<-C[0]*I[2]?-1:1)};a.Er=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.LI=function(){t++;return t.toString(16)};a.Oi=function(a){J[a]||(J[a]=0);var b=a+J[a];J[a]++;return b};a.yd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.xb=function(a){var b=
{a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,P:0,pa:null,B:[],L:b,ca:[]}};a.sg=function(a){return JSON.parse(JSON.stringify(a))};a.na=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.na(b[d]);break;default:for(d in c=new c,b)c[d]=a.na(b[d])}return c};a.nj=function(a){var b=a instanceof
Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));v.fromMat4(a,w);var c=w[0],d=w[3],e=w[6],f=w[1],g=w[4],h=w[7],l=w[2],k=w[5],m=w[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,l=Math.sqrt(l*l+k*k+m*m)||1;w[0]/=c;w[3]/=c;w[6]/=c;w[1]/=f;w[4]/=
f;w[7]/=f;w[2]/=l;w[5]/=l;w[8]/=l;r.fromMat3(w,b);return b};a.ci=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.jp=function(a){F[0]=.577350269189626;F[1]=.577350269189626;F[2]=.577350269189626;F[3]=0;y.transformMat4(F,a,F);return y.length(F)};a.Hl=function(a,b){var d=b.left,e=b.right,f=b.top,g=b.bottom,h=b.ib,l=b.hb;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=
a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];l[0]=a[3]-a[2];l[1]=a[7]-a[6];l[2]=a[11]-a[10];l[3]=a[15]-a[14];c(d);c(e);c(f);c(g);c(h);c(l)};a.vE=function(a,c,d){return d<-b(a,c.left)||d<-b(a,c.right)||d<-b(a,c.top)||d<-b(a,c.bottom)||d<-b(a,c.ib)||d<-b(a,c.hb)?!0:!1};a.kA=function(a,c,d,e,f){g=m.dot(d,c.hb);h=m.dot(e,c.hb);l=m.dot(f,c.hb);g=Math.sqrt(g*g+h*h+l*l);if(g<-b(a,
c.ib)||g<-b(a,c.hb))return!0;var g=m.dot(d,c.left),h=m.dot(e,c.left),l=m.dot(f,c.left);if(Math.sqrt(g*g+h*h+l*l)<-b(a,c.left))return!0;g=m.dot(d,c.right);h=m.dot(e,c.right);l=m.dot(f,c.right);if(Math.sqrt(g*g+h*h+l*l)<-b(a,c.right))return!0;g=m.dot(d,c.top);h=m.dot(e,c.top);l=m.dot(f,c.top);if(Math.sqrt(g*g+h*h+l*l)<-b(a,c.top))return!0;g=m.dot(d,c.bottom);h=m.dot(e,c.bottom);l=m.dot(f,c.bottom);return Math.sqrt(g*g+h*h+l*l)<-b(a,c.bottom)?!0:!1};a.Gf=function(a,b,c,d){d||(d=0);for(var e=a.length,
f=0;f<e;f+=3){var g=a[f],h=a[f+1],l=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*l+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*l+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*l+b[14]}};a.UF=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],l=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*l;c[d+f+1]=b[1]*g+b[5]*h+b[9]*l;c[d+f+2]=b[2]*g+b[6]*h+b[10]*l}};a.ME=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],l=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*l;c[d+f+1]=b[1]*g+b[5]*h+b[9]*l;c[d+f+2]=b[2]*g+b[6]*
h+b[10]*l;c[d+f+3]=a[f+3]}};a.SF=function(a,b,c){c||(c=new Float32Array(3));F[0]=a[0];F[1]=a[1];F[2]=a[2];F[3]=0;y.transformMat4(F,b,F);c[0]=F[0];c[1]=F[1];c[2]=F[2]};a.xH=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.TF=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);
b[c/3]=d}return b};a.hl=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.hl(b,c,d,f-1):b[f]<c?a.hl(b,c,f+1,e):f};a.gf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.bH=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.HD=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.xq=function(a,b,c,d){d||(d=new Float32Array(16));b=E.fromRotationTranslation(b,
c,K);E.multiply(b,a,d)};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=E.fromRotationTranslation(c,d,K);1!==b&&(d=E.identity(x),b=m.set(b,b,b,C),E.scale(d,b,d),E.multiply(c,d,c));m.transformMat4(a,c,e);return e};a.yq=function(a,b,c,d){d||(d=new Float32Array(4));b=E.fromRotationTranslation(b,c,K);y.transformMat4(a,b,d)};a.$H=function(a,b,c,d,e){e||(e=new Float32Array(3));b=E.fromRotationTranslation(c,d,K);E.invert(b,b);m.transformMat4(a,b,e);return e};a.JI=function(a,b,c){c||(c=
new Float32Array(16));E.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.qI=function(b,c,d){a.ci(b,c);c[3]=a.jp(b);a.matrix_to_quat(b,d)};a.KG=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.CD=function(a,b,c,d){d||(d=new Float32Array(3));m.subtract(b,a,C);m.transformQuat(C,c,C);m.subtract(b,C,d)};a.KA=function(){C[0]=0;C[1]=0;C[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),
f=new Float32Array(16);E.lookAt(C,[-1,0,0],[0,-1,0],a);E.scale(a,[-1,1,1],a);E.scale(a,[-1,1,-1],b);E.lookAt(C,[0,-1,0],[0,0,-1],c);E.scale(c,[1,1,-1],c);E.scale(c,[1,-1,-1],d);E.lookAt(C,[0,0,-1],[0,-1,0],e);E.scale(e,[-1,1,1],e);E.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.OA=function(){C[0]=0;C[1]=0;C[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);E.lookAt(C,[1,0,0],[0,-1,0],a);E.scale(a,[-1,1,
-1],b);E.lookAt(C,[0,1,0],[0,0,1],c);E.scale(c,[1,-1,-1],d);E.lookAt(C,[0,0,1],[0,-1,0],e);E.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Lr=function(a,b){return k(a,b)};a.hash_code=k;a.VH=n;a.pI=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,l,k,m,n,q,r,u,p,t;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];l=a[3];k=a[4];m=a[5];n=a[6];q=a[7];r=a[8];u=a[9];p=a[10];t=a[11];
c[0]=f;c[1]=g;c[2]=h;c[3]=l;c[4]=k;c[5]=m;c[6]=n;c[7]=q;c[8]=r;c[9]=u;c[10]=p;c[11]=t;c[12]=f*d+k*e+r*b+a[12];c[13]=g*d+m*e+u*b+a[13];c[14]=h*d+n*e+p*b+a[14];c[15]=l*d+q*e+t*b+a[15];return c};a.yC=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*
c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.um=function(a){return a*Math.PI/180};a.$z=function(a){return 180*a/Math.PI};a.cq=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+.211324865405187-f,h=a+.211324865405187-g,k=b+-.577350269189626,m=a+-.577350269189626,c=c%289,
d=d%289,n=l(l(d)+c),g=l(l(d+g)+c+f),q=l(l(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),f=Math.max(.5-(k*k+m*m),0),r=2*u(.024390243902439*n)-1,p=2*u(.024390243902439*g)-1,t=2*u(.024390243902439*q)-1,n=Math.abs(r)-.5,g=Math.abs(p)-.5,q=Math.abs(t)-.5,r=r-Math.floor(r+.5),p=p-Math.floor(p+.5),t=t-Math.floor(t+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(r*r+n*n)),d=d*d*d*d*(1.79284291400159-.85373472095314*(p*p+g*g)),f=f*f*f*f*(1.79284291400159-.85373472095314*(t*t+q*q));return 130*
(c*(r*b+n*a)+d*(p*e+g*h)+f*(t*k+q*m))};a.Qr=function(a){var b=1/7,c=b/2,d=h(Math.floor(a[0])),f=h(Math.floor(a[1])),l=u(a[0]);a=u(a[1]);var k=l-.5,m=l-1.5,l=a-.5;a-=1.5;var n=e(d),q=e(d+1),r=n,d=q,n=e(n+f),q=e(q+f),r=e(r+f+1),d=e(d+f+1),f=k+.7*(g(n)*b+c),p=m+.7*(g(q)*b+c),k=k+.7*(g(r)*b+c),m=m+.7*(g(d)*b+c),n=l+.7*(g(Math.floor(n*b))*b+c),l=l+.7*(g(Math.floor(q*b))*b+c),r=a+.7*(g(Math.floor(r*b))*b+c),b=a+.7*(g(Math.floor(d*b))*b+c);return Math.min(f*f+n*n,p*p+l*l,k*k+r*r,m*m+b*b)};a.quat_project=
function(a,b,c,d,e){e||(e=new Float32Array(4));a=m.transformQuat(b,a,C);b=c[0];var f=c[1];c=c[2];w[0]=f*f+c*c;w[1]=-f*b;w[2]=-c*b;w[3]=-b*f;w[4]=b*b+c*c;w[5]=-c*f;w[6]=-b*c;w[7]=-f*c;w[8]=b*b+f*f;m.transformMat3(a,w,a);m.normalize(a,a);r.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=F,d=N,c=r.setAxisAngle([0,1,0],Math.PI,r.create()),d=r.setAxisAngle([1,0,0],Math.PI/2,r.create());r.multiply(c,d,c);r.multiply(a,c,b);return b};a.cleanup=function(){t=
0;J={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.iv=function(a,b,c,d,e){e||(e=new Float32Array(a.length));r.slerp(a,b,Math.exp(-c/d),e)};a.aI=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&
a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=v.fromQuat(a,w);I[0]=0;I[1]=1;I[2]=0;C[0]=c[3];C[1]=c[4];C[2]=c[5];var d=m.cross(I,C,C);m.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);I[0]=c[0];I[1]=c[1];I[2]=c[2];m.normalize(I,I);r.rotationTo(I,d,N);r.multiply(N,a,a)};a.Us=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],l=a[e*b+
Math.min(c+1,g)],k=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+l*d)*(1-f)+(k*(1-d)+a*d)*f};a.hh=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Lu=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.tk=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.Qs=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};
a.Qj=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];m.normalize(c,c)};a.TE=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var l=g*a-h*e,k=h*d-f*a,m=f*e-g*d,n=g*m-h*k,h=h*l-f*m,f=f*k-g*l;c[0]=d+2*l*b+2*n;c[1]=e+2*k*b+2*h;c[2]=a+2*m*b+2*f};a.assert=function(a){if(!a)throw Error("Assertion failed");
};a.ba=function(a){a&&A.error.apply(A,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=q;a.angle_wrap_0_2pi=z;a.Bo=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.tv=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=G(e,f)}if(!d)return!1}return!0};a.Hp=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.Os=function(a){a+=1;132651<a&&A.error("Color ID pool depleted");
var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){F.set(a);F[3]=b;N.set(d);N[3]=0;a=y.dot(F,N);if(0==a)return null;N.set(c);N[3]=1;a=-y.dot(F,N)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.mB=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],g=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=g*a-b*h;d[1]=f*b-e*a;d[2]=e*h-g*f;return d};a.dH=function(a,b){for(var c=0;c<a.length;c++)b[c]=
a[c];return b};a.ED=function(a,b,c){var d=m.dot(a,b);-.9999999>d?(m.cross(X,a,C),1E-6>m.length(C)&&m.cross(Q,a,C),m.normalize(C,C),r.setAxisAngle(C,Math.PI,c)):(m.cross(a,b,C),c.set(C),c[3]=1+d,r.normalize(c,c));return c};a.ef=function(a,b,c){if(b==c)return c-a;a=z(a);b=z(b);c=z(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=z(c+b);a=z(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*
a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.ly=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.jH=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.Xv=function(a,b){for(var c=Math.max(a.length,b.length),e=0;e<c;e++){var f=d((e>=a.length?0:a[e])-(e>=b.length?0:b[e]));if(f)return f}return 0};a.Yf=function(a){return a.join(".")};a.rv=function(a){return a.split(".").map(function(a){return a|0})};a.nv=function(a,b){b[0]=Math.pow(a[0],
2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2)};a.dp=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.ck=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=B(b[1]),b.join("://")):B(a)}};b4w.module.__sfx=function(a,p){function d(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;D.warn("deprecated WebAudio implementation");return null}D.warn("WebAudio is not supported");return null}function c(a,c,d){var e=a.A;if("NONE"!=e.behavior){d||(d=0);var g=e.loop,h=e.pitch;if(e.src&&(g||0<=d)){e.nn=Math.floor(5E4*Math.random());var k=I.currentTime+c;e.Wc=k;e.state=20;b(a);"POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior?(c=I.createBufferSource(),
c.buffer=e.src,c.playbackRate.value=h,g?(e.Bb&&e.Bb.disconnect(),c.loop=!0,c.start(k),e.duration=0):(g=c.buffer?c.buffer.duration:0,d>g?(g=k+d+e.Lc,c.loop=!0,c.start(k),c.stop(g),e.duration=d):(c.loop=!1,c.start(k),e.duration=g)),c.connect(e.uc),e.Bb=c,f(e),n(e)):"BACKGROUND_MUSIC"==e.behavior&&(B.clear_timeout(e.rn),B.clear_timeout(e.sn),d=function(){var b=a.A,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.Bb=b.Bb||I.createMediaElementSource(c),b.Bb.connect(b.uc),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==c?d():e.rn=B.set_timeout(d,1E3*c),e.duration=g?0:z(a));l(e,k)}}}function b(a){var b=a.A;if(!b.uc){var c=a.f.i;a=a.f.quat;if(r.fm){var d=I.createBiquadFilter();d.type="peaking"}else d=null;var e=I.createGain();switch(b.behavior){case "POSITIONAL":var f=I.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);E.copy(c,b.Yo);c=m;v.quat_to_dir(a,
v.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);E.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.bs;f.coneOuterAngle=b.cs;f.coneOuterGain=b.ds;var g=I.createGain();g.gain.value=q(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.uc=f;if(b.rh){var h=I.createGain();e.connect(h);h.connect(I?F.fa.uc:null)}else h=null,e.connect(I?F.fa.uc:null);break;case "BACKGROUND_SOUND":f=null;g=I.createGain();g.gain.value=q(b);d?(b.uc=
d,d.connect(g)):b.uc=g;g.connect(e);b.rh?(h=I.createGain(),e.connect(h),h.connect(I?F.fa.uc:null)):(h=null,e.connect(I?F.fa.uc:null));break;case "BACKGROUND_MUSIC":h=f=null,g=I.createGain(),g.gain.value=q(b),d?(b.uc=d,d.connect(g)):b.uc=g,g.connect(e),e.connect(I?F.fa.uc:null)}b.ik=f;b.Wd=d;b.Qh=g;b.Bg=e;b.Cu=h}}function k(a){var b=a.A,d=b.duration,b=b.delay+b.us*Math.random();c(a,b,d)}function f(a){a.rh&&a.Cu.gain.cancelScheduledValues(a.Wc);a.ti&&a.Bb.playbackRate.cancelScheduledValues(a.Wc);a.Lk=
a.Wc}function n(a){if(a.rh||a.ti){var b=a.Cu,c=a.Bb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Wc;w[0]=a.nn;for(var f=0;5>f;){var g=a.pitch+a.ti*v.rd(w);if(e>=a.Lk){if(a.rh){var h=1-v.clamp(a.rh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.ti&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.Lk=e-.001}}}function l(a,b){if(a.Cg||a.Lc){var c=a.Bg;c.gain.cancelScheduledValues(b);a.Cg?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Cg)):c.gain.setValueAtTime(1,b);a.Lc&&!a.loop&&(c.gain.setValueAtTime(1,
b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.Lc))}}function u(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.A;if(20==b.state||40==b.state){var c=b.Bg,d=I.currentTime;b.Lc&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.Lc));"BACKGROUND_MUSIC"==b.behavior?b.src&&(B.clear_timeout(b.rn),B.clear_timeout(b.sn),b.sn=B.set_timeout(function(){var b=a.A.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.Lc)):(c=b.Bb,b.duration<c.buffer.duration?
b.Lc&&20==b.state?c.stop(d+b.Lc):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.Wc=0,b.Ap=0,b.Bn=0);b.state=30}}function e(a){a=a.A;if(20==a.state){var b=I.currentTime;a.Ap=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Wc){w[0]=a.nn;for(var d=a.Bb.buffer.duration,e=a.Wc;e<b;)c=a.pitch+a.ti*v.rd(w),e+=d/c;c*=d/c-(e-b)}else c=0;a.Bn=c;a.Bb.stop(0);a.Bb.disconnect();f(a)}a.state=40}}function h(a){var b=a.A;if(40==b.state){var c=I.currentTime;b.Wc+=c-b.Ap;if("BACKGROUND_MUSIC"==
b.behavior)b.src.play();else{a=a.A;var d=I.createBufferSource();d.loop=a.Bb.loop;d.buffer=a.Bb.buffer;d.playbackRate.value=a.Bb.playbackRate.value;a.ik?d.connect(a.ik):d.connect(a.Qh);a.Bb=d;b.Lk=c;b.Bb.start(b.Wc,b.Bn);n(b)}l(b,b.Wc);b.state=20}}function g(a){return!a.A||20!=a.A.state&&40!=a.A.state&&30!=a.A.state?!1:!0}function q(a){return a.muted?0:a.volume}function z(a){a=a.A;return(a=a.src)?a.duration:0}var G=p("__config"),D=p("__print"),B=p("__time"),v=p("__util"),E=p("__vec3"),A=G.q,r=G.A;
a.Uq=10;a.Ym=20;a.Tq=30;var m=new Float32Array(3),y=new Float32Array(3),t=new Float32Array(3),J=[],C=[],I=null,F=null,N=[],w=[1],K=null;a.Fz=function(){return{behavior:"NONE",yg:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,bs:360,cs:360,ds:1,cyclic:!1,loop:!1,delay:0,us:0,rh:0,ti:0,Cg:0,Lc:0,Wc:0,Ap:0,Bn:0,duration:0,Lk:0,nn:1,src:null,state:10,Yo:new Float32Array(3),direction:new Float32Array(3),fq:new Float32Array(3),rn:-1,sn:-1,Ag:0}};a.init=function(){var a=document.createElement("audio"),
b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(J.push("ogg"),J.push("ogv")),""!=a.canPlayType("audio/mpeg")&&J.push("mp3"),""!=a.canPlayType("audio/mp4")&&(J.push("mp4"),J.push("m4v")),""!=a.canPlayType("audio/webm")&&J.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&C.push("ogv"),""!=b.canPlayType("video/mp4")&&C.push("m4v"),""!=b.canPlayType("video/webm")&&C.push("webm"));(I=r.Pq?d():null)&&D.log("%cINIT WEBAUDIO: "+I.sampleRate+"Hz","color: #00a")};
a.vr=function(a){var b={Ng:new Float32Array(3),Pt:new Float32Array(3),bi:new Float32Array(3)};a.fa=b;if(I){var c=I.createGain(),d=I.createGain();b.Qh=c;b.Bg=d;c.connect(d);d.connect(I.destination);if(a.b4w_enable_dynamic_compressor){var d=I.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.tj=d;b.uc=d}else b.tj=null,b.uc=c;c=I.listener;b.yg=A.fo;b.yg||
(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.Ag=0}};a.ND=function(a){F=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<J.indexOf(a)?a:"ogg"==a&&-1<J.indexOf("mp4")?"mp4":"mp3"==a&&-1<J.indexOf("ogg")?"ogg":"mp4"==a&&-1<J.indexOf("ogg")?"ogg":"ogv"==a&&-1<J.indexOf("m4v")?"m4v":"webm"==a&&-1<J.indexOf("m4v")?"m4v":"m4v"==a&&-1<J.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<C.indexOf(a)?
a:"ogv"==a&&-1<C.indexOf("m4v")?"m4v":"webm"==a&&-1<C.indexOf("m4v")?"m4v":"m4v"==a&&-1<C.indexOf("webm")?"webm":""};a.mh=function(a,b){if("SPEAKER"!=b.type)throw"Wrong speaker object";var c=a.data,d=b.A;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=I?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var e;I?(window.MediaElementAudioSourceNode?e=!0:(D.warn("MediaElementAudioSourceNode not found"),e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=
e;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.yg=c.b4w_disable_doppler||A.fo;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.bs=c.cone_angle_inner;d.cs=c.cone_angle_outer;d.ds=c.cone_volume_outer;d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.us=c.b4w_delay_random;d.rh=c.b4w_volume_random;d.ti=c.b4w_pitch_random;d.Cg=c.b4w_fade_in;d.Lc=c.b4w_fade_out;N.push(b)};
a.kv=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.A.behavior){case "POSITIONAL":return a.Ym;case "BACKGROUND_SOUND":return a.Ym;case "BACKGROUND_MUSIC":return a.Tq;case "NONE":return a.Uq;default:throw"Wrong speaker behavior";}};a.vF=function(a,b){var c=a.A;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.dD=function(){var a=I.createBufferSource();a.buffer=I.createBuffer(1,
22050,22050);a.connect(I.destination);a.start(0)};a.Xz=function(a,b,c){I?I.decodeAudioData(a,b,c):c()};a.sE=function(a){u(a);a.A=null;N.splice(N.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<N.length;a++){var b=N[a].A;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Bb&&b.Bb.disconnect()}F&&F.fa&&(a=F.fa,a.Ng[0]=0,a.Ng[1]=0,a.Ng[2]=0,a.bi[0]=0,a.bi[1]=0,a.bi[2]=0);F=null;N.splice(0);K=null};a.update=function(a){if(I&&0!=N.length){for(var b=0;b<N.length;b++){var c=N[b],d=c.A,e=I.currentTime;
I&&!d.loop&&d.cyclic&&20==d.state&&d.duration&&d.Wc+d.duration<e&&k(c);20==d.state&&3>d.Lk-e&&n(d)}K&&K.Pe.length&&(-1==K.eb||a>K.mr+K.ys[K.eb])&&(b=K,-1<b.eb&&u(b.Pe[b.eb]),-1==b.eb&&b.random?c=Math.round(Math.random()*(b.Pe.length-1)):b.random?(c=1+Math.round(Math.random()*(b.Pe.length-2)),c=(b.eb+c)%b.Pe.length):c=(b.eb+1)%b.Pe.length,k(b.Pe[c]),b.eb=c,b.mr=a)}};a.play=c;a.play_def=k;a.stop=u;a.is_play=function(a){return 20==a.A.state};a.rE=e;a.tE=h;a.playrate=function(a,b){var c=a.A;c.pitch=b;
!g(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.Bb.playbackRate.value=b,f(c),n(c))};a.get_playrate=function(a){return a.A.pitch};a.cyclic=function(a,b){a.A.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.A.cyclic};a.lC=function(a,b,c,d){if(I&&a.fa){var e=m;e[0]=0;e[1]=-1;e[2]=0;E.transformQuat(e,c,e);y[0]=0;y[1]=0;y[2]=-1;E.transformQuat(y,c,y);c=I.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],y[0],y[1],y[2]);E.copy(e,a.fa.Pt);!a.fa.yg&&d&&(t[0]=(b[0]-
a.fa.Ng[0])/d,t[1]=(b[1]-a.fa.Ng[1])/d,t[2]=(b[2]-a.fa.Ng[2])/d,v.smooth_v(t,a.fa.bi,d,.3,t),c.setVelocity(t[0],t[1],t[2]),E.copy(t,a.fa.bi));E.copy(b,a.fa.Ng)}};a.listener_reset_speed=function(a,b){if(I&&F.fa&&!F.fa.yg){var c=m;b?E.copy(b,c):E.copy(F.fa.Pt,c);E.scale(c,a,c);I.listener.setVelocity(c[0],c[1],c[2]);E.copy(c,F.fa.bi)}};a.uE=function(a,b){var c=a.A;if(g(a)&&"POSITIONAL"==c.behavior){var d=a.f.i,e=c.ik;e.setPosition(d[0],d[1],d[2]);var f=m;v.quat_to_dir(a.f.quat,v.AXIS_MY,f);e.setOrientation(f[0],
f[1],f[2]);f=c.Yo;!c.yg&&b&&(y[0]=(d[0]-f[0])/b,y[1]=(d[1]-f[1])/b,y[2]=(d[2]-f[2])/b,v.smooth_v(y,c.fq,b,.3,y),e.setVelocity(y[0],y[1],y[2]),E.copy(y,c.fq));E.copy(d,f)}};a.speaker_reset_speed=function(a,b,c){var d=a.A;if(g(a)&&"POSITIONAL"==d.behavior&&!d.yg){var e=m;c?E.copy(c,e):E.copy(d.direction,e);E.scale(e,b,e);d.ik.setVelocity(e[0],e[1],e[2]);E.copy(e,d.fq);E.copy(a.f.i,d.Yo)}};a.Do=function(a){return a.A.behavior};a.check_active_speakers=function(){for(var a=0;a<N.length;a++)if(g(N[a]))return!0;
return!1};a.YD=function(a){var b=F.fa;b&&(b.volume=a,I&&(b.Qh.gain.value=q(b)))};a.lB=function(){var a=F.fa;return a?a.volume:0};a.set_volume=function(a,b){var c=a.A;c.volume=b;g(a)&&(c.Qh.gain.value=q(c))};a.get_volume=function(a){return a.A.volume};a.mute=function(a,b){a.A.muted=Boolean(b);g(a)&&(a.A.Qh.gain.value=q(a.A))};a.is_muted=function(a){return a.A.muted};a.KC=function(a){var b=F.fa;b&&(b.muted=Boolean(a),I&&(b.Qh.gain.value=q(b)))};a.RB=function(){var a=F.fa;return a?a.muted:!1};a.get_speaker_objects=
function(){return N};a.pause=function(){for(var a=0;a<N.length;a++)e(N[a])};a.resume=function(){for(var a=0;a<N.length;a++)h(N[a])};a.set_compressor_params=function(a,b){if(a.fa&&a.fa.tj){var c=a.fa.tj;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.fa||!a.fa.tj)return null;a=a.fa.tj;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};
a.duck=function(a,b,c){if(g(a)){a=a.A;var d=a.Bg,e=I.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.Ag=c}};a.unduck=function(a){if(g(a)){a=a.A;var b=a.Bg,c=I.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Ag);a.Ag=0}};a.fA=function(a,b){if(I){var c=F.fa,d=c.Bg,e=I.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Ag=b}};a.WE=function(){if(I){var a=F.fa,b=a.Bg,c=I.currentTime;
b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Ag);a.Ag=0}};a.apply_playlist=function(a,b,c){K={eb:-1,mr:0,random:c,Pe:[],ys:[]};for(c=0;c<a.length;c++){var d=a[c],e=z(d);0==e?D.warn("Ignoring speaker with zero duration: "+d.name):(u(d),d.A.cyclic=!1,K.Pe.push(d),K.ys.push(e+b))}};a.get_duration=z;a.clear_playlist=function(){if(K)for(var a=K.Pe,b=0;b<a.length;b++)u(a[b]);K=null};a.get_positional_params=function(a){return(a=a.A)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,
dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.A;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.ik;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.A;c&&c.Wd&&(c.Wd.frequency.value=b.freq,c.Wd.Q.value=b.Q,c.Wd.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.A)&&a.Wd?{freq:a.Wd.frequency.value,
Q:a.Wd.Q.value,gain:a.Wd.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.A;if(!a||!a.Wd)return null;a.Wd.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new p(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,d){var f=new p(3);f[0]=a;f[1]=b;f[2]=d;return f};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,d,f){f[0]=a;f[1]=b;f[2]=d;return f};a.add=function(a,b,d){d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];
return d};a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],
b[2]);return d};a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d};a.scaleAndAdd=function(a,b,d,f){f[0]=a[0]+b[0]*d;f[1]=a[1]+b[1]*d;f[2]=a[2]+b[2]*d;return f};a.distance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],n=b[2]-a[2];return Math.sqrt(d*d+f*f+n*n)};a.dist=a.distance;a.squaredDistance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],n=b[2]-a[2];return d*d+f*f+n*n};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)};a.len=a.length;
a.squaredLength=function(a){var b=a[0],d=a[1];a=a[2];return b*b+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var d=a[0],f=a[1],n=a[2],d=d*d+f*f+n*n;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,d){var f=a[0],n=a[1];a=a[2];var l=b[0],u=b[1];b=b[2];
d[0]=n*b-a*u;d[1]=a*l-f*b;d[2]=f*u-n*l;return d};a.lerp=function(a,b,d,f){var n=a[0],l=a[1];a=a[2];f[0]=n+d*(b[0]-n);f[1]=l+d*(b[1]-l);f[2]=a+d*(b[2]-a);return f};a.random=function(a,b){a=a||1;var k=2*d()*Math.PI,f=2*d()-1,n=Math.sqrt(1-f*f)*a;b[0]=Math.cos(k)*n;b[1]=Math.sin(k)*n;b[2]=f*a;return b};a.transformMat4=function(a,b,d){var f=a[0],n=a[1];a=a[2];var l=b[3]*f+b[7]*n+b[11]*a+b[15],l=l||1;d[0]=(b[0]*f+b[4]*n+b[8]*a+b[12])/l;d[1]=(b[1]*f+b[5]*n+b[9]*a+b[13])/l;d[2]=(b[2]*f+b[6]*n+b[10]*a+b[14])/
l;return d};a.transformMat3=function(a,b,d){var f=a[0],n=a[1];a=a[2];d[0]=f*b[0]+n*b[3]+a*b[6];d[1]=f*b[1]+n*b[4]+a*b[7];d[2]=f*b[2]+n*b[5]+a*b[8];return d};a.transformQuat=function(a,b,d){var f=a[0],n=a[1],l=a[2];a=b[0];var u=b[1],e=b[2];b=b[3];var h=b*f+u*l-e*n,g=b*n+e*f-a*l,q=b*l+a*n-u*f,f=-a*f-u*n-e*l;d[0]=h*b+f*-a+g*-e-q*-u;d[1]=g*b+f*-u+q*-a-h*-e;d[2]=q*b+f*-e+h*-u-g*-a;return d};a.rotateX=function(a,b,d,f){var n=[],l=[];n[0]=a[0]-b[0];n[1]=a[1]-b[1];n[2]=a[2]-b[2];l[0]=n[0];l[1]=n[1]*Math.cos(d)-
n[2]*Math.sin(d);l[2]=n[1]*Math.sin(d)+n[2]*Math.cos(d);f[0]=l[0]+b[0];f[1]=l[1]+b[1];f[2]=l[2]+b[2];return f};a.rotateY=function(a,b,d,f){var n=[],l=[];n[0]=a[0]-b[0];n[1]=a[1]-b[1];n[2]=a[2]-b[2];l[0]=n[2]*Math.sin(d)+n[0]*Math.cos(d);l[1]=n[1];l[2]=n[2]*Math.cos(d)-n[0]*Math.sin(d);f[0]=l[0]+b[0];f[1]=l[1]+b[1];f[2]=l[2]+b[2];return f};a.rotateZ=function(a,b,d,f){var n=[],l=[];n[0]=a[0]-b[0];n[1]=a[1]-b[1];n[2]=a[2]-b[2];l[0]=n[0]*Math.cos(d)-n[1]*Math.sin(d);l[1]=n[0]*Math.sin(d)+n[1]*Math.cos(d);
l[2]=n[2];f[0]=l[0]+b[0];f[1]=l[1]+b[1];f[2]=l[2]+b[2];return f};a.forEach=function(){var c=a.create();return function(a,d,f,n,l,u){d||(d=3);f||(f=0);for(n=n?Math.min(n*d+f,a.length):a.length;f<n;f+=d)c[0]=a[f],c[1]=a[f+1],c[2]=a[f+2],l(c,u,c),a[f]=c[0],a[f+1]=c[1],a[f+2]=c[2];return a}}();a.IG=function(c,b){var d=a.fromValues(c[0],c[1],c[2]),f=a.fromValues(b[0],b[1],b[2]);a.normalize(d,d);a.normalize(f,f);d=a.dot(d,f);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new p(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,d,f){var n=new p(4);n[0]=a;n[1]=b;n[2]=d;n[3]=f;return n};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,d,f,n){n[0]=a;n[1]=b;n[2]=d;n[3]=f;return n};a.add=function(a,b,d){d[0]=
a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d};a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];d[3]=a[3]-b[3];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];d[3]=a[3]*b[3];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];d[3]=a[3]/b[3];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);d[3]=
Math.min(a[3],b[3]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],b[2]);d[3]=Math.max(a[3],b[3]);return d};a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;d[3]=a[3]*b;return d};a.scaleAndAdd=function(a,b,d,f){f[0]=a[0]+b[0]*d;f[1]=a[1]+b[1]*d;f[2]=a[2]+b[2]*d;f[3]=a[3]+b[3]*d;return f};a.distance=function(a,b){var d=b[0]-a[0],f=b[1]-a[1],n=b[2]-a[2],l=b[3]-a[3];return Math.sqrt(d*d+f*f+n*n+l*l)};a.dist=a.distance;a.squaredDistance=
function(a,b){var d=b[0]-a[0],f=b[1]-a[1],n=b[2]-a[2],l=b[3]-a[3];return d*d+f*f+n*n+l*l};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1],f=a[2];a=a[3];return Math.sqrt(b*b+d*d+f*f+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],d=a[1],f=a[2];a=a[3];return b*b+d*d+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var d=a[0],f=a[1],n=a[2],l=a[3],d=d*d+f*f+n*n+l*l;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d,b[3]=a[3]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,d,f){var n=a[0],l=a[1],u=a[2];a=a[3];f[0]=n+d*(b[0]-n);f[1]=l+d*(b[1]-l);f[2]=u+d*(b[2]-u);f[3]=a+d*(b[3]-a);return f};a.random=function(c,b){c=c||1;b[0]=d();b[1]=d();b[2]=d();b[3]=d();a.normalize(b,b);a.scale(b,c,b);return b};a.transformMat4=function(a,b,d){var f=a[0],
n=a[1],l=a[2];a=a[3];d[0]=b[0]*f+b[4]*n+b[8]*l+b[12]*a;d[1]=b[1]*f+b[5]*n+b[9]*l+b[13]*a;d[2]=b[2]*f+b[6]*n+b[10]*l+b[14]*a;d[3]=b[3]*f+b[7]*n+b[11]*l+b[15]*a;return d};a.transformQuat=function(a,b,d){var f=a[0],n=a[1],l=a[2],u=b[0],e=b[1],h=b[2];b=b[3];var g=b*f+e*l-h*n,q=b*n+h*f-u*l,p=b*l+u*n-e*f,f=-u*f-e*n-h*l;d[0]=g*b+f*-u+q*-h-p*-e;d[1]=q*b+f*-e+p*-u-g*-h;d[2]=p*b+f*-h+g*-e-q*-u;d[3]=a[3];return d};a.forEach=function(){var c=a.create();return function(a,d,f,n,l,u){d||(d=4);f||(f=0);for(n=n?Math.min(n*
d+f,a.length):a.length;f<n;f+=d)c[0]=a[f],c[1]=a[f+1],c[2]=a[f+2],c[3]=a[f+3],l(c,u,c),a[f]=c[0],a[f+1]=c[1],a[f+2]=c[2],a[f+3]=c[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,p){var d=p("__vec3"),c=p("__vec4"),b=p("__mat3"),k="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new k(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=d.create(),c=d.fromValues(1,0,0),l=d.fromValues(0,1,0);return function(k,e,h){var g=d.dot(k,e);if(-.9999999>g)return d.cross(c,k,b),1E-6>d.length(b)&&d.cross(l,k,b),d.normalize(b,b),a.setAxisAngle(b,Math.PI,h),h;if(.9999999<g)return h[0]=0,h[1]=0,h[2]=0,h[3]=1,h;d.cross(k,
e,b);h[0]=b[0];h[1]=b[1];h[2]=b[2];h[3]=1+g;return a.normalize(h,h)}}();a.setAxes=function(){var c=b.create();return function(b,d,k,e){c[0]=d[0];c[3]=d[1];c[6]=d[2];c[1]=k[0];c[4]=k[1];c[7]=k[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,e),e)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],h=a[2];a=a[3];var g=b[0],k=b[1],p=b[2];b=b[3];c[0]=d*b+a*g+e*p-h*k;c[1]=e*b+a*k+h*g-d*p;c[2]=h*b+a*p+d*k-e*g;c[3]=a*b-d*g-e*k-h*p;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],e=a[1],h=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*g;c[1]=e*b+h*g;c[2]=h*b-e*g;c[3]=a*b-d*g;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],e=a[1],h=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);c[0]=d*
b-h*g;c[1]=e*b+a*g;c[2]=h*b+d*g;c[3]=a*b-e*g;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],e=a[1],h=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*g;c[1]=e*b-d*g;c[2]=h*b+a*g;c[3]=a*b-h*g;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,d){var e=a[0],h=a[1],g=a[2];a=a[3];var k=b[0],p=b[1],G=b[2];b=b[3];var D,B,v;B=e*k+h*p+g*G+a*b;0>B&&(B=-B,k=-k,p=-p,
G=-G,b=-b);1E-6<1-B?(D=Math.acos(B),v=Math.sin(D),B=Math.sin((1-c)*D)/v,c=Math.sin(c*D)/v):B=1-c;d[0]=B*e+c*k;d[1]=B*h+c*p;d[2]=B*g+c*G;d[3]=B*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],h=a[3],g=c*c+d*d+e*e+h*h,g=g?1/g:0;b[0]=-c*g;b[1]=-d*g;b[2]=-e*g;b[3]=h*g;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,h=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*h+h]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+h]-a[3*h+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[h]=(a[3*h+d]+a[3*d+h])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[4];c[4]=a[5];c[5]=a[6];c[6]=a[8];c[7]=a[9];c[8]=a[10];return c};a.clone=function(a){var c=new p(9);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,c){if(c===a){var b=a[1],k=a[2],f=a[5];c[1]=a[3];c[2]=a[6];c[3]=b;c[5]=a[7];c[6]=k;c[7]=f}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c};a.invert=function(a,c){var b=a[0],k=a[1],f=a[2],n=a[3],l=a[4],p=a[5],e=a[6],h=a[7],g=a[8],q=g*l-p*h,z=-g*n+p*e,G=
h*n-l*e,D=b*q+k*z+f*G;if(!D)return null;D=1/D;c[0]=q*D;c[1]=(-g*k+f*h)*D;c[2]=(p*k-f*l)*D;c[3]=z*D;c[4]=(g*b-f*e)*D;c[5]=(-p*b+f*n)*D;c[6]=G*D;c[7]=(-h*b+k*e)*D;c[8]=(l*b-k*n)*D;return c};a.adjoint=function(a,c){var b=a[0],k=a[1],f=a[2],n=a[3],l=a[4],p=a[5],e=a[6],h=a[7],g=a[8];c[0]=l*g-p*h;c[1]=f*h-k*g;c[2]=k*p-f*l;c[3]=p*e-n*g;c[4]=b*g-f*e;c[5]=f*n-b*p;c[6]=n*h-l*e;c[7]=k*e-b*h;c[8]=b*l-k*n;return c};a.determinant=function(a){var c=a[3],b=a[4],k=a[5],f=a[6],n=a[7],l=a[8];return a[0]*(l*b-k*n)+a[1]*
(-l*c+k*f)+a[2]*(n*c-b*f)};a.multiply=function(a,c,b){var k=a[0],f=a[1],n=a[2],l=a[3],p=a[4],e=a[5],h=a[6],g=a[7];a=a[8];var q=c[0],z=c[1],G=c[2],D=c[3],B=c[4],v=c[5],E=c[6],A=c[7];c=c[8];b[0]=q*k+z*l+G*h;b[1]=q*f+z*p+G*g;b[2]=q*n+z*e+G*a;b[3]=D*k+B*l+v*h;b[4]=D*f+B*p+v*g;b[5]=D*n+B*e+v*a;b[6]=E*k+A*l+c*h;b[7]=E*f+A*p+c*g;b[8]=E*n+A*e+c*a;return b};a.mul=a.multiply;a.translate=function(a,c,b){var k=a[0],f=a[1],n=a[2],l=a[3],p=a[4],e=a[5],h=a[6],g=a[7];a=a[8];var q=c[0];c=c[1];b[0]=k;b[1]=f;b[2]=n;
b[3]=l;b[4]=p;b[5]=e;b[6]=q*k+c*l+h;b[7]=q*f+c*p+g;b[8]=q*n+c*e+a;return b};a.rotate=function(a,c,b){var k=a[0],f=a[1],n=a[2],l=a[3],p=a[4],e=a[5],h=a[6],g=a[7];a=a[8];var q=Math.sin(c);c=Math.cos(c);b[0]=c*k+q*l;b[1]=c*f+q*p;b[2]=c*n+q*e;b[3]=c*l-q*k;b[4]=c*p-q*f;b[5]=c*e-q*n;b[6]=h;b[7]=g;b[8]=a;return b};a.scale=function(a,c,b){var k=c[0];c=c[1];b[0]=k*a[0];b[1]=k*a[1];b[2]=k*a[2];b[3]=c*a[3];b[4]=c*a[4];b[5]=c*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.FA=function(a,c){c[0]=1;c[1]=0;c[2]=
0;c[3]=0;c[4]=1;c[5]=0;c[6]=a[0];c[7]=a[1];c[8]=1;return c};a.DA=function(a,c){var b=Math.sin(a),k=Math.cos(a);c[0]=k;c[1]=b;c[2]=0;c[3]=-b;c[4]=k;c[5]=0;c[6]=0;c[7]=0;c[8]=1;return c};a.EA=function(a,c){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=a[1];c[5]=0;c[6]=0;c[7]=0;c[8]=1;return c};a.fromMat2d=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=0;c[3]=a[2];c[4]=a[3];c[5]=0;c[6]=a[4];c[7]=a[5];c[8]=1;return c};a.fromQuat=function(a,c){var b=a[0],k=a[1],f=a[2],n=a[3],l=b+b,p=k+k,e=f+f,b=b*l,h=k*l,k=k*p,g=f*l,q=
f*p,f=f*e,l=n*l,p=n*p,n=n*e;c[0]=1-k-f;c[3]=h-n;c[6]=g+p;c[1]=h+n;c[4]=1-b-f;c[7]=q-l;c[2]=g-p;c[5]=q+l;c[8]=1-b-k;return c};a.normalFromMat4=function(a,c){var b=a[0],k=a[1],f=a[2],n=a[3],l=a[4],p=a[5],e=a[6],h=a[7],g=a[8],q=a[9],z=a[10],G=a[11],D=a[12],B=a[13],v=a[14],E=a[15],A=b*p-k*l,r=b*e-f*l,m=b*h-n*l,y=k*e-f*p,t=k*h-n*p,J=f*h-n*e,C=g*B-q*D,I=g*v-z*D,g=g*E-G*D,F=q*v-z*B,q=q*E-G*B,z=z*E-G*v,G=A*z-r*q+m*F+y*g-t*I+J*C;if(!G)return null;G=1/G;c[0]=(p*z-e*q+h*F)*G;c[1]=(e*g-l*z-h*I)*G;c[2]=(l*q-p*
g+h*C)*G;c[3]=(f*q-k*z-n*F)*G;c[4]=(b*z-f*g+n*I)*G;c[5]=(k*g-b*q-n*C)*G;c[6]=(B*J-v*t+E*y)*G;c[7]=(v*m-D*J-E*r)*G;c[8]=(D*t-B*m+E*A)*G;return c};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.CA=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var c=new p(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.copy=function(a,c){c[0]=a[0];
c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,c){if(c===a){var b=a[1],k=a[2],f=a[3],n=a[6],l=a[7],p=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=b;c[6]=a[9];c[7]=a[13];c[8]=k;c[9]=n;c[11]=a[14];c[12]=f;c[13]=
l;c[14]=p}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};a.invert=function(a,c){var b=a[0],k=a[1],f=a[2],n=a[3],l=a[4],p=a[5],e=a[6],h=a[7],g=a[8],q=a[9],z=a[10],G=a[11],D=a[12],B=a[13],v=a[14],E=a[15],A=b*p-k*l,r=b*e-f*l,m=b*h-n*l,y=k*e-f*p,t=k*h-n*p,J=f*h-n*e,C=g*B-q*D,I=g*v-z*D,F=g*E-G*D,N=q*v-z*B,w=q*E-G*B,K=z*E-G*v,x=A*K-r*w+m*N+y*F-t*I+J*C;if(!x)return null;
x=1/x;c[0]=(p*K-e*w+h*N)*x;c[1]=(f*w-k*K-n*N)*x;c[2]=(B*J-v*t+E*y)*x;c[3]=(z*t-q*J-G*y)*x;c[4]=(e*F-l*K-h*I)*x;c[5]=(b*K-f*F+n*I)*x;c[6]=(v*m-D*J-E*r)*x;c[7]=(g*J-z*m+G*r)*x;c[8]=(l*w-p*F+h*C)*x;c[9]=(k*F-b*w-n*C)*x;c[10]=(D*t-B*m+E*A)*x;c[11]=(q*m-g*t-G*A)*x;c[12]=(p*I-l*N-e*C)*x;c[13]=(b*N-k*I+f*C)*x;c[14]=(B*r-D*y-v*A)*x;c[15]=(g*y-q*r+z*A)*x;return c};a.adjoint=function(a,c){var b=a[0],k=a[1],f=a[2],n=a[3],l=a[4],p=a[5],e=a[6],h=a[7],g=a[8],q=a[9],z=a[10],G=a[11],D=a[12],B=a[13],v=a[14],E=a[15];
c[0]=p*(z*E-G*v)-q*(e*E-h*v)+B*(e*G-h*z);c[1]=-(k*(z*E-G*v)-q*(f*E-n*v)+B*(f*G-n*z));c[2]=k*(e*E-h*v)-p*(f*E-n*v)+B*(f*h-n*e);c[3]=-(k*(e*G-h*z)-p*(f*G-n*z)+q*(f*h-n*e));c[4]=-(l*(z*E-G*v)-g*(e*E-h*v)+D*(e*G-h*z));c[5]=b*(z*E-G*v)-g*(f*E-n*v)+D*(f*G-n*z);c[6]=-(b*(e*E-h*v)-l*(f*E-n*v)+D*(f*h-n*e));c[7]=b*(e*G-h*z)-l*(f*G-n*z)+g*(f*h-n*e);c[8]=l*(q*E-G*B)-g*(p*E-h*B)+D*(p*G-h*q);c[9]=-(b*(q*E-G*B)-g*(k*E-n*B)+D*(k*G-n*q));c[10]=b*(p*E-h*B)-l*(k*E-n*B)+D*(k*h-n*p);c[11]=-(b*(p*G-h*q)-l*(k*G-n*q)+g*
(k*h-n*p));c[12]=-(l*(q*v-z*B)-g*(p*v-e*B)+D*(p*z-e*q));c[13]=b*(q*v-z*B)-g*(k*v-f*B)+D*(k*z-f*q);c[14]=-(b*(p*v-e*B)-l*(k*v-f*B)+D*(k*e-f*p));c[15]=b*(p*z-e*q)-l*(k*z-f*q)+g*(k*e-f*p);return c};a.determinant=function(a){var c=a[0],b=a[1],k=a[2],f=a[3],n=a[4],l=a[5],p=a[6],e=a[7],h=a[8],g=a[9],q=a[10],z=a[11],G=a[12],D=a[13],B=a[14];a=a[15];return(c*l-b*n)*(q*a-z*B)-(c*p-k*n)*(g*a-z*D)+(c*e-f*n)*(g*B-q*D)+(b*p-k*l)*(h*a-z*G)-(b*e-f*l)*(h*B-q*G)+(k*e-f*p)*(h*D-g*G)};a.multiply=function(a,c,b){var k=
a[0],f=a[1],n=a[2],l=a[3],p=a[4],e=a[5],h=a[6],g=a[7],q=a[8],z=a[9],G=a[10],D=a[11],B=a[12],v=a[13],E=a[14];a=a[15];var A=c[0],r=c[1],m=c[2],y=c[3];b[0]=A*k+r*p+m*q+y*B;b[1]=A*f+r*e+m*z+y*v;b[2]=A*n+r*h+m*G+y*E;b[3]=A*l+r*g+m*D+y*a;A=c[4];r=c[5];m=c[6];y=c[7];b[4]=A*k+r*p+m*q+y*B;b[5]=A*f+r*e+m*z+y*v;b[6]=A*n+r*h+m*G+y*E;b[7]=A*l+r*g+m*D+y*a;A=c[8];r=c[9];m=c[10];y=c[11];b[8]=A*k+r*p+m*q+y*B;b[9]=A*f+r*e+m*z+y*v;b[10]=A*n+r*h+m*G+y*E;b[11]=A*l+r*g+m*D+y*a;A=c[12];r=c[13];m=c[14];y=c[15];b[12]=A*k+
r*p+m*q+y*B;b[13]=A*f+r*e+m*z+y*v;b[14]=A*n+r*h+m*G+y*E;b[15]=A*l+r*g+m*D+y*a;return b};a.mul=a.multiply;a.translate=function(a,c,b){var k=c[0],f=c[1];c=c[2];var n,l,p,e,h,g,q,z,G,D,B,v;a===b?(b[12]=a[0]*k+a[4]*f+a[8]*c+a[12],b[13]=a[1]*k+a[5]*f+a[9]*c+a[13],b[14]=a[2]*k+a[6]*f+a[10]*c+a[14],b[15]=a[3]*k+a[7]*f+a[11]*c+a[15]):(n=a[0],l=a[1],p=a[2],e=a[3],h=a[4],g=a[5],q=a[6],z=a[7],G=a[8],D=a[9],B=a[10],v=a[11],b[0]=n,b[1]=l,b[2]=p,b[3]=e,b[4]=h,b[5]=g,b[6]=q,b[7]=z,b[8]=G,b[9]=D,b[10]=B,b[11]=v,
b[12]=n*k+h*f+G*c+a[12],b[13]=l*k+g*f+D*c+a[13],b[14]=p*k+q*f+B*c+a[14],b[15]=e*k+z*f+v*c+a[15]);return b};a.scale=function(a,c,b){var k=c[0],f=c[1];c=c[2];b[0]=a[0]*k;b[1]=a[1]*k;b[2]=a[2]*k;b[3]=a[3]*k;b[4]=a[4]*f;b[5]=a[5]*f;b[6]=a[6]*f;b[7]=a[7]*f;b[8]=a[8]*c;b[9]=a[9]*c;b[10]=a[10]*c;b[11]=a[11]*c;b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.rotate=function(a,c,b,k){var f=b[0],n=b[1];b=b[2];var l=Math.sqrt(f*f+n*n+b*b),p,e,h,g,q,z,G,D,B,v,E,A,r,m,y,t,J,C,I,F;if(1E-7>Math.abs(l))return null;
l=1/l;f*=l;n*=l;b*=l;p=Math.sin(c);e=Math.cos(c);h=1-e;c=a[0];l=a[1];g=a[2];q=a[3];z=a[4];G=a[5];D=a[6];B=a[7];v=a[8];E=a[9];A=a[10];r=a[11];m=f*f*h+e;y=n*f*h+b*p;t=b*f*h-n*p;J=f*n*h-b*p;C=n*n*h+e;I=b*n*h+f*p;F=f*b*h+n*p;f=n*b*h-f*p;n=b*b*h+e;k[0]=c*m+z*y+v*t;k[1]=l*m+G*y+E*t;k[2]=g*m+D*y+A*t;k[3]=q*m+B*y+r*t;k[4]=c*J+z*C+v*I;k[5]=l*J+G*C+E*I;k[6]=g*J+D*C+A*I;k[7]=q*J+B*C+r*I;k[8]=c*F+z*f+v*n;k[9]=l*F+G*f+E*n;k[10]=g*F+D*f+A*n;k[11]=q*F+B*f+r*n;a!==k&&(k[12]=a[12],k[13]=a[13],k[14]=a[14],k[15]=a[15]);
return k};a.rotateX=function(a,c,b){var k=Math.sin(c);c=Math.cos(c);var f=a[4],n=a[5],l=a[6],p=a[7],e=a[8],h=a[9],g=a[10],q=a[11];a!==b&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[4]=f*c+e*k;b[5]=n*c+h*k;b[6]=l*c+g*k;b[7]=p*c+q*k;b[8]=e*c-f*k;b[9]=h*c-n*k;b[10]=g*c-l*k;b[11]=q*c-p*k;return b};a.rotateY=function(a,c,b){var k=Math.sin(c);c=Math.cos(c);var f=a[0],n=a[1],l=a[2],p=a[3],e=a[8],h=a[9],g=a[10],q=a[11];a!==b&&(b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=f*c-e*k;b[1]=n*c-h*k;b[2]=l*c-g*k;b[3]=p*c-q*k;b[8]=f*k+e*c;b[9]=n*k+h*c;b[10]=l*k+g*c;b[11]=p*k+q*c;return b};a.rotateZ=function(a,c,b){var k=Math.sin(c);c=Math.cos(c);var f=a[0],n=a[1],l=a[2],p=a[3],e=a[4],h=a[5],g=a[6],q=a[7];a!==b&&(b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=f*c+e*k;b[1]=n*c+h*k;b[2]=l*c+g*k;b[3]=p*c+q*k;b[4]=e*c-f*k;b[5]=h*c-n*k;b[6]=g*c-l*k;b[7]=q*c-p*k;return b};
a.FA=function(a,c){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c};a.EA=function(a,c){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a[1];c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=a[2];c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.DA=function(a,c,b){var k=c[0],f=c[1];c=c[2];var n=Math.sqrt(k*k+f*f+c*c),l;if(1E-7>Math.abs(n))return null;n=1/n;k*=n;f*=n;c*=n;n=Math.sin(a);a=Math.cos(a);l=1-a;b[0]=k*k*l+a;b[1]=f*k*l+c*
n;b[2]=c*k*l-f*n;b[3]=0;b[4]=k*f*l-c*n;b[5]=f*f*l+a;b[6]=c*f*l+k*n;b[7]=0;b[8]=k*c*l+f*n;b[9]=f*c*l-k*n;b[10]=c*c*l+a;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.zH=function(a,c){var b=Math.sin(a),k=Math.cos(a);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=k;c[6]=b;c[7]=0;c[8]=0;c[9]=-b;c[10]=k;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.AH=function(a,c){var b=Math.sin(a),k=Math.cos(a);c[0]=k;c[1]=0;c[2]=-b;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=b;c[9]=0;c[10]=k;c[11]=0;c[12]=0;c[13]=0;
c[14]=0;c[15]=1;return c};a.BH=function(a,c){var b=Math.sin(a),k=Math.cos(a);c[0]=k;c[1]=b;c[2]=0;c[3]=0;c[4]=-b;c[5]=k;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.fromRotationTranslation=function(a,c,b){var k=a[0],f=a[1],n=a[2],l=a[3],p=k+k,e=f+f,h=n+n;a=k*p;var g=k*e,k=k*h,q=f*e,f=f*h,n=n*h,p=l*p,e=l*e,l=l*h;b[0]=1-(q+n);b[1]=g+l;b[2]=k-e;b[3]=0;b[4]=g-l;b[5]=1-(a+n);b[6]=f+p;b[7]=0;b[8]=k+e;b[9]=f-p;b[10]=1-(a+q);b[11]=0;b[12]=c[0];b[13]=c[1];b[14]=c[2];
b[15]=1;return b};a.fromQuat=function(a,c){var b=a[0],k=a[1],f=a[2],n=a[3],l=b+b,p=k+k,e=f+f,b=b*l,h=k*l,k=k*p,g=f*l,q=f*p,f=f*e,l=n*l,p=n*p,n=n*e;c[0]=1-k-f;c[1]=h+n;c[2]=g-p;c[3]=0;c[4]=h-n;c[5]=1-b-f;c[6]=q+l;c[7]=0;c[8]=g+p;c[9]=q-l;c[10]=1-b-k;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(a,c,b,k,f,n,l){var p=1/(c-a),e=1/(k-b),h=1/(f-n);l[0]=2*f*p;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=2*f*e;l[6]=0;l[7]=0;l[8]=(c+a)*p;l[9]=(k+b)*e;l[10]=(n+f)*h;l[11]=-1;l[12]=0;l[13]=0;l[14]=
n*f*2*h;l[15]=0;return l};a.perspective=function(a,c,b,k,f){a=1/Math.tan(a/2);var n=1/(b-k);f[0]=a/c;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(k+b)*n;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*k*b*n;f[15]=0;return f};a.vI=function(a,c,b,k){var f=Math.tan(a.MI*Math.PI/180),n=Math.tan(a.qH*Math.PI/180),l=Math.tan(a.iI*Math.PI/180);a=Math.tan(a.yI*Math.PI/180);var p=2/(l+a),e=2/(f+n);k[0]=p;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=e;k[6]=0;k[7]=0;k[8]=-((l-a)*p*.5);k[9]=(f-n)*e*.5;k[10]=b/
(c-b);k[11]=-1;k[12]=0;k[13]=0;k[14]=b*c/(c-b);k[15]=0;return k};a.ortho=function(a,c,b,k,f,n,l){var p=1/(a-c),e=1/(b-k),h=1/(f-n);l[0]=-2*p;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=-2*e;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=2*h;l[11]=0;l[12]=(a+c)*p;l[13]=(k+b)*e;l[14]=(n+f)*h;l[15]=1;return l};a.lookAt=function(d,c,b,k){var f,n,l,p,e,h,g,q,z=d[0],G=d[1];d=d[2];l=b[0];p=b[1];n=b[2];g=c[0];b=c[1];f=c[2];if(1E-7>Math.abs(z-g)&&1E-7>Math.abs(G-b)&&1E-7>Math.abs(d-f))return a.identity(k);c=z-g;b=G-b;g=d-f;q=1/Math.sqrt(c*
c+b*b+g*g);c*=q;b*=q;g*=q;f=p*g-n*b;n=n*c-l*g;l=l*b-p*c;(q=Math.sqrt(f*f+n*n+l*l))?(q=1/q,f*=q,n*=q,l*=q):l=n=f=0;p=b*l-g*n;e=g*f-c*l;h=c*n-b*f;(q=Math.sqrt(p*p+e*e+h*h))?(q=1/q,p*=q,e*=q,h*=q):h=e=p=0;k[0]=f;k[1]=p;k[2]=c;k[3]=0;k[4]=n;k[5]=e;k[6]=b;k[7]=0;k[8]=l;k[9]=h;k[10]=g;k[11]=0;k[12]=-(f*z+n*G+l*d);k[13]=-(p*z+e*G+h*d);k[14]=-(c*z+b*G+g*d);k[15]=1;return k};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.CA=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a){function p(a,f){var p=a[0],e=a[1],h=a[2],g=a[3],p=c(p,e,h,g,f[0],7,-680876936),g=c(g,p,e,h,f[1],12,-389564586),h=c(h,g,p,e,f[2],17,606105819),e=c(e,h,g,p,f[3],22,-1044525330),p=c(p,e,h,g,f[4],7,-176418897),g=c(g,p,e,h,f[5],12,1200080426),h=c(h,g,p,e,f[6],17,-1473231341),e=c(e,h,g,p,f[7],22,-45705983),p=c(p,e,h,g,f[8],7,1770035416),g=c(g,p,e,h,f[9],12,-1958414417),h=c(h,g,p,e,f[10],17,-42063),e=c(e,h,g,p,f[11],22,-1990404162),p=c(p,e,h,g,f[12],7,1804603682),g=c(g,p,e,h,
f[13],12,-40341101),h=c(h,g,p,e,f[14],17,-1502002290),e=c(e,h,g,p,f[15],22,1236535329),p=b(p,e,h,g,f[1],5,-165796510),g=b(g,p,e,h,f[6],9,-1069501632),h=b(h,g,p,e,f[11],14,643717713),e=b(e,h,g,p,f[0],20,-373897302),p=b(p,e,h,g,f[5],5,-701558691),g=b(g,p,e,h,f[10],9,38016083),h=b(h,g,p,e,f[15],14,-660478335),e=b(e,h,g,p,f[4],20,-405537848),p=b(p,e,h,g,f[9],5,568446438),g=b(g,p,e,h,f[14],9,-1019803690),h=b(h,g,p,e,f[3],14,-187363961),e=b(e,h,g,p,f[8],20,1163531501),p=b(p,e,h,g,f[13],5,-1444681467),g=
b(g,p,e,h,f[2],9,-51403784),h=b(h,g,p,e,f[7],14,1735328473),e=b(e,h,g,p,f[12],20,-1926607734),p=d(e^h^g,p,e,f[5],4,-378558),g=d(p^e^h,g,p,f[8],11,-2022574463),h=d(g^p^e,h,g,f[11],16,1839030562),e=d(h^g^p,e,h,f[14],23,-35309556),p=d(e^h^g,p,e,f[1],4,-1530992060),g=d(p^e^h,g,p,f[4],11,1272893353),h=d(g^p^e,h,g,f[7],16,-155497632),e=d(h^g^p,e,h,f[10],23,-1094730640),p=d(e^h^g,p,e,f[13],4,681279174),g=d(p^e^h,g,p,f[0],11,-358537222),h=d(g^p^e,h,g,f[3],16,-722521979),e=d(h^g^p,e,h,f[6],23,76029189),p=
d(e^h^g,p,e,f[9],4,-640364487),g=d(p^e^h,g,p,f[12],11,-421815835),h=d(g^p^e,h,g,f[15],16,530742520),e=d(h^g^p,e,h,f[2],23,-995338651),p=k(p,e,h,g,f[0],6,-198630844),g=k(g,p,e,h,f[7],10,1126891415),h=k(h,g,p,e,f[14],15,-1416354905),e=k(e,h,g,p,f[5],21,-57434055),p=k(p,e,h,g,f[12],6,1700485571),g=k(g,p,e,h,f[3],10,-1894986606),h=k(h,g,p,e,f[10],15,-1051523),e=k(e,h,g,p,f[1],21,-2054922799),p=k(p,e,h,g,f[8],6,1873313359),g=k(g,p,e,h,f[15],10,-30611744),h=k(h,g,p,e,f[6],15,-1560198380),e=k(e,h,g,p,f[13],
21,1309151649),p=k(p,e,h,g,f[4],6,-145523070),g=k(g,p,e,h,f[11],10,-1120210379),h=k(h,g,p,e,f[2],15,718787259),e=k(e,h,g,p,f[9],21,-343485551);a[0]=p+a[0]&4294967295;a[1]=e+a[1]&4294967295;a[2]=h+a[2]&4294967295;a[3]=g+a[3]&4294967295}function d(a,b,c,d,f,g){b=(b+a&4294967295)+(d+g&4294967295)&4294967295;return(b<<f|b>>>32-f)+c&4294967295}function c(a,b,c,e,f,g,k){return d(b&c|~b&e,a,b,f,g,k)}function b(a,b,c,e,f,g,k){return d(b&e|c&~e,a,b,f,g,k)}function k(a,b,c,e,f,g,k){return d(c^(b|~e),a,b,f,
g,k)}var f="0123456789abcdef".split("");a.ut=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var h=b.substring(d-64,d),g=[],k=void 0,k=0;64>k;k+=4)g[k>>2]=h.charCodeAt(k)+(h.charCodeAt(k+1)<<8)+(h.charCodeAt(k+2)<<16)+(h.charCodeAt(k+3)<<24);p(a,g)}b=b.substring(d-64);h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)h[d>>2]|=b.charCodeAt(d)<<(d%4<<3);h[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,h),d=0;16>d;d++)h[d]=0;h[14]=8*
c;p(a,h);for(b=0;b<a.length;b++){c=a[b];d="";for(h=0;4>h;h++)d+=f[c>>8*h+4&15]+f[c>>8*h&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",
b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},
{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_color_id",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",
";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bQ ; varying vec4 bR ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_perspective_cast_far_bound ; varying vec4 bW ; varying vec4 bX ; varying vec4 bY ; varying vec4 bZ ; uniform float u_perspective_cast_far_bound ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"vec3 tA = u_camera_eye_frag - bQ ; vec3 tB = normalize ( tA ) ; vec3 tC ; vec3 tD ; vec3 tE ; float tF ; float tG ; tz ( tB , tC , tD , tE , tF , tG ) ; float tH = tG ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float tH = ( texture2D ( u_sampler , b_ ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float tH = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( tH < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO",
"CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bQ ; varying vec4 bR ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bV",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec3 wB = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",
b:["vec3","wC","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 wD = vec3 ( a_tangent ) ; vec3 wE = a_tangent [ 3 ] * cross ( wC , wD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 wD = vec3 ( 0.0 ) ; vec3 wE = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 wC = vec3 ( 0.0 ) ; vec3 wD = vec3 ( 0.0 ) ; vec3 wE = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"wB = mix ( wB , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"wC = mix ( wC , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 wF = vec3 ( a_tangent ) ; vec3 wG = a_tangent_next [ 3 ] * cross ( a_normal_next , wF ) ; wD = mix ( wD , wF , u_va_frame_factor ) ; wE = mix ( wE , wG , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vD ( wB , wD , wE , wC ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["vec3","wH","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 wH = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 wI = ( u_model_matrix * vec4 ( wH , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"mat4 wJ = um ( u_camera_eye , wI , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 wJ = ug ( u_camera_eye , wI , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 wK = ( u_model_matrix * vec4 ( wH , 1.0 ) ) . xyz ; wJ = wJ * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , wK ) ;".split(" ")}]}}]},
{type:"textline",b:"bh wL = ut ( wB - wH , wH , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wJ ) ; wL . b = wI ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bh wL = ut ( wB , wH , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wv ( wL . a , wL . b , wC ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec3","wM","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 wM = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"wv ( wL . a , wL . b , wM ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"b_ = uw ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bQ = wL . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",
d:5}],group:{type:"group",a:[{type:"textline",b:"bS = wL . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float wN = ( dot ( cross ( wL . e , wL . c ) , wL . d ) < 0.0 ) ? - 1.0 : 1.0 ; bT = vec4 ( wL . c , wN ) ;".split(" ")}]}}]},{type:"textline",b:"bR = u_view_matrix * vec4 ( wL . a , 1.0 ) ; vec4 wO = u_proj_matrix * bR ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",
b:"wO . xy += u_subpixel_jitter * wO . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float wP = wO . x ; float wQ = wO . y ; float wR = wO . w ; bU . x = ( wP + wR ) / 2.0 ; bU . y = ( wQ + wR ) / 2.0 ; bU . z = wR ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"bV = - bR . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["wA","(",")",";"]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( wL . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",
b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",
b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1},"NODES",
"ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",
file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bQ",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bT",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bR",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bW",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bV",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"vec3 wB = u_camera_eye_frag - bQ ; vec3 wC = normalize ( wB ) ; vec3 wD ; vec3 wE ; vec3 wF ; float wG ; float wH ; tz ( wC , wD , wE , wF , wG , wH ) ; float wI = wH ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float wI = ( texture2D ( u_colormap0 , b_ ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float wI = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( wI < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",
d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( dT ( bR . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:"gl_FragColor . a += 0.00001 * bT . r ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",
"ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION",
"float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bQ",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bS",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"bR",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bW",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","float","bV",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec3 xA = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",d:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["vec3","xB","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 xB = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",
b:"vec3 xC = vec3 ( a_tangent ) ; vec3 xD = a_tangent [ 3 ] * cross ( xB , xC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 xC = vec3 ( 0.0 ) ; vec3 xD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"xA = mix ( xA , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"xB = mix ( xB , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 xE = vec3 ( a_tangent ) ; vec3 xF = a_tangent_next [ 3 ] * cross ( a_normal_next , xE ) ; xC = mix ( xC , xE , u_va_frame_factor ) ; xD = mix ( xD , xF , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vD ( xA , xC , xD , xB ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vec3","xG","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 xG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"bh xH = xp ( xA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , xB , xG , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 xI = ( u_model_matrix * vec4 ( xG , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD",{type:"logic_negative_expr",d:1},"SHADOW_USAGE","SHADOW_CASTING",
{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["mat4","xJ","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","xJ","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 xK = um ( u_camera_eye , xI , xJ , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 xK = ug ( u_camera_eye , xI , xJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 xL = ( u_model_matrix * vec4 ( xG , 1.0 ) ) . xyz ; xK = xK * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , xL ) ;".split(" ")}]}}]},{type:"textline",b:"bh xH = ut ( xA - xG , xG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , xB , xK ) ; xH . b = xI ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bh xH = ut ( xA , xG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , xB , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec3","xM","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 xM = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"wv ( xH . a , xH . b , xM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bQ = xH . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bS = xH . e ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float xN = ( dot ( cross ( xH . e , xH . c ) , xH . d ) < 0.0 ) ? - 1.0 : 1.0 ; bT = vec4 ( xH . c , xN ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 xO = u_view_matrix * vec4 ( xH . a , 1.0 ) ; vec4 xP = u_proj_matrix * xO ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"xP . xy += u_subpixel_jitter * xP . w ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bU = bP ( xP ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bV = - bR . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:["wA","(",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"b_ = uw ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xz ( xH . a , xH . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["bR","=","xO",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 xQ = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float xR = SHADOW_TEX_RES / 2.0 ; xQ = floor ( xQ * xR + 0.5 ) / xR - xQ ; xP . xy += xQ ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","xP",";","}"]}]};
a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","xA",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","xA",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","xA",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","xA",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( xA , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , xA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",
a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","xA",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","xA",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","xA",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:"vec3 xB = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 xC = ug ( u_camera_eye , xB , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xC = xC * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"bh xD = ut ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , xC ) ; xD . b = xB ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bh xD = ut ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 xE = u_proj_matrix * u_view_matrix * vec4 ( xD . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"xA = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["xA","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["xA","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","xE",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 xB ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 b_ ; varying float xC ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const int xD = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"const int xD = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float xF ( float xE ) { return xE - floor ( xE * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void xO ( inout float xG , in float xH [ xD ] , in float xI ) { for ( int xJ = 0 ; xJ < NUM_RINGS ; xJ ++ ) { float xK = 40.0 * xH [ xJ ] ; float xL = 300.0 * ( xF ( xK ) - 0.005 ) ; float xM = xK ; float xN = abs ( xM * ( u_halo_size * xL - xI ) ) ; xG += 1.0 - min ( xN , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void xX ( inout float xP , in float xQ [ xD ] , in float xR ) { for ( int xS = 0 ; xS < NUM_LINES ; xS ++ ) { float xT = xQ [ xS ] ; float xU = xT ; float xV = 1000.0 * ( xF ( xT ) - 0.005 ) ; float xW = 20.0 * abs ( xU * b_ . x + xV * b_ . y ) ; xP += 1.0 - min ( xW , 1.0 ) ; } xP *= xR ; }".split(" ")}]}}]},{type:"textline",b:"void yd ( inout float xY , in vec2 xZ ) { float x_ , ya ; ya = atan ( xZ . y , xZ . x ) ; ya *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float yb = cos ( ya ) ; float yc = sin ( ya ) ; ya = ( yb * xZ . x + yc * xZ . y ) * ( yb * xZ . y - yc * xZ . x ) ; x_ = abs ( ya ) ; if ( x_ < 1.0 ) { x_ = ( 0.01 * u_halo_size ) / ( x_ ) ; xY *= sqrt ( min ( x_ , 1.0 ) ) ; } } void main ( ) { float ye = ( b_ . x * b_ . x + b_ . y * b_ . y ) ; float yf = sqrt ( ye ) ; ye = max ( 1.0 - ye , 0.0 ) ; ye = pow ( ye , u_halo_hardness ) ; float yg = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float yh [ xD ] ; for ( int yi = 0 ; yi < xD ; yi ++ ) { yh [ yi ] = fract ( xC / ( float ( yi ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float yj = 0.0 ; xO ( yj , yh , yf ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",
b:"float yk = 0.0 ; xX ( yk , yh , ye ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"yd ( ye , b_ ) ;".split(" ")}]}}]},{type:"textline",b:"ye *= yg ; vec3 yl = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"yj *= ye ; yl += u_halo_rings_color * yj ; ye += yj ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",
b:"yk *= yg ; yl += u_halo_lines_color * yk ; ye += yk ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ye *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float ym = u_halo_stars_blend * ( xB . y - u_halo_stars_height ) ; ye *= clamp ( ym , 0.0 , 1.0 ) ; ye *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"bb ( yl ) ; be ( yl , ye ) ; gl_FragColor = vec4 ( yl , ye ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 b_ ; varying float xC ;".split(" ")},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","xB",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 xD = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; b_ = a_halo_bb_vertex * 2.0 ; xC = fract ( xD . x + xD . y + xD . z ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"mat4 xE = tG ( xD , u_view_matrix ) ; mat4 xF = u_view_matrix ; xF [ 3 ] [ 0 ] = 0.0 ; xF [ 3 ] [ 1 ] = 0.0 ; xF [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 xE = tG ( xD , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 xG = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 xH = xE * xG ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 xI = u_proj_matrix * xF * xH ; xI . z = 0.99999 * xI . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["xB","=","xH",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 xI = u_proj_matrix * u_view_matrix * xH ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","xI",";",
"}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 xD = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( xD , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",
name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},
{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3",
"u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",
b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D",
"u_scene_depth",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","bQ",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bS",";"]}]}}]},{type:"textline",b:["varying","vec4","bR",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bW",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bV",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",
b:"void main ( ) { float yx = length ( bR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float yy = bQ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vec3","yz","=","u_sun_intensity",";"]}]}}]},{type:"textline",b:"vec3 yA = normalize ( u_camera_eye_frag - bQ ) ; vec3 yB ; vec3 yC ; vec3 yD ; float yE ; float yF ; tz ( yA , yB , yC , yD , yE , yF ) ; vec3 yG = yB ; float yH = yF ; vec3 yI = yD ; float yJ = yE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"yG = max ( yG - sqrt ( 0.01 * - min ( yy , 0.0 ) ) , 0.5 * yG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"aY ( yG , yy , u_time , yJ , yI , u_sun_direction , yz , u_sun_quaternion , bQ , yx ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( yH <= 0.5 ) discard ; yH = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["yH","=","1.0",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"yw ( yG , length ( bR ) , yA , yy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"yw ( yG , length ( bR ) , yA , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 yK = texture2DProj ( u_shadow_mask , bU ) . rg ; float yL = yK . g ; yG = vec3 ( yL ) ;".split(" ")}]}}]},
{type:"textline",b:["bb","(","yG",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"NODES_GLOW",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"be ( yG , yH ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( yG , yH ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",
b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},
{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",
a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",
a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:["varying","vec3","bQ",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","bS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bR",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bT",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","yx",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","yy",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bW",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float",
"bV",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec3 yz = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["vec3","yA","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 yA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"vec3 yB = vec3 ( a_tangent ) ; vec3 yC = a_tangent [ 3 ] * cross ( yA , yB ) ;".split(" ")}]}},{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 yD = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 yE = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 yF = yD - u_camera_eye ; vec3 yC = cross ( yF , yE ) ; vec3 yB = cross ( yE , yC ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 yB = vec3 ( 0.0 ) ; vec3 yC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"yz = mix ( yz , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",
b:"yA = mix ( yA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 yG = vec3 ( a_tangent ) ; vec3 yH = a_tangent_next [ 3 ] * cross ( a_normal_next , yG ) ; yB = mix ( yB , yG , u_va_frame_factor ) ; yC = mix ( yC , yH , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vD ( yz , yB , yC , yA ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vec3","yI","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 yI = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"bh yJ = xp ( yz , yB , yC , yA , yI , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 yK = ( u_model_matrix * vec4 ( yI , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 yL = um ( u_camera_eye , yK , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"mat4 yL = ug ( u_camera_eye , yK , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 yM = ( u_model_matrix * vec4 ( yI , 1.0 ) ) . xyz ; yL = yL * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , yM ) ;".split(" ")}]}}]},{type:"textline",b:"bh yJ = ut ( yz - yI , yI , yB , yC , yA , yL ) ; yJ . b = yK ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"bh yJ = ut ( yz , yI , yB , yC , yA , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float yN = ( dot ( cross ( yJ . e , yJ . c ) , yJ . d ) < 0.0 ) ? - 1.0 : 1.0 ; bT = vec4 ( yJ . c , yN ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"wv ( yJ . a , yJ . b , yA ) ;".split(" ")}]}}]},
{type:"textline",b:"bQ = yJ . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bS = yJ . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"yx = u_camera_eye - yJ . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"b_ = uw ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"yy = yJ . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["yy","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"vec4 yO = u_view_matrix * vec4 ( yJ . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["bR","=","yO",";"]}]}}]},{type:"textline",b:"vec4 yP = u_proj_matrix * yO ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"yP . xy += u_subpixel_jitter * yP . w ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bU = bP ( yP ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xz ( yJ . a , yJ . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE",
"NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bV = - yO . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["wA","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","yP",";","}"]}]};a["main_stack.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],
group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],
group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE",
"REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D",
"u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D",
"u_scene_depth",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform",
"float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 bQ ; varying vec3 bS ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bR",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bT",";"]}]}}]},{type:"textline",b:["varying","vec3","yx",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","yy",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bW",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","bY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","bV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:"float Br = length ( bR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float Bs = bQ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vec3","Bt","=","u_sun_intensity",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","Bu","=","b_",";"]}]}}]},{type:"textline",b:"vec3 Bv = normalize ( bS ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) Bv = Bv ; else Bv = - Bv ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 Bw = cross ( Bv , bT . xyz ) * bT . w ; mat3 Bx = mat3 ( bT . xyz , Bw , Bv ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"vec2 By = normalize ( u_view_matrix_frag * vec4 ( bS , 0.0 ) ) . st ; By = By * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( Br < PARALLAX_LOD_DIST ) { float Bz = clamp ( 0.5 * ( PARALLAX_LOD_DIST - Br ) , 0.0 , 1.0 ) ; float BA = u_parallax_scale * Bz ; vec3 BB = normalize ( yx * Bx ) ; float BC = 1.0 / PARALLAX_STEPS ; vec2 BD = BB . xy * BA / ( PARALLAX_STEPS * BB . z ) ; float BE = 1.0 ; float BF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec2","BG","=","By",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","BG","=","Bu",";"]}]}}]},{type:"textline",b:"BF = texture2D ( u_normalmap0 , BG ) . a ; for ( float BH = 1.0 ; BH <= PARALLAX_STEPS ; BH ++ ) { if ( BF < BE ) { BE -= BC ; BG -= BD ; BF = texture2D ( u_normalmap0 , BG ) . a ; } } vec2 BI = BG + BD ; float BJ = texture2D ( u_normalmap0 , BI ) . a - ( BE + BC ) ; float BK = BF - BE ; float BL = BK / ( BK - BJ ) ; BG = BL * BI + ( 1.0 - BL ) * BG ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"Bu += BG - By ;".split(" ")}]}}]},{type:"textline",b:["By","=","BG",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"By += BG - Bu ;".split(" ")}]}}]},{type:"textline",b:["Bu","=","BG",";"]}]}}]},
{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","BM",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BM = texture2D ( u_normalmap0 , By ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"BM = texture2D ( u_normalmap0 , Bu ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 BN = BM . rgb - 0.5 ; BN = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , BN , u_normal_factor ) ; vec3 BO = Bx * BN ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","BO","=","Bv",";"]}]}}]},{type:"textline",b:"BO = normalize ( BO ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"By = normalize ( u_view_matrix_frag * vec4 ( BO , 0.0 ) ) . st ; By = By * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 BP = normalize ( yx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 BQ = yy ; a_ ( BQ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 BR = vec4 ( BQ , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","BR","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","BS","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 BT = texture2D ( u_colormap0 , By ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 BT = texture2D ( u_colormap0 , Bu ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"a_ ( BT . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],
group:{type:"group",a:[{type:"textline",b:["vec4","BU",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BU = texture2D ( u_colormap1 , By ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"BU = texture2D ( u_colormap1 , Bu ) ;".split(" ")}]}}]},{type:"textline",b:"a_ ( BU . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 BV = texture2D ( u_stencil0 , By ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 BV = texture2D ( u_stencil0 , Bu ) ;".split(" ")}]}}]},{type:"textline",b:"BT = mix ( BT , BU , BV . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BR . rgb = mix ( BR . rgb , BT . rgb , u_diffuse_color_factor ) ; float BW = u_alpha_factor * BT . a ; BW += ( 1.0 - step ( 0.0 , BW ) ) ; BR . a = mix ( BW , 1.0 , u_diffuse_color . a ) ; BS = BT . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BR . rgb *= mix ( vec3 ( 1.0 ) , BT . rgb , u_diffuse_color_factor ) ; BR . a = BT . a ; BS = BT . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 BX = u_diffuse_intensity * BR . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","BY","=","BX",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 BZ = u_environment_energy * ew ( BO ) ; vec3 B_ = u_ambient * BZ ; float Ca = dY ( BX ) ; vec3 Cb = u_emit * BR . rgb ; vec3 Cc = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 Cd = vec3 ( BS ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"vec3 Cd = texture2D ( u_specmap0 , By ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 Cd = texture2D ( u_specmap0 , Bu ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"a_ ( Cd . rgb ) ; Cc = mix ( Cc , Cd , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"float Ce = u_specular_params [ 0 ] ; vec2 Cf = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 Cg = Ce * Cc ; vec3 BY ; vec3 Ch ; Bq ( Cb , B_ , BX , Cg , bQ , BO , BP , Cf , u_diffuse_params , Ca , 0.0 , vec4 ( 0.0 ) , BY , Ch ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"et ( BY , BP , BO , u_reflect_factor ) ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"et ( BY , BP , BO , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["BY","+=","Ch",";"]}]}}]},{type:"textline",b:"float Ci = BR . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"BY = max ( BY - sqrt ( 0.01 * - min ( Bs , 0.0 ) ) , 0.5 * BY ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"aY ( BY , Bs , u_time , Ca , BO , u_sun_direction , Bt , u_sun_quaternion , bQ , Br ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( Ci <= 0.5 ) discard ; Ci = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],
group:{type:"group",a:[{type:"textline",b:"float Cj = max ( max ( Ch . r , Ch . g ) , Ch . b ) * u_specular_alpha ; Ci = BR . a * ( 1.0 - Cj ) + Cj ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["Ci","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"BY = mix ( eK ( bU , BO . xz * u_refr_bump ) , BY , Ci ) ; Ci = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"yw ( BY , Br , BP , Bs ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"yw ( BY , Br , BP , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["bb","(","BY",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"be ( BY , Ci ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( BY , Ci ) ; }".split(" ")}]};a["main_stack.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute",
"vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},
{type:"textline",b:["varying","vec3","bQ",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO",
"PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bR",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","yx",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","yy",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bW",";"]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bV",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},
{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec3 Br = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",
b:["vec3","Bs","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 Bs = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 Bt = vec3 ( a_tangent ) ; vec3 Bu = a_tangent [ 3 ] * cross ( Bs , Bt ) ;".split(" ")}]}},{type:"elif",
c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 Bv = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 Bw = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 Bx = Bv - u_camera_eye ; vec3 Bu = cross ( Bx , Bw ) ; vec3 Bt = cross ( Bw , Bu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 Bt = vec3 ( 0.0 ) ; vec3 Bu = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"Br = mix ( Br , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"Bs = mix ( Bs , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 By = vec3 ( a_tangent ) ; vec3 Bz = a_tangent_next [ 3 ] * cross ( a_normal_next , By ) ; Bt = mix ( Bt , By , u_va_frame_factor ) ; Bu = mix ( Bu , Bz , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vD ( Br , Bt , Bu , Bs ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["vec3","BA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 BA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"bh BB = xp ( Br , Bt , Bu , Bs , BA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 BC = ( u_model_matrix * vec4 ( BA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 BD = um ( u_camera_eye , BC , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 BD = ug ( u_camera_eye , BC , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 BE = ( u_model_matrix * vec4 ( BA , 1.0 ) ) . xyz ; BD = BD * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , BE ) ;".split(" ")}]}}]},{type:"textline",b:"bh BB = ut ( Br - BA , BA , Bt , Bu , Bs , BD ) ; BB . b = BC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bh BB = ut ( Br , BA , Bt , Bu , Bs , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float BF = ( dot ( cross ( BB . e , BB . c ) , BB . d ) < 0.0 ) ? - 1.0 : 1.0 ; bT = vec4 ( BB . c , BF ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"wv ( BB . a , BB . b , Bs ) ;".split(" ")}]}}]},{type:"textline",b:"bQ = BB . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bS = BB . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"yx = u_camera_eye - BB . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"b_ = uw ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"yy = BB . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["yy","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"vec4 BG = u_view_matrix * vec4 ( BB . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",
{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["bR","=","BG",";"]}]}}]},{type:"textline",b:"vec4 BH = u_proj_matrix * BG ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"BH . xy += u_subpixel_jitter * BH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE",
"SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bU = bP ( BH ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xz ( BB . a , BB . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bV = - BG . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["wA","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","BH",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",
a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"varying float Br ; varying vec3 yy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"varying vec4 bR ; varying vec3 bU ; varying float Bs ;".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec2 Bt = gl_PointCoord - 0.5 ; float Bu = 2.0 * length ( Bt ) ; float Bv = smoothstep ( u_p_alpha_start , u_p_alpha_end , Bu ) ; float Bw = u_diffuse_color . a * Br * ( 1.0 - Bv ) ; vec3 Bx = yy * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",
a:[{type:"textline",b:"vec2 By = bU . xy / bU . z ; vec2 Bz = vec2 ( Bt . x , - Bt . y ) * Bs * u_texel_size ; vec2 BA = vec2 ( By + Bz ) ; vec4 BB = texture2D ( u_scene_depth , BA ) ; float BC = l ( BB ) ; float BD = - bR . z / u_view_max_depth ; float BE = BC - BD ; float BF = u_view_max_depth / SOFT_STRENGTH * BE ; Bw = Bw * min ( BF , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["bb","(","Bx",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"be ( Bx , Bw ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( Bx , Bw ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_height ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float Br ; varying vec3 yy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"varying vec4 bR ; varying vec3 bU ; varying float Bs ;".split(" ")}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { Bt Ci ; Ci = Ch ( ) ; vec4 Cj = u_view_matrix * vec4 ( Ci . b , 1.0 ) ; vec4 Ck = u_proj_matrix * Cj ; gl_Position = Ck ; Br = Ci . c ; yy = Ci . d ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["bR","=","Cj",";"]}]}}]},{type:"textline",b:"float Cl = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; float Cm = Ci . a * Cl ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"float Cn = Ck . x ; float Co = Ck . y ; float Cp = Ck . w ; bU . x = ( Cn + Cp ) / 2.0 ; bU . y = ( Co + Cp ) / 2.0 ; bU . z = Cp ; Bs = Cm ;".split(" ")}]}}]},
{type:"textline",b:["gl_PointSize","=","Cm",";","}"]}]};a["particles_texture.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",
file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",
";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float Br ; varying vec3 yy ; varying vec2 b_ ; varying vec3 bQ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","yx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bR",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec4 Ci = u_diffuse_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 Cj = texture2D ( u_sampler , b_ ) ; a_ ( Cj . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ci . rgb = mix ( Ci . rgb , Cj . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"Ci . rgb *= mix ( vec3 ( 1.0 ) , Cj . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"Ci . a = Cj . a ;".split(" ")}]}}]},{type:"textline",b:"Ci . rgb *= yy ; vec3 Ck = u_diffuse_intensity * Ci . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 Cl = normalize ( yx ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec3 Cm = u_emit * Ci . rgb ; vec3 Cn = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",d:1},"SKY_COLOR",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec3 Co = u_environment_energy * ew ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"vec3 Co = u_environment_energy * ew ( Cn ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 Cp = u_ambient * Co ; float Cq = u_specular_params [ 0 ] ; vec2 Cr = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 Cs = Cq * u_specular_color ; vec3 Ct ; vec3 Cu ; Bq ( Cm , Cp , Ck , Cs , bQ , Cn , Cl , Cr , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , Ct , Cu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","Ct","=","Ck",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"yw ( Ct , length ( bR ) , Cl , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float Cv = Ci . a * Br ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"float Cw = - bR . z / u_view_max_depth ; vec4 Cx = texture2DProj ( u_scene_depth , bU ) ; float Cy = l ( Cx ) ; float Cz = Cy - Cw ; float CA = u_view_max_depth / SOFT_STRENGTH * Cz ; Cv = Cv * min ( CA , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["bb","(","Ct",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"be ( Ct , Cv ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( Ct , Cv ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",
file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform vec3 u_wind ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float Br ; varying vec3 yy ; varying vec2 b_ ; varying vec3 yx ; varying vec3 bQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bR",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float Ck ( vec2 Ci , vec2 Cj ) { return ( atan ( Cj . y , Cj . x ) - atan ( Ci . y , Ci . x ) ) ; } void main ( ) { Bt Cl ; Cl = Ch ( ) ; float Cm ; mat4 Cn ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { Cm = Cl . e ; Cn = tG ( Cl . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { Cm = Cl . e ; Cn = bB ( ) ; Cn [ 3 ] = vec4 ( Cl . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { Cm = Cl . e ; Cn = bF ( radians ( 90.0 ) ) ; Cn [ 3 ] = vec4 ( Cl . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { Cm = Ck ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + Cl . e ; Cn = bD ( radians ( - 90.0 ) ) ; Cn [ 3 ] = vec4 ( Cl . b , 1.0 ) ; } vec4 Co = vec4 ( a_p_bb_vertex * 2.0 * Cl . a * u_p_size , 0.0 , 1.0 ) ; vec4 Cp = Cn * bH ( Cm ) * Co ; vec4 Cq = u_view_matrix * Cp ; vec4 Cr = u_proj_matrix * Cq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"float Cs = Cr . x ; float Ct = Cr . y ; float Cu = Cr . w ; bU . x = ( Cs + Cu ) / 2.0 ; bU . y = ( Ct + Cu ) / 2.0 ; bU . z = Cu ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = Cr ; Br = Cl . c ; yy = Cl . d ; b_ = a_p_bb_vertex + 0.5 ; bQ = Cp . xyz ; yx = u_camera_eye - Cp . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["bR","=","Cq",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 Ci ; const float Cj = 0.99 ; const float Ck = 1.8 ; const int Cl = 8 ; float Cv ( vec3 Cm , vec3 Cn ) { float Co = dot ( Cn , Cn ) ; float Cp = 2.0 * dot ( Cn , Cm ) ; float Cq = dot ( Cm , Cm ) - 1.0 ; float Cr = Cp * Cp - 4.0 * Co * Cq ; float Cs = sqrt ( Cr ) ; float Ct = ( - Cp - Cs ) / 2.0 ; float Cu = Cq / Ct ; return Cu ; } float CC ( float Cw , float Cx ) { float Cy = 3.0 * ( 1.0 - Cx * Cx ) ; float Cz = 2.0 * ( 2.0 + Cx * Cx ) ; float CA = 1.0 + Cw * Cw ; float CB = pow ( 1.0 + Cx * Cx - 2.0 * Cx * Cw , 1.5 ) ; CB = max ( CB , 0.00001 ) ; return ( Cy / Cz ) * ( CA / CB ) ; } float CK ( vec3 CD , vec3 CE , float CF ) { float CG = dot ( CE , - CD ) ; if ( CG < 0.0 ) { return 1.0 ; } vec3 CH = CD + CG * CE ; if ( length ( CH ) < CF ) { return 0.0 ; } else if ( length ( CH ) >= CF ) { vec3 CI = normalize ( CH ) * CF - CD ; float CJ = acos ( dot ( normalize ( CI ) , CE ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( CJ * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 CO ( float CL , vec3 CM , float CN ) { return CM - CM * pow ( u_sky_color , vec3 ( CN / CL ) ) ; } void main ( ) { vec3 CP = normalize ( Ci ) ; vec3 CQ = u_sun_direction ; float CR = dot ( CP , CQ ) ; float CS = CC ( CR , - 0.01 ) * u_rayleigh_brightness * CQ . y ; float CT = CC ( CR - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - CQ . y ) ; float CU = smoothstep ( 0.0 , 100.0 , CC ( CR , 0.9995 ) ) * u_spot_brightness ; vec3 CV = vec3 ( 0.0 , Cj , 0.0 ) ; float CW = Cv ( CV , CP ) ; float CX = CW / float ( Cl ) ; float CY = CK ( CV , CP , Cj - 0.3 ) ; vec3 CZ = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 C_ = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int Da = 0 ; Da < Cl ; Da ++ ) { float Db = CX * float ( Da ) ; vec3 Dc = CV + CP * Db ; float Dd = CK ( Dc , CQ , Cj - 0.2 ) ; float De = Cv ( Dc , CQ ) ; vec3 Df = CO ( De , vec3 ( Ck ) , u_scatter_strength ) * Dd ; CZ += CO ( sqrt ( Db ) , u_sky_color * Df , u_rayleigh_strength ) ; C_ += CO ( Db , Df , u_mie_strength ) ; } CZ = CZ * CY * pow ( CW , u_rayleigh_collection_power ) / float ( Cl ) ; C_ = ( C_ * CY * pow ( CW , u_mie_collection_power ) ) / float ( Cl ) ; vec3 Dg = vec3 ( CU * C_ + CT * C_ + CS * CZ ) ; bb ( Dg ) ; gl_FragColor = vec4 ( Dg , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 Ci ; void main ( ) { vec4 Cj = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 Ck = u_cube_view_matrix * Cj ; Ci = Ck . xyz ; gl_Position = Cj ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 b_ ; void main ( ) { vec4 Cj = texture2D ( u_sampler , b_ ) ; bb ( Cj . rgb ) ; be ( Cj . rgb , Cj . a ) ; gl_FragColor = Cj ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 b_ ; void main ( ) { b_ = a_texcoord ; vec3 Cj = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 Ck = u_proj_matrix * u_view_matrix * vec4 ( Cj , 0.0 ) ; Ck . x /= Ck . w ; Ck . y /= Ck . w ; Ck += 99999.0 * step ( Ck . z , 0.0 ) ; Ck += 100.0 * ( step ( 1.0 , abs ( Ck . x ) ) + step ( 1.0 , abs ( Ck . y ) ) ) ; Ck . x = - a_lf_dist * Ck . x ; Ck . y = - a_lf_dist * Ck . y ; float Cl = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 Cm = vec2 ( a_lf_bb_vertex . x / Cl , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float Cn = 1.9 ; Cm *= ( 1.0 + Cn * length ( Ck . xy ) ) ; } gl_Position = vec4 ( Ck . xy + Cm , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Et ( vec3 Eo , vec3 Ep , float Eq , float Er ) { float Es = Eq * Er ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return CB ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",
c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return CF ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return CJ ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return CO ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"return CT ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return CY ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Db ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Df ( Eo , Ep , Es ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Dj ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Dn ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","HUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Du ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SATURATION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"return DA ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","VALUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return DG ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","COLOR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return DN ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return DS ( Ep , Eo , Es ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return DW ( Ep , Eo , Es ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float EB ( float Eu , float Ev , float Ew , float Ex ) { vec3 Ey = vec3 ( Eu ) , Ez = vec3 ( Ev ) ; float EA = Ew * Ex ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return CB ( Ez , Ey , EA ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return CF ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return CJ ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Eb ( Eu , Ev , EA , Ex ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Eh ( Eu , Ev , EA , Ex ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return En ( Eu , Ev , EA , Ex ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Db ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"return Df ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Dj ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Dn ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return DS ( Ez , Ey , EA ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return DW ( Ez , Ey , EA ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",
d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","Ci",";"]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 EC ; vec3 ED = normalize ( Ci ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"EC = textureCube ( u_sky , ED ) . rgb ;".split(" ")}]}},{type:"elif",c:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"EC = u_horizon_color ; bb ( EC ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","EE",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"EE = vec3 ( b_ , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"EE = vec3 ( Ci . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["float","EF","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"EF = abs ( b_ . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"EF = ( b_ . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float EG = acos ( ED . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"EF = abs ( EG * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"EF = 1.0 - EG * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",b:"vec3 EH = u_horizon_color ; vec3 EI = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"float EJ = 1.0 ; vec4 EK = textureCube ( u_sky , ED ) ; a_ ( EK . rgb ) ; EJ = EK . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"EJ = dot ( EK . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"EK = vec4 ( vec3 ( 1.0 ) - EK . rgb , EK . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"EJ = 1.0 - EJ ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"EK = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"EJ = EK . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"EH = Et ( EK . rgb , EH , EJ , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["float","EL","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( EE , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"EL = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",
b:"else EL = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"EL = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"EL = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( EL != 0.0 ) EI = Et ( EK . rgb , EI , EJ , EL ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_BLEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"EJ = dot ( EK . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",b:"EF = EB ( u_sky_tex_dvar , EF , EJ , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"EC = mix ( EH , EI , EF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["EC","=","EH",";"]}]}}]},{type:"textline",b:["bb","(","EC",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bb ( EH ) ; bb ( EI ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"EC = mix ( EH , EI , EF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["EC","=","EH",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"REFLECTION_PASS",
{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"a_ ( EC ) ; float EM = u_camera_eye_frag . y - WATER_LEVEL ; EM = min ( - EM * 0.03 , 0.8 ) ; float EN = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 EO = vec3 ( 0.0 ) ; vec4 EP = u_underwater_fog_color_density ; EP . rgb = mix ( EP . rgb , EO , min ( - ED . y + EM , 1.0 ) ) * EN ; float EQ = clamp ( sign ( ED . y - 0.05 * EM ) , 0.0 , 1.0 ) ; EC = mix ( EP . rgb , EC , EQ ) ; bb ( EC ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( EC , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 Ci ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 Eo = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 Ep = u_sky_vp_inverse * Eo ; Ci = Ep . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"b_ = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","Eo",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",
b:["0.0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT",
"SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2",
"u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float Eo = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 yx ; varying vec3 bQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",
{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bT ; varying vec3 Ep ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bS",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Eq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Er",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Es",";"]}]}}]},{type:"include",
file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"vec3 EG ( in vec2 Et , in vec3 Eu , in vec3 Ev , in vec3 Ew , out float Ex ) { Ex = 0.0 ; vec3 Ey = reflect ( - Ev , Eu ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Ez = Et . xy + Eu . xz * REFL_BUMP / bV ; Ex = u_reflect_factor ; vec3 EA ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EA = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"EA = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"} else { EA = texture2D ( u_plane_reflection , Ez ) . rgb ; a_ ( EA ) ; }".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ex = u_mirror_factor ; vec3 EA = Ew * textureCube ( u_mirrormap , Ey ) . rgb ; a_ ( EA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ex = u_reflect_factor ; vec3 EA = Ew * vec3 ( 0.3 , 0.5 , 1.0 ) ; a_ ( EA ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 EB = normalize ( Ey + Ev ) ; float EC = 1.0 - dot ( Ev , EB ) ; float ED = u_fresnel_params [ 3 ] ; float EE = u_fresnel_params [ 2 ] ; float EF = ED + ( 1.0 - ED ) * pow ( EC , EE ) ; Ex = min ( Ex * EF , 1.0 ) ; return EA ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat3 EH = mat3 ( bT , Ep , bS ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec3 EI = normalize ( bS ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 EI = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","FOAM",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float EJ = bQ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 EK = vec2 ( Eq . x , - Eq . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 EK = vec2 ( bQ . x , - bQ . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","EK","=","b_",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 EL = vec3 ( 0.0 ) ; vec3 EM = texture2D ( u_normalmap0 , EK * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; EL += EM ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 EN = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["EN",
"+=","EM",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EM = texture2D ( u_normalmap0 , EK * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; EL += EM ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["EN","+=","EM",";"]}]}}]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EM = texture2D ( u_normalmap0 , EK * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; EL += EM ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["EN","+=","EM",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,
{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EM = texture2D ( u_normalmap0 , EK * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; EL += EM ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["EN","+=","EM",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 EO = EH * EN ; if ( ! bk ( EO , vec3 ( 0.0 ) ) ) EO = normalize ( EO ) ; vec3 EP = mix ( EI , EO , 0.2 ) ; EP = normalize ( EP ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"EI = mix ( EI , normalize ( EH * EL ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"EI = mix ( EI , normalize ( EH * EL ) , 0.5 ) ;".split(" ")}]}}]},
{type:"textline",b:"EI = normalize ( EI ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 EQ = normalize ( yx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 ER = bU . xy / bU . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"float ES = bV * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float ET = u_diffuse_color . a ; vec4 EU = texture2DProj ( u_scene_depth , bU ) ; float EV = l ( EU ) ; float EW = max ( EV - bV , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 EX = ER + EI . xz * u_refr_bump / bV ; float EY = eC ( EV , EX , ER ) ; float EZ = max ( EY - bV , 0.0 ) ; float E_ = u_view_max_depth / ABSORB * EZ ; float Fa ; if ( u_cam_water_depth < 0.0 ) Fa = 0.0 ; else Fa = min ( ET * E_ , 1.0 ) ; float Fb = u_view_max_depth / ABSORB * EW ; ET = min ( 15.0 * ET * u_view_max_depth * EW , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float Fb = u_view_max_depth / ABSORB * EW ; if ( u_cam_water_depth > 0.0 ) ET = min ( ET * Fb , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ET *= min ( 5.0 * ES , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ET = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float Fa = 1.0 - ET ; vec2 EX = ER + EI . xz * u_refr_bump / bV ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 Fc = texture2D ( u_refractmap , EX ) . rgb ; a_ ( Fc ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float Fd = pow ( min ( Er . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 Fe = mix ( u_shallow_water_col , u_diffuse_color . rgb , Fd ) ; Fd = pow ( min ( Er . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; Fe = mix ( u_shore_water_col , Fe , Fd ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 Fe = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float Ff = max ( 1.0 - u_view_max_depth * EW , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float Ff = 1.0 - ET ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float Fg = max ( EJ / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 Fh = normalize ( vec3 ( Er . r , 0.0 , Er . g ) ) ; vec3 Fi = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , Fh , 0.8 ) ) ; float Fj = 1.25 * max ( dot ( EP , Fi ) - 0.2 , 0.0 ) ; Fj += max ( dot ( EP , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; Ff += Fj * ( 1.0 - Er . b ) ; Fg *= ( 1.0 - 0.95 * pow ( Er . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"Ff += Fg ; Ff = min ( u_foam_factor * Ff , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 Fk = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + EK * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float Fl = u_specular_params [ 0 ] ; vec2 Fm = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 Fn = Fl * u_specular_color ; vec3 Fo = u_environment_energy * ew ( EI ) ; vec3 Fp = u_ambient * Fo ; vec3 Fq = Fp + u_sun_intensity ; float Fr ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 Fs = EG ( ER , EI , EQ , Fq , Fr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 Fs = EG ( vec2 ( 0.0 ) , EI , EQ , Fq , Fr ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 Ft = u_diffuse_intensity * Fe ; vec3 Fu ; vec3 Fv ; Bq ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ft , Fn , bQ , EI , EQ , Fm , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , Fu , Fv ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float Fw = max ( dot ( u_sun_direction , - bS ) + SSS_WIDTH , 0.0 ) * max ( dot ( - EQ , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; Fw = clamp ( SSS_STRENGTH * Fw , 0.0 , 1.0 ) ; Fu = mix ( Fu , u_shallow_water_col , Fw ) ; Fu = mix ( Fu , u_shore_water_col , Fw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",
b:"Fu = mix ( Fc , Fu , Fa ) ;".split(" ")}]}}]},{type:"textline",b:"Fu = mix ( Fu , Fs , Fr ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float Fx = mix ( Fk . g , Fk . r , max ( 4.0 * ( Ff - 0.75 ) , 0.0 ) ) ; Fx = mix ( Fk . b , Fx , max ( 2.0 * Ff - 1.0 , 0.0 ) ) ; Fx = mix ( 0.0 , Fx , Ff ) ; Fu = mix ( Fu , Fq , Fx ) ;".split(" ")}]}}]},{type:"textline",b:["Fu","+=","Fv",";"]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { yp ( Fu , ES , u_cam_water_depth ) ; } else { yw ( Fu , ES , EQ , 1.0 ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"yw ( Fu , ES , EQ , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["bb","(","Fu",")",";"]},{type:"condition",a:[{type:"if",c:["REFRACTIVE",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"textline",b:"ET = max ( ET , Fv . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["ET","+=","Fx",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"be ( Fu , ET ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 Fy = fwidth ( Es ) ; vec3 Fz = smoothstep ( vec3 ( 0.0 ) , Fy * Eo , Es ) ; float FA = min ( min ( Fz . x , Fz . y ) , Fz . z ) ; FA = clamp ( FA , 0.0 , 1.0 ) ; Fu = mix ( u_wireframe_edge_color , Fu , FA ) ; ET = mix ( 1.0 , ET , FA ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( Fu , ET ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",
b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},
{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"DYNAMIC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["GENERATED_MESH",{type:"logic_negative_expr",d:1},"NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",
"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 yx ; varying vec3 bQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},
"GENERATED_MESH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","b_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bT ; varying vec3 Ep ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3",
"bS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Eq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Er",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",
{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bU",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Es",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 Ey ( in vec2 Eo ) { vec2 Et = 0.5 + vec2 ( ( Eo . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( Eo . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 Eu = texture2D ( u_shore_dist_map , Et ) ; const vec2 Ev = vec2 ( 1.0 / 255.0 , 1.0 ) ; float Ew = dot ( Eu . ba , Ev ) ; vec2 Ex = normalize ( Eu . rg * 2.0 - 1.0 ) ; return vec3 ( Ex , Ew ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void EP ( inout vec3 Ez , in float EA , in vec3 EB ) { float EC = au ( DST_NOISE_SCALE_0 * ( Ez . xz + DST_NOISE_FREQ_0 * EA ) ) * au ( DST_NOISE_SCALE_1 * ( Ez . zx - DST_NOISE_FREQ_1 * EA ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float ED = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float EE = EB . b ; float EF = sqrt ( EE ) ; float EG = max ( EE , DIR_MIN_SHR_FAC ) * sin ( EF / ED + DIR_FREQ * EA ) ; float EH = max ( au ( DIR_NOISE_SCALE * ( Ez . xz + DIR_NOISE_FREQ * EA ) ) , DIR_MIN_NOISE_FAC ) ; EG *= EH ; float EI = WAVES_HEIGHT * mix ( EG , EC , max ( EF , DST_MIN_FAC ) ) ; vec2 EJ = EB . rg ; float EK = WAVES_HOR_FAC * EG * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - EE ) , 0.0 ) ; vec2 EL = EK * EJ ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float EI = WAVES_HEIGHT * EC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 EM = 2.0 * ( Ez . xz - 0.1 * EA ) ; vec2 EN = 1.3 * ( Ez . zx + 0.03 * EA ) ; float EO = Q ( 0.5 * EM ) . x + Q ( 0.5 * EN ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Ez . xz += EL ; EO *= EE ;".split(" ")}]}}]},{type:"textline",
b:"EI += SMALL_WAVES_FAC * EO ;".split(" ")}]}}]},{type:"textline",b:"Ez . y += EI ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) Es = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Es = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Es = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","EQ","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float ER = abs ( EQ . y ) ; vec2 ES = u_camera_eye . xz - mod ( u_camera_eye . xz , ER ) ; EQ . y = WATER_LEVEL ; EQ . xz += ES ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["b_","=","a_texcoord",";"]}]}}]},{type:"textline",b:"bh ET = ut ( EQ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Er = Ey ( ET . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float EU = length ( u_wind ) ; float EV = u_time ; EV *= EU ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float EW = ER ; vec3 EX = ET . a + vec3 ( EW , 0.0 , 0.0 ) ; vec3 EY = ET . a + vec3 ( 0.0 , 0.0 , EW ) ; if ( a_position . y < 0.0 ) { ET . a . y = WATER_LEVEL - 1.0 ; EX . y = ET . a . y ; EY . y = ET . a . y ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Eq = ET . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 EX = ET . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; vec3 EY = ET . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 EZ = Ey ( EX . xz ) ; vec3 E_ = Ey ( EY . xz ) ; EP ( EX , EV , EZ ) ; EP ( EY , EV , E_ ) ; EP ( ET . a , EV , Er ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"EP ( EX , EV , vec3 ( 0.0 ) ) ; EP ( EY , EV , vec3 ( 0.0 ) ) ; EP ( ET . a , EV , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 Fa = normalize ( EX - ET . a ) ; vec3 Fb = normalize ( EY - ET . a ) ; bS = normalize ( cross ( Fb , Fa ) ) ; float Fc = dot ( bS , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float Fd = clamp ( 0.8 - Fc , 0.0 , 1.0 ) ; bS = mix ( bS , vec3 ( 0.0 , 1.0 , 0.0 ) , Fd ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec3 Fb = a_tangent ; bS = a_normal ;".split(" ")}]}}]},{type:"textline",b:"bT = Fb ; Ep = cross ( bS , bT ) ;".split(" ")}]}}]},{type:"textline",b:"bQ = ET . a ; yx = u_camera_eye - ET . a ; vec4 Fe = u_view_matrix * vec4 ( ET . a , 1.0 ) ; vec4 Ff = u_proj_matrix * Fe ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"float Fg = Ff . x ; float Fh = Ff . y ; float Fi = Ff . w ; bU . x = ( Fg + Fi ) / 2.0 ; bU . y = ( Fh + Fi ) / 2.0 ; bU . z = Fi ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",
d:4}],group:{type:"group",a:[{type:"textline",b:"bV = - Fe . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","Ff",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_NONE",b:["0"]},{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["1"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["2"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["3"]},{type:"define",name:"WM_DEBUG_SPHERES",b:["4"]},{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 Es ; const float Eo = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 Et = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Et = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Eu = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Ev = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Ew = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec3 Ex = vec3 ( 0.0 ) ; float Ey = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",
b:"vec3 Ez = sign ( Es - vec3 ( 0.02 * Eo ) ) ; if ( Ez . x < 0.0 || Ez . y < 0.0 || Ez . z < 0.0 ) { Ex = Et ; Ey = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 Ez = sign ( Es - vec3 ( 0.02 * Eo ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Ez . x < 0.0 || Ez . y < 0.0 || Ez . z < 0.0 ) Ex = u_wireframe_edge_color ; else Ex = Ew ; Ey = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Ez . x < 0.0 || Ez . y < 0.0 || Ez . z < 0.0 ) Ey = 1.0 ; else Ey = 0.0 ; Ex = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Ez . x < 0.0 || Ez . y < 0.0 || Ez . z < 0.0 ) Ex = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ex = Eu ; else Ex = Ev ; Ey = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 EA = fwidth ( Es ) ; vec3 EB = smoothstep ( vec3 ( 0.0 ) , EA * Eo , Es ) ; float EC = min ( min ( EB . x , EB . y ) , EB . z ) ; EC = clamp ( EC , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ex = vec3 ( mix ( u_wireframe_edge_color , Ew , EC ) ) ; Ey = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ex = u_wireframe_edge_color ; Ey = mix ( 1.0 , 0.0 , EC ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ex = mix ( u_wireframe_edge_color , Eu , EC ) ; else Ex = mix ( u_wireframe_edge_color , Ev , EC ) ; Ey = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["bb","(","Ex",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"be ( Ex , Ey ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( Ex , Ey ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["varying","vec3","Es",";"]},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) Es = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Es = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Es = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 Eo = a_position ; vec3 Et = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"bh Eu = ut ( Eo , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"Eo = mix ( Eo , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 Ev = vec3 ( 0.0 ) ; vec3 Ew = vec3 ( 0.0 ) ; vD ( Eo , Ev , Ew , Et ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vec3","Ex","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 Ex = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"bh Eu = xp ( Eo , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ex , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 Ey = ( u_model_matrix * vec4 ( Ex , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 Ez = um ( u_camera_eye , Ey , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"mat4 Ez = ug ( u_camera_eye , Ey , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 EA = ( u_model_matrix * vec4 ( Ex , 1.0 ) ) . xyz ; Ez = Ez * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , EA ) ;".split(" ")}]}}]},{type:"textline",b:"bh Eu = ut ( Eo - Ex , Ex , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ez ) ; Eu . b = Ey ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bh Eu = ut ( Eo , Ex , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"wv ( Eu . a , Eu . b , Et ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 EB = u_view_matrix * vec4 ( Eu . a , 1.0 ) ; gl_Position = u_proj_matrix * EB ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_sampler_left , b_ ) ; vec4 Et = texture2D ( u_sampler_right , b_ ) ; gl_FragColor = vec4 ( Eo [ 0 ] , Et [ 1 ] , Et [ 2 ] , Eo [ 3 ] + Et [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",
b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 b_ ; vec4 Ev ( float Eo , float Et ) { vec2 Eu = b_ + vec2 ( Eo , Et ) * u_texel_size ; return texture2D ( u_color , Eu ) ; } float Ez ( vec4 Ew ) { vec3 Ex = vec3 ( 0.299 , 0.587 , 0.114 ) ; float Ey = dot ( Ew . rgb , Ex ) ; return Ey ; } vec4 ES ( ) { vec4 EA = Ev ( - 1.0 , - 1.0 ) ; vec4 EB = Ev ( 1.0 , - 1.0 ) ; vec4 EC = Ev ( - 1.0 , 1.0 ) ; vec4 ED = Ev ( 1.0 , 1.0 ) ; vec4 EE = Ev ( 0.0 , 0.0 ) ; float EF = Ez ( EA ) ; float EG = Ez ( EB ) ; float EH = Ez ( EC ) ; float EI = Ez ( ED ) ; float EJ = Ez ( EE ) ; float EK = min ( EJ , min ( min ( EF , EG ) , min ( EH , EI ) ) ) ; float EL = max ( EJ , max ( max ( EF , EG ) , max ( EH , EI ) ) ) ; vec2 EM ; EM . x = - ( ( EF + EG ) - ( EH + EI ) ) ; EM . y = ( ( EF + EH ) - ( EG + EI ) ) ; float EN = max ( ( EF + EG + EH + EI ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float EO = 1.0 / ( min ( abs ( EM . x ) , abs ( EM . y ) ) + EN ) ; EM = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , EM * EO ) ) * u_texel_size ; vec4 EP = 0.5 * ( texture2D ( u_color , b_ + EM * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , b_ + EM * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 EQ = EP * 0.5 + 0.25 * ( texture2D ( u_color , b_ + EM * - 0.5 ) + texture2D ( u_color , b_ + EM * 0.5 ) ) ; float ER = Ez ( EQ ) ; if ( ( ER < EK ) || ( ER > EL ) ) return EP ; else return EQ ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 GD ( ) { vec2 ET ; ET . x = b_ . x ; ET . y = b_ . y ; vec4 EU = texture2D ( u_color , ET ) ; vec4 EV = Ev ( 0.0 , 1.0 ) ; vec4 EW = Ev ( 1.0 , 0.0 ) ; vec4 EX = Ev ( 0.0 , - 1.0 ) ; vec4 EY = Ev ( - 1.0 , 0.0 ) ; float EZ = Ez ( EV ) ; float E_ = Ez ( EW ) ; float Fa = Ez ( EX ) ; float Fb = Ez ( EY ) ; float Fc = Ez ( EU ) ; float Fd = max ( EZ , Fc ) ; float Fe = min ( EZ , Fc ) ; float Ff = max ( E_ , Fd ) ; float Fg = min ( E_ , Fe ) ; float Fh = max ( Fa , Fb ) ; float Fi = min ( Fa , Fb ) ; float Fj = max ( Fh , Ff ) ; float Fk = min ( Fi , Fg ) ; float Fl = Fj * FXAA_QUALITY_EDGE_THRESHOLD ; float Fm = Fj - Fk ; float Fn = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , Fl ) ; bool Fo = Fm < Fn ; if ( Fo ) return EU ; vec4 Fp = Ev ( - 1.0 , - 1.0 ) ; vec4 Fq = Ev ( 1.0 , 1.0 ) ; vec4 Fr = Ev ( 1.0 , - 1.0 ) ; vec4 Fs = Ev ( - 1.0 , 1.0 ) ; float Ft = Ez ( Fp ) ; float Fu = Ez ( Fq ) ; float Fv = Ez ( Fr ) ; float Fw = Ez ( Fs ) ; float Fx = Fa + EZ ; float Fy = Fb + E_ ; float Fz = 1.0 / Fm ; float FA = Fx + Fy ; float FB = ( - 2.0 * Fc ) + Fx ; float FC = ( - 2.0 * Fc ) + Fy ; float FD = Fv + Fu ; float FE = Ft + Fv ; float FF = ( - 2.0 * E_ ) + FD ; float FG = ( - 2.0 * Fa ) + FE ; float FH = Ft + Fw ; float FI = Fw + Fu ; float FJ = ( abs ( FB ) * 2.0 ) + abs ( FF ) ; float FK = ( abs ( FC ) * 2.0 ) + abs ( FG ) ; float FL = ( - 2.0 * Fb ) + FH ; float FM = ( - 2.0 * EZ ) + FI ; float FN = abs ( FL ) + FJ ; float FO = abs ( FM ) + FK ; float FP = FH + FD ; float FQ = u_texel_size . x ; bool FR = FN >= FO ; float FS = FA * 2.0 + FP ; if ( ! FR ) Fa = Fb ; if ( ! FR ) EZ = E_ ; if ( FR ) FQ = u_texel_size . y ; float FT = ( FS * ( 1.0 / 12.0 ) ) - Fc ; float FU = Fa - Fc ; float FV = EZ - Fc ; float FW = Fa + Fc ; float FX = EZ + Fc ; bool FY = abs ( FU ) >= abs ( FV ) ; float FZ = max ( abs ( FU ) , abs ( FV ) ) ; if ( FY ) FQ = - FQ ; float F_ = clamp ( abs ( FT ) * Fz , 0.0 , 1.0 ) ; vec2 Ga ; Ga . x = ET . x ; Ga . y = ET . y ; vec2 Gb ; Gb . x = ( ! FR ) ? 0.0 : u_texel_size . x ; Gb . y = ( FR ) ? 0.0 : u_texel_size . y ; if ( ! FR ) Ga . x += FQ * 0.5 ; if ( FR ) Ga . y += FQ * 0.5 ; vec2 Gc ; Gc . x = Ga . x - Gb . x ; Gc . y = Ga . y - Gb . y ; vec2 Gd ; Gd . x = Ga . x + Gb . x ; Gd . y = Ga . y + Gb . y ; float Ge = ( ( - 2.0 ) * F_ ) + 3.0 ; float Gf = Ez ( texture2D ( u_color , Gc ) ) ; float Gg = F_ * F_ ; float Gh = Ez ( texture2D ( u_color , Gd ) ) ; if ( ! FY ) FW = FX ; float Gi = FZ * 1.0 / 4.0 ; float Gj = Fc - FW * 0.5 ; float Gk = Ge * Gg ; bool Gl = Gj < 0.0 ; Gf -= FW * 0.5 ; Gh -= FW * 0.5 ; bool Gm = abs ( Gf ) >= Gi ; bool Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 1.5 ; if ( ! Gm ) Gc . y -= Gb . y * 1.5 ; bool Go = ( ! Gm ) || ( ! Gn ) ; if ( ! Gn ) Gd . x += Gb . x * 1.5 ; if ( ! Gn ) Gd . y += Gb . y * 1.5 ; if ( Go ) { if ( ! Gm ) Gf = Ez ( texture2D ( u_color , Gc . xy ) ) ; if ( ! Gn ) Gh = Ez ( texture2D ( u_color , Gd . xy ) ) ; if ( ! Gm ) Gf = Gf - FW * 0.5 ; if ( ! Gn ) Gh = Gh - FW * 0.5 ; Gm = abs ( Gf ) >= Gi ; Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 2.0 ; if ( ! Gm ) Gc . y -= Gb . y * 2.0 ; Go = ( ! Gm ) || ( ! Gn ) ; if ( ! Gn ) Gd . x += Gb . x * 2.0 ; if ( ! Gn ) Gd . y += Gb . y * 2.0 ; if ( Go ) { if ( ! Gm ) Gf = Ez ( texture2D ( u_color , Gc . xy ) ) ; if ( ! Gn ) Gh = Ez ( texture2D ( u_color , Gd . xy ) ) ; if ( ! Gm ) Gf = Gf - FW * 0.5 ; if ( ! Gn ) Gh = Gh - FW * 0.5 ; Gm = abs ( Gf ) >= Gi ; Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 2.0 ; if ( ! Gm ) Gc . y -= Gb . y * 2.0 ; Go = ( ! Gm ) || ( ! Gn ) ; if ( ! Gn ) Gd . x += Gb . x * 2.0 ; if ( ! Gn ) Gd . y += Gb . y * 2.0 ; if ( Go ) { if ( ! Gm ) Gf = Ez ( texture2D ( u_color , Gc . xy ) ) ; if ( ! Gn ) Gh = Ez ( texture2D ( u_color , Gd . xy ) ) ; if ( ! Gm ) Gf = Gf - FW * 0.5 ; if ( ! Gn ) Gh = Gh - FW * 0.5 ; Gm = abs ( Gf ) >= Gi ; Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 4.0 ; if ( ! Gm ) Gc . y -= Gb . y * 4.0 ; Go = ( ! Gm ) || ( ! Gn ) ; if ( ! Gn ) Gd . x += Gb . x * 4.0 ; if ( ! Gn ) Gd . y += Gb . y * 4.0 ; if ( Go ) { if ( ! Gm ) Gf = Ez ( texture2D ( u_color , Gc . xy ) ) ; if ( ! Gn ) Gh = Ez ( texture2D ( u_color , Gd . xy ) ) ; if ( ! Gm ) Gf = Gf - FW * 0.5 ; if ( ! Gn ) Gh = Gh - FW * 0.5 ; Gm = abs ( Gf ) >= Gi ; Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 2.0 ; if ( ! Gm ) Gc . y -= Gb . y * 2.0 ; if ( ! Gn ) Gd . x += Gb . x * 2.0 ; if ( ! Gn ) Gd . y += Gb . y * 2.0 ; } } } } float Gp = ET . x - Gc . x ; float Gq = Gd . x - ET . x ; if ( ! FR ) Gp = ET . y - Gc . y ; if ( ! FR ) Gq = Gd . y - ET . y ; bool Gr = ( Gf < 0.0 ) != Gl ; float Gs = ( Gq + Gp ) ; bool Gt = ( Gh < 0.0 ) != Gl ; float Gu = 1.0 / Gs ; bool Gv = Gp < Gq ; float Gw = min ( Gp , Gq ) ; bool Gx = Gv ? Gr : Gt ; float Gy = Gk * Gk ; float Gz = ( Gw * ( - Gu ) ) + 0.5 ; float GA = Gy * FXAA_QUALITY_SUBPIX ; float GB = Gx ? Gz : 0.0 ; float GC = max ( GB , GA ) ; if ( ! FR ) ET . x += GC * FQ ; if ( FR ) ET . y += GC * FQ ; return texture2D ( u_color , ET ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_PASS",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , b_ ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"gl_FragColor = ES ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = GD ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , b_ ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 b_ ; void main ( ) { vec2 Eo = vec2 ( 0.0 , 0.0 ) ; vec2 Et = u_texel_size ; vec4 Eu = texture2D ( u_color , b_ ) ; gl_FragColor = Eu * 0.0875447373698 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0858112354248 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0808139781061 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0731235112908 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0635705267419 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0530985673112 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0426125984122 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0328565115809 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * Eu , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_main , b_ ) ; vec4 Et = texture2D ( u_bloom , b_ ) ; vec4 Eu = Eo ; Eu += Et ; gl_FragColor = vec4 ( Eu . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_color , b_ ) ; vec3 Et = Eo . rgb ; if ( u_brightness < 0.0 ) Et = Et * ( 1.0 + u_brightness ) ; else Et = Et + ( ( 1.0 - Et ) * u_brightness ) ; Et = ( Et - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Et *= u_exposure ; vec3 Eu = vec3 ( 0.299 , 0.587 , 0.114 ) ; float Ev = dot ( Et , Eu ) ; Et = mix ( vec3 ( Ev ) , Et , u_saturation ) ; gl_FragColor = vec4 ( Et , Eo . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 b_ ; void main ( ) { gl_FragColor = h ( clamp ( EA ( u_depth , b_ , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]=
{type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_sharp , b_ ) ; if ( u_dof_dist > 0.0 ) { float EB = EA ( u_depth , b_ , u_camera_range ) ; EB *= u_view_max_depth ; float EC ; if ( EB < u_dof_dist ) EC = ( u_dof_dist - EB ) / u_dof_front ; else EC = ( EB - u_dof_dist ) / u_dof_rear ; EC = clamp ( EC , 0.0 , 1.0 ) ; vec4 ED = texture2D ( u_blurred , b_ ) ; gl_FragColor = mix ( Eo , ED , EC ) ; } else gl_FragColor = Eo ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_src_color , b_ ) ; vec4 EB = texture2D ( u_glow_mask_small , b_ ) ; vec4 EC = texture2D ( u_glow_mask_large , b_ ) ; gl_FragColor = Eo ; if ( EC . a != 0.0 ) { float ED = u_glow_mask_large_coeff * EC . a ; ED = clamp ( ED , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , EC . rgb / EC . a , ED ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , ED ) ; } if ( EB . a != 0.0 ) { float EE = u_glow_mask_small_coeff * EB . a ; EE = clamp ( EE , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , EB . rgb / EB . a , EE ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , EE ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float EB ; varying vec2 EC ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 b_ ; varying vec4 ED ; void main ( ) { vec2 EE = ( ED . xy - b_ ) ; float EF = length ( EE ) ; vec2 EG = u_radial_blur_step * EE / EF ; float EH = EF / u_radial_blur_step ; EG *= min ( EH , STEPS_PER_PASS ) / STEPS_PER_PASS ; EH = max ( EH , STEPS_PER_PASS ) ; vec2 EI = b_ ; float EJ = 0.0 ; for ( float EK = 0.0 ; EK < STEPS_PER_PASS ; EK += 1.0 ) { if ( EK <= EH ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float EL = EA ( u_input , EI , u_camera_range ) ; EJ += max ( ( 1.0 - pow ( EF , 0.3 ) ) * step ( 0.9 , EL ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 EM = texture2D ( u_input , EI ) ; EJ += l ( EM ) ;".split(" ")}]}}]},{type:"textline",b:"} EI += EG ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"vec2 EN = b_ + EC ; float EO = Q ( vec2 ( 2.5 * ( EN . x ) , 2.5 * ( EN . y ) + 1.0 * u_time ) ) . x + 0.75 * Q ( vec2 ( 5.0 * ( EN . x ) - 0.66 * u_time , 5.0 * ( EN . y ) + 0.66 * u_time ) ) . x + 0.5 * au ( vec2 ( 7.5 * ( EN . x ) + 0.33 * u_time , 7.5 * ( EN . y ) - 0.33 * u_time ) ) ; EO *= clamp ( 1.2 - sqrt ( 0.2 * EF ) , 0.0 , 1.0 ) * EB ; EJ = max ( EO , EJ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = h ( EJ / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float EB ; varying vec2 EC ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"varying vec2 b_ ; varying vec4 ED ; void main ( ) { b_ = a_bb_vertex + 0.5 ; vec3 Eo = normalize ( u_sun_direction ) ; ED = u_proj_matrix * u_view_matrix * vec4 ( Eo , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { EB = 1.0 ; vec3 EE = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 EF = bn ( u_camera_quat , EE ) ; EF = normalize ( EF ) ; float EG = dot ( EF , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float EH = atan ( EF . x , EF . z ) ; EC = vec2 ( - EH , acos ( EG ) ) ; } else { EB = 0.0 ; }".split(" ")}]}}]},
{type:"textline",b:"ED . xy = 0.5 * ( ED . xy / ED . w + 1.0 ) ; ED += 99999.0 * step ( ED . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_main , b_ ) ; vec3 EE = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; a_ ( Eo . rgb ) ; float EF = l ( texture2D ( u_god_rays , b_ ) ) ; vec3 EG = Eo . rgb + u_god_rays_intensity * vec3 ( EF ) * EE ; bb ( EG ) ; gl_FragColor . rgb = EG ; gl_FragColor . a = Eo . a ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_input , b_ ) ; float EE = dot ( Eo . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( EE ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float Eo ; float EE = 0.0 ; for ( float EF = 0.025 ; EF < 1.0 ; EF += 0.05 ) for ( float EG = 0.025 ; EG < 1.0 ; EG += 0.05 ) { Eo = max ( texture2D ( u_input , vec2 ( EF , EG ) ) . r , 0.01 ) ; EE += log ( Eo ) ; } float EH = exp ( EE / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( EH ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 b_ ; varying float EE ; void main ( ) { float EF = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float EG = texture2D ( u_luminance , b_ ) . r ; vec4 EH = texture2D ( u_main , b_ ) ; float EI = EG / EF ; float EJ = u_bloom_edge_lum ; gl_FragColor = EH * max ( EI - EJ , 0.0 ) * EE ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 b_ ; varying float EE ; const vec3 Eo = vec3 ( 0.0 , 1.0 , 0.0 ) ; void EM ( in vec4 EF , in vec3 EG , out vec3 EH ) { float EI = EF . w * EG . x + EF . y * EG . z - EF . z * EG . y ; float EJ = EF . w * EG . y + EF . z * EG . x - EF . x * EG . z ; float EK = EF . w * EG . z + EF . x * EG . y - EF . y * EG . x ; float EL = - EF . x * EG . x - EF . y * EG . y - EF . z * EG . z ; EH . x = EI * EF . w - EL * EF . x - EJ * EF . z + EK * EF . y ; EH . y = EJ * EF . w - EL * EF . y - EK * EF . x + EI * EF . z ; EH . z = EK * EF . w - EL * EF . z - EI * EF . y + EJ * EF . x ; } void main ( ) { b_ = 2.0 * a_position ; vec3 EN ; EM ( u_camera_quat , Eo , EN ) ; EE = dot ( - EN , u_sun_direction ) * u_bloom_key ; EE *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 b_ ; float Eo = 0.0042 ; void main ( ) { vec4 EF = texture2D ( u_mb_tex_curr , b_ ) ; vec4 EG = texture2D ( u_mb_tex_accum , b_ ) ; if ( length ( EF - EG ) > u_motion_blur_decay_threshold ) { vec4 EH = ( 1.0 - u_motion_blur_exp ) * EF + u_motion_blur_exp * EG ; vec4 EI = EH - EG ; vec4 EJ = EF - EG ; vec4 EK = min ( max ( abs ( EI ) , vec4 ( Eo ) ) , abs ( EJ ) ) * sign ( EI ) ; gl_FragColor = EG + EK ; } else { gl_FragColor = EF ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_outline_src , b_ ) ; gl_FragColor = Eo ; if ( u_draw_outline != 0.0 ) { vec4 EF = texture2D ( u_outline_mask , b_ ) ; vec4 EG = texture2D ( u_outline_mask_blurred , b_ ) ; float EH = EG . a - EF . a ; if ( EH != 0.0 ) { float EI = smoothstep ( 0.0 , 1.0 , EG . a ) ; if ( EF . a == 0.0 ) { vec3 EJ = u_outline_color ; bb ( EJ ) ; vec4 EK = vec4 ( clamp ( EJ , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Eo , EK , EI ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 b_ ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , b_ ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Eo = texture2D ( u_color , b_ ) ; gl_FragColor . rgb = vec3 ( ( Eo . r + Eo . g + Eo . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_BLUR",
{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 EF = vec2 ( 0.0 , 0.0 ) ; vec2 EG = u_texel_size ; vec4 EH ; EH = texture2D ( u_color , b_ ) ; gl_FragColor = EH * 0.2270270270 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * 0.1945945946 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * 0.1945945946 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * 0.1216216216 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * 0.1216216216 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * 0.0540540541 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * 0.0540540541 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * 0.0162162162 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 EF = vec2 ( 0.0 , 0.0 ) ; vec2 EG = u_texel_size ; vec4 EH ; EH = texture2D ( u_color , b_ ) ; gl_FragColor = EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.152507 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.141763 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.141763 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.113861 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.113861 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.079019 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.079019 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.047383 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.047383 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.024549 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.024549 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.01099 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.01099 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.00425 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.00425 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.00142 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 EG = u_texel_size ; vec4 EH = texture2D ( u_color , b_ ) ; gl_FragColor = EH ; if ( EH . a == 0.0 ) { EH = texture2D ( u_color , b_ + EG ) ; if ( EH . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , EH . a ) ; else { EH = texture2D ( u_color , b_ - EG ) ; if ( EH . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , EH . a ) ; } }".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 b_ ; void main ( ) { b_ = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",
name:"SMAA_EDGE_DETECTION",b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2},"SMAA_PREDICATION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 b_ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","EF",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 EG ; varying vec4 EH ; varying vec4 EI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","EJ",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",
b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",
name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},
{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},
{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 EP ( vec2 EK , sampler2D EL ) { float EM = texture2D ( EL , EK ) . r ; float EN = texture2D ( EL , EG . xy ) . r ; float EO = texture2D ( EL , EG . zw ) . r ; return vec3 ( EM , EN , EO ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 EV ( vec2 EQ , sampler2D ER ) { vec3 ES = EP ( EQ , ER ) ; vec2 ET = abs ( ES . xx - ES . yz ) ; vec2 EU = step ( SMAA_PREDICATION_THRESHOLD , ET ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * EU ) ; }".split(" ")}]}}]},
{type:"textline",b:"void EZ ( bvec2 EW , inout vec2 EX , vec2 EY ) { if ( EW . x ) EX . x = EY . x ; if ( EW . y ) EX . y = EY . y ; } void EZ ( bvec4 E_ , inout vec4 Fa , vec4 Fb ) { EZ ( E_ . xy , Fa . xy , Fb . xy ) ; EZ ( E_ . zw , Fa . zw , Fb . zw ) ; } vec2 Fd ( vec2 Fc ) { return sign ( Fc ) * floor ( abs ( Fc ) + .5 ) ; } vec4 Fd ( vec4 Fe ) { return sign ( Fe ) * floor ( abs ( Fe ) + .5 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Fv ( vec2 Ff , sampler2D Fg".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Fh"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 Fi = EV ( Ff , Fh ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 Fi = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 Fj = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float Fk = dot ( texture2D ( Fg , Ff ) . rgb , Fj ) ; float Fl = dot ( texture2D ( Fg , EG . xy ) . rgb , Fj ) ; float Fm = dot ( texture2D ( Fg , EG . zw ) . rgb , Fj ) ; vec4 Fn ; Fn . xy = abs ( Fk - vec2 ( Fl , Fm ) ) ; vec2 Fo = step ( Fi , Fn . xy ) ; if ( dot ( Fo , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float Fp = dot ( texture2D ( Fg , EH . xy ) . rgb , Fj ) ; float Fq = dot ( texture2D ( Fg , EH . zw ) . rgb , Fj ) ; Fn . zw = abs ( Fk - vec2 ( Fp , Fq ) ) ; vec2 Fr = max ( Fn . xy , Fn . zw ) ; float Fs = dot ( texture2D ( Fg , EI . xy ) . rgb , Fj ) ; float Ft = dot ( texture2D ( Fg , EI . zw ) . rgb , Fj ) ; Fn . zw = abs ( vec2 ( Fl , Fm ) - vec2 ( Fs , Ft ) ) ; Fr = max ( Fr . xy , Fn . zw ) ; float Fu = max ( Fr . x , Fr . y ) ; Fo . xy *= step ( Fu , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * Fn . xy ) ; return Fo ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 Fx ( vec2 Fw ) { Fw . r = Fw . r * abs ( 5.0 * Fw . r - 5.0 * 0.75 ) ; return Fd ( Fw ) ; } vec4 Fx ( vec4 Fy ) { Fy . rb = Fy . rb * abs ( 5.0 * Fy . rb - 5.0 * 0.75 ) ; return Fd ( Fy ) ; } vec2 FG ( sampler2D Fz , vec2 FA , vec2 FB , out vec2 FC ) { vec4 FD = vec4 ( FA , - 1.0 , 1.0 ) ; vec3 FE = vec3 ( u_texel_size , 1.0 ) ; for ( int FF = 0 ; FF < SMAA_MAX_SEARCH_STEPS_DIAG ; FF ++ ) { if ( FD . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && FD . w > 0.9 ) { FD . xyz += FE * vec3 ( FB , 1.0 ) ; FC = texture2D ( Fz , FD . xy , 0.0 ) . rg ; FD . w = dot ( FC , vec2 ( 0.5 , 0.5 ) ) ; } } return FD . zw ; } vec2 FO ( sampler2D FH , vec2 FI , vec2 FJ , out vec2 FK ) { vec4 FL = vec4 ( FI , - 1.0 , 1.0 ) ; FL . x += 0.25 * u_texel_size . x ; vec3 FM = vec3 ( u_texel_size , 1.0 ) ; for ( int FN = 0 ; FN < SMAA_MAX_SEARCH_STEPS_DIAG ; FN ++ ) { if ( FL . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && FL . w > 0.9 ) { FL . xyz = FM * vec3 ( FJ , 1.0 ) + FL . xyz ; FK = texture2D ( FH , FL . xy , 0.0 ) . rg ; FK = Fx ( FK ) ; FL . w = dot ( FK , vec2 ( 0.5 , 0.5 ) ) ; } } return FL . zw ; } vec2 FU ( sampler2D FP , vec2 FQ , vec2 FR , float FS ) { vec2 FT = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * FR + FQ ; FT = SMAA_AREATEX_PIXEL_SIZE * FT + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; FT . x += 0.5 ; FT . y += SMAA_AREATEX_SUBTEX_SIZE * FS ; return texture2D ( FP , FT , 0.0 ) . rg ; } vec2 Gi ( sampler2D FV , sampler2D FW , vec2 FX , vec2 FY , vec4 FZ ) { vec2 F_ = vec2 ( 0.0 , 0.0 ) ; vec4 Ga ; vec2 Gb ; if ( FY . r > 0.0 ) { Ga . xz = FG ( FV , FX , vec2 ( - 1.0 , 1.0 ) , Gb ) ; Ga . x += float ( Gb . y > 0.9 ) ; } else Ga . xz = vec2 ( 0.0 , 0.0 ) ; Ga . yw = FG ( FV , FX , vec2 ( 1.0 , - 1.0 ) , Gb ) ; if ( Ga . x + Ga . y > 2.0 ) { vec4 Gc = vec4 ( - Ga . x + 0.25 , Ga . x , Ga . y , - Ga . y - 0.25 ) * u_texel_size . xyxy + FX . xyxy ; vec4 Gd ; Gd . xy = texture2D ( FV , Gc . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; Gd . zw = texture2D ( FV , Gc . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; Gd . yxwz = Fx ( Gd . xyzw ) ; vec2 Ge = vec2 ( 2.0 , 2.0 ) * Gd . xz + Gd . yw ; EZ ( bvec2 ( step ( 0.9 , Ga . zw ) ) , Ge , vec2 ( 0.0 , 0.0 ) ) ; F_ += FU ( FW , Ga . xy , Ge , FZ . z ) ; } Ga . xz = FO ( FV , FX , vec2 ( - 1 , - 1 ) , Gb ) ; if ( texture2D ( FV , FX + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { Ga . yw = FO ( FV , FX , vec2 ( 1 , 1 ) , Gb ) ; Ga . y += float ( Gb . y > 0.9 ) ; } else Ga . yw = vec2 ( 0.0 , 0.0 ) ; if ( Ga . x + Ga . y > 2.0 ) { vec4 Gf = vec4 ( - Ga . x , - Ga . x , Ga . y , Ga . y ) * u_texel_size . xyxy + FX . xyxy ; vec4 Gg ; Gg . x = texture2D ( FV , Gf . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; Gg . y = texture2D ( FV , Gf . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; Gg . zw = texture2D ( FV , Gf . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 Gh = vec2 ( 2.0 , 2.0 ) * Gg . xz + Gg . yw ; EZ ( bvec2 ( step ( 0.9 , Ga . zw ) ) , Gh , vec2 ( 0 , 0 ) ) ; F_ += FU ( FW , Ga . xy , Gh , FZ . w ) . gr ; } return F_ ; }".split(" ")}]}}]},
{type:"textline",b:"float Go ( sampler2D Gj , vec2 Gk , float Gl ) { vec2 Gm = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 Gn = SMAA_SEARCHTEX_SIZE * vec2 ( Gl , 1.0 ) ; Gm += vec2 ( - 1.0 , 1.0 ) ; Gn += vec2 ( 0.5 , - 0.5 ) ; Gm *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; Gn *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( Gj , Gm * Gk + Gn , 0.0 ) . r ; } float Gw ( sampler2D Gp , sampler2D Gq , vec2 Gr , float Gs ) { vec2 Gt = vec2 ( 0.0 , 1.0 ) ; for ( int Gu = 0 ; Gu < SMAA_MAX_SEARCH_STEPS ; Gu ++ ) { if ( Gr . x > Gs && Gt . g > 0.8281 && Gt . r == 0.0 ) { Gt = texture2D ( Gp , Gr , 0.0 ) . rg ; Gr = - vec2 ( 2.0 , 0.0 ) * u_texel_size + Gr ; } } float Gv = - ( 255.0 / 127.0 ) * Go ( Gq , Gt , 0.0 ) + 3.25 ; return u_texel_size . x * Gv + Gr . x ; } float GE ( sampler2D Gx , sampler2D Gy , vec2 Gz , float GA ) { vec2 GB = vec2 ( 0.0 , 1.0 ) ; for ( int GC = 0 ; GC < SMAA_MAX_SEARCH_STEPS ; GC ++ ) { if ( Gz . x < GA && GB . g > 0.8281 && GB . r == 0.0 ) { GB = texture2D ( Gx , Gz , 0.0 ) . rg ; Gz = vec2 ( 2.0 , 0.0 ) * u_texel_size + Gz ; } } float GD = - ( 255.0 / 127.0 ) * Go ( Gy , GB , 0.5 ) + 3.25 ; return - u_texel_size . x * GD + Gz . x ; } float GM ( sampler2D GF , sampler2D GG , vec2 GH , float GI ) { vec2 GJ = vec2 ( 1.0 , 0.0 ) ; for ( int GK = 0 ; GK < SMAA_MAX_SEARCH_STEPS ; GK ++ ) { if ( GH . y > GI && GJ . r > 0.8281 && GJ . g == 0.0 ) { GJ = texture2D ( GF , GH , 0.0 ) . rg ; GH = - vec2 ( 0.0 , 2.0 ) * u_texel_size + GH ; } } float GL = - ( 255.0 / 127.0 ) * Go ( GG , GJ . gr , 0.0 ) + 3.25 ; return u_texel_size . y * GL + GH . y ; } float GU ( sampler2D GN , sampler2D GO , vec2 GP , float GQ ) { vec2 GR = vec2 ( 1.0 , 0.0 ) ; for ( int GS = 0 ; GS < SMAA_MAX_SEARCH_STEPS ; GS ++ ) { if ( GP . y < GQ && GR . r > 0.8281 && GR . g == 0.0 ) { GR = texture2D ( GN , GP , 0.0 ) . rg ; GP = vec2 ( 0.0 , 2.0 ) * u_texel_size + GP ; } } float GT = - ( 255.0 / 127.0 ) * Go ( GO , GR . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * GT + GP . y ; } vec2 Ha ( sampler2D GV , vec2 GW , float GX , float GY , float GZ ) { vec2 G_ = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * Fd ( 4.0 * vec2 ( GX , GY ) ) + GW ; G_ = SMAA_AREATEX_PIXEL_SIZE * G_ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; G_ . y = SMAA_AREATEX_SUBTEX_SIZE * GZ + G_ . y ; return texture2D ( GV , G_ , 0.0 ) . rg ; } void Hi ( sampler2D Hb , inout vec2 Hc , vec4 Hd , vec2 He ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 Hf = step ( He . xy , He . yx ) ; vec2 Hg = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * Hf ; Hg /= Hf . x + Hf . y ; vec2 Hh = vec2 ( 1.0 , 1.0 ) ; Hh . x -= Hg . x * texture2D ( Hb , Hd . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; Hh . x -= Hg . y * texture2D ( Hb , Hd . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; Hh . y -= Hg . x * texture2D ( Hb , Hd . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; Hh . y -= Hg . y * texture2D ( Hb , Hd . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; Hc *= clamp ( Hh , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void Hq ( sampler2D Hj , inout vec2 Hk , vec4 Hl , vec2 Hm ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 Hn = step ( Hm . xy , Hm . yx ) ; vec2 Ho = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * Hn ; Ho /= Hn . x + Hn . y ; vec2 Hp = vec2 ( 1.0 , 1.0 ) ; Hp . x -= Ho . x * texture2D ( Hj , Hl . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; Hp . x -= Ho . y * texture2D ( Hj , Hl . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; Hp . y -= Ho . x * texture2D ( Hj , Hl . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; Hp . y -= Ho . y * texture2D ( Hj , Hl . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; Hk *= clamp ( Hp , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 HJ ( vec2 Hr , vec2 Hs , sampler2D Ht , sampler2D Hu , sampler2D Hv , vec4 Hw ) { vec4 Hx = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 Hy = texture2D ( Ht , Hr ) . rg ; if ( Hy . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",
b:"Hx . rg = Gi ( Ht , Hu , Hr , Hy , Hw ) ; if ( Hx . r == - Hx . g ) {".split(" ")}]}}]},{type:"textline",b:"vec2 Hz ; vec3 HA ; HA . x = Gw ( Ht , Hv , EG . xy , EI . x ) ; HA . y = EH . y ; Hz . x = HA . x ; float HB = texture2D ( Ht , HA . xy , 0.0 ) . r ; HA . z = GE ( Ht , Hv , EG . zw , EI . y ) ; Hz . y = HA . z ; Hz = abs ( Fd ( Hz / u_texel_size . xx - Hs . xx ) ) ; vec2 HC = sqrt ( Hz ) ; float HD = texture2D ( Ht , HA . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Hx . rg = Ha ( Hu , HC , HB , HD , Hw . y ) ; HA . y = Hr . y ; Hi ( Ht , Hx . rg , HA . xyzy , Hz ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"} else Hy . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( Hy . r > 0.0 ) { vec2 HE ; vec3 HF ; HF . y = GM ( Ht , Hv , EH . xy , EI . z ) ; HF . x = EG . x ; HE . x = HF . y ; float HG = texture2D ( Ht , HF . xy , 0.0 ) . g ; HF . z = GU ( Ht , Hv , EH . zw , EI . w ) ; HE . y = HF . z ; HE = abs ( Fd ( HE / u_texel_size . yy - Hs . yy ) ) ; vec2 HH = sqrt ( HE ) ; float HI = texture2D ( Ht , HF . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Hx . ba = Ha ( Hu , HH , HG , HI , Hw . x ) ; HF . x = Hr . x ; Hq ( Ht , Hx . ba , HF . xyxz , HE ) ; } return Hx ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 H_ ( vec2 HK , sampler2D HL , sampler2D HM".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","HN"]}]}}]},{type:"textline",b:") { vec4 HO ; HO . x = texture2D ( HM , EF . xy ) . a ; HO . y = texture2D ( HM , EF . zw ) . g ; HO . wz = texture2D ( HM , HK ) . xz ; if ( dot ( HO , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 HP = texture2D ( HL , HK , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 HQ = texture2D ( HN , b_ ) ; vec2 HR = 2.0 * t ( HQ ) - 1.0 ; HP . a = sqrt ( 2.0 * length ( HR ) ) ;".split(" ")}]}}]},{type:"textline",b:"return HP ; } else { bool HS = max ( HO . x , HO . z ) > max ( HO . y , HO . w ) ; vec4 HT = vec4 ( 0.0 , HO . y , 0.0 , HO . w ) ; vec2 HU = HO . yw ; EZ ( bvec4 ( HS , HS , HS , HS ) , HT , vec4 ( HO . x , 0.0 , HO . z , 0.0 ) ) ; EZ ( bvec2 ( HS , HS ) , HU , HO . xz ) ; HU /= dot ( HU , vec2 ( 1.0 , 1.0 ) ) ; vec4 HV = HT * vec4 ( u_texel_size , - u_texel_size ) + HK . xyxy ; vec4 HW = HU . x * texture2D ( HL , HV . xy , 0.0 ) ; HW += HU . y * texture2D ( HL , HV . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 HX = texture2D ( HN , HV . xy ) ; vec2 HY = 2.0 * t ( HX ) - 1.0 ; vec2 HZ = HU . x * HY ; HX = texture2D ( HN , HV . zw ) ; HY = 2.0 * t ( HX ) - 1.0 ; HZ += HU . y * HY ; HW . a = sqrt ( 2.0 * length ( HZ ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","HW",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"vec4 Il ( vec2 Ia , sampler2D Ib , sampler2D Ic".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Id"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 Ie = texture2D ( Id , b_ ) ; vec2 If ; If = 2.0 * t ( Ie ) - 1.0 ; vec4 Ig = texture2D ( Ib , Ia ) ; vec4 Ih = texture2D ( Ic , Ia - If ) ; float Ii = abs ( Ig . a * Ig . a - Ih . a * Ih . a ) / 2.0 ; float Ij = 0.5 * clamp ( 1.0 - sqrt ( Ii ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 Ik = mix ( Ig , Ih , Ij ) ; Ik . a = 1.0 ; return Ik ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 Ig = texture2D ( Ib , Ia ) ; vec4 Ih = texture2D ( Ic , Ia ) ; return mix ( Ig , Ih , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Im = vec4 ( Fv ( b_ , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",
a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Im = HJ ( b_ , EJ , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Im = H_ ( b_ , u_color , u_blend".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Im = vec4 ( Il ( b_ , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"vec4 Im = texture2D ( u_color , b_ ) ;".split(" ")}]}}]},{type:"textline",b:["gl_FragColor","=","Im",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",
b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 b_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","EF",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 EG ; varying vec4 EH ; varying vec4 EI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","EJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void EK ( vec2 Eo ) { EG = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + Eo . xyxy ; EH = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Eo . xyxy ; EI = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + Eo . xyxy ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void EN ( vec2 EL , out vec2 EM ) { EM = EL / u_texel_size ; EG = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + EL . xyxy ; EH = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + EL . xyxy ; EI = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( EG . xz , EH . yw ) ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void EP ( vec2 EO ) { EF = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + EO . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { b_ = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["EK","(","b_",")",";"]}]}},{type:"elif",c:["SMAA_PASS",
"SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EN ( b_ , EJ ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["EP","(","b_",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",
b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 b_ ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float EK ( in vec2 Eo ) { return EA ( u_depth , Eo , u_camera_range ) ; } void main ( ) { float EL = texture2D ( u_color , b_ ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( EL , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 EM = normalize ( 2.0 * texture2D ( u_ssao_special_tex , b_ * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float EN = EK ( b_ ) ; float EO = EN * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"const float EP = 8.0 ; const int EQ = 1 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float EP = 16.0 ; const int EQ = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float EP = 24.0 ; const int EQ = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"const float EP = 32.0 ; const int EQ = 4 ;".split(" ")}]}}]},{type:"textline",b:"float ER = u_ssao_radius_increase * 0.001 ; const float ES = 1.0 + 2.4 / EP ; float ET = 0.0 ; for ( int EU = 0 ; EU < EQ ; EU ++ ) for ( int EV = - 1 ; EV <= 1 ; EV += 2 ) for ( int EW = - 1 ; EW <= 1 ; EW += 2 ) for ( int EX = - 1 ; EX <= 1 ; EX += 2 ) { vec3 EY = reflect ( normalize ( vec3 ( EV , EW , EX ) ) , EM ) * ( ER *= ES ) ; vec3 EZ = vec3 ( b_ , EO ) ; EZ += vec3 ( EY . xy , EY . z * EO * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"EZ . z -= 1.4 * ( EZ . z - EO ) * step ( EO , EZ . z ) ;".split(" ")}]}}]},{type:"textline",b:"float E_ = EK ( EZ . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float Fa = clamp ( ( EO - E_ ) / E_ , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ET += mix ( 1.0 , Fa , step ( E_ , EZ . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"ET += mix ( step ( EZ . z , E_ ) , 0.5 , Fa ) ;".split(" ")}]}}]},{type:"textline",b:"} ET = ET / EP ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ET = clamp ( ET * ET + 0.6 * ET , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ET = clamp ( ET * ET + ET , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float Fb = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * EN ) ; ET = mix ( 1.0 , ET , Fb ) ; gl_FragColor = vec4 ( EL , ET , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 b_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float EK ( in vec2 Eo ) { return EA ( u_depth , Eo , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { float EL = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float EM = EK ( b_ ) ; float EN = 0.0 ; float EO = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 EP = vec2 ( - 2.0 ) ; for ( int EQ = 0 ; EQ < 4 ; ++ EQ ) { for ( int ER = 0 ; ER < 4 ; ++ ER ) { vec2 ES = ( EP + vec2 ( float ( EQ ) , float ( ER ) ) ) * u_texel_size ; float ET = texture2D ( u_ssao_mask , b_ + ES ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float EU = EK ( b_ + ES ) ; float EV = 1.0 - clamp ( abs ( EU - EM ) * EO , 0.0 , 1.0 ) ; EL += ET * EV ; EN += EV ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["EL","+=","ET",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , b_ ) . r , EL / EN , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , b_ ) . r , EL / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 b_ ; void main ( ) { float Eo = texture2D ( u_depth , b_ ) . x ; vec4 EK = vec4 ( b_ * 2.0 - 1.0 , 2.0 * Eo - 1.0 , 1.0 ) ; vec4 EL = u_view_proj_inverse * EK ; vec4 EM = EL / EL . w ; vec4 EN = u_view_proj_prev * EM ; EN /= EN . w ; vec2 EO = ( EK . xy - EN . xy ) / 4.0 + 0.5 ; EO = clamp ( EO , 0.0 , 1.0 ) ; gl_FragColor = h ( EO ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",
b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"NO_SHADOWS",b:["1"]},{type:"define",name:"SHADOW_CASTING",b:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",b:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",b:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",
name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"SPECULAR_BLINN",b:["4"]},{type:"define",name:"SPECULAR_TOON",b:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",b:["4"]},{type:"define",name:"DIFFUSE_TOON",b:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",
b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MIX",b:["0"]},{type:"define",name:"ADD",b:["1"]},{type:"define",name:"SUBTRACT",b:["2"]},{type:"define",name:"MULTIPLY",b:["3"]},{type:"define",name:"SCREEN",b:["4"]},{type:"define",name:"OVERLAY",b:["5"]},{type:"define",name:"DIFFERENCE",b:["6"]},{type:"define",name:"DIVIDE",b:["7"]},{type:"define",name:"DARKEN",b:["8"]},{type:"define",name:"LIGHTEN",b:["9"]},
{type:"define",name:"HUE",b:["10"]},{type:"define",name:"SATURATION",b:["11"]},{type:"define",name:"VALUE",b:["12"]},{type:"define",name:"COLOR",b:["13"]},{type:"define",name:"SOFT_LIGHT",b:["14"]},{type:"define",name:"LINEAR_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]},{type:"define",name:"INVERSE_QUADRATIC",b:["0"]},{type:"define",name:"LINEAR",b:["1"]},{type:"define",
name:"QUADRATIC",b:["2"]},{type:"define",name:"HEMI",b:["1"]},{type:"define",name:"SPOT",b:["2"]},{type:"define",name:"POINT",b:["3"]},{type:"define",name:"SUN",b:["4"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float a = 255.0 ; float b = 0.0 ; float c = 1.0 ; vec4 h ( const in float d ) { vec4 e = vec4 ( a * a * a , a * a , a , c ) ; vec4 f = vec4 ( b , c / a , c / a , c / a ) ; vec4 g = fract ( d * e ) ; g -= g . xxyz * f ; return g ; } float l ( const in vec4 i ) { float j ; vec4 k = vec4 ( c / ( a * a * a ) , c / ( a * a ) , c / a , c ) ; j = dot ( i , k ) ; return j ; } vec4 h ( const in vec2 m ) { vec2 n = vec2 ( a , c ) ; vec2 o = vec2 ( b , c / a ) ; vec4 p = fract ( m . xxyy * n . xyxy ) ; p -= p . xxzz * o . xyxy ; if ( m . r == c ) p . rg = vec2 ( b , c ) ; if ( m . g == c ) p . ba = vec2 ( b , c ) ; return p ; } vec2 t ( const in vec4 q ) { vec2 r ; vec2 s = vec2 ( c / a , c ) ; r . r = dot ( q . rg , s ) ; r . g = dot ( q . ba , s ) ; return r ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float u = 0.0 ; float v = 1.0 ; vec4 x ( vec4 w ) { return w - floor ( w * ( v / 289.0 ) ) * 289.0 ; } vec3 x ( vec3 y ) { return y - floor ( y * ( v / 289.0 ) ) * 289.0 ; } vec2 x ( vec2 z ) { return z - floor ( z * ( v / 289.0 ) ) * 289.0 ; } vec4 B ( vec4 A ) { return A - floor ( A * ( v / 7.0 ) ) * 7.0 ; } vec4 D ( vec4 C ) { return x ( ( 34.0 * C + 5.0 ) * C ) ; }".split(" ")},{type:"define",name:"K",b:["0.142857142857"]},{type:"define",
name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 Q ( vec2 E ) { vec2 F = x ( floor ( E ) ) ; vec2 G = fract ( E ) ; vec4 H = G . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 I = G . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 J = D ( F . x + vec4 ( u , v , u , v ) ) ; J = D ( J + F . y + vec4 ( u , u , v , v ) ) ; vec4 L = B ( J ) * K + K2 ; vec4 M = B ( floor ( J * K ) ) * K + K2 ; vec4 N = H + JITTER * L ; vec4 O = I + JITTER * M ; vec4 P = N * N + O * O ;".split(" ")},
{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"textline",b:"P . xy = min ( P . xy , P . zw ) ; P . x = min ( P . x , P . y ) ; return P . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"P . xy = ( P . x < P . y ) ? P . xy : P . yx ; P . xz = ( P . x < P . z ) ? P . xz : P . zx ; P . xw = ( P . x < P . w ) ? P . xw : P . wx ; P . y = min ( P . y , P . z ) ; P . y = min ( P . y , P . w ) ; return sqrt ( P . xy ) ;".split(" ")}]}}]},{type:"textline",
b:"} vec3 ae ( vec2 R , float S ) { vec2 T = x ( floor ( R ) ) ; vec2 U = fract ( R ) ; vec4 V = U . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 W = U . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 X = D ( T . x + vec4 ( u , v , u , v ) ) ; X = D ( X + T . y + vec4 ( u , u , v , v ) ) ; vec4 Y = B ( X ) * K + K2 ; vec4 Z = B ( floor ( X * K ) ) * K + K2 ; vec4 _ = V + JITTER * Y ; vec4 aa = W + JITTER * Z ; vec4 ab = _ * _ + aa * aa ; _ += S ; aa += S ; vec4 ac = _ * _ + aa * aa ; _ += S ; aa += S ; vec4 ad = _ * _ + aa * aa ; ab . xy = min ( ab . xy , ab . zw ) ; ab . x = min ( ab . x , ab . y ) ; ac . xy = min ( ac . xy , ac . zw ) ; ac . x = min ( ac . x , ac . y ) ; ad . xy = min ( ad . xy , ad . zw ) ; ad . x = min ( ad . x , ad . y ) ; return vec3 ( ab . x , ac . x , ad . x ) ; } vec3 ag ( vec3 af ) { return x ( ( ( af * 34.0 ) + v ) * af ) ; } float au ( vec2 ah ) { const vec4 ai = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 aj = floor ( ah + dot ( ah , ai . yy ) ) ; vec2 ak = ah - aj + dot ( aj , ai . xx ) ; vec2 al ; al = ( ak . x > ak . y ) ? vec2 ( v , u ) : vec2 ( u , v ) ; vec4 am = ak . xyxy + ai . xxzz ; am . xy -= al ; aj = x ( aj ) ; vec3 an = ag ( ag ( aj . y + vec3 ( u , al . y , v ) ) + aj . x + vec3 ( u , al . x , v ) ) ; vec3 ao = max ( 0.5 - vec3 ( dot ( ak , ak ) , dot ( am . xy , am . xy ) , dot ( am . zw , am . zw ) ) , u ) ; ao = ao * ao ; ao = ao * ao ; vec3 ap = 2.0 * fract ( an * ai . www ) - v ; vec3 aq = abs ( ap ) - 0.5 ; vec3 ar = floor ( ap + 0.5 ) ; vec3 as = ap - ar ; ao *= 1.79284291400159 - 0.85373472095314 * ( as * as + aq * aq ) ; vec3 at ; at . x = as . x * ak . x + aq . x * ak . y ; at . yz = as . yz * am . xz + aq . yz * am . yw ; return 130.0 * dot ( ao , at ) ; } vec2 aA ( vec2 av ) { float aw = dot ( av , vec2 ( 12.9898 , 78.233 ) ) ; float ax = dot ( av , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float ay = fract ( sin ( aw ) * 43758.5453 ) * 2.0 - v ; float az = fract ( sin ( ax ) * 43758.5453 ) * 2.0 - v ; return vec2 ( ay , az ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void aY ( inout vec3 aB , float aC , float aD , float aE , vec3 aF , vec3 aG , vec3 aH , vec4 aI , vec3 aJ , float aK ) { if ( aK > CAUSTICS_VIEW_DISTANCE ) return ; vec4 aL = aI ; vec3 aM = aJ + aF ; aM . xz = 10.0 * sin ( 0.1 * aM . xz ) ; vec3 aN = aM + 2.0 * cross ( - aL . xyz , cross ( - aL . xyz , aM ) + aL . w * aM ) ; vec2 aO = aN . xz ; vec3 aP = aG ; float aQ = max ( dot ( aF , aP ) , 0.0 ) ; float aR = 0.025 ; vec2 aS = CAUST_SPEED * aD ; aO . s += 0.25 * sin ( dot ( aJ + aD , vec3 ( 1.0 ) ) ) ; aO . t += 0.35 * ( - sin ( dot ( aJ - aD , vec3 ( - 0.7 ) ) ) ) ; aO . st += 0.15 * cos ( 4.0 * aC - aS . x ) + 1.5 * sin ( aC - 0.3 * aS . y ) ; float aT = CAUST_SCALE * ( 1.0 + max ( 0.1 * aC , 0.0 ) ) ; vec3 aU = ae ( ( aO / aT ) , aR ) ; aU *= CAUST_BRIGHT ; aU *= aU ; float aV = min ( 0.25 * aC , - aC ) + 1.0 ; aV = max ( aV , 0.0 ) ; float aW = aE * aQ ; float aX = max ( sign ( aC ) , 0.0 ) ; aW = aW + max ( 0.5 * sign ( - aF . y ) * aX , 0.0 ) ; aW = min ( aW , 1.0 ) ; aB += aH * aU * aV * aW ; }".split(" ")}]};
a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void a_ ( inout vec3 aZ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"aZ = max ( vec3 ( 0.0 ) , aZ ) ; aZ = pow ( aZ , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void bb ( inout vec3 ba ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"ba = max ( vec3 ( 0.0 ) , ba ) ; ba = pow ( ba , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void be ( inout vec3 bc , in float bd ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"bc = bc * bd ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float bf = 0.0 ; float bg = 1.0 ; struct bh { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool bk ( vec3 bi , vec3 bj ) { return any ( lessThan ( abs ( bi - bj ) , vec3 ( EPSILON ) ) ) ; } vec3 bn ( in vec4 bl , in vec3 bm ) { return bm + 2.0 * cross ( bl . xyz , cross ( bl . xyz , bm ) + bl . w * bm ) ; } vec4 bp ( in vec4 bo ) { return vec4 ( - bo . xyz , bo . w ) / dot ( bo , bo ) ; } vec3 bu ( vec4 bq , vec4 br , vec4 bs ) { vec3 bt = bs . xyz * bq . w ; bt = bn ( br , bt ) ; bt += bq . xyz * bs . w ; return bt ; } vec3 bA ( vec4 bv , vec4 bw , vec4 bx ) { vec3 by = bx . xyz - bv . xyz * bx . w ; vec4 bz = bp ( bw ) ; by = bn ( bz , by ) ; by /= bv . w ; return by ; } mat4 bB ( ) { return mat4 ( bg , bf , bf , bf , bf , bg , bf , bf , bf , bf , bg , bf , bf , bf , bf , bg ) ; } mat4 bD ( float bC ) { return mat4 ( bg , bf , bf , bf , bf , cos ( bC ) , sin ( bC ) , bf , bf , - sin ( bC ) , cos ( bC ) , bf , bf , bf , bf , bg ) ; } mat4 bF ( float bE ) { return mat4 ( cos ( bE ) , bf , - sin ( bE ) , bf , bf , bg , bf , bf , sin ( bE ) , bf , cos ( bE ) , bf , bf , bf , bf , bg ) ; } mat4 bH ( float bG ) { return mat4 ( cos ( bG ) , sin ( bG ) , bf , bf , - sin ( bG ) , cos ( bG ) , bf , bf , bf , bf , bg , bf , bf , bf , bf , bg ) ; } bh bJ ( in bh bI ) { return bh ( bI . a , bI . b , normalize ( bI . c ) , normalize ( bI . d ) , normalize ( bI . e ) , bI . f ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"vec3 bP ( vec4 bK ) { float bL = bK . x ; float bM = bK . y ; float bN = bK . w ; vec3 bO ; bO . x = ( bL + bN ) / 2.0 ; bO . y = ( bM + bN ) / 2.0 ; bO . z = bN ; return bO ; }".split(" ")}]}}]}]};a["include/shadow.glslf"]={type:"group",
a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec4","ca",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float cb = 0.1 ; const float cc = 0.1 ; const float cd = - 0.01 ; const float ce = 0.05 ; vec4 cf = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 cg = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 ch = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 ci = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 cj = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 ck = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 cl = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 cm = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool cp ( vec2 cn , float co ) { return all ( lessThanEqual ( cn , vec2 ( 1.0 + co ) ) ) && all ( greaterThanEqual ( cn , vec2 ( 0.0 - co ) ) ) ; } float cy ( float cq , float cr , mat2 cs , vec3 ct , float cu , PRECISION sampler2D cv ) { vec2 cw , cx ; cx . x = cq ; cx . y = cr ; cx = cs * cx ; cw = ct . xy + cx * cu / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"if ( ! cp ( cw , cd ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",b:"return step ( ct . z , texture2D ( cv , cw ) . r ) ; } void cM ( inout float cz , inout float cA , float cB , float cC , mat2 cD , vec3 cE , vec3 cF , float cG , float cH , PRECISION sampler2D cI , PRECISION sampler2D cJ ) { vec2 cK , cL ; cL . x = cB ; cL . y = cC ; cL = cD * cL ; cK = cE . xy + cL * cG / SHADOW_TEX_RES ; cz += step ( cE . z , texture2D ( cI , cK ) . r ) ; cK = cF . xy + cL * cH / SHADOW_TEX_RES ; cA += step ( cF . z , texture2D ( cJ , cK ) . r ) ; } float cW ( vec3 cN , PRECISION sampler2D cO , float cP ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:"if ( cN . z > u_perspective_cast_far_bound ) return 1.0 ; else {".split(" ")}]}}]},{type:"textline",b:"cN . z = clamp ( cN . z , 0.0 , 1.0 ) ; float cQ = 0.0 ; float cR = aA ( cN . xy ) . x * M_PI ; float cS = cos ( cR ) ; float cT = sin ( cR ) ; mat2 cU = mat2 ( cS , cT , - cT , cS ) ; for ( int cV = 0 ; cV < 4 ; cV ++ ) { cQ += cy ( cf [ cV ] , cj [ cV ] , cU , cN , cP , cO ) ; cQ += cy ( cg [ cV ] , ck [ cV ] , cU , cN , cP , cO ) ; cQ += cy ( ch [ cV ] , cl [ cV ] , cU , cN , cP , cO ) ; cQ += cy ( ci [ cV ] , cm [ cV ] , cU , cN , cP , cO ) ; } cQ /= 16.0 ; return clamp ( cQ , 0.0 , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["}"]}]}}]},{type:"textline",b:"return 1.0 ; } float dk ( vec3 cX , PRECISION sampler2D cY , vec3 cZ , PRECISION sampler2D c_ , float da , float db , float dc ) { float dd , de ; cX . z = clamp ( cX . z , 0.0 , 1.0 ) ; cZ . z = clamp ( cZ . z , 0.0 , 1.0 ) ; dd = 0.0 ; de = 0.0 ; float df = aA ( cX . xy ) . x * M_PI ; float dg = cos ( df ) ; float dh = sin ( df ) ; mat2 di = mat2 ( dg , dh , - dh , dg ) ; for ( int dj = 0 ; dj < 4 ; dj ++ ) { cM ( dd , de , cf [ dj ] , cj [ dj ] , di , cX , cZ , da , db , cY , c_ ) ; cM ( dd , de , cg [ dj ] , ck [ dj ] , di , cX , cZ , da , db , cY , c_ ) ; cM ( dd , de , ch [ dj ] , cl [ dj ] , di , cX , cZ , da , db , cY , c_ ) ; cM ( dd , de , ci [ dj ] , cm [ dj ] , di , cX , cZ , da , db , cY , c_ ) ; } dd = mix ( dd , de , dc ) ; dd /= 16.0 ; return clamp ( dd , 0.0 , 1.0 ) ; } float dp ( vec2 dl ) { float dm = min ( dl . x , dl . y ) ; float dn = min ( 1.0 - dl . x , 1.0 - dl . y ) ; return min ( dm , dn ) ; } float ds ( float dq , float dr ) { if ( dr >= 0.0 && dr <= cc ) dq = ( dq - 1.0 ) / cc * dr + 1.0 ; return dq ; } float dE ( vec3 dt , vec3 du , PRECISION sampler2D dv , PRECISION sampler2D dw , float dx , float dy , float dz , float dA ) { float dB ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float dC = dp ( dt . xy ) ; if ( - dA > dz && dC >= 0.0 && dC <= cb && cp ( du . xy , 0.0 ) ) { float dD = 1.0 - dC / cb ; dB = dk ( dt , dv , du , dw , dx , dy , dD ) ; } else".split(" ")}]}}]},{type:"textline",b:"dB = cW ( dt , dv , dx ) ; return dB ; } float dM ( vec3 dF , PRECISION sampler2D dG , float dH , float dI , float dJ ) { float dK = cW ( dF , dG , dH ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - dJ > dI ) { float dL = dp ( dF . xy ) ; dK = ds ( dK , dL ) ; }".split(" ")}]}}]},{type:"textline",b:"return dK ; } float dT ( float dN ) { float dO = 1.0 ; vec3 dP = bW . xyz / bW . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 dQ = bX . xyz / bX . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"vec3 dR = bY . xyz / bY . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 dS = bZ . xyz / bZ . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( cp ( dP . xy , 0.0 ) ) { dO = dE ( dP , dQ , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , dN ) ; }".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"if ( cp ( dP . xy , ce ) ) { dO = dM ( dP , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , dN ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( cp ( dQ . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"dO = dE ( dQ , dR , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , dN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dO = dM ( dQ , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , dN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( cp ( dR . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"dO = dE ( dR , dS , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , dN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dO = dM ( dR , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , dN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( cp ( dS . xy , 0.0 ) ) dO = dM ( dS , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , dN ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","dO",";","}"]}]}}]},{type:"textline",b:"float dY ( inout vec3 dU ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 dV = texture2DProj ( u_shadow_mask , bU ) . rg ; vec3 dW = vec3 ( dV . r ) ; float dX = dV . g ; ca = vec4 ( dW , dX ) ; dU *= ca . a ; return ca . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE",
"SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return dT ( bR . z ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",
d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float ef ( in vec3 dZ , vec3 d_ , float ea , float eb ) { vec3 ec = normalize ( d_ + dZ ) ; float ed = 1.0 - dot ( dZ , ec ) ; float ee = eb + ( 1.0 - eb ) * pow ( ed , ea ) ; return ee ; } void et ( inout vec3 eg , vec3 eh , vec3 ei , float ej ) { vec3 ek = reflect ( - eh , ei ) ; float el = u_fresnel_params [ 2 ] ; float em = u_fresnel_params [ 3 ] ; float en = 1.0 ; if ( el != 0.0 ) en = ef ( eh , ek , el , em ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 eo = textureCube ( u_cube_reflection , ek ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 ep = u_refl_plane . xyz * dot ( ei , u_refl_plane . xyz ) ; vec3 eq = ei - ep ; vec2 er = ( u_view_matrix_frag * vec4 ( eq , 0.0 ) ) . xy ; vec2 es = bU . xy / bU . z ; es += er * REFL_BUMP ; vec3 eo = texture2D ( u_plane_reflection , es ) . rgb ;".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 eo = textureCube ( u_mirrormap , ek ) . xyz ; ej = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"a_ ( eo . rgb ) ; eg = mix ( eg , eo , ej * en ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 ew ( vec3 eu ) {".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , eu ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"float ev = 0.5 * eu . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , ev ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float eC ( in float ex , inout vec2 ey , in vec2 ez ) { vec4 eA = texture2D ( u_scene_depth , ey ) ; float eB = l ( eA ) ; if ( eB < bV ) { ey = ez ; return ex ; } else { return eB ; } return ex ; }".split(" ")}]}}]},{type:"textline",b:"vec3 eK ( in vec3 eD , in vec2 eE ) { vec2 eF = eD . xy / eD . z ; vec2 eG = eF + eE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 eH = texture2DProj ( u_scene_depth , eD ) ; float eI = l ( eH ) ; eC ( eI , eG , eF ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 eJ = texture2D ( u_refractmap , eG ) . rgb ; a_ ( eJ ) ; return eJ ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",a:[{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},
{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eL",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float eM = 0.5 ; vec3 eN = vec3 ( ZERO_VALUE_NODES ) ; vec3 eO = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"vec3 eS ( in vec3 eP , in float eQ ) { vec3 eR = eN ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"eR = eK ( bU , eP . xz * eQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"eR = texture2D ( u_refractmap , bU . xy / bU . z ) . rgb ; a_ ( eR ) ;".split(" ")}]}}]},{type:"textline",b:["return","eR",";","}"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 eZ ( vec3 eT ) { vec4 eU = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 eV = mix ( vec4 ( eT . bg , eU . wz ) , vec4 ( eT . gb , eU . xy ) , step ( eT . b , eT . g ) ) ; vec4 eW = mix ( vec4 ( eV . xyw , eT . r ) , vec4 ( eT . r , eV . yzx ) , step ( eV . x , eT . r ) ) ; float eX = eW . x - min ( eW . w , eW . y ) ; float eY = 1.0e-10 ; return vec3 ( abs ( eW . z + ( eW . w - eW . y ) / ( 6.0 * eX + eY ) ) , eX / ( eW . x + eY ) , eW . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 fc ( vec3 e_ ) { vec4 fa = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 fb = abs ( fract ( vec3 ( e_ . r , e_ . r , e_ . r ) + fa . xyz ) * 6.0 - fa . www ) ; return e_ . b * mix ( fa . xxx , clamp ( fb - fa . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , e_ . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec3 fe ( vec2 fd ) { return vec3 ( fd * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec2 fg ( vec3 ff ) { return vec2 ( ff . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",h:[{type:"node_out",name:"fL",qualifier:["vec3"],e:!0},{type:"node_out",name:"fM",qualifier:["float"],e:!0},{type:"node_out",name:"fN",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fL"],g:[{type:"textline",b:"fL = normalize ( fI . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fM"],g:[{type:"textline",b:"fM = abs ( fI . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fN"],
g:[{type:"textline",b:"fN = length ( fI . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",h:[{type:"node_in",name:"fO",qualifier:["float"],e:!1},{type:"node_in",name:"fP",qualifier:["float"],e:!1},{type:"node_in",name:"fQ",qualifier:["float"],e:!1},{type:"node_out",name:"fR",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fR = vec3 ( fO , fP , fQ ) ;".split(" ")}]},{type:"node",name:"COMBHSV",h:[{type:"node_in",name:"fS",qualifier:["float"],e:!1},{type:"node_in",name:"fT",qualifier:["float"],
e:!1},{type:"node_in",name:"fU",qualifier:["float"],e:!1},{type:"node_out",name:"fV",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fV = fc ( vec3 ( fS , fT , fU ) ) ;".split(" ")}]},{type:"node",name:"EMPTY_UV",h:[{type:"node_out",name:"fW",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fW = vec3 ( - 1.0 , - 1.0 , 0.0 ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",h:[{type:"node_out",name:"fX",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fX","=","eN",";"]}]},{type:"node",name:"GEOMETRY_UV",
h:[{type:"node_out",name:"fY",qualifier:["vec3"],e:!1},{type:"node_param",name:"fh",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"fY = fe ( fh ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",h:[{type:"node_out",name:"fZ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fZ = 2.0 * eL - eO ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",h:[{type:"node_out",name:"f_",qualifier:["vec3"],e:!1},{type:"node_param",name:"fi",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["f_","=","fi",
";"]}]},{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_out",name:"ga",qualifier:["float"],e:!1},{type:"node_param",name:"fj",qualifier:["varying","float"]}],g:[{type:"textline",b:["ga","=","fj",";"]}]},{type:"node",name:"GEOMETRY_VC2",h:[{type:"node_out",name:"gb",qualifier:["float"],e:!1},{type:"node_out",name:"gc",qualifier:["float"],e:!1},{type:"node_param",name:"fk",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"gb = fk [ 0 ] ; gc = fk [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",
h:[{type:"node_out",name:"gd",qualifier:["float"],e:!1},{type:"node_out",name:"ge",qualifier:["float"],e:!1},{type:"node_out",name:"gf",qualifier:["float"],e:!1},{type:"node_param",name:"fl",qualifier:["varying","vec3"]}],g:[{type:"textline",b:"gd = fl [ 0 ] ; ge = fl [ 1 ] ; gf = fl [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",h:[{type:"node_out",name:"gg",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gg","=","fD",";"]}]},{type:"node",name:"GEOMETRY_FB",h:[{type:"node_out",name:"gh",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"gh = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",h:[{type:"node_out",name:"gi",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gi","=","fu",";"]}]},{type:"node",name:"GEOMETRY_LO",h:[{type:"node_out",name:"gj",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gj [ 0 ] = fI [ 0 ] ; gj [ 1 ] = fI [ 1 ] ; gj [ 2 ] = fI [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",h:[{type:"node_out",
name:"gk",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gk = vec3 ( fH . r , - fH . b , fH . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",h:[{type:"node_out",name:"gl",qualifier:["vec3"],e:!1},{type:"node_out",name:"gm",qualifier:["vec3"],e:!1},{type:"node_out",name:"gn",qualifier:["vec3"],e:!1},{type:"node_out",name:"go",qualifier:["vec3"],e:!1},{type:"node_out",name:"gp",qualifier:["vec3"],e:!1},{type:"node_out",name:"gq",qualifier:["vec3"],e:!1},{type:"node_out",name:"gr",qualifier:["float"],
e:!1},{type:"node_out",name:"gs",qualifier:["float"],e:!1}],g:[{type:"textline",b:"gl = eN ; gm = eN ; gn = eN ; go = eN ; gp = eN ; gq = eN ; gr = ZERO_VALUE_NODES ; gs = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"HUE_SAT",h:[{type:"node_in",name:"gt",qualifier:["float"],e:!1},{type:"node_in",name:"gu",qualifier:["float"],e:!1},{type:"node_in",name:"gv",qualifier:["float"],e:!1},{type:"node_in",name:"gw",qualifier:["float"],e:!1},{type:"node_in",name:"gx",qualifier:["vec3"],e:!1},{type:"node_out",
name:"gy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"vec3 gz = eZ ( gx ) ; gz [ 0 ] += ( gt - 0.5 ) ; if ( gz [ 0 ] > UNITY_VALUE_NODES ) gz [ 0 ] -= UNITY_VALUE_NODES ; else if ( gz [ 0 ] < ZERO_VALUE_NODES ) gz [ 0 ] += UNITY_VALUE_NODES ; gz *= vec3 ( UNITY_VALUE_NODES , gu , gv ) ; gz = mix ( eO , mix ( eN , gz , step ( eN , gz ) ) , step ( gz , eO ) ) ; gy = mix ( gx , fc ( gz ) , gw ) ;".split(" ")}]},{type:"node",name:"INVERT",h:[{type:"node_in",name:"gA",qualifier:["float"],e:!1},{type:"node_in",
name:"gB",qualifier:["vec3"],e:!1},{type:"node_out",name:"gC",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gC = mix ( gB , eO - gB , gA ) ;".split(" ")}]},{type:"node",name:"LAMP",h:[{type:"node_out",name:"gD",qualifier:["vec3"],e:!0},{type:"node_out",name:"gE",qualifier:["vec3"],e:!1},{type:"node_out",name:"gF",qualifier:["float"],e:!1},{type:"node_out",name:"gG",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gD"],g:[{type:"textline",b:"gD = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},
{type:"textline",b:"vec4 gH = u_lamp_light_factors [ LAMP_INDEX ] ; vec3 gI = u_lamp_light_directions [ LAMP_INDEX ] ; vec3 gJ = u_lamp_light_positions [ LAMP_INDEX ] ; float gK = gH . z ; if ( gK != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",b:"gE = gJ - bQ ; gF = length ( gE ) ; gE = normalize ( gE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gG"],g:[{type:"textline",b:"gG = gK / ( gK + gF * gF ) ; float gL = gH . x ; float gM = gH . y ; if ( gL > - UNITY_VALUE_NODES ) { float gN = dot ( gE , gI ) ; gN *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( gN - gL ) / gM ) ; gG *= gN ; }".split(" ")}]}]},
{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gE"],g:[{type:"textline",b:["gE","=","gI",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gF"],g:[{type:"textline",b:"gF = length ( gJ - bQ ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gG"],g:[{type:"textline",b:["gG","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",h:[{type:"node_in",name:"gO",qualifier:["vec3"],e:!1},{type:"node_out",
name:"gP",qualifier:["vec3"],e:!0},{type:"node_out",name:"gQ",qualifier:["float"],e:!0},{type:"node_param",name:"fm",qualifier:["vec3"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gP"],g:[{type:"textline",b:["gP","=","fm",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gQ"],g:[{type:"textline",b:"gQ = - dot ( gO , fm ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",h:[{type:"node_in",name:"gR",qualifier:["vec3"],e:!1},{type:"node_out",name:"gS",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:"gS = - ( u_view_matrix_frag * vec4 ( gR , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",h:[{type:"node_in",name:"gT",qualifier:["vec3"],e:!1},{type:"node_in",name:"gU",qualifier:["float"],e:!1},{type:"node_in",name:"gV",qualifier:["float"],e:!1},{type:"node_in",name:"gW",qualifier:["float"],e:!1},{type:"node_in",name:"gX",qualifier:["vec3"],e:!1},{type:"node_in",name:"gY",qualifier:["vec3"],e:!1},{type:"node_out",name:"gZ",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:["gZ","=","gT",";"]},{type:"textline",b:"gU ; gV ; gW ; gX ; gY ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",h:[{type:"node_in",name:"g_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ha",qualifier:["float"],e:!1},{type:"node_in",name:"hb",qualifier:["vec3"],e:!1},{type:"node_out",name:"hc",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hc","=","g_",";"]},{type:"textline",b:["ha",";","hb",";"]}]},{type:"node",name:"BSDF_GLASS",h:[{type:"node_in",name:"hd",qualifier:["vec3"],
e:!1},{type:"node_in",name:"he",qualifier:["float"],e:!1},{type:"node_in",name:"hf",qualifier:["float"],e:!1},{type:"node_in",name:"hg",qualifier:["vec3"],e:!1},{type:"node_out",name:"hh",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hh","=","hd",";"]},{type:"textline",b:"he ; hf ; hg ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",h:[{type:"node_in",name:"hi",qualifier:["vec3"],e:!1},{type:"node_in",name:"hj",qualifier:["float"],e:!1},{type:"node_in",name:"hk",qualifier:["vec3"],e:!1},{type:"node_out",
name:"hl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hl","=","hi",";"]},{type:"textline",b:["hj",";","hk",";"]}]},{type:"node",name:"BSDF_HAIR",h:[{type:"node_in",name:"hm",qualifier:["vec3"],e:!1},{type:"node_in",name:"hn",qualifier:["float"],e:!1},{type:"node_in",name:"ho",qualifier:["float"],e:!1},{type:"node_in",name:"hp",qualifier:["float"],e:!1},{type:"node_out",name:"hq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hq","=","hm",";"]},{type:"textline",b:"hn ; ho ; hp ;".split(" ")}]},
{type:"node",name:"BSDF_TRANSPARENT",h:[{type:"node_in",name:"hr",qualifier:["vec3"],e:!1},{type:"node_out",name:"hs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hs","=","hr",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",h:[{type:"node_in",name:"ht",qualifier:["vec3"],e:!1},{type:"node_in",name:"hu",qualifier:["vec3"],e:!1},{type:"node_out",name:"hv",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hv","=","ht",";"]},{type:"textline",b:["hu",";"]}]},{type:"node",name:"BSDF_REFRACTION",h:[{type:"node_in",
name:"hw",qualifier:["vec3"],e:!1},{type:"node_in",name:"hx",qualifier:["float"],e:!1},{type:"node_in",name:"hy",qualifier:["float"],e:!1},{type:"node_in",name:"hz",qualifier:["vec3"],e:!1},{type:"node_out",name:"hA",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hA [ 0 ] = hA [ 1 ] = hA [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"hw ; hx ; hy ; hz ;".split(" ")}]},{type:"node",name:"BSDF_TOON",h:[{type:"node_in",name:"hB",qualifier:["vec3"],e:!1},{type:"node_in",name:"hC",qualifier:["float"],
e:!1},{type:"node_in",name:"hD",qualifier:["float"],e:!1},{type:"node_in",name:"hE",qualifier:["vec3"],e:!1},{type:"node_out",name:"hF",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hF","=","hB",";"]},{type:"textline",b:"hC ; hD ; hE ;".split(" ")}]},{type:"node",name:"BSDF_VELVET",h:[{type:"node_in",name:"hG",qualifier:["vec3"],e:!1},{type:"node_in",name:"hH",qualifier:["float"],e:!1},{type:"node_in",name:"hI",qualifier:["vec3"],e:!1},{type:"node_out",name:"hJ",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["hJ","=","hG",";"]},{type:"textline",b:["hH",";","hI",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",h:[{type:"node_in",name:"hK",qualifier:["vec3"],e:!1},{type:"node_in",name:"hL",qualifier:["float"],e:!1},{type:"node_in",name:"hM",qualifier:["vec3"],e:!1},{type:"node_in",name:"hN",qualifier:["float"],e:!1},{type:"node_in",name:"hO",qualifier:["float"],e:!1},{type:"node_in",name:"hP",qualifier:["vec3"],e:!1},{type:"node_out",name:"hQ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hQ [ 0 ] = hQ [ 1 ] = hQ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:"hK ; hM ; hN ; hO ; hP ; hL ;".split(" ")}]},{type:"node",name:"EMISSION",h:[{type:"node_in",name:"hR",qualifier:["vec3"],e:!1},{type:"node_in",name:"hS",qualifier:["float"],e:!1},{type:"node_out",name:"hT",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hT","=","hR",";"]},{type:"textline",b:["hS",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",h:[{type:"node_in",name:"hU",qualifier:["vec3"],e:!1},{type:"node_out",name:"hV",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hV [ 0 ] = hV [ 1 ] = hV [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["hU",";"]}]},{type:"node",name:"HOLDOUT",h:[{type:"node_out",name:"hW",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hW [ 0 ] = hW [ 1 ] = hW [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",h:[{type:"node_in",name:"hX",qualifier:["vec3"],e:!1},{type:"node_in",name:"hY",qualifier:["float"],e:!1},{type:"node_out",name:"hZ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hZ [ 0 ] = hZ [ 1 ] = hZ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",
b:["hX",";","hY",";"]}]},{type:"node",name:"VOLUME_SCATTER",h:[{type:"node_in",name:"h_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ia",qualifier:["float"],e:!1},{type:"node_in",name:"ib",qualifier:["float"],e:!1},{type:"node_out",name:"ic",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ic [ 0 ] = ic [ 1 ] = ic [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"h_ ; ia ; ib ;".split(" ")}]},{type:"node",name:"BUMP",h:[{type:"node_in",name:"id",qualifier:["float"],e:!1},{type:"node_in",
name:"ie",qualifier:["float"],e:!1},{type:"node_in",name:"ig",qualifier:["float"],e:!1},{type:"node_in",name:"ih",qualifier:["vec3"],e:!1},{type:"node_out",name:"ii",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["ii","=","ih",";"]},{type:"textline",b:"id ; ie ; ig ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",h:[{type:"node_in",name:"ij",qualifier:["float"],e:!1},{type:"node_in",name:"ik",qualifier:["vec3"],e:!1},{type:"node_out",name:"il",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["il",
"=","ik",";"]},{type:"textline",b:["ij",";"]}]},{type:"node",name:"VECT_TRANSFORM",h:[{type:"node_in",name:"im",qualifier:["vec3"],e:!1},{type:"node_out",name:"io",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"io [ 0 ] = io [ 1 ] = io [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["im",";"]}]},{type:"node",name:"BLACKBODY",h:[{type:"node_in",name:"ip",qualifier:["float"],e:!1},{type:"node_out",name:"iq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"iq [ 0 ] = iq [ 1 ] = iq [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["ip",";"]}]},{type:"node",name:"WAVELENGTH",h:[{type:"node_in",name:"ir",qualifier:["float"],e:!1},{type:"node_out",name:"is",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"is [ 0 ] = is [ 1 ] = is [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ir",";"]}]},{type:"node",name:"SEPXYZ",h:[{type:"node_in",name:"it",qualifier:["vec3"],e:!1},{type:"node_out",name:"iu",qualifier:["float"],e:!1},{type:"node_out",name:"iv",qualifier:["float"],e:!1},{type:"node_out",name:"iw",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"iu = it [ 0 ] ; iv = it [ 1 ] ; iw = it [ 2 ] ;".split(" ")}]},{type:"node",name:"COMBXYZ",h:[{type:"node_in",name:"ix",qualifier:["float"],e:!1},{type:"node_in",name:"iy",qualifier:["float"],e:!1},{type:"node_in",name:"iz",qualifier:["float"],e:!1},{type:"node_out",name:"iA",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"iA [ 0 ] = ix ; iA [ 1 ] = iy ; iA [ 2 ] = iz ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",h:[{type:"node_in",name:"iB",
qualifier:["vec3"],e:!1},{type:"node_in",name:"iC",qualifier:["float"],e:!1},{type:"node_in",name:"iD",qualifier:["float"],e:!1},{type:"node_out",name:"iE",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float iF = iC - iD * 0.5 ; iE = max ( ( UNITY_VALUE_NODES + iD ) * iB + iF , eN ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",h:[{type:"node_in",name:"iG",qualifier:["float"],e:!1},{type:"node_in",name:"iH",qualifier:["float"],e:!1},{type:"node_out",name:"iI",qualifier:["float"],e:!1},{type:"node_out",
name:"iJ",qualifier:["float"],e:!1},{type:"node_out",name:"iK",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iI = iJ = iK = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["iG",";","iH",";"]}]},{type:"node",name:"TEX_IMAGE",h:[{type:"node_in",name:"iL",qualifier:["vec3"],e:!1},{type:"node_out",name:"iM",qualifier:["vec3"],e:!1},{type:"node_out",name:"iN",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iM [ 0 ] = iM [ 1 ] = iM [ 2 ] = ZERO_VALUE_NODES ; iN = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:["iL",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",h:[{type:"node_in",name:"iO",qualifier:["vec3"],e:!1},{type:"node_out",name:"iP",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"iP [ 0 ] = iP [ 1 ] = iP [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["iO",";"]}]},{type:"node",name:"TEX_SKY",h:[{type:"node_in",name:"iQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"iR",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"iR [ 0 ] = iR [ 1 ] = iR [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["iQ",";"]}]},{type:"node",name:"TEX_NOISE",h:[{type:"node_in",name:"iS",qualifier:["vec3"],e:!1},{type:"node_in",name:"iT",qualifier:["float"],e:!1},{type:"node_in",name:"iU",qualifier:["float"],e:!1},{type:"node_in",name:"iV",qualifier:["float"],e:!1},{type:"node_out",name:"iW",qualifier:["vec3"],e:!1},{type:"node_out",name:"iX",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iW [ 0 ] = iW [ 1 ] = iW [ 2 ] = ZERO_VALUE_NODES ; iX = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",
b:"iS ; iT ; iU ; iV ;".split(" ")}]},{type:"node",name:"TEX_WAVE",h:[{type:"node_in",name:"iY",qualifier:["vec3"],e:!1},{type:"node_in",name:"iZ",qualifier:["float"],e:!1},{type:"node_in",name:"i_",qualifier:["float"],e:!1},{type:"node_in",name:"ja",qualifier:["float"],e:!1},{type:"node_in",name:"jb",qualifier:["float"],e:!1},{type:"node_out",name:"jc",qualifier:["vec3"],e:!1},{type:"node_out",name:"jd",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jc [ 0 ] = jc [ 1 ] = jc [ 2 ] = ZERO_VALUE_NODES ; jd = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"iY ; iZ ; i_ ; ja ; jb ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",h:[{type:"node_in",name:"je",qualifier:["vec3"],e:!1},{type:"node_in",name:"jf",qualifier:["float"],e:!1},{type:"node_out",name:"jg",qualifier:["vec3"],e:!1},{type:"node_out",name:"jh",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jg [ 0 ] = jg [ 1 ] = jg [ 2 ] = ZERO_VALUE_NODES ; jh = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["je",";","jf",";"]}]},{type:"node",name:"TEX_MUSGRAVE",h:[{type:"node_in",
name:"ji",qualifier:["vec3"],e:!1},{type:"node_in",name:"jj",qualifier:["float"],e:!1},{type:"node_in",name:"jk",qualifier:["float"],e:!1},{type:"node_in",name:"jl",qualifier:["float"],e:!1},{type:"node_in",name:"jm",qualifier:["float"],e:!1},{type:"node_in",name:"jn",qualifier:["float"],e:!1},{type:"node_in",name:"jo",qualifier:["float"],e:!1},{type:"node_out",name:"jp",qualifier:["vec3"],e:!1},{type:"node_out",name:"jq",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jp [ 0 ] = jp [ 1 ] = jp [ 2 ] = ZERO_VALUE_NODES ; jq = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"ji ; jj ; jk ; jl ; jm ; jn ; jo ;".split(" ")}]},{type:"node",name:"TEX_GRADIENT",h:[{type:"node_in",name:"jr",qualifier:["vec3"],e:!1},{type:"node_out",name:"js",qualifier:["vec3"],e:!1},{type:"node_out",name:"jt",qualifier:["float"],e:!1}],g:[{type:"textline",b:"js [ 0 ] = js [ 1 ] = js [ 2 ] = ZERO_VALUE_NODES ; jt = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["jr",";"]}]},{type:"node",name:"TEX_MAGIC",h:[{type:"node_in",name:"ju",qualifier:["vec3"],e:!1},{type:"node_in",
name:"jv",qualifier:["float"],e:!1},{type:"node_in",name:"jw",qualifier:["float"],e:!1},{type:"node_out",name:"jx",qualifier:["vec3"],e:!1},{type:"node_out",name:"jy",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jx [ 0 ] = jx [ 1 ] = jx [ 2 ] = ZERO_VALUE_NODES ; jy = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"ju ; jv ; jw ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",h:[{type:"node_in",name:"jz",qualifier:["vec3"],e:!1},{type:"node_in",name:"jA",qualifier:["vec3"],e:!1},{type:"node_in",
name:"jB",qualifier:["vec3"],e:!1},{type:"node_in",name:"jC",qualifier:["float"],e:!1},{type:"node_out",name:"jD",qualifier:["vec3"],e:!1},{type:"node_out",name:"jE",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jD [ 0 ] = jD [ 1 ] = jD [ 2 ] = ZERO_VALUE_NODES ; jE = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"jz ; jA ; jB ; jC ;".split(" ")}]},{type:"node",name:"TEX_BRICK",h:[{type:"node_in",name:"jF",qualifier:["vec3"],e:!1},{type:"node_in",name:"jG",qualifier:["vec3"],e:!1},{type:"node_in",
name:"jH",qualifier:["vec3"],e:!1},{type:"node_in",name:"jI",qualifier:["vec3"],e:!1},{type:"node_in",name:"jJ",qualifier:["float"],e:!1},{type:"node_in",name:"jK",qualifier:["float"],e:!1},{type:"node_in",name:"jL",qualifier:["float"],e:!1},{type:"node_in",name:"jM",qualifier:["float"],e:!1},{type:"node_in",name:"jN",qualifier:["float"],e:!1},{type:"node_out",name:"jO",qualifier:["vec3"],e:!1},{type:"node_out",name:"jP",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jO [ 0 ] = jO [ 1 ] = jO [ 2 ] = ZERO_VALUE_NODES ; jP = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"jF ; jG ; jH ; jI ; jJ ; jK ; jL ; jM ; jN ;".split(" ")}]},{type:"node",name:"ADD_SHADER",h:[{type:"node_in",name:"jQ",qualifier:["vec3"],e:!1},{type:"node_in",name:"jR",qualifier:["vec3"],e:!1},{type:"node_out",name:"jS",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jS = clamp ( jQ + jR , eN , eO ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",h:[{type:"node_in",name:"jT",qualifier:["float"],e:!1},{type:"node_in",name:"jU",qualifier:["vec3"],e:!1},{type:"node_in",name:"jV",
qualifier:["vec3"],e:!1},{type:"node_out",name:"jW",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float jX = clamp ( jT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jW = jX * jU + ( UNITY_VALUE_NODES - jX ) * jV ;".split(" ")}]},{type:"node",name:"UV_MERGED",h:[{type:"node_out",name:"jY",qualifier:["vec3"],e:!1},{type:"node_out",name:"jZ",qualifier:["vec3"],e:!1},{type:"node_param",name:"fn",qualifier:["varying","vec2"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jY"],g:[{type:"textline",
b:"jY = fe ( fn ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jZ"],g:[{type:"textline",b:"jZ = vec3 ( fn , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",h:[{type:"node_out",name:"j_",qualifier:["vec3"],e:!1},{type:"node_param",name:"fo",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"j_ = vec3 ( fo , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",h:[{type:"node_out",name:"ka",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["ka","=","fC",";"]}]},{type:"node",name:"TEX_COORD_GE",h:[{type:"node_out",name:"kb",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["kb","=","eL",";"]}]},{type:"node",name:"TEX_COORD_OB",h:[{type:"node_out",name:"kc",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"kc [ 0 ] = kc [ 1 ] = kc [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",h:[{type:"node_out",name:"kd",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"kd [ 0 ] = fI [ 0 ] ; kd [ 1 ] = fI [ 1 ] ; kd [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_WI",h:[{type:"node_out",name:"ke",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ke [ 0 ] = ke [ 1 ] = ke [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",h:[{type:"node_out",name:"kf",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"kf [ 0 ] = kf [ 1 ] = kf [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",h:[{type:"node_out",name:"kg",qualifier:["vec3"],e:!1},{type:"node_param",name:"fp",qualifier:["varying","vec2"]}],
g:[{type:"textline",b:"kg = vec3 ( fp , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",h:[{type:"node_out",name:"kh",qualifier:["float"],e:!1},{type:"node_out",name:"ki",qualifier:["float"],e:!1},{type:"node_out",name:"kj",qualifier:["float"],e:!1},{type:"node_out",name:"kk",qualifier:["vec3"],e:!1},{type:"node_out",name:"kl",qualifier:["float"],e:!1},{type:"node_out",name:"km",qualifier:["vec3"],e:!1},{type:"node_out",name:"kn",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"kh = ZERO_VALUE_NODES ; ki = ZERO_VALUE_NODES ; kj = ZERO_VALUE_NODES ; kk = vec3 ( ZERO_VALUE_NODES ) ; kl = ZERO_VALUE_NODES ; km = kk ; kn = kk ;".split(" ")}]},{type:"node",name:"HAIR_INFO",h:[{type:"node_out",name:"ko",qualifier:["float"],e:!1},{type:"node_out",name:"kp",qualifier:["float"],e:!1},{type:"node_out",name:"kq",qualifier:["float"],e:!1},{type:"node_out",name:"kr",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ko = ZERO_VALUE_NODES ; kp = ZERO_VALUE_NODES ; kq = ZERO_VALUE_NODES ; kr = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"OBJECT_INFO",h:[{type:"node_out",name:"ks",qualifier:["vec3"],e:!1},{type:"node_out",name:"kt",qualifier:["float"],e:!1},{type:"node_out",name:"ku",qualifier:["float"],e:!1},{type:"node_out",name:"kv",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kt = ZERO_VALUE_NODES ; ku = ZERO_VALUE_NODES ; kv = ZERO_VALUE_NODES ; ks = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",h:[{type:"node_in",name:"kw",qualifier:["float"],e:!1},{type:"node_out",name:"kx",
qualifier:["float"],e:!1}],g:[{type:"textline",b:["kx","=","kw",";"]}]},{type:"node",name:"TANGENT",h:[{type:"node_out",name:"ky",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ky = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",h:[{type:"node_in",name:"kz",qualifier:["float"],e:!1},{type:"node_in",name:"kA",qualifier:["vec3"],e:!1},{type:"node_out",name:"kB",qualifier:["float"],e:!1},{type:"node_out",name:"kC",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kB = kC = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["kA",";","kz",";"]}]},{type:"node",name:"LIGHT_PATH",h:[{type:"node_out",name:"kD",qualifier:["float"],e:!1},{type:"node_out",name:"kE",qualifier:["float"],e:!1},{type:"node_out",name:"kF",qualifier:["float"],e:!1},{type:"node_out",name:"kG",qualifier:["float"],e:!1},{type:"node_out",name:"kH",qualifier:["float"],e:!1},{type:"node_out",name:"kI",qualifier:["float"],e:!1},{type:"node_out",name:"kJ",qualifier:["float"],e:!1},{type:"node_out",name:"kK",qualifier:["float"],e:!1},{type:"node_out",
name:"kL",qualifier:["float"],e:!1},{type:"node_out",name:"kM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kD = kE = kF = ZERO_VALUE_NODES ; kG = kH = kI = ZERO_VALUE_NODES ; kJ = kJ = kL = kM = ZERO_VALUE_NODES ; kK = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",h:[{type:"node_out",name:"kN",qualifier:["vec3"],e:!1},{type:"node_out",name:"kO",qualifier:["vec3"],e:!1},{type:"node_out",name:"kP",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kN = kO = vec3 ( ZERO_VALUE_NODES ) ; kP = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"SCRIPT",h:[],g:[]},{type:"node",name:"CURVE_VEC",h:[{type:"node_in",name:"kQ",qualifier:["float"],e:!1},{type:"node_in",name:"kR",qualifier:["vec3"],e:!1},{type:"node_out",name:"kS",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["kS","=","kR",";"]},{type:"textline",b:["kQ",";"]}]},{type:"node",name:"CURVE_RGB",h:[{type:"node_in",name:"kT",qualifier:["float"],e:!1},{type:"node_in",name:"kU",qualifier:["vec3"],e:!1},{type:"node_out",name:"kV",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["kV","=","kU",";"]},{type:"textline",b:["kT",";"]}]},{type:"node",name:"VALTORGB",h:[{type:"node_in",name:"kW",qualifier:["float"],e:!1},{type:"node_out",name:"kX",qualifier:["vec3"],e:!1},{type:"node_out",name:"kY",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kX [ 0 ] = kX [ 1 ] = kX [ 2 ] = clamp ( kW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; kY = kX [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",h:[{type:"node_in",name:"kZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"k_",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:["k_","=","kZ",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",g:[{type:"textline",b:"k_ = ( MAPPING_TRS_MATRIX * vec4 ( k_ , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",g:[{type:"textline",b:"k_ = k_ * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",g:[{type:"textline",b:"k_ = k_ + MAPPING_TRANSLATION ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",g:[{type:"textline",b:"k_ = max ( k_ , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",g:[{type:"textline",b:"k_ = min ( k_ , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],g:[{type:"textline",b:"k_ = normalize ( k_ ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",h:[{type:"node_in",name:"la",qualifier:["float"],
e:!1},{type:"node_in",name:"lb",qualifier:["float"],e:!1},{type:"node_out",name:"lc",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lc = la + lb ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lc = clamp ( lc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",h:[{type:"node_in",name:"ld",qualifier:["float"],e:!1},{type:"node_in",name:"le",qualifier:["float"],e:!1},{type:"node_out",name:"lf",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"lf = ld - le ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lf = clamp ( lf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",h:[{type:"node_in",name:"lg",qualifier:["float"],e:!1},{type:"node_in",name:"lh",qualifier:["float"],e:!1},{type:"node_out",name:"li",qualifier:["float"],e:!1}],g:[{type:"textline",b:"li = lg * lh ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"li = clamp ( li , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",h:[{type:"node_in",name:"lj",qualifier:["float"],e:!1},{type:"node_in",name:"lk",qualifier:["float"],e:!1},{type:"node_out",name:"ll",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ll = ( lk != ZERO_VALUE_NODES ) ? lj / lk : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ll = clamp ( ll , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",h:[{type:"node_in",name:"lm",qualifier:["float"],e:!1},{type:"node_in",name:"ln",qualifier:["float"],e:!1},{type:"node_out",name:"lo",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lo = sin ( lm ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lo = clamp ( lo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["ln",";"]}]},{type:"node",name:"MATH_COSINE",h:[{type:"node_in",name:"lp",
qualifier:["float"],e:!1},{type:"node_in",name:"lq",qualifier:["float"],e:!1},{type:"node_out",name:"lr",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lr = cos ( lp ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lr = clamp ( lr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lq",";"]}]},{type:"node",name:"MATH_TANGENT",h:[{type:"node_in",name:"ls",qualifier:["float"],e:!1},{type:"node_in",name:"lt",qualifier:["float"],
e:!1},{type:"node_out",name:"lu",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lu = tan ( ls ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lu = clamp ( lu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lt",";"]}]},{type:"node",name:"MATH_ARCSINE",h:[{type:"node_in",name:"lv",qualifier:["float"],e:!1},{type:"node_in",name:"lw",qualifier:["float"],e:!1},{type:"node_out",name:"lx",qualifier:["float"],e:!1}],
g:[{type:"textline",b:"lx = ( lv <= UNITY_VALUE_NODES && lv >= - UNITY_VALUE_NODES ) ? asin ( lv ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lx = clamp ( lx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lw",";"]}]},{type:"node",name:"MATH_ARCCOSINE",h:[{type:"node_in",name:"ly",qualifier:["float"],e:!1},{type:"node_in",name:"lz",qualifier:["float"],e:!1},{type:"node_out",name:"lA",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"lA = ( ly <= UNITY_VALUE_NODES && ly >= - UNITY_VALUE_NODES ) ? acos ( ly ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lA = clamp ( lA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lz",";"]}]},{type:"node",name:"MATH_ARCTANGENT",h:[{type:"node_in",name:"lB",qualifier:["float"],e:!1},{type:"node_in",name:"lC",qualifier:["float"],e:!1},{type:"node_out",name:"lD",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"lD = atan ( lB ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lD = clamp ( lD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lC",";"]}]},{type:"node",name:"MATH_POWER",h:[{type:"node_in",name:"lE",qualifier:["float"],e:!1},{type:"node_in",name:"lF",qualifier:["float"],e:!1},{type:"node_out",name:"lG",qualifier:["float"],e:!1}],g:[{type:"textline",b:"if ( lE < ZERO_VALUE_NODES || lE == ZERO_VALUE_NODES && lF == ZERO_VALUE_NODES ) lG = ZERO_VALUE_NODES ; else lG = pow ( lE , lF ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lG = clamp ( lG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",h:[{type:"node_in",name:"lH",qualifier:["float"],e:!1},{type:"node_in",name:"lI",qualifier:["float"],e:!1},{type:"node_out",name:"lJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lJ = ( lH > ZERO_VALUE_NODES && lI > ZERO_VALUE_NODES ) ? log2 ( lH ) / log2 ( lI ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lJ = clamp ( lJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",h:[{type:"node_in",name:"lK",qualifier:["float"],e:!1},{type:"node_in",name:"lL",qualifier:["float"],e:!1},{type:"node_out",name:"lM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lM = min ( lK , lL ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lM = clamp ( lM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",h:[{type:"node_in",name:"lN",qualifier:["float"],e:!1},{type:"node_in",name:"lO",qualifier:["float"],e:!1},{type:"node_out",name:"lP",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lP = max ( lN , lO ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lP = clamp ( lP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",h:[{type:"node_in",name:"lQ",qualifier:["float"],e:!1},
{type:"node_in",name:"lR",qualifier:["float"],e:!1},{type:"node_out",name:"lS",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lS = floor ( lQ + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lS = clamp ( lS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lR",";"]}]},{type:"node",name:"MATH_LESS_THAN",h:[{type:"node_in",name:"lT",qualifier:["float"],e:!1},{type:"node_in",name:"lU",qualifier:["float"],e:!1},
{type:"node_out",name:"lV",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lV = ( lT < lU ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lV = clamp ( lV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",h:[{type:"node_in",name:"lW",qualifier:["float"],e:!1},{type:"node_in",name:"lX",qualifier:["float"],e:!1},{type:"node_out",name:"lY",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"lY = ( lW > lX ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lY = clamp ( lY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",h:[{type:"node_in",name:"lZ",qualifier:["float"],e:!1},{type:"node_in",name:"l_",qualifier:["float"],e:!1},{type:"node_out",name:"ma",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ma = abs ( l_ ) > 0.000001 ? mod ( lZ , l_ ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ma = clamp ( ma , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",h:[{type:"node_in",name:"mb",qualifier:["float"],e:!1},{type:"node_in",name:"mc",qualifier:["float"],e:!1},{type:"node_out",name:"md",qualifier:["float"],e:!1}],g:[{type:"textline",b:"md = abs ( mb ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"md = clamp ( md , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mc",";"]}]},{type:"node",name:"MIX_RGB_MIX",h:[{type:"node_in",name:"me",qualifier:["float"],e:!1},{type:"node_in",name:"mf",qualifier:["vec3"],e:!1},{type:"node_in",name:"mg",qualifier:["vec3"],e:!1},{type:"node_out",name:"mh",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float mi = clamp ( me , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mh = mix ( mf , mg , mi ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mh = clamp ( mh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_ADD",h:[{type:"node_in",name:"mj",qualifier:["float"],e:!1},{type:"node_in",name:"mk",qualifier:["vec3"],e:!1},{type:"node_in",name:"ml",qualifier:["vec3"],e:!1},{type:"node_out",name:"mm",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float mn = clamp ( mj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mm = mix ( mk , mk + ml , mn ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mm = clamp ( mm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",h:[{type:"node_in",name:"mo",qualifier:["float"],e:!1},{type:"node_in",name:"mp",qualifier:["vec3"],e:!1},{type:"node_in",name:"mq",qualifier:["vec3"],e:!1},{type:"node_out",name:"mr",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float ms = clamp ( mo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mr = mix ( mp , mp * mq , ms ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mr = clamp ( mr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",h:[{type:"node_in",name:"mt",qualifier:["float"],e:!1},{type:"node_in",name:"mu",qualifier:["vec3"],e:!1},{type:"node_in",name:"mv",qualifier:["vec3"],e:!1},{type:"node_out",name:"mw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float mx = clamp ( mt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mw = mix ( mu , mu - mv , mx ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mw = clamp ( mw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",h:[{type:"node_in",name:"my",qualifier:["float"],e:!1},{type:"node_in",name:"mz",qualifier:["vec3"],e:!1},{type:"node_in",name:"mA",qualifier:["vec3"],e:!1},{type:"node_out",name:"mB",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float mC = clamp ( my , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float mD = UNITY_VALUE_NODES - mC ; mB = eO - ( vec3 ( mD ) + mC * ( eO - mA ) ) * ( eO - mz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],
g:[{type:"textline",b:"mB = clamp ( mB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",h:[{type:"node_in",name:"mE",qualifier:["float"],e:!1},{type:"node_in",name:"mF",qualifier:["vec3"],e:!1},{type:"node_in",name:"mG",qualifier:["vec3"],e:!1},{type:"node_out",name:"mH",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float mI = clamp ( mE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float mJ = UNITY_VALUE_NODES - mI ; mG += step ( mG , eN ) ; mH = mJ * mF + mI * mF / mG ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mH = clamp ( mH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",h:[{type:"node_in",name:"mK",qualifier:["float"],e:!1},{type:"node_in",name:"mL",qualifier:["vec3"],e:!1},{type:"node_in",name:"mM",qualifier:["vec3"],e:!1},{type:"node_out",name:"mN",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float mO = clamp ( mK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mN = mix ( mL , abs ( mL - mM ) , mO ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mN = clamp ( mN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",h:[{type:"node_in",name:"mP",qualifier:["float"],e:!1},{type:"node_in",name:"mQ",qualifier:["vec3"],e:!1},{type:"node_in",name:"mR",qualifier:["vec3"],e:!1},{type:"node_out",name:"mS",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float mT = clamp ( mP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mS = min ( mQ . rgb , mR . rgb * mT ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mS = clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",h:[{type:"node_in",name:"mU",qualifier:["float"],e:!1},{type:"node_in",name:"mV",qualifier:["vec3"],e:!1},{type:"node_in",name:"mW",qualifier:["vec3"],e:!1},{type:"node_out",name:"mX",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float mY = clamp ( mU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mX = max ( mV . rgb , mW . rgb * mY ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mX = clamp ( mX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",h:[{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_in",name:"m_",qualifier:["vec3"],e:!1},{type:"node_in",name:"na",qualifier:["vec3"],e:!1},{type:"node_out",name:"nb",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float nc = clamp ( mZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 nd = vec3 ( UNITY_VALUE_NODES - nc ) ; nb = mix ( m_ * ( nd + 2.0 * nc * na ) , eO - ( nd + 2.0 * nc * ( eO - na ) ) * ( eO - m_ ) , step ( 0.5 , m_ ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"nb = clamp ( nb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",h:[{type:"node_in",name:"ne",qualifier:["float"],e:!1},{type:"node_in",name:"nf",qualifier:["vec3"],e:!1},{type:"node_in",name:"ng",qualifier:["vec3"],e:!1},{type:"node_out",name:"nh",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float ni = clamp ( ne , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 nj = eO - ni * ng ; vec3 nk = clamp ( nf / nj , 0.0 , 1.0 ) ; nh = mix ( mix ( nk , eO , step ( nj , eN ) ) , nf , step ( nf , eN ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"nh = clamp ( nh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",h:[{type:"node_in",name:"nl",qualifier:["float"],e:!1},{type:"node_in",name:"nm",qualifier:["vec3"],e:!1},{type:"node_in",name:"nn",qualifier:["vec3"],e:!1},{type:"node_out",name:"no",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float np = clamp ( nl , 0.0 , 1.0 ) ; vec3 nq = vec3 ( 1.0 - np ) ; vec3 nr = nq + np * nn ; vec3 ns = clamp ( eO - ( eO - nm ) / nr , 0.0 , 1.0 ) ; no = mix ( ns , eN , step ( nr , eN ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"no = clamp ( no , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",h:[{type:"node_in",name:"nt",qualifier:["float"],e:!1},{type:"node_in",name:"nu",qualifier:["vec3"],e:!1},{type:"node_in",name:"nv",qualifier:["vec3"],e:!1},{type:"node_out",name:"nw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float nx = clamp ( nt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 ny , nz , nA ; nw = nu ; nz = eZ ( nv ) ; if ( nz . y != ZERO_VALUE_NODES ) { ny = eZ ( nw ) ; ny . x = nz . x ; nA = fc ( ny ) ; nw = mix ( nw , nA , nx ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"nw = clamp ( nw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",h:[{type:"node_in",name:"nB",qualifier:["float"],e:!1},{type:"node_in",name:"nC",qualifier:["vec3"],e:!1},{type:"node_in",name:"nD",qualifier:["vec3"],e:!1},{type:"node_out",name:"nE",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float nF = clamp ( nB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float nG = UNITY_VALUE_NODES - nF ; nE = nC ; vec3 nH , nI ; nH = eZ ( nE ) ; if ( nH . y != ZERO_VALUE_NODES ) { nI = eZ ( nD ) ; nH . y = nG * nH . y + nF * nI . y ; nE = fc ( nH ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"nE = clamp ( nE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",h:[{type:"node_in",name:"nJ",qualifier:["float"],e:!1},{type:"node_in",name:"nK",qualifier:["vec3"],e:!1},{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_out",name:"nM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float nN = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float nO = UNITY_VALUE_NODES - nN ; vec3 nP , nQ ; nP = eZ ( nK ) ; nQ = eZ ( nL ) ; nP . z = nO * nP . z + nN * nQ . z ; nM = fc ( nP ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"nM = clamp ( nM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",h:[{type:"node_in",name:"nR",qualifier:["float"],e:!1},{type:"node_in",name:"nS",qualifier:["vec3"],e:!1},{type:"node_in",name:"nT",qualifier:["vec3"],e:!1},{type:"node_out",name:"nU",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float nV = clamp ( nR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 nW , nX , nY ; nU = nS ; nX = eZ ( nT ) ; if ( nX . y != ZERO_VALUE_NODES ) { nW = eZ ( nU ) ; nW . x = nX . x ; nW . y = nX . y ; nY = fc ( nW ) ; nU = mix ( nU , nY , nV ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"nU = clamp ( nU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",h:[{type:"node_in",name:"nZ",qualifier:["float"],e:!1},{type:"node_in",name:"n_",qualifier:["vec3"],e:!1},{type:"node_in",name:"oa",qualifier:["vec3"],e:!1},{type:"node_out",name:"ob",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float oc = clamp ( nZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float od = UNITY_VALUE_NODES - oc ; vec3 oe = oa + n_ - oa * n_ ; ob = n_ * ( vec3 ( od ) + vec3 ( oc ) * ( ( eO - n_ ) * oa + oe ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"ob = clamp ( ob , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",h:[{type:"node_in",name:"of",qualifier:["float"],e:!1},{type:"node_in",name:"og",qualifier:["vec3"],e:!1},{type:"node_in",name:"oh",qualifier:["vec3"],e:!1},{type:"node_out",name:"oi",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"float oj = clamp ( of , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oi = og + oj * ( 2.0 * oh - eO ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"oi = clamp ( oi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",h:[{type:"node_in",name:"ok",qualifier:["vec3"],e:!1},{type:"node_in",name:"ol",qualifier:["float"],e:!1}],g:[{type:"textline",b:"fv = ok ; fz = ol ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",h:[{type:"node_in",name:"om",qualifier:["vec3"],e:!1},{type:"node_in",name:"on",qualifier:["vec3"],e:!1},{type:"node_in",
name:"oo",qualifier:["float"],e:!1},{type:"node_in",name:"op",qualifier:["vec3"],e:!0},{type:"node_in",name:"oq",qualifier:["float"],e:!0},{type:"node_out",name:"or",qualifier:["vec3"],e:!1},{type:"node_out",name:"os",qualifier:["vec3"],e:!1},{type:"node_out",name:"ot",qualifier:["vec3"],e:!1},{type:"node_out",name:"ou",qualifier:["vec3"],e:!1},{type:"node_out",name:"ov",qualifier:["vec3"],e:!1},{type:"node_out",name:"ow",qualifier:["vec2"],e:!1},{type:"node_out",name:"ox",qualifier:["vec2"],e:!1},
{type:"node_out",name:"oy",qualifier:["float"],e:!1},{type:"node_param",name:"fq",qualifier:["const","vec2"]},{type:"node_param",name:"fr",qualifier:["const","vec3"]}],g:[{type:"textline",b:"ot = clamp ( om , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"ou = fr [ 0 ] * clamp ( on , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",b:"ov = normalize ( op ) ;".split(" ")}]},{type:"node_else",
g:[{type:"textline",b:["ov","=","fC",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],g:[{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"textline",b:"or = oq * ot ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"or = fJ * ot ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["ot",
"*=","oo",";"]}]}]},{type:"textline",b:"os = fK * u_environment_energy * ew ( ov ) ; oy = dY ( ot ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"ow = vec2 ( fq [ 0 ] , fq [ 1 ] ) ;".split(" ")},{type:"textline",b:"ox = vec2 ( fr [ 1 ] , fr [ 2 ] ) ;".split(" ")}]}]},{type:"textline",b:["fy","=","oy",";"]}]},{type:"node_else",g:[{type:"textline",b:"or = eN ; os = eO ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",h:[{type:"node_in",
name:"oz",qualifier:["vec4"],e:!1},{type:"node_in",name:"oA",qualifier:["vec3"],e:!1},{type:"node_in",name:"oB",qualifier:["vec3"],e:!1},{type:"node_in",name:"oC",qualifier:["float"],e:!0},{type:"node_in",name:"oD",qualifier:["float"],e:!0},{type:"node_in",name:"oE",qualifier:["float"],e:!0},{type:"node_out",name:"oF",qualifier:["vec3"],e:!0},{type:"node_out",name:"oG",qualifier:["float"],e:!0},{type:"node_out",name:"oH",qualifier:["vec3"],e:!0},{type:"node_out",name:"oI",qualifier:["vec3"],e:!0},
{type:"node_out",name:"oJ",qualifier:["vec3"],e:!0},{type:"node_param",name:"fs",qualifier:["float"]},{type:"node_param",name:"ft",qualifier:["float"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oF"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"oF = oz . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["oF","=","eN",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",
d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"et ( oF , fu , oB , oC ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["oF","+=","oA",";"]}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oH"],g:[{type:"textline",b:["oH","=","oB",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oI"],g:[{type:"textline",b:"oI = oz . rgb ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oJ"],g:[{type:"textline",b:["oJ","=","oA",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oG"],g:[{type:"textline",b:"oG = clamp ( oE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"float oK = max ( max ( oA . r , oA . g ) , oA . b ) * oD ; oG = clamp ( oE * ( UNITY_VALUE_NODES - oK ) + oK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},
{type:"node_else",g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oG"],g:[{type:"textline",b:"oG = clamp ( fs , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"float oK = max ( max ( oA . r , oA . g ) , oA . b ) * ft ; oG = fs * ( UNITY_VALUE_NODES - oK ) + oK ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["fw","=","oA",
";"]}]},{type:"node_else",g:[{type:"textline",b:["fw","=","eN",";"]}]}]},{type:"textline",b:["fx","=","oB",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"oL",qualifier:["vec3"],e:!1},{type:"node_in",name:"oM",qualifier:["vec3"],e:!1},{type:"node_in",name:"oN",qualifier:["vec3"],e:!1},{type:"node_out",name:"oO",qualifier:["vec4"],e:!1},{type:"node_out",name:"oP",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"oO = vec4 ( oL + oN * oM , ZERO_VALUE_NODES ) ; oP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"oQ",qualifier:["float"],e:!1},{type:"node_out",name:"oR",qualifier:["vec3"],e:!1},{type:"node_out",name:"oS",qualifier:["vec2"],e:!1},{type:"node_out",name:"oT",qualifier:["vec3"],e:!1},{type:"node_out",name:"oU",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1},"NUM_LIGHTS",0,{type:"g_expr",d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"oS = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["oU","=","eM",";"]}]},{type:"node_else",g:[{type:"textline",b:["oU","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",b:"oT = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) oT *= oQ ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",
b:"vec3 oV = u_light_positions [ LAMP_IND ] ; oR = oV - fH ;".split(" ")},{type:"textline",b:"float oW = length ( oR ) ; oT *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + oW * oW ) ; oR = normalize ( oR ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"vec3 oX = u_light_directions [ LAMP_IND ] ; float oY = dot ( oR , oX ) ; oY *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( oY - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; oT *= oY ;".split(" ")}]}]}]},
{type:"node_else",g:[{type:"textline",b:"oR = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"oZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"o_",qualifier:["vec2"],e:!1},{type:"node_in",name:"pa",qualifier:["vec3"],e:!1},{type:"node_in",name:"pb",qualifier:["float"],e:!1},{type:"node_in",name:"pc",qualifier:["vec2"],e:!1},{type:"node_out",name:"pd",qualifier:["float"],e:!1}],g:[{type:"textline",b:"pd = ZERO_VALUE_NODES ; if ( o_ . r != ZERO_VALUE_NODES ) { float pe = ( UNITY_VALUE_NODES - pb ) * dot ( pa , oZ ) + pb ; if ( pc [ 0 ] == ZERO_VALUE_NODES ) { pd = UNITY_VALUE_NODES ; } else { float pf = UNITY_VALUE_NODES + abs ( pe ) ; pf = pc [ 1 ] + ( UNITY_VALUE_NODES - pc [ 1 ] ) * pow ( pf , pc [ 0 ] ) ; pd = clamp ( pf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } pd = max ( pd , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"pg",qualifier:["vec3"],e:!1},{type:"node_in",name:"ph",qualifier:["vec2"],e:!1},{type:"node_in",name:"pi",qualifier:["vec3"],e:!1},{type:"node_in",name:"pj",qualifier:["float"],e:!1},{type:"node_out",name:"pk",qualifier:["float"],e:!1}],g:[{type:"textline",b:"pk = ZERO_VALUE_NODES ; if ( ph . r != ZERO_VALUE_NODES ) { float pl = ( UNITY_VALUE_NODES - pj ) * dot ( pi , pg ) + pj ; pk = max ( pl , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"pm",qualifier:["vec3"],e:!1},{type:"node_in",name:"pn",qualifier:["vec2"],e:!1},{type:"node_in",name:"po",qualifier:["vec3"],e:!1},{type:"node_in",name:"pp",qualifier:["float"],e:!1},{type:"node_in",name:"pq",qualifier:["vec2"],e:!1},{type:"node_out",name:"pr",qualifier:["float"],e:!1}],g:[{type:"textline",b:"pr = ZERO_VALUE_NODES ; if ( pn . r != ZERO_VALUE_NODES ) { float ps = ( UNITY_VALUE_NODES - pp ) * dot ( po , pm ) + pp ; if ( pq [ 0 ] > ZERO_VALUE_NODES ) { float pt = max ( dot ( po , fu ) , ZERO_VALUE_NODES ) ; float pu = pq [ 0 ] * pq [ 0 ] ; float pv = UNITY_VALUE_NODES - eM * ( pu / ( pu + 0.33 ) ) ; vec3 pw = pm - ps * po ; vec3 px = fu - pt * po ;".split(" ")},
{type:"textline",b:"if ( length ( pw ) == ZERO_VALUE_NODES || length ( px ) == ZERO_VALUE_NODES || abs ( ps ) > UNITY_VALUE_NODES || abs ( pt ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",b:"pr = ps * pv ; else { float py = acos ( ps ) ; float pz = acos ( pt ) ; vec3 pA = normalize ( pw ) ; vec3 pB = normalize ( px ) ; float pC , pD ; pC = max ( py , pz ) ; pD = min ( py , pz ) ; pD *= 0.95 ; float pE = max ( dot ( pA , pB ) , ZERO_VALUE_NODES ) ; float pF = 0.45 * ( pu / ( pu + 0.09 ) ) ; pr = ps * ( pv + ( pF * pE * sin ( pC ) * tan ( pD ) ) ) ; } } else pr = ps ; pr = max ( pr , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"pG",qualifier:["vec3"],e:!1},{type:"node_in",name:"pH",qualifier:["vec2"],e:!1},{type:"node_in",name:"pI",qualifier:["vec3"],e:!1},{type:"node_in",name:"pJ",qualifier:["float"],e:!1},{type:"node_in",name:"pK",qualifier:["vec2"],e:!1},{type:"node_out",name:"pL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"pL = ZERO_VALUE_NODES ; if ( pH . r != ZERO_VALUE_NODES ) { float pM = ( UNITY_VALUE_NODES - pJ ) * dot ( pI , pG ) + pJ ; float pN = max ( dot ( pI , fu ) , ZERO_VALUE_NODES ) ; if ( pK [ 0 ] <= UNITY_VALUE_NODES ) pL = pM * pow ( max ( pN * pM , 0.1 ) , pK [ 0 ] - UNITY_VALUE_NODES ) ; else pL = pM * pow ( 1.0001 - pN , pK [ 0 ] - UNITY_VALUE_NODES ) ; pL = max ( pL , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"pO",qualifier:["vec3"],e:!1},{type:"node_in",name:"pP",qualifier:["vec2"],e:!1},{type:"node_in",name:"pQ",qualifier:["vec3"],e:!1},{type:"node_in",name:"pR",qualifier:["float"],e:!1},{type:"node_in",name:"pS",qualifier:["vec2"],e:!1},{type:"node_out",name:"pT",qualifier:["float"],e:!1}],g:[{type:"textline",b:"pT = ZERO_VALUE_NODES ; if ( pP . r != ZERO_VALUE_NODES ) { float pU = ( UNITY_VALUE_NODES - pR ) * dot ( pQ , pO ) + pR ; float pV = acos ( pU ) ; if ( pV < pS [ 0 ] ) pT = UNITY_VALUE_NODES ; else if ( pV > ( pS [ 0 ] + pS [ 1 ] ) || pS [ 1 ] == ZERO_VALUE_NODES ) pT = ZERO_VALUE_NODES ; else pT = UNITY_VALUE_NODES - ( ( pV - pS [ 0 ] ) / pS [ 1 ] ) ; pT = max ( pT , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"pW",qualifier:["vec3"],e:!1},{type:"node_in",name:"pX",qualifier:["vec2"],e:!1},{type:"node_in",name:"pY",qualifier:["vec3"],e:!1},{type:"node_in",name:"pZ",qualifier:["float"],e:!1},{type:"node_in",name:"p_",qualifier:["vec2"],e:!1},{type:"node_out",name:"qa",qualifier:["float"],e:!1}],g:[{type:"textline",b:"qa = ZERO_VALUE_NODES ; if ( pX . g == UNITY_VALUE_NODES ) { vec3 qb = normalize ( pW + fu ) ; qa = ( UNITY_VALUE_NODES - pZ ) * max ( dot ( pY , qb ) , ZERO_VALUE_NODES ) + pZ ; qa = pow ( qa , p_ [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"qc",qualifier:["vec3"],e:!1},{type:"node_in",name:"qd",qualifier:["vec2"],e:!1},{type:"node_in",name:"qe",qualifier:["vec3"],e:!1},{type:"node_in",name:"qf",qualifier:["vec2"],e:!1},{type:"node_out",name:"qg",qualifier:["float"],e:!1}],g:[{type:"textline",b:"qg = ZERO_VALUE_NODES ; if ( qd . g == UNITY_VALUE_NODES ) { vec3 qh = normalize ( qc + fu ) ; float qi = max ( dot ( qe , qh ) , 0.001 ) ;".split(" ")},{type:"textline",b:"float qj = max ( dot ( qe , fu ) , 0.01 ) ; float qk = max ( dot ( qe , qc ) , 0.01 ) ; float ql = tan ( acos ( qi ) ) ; float qm = max ( qf [ 0 ] , 0.001 ) ; qg = qk * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * qm * qm ) ) * ( exp ( - ( ql * ql ) / ( qm * qm ) ) / ( sqrt ( qj * qk ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"qn",qualifier:["vec3"],e:!1},{type:"node_in",name:"qo",qualifier:["vec2"],e:!1},{type:"node_in",name:"qp",qualifier:["vec3"],e:!1},{type:"node_in",name:"qq",qualifier:["vec2"],e:!1},{type:"node_out",name:"qr",qualifier:["float"],e:!1}],g:[{type:"textline",b:"qr = ZERO_VALUE_NODES ; if ( qo . g == UNITY_VALUE_NODES ) { vec3 qs = normalize ( qn + fu ) ; float qt = acos ( dot ( qs , qp ) ) ; if ( qt < qq [ 0 ] ) qr = UNITY_VALUE_NODES ; else if ( qt >= qq [ 0 ] + qq [ 1 ] || qq [ 1 ] == ZERO_VALUE_NODES ) qr = ZERO_VALUE_NODES ; else qr = UNITY_VALUE_NODES - ( qt - qq [ 0 ] ) / qq [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"qu",qualifier:["vec3"],e:!1},{type:"node_in",name:"qv",qualifier:["vec2"],e:!1},{type:"node_in",name:"qw",qualifier:["vec3"],e:!1},{type:"node_in",name:"qx",qualifier:["float"],e:!1},{type:"node_in",name:"qy",qualifier:["vec2"],e:!1},{type:"node_out",name:"qz",qualifier:["float"],e:!1}],g:[{type:"textline",b:"qz = ZERO_VALUE_NODES ; if ( qv . g == UNITY_VALUE_NODES ) { if ( qy [ 0 ] < 1.0 || qy [ 1 ] == ZERO_VALUE_NODES ) qz = ZERO_VALUE_NODES ; else { if ( qy [ 1 ] < 100.0 ) qy [ 1 ] = sqrt ( 1.0 / qy [ 1 ] ) ; else qy [ 1 ] = 10.0 / qy [ 1 ] ; vec3 qA = normalize ( fu + qu ) ; float qB = ( UNITY_VALUE_NODES - qx ) * max ( dot ( qw , qA ) , ZERO_VALUE_NODES ) + qx ; if ( qB < ZERO_VALUE_NODES ) qz = ZERO_VALUE_NODES ; else { float qC = max ( dot ( qw , fu ) , 0.01 ) ; float qD = dot ( qw , qu ) ; if ( qD <= 0.01 ) qz = ZERO_VALUE_NODES ; else { float qE = max ( dot ( fu , qA ) , 0.01 ) ; float qF = UNITY_VALUE_NODES ; float qG = ( 2.0 * qB * qC ) / qE ; float qH = ( 2.0 * qB * qD ) / qE ; float qI = min ( min ( qF , qG ) , qH ) ; float qJ = sqrt ( pow ( qy [ 0 ] , 2.0 ) + pow ( qE , 2.0 ) - UNITY_VALUE_NODES ) ; float qK = pow ( qJ - qE , 2.0 ) / pow ( qJ + qE , 2.0 ) * ( UNITY_VALUE_NODES + pow ( qE * ( qJ + qE ) - UNITY_VALUE_NODES , 2.0 ) / pow ( qE * ( qJ - qE ) + UNITY_VALUE_NODES , 2.0 ) ) ; float qL = acos ( qB ) ; qz = max ( qK * qI * exp ( - pow ( qL , 2.0 ) / ( 2.0 * pow ( qy [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"qM",qualifier:["vec4"],e:!1},{type:"node_in",name:"qN",qualifier:["vec3"],e:!1},{type:"node_in",name:"qO",qualifier:["float"],e:!1},{type:"node_in",name:"qP",qualifier:["float"],e:!1},{type:"node_in",name:"qQ",qualifier:["vec3"],e:!1},{type:"node_in",name:"qR",qualifier:["vec3"],e:!1},{type:"node_in",name:"qS",qualifier:["vec4"],e:!1},{type:"node_in",name:"qT",qualifier:["vec3"],e:!1},{type:"node_in",name:"qU",qualifier:["vec3"],e:!1},{type:"node_in",
name:"qV",qualifier:["vec3"],e:!1},{type:"node_in",name:"qW",qualifier:["float"],e:!1},{type:"node_out",name:"qX",qualifier:["vec4"],e:!1},{type:"node_out",name:"qY",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_NODE_B4W_TRANSLUCENCY"],g:[{type:"textline",b:"if ( dot ( qQ , qR ) * dot ( fu , qR ) < ZERO_VALUE_NODES ) { float qZ = qS . x ; float q_ = qS . y ; float ra = qS . z ; float rb = qS . w ;".split(" ")},{type:"textline",b:"float rc = clamp ( abs ( dot ( qQ , qR ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float rd = clamp ( dot ( fu , - qQ ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float re = pow ( rd , q_ ) ;".split(" ")},
{type:"textline",b:"qX = qM + qW * vec4 ( qV * rc * pow ( qT , vec3 ( qZ ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"qX += ra * mix ( vec4 ( qT , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , rb ) * qW * vec4 ( qV * rc * vec3 ( re ) , UNITY_VALUE_NODES ) ; qY = qN ; } else {".split(" ")},{type:"textline",b:"qY = qN + qV * qU * qP ; qX = qM + vec4 ( qV * qT * qO , qP ) ; }".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"qY = qN + qV * qU * qP ; qX = qM + vec4 ( qV * qT * qO , qP ) ;".split(" ")}]}]}]},
{type:"node",name:"RGB",h:[{type:"node_out",name:"rf",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"rf = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",h:[{type:"node_in",name:"rg",qualifier:["vec3"],e:!1},{type:"node_out",name:"rh",qualifier:["float"],e:!1}],g:[{type:"textline",b:"rh = dot ( rg , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",h:[{type:"node_in",name:"ri",qualifier:["vec3"],e:!1},{type:"node_out",name:"rj",qualifier:["float"],e:!0},
{type:"node_out",name:"rk",qualifier:["float"],e:!0},{type:"node_out",name:"rl",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rj"],g:[{type:"textline",b:"rj = ri . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rk"],g:[{type:"textline",b:"rk = ri . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rl"],g:[{type:"textline",b:"rl = ri . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",h:[{type:"node_in",name:"rm",
qualifier:["vec3"],e:!1},{type:"node_out",name:"rn",qualifier:["float"],e:!0},{type:"node_out",name:"ro",qualifier:["float"],e:!0},{type:"node_out",name:"rp",qualifier:["float"],e:!0}],g:[{type:"textline",b:"vec3 rq = eZ ( rm ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rn"],g:[{type:"textline",b:"rn = rq . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ro"],g:[{type:"textline",b:"ro = rq . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_rp"],g:[{type:"textline",b:"rp = rq . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",h:[{type:"node_in",name:"rr",qualifier:["float"],e:!1},{type:"node_in",name:"rs",qualifier:["float"],e:!1},{type:"node_in",name:"rt",qualifier:["float"],e:!1},{type:"node_out",name:"ru",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ru = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rr - rt ) * rs ) ) ) ;".split(" ")}]},{type:"node",name:"GAMMA",h:[{type:"node_in",name:"rv",
qualifier:["vec3"],e:!1},{type:"node_in",name:"rw",qualifier:["float"],e:!1},{type:"node_out",name:"rx",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"rx = max ( eN , rv ) ; rx = pow ( rx , vec3 ( rw ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",h:[{type:"node_in",name:"ry",qualifier:["vec3"],e:!1},{type:"node_out",name:"rz",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"rz = max ( eN , ry ) ; rz = pow ( rz , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",
h:[{type:"node_in",name:"rA",qualifier:["vec3"],e:!1},{type:"node_out",name:"rB",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"rB = max ( eN , rA ) ; rB = pow ( rB , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",h:[{type:"node_out",name:"rC",qualifier:["vec3"],e:!1},{type:"node_out",name:"rD",qualifier:["vec3"],e:!1},{type:"node_out",name:"rE",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rE"],g:[{type:"textline",b:"rC [ 2 ] = rC [ 1 ] = rC [ 0 ] = 0.0 ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rE"],g:[{type:"textline",b:"rD [ 2 ] = rD [ 1 ] = rD [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rE"],g:[{type:"textline",b:["rE","=","0.0",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",h:[{type:"node_in",name:"rF",qualifier:["vec3"],e:!1},{type:"node_out",name:"rG",qualifier:["vec3"],e:!0},{type:"node_out",name:"rH",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",
qualifier:["uniform","samplerCube"]}],g:[{type:"textline",b:"vec4 rI = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , rF ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rG"],g:[{type:"textline",b:"rG = rI . xyz ; a_ ( rG ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rH"],g:[{type:"textline",b:"rH = rI . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",h:[{type:"node_in",name:"rJ",qualifier:["vec3"],e:!0},{type:"node_in",name:"rK",qualifier:["vec3"],
e:!0},{type:"node_in",name:"rL",qualifier:["vec3"],e:!0},{type:"node_in",name:"rM",qualifier:["vec3"],e:!0},{type:"node_out",name:"rN",qualifier:["vec3"],e:!0},{type:"node_out",name:"rO",qualifier:["float"],e:!0},{type:"node_out",name:"rP",qualifier:["vec3"],e:!0},{type:"node_out",name:"rQ",qualifier:["float"],e:!0},{type:"node_out",name:"rR",qualifier:["vec3"],e:!0},{type:"node_out",name:"rS",qualifier:["float"],e:!0},{type:"node_out",name:"rT",qualifier:["vec3"],e:!0},{type:"node_out",name:"rU",
qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"vec4 rV = texture2D ( node_TEXTURE_COLOR_var_texture , fg ( rJ ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rN"],g:[{type:"textline",b:"rN = rV . xyz ; a_ ( rN ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rO"],g:[{type:"textline",b:"rO = rV . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_uv2"],g:[{type:"textline",b:"rV = texture2D ( node_TEXTURE_COLOR_var_texture , fg ( rK ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rP"],g:[{type:"textline",b:"rP = rV . xyz ; a_ ( rP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rQ"],g:[{type:"textline",b:"rQ = rV . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"rV = texture2D ( node_TEXTURE_COLOR_var_texture , fg ( rL ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rR"],g:[{type:"textline",b:"rR = rV . xyz ; a_ ( rR ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rS"],g:[{type:"textline",b:"rS = rV . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"rV = texture2D ( node_TEXTURE_COLOR_var_texture , fg ( rM ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rT"],g:[{type:"textline",b:"rT = rV . xyz ; a_ ( rT ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rU"],g:[{type:"textline",b:"rU = rV . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",h:[{type:"node_in",name:"rW",qualifier:["vec3"],e:!0},{type:"node_in",name:"rX",qualifier:["vec3"],e:!0},{type:"node_in",name:"rY",qualifier:["vec3"],e:!0},{type:"node_in",name:"rZ",qualifier:["vec3"],e:!0},{type:"node_out",name:"r_",qualifier:["vec3"],e:!0},{type:"node_out",name:"sa",qualifier:["float"],e:!0},{type:"node_out",name:"sb",qualifier:["vec3"],
e:!0},{type:"node_out",name:"sc",qualifier:["float"],e:!0},{type:"node_out",name:"sd",qualifier:["vec3"],e:!0},{type:"node_out",name:"se",qualifier:["float"],e:!0},{type:"node_out",name:"sf",qualifier:["vec3"],e:!0},{type:"node_out",name:"sg",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"vec4 sh = texture2D ( node_TEXTURE_NORMAL_var_texture , fg ( rW ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_r_"],g:[{type:"textline",b:"r_ = normalize ( fG * ( sh . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sa"],g:[{type:"textline",b:"sa = sh . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"sh = texture2D ( node_TEXTURE_NORMAL_var_texture , fg ( rX ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sb"],g:[{type:"textline",b:"sb = normalize ( fG * ( sh . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sc"],g:[{type:"textline",b:"sc = sh . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"sh = texture2D ( node_TEXTURE_NORMAL_var_texture , fg ( rY ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sd"],g:[{type:"textline",b:"sd = normalize ( fG * ( sh . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_se"],g:[{type:"textline",b:"se = sh . w ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"sh = texture2D ( node_TEXTURE_NORMAL_var_texture , fg ( rZ ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sf"],g:[{type:"textline",b:"sf = normalize ( fG * ( sh . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sg"],g:[{type:"textline",b:"sg = sh . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",h:[{type:"node_out",name:"si",qualifier:["float"],e:!1}],
g:[{type:"textline",b:"si = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",h:[{type:"node_in",name:"sj",qualifier:["vec3"],e:!1},{type:"node_in",name:"sk",qualifier:["vec3"],e:!1},{type:"node_out",name:"sl",qualifier:["vec3"],e:!1},{type:"node_out",name:"sm",qualifier:["float"],e:!0}],g:[{type:"textline",b:"sl = sj + sk ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sm"],g:[{type:"textline",b:"sm = ( abs ( sl [ 0 ] ) + abs ( sl [ 1 ] ) + abs ( sl [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",h:[{type:"node_in",name:"sn",qualifier:["vec3"],e:!1},{type:"node_in",name:"so",qualifier:["vec3"],e:!1},{type:"node_out",name:"sp",qualifier:["vec3"],e:!1},{type:"node_out",name:"sq",qualifier:["float"],e:!0}],g:[{type:"textline",b:"sp = sn - so ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sq"],g:[{type:"textline",b:"sq = ( abs ( sp [ 0 ] ) + abs ( sp [ 1 ] ) + abs ( sp [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",
h:[{type:"node_in",name:"sr",qualifier:["vec3"],e:!1},{type:"node_in",name:"ss",qualifier:["vec3"],e:!1},{type:"node_out",name:"st",qualifier:["vec3"],e:!1},{type:"node_out",name:"su",qualifier:["float"],e:!0}],g:[{type:"textline",b:"st = sr + ss ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_su"],g:[{type:"textline",b:"su = length ( st ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_st"],g:[{type:"textline",b:"st = normalize ( st ) ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_DOT_PRODUCT",h:[{type:"node_in",name:"sv",qualifier:["vec3"],e:!1},{type:"node_in",name:"sw",qualifier:["vec3"],e:!1},{type:"node_out",name:"sx",qualifier:["vec3"],e:!1},{type:"node_out",name:"sy",qualifier:["float"],e:!0}],g:[{type:"textline",b:["sx","=","eN",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sy"],g:[{type:"textline",b:"sy = dot ( sv , sw ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",h:[{type:"node_in",name:"sz",qualifier:["vec3"],
e:!1},{type:"node_in",name:"sA",qualifier:["vec3"],e:!1},{type:"node_out",name:"sB",qualifier:["vec3"],e:!1},{type:"node_out",name:"sC",qualifier:["float"],e:!0}],g:[{type:"textline",b:"sB = cross ( sz , sA ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sC"],g:[{type:"textline",b:"sC = length ( sB ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",h:[{type:"node_in",name:"sD",qualifier:["vec3"],e:!1},{type:"node_in",name:"sE",qualifier:["vec3"],e:!1},{type:"node_out",
name:"sF",qualifier:["vec3"],e:!1},{type:"node_out",name:"sG",qualifier:["float"],e:!0}],g:[{type:"textline",b:"sF = normalize ( sD ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sG"],g:[{type:"textline",b:"sG = length ( sD ) ;".split(" ")}]}]},{type:"textline",b:["sE",";"]}]},{type:"node",name:"B4W_REFLECT",h:[{type:"node_in",name:"sH",qualifier:["vec3"],e:!1},{type:"node_in",name:"sI",qualifier:["vec3"],e:!1},{type:"node_out",name:"sJ",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"sJ = reflect ( - sH , sI ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",h:[{type:"node_in",name:"sK",qualifier:["vec3"],e:!1},{type:"node_in",name:"sL",qualifier:["float"],e:!1},{type:"node_in",name:"sM",qualifier:["const","float"],e:!1},{type:"node_in",name:"sN",qualifier:["const","float"],e:!1},{type:"node_out",name:"sO",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"float sP = length ( fI ) ; if ( sP < sN ) { vec2 sQ = fg ( sK ) ; float sR = clamp ( 0.5 * ( sN - sP ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float sS = sL * sR ;".split(" ")},
{type:"textline",b:"vec3 sT = normalize ( fu * fG ) ;".split(" ")},{type:"textline",b:"float sU = UNITY_VALUE_NODES / sM ;".split(" ")},{type:"textline",b:"vec2 sV = sT . xy * sS / ( sM * sT . z ) ; float sW = UNITY_VALUE_NODES ; float sX = texture2D ( node_B4W_PARALLAX_var_texture , sQ ) . a ;".split(" ")},{type:"textline",b:"for ( float sY = 1.0 ; sY <= sM ; sY ++ ) { if ( sX < sW ) { sW -= sU ; sQ -= sV ; sX = texture2D ( node_B4W_PARALLAX_var_texture , sQ ) . a ; } }".split(" ")},{type:"textline",
b:"vec2 sZ = sQ + sV ; float s_ = texture2D ( node_B4W_PARALLAX_var_texture , sZ ) . a - ( sW + sU ) ; float ta = sX - sW ; float tb = ta / ( ta - s_ ) ;".split(" ")},{type:"textline",b:"sQ = tb * sZ + ( UNITY_VALUE_NODES - tb ) * sQ ; sO = fe ( sQ ) ; } else sO = sK ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",h:[{type:"node_in",name:"tc",qualifier:["vec3"],e:!1},{type:"node_out",name:"td",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"td = clamp ( tc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"B4W_REFRACTION",h:[{type:"node_in",name:"te",qualifier:["vec3"],e:!1},{type:"node_in",name:"tf",qualifier:["float"],e:!1},{type:"node_out",name:"tg",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"tg = eS ( te , tf ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",h:[{type:"node_in",name:"th",qualifier:["float"],e:!1},{type:"node_in",name:"ti",qualifier:["float"],e:!1},{type:"node_in",name:"tj",qualifier:["float"],e:!1},{type:"node_in",name:"tk",qualifier:["float"],e:!1},
{type:"node_in",name:"tl",qualifier:["float"],e:!1},{type:"node_out",name:"tm",qualifier:["float"],e:!0},{type:"node_out",name:"tn",qualifier:["vec4"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tm"],g:[{type:"textline",b:["tm","=","th",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tn"],g:[{type:"textline",b:"tn = vec4 ( ti , tj , tk , tl ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",h:[{type:"node_out",name:"to",qualifier:["float"],e:!1}],g:[{type:"textline",
b:["to","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",h:[{type:"node_in",name:"tp",qualifier:["float"],e:!1},{type:"node_in",name:"tq",qualifier:["float"],e:!1},{type:"node_in",name:"tr",qualifier:["float"],e:!1},{type:"node_out",name:"ts",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ts = smoothstep ( tq , tr , tp ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",h:[{type:"node_in",name:"tt",qualifier:["vec3"],e:!1},{type:"node_in",name:"tu",qualifier:["float"],e:!1}],g:[{type:"textline",
b:"fv = tt ; fz = tu ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",h:[{type:"node_in",name:"tv",qualifier:["vec3"],e:!1},{type:"node_out",name:"tw",qualifier:["float"],e:!1}],g:[{type:"textline",b:"tw = ( tv . r + tv . g + tv . b ) / 3.0 ;".split(" ")}]},{type:"node",name:"B4W_SCALTOVEC",h:[{type:"node_in",name:"tx",qualifier:["float"],e:!1},{type:"node_out",name:"ty",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ty [ 0 ] = tx ; ty [ 1 ] = tx ; ty [ 2 ] = tx ;".split(" ")}]},{type:"nodes_global"},
{type:"textline",b:"void tz ( in vec3 fu , out vec3 fv , out vec3 fw , out vec3 fx , out float fy , out float fz ) { fv = eN ; fw = eN ; fx = eN ; fy = ZERO_VALUE_NODES ; fz = ZERO_VALUE_NODES ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"vec3 fA = normalize ( bS ) ; vec3 fB = fA ;".split(" ")},{type:"condition",a:[{type:"if",
c:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) fB = fB ; else fB = - fB ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:["vec3","fC","=","fB",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","fC","=","fA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",
b:["vec3","fD","=","fB",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 fE = cross ( fB , bT . xyz ) * bT . w ; mat3 fF = mat3 ( bT . xyz , fE , fB ) ; mat3 fG = fF ;".split(" ")}]}}]},{type:"textline",b:"vec3 fH = bQ ; vec4 fI = bR ; float fJ = u_emit ; float fK = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 tA = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 tG ( vec3 tB , mat4 tC ) { vec3 tD = vec3 ( tC [ 0 ] [ 0 ] , tC [ 1 ] [ 0 ] , tC [ 2 ] [ 0 ] ) ; vec3 tE = vec3 ( tC [ 0 ] [ 1 ] , tC [ 1 ] [ 1 ] , tC [ 2 ] [ 1 ] ) ; vec3 tF = vec3 ( tC [ 0 ] [ 2 ] , tC [ 1 ] [ 2 ] , tC [ 2 ] [ 2 ] ) ; tE = cross ( tF , tD ) ; tD = normalize ( tD ) ; tE = normalize ( tE ) ; tF = normalize ( tF ) ; return mat4 ( vec4 ( tD , 0.0 ) , vec4 ( tE , 0.0 ) , vec4 ( tF , 0.0 ) , vec4 ( tB , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 tM ( vec3 tH , vec3 tI ) { vec3 tJ = tH - tI ; tJ . y = 0.0 ; vec3 tK = cross ( tA , tJ ) ; vec3 tL = cross ( tJ , tK ) ; tK = normalize ( tK ) ; tL = normalize ( tL ) ; tJ = normalize ( tJ ) ; return mat4 ( vec4 ( tK , 0.0 ) , vec4 ( tL , 0.0 ) , vec4 ( tJ , 0.0 ) , vec4 ( tI , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 tW ( in vec3 tN , float tO , float tP , float tQ , vec3 tR ) { float tS = fract ( length ( tR ) / 0.17 ) ; float tT = tQ + tS / 10.0 ; float tU = tS ; if ( tQ != 0.0 ) tU /= tQ ; tN *= 1.0 + 0.5 * sin ( tO ) ; float tV = length ( tN ) * tP * sin ( 2.0 * 3.14 * tO * tT + tU ) ; return bH ( tV ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ug ( in vec3 tX , in vec3 tY , in mat4 tZ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 t_ = tG ( tY , tZ ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float ua = fract ( ( tY . x * 1.43 + tY . y * 0.123 + tY . z * 6.1 ) ) ; float ub = 2.0 * M_PI * ua ; vec3 uc = normalize ( vec3 ( tZ [ 0 ] [ 2 ] , 0.0 , tZ [ 2 ] [ 2 ] ) ) ; float ud = acos ( uc [ 2 ] ) ; if ( uc [ 0 ] < 0.0 ) ud = 2.0 * M_PI - ud ; float ue = ud - ub ; if ( ue < 0.0 ) ue = 2.0 * M_PI + ue ; float uf = ub ; if ( ue <= MAX_BILLBOARD_ANGLE ) uf += ue ; else if ( ue <= M_PI - MAX_BILLBOARD_ANGLE ) uf += MAX_BILLBOARD_ANGLE * ( 2.0 * ue - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( ue <= M_PI + MAX_BILLBOARD_ANGLE ) uf += ue - M_PI ; else if ( ue <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) uf += MAX_BILLBOARD_ANGLE * ( 2.0 * ue - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else uf += ue - 2.0 * M_PI ; mat4 t_ = bF ( uf ) ; t_ [ 3 ] = vec4 ( tY , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 t_ = tM ( tX , tY ) ;".split(" ")}]}}]},{type:"textline",b:["return","t_",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 um ( in vec3 uh , in vec3 ui , in mat4 uj , mat4 uk ) { mat4 ul = ug ( uh , ui , uj ) ; uk [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; ul = ul * uk ; return ul ; }".split(" ")}]}}]},
{type:"textline",b:"bh ut ( in vec3 un , in vec3 uo , in vec3 up , in vec3 uq , in vec3 ur , in mat4 us ) { un = ( us * vec4 ( un , 1.0 ) ) . xyz ; uo = ( us * vec4 ( uo , 1.0 ) ) . xyz ; up = ( us * vec4 ( up , 0.0 ) ) . xyz ; uq = ( us * vec4 ( uq , 0.0 ) ) . xyz ; ur = ( us * vec4 ( ur , 0.0 ) ) . xyz ; return bJ ( bh ( un , uo , up , uq , ur , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 uw ( vec2 uu , vec3 uv ) { return ( uu + 0.5 ) * uv . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 uF ( in vec4 ux , in vec4 uy , in float uz ) { float uA = ux [ 0 ] * uy [ 0 ] + ux [ 1 ] * uy [ 1 ] + ux [ 2 ] * uy [ 2 ] + ux [ 3 ] * uy [ 3 ] ; if ( uA < 0.0 ) { uy *= - 1.0 ; uA = - uA ; } if ( abs ( uA ) >= 1.0 ) return ux ; float uB = acos ( uA ) ; float uC = sqrt ( 1.0 - uA * uA ) ; if ( abs ( uC ) < 0.001 ) return vec4 ( ux * 0.5 + uy * 0.5 ) ; float uD = sin ( ( 1.0 - uz ) * uB ) / uC ; float uE = sin ( uz * uB ) / uC ; return ux * uD + uy * uE ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 uV ( in vec3 uG , in vec4 uH , in vec4 uI , in vec4 uJ , in vec4 uK , in float uL ) { vec3 uM = bu ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uG , 1.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 uN = uF ( uH , uI , uL ) ; vec4 uO = mix ( uJ , uK , uL ) ; vec3 uP = bn ( uN , uM ) ; vec3 uQ = uP * uO . w + uO . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 uR = bn ( uH , uM ) ; vec3 uS = bn ( uI , uM ) ; vec3 uT = uR * uJ . w + uJ . xyz ; vec3 uU = uS * uK . w + uK . xyz ; vec3 uQ = mix ( uT , uU , uL ) ;".split(" ")}]}}]},{type:"textline",b:"return bA ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uQ , 1.0 ) ) ; } vec3 ve ( in vec3 uW , in vec4 uX , in vec4 uY , in float uZ ) { vec3 u_ = bu ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uW , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 va = uF ( uX , uY , uZ ) ; vec3 vb = bn ( va , u_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 vc = bn ( uX , u_ ) ; vec3 vd = bn ( uY , u_ ) ; vec3 vb = mix ( vc , vd , uZ ) ;".split(" ")}]}}]},{type:"textline",b:"return bA ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vb , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 uV ( in vec3 vf , in vec4 vg , in vec4 vh ) { vec3 vi = bu ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vf , 1.0 ) ) ; vec3 vj = bn ( vg , vi ) ; vec3 vk = vj * vh . w + vh . xyz ; return bA ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vk , 1.0 ) ) ; } vec3 ve ( in vec3 vl , in vec4 vm ) { vec3 vn = bu ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vl , 0.0 ) ) ; vec3 vo = bn ( vm , vn ) ; return bA ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vo , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void vD ( inout vec3 vp , inout vec3 vq , inout vec3 vr , inout vec3 vs ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","vt","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 vu = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 vv = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 vw = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 vx = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 vy = a_influence ; for ( int vz = 0 ; vz < 4 ; vz ++ ) { int vA = int ( vy [ vz ] ) ; float vB = fract ( vy [ vz ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vu += vB * uV ( vp , u_quatsb [ vA ] , u_quatsa [ vA ] , u_transb [ vA ] , u_transa [ vA ] , vt ) ; vv += vB * ve ( vq , u_quatsb [ vA ] , u_quatsa [ vA ] , vt ) ; vw += vB * ve ( vr , u_quatsb [ vA ] , u_quatsa [ vA ] , vt ) ; vx += vB * ve ( vs , u_quatsb [ vA ] , u_quatsa [ vA ] , vt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vu += vB * uV ( vp , u_quatsb [ vA ] , u_transb [ vA ] ) ; vv += vB * ve ( vq , u_quatsb [ vA ] ) ; vw += vB * ve ( vr , u_quatsb [ vA ] ) ; vx += vB * ve ( vs , u_quatsb [ vA ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} vp = vu ; vq = vv ; vr = vw ; vs = vx ; } if ( ! ( a_influence . y > 0.0 ) ) { int vC = int ( a_influence [ 0 ] - 1.0 ) ; if ( vC > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vp = uV ( vp , u_quatsb [ vC ] , u_quatsa [ vC ] , u_transb [ vC ] , u_transa [ vC ] , vt ) ; vq = ve ( vq , u_quatsb [ vC ] , u_quatsa [ vC ] , vt ) ; vr = ve ( vr , u_quatsb [ vC ] , u_quatsa [ vC ] , vt ) ; vs = ve ( vs , u_quatsb [ vC ] , u_quatsa [ vC ] , vt ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vp = uV ( vp , u_quatsb [ vC ] , u_transb [ vC ] ) ; vq = ve ( vq , u_quatsb [ vC ] ) ; vr = ve ( vr , u_quatsb [ vC ] ) ; vs = ve ( vs , u_quatsb [ vC ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void vS ( inout vec3 vE , in vec3 vF , in float vG , in float vH , in float vI , in vec3 vJ , in float vK ) { float vL = length ( vF ) ; float vM = vH * ( 1.0 + 0.1 * fract ( vL ) ) ; float vN = vG * vK * ( 1.0 + sin ( 2.0 * 3.14 * vI * vM + vL ) ) ; float vO = ( vE . y - vF . y ) * abs ( vN ) ; vO += 1.0 ; vO *= vO ; vO = vO * vO - vO ; vec3 vP = vE ; vP . xz += vJ . xz * vO * sign ( vN ) ; vec3 vQ = vP - vF ; if ( all ( equal ( vQ , vec3 ( 0.0 ) ) ) ) vE = vF ; else { float vR = length ( vE - vF ) ; vE = vF + normalize ( vQ ) * vR ; } }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 vU ( vec4 vT ) { return vT * vT * ( 3.0 - 2.0 * vT ) ; } vec4 vW ( vec4 vV ) { return abs ( fract ( vV + 0.5 ) * 2.0 - 1.0 ) ; } vec4 vY ( vec4 vX ) { return vU ( vW ( vX ) ) ; } void wo ( inout vec3 vZ , in float v_ , in vec3 wa , in vec3 wb , in vec3 wc , in float wd , in float we , in float wf , in vec3 wg ) { float wh ; float wi ; float wj ; vec2 wk ; vec4 wl ; vec2 wm ; vec3 wn ; wh = dot ( wc , vec3 ( 1.0 ) ) ; wi = wh + wg . g ; wj = dot ( vZ , vec3 ( wg . g ) ) ; wk = ( v_ + vec2 ( wj , wi ) ) ; wl = ( ( fract ( ( wk . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( wb ) * wd ; wl = vY ( wl ) ; wm = wl . xz + wl . yw ; wm . y = 0.5 - wm . y ; wn = wm . xyx * wg . rbr * vec3 ( we * wa . x , wf , we * wa . z ) ; vZ += wn ; }".split(" ")}]}}]},
{type:"textline",b:"void wv ( inout vec3 wp , inout vec3 wq , in vec3 wr ) { vec3 ws = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 wt = wq ; vec3 wu = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 wt = wp ; vec3 wu = wq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"wo ( wt , u_time , wr , ws , wu , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"vS ( wt , wu , au_wind_bending_amp , au_wind_bending_freq , u_time , ws , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vS ( wt , wu , au_wind_bending_amp , au_wind_bending_freq , u_time , ws , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"wp += wt - wq ; wq = wt ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wp = wt ; wq = wu ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_orco_tex_coord ; varying vec3 eL ;".split(" ")}]}}]},
{type:"node",name:"TEX_COORD_UV",h:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"fo",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["fo","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",h:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"fn",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["fn","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",
name:"UVMAP",h:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"fp",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["fp","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",h:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"fh",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["fh","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",h:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"ww",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["ww","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",h:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"wx",qualifier:["varying","float"]}],g:[{type:"textline",b:["wx","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
h:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"wy",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["wy","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",h:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"wz",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["wz","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:["void","wA","(",")","{"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["eL","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 wF ( vec3 wB , float wC , vec2 wD ) { vec2 wE = vec2 ( ( wB . x - wD . x ) / wC , - ( wB . z - wD . y ) / wC ) ; return fract ( wE ) ; } vec2 wJ ( vec2 wG , float wH , vec2 wI ) { return vec2 ( wG . x * wH , - wG . y * wH ) + wI ; } bh wK ( ) { return bh ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } bh xp ( vec3 wL , vec3 wM , vec3 wN , vec3 wO , vec3 wP , PRECISION sampler2D wQ , sampler2D wR , vec3 wS , float wT , vec3 wU , vec4 wV , mat4 wW ) { vec3 wX = bn ( wV , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float wY = - wX . x ; float wZ = - wX . z ; vec2 w_ = vec2 ( wU . x + wT * ( - 1.0 - wY ) / 2.0 , wU . z + wT * ( 1.0 - wZ ) / 2.0 ) ; vec2 xa = wF ( wP , wT , w_ ) ; float xb = wT / 2.0 ; vec2 xc = abs ( wJ ( xa - vec2 ( 0.5 ) , wT , vec2 ( 0.0 ) ) ) ; float xd = xb * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( xc ) > xd ) return wK ( ) ; float xe = wT / wS . z ; vec2 xf = ( xa - vec2 ( 0.5 ) ) * xe + vec2 ( 0.5 ) ; vec3 xg = wX * ( wT / wS . z - 1.0 ) / 2.0 ; xf . x += xg . x ; xf . y -= xg . z ; vec4 xh = texture2D ( wR , xf ) ; float xi = xh . r ; if ( xi < u_scale_threshold ) return wK ( ) ; float xj = wS . y - wS . x ; float xk = wS . y - texture2D ( wQ , xf ) . r * xj ; vec2 xl = wL . xz - wP . xz ; wP . xz = wJ ( xa , wT , w_ ) ; wP . y = xk ; wL . xz = wP . xz + xl ; wL . y *= xi ; wL . y += xk ; vec3 xm = xh . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"wL -= wP ; mat4 xn = ug ( wU , wP , wW ) ; bh xo = ut ( wL , wP , wM , wN , wO , xn ) ; xo . b = wP ; xo . f = xm ; return bJ ( xo ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return bJ ( bh ( wL , wP , wM , wN , wO , xm ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 xv ( mat4 xq , vec4 xr ) { vec2 xs = ( xq * u_v_light_matrix [ 3 ] ) . xy ; float xt = SHADOW_TEX_RES / 2.0 ; xs = floor ( xs * xt + 0.5 ) / xt - xs ; vec4 xu = xq * xr ; xu . xy += xs ; xu = u_b_light_matrix * xu ; return xu ; } void xz ( vec3 xw , vec3 xx ) { vec4 xy = u_v_light_matrix * vec4 ( xw + u_normal_offset * xx , 1.0 ) ; bW = xv ( u_p_light_matrix0 , xy ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"bX = xv ( u_p_light_matrix1 , xy ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"bY = xv ( u_p_light_matrix2 , xy ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"bZ = xv ( u_p_light_matrix3 , xy ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/fog.glslf"]=
{type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void xK ( inout vec3 xD , in float xE , in float xF , in vec4 xG ) {".split(" ")},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:"float xH = clamp ( ( xE - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOG_TYPE","QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["xH","*=","xH",";"]}]}},{type:"elif",
c:["FOG_TYPE","LINEAR",{type:"equal_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xH = sqrt ( xH ) ;".split(" ")}]}}]},{type:"textline",b:"if ( u_fog_params . w > 0.0 ) { if ( xF > u_fog_params . w ) xH = 0.0 ; else if ( xF > 0.0 ) { float xI = ( u_fog_params . w - xF ) / u_fog_params . w ; xH *= xI * xI ; } } float xJ = 1.0 - ( 1.0 - xH ) * ( 1.0 - u_fog_params . x ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","xJ","=","0.0",";"]}]}}]},{type:"textline",b:"xD = mix ( xD , xG . rgb , xJ ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 xR ( in mat4 xL , in vec3 xM ) { vec3 xN = mix ( xL [ 0 ] . rgb , xL [ 1 ] . rgb , max ( sign ( xM . x ) , 0.0 ) ) ; vec3 xO = mix ( xL [ 2 ] . rgb , xL [ 3 ] . rgb , max ( sign ( xM . z ) , 0.0 ) ) ; vec3 xP = vec3 ( xL [ 0 ] . a , xL [ 1 ] . a , xL [ 2 ] . a ) ; vec3 xQ = mix ( xN , xO , abs ( xM . z ) ) ; xQ = mix ( xQ , xP , abs ( xM . y ) ) ; a_ ( xQ ) ; return xQ ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void xT ( inout float xS ) { xS -= 0.5 ; xS = 4.0 * ( xS * xS * xS ) + 0.5 ; } void yi ( inout vec3 xU , in float xV , in vec3 xW , in float xX , in vec4 xY , in vec4 xZ , in float x_ ) { float ya = xZ . w * xV ; float yb = exp ( - ya * ya ) ; yb = clamp ( yb , 0.0 , 1.0 ) ; float yc = max ( xW . y , 0.0 ) ; xV = max ( xV - max ( xX / yc , 0.0 ) , 0.0 ) ; float yd = xY . w * xV ; float ye = 1.0 - yd ; ye = max ( ye , 0.0 ) ; xT ( ye ) ; ye += max ( x_ - 0.5 , 0.0 ) ; if ( ye < yb ) { vec3 yf = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 yg = xY . rgb ; xX = clamp ( - xX * 0.03 , 0.0 , 0.8 ) ; vec3 yh = mix ( yg , yf , min ( yc , 1.0 ) ) ; yh = mix ( yh , vec3 ( 0.0 ) , xX ) ; xU = mix ( yh , xU , ye ) ; } if ( ye >= yb ) { xU = mix ( xZ . rgb , xU , yb ) ; } } void yp ( inout vec3 yj , in float yk , in float yl ) { float ym = u_underwater_fog_color_density . w * yk ; float yn = 1.0 - ym ; yn = clamp ( yn , 0.0 , 1.0 ) ; xT ( yn ) ; yl = clamp ( - yl * 0.03 , 0.0 , 0.8 ) ; vec3 yo = mix ( u_underwater_fog_color_density . rgb , vec3 ( 0.0 ) , yl ) ; yj = mix ( yo , yj , yn ) ; }".split(" ")}]}}]},
{type:"textline",b:"void yw ( inout vec3 yq , float yr , vec3 ys , float yt ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 yu = xR ( u_cube_fog , ys ) ; vec4 yv = vec4 ( yu , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","yv","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"yi ( yq , yr , ys , u_cam_water_depth , u_underwater_fog_color_density , yv , yt ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"xK ( yq , yr , bQ . y , yv ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/lighting_nodes.glslf"]={type:"group",a:[{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"define",
name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float yz = 0.0 ; float yA = 1.0 ; float yB = 0.5 ; vec3 yC = vec3 ( yz ) ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",h:[{type:"node_out",name:"yR",qualifier:["vec3"],e:!1},{type:"node_out",name:"yS",qualifier:["vec3"],e:!1},{type:"node_out",name:"yT",qualifier:["vec3"],e:!1},{type:"node_out",name:"yU",qualifier:["vec3"],e:!0},{type:"node_out",name:"yV",qualifier:["vec3"],e:!0},{type:"node_out",name:"yW",qualifier:["vec2"],e:!0},{type:"node_out",
name:"yX",qualifier:["vec2"],e:!0},{type:"node_out",name:"yY",qualifier:["float"],e:!0},{type:"node_out",name:"yZ",qualifier:["float"],e:!0},{type:"node_out",name:"y_",qualifier:["vec4"],e:!0}],g:[{type:"textline",b:"yR = yD ; yS = yE ; yT = yF ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_yU"],g:[{type:"textline",b:["yU","=","yG",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_yV"],g:[{type:"textline",b:["yV","=","yI",";"]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_yX"],g:[{type:"textline",b:["yX","=","yK",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_yW"],g:[{type:"textline",b:["yW","=","yL",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_yY"],g:[{type:"textline",b:["yY","=","yM",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_yZ"],g:[{type:"textline",b:["yZ","=","yN",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_y_"],g:[{type:"textline",b:["y_","=","yO",";"]}]}]}]},{type:"node",
name:"LIGHTING_AMBIENT",h:[{type:"node_in",name:"za",qualifier:["vec3"],e:!1},{type:"node_in",name:"zb",qualifier:["vec3"],e:!1},{type:"node_in",name:"zc",qualifier:["vec3"],e:!1},{type:"node_out",name:"zd",qualifier:["vec4"],e:!1},{type:"node_out",name:"ze",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"zd = vec4 ( za + zc * zb , yz ) ; ze = yC ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",h:[{type:"node_in",name:"zf",qualifier:["float"],e:!1},{type:"node_out",name:"zg",qualifier:["vec3"],
e:!1},{type:"node_out",name:"zh",qualifier:["vec2"],e:!1},{type:"node_out",name:"zi",qualifier:["vec3"],e:!1},{type:"node_out",name:"zj",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1},"NUM_LIGHTS",0,{type:"g_expr",d:2},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"zh = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",
d:2}],g:[{type:"textline",b:["zj","=","yB",";"]}]},{type:"node_else",g:[{type:"textline",b:["zj","=","yz",";"]}]}]},{type:"textline",b:"zi = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) zi *= zf ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",b:"vec3 zk = u_light_positions [ LAMP_IND ] ; zg = zk - yH ;".split(" ")},{type:"textline",
b:"float zl = length ( zg ) ; zi *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + zl * zl ) ; zg = normalize ( zg ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"vec3 zm = u_light_directions [ LAMP_IND ] ; float zn = dot ( zg , zm ) ; zn *= smoothstep ( yz , yA , ( zn - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; zi *= zn ;".split(" ")}]}]}]},{type:"node_else",g:[{type:"textline",b:"zg = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]}]}]},
{type:"node",name:"DIFFUSE_FRESNEL",h:[{type:"node_in",name:"zo",qualifier:["vec3"],e:!1},{type:"node_in",name:"zp",qualifier:["vec2"],e:!1},{type:"node_in",name:"zq",qualifier:["vec3"],e:!1},{type:"node_in",name:"zr",qualifier:["float"],e:!1},{type:"node_in",name:"zs",qualifier:["vec2"],e:!1},{type:"node_out",name:"zt",qualifier:["float"],e:!1}],g:[{type:"textline",b:"zt = yz ; if ( zp . r != yz ) { float zu = ( yA - zr ) * dot ( zq , zo ) + zr ; if ( zs [ 0 ] == yz ) { zt = yA ; } else { float zv = yA + abs ( zu ) ; zv = zs [ 1 ] + ( yA - zs [ 1 ] ) * pow ( zv , zs [ 0 ] ) ; zt = clamp ( zv , yz , yA ) ; } zt = max ( zt , yz ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",h:[{type:"node_in",name:"zw",qualifier:["vec3"],e:!1},{type:"node_in",name:"zx",qualifier:["vec2"],e:!1},{type:"node_in",name:"zy",qualifier:["vec3"],e:!1},{type:"node_in",name:"zz",qualifier:["float"],e:!1},{type:"node_out",name:"zA",qualifier:["float"],e:!1}],g:[{type:"textline",b:"zA = yz ; if ( zx . r != yz ) { float zB = ( yA - zz ) * dot ( zy , zw ) + zz ; zA = max ( zB , yz ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_OREN_NAYAR",h:[{type:"node_in",name:"zC",
qualifier:["vec3"],e:!1},{type:"node_in",name:"zD",qualifier:["vec2"],e:!1},{type:"node_in",name:"zE",qualifier:["vec3"],e:!1},{type:"node_in",name:"zF",qualifier:["float"],e:!1},{type:"node_in",name:"zG",qualifier:["vec2"],e:!1},{type:"node_out",name:"zH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"zH = yz ; if ( zD . r != yz ) { float zI = ( yA - zF ) * dot ( zE , zC ) + zF ; if ( zG [ 0 ] > yz ) { float zJ = max ( dot ( zE , yJ ) , yz ) ; float zK = zG [ 0 ] * zG [ 0 ] ; float zL = yA - yB * ( zK / ( zK + 0.33 ) ) ; vec3 zM = zC - zI * zE ; vec3 zN = yJ - zJ * zE ;".split(" ")},
{type:"textline",b:"if ( length ( zM ) == yz || length ( zN ) == yz || abs ( zI ) > yA || abs ( zJ ) > yA )".split(" ")},{type:"textline",b:"zH = zI * zL ; else { float zO = acos ( zI ) ; float zP = acos ( zJ ) ; vec3 zQ = normalize ( zM ) ; vec3 zR = normalize ( zN ) ; float zS , zT ; zS = max ( zO , zP ) ; zT = min ( zO , zP ) ; zT *= 0.95 ; float zU = max ( dot ( zQ , zR ) , yz ) ; float zV = 0.45 * ( zK / ( zK + 0.09 ) ) ; zH = zI * ( zL + ( zV * zU * sin ( zS ) * tan ( zT ) ) ) ; } } else zH = zI ; zH = max ( zH , yz ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",h:[{type:"node_in",name:"zW",qualifier:["vec3"],e:!1},{type:"node_in",name:"zX",qualifier:["vec2"],e:!1},{type:"node_in",name:"zY",qualifier:["vec3"],e:!1},{type:"node_in",name:"zZ",qualifier:["float"],e:!1},{type:"node_in",name:"z_",qualifier:["vec2"],e:!1},{type:"node_out",name:"Aa",qualifier:["float"],e:!1}],g:[{type:"textline",b:"Aa = yz ; if ( zX . r != yz ) { float Ab = ( yA - zZ ) * dot ( zY , zW ) + zZ ; float Ac = max ( dot ( zY , yJ ) , yz ) ; if ( z_ [ 0 ] <= yA ) Aa = Ab * pow ( max ( Ac * Ab , 0.1 ) , z_ [ 0 ] - yA ) ; else Aa = Ab * pow ( 1.0001 - Ac , z_ [ 0 ] - yA ) ; Aa = max ( Aa , yz ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",h:[{type:"node_in",name:"Ad",qualifier:["vec3"],e:!1},{type:"node_in",name:"Ae",qualifier:["vec2"],e:!1},{type:"node_in",name:"Af",qualifier:["vec3"],e:!1},{type:"node_in",name:"Ag",qualifier:["float"],e:!1},{type:"node_in",name:"Ah",qualifier:["vec2"],e:!1},{type:"node_out",name:"Ai",qualifier:["float"],e:!1}],g:[{type:"textline",b:"Ai = yz ; if ( Ae . r != yz ) { float Aj = ( yA - Ag ) * dot ( Af , Ad ) + Ag ; float Ak = acos ( Aj ) ; if ( Ak < Ah [ 0 ] ) Ai = yA ; else if ( Ak > ( Ah [ 0 ] + Ah [ 1 ] ) || Ah [ 1 ] == yz ) Ai = yz ; else Ai = yA - ( ( Ak - Ah [ 0 ] ) / Ah [ 1 ] ) ; Ai = max ( Ai , yz ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",h:[{type:"node_in",name:"Al",qualifier:["vec3"],e:!1},{type:"node_in",name:"Am",qualifier:["vec2"],e:!1},{type:"node_in",name:"An",qualifier:["vec3"],e:!1},{type:"node_in",name:"Ao",qualifier:["float"],e:!1},{type:"node_in",name:"Ap",qualifier:["vec2"],e:!1},{type:"node_out",name:"Aq",qualifier:["float"],e:!1}],g:[{type:"textline",b:"Aq = yz ; if ( Am . g != yz ) { vec3 Ar = normalize ( Al + yJ ) ; Aq = ( yA - Ao ) * max ( dot ( An , Ar ) , yz ) + Ao ; Aq = pow ( Aq , Ap [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",h:[{type:"node_in",name:"As",qualifier:["vec3"],e:!1},{type:"node_in",name:"At",qualifier:["vec2"],e:!1},{type:"node_in",name:"Au",qualifier:["vec3"],e:!1},{type:"node_in",name:"Av",qualifier:["vec2"],e:!1},{type:"node_out",name:"Aw",qualifier:["float"],e:!1}],g:[{type:"textline",b:"Aw = yz ; if ( At . g != yz ) { vec3 Ax = normalize ( As + yJ ) ; float Ay = max ( dot ( Au , Ax ) , 0.001 ) ;".split(" ")},{type:"textline",b:"float Az = max ( dot ( Au , yJ ) , 0.01 ) ; float AA = max ( dot ( Au , As ) , 0.01 ) ; float AB = tan ( acos ( Ay ) ) ; float AC = max ( Av [ 0 ] , 0.001 ) ; Aw = AA * ( yA / ( 4.0 * M_PI * AC * AC ) ) * ( exp ( - ( AB * AB ) / ( AC * AC ) ) / ( sqrt ( Az * AA ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",h:[{type:"node_in",name:"AD",qualifier:["vec3"],e:!1},{type:"node_in",name:"AE",qualifier:["vec2"],e:!1},{type:"node_in",name:"AF",qualifier:["vec3"],e:!1},{type:"node_in",name:"AG",qualifier:["vec2"],e:!1},{type:"node_out",name:"AH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"AH = yz ; if ( AE . g != yz ) { vec3 AI = normalize ( AD + yJ ) ; float AJ = acos ( dot ( AI , AF ) ) ; if ( AJ < AG [ 0 ] ) AH = yA ; else if ( AJ >= AG [ 0 ] + AG [ 1 ] || AG [ 1 ] == yz ) AH = yz ; else AH = yA - ( AJ - AG [ 0 ] ) / AG [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",h:[{type:"node_in",name:"AK",qualifier:["vec3"],e:!1},{type:"node_in",name:"AL",qualifier:["vec2"],e:!1},{type:"node_in",name:"AM",qualifier:["vec3"],e:!1},{type:"node_in",name:"AN",qualifier:["float"],e:!1},{type:"node_in",name:"AO",qualifier:["vec2"],e:!1},{type:"node_out",name:"AP",qualifier:["float"],e:!1}],g:[{type:"textline",b:"AP = yz ; if ( AL . g != yz ) { if ( AO [ 0 ] < 1.0 || AO [ 1 ] == yz ) AP = yz ; else { if ( AO [ 1 ] < 100.0 ) AO [ 1 ] = sqrt ( 1.0 / AO [ 1 ] ) ; else AO [ 1 ] = 10.0 / AO [ 1 ] ; vec3 AQ = normalize ( yJ + AK ) ; float AR = ( yA - AN ) * max ( dot ( AM , AQ ) , yz ) + AN ; if ( AR < yz ) AP = yz ; else { float AS = max ( dot ( AM , yJ ) , 0.01 ) ; float AT = dot ( AM , AK ) ; if ( AT <= 0.01 ) AP = yz ; else { float AU = max ( dot ( yJ , AQ ) , 0.01 ) ; float AV = yA ; float AW = ( 2.0 * AR * AS ) / AU ; float AX = ( 2.0 * AR * AT ) / AU ; float AY = min ( min ( AV , AW ) , AX ) ; float AZ = sqrt ( pow ( AO [ 0 ] , 2.0 ) + pow ( AU , 2.0 ) - yA ) ; float A_ = pow ( AZ - AU , 2.0 ) / pow ( AZ + AU , 2.0 ) * ( yA + pow ( AU * ( AZ + AU ) - yA , 2.0 ) / pow ( AU * ( AZ - AU ) + yA , 2.0 ) ) ; float Ba = acos ( AR ) ; AP = max ( A_ * AY * exp ( - pow ( Ba , 2.0 ) / ( 2.0 * pow ( AO [ 1 ] , 2.0 ) ) ) , yz ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",h:[{type:"node_in",name:"Bb",qualifier:["vec4"],e:!1},{type:"node_in",name:"Bc",qualifier:["vec3"],e:!1},{type:"node_in",name:"Bd",qualifier:["float"],e:!1},{type:"node_in",name:"Be",qualifier:["float"],e:!1},{type:"node_in",name:"Bf",qualifier:["vec3"],e:!1},{type:"node_in",name:"Bg",qualifier:["vec3"],e:!1},{type:"node_in",name:"Bh",qualifier:["vec4"],e:!1},{type:"node_in",name:"Bi",qualifier:["vec3"],e:!1},{type:"node_in",name:"Bj",qualifier:["vec3"],e:!1},{type:"node_in",
name:"Bk",qualifier:["vec3"],e:!1},{type:"node_in",name:"Bl",qualifier:["float"],e:!1},{type:"node_out",name:"Bm",qualifier:["vec4"],e:!1},{type:"node_out",name:"Bn",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"Bn = Bc + Bk * Bj * Be ; Bm = Bb + vec4 ( Bk * Bi * Bd , Be ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",h:[{type:"node_in",name:"Bo",qualifier:["vec4"],e:!1},{type:"node_in",name:"Bp",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"yP = Bo . rgb ; yQ = Bp ;".split(" ")}]},{type:"nodes_global"},
{type:"textline",b:"void Bq ( vec3 yD , vec3 yE , vec3 yF , vec3 yG , vec3 yH , vec3 yI , vec3 yJ , vec2 yK , vec2 yL , float yM , float yN , vec4 yO , out vec3 yP , out vec3 yQ ) {".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct Bt { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"void BA ( inout float Bu , float Bv , vec2 Bw , vec2 Bx ) { float By = Bx . x - Bw . x ; float Bz = ( Bv - Bw . x ) / By ; Bu = mix ( Bu , Bx . y , clamp ( Bz , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void BH ( inout vec3 BB , float BC , vec4 BD , vec4 BE ) { float BF = BE . x - BD . x ; float BG = ( BC - BD . x ) / BF ; BB = mix ( BB , BE . yzw , clamp ( BG , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float BN ( float BI , float BJ , vec2 BK [ SIZE_RAMP_LENGTH ] ) { float BL = BI / BJ ; float BM = BK [ 0 ] . y ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BA ( BM , BL , BK [ 0 ] , BK [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"BA ( BM , BL , BK [ 1 ] , BK [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BA ( BM , BL , BK [ 2 ] , BK [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","BM",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 BT ( float BO , float BP , vec4 BQ [ COLOR_RAMP_LENGTH ] ) { float BR = BO / BP ; vec3 BS = BQ [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BH ( BS , BR , BQ [ 0 ] , BQ [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BH ( BS , BR , BQ [ 1 ] , BQ [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"BH ( BS , BR , BQ [ 2 ] , BQ [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",b:["return","BS",";","}"]}]}}]},{type:"textline",b:"float Cb ( float BU , float BV , float BW , float BX ) { float BY = max ( 0.01 , min ( BV , BW ) ) ; float BZ = max ( 0.01 , min ( BV , BX ) ) ; float B_ = BV - BZ ; float Ca = clamp ( BU / BY , 0.0 , 1.0 ) - step ( B_ , BU ) * ( BU - B_ ) / BZ ; return Ca ; } Bt Ch ( ) { Bt Cc ; float Cd ; if ( u_p_cyclic == 1 ) { Cd = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( Cd < 0.0 ) Cd += u_p_length ; } if ( u_p_cyclic != 1 ) { Cd = u_p_time - a_p_delay ; } if ( Cd < 0.0 || Cd >= a_p_lifetime ) { Cc . a = 0.0001 ; Cc . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( Cd < 0.0 || Cd >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 Ce = a_position ; vec3 Cf = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 Ce = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 Cf = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"Ce += u_p_nfactor * Cd * Cf ; Ce += a_p_vels . xyz * Cd ; Ce . y -= u_p_gravity * Cd * Cd / 2.0 ; float Cg = max ( u_p_mass , EPSILON ) ; Ce += ( u_p_wind_fac * u_wind / Cg ) * Cd * Cd / 2.0 ; Cc . b = Ce ; Cc . e = a_p_vels . w * Cd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Cc . a = BN ( Cd , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Cc . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Cc . d = BT ( Cd , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"Cc . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"Cc . c = Cb ( Cd , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return Cc ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float Cj = 0.0 ; float Ck = 1.0 ; vec3 Cl = vec3 ( Cj ) ; vec3 Cm = vec3 ( Ck ) ; vec3 Ct ( vec3 Cn ) { vec4 Co = vec4 ( Cj , - Ck / 3.0 , 2.0 / 3.0 , - Ck ) ; vec4 Cp = mix ( vec4 ( Cn . bg , Co . wz ) , vec4 ( Cn . gb , Co . xy ) , step ( Cn . b , Cn . g ) ) ; vec4 Cq = mix ( vec4 ( Cp . xyw , Cn . r ) , vec4 ( Cn . r , Cp . yzx ) , step ( Cp . x , Cn . r ) ) ; float Cr = Cq . x - min ( Cq . w , Cq . y ) ; float Cs = 1.0e-10 ; return vec3 ( abs ( Cq . z + ( Cq . w - Cq . y ) / ( 6.0 * Cr + Cs ) ) , Cr / ( Cq . x + Cs ) , Cq . x ) ; } vec3 Cx ( vec3 Cu ) { vec4 Cv = vec4 ( Ck , 2.0 / 3.0 , Ck / 3.0 , 3.0 ) ; vec3 Cw = abs ( fract ( vec3 ( Cu . r , Cu . r , Cu . r ) + Cv . xyz ) * 6.0 - Cv . www ) ; return Cu . b * mix ( Cv . xxx , clamp ( Cw - Cv . xxx , Cj , Ck ) , Cu . g ) ; } vec3 CB ( vec3 Cy , vec3 Cz , float CA ) { return mix ( Cy , Cz , CA ) ; } vec3 CF ( vec3 CC , vec3 CD , float CE ) { return CE * CC + CD ; } vec3 CJ ( vec3 CG , vec3 CH , float CI ) { return CH - CI * CG ; } vec3 CO ( vec3 CK , vec3 CL , float CM ) { float CN = Ck - CM ; return ( vec3 ( CN ) + CM * CK ) * CL ; } vec3 CT ( vec3 CP , vec3 CQ , float CR ) { vec3 CS = vec3 ( Ck - CR ) ; return Cm - ( CS + CR * ( Cm - CP ) ) * ( Cm - CQ ) ; } vec3 CY ( vec3 CU , vec3 CV , float CW ) { vec3 CX = vec3 ( Ck - CW ) ; return mix ( CV * ( CX + 2.0 * CW * CU ) , Cm - ( CX + 2.0 * CW * ( Cm - CU ) ) * ( Cm - CV ) , step ( 0.5 , CV ) ) ; } vec3 Db ( vec3 CZ , vec3 C_ , float Da ) { return mix ( C_ , abs ( CZ - C_ ) , Da ) ; } vec3 Df ( vec3 Dc , vec3 Dd , float De ) { return mix ( Dd , Dd / ( Dc + step ( Dc , Cl ) ) , De ) ; } vec3 Dj ( vec3 Dg , vec3 Dh , float Di ) { return mix ( Dh , min ( Dg , Dh ) , Di ) ; } vec3 Dn ( vec3 Dk , vec3 Dl , float Dm ) { return max ( Dm * Dk , Dl ) ; } vec3 Du ( vec3 Do , vec3 Dp , float Dq ) { vec3 Dr = Ct ( Dp ) ; if ( Dr . y != Cj ) { vec3 Ds = Ct ( Do ) ; vec3 Dt = Cx ( vec3 ( Dr . x , Ds . yz ) ) ; return mix ( Do , Dt , Dq ) ; } return Do ; } vec3 DA ( vec3 Dv , vec3 Dw , float Dx ) { vec3 Dy = Ct ( Dv ) ; if ( Dy . y != Cj ) { vec3 Dz = Ct ( Dw ) ; return Cx ( vec3 ( Dy . x , mix ( Dy . y , Dz . y , Dx ) , Dy . z ) ) ; } return Dv ; } vec3 DG ( vec3 DB , vec3 DC , float DD ) { vec3 DE = Ct ( DB ) ; vec3 DF = Ct ( DC ) ; return Cx ( vec3 ( DE . xy , mix ( DE . z , DF . z , DD ) ) ) ; } vec3 DN ( vec3 DH , vec3 DI , float DJ ) { vec3 DK = Ct ( DI ) ; if ( DK . y != Cj ) { vec3 DL = Ct ( DH ) ; vec3 DM = Cx ( vec3 ( DK . xy , DL . z ) ) ; return mix ( DH , DM , DJ ) ; } return DH ; } vec3 DS ( vec3 DO , vec3 DP , float DQ ) { vec3 DR = Cm - ( Cm - DP ) * ( Cm - DO ) ; return mix ( DO , ( ( Cm - DO ) * DP * DO ) + DO * DR , DQ ) ; } vec3 DW ( vec3 DT , vec3 DU , float DV ) { return DT + DV * ( 2.0 * DU - Ck ) ; } float Eb ( float DX , float DY , float DZ , float D_ ) { float Ea = Ck - D_ ; return ( Ea + DZ * DX ) * DY ; } float Eh ( float Ec , float Ed , float Ee , float Ef ) { float Eg = Ck - Ef ; return Ck - ( Eg + Ee * ( Ck - Ec ) ) * ( Ck - Ed ) ; } float En ( float Ei , float Ej , float Ek , float El ) { float Em = Ck - El ; return mix ( Ej * ( Em + 2.0 * Ek * Ei ) , Ck - ( Em + 2.0 * Ek * ( Ck - Ei ) ) * ( Ck - Ej ) , step ( 0.5 , Ej ) ) ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float EA ( in sampler2D Et , in vec2 Eu , in vec2 Ev ) { float Ew = texture2D ( Et , Eu ) . r ; float Ex = Ev . x ; float Ey = Ev . y ; float Ez = 2.0 * Ex / ( Ex + Ey - ( 2.0 * Ew - 1.0 ) * ( Ey - Ex ) ) ; return Ez ; }".split(" ")}]}};b4w.module.animation=function(a,p){var d=p("__animation"),c=p("__print"),b=p("__armature"),k=p("__obj_util");a.SLOT_0=d.SLOT_0;a.SLOT_1=d.SLOT_1;a.SLOT_2=d.SLOT_2;a.SLOT_3=d.SLOT_3;a.SLOT_4=d.SLOT_4;a.SLOT_5=d.SLOT_5;a.SLOT_6=d.SLOT_6;a.SLOT_7=d.SLOT_7;a.SLOT_ALL=d.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=d.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=d.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=d.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=d.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=d.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=d.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=d.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=d.AB_CYCLIC;a.AB_FINISH_RESET=d.AB_FINISH_RESET;a.AB_FINISH_STOP=d.AB_FINISH_STOP;var f=new Float32Array(8);a.is_animated=function(a){return d.is_animated(a)};a.get_actions=function(){c.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],b=d.Ts(),f=0;f<b.length;f++)a.push(d.EE(b[f].name));return a};a.get_current_action=function(b,d){c.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(b,d)};a.get_anim_names=function(a){return d.ju(a)?d.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.VA(a,b)};a.apply=function(a,b,f){if(f>d.SLOT_7)c.error("Can't apply animation to slot "+f+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{f=f||d.SLOT_0;if(d.is_animated(a)){var e=d.get_slot_num_by_anim(a,b);if(-1!=e&&e!=f){c.error('Animation "'+b+'" is already applied to object "'+
a.name+'" (slot "'+e+'").');return}}d.RF(a,b)?d.apply(a,b,f):c.error('No fcurves in action "'+b+'"')}};a.remove=function(a){d.remove(a)};a.remove_slot_animation=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.remove_slot_animation(a,b))};a.apply_def=function(a){d.apply_def(a)};a.play=function(a,b,f){d.is_animated(a)?(f=f||d.SLOT_0,d.play(a,b,f),d.update_object_animation(a,0,f,!0)):c.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.stop(a,
b))};a.is_play=function(a,b){if(!d.is_animated(a))return!1;b=b||d.SLOT_0;return d.is_play(a,b)};a.set_current_frame_float=function(b,d,f){c.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(b,d,f)};a.get_current_frame_float=function(b,d){c.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(b,d)};a.set_frame=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_frame(a,b,c))};a.set_first_frame=function(a,b){d.is_animated(a)&&
d.set_first_frame(a,b)};a.set_last_frame=function(a,b){if(d.is_animated(a)){b=b||d.SLOT_0;var c=d.get_anim_start_frame(a,b),e=d.get_anim_length(a,b);d.set_frame(a,c+e-d.Hw,b)}};a.get_frame=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return d.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return a.F[b]?d.get_speed(a,b):0};a.get_frame_range=function(a,
b){c.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(d.is_animated(a)){b=b||d.SLOT_0;var f=a.F[b];if(f)return[f.start,f.start+f.length]}return null};a.get_anim_start_frame=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.F[b])?d.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.F[b])?d.get_anim_length(a,b):-1};a.cyclic=function(b,f,k){c.error("cyclic() deprecated, use set_behavior() instead");
a.set_behavior(b,f?d.AB_CYCLIC:d.AB_FINISH_RESET,k)};a.is_cyclic=function(a,b){c.error("is_cyclic() deprecated, use get_behavior() instead");if(!d.is_animated(a))return!1;b=b||d.SLOT_0;return d.is_cyclic(a,b)};a.set_behavior=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,e){e=e||d.SLOT_0;d.is_animated(a)&&d.apply_smoothing(a,b,c,e)};a.update_object_animation=
function(a,b,f,e){c.error("update_object_animation() deprecated, use set_frame() instead");d.is_animated(a)&&(f=f||d.SLOT_0,d.update_object_animation(a,b||0,f,e||!1))};a.frame_to_sec=function(a){return d.frame_to_sec(a)};a.get_bone_translation=function(a,d,p){c.error("get_bone_translation() deprecated, use armature.get_bone_tsr() instead");if(!k.is_armature(a))return null;if(!b.mj(a,d))return c.error('There is no bone: "',d,'" in "',a.name,'".'),null;p||(p=new Float32Array(3));b.get_bone_tsr(a,d,
!1,!1,f);p[0]=f[0];p[1]=f[1];p[2]=f[2];return p};a.get_first_armature_object=function(){c.error("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return d.is_animated(a)&&b?d.get_slot_num_by_anim(a,b):null};a.get_anim_type=function(a,b){return d.is_animated(a)?d.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return d.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.f.bf};a.set_skel_mix_factor=function(a,b,f){k.is_armature(a)?
(b=Math.min(Math.max(b,0),1),a.f.bf!=b&&d.set_skel_mix_factor(a,b,f||0)):c.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var d=p("__anchors");p("__print");a.attach_move_cb=d.attach_move_cb;a.detach_move_cb=d.detach_move_cb;a.is_anchor=d.is_anchor;a.get_element_id=d.get_element_id};b4w.module.armature=function(a,p){var d=p("__armature"),c=p("__obj_util"),b=p("__transform"),k=p("__print");a.get_bone_tsr=function(a,b,l){if(!c.is_armature(a))return null;if(!d.mj(a,b))return k.error('There is no bone: "',b,'" in "',a.name,'".'),null;l||(l=new Float32Array(8));d.get_bone_tsr(a,b,!1,!1,l);return l};a.get_bone_tsr_rel=function(a,b,l){if(!c.is_armature(a))return null;if(!d.mj(a,b))return k.error('There is no bone: "',b,'" in "',a.name,'".'),null;l||(l=new Float32Array(8));d.get_bone_tsr(a,
b,!1,!0,l);return l};a.set_bone_tsr=function(a,n,l){c.is_armature(a)&&(d.mj(a,n)?(d.set_bone_tsr(a,n,l,!1),b.o(a)):k.error('There is no bone: "',n,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,n,l){c.is_armature(a)&&(d.mj(a,n)?(d.set_bone_tsr(a,n,l,!0),b.o(a)):k.error('There is no bone: "',n,'" in "',a.name,'".'))}};b4w.module.assets=function(a,p){var d=p("__assets");a.AT_ARRAYBUFFER=d.AT_ARRAYBUFFER;a.AT_JSON=d.AT_JSON;a.AT_TEXT=d.AT_TEXT;a.AT_AUDIOBUFFER=d.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=d.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=d.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,k,f){d.enqueue(a,b,k,f)}};b4w.module.camera=function(a,p){function d(a,b){if(!u.is_camera(a))return h.error("get_eye(): Wrong object"),null;b||(b=new Float32Array(3));z.copy(a.f.i,b);return b}function c(a,c){b.is_target_camera(a)?(z.copy(c,a.f.Xb),g.o(a),e.sync_transform(a)):h.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var k=p("__constraints"),f=p("__container"),n=p("__mat3"),l=p("__mat4"),u=p("__obj_util"),e=p("__physics"),h=p("__print"),g=p("__transform"),q=p("__util"),z=p("__vec3"),
G=p("__vec4"),D=new Float32Array(2),B=new Float32Array(3),v=new Float32Array(3),E=new Float32Array(4),A=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=function(a){h.error("camera.is_camera() deprecated, use objects.is_camera() instead");return u.is_camera(a)};a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=
b.is_hover_camera;a.set_move_style=function(a,c){if(!u.is_camera(a))return h.error("set_move_style(): Wrong object"),!1;if(c!=b.MS_STATIC&&c!=b.MS_EYE_CONTROLS&&c!=b.MS_HOVER_CONTROLS&&c!=b.MS_TARGET_CONTROLS)return h.error("set_move_style(): Wrong camera move style"),!1;a.f.Da=c;a.f.fc=null;a.f.mc=null;a.f.Ib=null;a.f.lb=!1;b.GB(a);switch(c){case b.MS_TARGET_CONTROLS:var f=d(a,B),l=q.quat_to_dir(a.f.quat,q.AXIS_MY,v),f=z.scaleAndAdd(f,l,10,l);z.copy(f,a.f.Xb)}g.o(a);e.sync_transform(a);return!0};
a.get_move_style=function(a){return u.is_camera(a)?b.get_move_style(a):(h.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=function(a,c){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)){var d=a.f;d.Lq=q.clamp(c[0],0,Infinity);d.Kq=q.clamp(c[1],0,Infinity);d.Mq=q.clamp(c[2],0,1)}else h.error("set_velocity_params(): Wrong object or camera move style")};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return h.error("get_velocity_params(): Wrong object or camera move style"),
null;c||(c=new Float32Array(3));var d=a.f;c[0]=d.Lq;c[1]=d.Kq;c[2]=d.Mq;return c};a.set_look_at=function(a,c,d,f){var h=a.f;b.vA(c,d,f,h.i,h.quat);g.o(a);e.sync_transform(a)};a.get_eye=d;a.set_pivot=c;a.set_trans_pivot=function(a,c,d){b.is_target_camera(a)?(z.copy(c,a.f.i),z.copy(d,a.f.Xb),g.o(a),e.sync_transform(a)):h.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(!b.is_target_camera(a))return h.error("get_pivot(): Wrong object or camera move style"),
null;c||(c=new Float32Array(3));z.copy(a.f.Xb,c);return c};a.rotate_pivot=function(b,c,d){h.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,d)};a.move_pivot=function(a,c,d){if(b.is_target_camera(a)){var f=a.f;if(f.Pv){var l=n.fromMat4(f.aa,A),k=z.subtract(f.i,f.Xb,v);B[0]=c;B[1]=0;B[2]=d;z.scale(B,z.len(k),B);z.transformMat3(B,l,B);z.add(f.Xb,B,f.Xb);z.add(f.i,B,f.i);g.o(a);e.sync_transform(a)}}else h.error("move_pivot(): wrong object")};
a.rotate_hover_cam=function(b,c){h.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){h.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,D)[1]:(h.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){h.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");
if(b.is_hover_camera(a))if(a.f.lb){var d=b.get_camera_angles(a,D);(d=-c-d[1])&&b.rotate_hover_camera(a,0,d);g.o(a);e.sync_transform(a)}else h.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else h.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(!b.is_hover_camera(a))return h.error("get_hover_angle_limits(): wrong object"),null;a.f.Ib?(c||(c=new Float32Array(2)),c[0]=a.f.Ib.Ya,c[1]=a.f.Ib.kb):h.error("get_hover_angle_limits(): camera hasn't angle limits");
return c};a.get_cam_dist_limits=function(a,c){if(!b.is_hover_camera(a)&&!b.is_target_camera(a))return h.error("get_cam_dist_limits(): wrong object"),null;a.f.lb?(c||(c=new Float32Array(2)),c[0]=a.f.zg,c[1]=a.f.xe):h.error("get_cam_dist_limits(): camera hasn't distance limits");return c};a.translate_hover_cam_v=function(b,c){h.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var d=
a.f;if(d.lb){var f=z.subtract(c,d.i,B);z.add(f,d.gc,d.gc)}g.set_translation(a,c);g.o(a);e.sync_transform(a)}else h.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,c){if(b.is_hover_camera(a)){var d=a.f;if(d.lb&&d.Ib){var f=z.subtract(c,d.gc,B),f=z.add(f,d.i,f);g.set_translation(a,f)}z.copy(c,d.gc);g.o(a);e.sync_transform(a)}else h.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return h.error("get_hover_cam_pivot(): wrong object"),
null;c||(c=new Float32Array(3));z.copy(a.f.gc,c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.f.lb:(h.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,d,f){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:f|=g.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){h.error("apply_vertical_limits(): wrong vertical limits");return}break;default:h.error("apply_vertical_limits(): wrong object");
return}a.f.mc={Ya:c,kb:d};b.kD(a,f==g.SPACE_LOCAL);g.o(a);e.sync_transform(a)};a.clear_vertical_limits=function(a){a.f.mc=null};a.get_vertical_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return h.error("get_vertical_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);return d.mc?(c[0]=d.mc.Ya,c[1]=d.mc.kb,c):null};a.has_vertical_limits=function(a){return b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)?Boolean(a.f.mc):(h.error("has_vertical_limits(): wrong object"),
null)};a.apply_horizontal_limits=function(a,c,d,f){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:f|=g.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){h.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:h.error("apply_horizontal_limits(): wrong object");return}a.f.fc={left:c,right:d};b.gD(a,f==g.SPACE_LOCAL);g.o(a);e.sync_transform(a)};a.clear_horizontal_limits=function(a){a.f.fc=null};a.get_horizontal_limits=function(a,c){if(!b.is_target_camera(a)&&
!b.is_eye_camera(a)&&!b.is_hover_camera(a))return h.error("get_horizontal_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);return d.fc?(c[0]=d.fc.left,c[1]=d.fc.right,c):null};a.has_horizontal_limits=function(a){return b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)?Boolean(a.f.fc):(h.error("has_horizontal_limits(): wrong object"),null)};a.apply_hover_angle_limits=function(a,c,d){b.is_hover_camera(a)?c<d?h.error("apply_hover_angle_limits(): wrong hover angle limits"):
(c=q.angle_wrap_periodic(c,-Math.PI,Math.PI),d=q.angle_wrap_periodic(d,-Math.PI,Math.PI),c=q.clamp(c,-Math.PI/2,0),d=q.clamp(d,-Math.PI/2,0),a.f.Ib={Ya:c,kb:d},b.EB(a),g.o(a),e.sync_transform(a)):h.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.is_hover_camera(a)?a.f.Ib=null:h.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,d){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>d)h.error("apply_distance_limits(): wrong distance limits");
else{var f=a.f;f.lb=!0;f.xe=c;f.zg=d;g.o(a);e.sync_transform(a)}else h.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.f.lb=!1:h.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(b,c,d){h.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-d)};a.is_look_up=function(a){q.quat_to_dir(a.f.quat,q.AXIS_MY,B);return 0<=B[1]?!0:!1};
a.rotate_camera=function(c,d,f,l,k){switch(a.get_move_style(c)){case b.MS_STATIC:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,d,f,l,k);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,d,f,l,k);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,d,f,l,k);break;default:h.error("rotate_camera(): Wrong object")}g.o(c);e.sync_transform(c)};a.rotate_target_camera=function(a,c,d,f,l){b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,f,l),g.o(a),e.sync_transform(a)):h.error("rotate_target_camera(): wrong object")};
a.rotate_eye_camera=function(a,c,d,f,l){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,f,l),g.o(a),e.sync_transform(a)):h.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,c,d,f,l){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,f,l),g.o(a),e.sync_transform(a)):h.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){h.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-d)};a.get_camera_angles=function(a,
c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};a.get_angles=function(a,c){h.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.f.S,e=0;e<d.length;e++){var f=d[e];f.type!=b.Eb&&f.type!=b.Jb||b.$D(f,c,f.fe)}};a.get_stereo_distance=function(a){a=a.f.S;for(var c=
0;c<a.length;c++){var d=a[c];if(d.type==b.Eb||d.type==b.Jb)return d.Bk}return 0};a.is_underwater=function(a){h.error("is_underwater() deprecated, always returns false");return a.f.Gv};a.translate_view=function(a,c,d,e){a=a.f.S;for(var f=0;f<a.length;f++){var g=a[f];g.ic||b.Kf(g,g.Fa);var h=B;h[0]=-c;h[1]=-d;h[2]=0;l.translate(g.Ba,h,g.Ba);l.rotateZ(g.Ba,e,g.Ba);l.multiply(g.Ba,g.ya,g.Kd);b.Mr(g);b.Dn(g)}};a.get_fov=function(a){return q.um(a.f.S[0].Nc)};a.set_fov=function(a,c){for(var d=a.f.S,e=0;e<
d.length;e++){var f=d[e];f.Nc=q.$z(c);f.ic||b.Kf(f,f.Fa);l.multiply(f.Ba,f.ya,f.Kd);b.Mr(f);b.Dn(f)}};a.correct_up=function(a,b){b||(b=q.AXIS_Y);k.correct_up(a,b)};a.zoom_object=function(a,d){if(b.is_target_camera(a)){g.get_object_center(d,!1,B);c(a,B);g.o(a);var f=g.get_object_size(d),l=b.UA(a)/2,f=f/Math.sin(l),l=g.PC(a,B);g.move_local(a,0,f-l,0);g.o(a);e.sync_transform(a)}else h.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,d){if(u.is_camera(c)&&a.is_ortho_camera(c)){var e=
c.f;if(b.is_target_camera(c)){var f=z.dist(e.i,e.Xb);e.Yh=d/2*e.Xh/f}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(f=z.distance(e.i,e.gc),e.Yh=d/2*e.Xh/f):c.f.S[0].top=d/2;b.rF(c)}else h.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(b){return u.is_camera(b)&&a.is_ortho_camera(b)?2*b.f.S[0].top:(h.error("get_ortho_scale(): wrong object"),null)};a.is_ortho_camera=function(a){return u.is_camera(a)?a.f.S[0].type==b.dd:(h.error("is_ortho_camera(): wrong object"),null)};a.calc_ray=
function(a,c,d,e){e||(e=new Float32Array(3));var g=a.f.S[0];switch(g.type){case b.Rb:case b.me:case b.Eb:case b.Jb:var l=Math.tan(g.Nc*Math.PI/360),k=l*g.Fa;c=f.Gn(c,d,D,g);E[0]=(2*c[0]/g.width-1)*k;E[1]=-1;E[2]=(2*c[1]/g.height-1)*l;E[3]=0;G.transformMat4(E,a.f.aa,E);e[0]=E[0];e[1]=E[1];e[2]=E[2];z.normalize(e,e);return e;default:return h.error("Non-compatible camera"),e}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,p){var d=p("__config");a.P_LOW=d.P_LOW;a.P_HIGH=d.P_HIGH;a.P_ULTRA=d.P_ULTRA;a.P_CUSTOM=d.P_CUSTOM;a.set=d.set;a.get=d.get;a.reset=d.reset;a.get_std_assets_path=d.get_std_assets_path};b4w.module.controls=function(a,p){var d=p("__controls"),c=p("__print");a.CT_CONTINUOUS=d.CT_CONTINUOUS;a.CT_TRIGGER=d.CT_TRIGGER;a.CT_SHOT=d.CT_SHOT;a.CT_LEVEL=d.CT_LEVEL;a.CT_CHANGE=d.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=
65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;
a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=d.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=d.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=d.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=d.create_custom_sensor;a.create_keyboard_sensor=d.create_keyboard_sensor;a.create_collision_sensor=function(a,c,f){return d.create_collision_sensor(a,c||"ANY",
f||!1)};a.create_collision_impulse_sensor=d.create_collision_impulse_sensor;a.create_ray_sensor=function(a,c,f,n,l,p,e){return d.create_ray_sensor(a,c,f,n||"ANY",l||!1,p||!1,e||!1)};a.create_mouse_click_sensor=d.create_mouse_click_sensor;a.create_mouse_wheel_sensor=d.create_mouse_wheel_sensor;a.create_mouse_move_sensor=d.create_mouse_move_sensor;a.create_touch_move_sensor=d.create_touch_move_sensor;a.create_touch_zoom_sensor=d.create_touch_zoom_sensor;a.create_motion_sensor=d.create_motion_sensor;
a.create_vertical_velocity_sensor=d.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=d.create_gyro_angles_sensor;a.create_gyro_delta_sensor=d.create_gyro_delta_sensor;a.create_timer_sensor=function(a,c){return d.create_timer_sensor(a,c||!1)};a.reset_timer_sensor=d.reset_timer_sensor;a.create_elapsed_sensor=d.create_elapsed_sensor;a.create_timeline_sensor=d.create_timeline_sensor;a.create_selection_sensor=function(a,c){return d.create_selection_sensor(a,c||!1)};a.set_custom_sensor=function(a,
c){d.LD(a,c)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=d.get_sensor_value;a.get_sensor_payload=d.get_sensor_payload;a.create_sensor_manifold=function(a,c,f,n,l,p,e){l=l||d.ss;d.create_sensor_manifold(a,c,f,n,l,p,void 0===e?null:e)};a.create_kb_sensor_manifold=function(a,c,f,n,l,p){n=d.create_keyboard_sensor(n);d.create_sensor_manifold(a,c,f,[n],d.ss,l,void 0===p?null:p)};a.check_sensor_manifolds=function(a){return d.check_sensor_manifold(a,null)};a.check_sensor_manifold=
d.check_sensor_manifold;a.remove_sensor_manifolds=function(a){c.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");d.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=d.remove_sensor_manifold;a.reset=d.reset;a.register_keyboard_events=d.register_keyboard_events;a.register_mouse_events=function(a,c,f){d.register_mouse_events(a,c,!!f)};a.register_wheel_events=d.register_wheel_events;a.register_touch_events=d.register_touch_events;a.register_device_orientation=
d.register_device_orientation;a.unregister_keyboard_events=d.unregister_keyboard_events;a.unregister_mouse_events=d.unregister_mouse_events;a.unregister_wheel_events=d.unregister_wheel_events;a.unregister_touch_events=d.unregister_touch_events;a.unregister_device_orientation=d.unregister_device_orientation};b4w.module.constraints=function(a,p){var d=p("__camera"),c=p("__constraints"),b=p("__obj_util"),k=p("__physics"),f=p("__print"),n=p("__transform");a.append_stiff=function(a,b,d,f,g){g=g||1;b instanceof Array&&2==b.length?c.Zx(a,b[0],b[1],d,f,g):c.qr(a,b,d,f,g);n.o(a);k.sync_transform(a)};a.append_semi_stiff=function(a,b,d,f){c.Yx(a,b,d,f);n.o(a);k.sync_transform(a)};a.append_semi_stiff_cam=function(a,b,e,h,g,q,p,G){d.is_eye_camera(a)?(c.Xx(a,b,e,h,g,q,p,G),n.o(a),k.sync_transform(a)):f.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};
a.append_semi_soft_cam=function(a,b,e,h){if(d.is_eye_camera(a)){if(!h||0>h)h=.25;c.Wx(a,b,e,h);n.o(a);k.sync_transform(a)}else f.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_stiff_trans=function(a,b,d){c.ay(a,b,d);n.o(a);k.sync_transform(a)};a.append_copy_trans=function(a,b,d){c.Rx(a,b,d);n.o(a);k.sync_transform(a)};a.append_stiff_trans_rot=function(a,b,d,f){c.by(a,b,d,f);n.o(a);k.sync_transform(a)};a.append_track=function(a,b){3==b.length?
c.dy(a,b):c.cy(a,b);n.o(a);k.sync_transform(a)};a.append_follow=function(a,b,d,f){3==b.length?c.Tx(a,b,d,f):c.Sx(a,b,d,f);n.o(a);k.sync_transform(a)};a.append_stiff_viewport=function(a,b,d){c.append_stiff_viewport(a,b,d);n.o(a);k.sync_transform(a)};a.remove=function(a){a.Ja&&c.remove(a)};a.get_parent=function(a){f.error("constraints.get_parent() deprecated, use objects.get_parent() instead");return b.get_parent(a)}};b4w.module.container=function(a,p){var d=p("__container"),c=p("__print");a.get_canvas=d.get_canvas;a.get_container=d.get_container;a.insert_to_container=function(a,k){2!=arguments.length?c.error("insert_to_container(): two arguments required"):a&&k&&d.insert_to_container(a,k)};a.set_canvas_offsets=d.set_canvas_offsets;a.update_canvas_offsets=d.update_canvas_offsets;a.client_to_canvas_coords=d.client_to_canvas_coords;a.force_offsets_updating=d.force_offsets_updating};b4w.module.data=function(a,p){var d=p("__data");p("__print");p("__util");a.load=d.load;a.unload=function(a){d.unload(a|0)};a.set_debug_resources_root=d.set_debug_resources_root;a.is_primary_loaded=d.is_primary_loaded;a.load_and_add_new=d.load;a.cleanup=a.unload};b4w.module.debug=function(a,p){function d(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.vo.ALU_OPS-a.vo.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.vo,e=c.$F,f=k(c.Pz),f=f?"\t\t("+f.join(", ")+")":"\t\t(NA)";g.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,f);g.groupCollapsed("directives");for(var f=c.ab.mf,h=0;h<f.length;h++){var l=f[h];g.log(l[0],l[1])}g.groupEnd();g.groupCollapsed("vert src");
g.log(c.ZF);g.groupEnd();g.groupCollapsed("vert stats");for(var n in e)"ALU_OPS"!=n&&"TEX_OPS"!=n&&g.log(n,e[n]);g.groupEnd();g.groupCollapsed("frag src");g.log(c.GA);g.groupEnd();g.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&g.log(n,d[n]);g.groupEnd();g.groupEnd()}}function k(a){for(var b=q.Rh(),c=0;c<b.length;c++)for(var d=b[c],f=u.oa(d,"MESH",u.DATA_ID_ALL),g=0;g<f.length;g++){var h=e.Ma(f[g],d);if(h&&h.T.length)for(var h=h.T,l=0;l<h.length;l++){var k=h[l];if(k.lc==a&&k.Oc.length)return k.Oc}}return null}
p("__batch");p("__config");var f=p("__controls"),n=p("__debug"),l=p("__extensions"),u=p("__objects"),e=p("__obj_util"),h=p("__physics"),g=p("__print"),q=p("__scenes"),z=p("__scenegraph"),G=p("__sfx"),D=p("__shaders"),B=p("__textures"),v=p("__util"),E=p("vec3");a.WM_NONE=n.WM_NONE;a.WM_OPAQUE_WIREFRAME=n.WM_OPAQUE_WIREFRAME;a.WM_TRANSPARENT_WIREFRAME=n.WM_TRANSPARENT_WIREFRAME;a.WM_FRONT_BACK_VIEW=n.WM_FRONT_BACK_VIEW;a.WM_DEBUG_SPHERES=n.WM_DEBUG_SPHERES;a.physics_stats=function(){h.Wz()};a.physics_id=
function(a){g.log("O",h.yA(a));for(var b=h.TA().bb.p,c=0;c<b.length;c++){var d=b[c];d.m.v==a&&g.log("B",d)}};a.visible_objects=function(){for(var a=q.get_active(),b=u.oa(a,"MESH",u.DATA_ID_ALL),a=[q.ea(a,"MAIN_OPAQUE"),q.ea(a,"MAIN_BLEND")],c=0;c<a.length;c++){var d=a[c],e=d.p;if(e.length){g.group(d.type,"DYNAMIC");for(var f=0;f<b.length;f++){var h=b[f],l=h.f;if("DYNAMIC"==l.type)for(var k=0;k<e.length;k++){var n=e[k];if(n.ob&&n.Ed==l){g.gp(h.name,h);break}}}g.groupEnd();g.groupCollapsed(d.type,"STATIC");
for(f=0;f<b.length;f++)if(h=b[f],l=h.f,"DYNAMIC"!=l.type)for(k=0;k<e.length;k++)if(n=e[k],n.ob&&n.Ed==l){g.gp(h.name,h);break}g.groupEnd()}}};a.object_info=function(a){for(var b=q.get_active(),c=u.oa(b,"MESH",u.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];if(e.name==a){g.log("Object",e);for(var f=q.zo(b),h=0;h<f.length;h++){for(var l=f[h],k=l.p,n=[],p=0;p<k.length;p++)k[p].Ed==e.f&&n.push(k[p]);g.log("Subscene "+l.type,n)}}}};a.objects_stat=function(){var a=q.get_active();console.log("Armatures: "+
u.oa(a,"ARMATURE",u.DATA_ID_ALL).length);console.log("Cameras: "+u.oa(a,"CAMERA",u.DATA_ID_ALL).length);console.log("Curves: "+u.oa(a,"CURVE",u.DATA_ID_ALL).length);console.log("Empties: "+u.oa(a,"EMPTY",u.DATA_ID_ALL).length);console.log("Lamps: "+u.oa(a,"LAMP",u.DATA_ID_ALL).length);console.log("Meshes: "+u.oa(a,"MESH",u.DATA_ID_ALL).length);console.log("Speakers: "+u.oa(a,"SPEAKER",u.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=q.get_active(),b=[q.ea(b,"MAIN_OPAQUE"),q.ea(b,"MAIN_BLEND")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,e=0;e<d.length;e++){var f=d[e].C;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=q.get_active(),b=[q.ea(b,"MAIN_OPAQUE"),q.ea(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,e=0;e<d.length;e++){var f=d[e].C;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=q.get_active(),b=[q.ea(a,"MAIN_OPAQUE"),q.ea(a,"MAIN_BLEND")],b=b[0].p.length+b[1].p.length,a=q.vv(a,["MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"]),
c=0;c<a.length;c++)var d=a[c],b="MAIN_PLANE_REFLECT"==d.type?b+d.p.length:b+6*d.p.length;return b};a.num_shaders=function(){return v.Qj(D.Xs())};a.geometry_stats=function(){for(var a=q.get_active(),b=q.zo(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.p,f=0;f<e.length;f++){var g=e[f].C,h=e[f].Ed;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||h.km||h.jm)&&(a[g.id]=g)}}var e=d=c=b=0,l;for(l in a)g=a[l],g=g.R,g.zl&&(d++,e+=g.zl/1048576),b++,c+=g.rs/1048576;
return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=q.get_active(),c=[q.ea(c,"MAIN_OPAQUE"),q.ea(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.p,f=0;f<e.length;f++){var g=e[f].C;if(g)for(var g=g.U,h=0;h<g.length;h++){var l=g[h];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var k=l.mb;-1===a.indexOf(k)&&(a.push(k),l=l.width*l.height*4/1048576/l.On,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=
function(){for(var a=[],b=0,c=q.get_active(),c=q.zo(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.j,g=[f.sb,f.jd];g.push.apply(g,e.ge);for(e=0;e<g.length;e++){var h=g[e];B.Zj(h)&&-1==a.indexOf(h)&&(a.push(h),b+=f.width*f.height*B.sB(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=q.get_active();(a=q.ea(a,"MAIN_OPAQUE"))&&q.St(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=q.get_active(),b=q.ea(a,"MAIN_OPAQUE"),a=q.vv(a,["SHADOW_CAST"]);
if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}q.St(d.j,b,e)}};a.scenegraph_to_dot=function(){for(var a=q.Rh(),b=0;b<a.length;b++)g.log("\n"+z.Uz(q.bt(a[b])))};a.scenes_to_dot=function(){};a.controls_info=f.debug;a.object_distance=function(a,b){return E.dist(a.f.i,b.f.i)};a.msg=n.msg;a.fbmsg=n.fbmsg;a.print_telemetry=n.print_telemetry;a.plot_telemetry=n.plot_telemetry;a.fbres=function(a,b){function c(){n.fbmsg("FBRES",
a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!v.gf(a,v.dr))throw"Wrong VEC3_IDENT";if(!v.gf(b,v.cr))throw"Wrong QUAT4_IDENT";if(!v.gf(c,v.AXIS_X))throw"Wrong AXIS_X";if(!v.gf(d,v.AXIS_Y))throw"Wrong AXIS_Y";if(!v.gf(e,v.AXIS_Z))throw"Wrong AXIS_Z";if(!v.gf(f,
v.AXIS_MX))throw"Wrong AXIS_MX";if(!v.gf(g,v.AXIS_MY))throw"Wrong AXIS_MY";if(!v.gf(h,v.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=G.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==G.Do(c)&&G.mute(c,!0)}};a.check_finite=function(a){n.check_finite(a)};a.set_debug_params=function(a){var b=q.get_active();if(b=q.ea(b,"WIREFRAME")){if("number"==typeof a.wireframe_mode)switch(a.wireframe_mode){case n.WM_NONE:case n.WM_OPAQUE_WIREFRAME:case n.WM_TRANSPARENT_WIREFRAME:case n.WM_FRONT_BACK_VIEW:case n.WM_DEBUG_SPHERES:q.eE(b,
a.wireframe_mode);break;default:g.error("set_debug_params(): Wrong wireframe mode")}"object"==typeof a.wireframe_edge_color&&q.dE(b,a.wireframe_edge_color)}else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return g.fB()};a.get_warning_quantity=function(){return g.wB()};a.clear_errors_warnings=function(){return g.clear_errors_warnings()};a.analyze_shaders=function(a){var e=D.Xs(),f=0,h;for(h in e)a&&-1===h.indexOf(a)||f++;var f="of "+f+" analyzing...",k={};for(h in e)if(!a||
-1!==h.indexOf(a)){var n=e[h],q;var p=n.Oq;q=n.Ns;var u=l.Ys();if(u){p=u.getTranslatedShaderSource(p);q=u.getTranslatedShaderSource(q);var u=c("/nvidia_vert",p),v=d(u),w=c("/nvidia_frag",q),z=d(w);q={ZF:p,NI:u,$F:v,GA:q,yH:w,vo:z}}else g.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),q=void 0;u=n.ab;p=u.Wi+" + "+u.Oh;q.Pz=n;q.ab=u;n=k[p]=k[p]||[];n.push(q);g.log(f)}for(p in k)g.group("%c"+p,"color: #800"),n=k[p],b(n),g.groupEnd()};a.fake_load=n.fake_load};b4w.module.geometry=function(a,p){var d=p("__batch"),c=p("__geometry"),b=p("__print"),k=p("__renderer");a.extract_vertex_array=function(a,k,l){if(!c.Uh(a))return b.error("Wrong object:",a.name),null;if(a=d.va(a,k,"MAIN")){if((k=a.R)&&k.Nb&&k.Nb[l])return c.qA(k,l);b.error("Attribute not found:"+l);return null}b.error("Wrong material:",k);return null};a.extract_index_array=function(a,k){if(!c.Uh(a))return b.error("Wrong object:",a.name),null;var l=d.va(a,k,"MAIN");if(l){if((l=l.R)&&l.Nb)return l.sf;
b.error("Buffer data not found");return null}b.error("Wrong material:",k);return null};a.update_vertex_array=function(a,k,l,p){var e=["MAIN","DEPTH","COLOR_ID"];if(c.Uh(a))for(var h=0;h<e.length;h++){var g=d.va(a,k,e[h]);g&&(g=g.R)&&g.Nb&&g.Nb[l]&&c.Qm(g,l,0,p)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,n,l,p,e){var h=["MAIN","DEPTH","COLOR_ID"];if(c.Uh(a))if(l instanceof Uint16Array||l instanceof Uint32Array)if(p instanceof Float32Array)for(var g=0;g<h.length;g++){var q=
d.va(a,n,h[g]);if(q){var z=q.R;if(z){c.gF(z,q.ze,l);var G=0,D;for(D in z.Nb)var B=z.Nb[D],G=G+p.length/3*B.$d;z.ad=new Float32Array(G);var G=z.ad,v=0;for(D in z.Nb)switch(B=z.Nb[D],D){case "a_position":G.set(p,v);B.offset=v;B.length=p.length;v+=B.length;break;case "a_normal":var E;e&&(E=c.Kr(l,p,p));var A=c.Jr(l,p,E);G.set(A,v);B.offset=v;B.length=p.length;v+=B.length;break;case "a_tangent":B.offset=v;B.length=p.length/3*B.$d;for(var A=new Float32Array(B.length),r=0;r<A.length;r+=4)A[r]=1,A[r+3]=
1;G.set(A,v);v+=B.length;break;default:B.offset=v,B.length=p.length/3*B.$d,A=new Float32Array(B.length),G.set(A,v),v+=B.length}c.Kv(z);k.sr(q);(q=d.Mc(a,q))&&q.R&&(q.R=z)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,d,l){c.check_shape_keys(a)?c.Ko(a,d)?c.rr(a,d,parseFloat(l)):b.error("Wrong key name:",d):b.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return c.check_shape_keys(a)};
a.get_shape_keys_names=function(a){return c.check_shape_keys(a)?c.get_shape_keys_names(a):(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,d){return c.check_shape_keys(a)?c.Ko(a,d)?c.get_shape_key_value(a,d):(b.error("Wrong key name:",d),null):(b.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,p){var d=p("__hud");p("__print");a.draw_mixer_strip=d.draw_mixer_strip;a.plot_array=d.plot_array};b4w.module.lights=function(a,p){function d(a){for(var c=l.get_active(),d=k.oa(c,"LAMP",k.DATA_ID_ALL),f=0;f<d.length;f++){var q=d[f];if("SUN"==q.Na.type){var p=q;break}}p?"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,f=p.f,u.set_rotation_euler(p,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),e.quat_to_dir(f.quat,e.AXIS_Y,a),f=h.length(f.i),h.copy(a,g),h.scale(g,f,g),u.set_translation(p,g),u.o(p),a=p.Na,a.zs&&(f=c.world.light_settings.environment_energy,
q=Math.cos(Math.abs(d)),d=Math.max(Math.min(3*q,1),0)*a.ts,f*=Math.max(q,.1),b.Tu(a,d),l.set_environment_colors(c,f,null,null)),l.Wf(p,c)):n.error("There is no sun on the scene")}function c(a){if(f.is_lamp(a))return a.Na.type;n.error("get_light_type(): Wrong object");return!1}var b=p("__lights"),k=p("__objects"),f=p("__obj_util"),n=p("__print"),l=p("__scenes"),u=p("__transform"),e=p("__util"),h=p("__vec3"),g=new Float32Array(3),q,z=60;a.get_lamps=function(a){var b=l.get_active(),b=k.oa(b,"LAMP",k.DATA_ID_ALL);
if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.Na.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=l.get_active(),a=k.oa(a,"LAMP",k.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.Na.type){b=d;break}}return b?(b=b.Na.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=d;a.set_day_time=function(a){for(var b=l.get_active(),
b=k.oa(b,"LAMP",k.DATA_ID_ALL),c=0;c<b.length;c++){var e=b[c];if("SUN"==e.Na.type){var f=e;break}}f?(f=-Math.cos(a/12*Math.PI)*z,b={},b.hor_position=12>a?15*a:15*(a-24),b.vert_position=f,d(b)):n.error("There is no sun on the scene")};a.set_date=function(a){(q=a.getDate())?1582==q&&10==a.nI&&4<a.Tz&&15>a.Tz&&n.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):n.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){z=Math.min(Math.max(a,
0),90)};a.get_light_params=function(a){if(f.is_lamp(a))var b=a.Na;else return n.error("get_light_params(): Wrong object"),!1;if(a=c(a))switch(a){case "SPOT":var d={light_type:a,light_color:b.color,light_energy:b.Jh,light_spot_blend:b.zk,light_spot_size:b.Qe,light_distance:b.distance};break;case "POINT":d={light_type:a,light_color:b.color,light_energy:b.Jh,light_distance:b.distance};break;default:d={light_type:a,light_color:b.color,light_energy:b.Jh}}return d?d:!1};a.get_light_type=c;a.set_light_params=
function(a,c){if(f.is_lamp(a)){var d=a.Na,e=l.get_active();"number"==typeof c.light_energy&&(b.Tu(d,c.light_energy),l.Wf(a,e));"object"==typeof c.light_color&&(b.TD(d,c.light_color),l.Wf(a,e));"number"==typeof c.light_spot_blend&&(b.VD(d,c.light_spot_blend),l.Wf(a,e));"number"==typeof c.light_spot_size&&(b.WD(d,c.light_spot_size),l.Wf(a,e));"number"==typeof c.light_distance&&(b.UD(d,c.light_distance),l.Wf(a,e));k.XE(e)}else n.error("set_light_params(): Wrong object")}};b4w.module.material=function(a,p){function d(a,b){for(var c=a.W[0].T,d=0;d<c.length;d++){var e=c[d];if(-1<e.Oc.indexOf(b))return"MAIN"==e.type}return!1}function c(a,b){var c=k.va(a,b,"MAIN");return Boolean(c&&c.zc[0])}function b(a,b){var c=k.va(a,b,"MAIN");return Boolean(c&&c.zc[1])}var k=p("__batch"),f=p("__config"),n=p("__obj_util"),l=p("__print"),u=p("__shaders"),e=f.q;a.inherit_material=function(a,b,c,d){n.Vj(c)&&n.Vj(a)?k.inherit_material(a,b,c,d):l.error("Wrong or batched object(s)")};a.get_materials_names=
function(a){var b=[];a=a.W;for(var c=0;c<a.length;c++)for(var d=a[c].T,e=0;e<d.length;e++)for(var f=0;f<d[e].Oc.length;f++)-1==b.indexOf(d[e].Oc[f])&&b.push(d[e].Oc[f]);return b};a.set_diffuse_color=function(a,b,c){var d=k.va(a,b,"MAIN");d?(d.pc.set(c),(a=k.Mc(a,b,"MAIN"))&&a.pc.set(c)):l.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=k.va(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.pc);return d}l.error('Couldn\'t get property "diffuse_color"!')};
a.set_diffuse_intensity=function(a,b,c){var d=k.va(a,b,"MAIN");if(d){if(d.lf=c,a=k.Mc(a,b,"MAIN"))a.lf=c}else l.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=k.va(a,b,"MAIN");if(c)return c.lf;l.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=k.va(a,b,"MAIN");d?(d.ce.set(c),(a=k.Mc(a,b,"MAIN"))&&a.ce.set(c)):l.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=k.va(a,
b,"MAIN");if(c){var d=Array(3);d[0]=c.ce[0];d[1]=c.ce[1];d[2]=c.ce[2];return d}l.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var d=k.va(a,b,"MAIN");if(d){if(d.kh=c,a=k.Mc(a,b,"MAIN"))a.kh=c}else l.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=k.va(a,b,"MAIN");if(c)return c.kh;l.error('Couldn\'t get property "specular_color_factor"!')};a.set_specular_intensity=function(a,b,d){c(a,b)||l.error('Property "specular_intensity" is missing!');
k.va(a,b,"MAIN").zc[0]=d;(a=k.Mc(a,b,"MAIN"))&&(a.zc[0]=d)};a.get_specular_intensity=function(a,b){c(a,b)||l.error('Property "specular_intensity" is missing!');return k.va(a,b,"MAIN").zc[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,c,d){b(a,c)||l.error('Property "specular_hardness" is missing!');k.va(a,c,"MAIN").zc[1]=d;(a=k.Mc(a,c,"MAIN"))&&(a.zc[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||l.error('Property "specular_hardness" is missing!');return k.va(a,c,"MAIN").zc[1]};
a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=k.va(a,b,"MAIN");if(d){if(d.Ae=c,a=k.Mc(a,b,"MAIN"))a.Ae=c}else l.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=k.va(a,b,"MAIN");if(c)return c.Ae;l.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var d=k.va(a,b,"MAIN");if(d){if(d.oe=c,a=k.Mc(a,b,"MAIN"))a.oe=c}else l.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=
k.va(a,b,"MAIN");if(c)return c.oe;l.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=k.va(a,b,"MAIN");if(d){if(d.kf=c,a=k.Mc(a,b,"MAIN"))a.kf=c}else l.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=k.va(a,b,"MAIN");if(c)return c.kf;l.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=k.va(a,b,"MAIN");if(d){if(d.af=c,a=k.Mc(a,b,"MAIN"))a.af=c}else l.error('Couldn\'t set property "alpha_factor"!')};
a.get_alpha_factor=function(a,b){var c=k.va(a,b,"MAIN");if(c)return c.af;l.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return l.error("missing arguments in get_material_params"),null;if(!d(a,b))return null;var c=k.va(a,b,"MAIN");if(!c)return null;var e={};"MAIN"==c.type&&(e.reflect_factor=c.reflect_factor,e.fresnel=c.Bd[2],e.fresnel_factor=5*(1-c.Bd[3]),e.parallax_scale=c.parallax_scale,e.parallax_steps=k.Gb(c,"PARALLAX_STEPS")[1]);return e};
a.get_water_material_params=function(a,b){if(!a||!b)return l.error("missing arguments in get_water_material_params"),null;if(!d(a,b))return null;var c=k.va(a,b,"MAIN");if(!c||!c.ag)return null;if(!c)return l.error("material not found"),null;var f={};if("MAIN"==c.type){if(e.yi){var n=f.shallow_water_col=Array(3);n[0]=c.shallow_water_col[0];n[1]=c.shallow_water_col[1];n[2]=c.shallow_water_col[2];n=f.shore_water_col=Array(3);n[0]=c.shore_water_col[0];n[1]=c.shore_water_col[1];n[2]=c.shore_water_col[2];
f.shallow_water_col_fac=c.shallow_water_col_fac;f.shore_water_col_fac=c.shore_water_col_fac}f.foam_factor=c.foam_factor;f.norm_uv_velocity=c.Zi;f.absorb_factor=k.Gb(c,"ABSORB")[1];f.sss_strength=k.Gb(c,"SSS_STRENGTH")[1];f.sss_width=k.Gb(c,"SSS_WIDTH")[1];f.dst_noise_scale0=k.Gb(c,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=k.Gb(c,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=k.Gb(c,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=k.Gb(c,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=k.Gb(c,"DIR_MIN_SHR_FAC")[1];
f.dir_freq=k.Gb(c,"DIR_FREQ")[1];f.dir_noise_scale=k.Gb(c,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=k.Gb(c,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=k.Gb(c,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=k.Gb(c,"DST_MIN_FAC")[1];f.waves_hor_fac=k.Gb(c,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(d(a,b)){var e=k.va(a,b,"MAIN");if(e){var f=[e];(e=k.Mc(a,b,"MAIN"))&&f.push(e);for(a=0;a<f.length;a++)e=f[a],"number"==typeof c.material_reflectivity&&(e.reflect_factor=c.material_reflectivity),
"number"==typeof c.material_fresnel&&(e.Bd[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(e.Bd[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(e.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=u.r(parseFloat(c.material_parallax_steps)),k.la(e,"PARALLAX_STEPS",b),k.ub(e,!0))}else l.error("material not found")}else l.error("setting material params is not possible");else l.error("missing arguments in set_material_params")};
a.set_water_material_params=function(a,b,c){if(a&&b&&c)if(d(a,b)){var f=k.va(a,b,"MAIN");if(f){var n=[f];(f=k.Mc(a,b,"MAIN"))&&n.push(f);for(a=0;a<n.length;a++)f=n[a],e.yi&&("object"==typeof c.shallow_water_col&&f.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(f.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&f.shore_water_col.set(c.shore_water_col),"number"==typeof c.shore_water_col_fac&&(f.shore_water_col_fac=c.shore_water_col_fac)),
e.shore_smoothing&&f.Xm&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?k.la(f,"SHORE_SMOOTHING",1):k.la(f,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=u.r(parseFloat(c.absorb_factor)),k.la(f,"ABSORB",b))),"number"==typeof c.foam_factor&&e.Nh&&(f.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&(f.Zi=c.norm_uv_velocity),e.water_dynamic&&f.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?k.la(f,"DYNAMIC",1):k.la(f,"DYNAMIC",0)),"number"==typeof c.waves_height&&
(b=u.r(parseFloat(c.waves_height)),k.la(f,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=u.r(parseFloat(c.waves_length)),k.la(f,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=u.r(parseFloat(c.sss_strength)),k.la(f,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=u.r(parseFloat(c.sss_width)),k.la(f,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=u.r(parseFloat(c.dst_noise_scale0)),k.la(f,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=u.r(parseFloat(c.dst_noise_scale1)),
k.la(f,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=u.r(parseFloat(c.dst_noise_freq0)),k.la(f,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=u.r(parseFloat(c.dst_noise_freq1)),k.la(f,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=u.r(parseFloat(c.dir_min_shore_fac)),k.la(f,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=u.r(parseFloat(c.dir_freq)),k.la(f,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=u.r(parseFloat(c.dir_noise_scale)),
k.la(f,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=u.r(parseFloat(c.dir_noise_freq)),k.la(f,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=u.r(parseFloat(c.dir_min_noise_fac)),k.la(f,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=u.r(parseFloat(c.dst_min_fac)),k.la(f,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=u.r(parseFloat(c.waves_hor_fac)),k.la(f,"WAVES_HOR_FAC",b))),k.ub(f,!0)}else l.error("material not found")}else l.error("setting water material params is not possible");
else l.error("missing arguments in set_water_material_params")}};b4w.module.particles=function(a,p){var d=p("__particles"),c=p("__print");a.set_size=function(a,k,f){d.ni(a)?d.set_size(a,k,f):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,k,f){d.ni(a)?d.set_normal_factor(a,k,f):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,k,f){d.ni(a)?(f=Math.min(f,1),f=Math.max(f,0),d.set_factor(a,k,f)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){p("__config");var d=p("__ipc"),c=p("__physics"),b=p("__print"),k=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.K(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.K(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.K(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,d){c.K(a)?c.set_gravity(a,d):b.error("No physics for object "+a.name)};a.set_damping=function(a,d,l){c.K(a)?c.w("set_damping",a.m.v,d,l):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.K(a)){var d=a.Fd;c.w("set_damping",a.m.v,d.$n,d.Rp)}else b.error("No physics for object "+a.name)};a.set_transform=function(a,d,l){c.K(a)?c.set_transform.apply(this,arguments):b.error("No physics for object "+a.name)};a.sync_transform=
function(a){c.K(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.K(a)?c.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.K(a)?c.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_force=function(a,d,l,k){c.K(a)?c.apply_force.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,d,l,k){c.K(a)?c.apply_torque.apply(this,
arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,k.clamp(d,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,d,l){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=k.clamp(d,0,1);var p=a.l.Kh;-1==l||1==l?p=Math.max(-1,Math.min(p+l*d,1)):0==l&&0<=p?(p-=d,p=Math.max(0,p)):0==l&&0>p?(p+=d,p=Math.min(0,
p)):b.error("Wrong steering direction");c.vehicle_throttle(a,k.clamp(p,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_steer(a,k.clamp(d,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,d,l){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=k.clamp(d,0,1);var p=a.l.Fi;-1==l||1==l?p=Math.max(-1,Math.min(p+l*d,
1)):0==l&&0<=p?(p-=d,p=Math.max(0,p)):0==l&&0>p?(p+=d,p=Math.min(0,p)):b.error("Wrong steering direction");c.vehicle_steer(a,k.clamp(p,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,d){c.K(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,k.clamp(d,0,1))):b.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,d){if(c.K(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");d=k.clamp(d,
-1,1);var l=a.l.ij;c.vehicle_brake(a,k.clamp(l+l*d,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.Bc.name;b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.K(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.Kh;b.error("Wrong object");return null};a.get_vehicle_steering=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.Fi;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.ij;b.error("Wrong object")};a.get_vehicle_speed=
function(a){if(!c.K(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,d,l){c.K(a)?c.set_character_move_dir(a,d,l):b.error("No physics for object "+a.name)};a.set_character_move_type=function(a,d){c.K(a)?c.set_character_move_type(a,d):b.error("No physics for object "+a.name)};a.set_character_walk_velocity=
function(a,d){c.K(a)?c.set_character_walk_velocity(a,d):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,d){c.K(a)?c.set_character_run_velocity(a,d):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,d){c.K(a)?c.set_character_fly_velocity(a,d):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.K(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,d,l){c.K(a)?c.character_rotation_inc(a,
d,l):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,d){c.K(a)?c.set_character_rotation_quat(a,d):b.error("No physics for object "+a.name)};a.set_character_rotation=function(a,d,l){c.K(a)?c.set_character_rotation(a,d,l):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,d){c.K(a)?c.set_character_rotation_v(a,d):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,d){c.K(a)?c.set_character_rotation_h(a,d):b.error("No physics for object "+
a.name)};a.append_collision_test=function(a,d,l,k){c.K(a)?c.append_collision_test(a,d,l,k||!1):b.error("No physics for object "+a.name)};a.remove_collision_test=function(a,d,l){c.K(a)?c.remove_collision_test(a,d||"ANY",l):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,d){c.K(a)?c.apply_collision_impulse_test(a,d):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.K(a)?c.clear_collision_impulse_test(a):b.error("No physics for object "+
a.name)};a.append_ray_test=function(a,b,d,k,e,h){return c.append_ray_test(a,b,d,k,e,h||!1,!1,!1,!1)};a.append_ray_test_ext=function(a,b,d,k,e,h,g,p,z){return c.append_ray_test(a,b,d,k,e,h||!1,g||!1,p||!1,z||!1)};a.remove_ray_test=function(a){c.Ct(a)?c.remove_ray_test(a):b.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,d,l){c.Ct(a)?c.change_ray_test_from_to(a,d,l):b.error("Wrong ray test ID")};a.apply_constraint=function(a,d,l,k,e,h,g,p,z,G){c.K(d)&&c.K(e)?c.apply_constraint(a,d,
l,k,e,h,g,p,z,G):b.error("Wrong objects")};a.clear_constraint=function(a){c.K(a)&&c.AB(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,d,l,k,e,h){c.K(a)&&c.K(k)?c.pull_to_constraint_pivot(a,d,l,k,e,h):b.error("Wrong objects")};a.get_worker_listeners=d.get_worker_listeners};b4w.module.rgb=function(a,p){p("__print");var d=p("__util"),c=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,c,d){var n=new Float32Array(3);n[0]=a;n[1]=c;n[2]=d;return n};a.set=function(a,c,d,n){n[0]=a;n[1]=c;n[2]=d;return n};a.css_to_rgb=function(a,c,f,n){n=n||new Float32Array(3);n[0]=a/255;n[1]=c/255;n[2]=f/255;d.nv(n,n);return n};a.rgb_to_css=function(a){a=d.dp(a,c);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};a.rgb_to_css_hex=
function(a){function k(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a}a=d.dp(a,c);return"#"+k(a[0])+k(a[1])+k(a[2])}};
b4w.module.rgba=function(a,p){p("__print");var d=p("__util"),c=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,c,d,n){var l=new Float32Array(4);l[0]=a;l[1]=c;l[2]=d;l[3]=n;return l};a.set=function(a,c,d,n,l){l[0]=a;l[1]=c;l[2]=d;l[3]=n;return l};a.css_to_rgba=function(a,c,f,n,l){l=l||new Float32Array(4);l[0]=a/255;l[1]=c/255;l[2]=f/255;l[3]=n;d.nv(l,l);return l};a.rgba_to_css=function(a){var k=d.dp(a,c);return[Math.round(255*k[0]),Math.round(255*
k[1]),Math.round(255*k[2]),a[3]]}};b4w.module.scenes=function(a,p){var d=p("__batch"),c=p("__camera"),b=p("__data"),k=p("__graph"),f=p("__objects"),n=p("__obj_util"),l=p("__physics"),u=p("__print"),e=p("__scenes"),h=p("__util");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=e.Rh();e.set_active(h.keysearch("name",a,b))};a.get_active=function(){return e.ja()?e.get_active().name:""};a.get_scenes=function(){for(var a=e.Rh(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(e.ja())return e.Pj(e.get_active());
u.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=f.Cd(f.an,a,b|0);if(c)return c;u.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=f.Cd(f.$m,a,b,c|0))return a;u.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=f.Cd(f.Ze,a,b|0);if(c)return c;u.error("get object "+a+": not found")};a.get_object_data_id=function(a){return e.get_object_data_id(a)};a.pick_object=f.pick_object;a.outlining_is_enabled=
function(a){return a&&a.f&&a.f.tb};a.set_outline_intensity=function(a,b){a&&a.f&&a.f.tb?a.f.Cf=b:u.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.f&&a.f.tb)return a.f.Cf;u.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.f&&a.f.tb?f.apply_outline_anim(a,b,c,d):u.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.f&&a.f.tb){var b=a.f.pi;f.apply_outline_anim(a,b.qi,b.ri,b.si)}else u.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.f&&a.f.tb?f.clear_outline_anim(a):u.error("clear_outline_anim(): wrong object")};a.set_outline_color=e.set_outline_color;a.get_outline_color=function(a){var b=e.get_active();if(b=e.ea(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.Le),a};a.set_glow_intensity=function(b,c){u.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){u.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,e){u.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){u.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){u.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){u.error("set_glow_color() deprecated, use set_outline_color() instead");
a.set_outline_color(b)};a.get_glow_color=function(b){u.error("get_glow_color() deprecated, use get_outline_color() instead");a.get_outline_color(b)};a.get_shadow_params=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active(),b=e.ea(a,"SHADOW_CAST");if(!b)return null;var c=a.k.bc,d=e.ea(a,"MAIN_OPAQUE"),f=e.ea(a,"DEPTH"),h={};h.csm_resolution=c.csm_resolution;h.self_shadow_polygon_offset=b.self_shadow_polygon_offset;f&&(h.self_shadow_normal_offset=f.self_shadow_normal_offset);
h.enable_csm=c.enable_csm;h.csm_num=c.csm_num;h.csm_first_cascade_border=c.csm_first_cascade_border;h.first_cascade_blur_radius=c.first_cascade_blur_radius;h.csm_last_cascade_border=c.csm_last_cascade_border;h.last_cascade_blur_radius=c.last_cascade_blur_radius;h.fade_last_cascade=c.fade_last_cascade;h.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(h.csm_borders=e.cB(a,d.j),h.blur_radii=new Float32Array(c.csm_num),h.blur_radii.set(d.j.om.subarray(0,c.csm_num))):(h.csm_borders=null,
h.blur_radii=null);return h};a.set_shadow_params=function(a){if(e.ja()){var b=e.get_active();"number"==typeof a.self_shadow_polygon_offset&&k.V(b.k.pb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var f=e.ea(b,"DEPTH");f&&("number"==typeof a.self_shadow_normal_offset&&(f.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(f.pcf_blur_radius=a.pcf_blur_radius));var h=e.ea(b,"MAIN_BLEND");h&&("number"==typeof a.self_shadow_normal_offset&&
(h.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(h.pcf_blur_radius=a.pcf_blur_radius),h.wa=!0);h=b.k.bc;"number"==typeof a.csm_first_cascade_border&&(h.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(h.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(h.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(h.last_cascade_blur_radius=
a.last_cascade_blur_radius);if(f){for(var l=f.p,n=0;n<l.length;n++){var p=l[n];p.Ed.yc&&(p=p.C,d.tr(p,h),d.ub(p))}f.wa=!0}f=b.gg.f.S;for(n=0;n<f.length;n++)c.Bq(f[n],h);e.Up(b)}else u.error("No active scene")};a.get_environment_colors=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active();return e.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(e.ja()){var d=e.get_active();e.set_environment_colors(d,parseFloat(a),b,c)}else u.error("No active scene")};
a.get_fog_color_density=function(a){if(!e.ja())return u.error("No active scene"),!1;var b=e.get_active();return e.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(e.ja()){var b=e.get_active();e.set_fog_color_density(b,a)}else u.error("No active scene")};a.get_ssao_params=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active();return e.get_ssao_params(a)};a.set_ssao_params=function(a){if(e.ja()){var b=e.get_active();e.set_ssao_params(b,a)}else u.error("No active scene")};
a.get_color_correction_params=function(){if(!e.ja())return u.error("No active scene"),null;var a=e.get_active(),a=e.ea(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(e.ja()){var b=e.get_active();if(b=e.ea(b,"COMPOSITING"))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&
(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.wa=!0}else u.error("No active scene")};a.get_sky_params=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active();return e.get_sky_params(a)};a.set_sky_params=function(a){if(e.ja()){var b=e.get_active();e.set_sky_params(b,a)}else u.error("No active scene")};a.get_dof_params=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active();return e.ea(a,"DOF")?e.get_dof_params(a):
null};a.set_dof_params=function(a){if(e.ja()){var b=e.get_active();e.set_dof_params(b,a)}else u.error("No active scene")};a.get_god_rays_params=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active();return e.ea(a,"GOD_RAYS")?e.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(e.ja()){var b=e.get_active();e.set_god_rays_params(b,a)}else u.error("No active scene")};a.get_bloom_params=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active();
return e.ea(a,"BLOOM")?e.get_bloom_params(a):null};a.set_bloom_params=function(a){if(e.ja()){var b=e.get_active();e.set_bloom_params(b,a)}else u.error("No active scene")};a.get_glow_material_params=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active();return e.ea(a,"GLOW_COMBINE")?e.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(e.ja()){var b=e.get_active();e.set_glow_material_params(b,a)}else u.error("No active scene")};a.get_wind_params=function(){if(!e.ja())return u.error("No active scene"),
!1;var a=e.get_active();return e.get_wind_params(a)};a.set_wind_params=function(a){if(e.ja()){var b=e.get_active();f.set_wind_params(b,a)}else u.error("No active scene")};a.get_water_surface_level=e.get_water_surface_level;a.set_water_params=function(a){if(e.ja()){var b=e.get_active();e.set_water_params(b,a)}else u.error("No active scene")};a.get_water_mat_params=function(a){if(e.ja()){var b=e.get_active();e.get_water_mat_params(b,a)}else u.error("No active scene")};a.update_scene_materials_params=
function(){if(e.ja()){var a=e.get_active();e.Dq(a)}else u.error("No active scene")};a.hide_object=function(a){n.Vj(a)||n.is_empty(a)?e.hide_object(a):u.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){n.Vj(a)||n.is_empty(a)?e.show_object(a):u.error("show/hide is only supported for dynamic meshes/empties")};a.is_hidden=function(a){if(n.Vj(a)||n.is_empty(a))return e.is_hidden(a);u.error("show/hide is only supported for dynamic meshes/empties");return!1};a.is_visible=
function(a){return a.f.is_visible};a.check_object=function(a){return e.ja()?f.RC(a,e.get_active()):(u.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return f.Cd(f.an,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return f.Cd(f.$m,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return f.Cd(f.Ze,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=e.get_active();a||(a="ALL");b||0===b||(b=f.DATA_ID_ALL);return f.oa(c,a,b)};a.get_object_name=function(a){return a?
a.Yg:(u.error("Wrong object name"),"")};a.get_object_name_hierarchy=function(a){if(!a)return u.error("Wrong object name"),null;for(var b=[];a;)b.push(a.Yg),a=n.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(u.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){u.error("scenes.get_object_dg_parent() deprecated, use objects.get_dg_parent() instead");return n.get_dg_parent(a)};a.get_object_children=function(a){return a.xd.slice(0)};a.get_first_character=
function(){for(var a=f.oa(e.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(l.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return e.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return e.get_cam_water_depth()};a.get_type_mesh_object=function(a){return n.is_mesh(a)?a.f.type:null};a.get_meta_tags=function(){if(!e.ja())return u.error("No active scene"),!1;var a=e.get_active();return e.get_meta_tags(a)};a.append_object=function(a,b){if(a.f.So){if(b)var c=
e.Rh(),c=h.keysearch("name",b,c);else c=e.get_active();e.append_object(c,a,!0)}else u.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){if(a.f.So){var c=e.get_active();b.iD(c,a,!1);f.remove_object(a)}else u.error("Can't remove object \""+a.name+'". It was not copied.')};a.marker_frame=function(a){var b=e.get_active();if(b.timeline_markers&&a in b.timeline_markers)return e.marker_frame(b,a);u.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=
e.get_active();return(a=e.ea(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=e.get_active();(b=e.ea(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):u.error("The motion blur subscene doesn't exist.")};a.can_select_objects=function(){var a=e.get_active();return Boolean(e.ea(a,"COLOR_PICKING"))}};b4w.module.sfx=function(a,p){var d=p("__obj_util"),c=p("__scenes"),b=p("__sfx"),k=p("__print");a.play=function(a,c,d){b.play(a,c,d)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_play(a)};a.speaker_play=function(a,c,d,p){k.error("speaker_play() deprecated, use play() or play_def() instead");b.cyclic(a,c);p&&b.playrate(a,p);b.play(a,0,d)};a.speaker_stop=function(a){k.error("speaker_stop() deprecated, use stop() instead");b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.rE(a)};
a.resume=function(a){b.tE(a)};a.speaker_playback_rate=function(a,c){k.error("speaker_playback_rate() deprecated, use playrate() instead");b.playrate(a,c)};a.playrate=function(a,c){b.playrate(a,c)};a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,d){b.speaker_reset_speed(a,c,d)};a.get_volume=function(a){return a&&
"object"===typeof a?b.get_volume(a):b.lB()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.YD(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.KC(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):b.RB()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.get_speakers=function(){k.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=b.check_active_speakers;
a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,d){a&&"object"===typeof a?b.duck(a,c,d):b.fA(c,d)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.WE()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;
a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&d.is_speaker(a))return b.get_duration(a);k.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,p){var d=p("__print"),c=p("__textures");a.get_canvas_texture_context=function(a,k){k||(k=0);var f=c.$A(a,k);if(f)return f;d.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,k){k||(k=0);c.jF(a,k)||d.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,k){k||(k=0);c.play_video(a,k)||d.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,k){k||(k=0);c.pause_video(a,k)||d.error('Texture with name "'+
a+'" not found!')};a.reset_video=function(a,k){k||(k=0);c.reset_video(a,k)||d.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,p){var d=p("__time");a.set_timeout=d.set_timeout;a.clear_timeout=d.clear_timeout;a.get_timeline=d.get_timeline;a.animate=d.animate;a.clear_animation=d.clear_animation};b4w.module.transform=function(a,p){var d=p("__obj_util"),c=p("__physics"),b=p("__print"),k=p("__quat"),f=p("__transform"),n=p("__util"),l=new Float32Array(3),u=new Float32Array(4);a.SPACE_LOCAL=f.SPACE_LOCAL;a.SPACE_WORLD=f.SPACE_WORLD;a.set_translation=function(a,h,g,k){d.qa(a)?(l[0]=h,l[1]=g,l[2]=k,f.set_translation(a,l),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,h,g,k){d.qa(a)?(l[0]=h,l[1]=g,l[2]=k,f.set_translation_rel(a,
l),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,h){d.qa(a)?(f.set_translation(a,h),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,h){d.qa(a)?(f.set_translation_rel(a,h),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_obj_rel=function(a,h,g,k,p){d.qa(a)?(l[0]=h,l[1]=g,l[2]=k,n.transform_vec3(l,1,p.f.quat,p.f.i,
l),f.set_translation(a,l),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));f.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));f.get_translation_rel(a,b);return b};a.set_rotation=function(a,h,g,l,k){d.qa(a)?(u[0]=h,u[1]=g,u[2]=l,u[3]=k,f.set_rotation(a,u),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,
h,g,l,k){d.qa(a)?(u[0]=h,u[1]=g,u[2]=l,u[3]=k,f.set_rotation_rel(a,u),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat=function(){b.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,h){d.qa(a)?(f.set_rotation(a,h),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,h){d.qa(a)?(f.set_rotation_rel(a,h),f.o(a),c.sync_transform(a)):
b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){b.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));f.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));f.get_rotation_rel(a,b);return b};a.get_rotation_quat=function(){b.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=
function(a,h,g,k){d.qa(a)?(l[0]=h,l[1]=g,l[2]=k,f.set_rotation_euler(a,l),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,h,g,k){d.qa(a)?(l[0]=h,l[1]=g,l[2]=k,f.set_rotation_euler_rel(a,l),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,h){d.qa(a)?(f.set_rotation_euler(a,h),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=
function(a,h){d.qa(a)?(f.set_rotation_euler_rel(a,h),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,c){d.qa(a)?(f.set_scale(a,c),f.o(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,c){d.qa(a)?(f.set_scale_rel(a,c),f.o(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return f.get_scale(a)};a.get_scale_rel=function(a){return f.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=
a.type)b.error("Wrong object: "+a.name);else{for(var h=0;h<a.xd.length;h++)if(!d.qa(a.xd[h])){b.error('Wrong object: "'+a.xd[h].name+'" is not dynamic.');return}f.set_translation(a,[0,0,0]);f.set_rotation(a,[0,0,0,1]);f.set_scale(a,1);f.o(a);c.sync_transform(a)}};a.get_object_size=function(a){return d.is_mesh(a)?f.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,g){return d.is_mesh(a)?f.get_object_center(a,c,g):(b.error("Wrong object: "+a.name),null)};a.move_local=
function(a,h,g,l){d.qa(a)?(f.move_local(a,h,g,l),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,h){if(d.qa(a)){var g=k.setAxisAngle(n.AXIS_X,h,u);f.Qp(a,g);f.o(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_y_local=function(a,h){if(d.qa(a)){var g=k.setAxisAngle(n.AXIS_Y,h,u);f.Qp(a,g);f.o(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,
h){if(d.qa(a)){var g=k.setAxisAngle(n.AXIS_Z,h,u);f.Qp(a,g);f.o(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return f.get_object_bounding_box(a)};a.set_tsr=function(a,h){d.qa(a)?(f.set_tsr(a,h),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,h){d.qa(a)?(f.set_tsr_rel(a,h),f.o(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_tsr=
function(a,b){b||(b=new Float32Array(8));f.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));f.get_tsr_rel(a,b);return b};a.distance=function(a,b){return f.distance(a,b)}};b4w.module.tsr=function(a,p){p("__print");var d=p("__tsr");a.create=d.create;a.from_values=d.from_values;a.copy=d.copy;a.identity=d.identity;a.create_sep=d.create_sep;a.set_sep=d.set_sep;a.set_trans=d.set_trans;a.set_scale=d.set_scale;a.set_transcale=d.set_transcale;a.set_quat=d.set_quat;a.get_trans_view=d.get_trans_view;a.get_scale=d.get_scale;a.get_quat_view=d.get_quat_view;a.invert=d.invert;a.to_mat4=function(a,b){b||(b=new Float32Array(16));d.to_mat4(a,b);return b};a.from_mat4=d.from_mat4;a.multiply=
d.multiply;a.transform_vec3=d.transform_vec3;a.transform_vec3_inv=d.transform_vec3_inv;a.transform_vectors=d.transform_vectors;a.transform_dir_vectors=d.transform_dir_vectors;a.transform_dir_vec3=d.transform_dir_vec3;a.transform_tangents=d.transform_tangents;a.translate=d.translate;a.interpolate=d.interpolate};b4w.module.util=function(a,p){var d=p("__obj_util"),c=p("__print"),b=p("__util"),k=p("__vec3");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=b.assert;a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,
c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,d,l,p,e){return 0!=k.dot(l,p)?(c.error("Wrong in-plane direction"),null):b.quat_project(a,d,l,p,e)};a.hash_code=
b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=function(a){c.error("util.is_mesh() deprecated, use objects.is_mesh() instead");return d.is_mesh(a)};a.is_armature=function(a){c.error("util.is_armature() deprecated, use objects.is_armature() instead");return d.is_armature(a)};
a.angle_wrap_0_2pi=b.angle_wrap_0_2pi;a.angle_wrap_periodic=b.angle_wrap_periodic;a.smooth_step=b.smooth_step;a.lerp=b.lerp};"object"==typeof module&&module.no&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){p("__print");var d=p("__version");a.version=d.version;a.version_str=d.version_str;a.type=d.type;a.date=d.date;a.date_str=d.date_str};"object"==typeof module&&module.no&&b4w.module.version(exports);b4w.module.objects=function(a,p){var d=p("__geometry"),c=p("__objects"),b=p("__obj_util"),k=p("__print"),f=p("__scenes");p("__util");a.get_meta_tags=function(a){if(a)return c.get_meta_tags(a)};a.copy=function(a,l,p){return b.is_mesh(a)?b.qa(a)?d.Uh(a)||d.check_shape_keys(a)||!p?-1==c.oa(f.get_active(),"MESH",c.DATA_ID_ALL).indexOf(a)?(k.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,l||"",p):(k.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(k.error('object "'+a.name+'" is not dynamic.'),!1):(k.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,d,f){b.is_mesh(a)?c.set_nodemat_value(a,d,f):k.error('The type of the object "'+a.name+'" is not "MESH".')};a.set_nodemat_rgb=function(a,d,f,e,h){b.is_mesh(a)?c.set_nodemat_rgb(a,d,f,e,h):k.error('The type of the object "'+a.name+'" is not "MESH".')};a.update_boundings=function(a){b.is_mesh(a)?d.Uh(a)||d.check_shape_keys(a)?c.update_boundings(a):k.error('object "'+
a.name+'" has not dynamic geometry.'):k.error('The type of the object "'+a.name+'" is not "MESH".')};a.get_parent=b.get_parent;a.get_dg_parent=b.get_dg_parent;a.is_mesh=b.is_mesh;a.is_armature=b.is_armature;a.is_speaker=b.is_speaker;a.is_camera=b.is_camera;a.is_lamp=b.is_lamp;a.is_empty=b.is_empty};b4w.module.main=function(a,p){function d(){}function c(){}function b(){}function k(){window.performance||(N.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(N.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});aa.Uu(0)}function f(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();N.error("WebGL context lost");l()},!1);m.Jd(b);var d=m.ft();d&&N.log("%cRENDERER INFO:","color: #00a",
b.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(d.UNMASKED_RENDERER_WEBGL));w.Jd(b);y.Jd(b);U.Jd(b);V.Jd(b);r.Jd(b);A.fE(a);v.init(a);K.Wu(a.width,a.height,1);x.init();c=g();e()}function n(){d=function(){}}function l(){u()||(ha=performance.now()/1E3,x.pause(),F.pause(),U.pause(),q.pause())}function u(){return na<ha}function e(){S(e);var a=performance.now()/1E3;oa||(oa=a);var b=a-oa;if(!(b<1/Q.Dd)){for(var d=aa.get_timeline(),f=0;f<ma.length;f++)ma[f](d,b);u()||(na>oa&&(b-=na-Math.max(ha,
oa)),d+=b,aa.Uu(d),r.update(),G.update(),A.update(),h(d,b),c(b));oa=a}}function h(a,b){A.is_primary_loaded()&&(t.reset(),ba.update(b),C.update(a,b),J.update(a,b),x.update(a,b),b&&z.update(b),A.is_primary_loaded()&&(F.update(a,b),A.is_primary_loaded()&&(d(b,a),A.is_primary_loaded()&&(E.update(a,b),A.is_primary_loaded()&&(q.update(),I.update(a,b),K.update(a,b),q.xF(),W&&(W(T.toDataURL()),W=null))))))}function g(){var a=60,c=0,d=Q.Ls,e=Q.AA;return function(f){f<1/Q.Dd||(a=ea.smooth(1/f,a,f,d),f=F.hB(),
c=(c+1)%e,0==c&&b(Math.round(a),f))}}var q=p("__anchors"),z=p("__animation"),G=p("__assets"),D=p("__config"),B=p("__compat"),v=p("__container"),E=p("__controls"),A=p("__data"),r=p("__debug"),m=p("__extensions"),y=p("__geometry"),t=p("__hud"),J=p("__nla"),C=p("__logic_nodes"),I=p("__objects"),F=p("__physics"),N=p("__print"),w=p("__renderer"),K=p("__scenes"),x=p("__sfx"),V=p("__shaders"),U=p("__textures"),aa=p("__time"),ba=p("__transform");p("__armature");var ea=p("__util"),R=p("__version"),X=D.context,
Q=D.q,T=null,ca=null,oa=0,ha=0,na=0,ma=[],W=null,M=["webgl","experimental-webgl"],O=null,S=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/Q.Dd)}}();a.init=function(a,b){D.ZD();N.bE(Q.console_verbose);var c=R.version_str()+" "+R.type()+" ("+R.date_str()+")";N.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;
k();T=a;B.gy();for(var c=null,d=0;d<M.length;d++){var e=M[d];try{c=a.getContext(e,X)}catch(h){}if(c)break}c&&B.cA(c);if(!c)return null;O=c;f(T,c);D.iy();B.RD(c);V.mC();Q.No&&(a.style["touch-action"]="none");N.log("%cSET PRECISION:","color: #00a",Q.precision);b?(t.init(b),ca=b):(D.q.show_hud_debug_info=!1,D.A.fm=!1);return c};a.set_check_gl_errors=function(a){r.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&(T.style.width=a+"px",T.style.height=b+"px",ca&&(ca.style.width=a+"px",ca.style.height=
b+"px"));ca&&(ca.width=a,ca.height=b,t.Pi());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))Q.canvas_resolution_factor=1;c=Math.floor(a*Q.canvas_resolution_factor);b=Math.floor(b*Q.canvas_resolution_factor);Q.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);T.width=c;T.height=b;if(c>O.drawingBufferWidth||b>O.drawingBufferHeight){N.warn("Canvas size exceeds platform limits, downscaling");
var d=Math.min(O.drawingBufferWidth/c,O.drawingBufferHeight/b);c*=d;b*=d;T.width=c;T.height=b}K.Wu(c,b,c/a);K.ja()&&ba.o(K.get_active().gg);h(aa.get_timeline(),0);A.oF(T.width,T.height)};a.set_fps_callback=function(a){b=a};a.clear_fps_callback=function(){b=function(){}};a.set_render_callback=function(a){d=a};a.clear_render_callback=function(){n()};a.global_timeline=function(){return aa.get_timeline()};a.redraw=function(){N.error("redraw() deprecated");h(aa.get_timeline(),0)};a.pause=l;a.resume=function(){u()&&
(na=performance.now()/1E3,x.resume(),F.resume(),U.play(!0),q.resume())};a.is_paused=u;a.reset=function(){A.unload(0);ca=T=null;na=ha=oa=0;b=function(){};c=function(){};d=function(){};ma.length=0;O=null;aa.reset()};a.canvas_data_url=function(a){W=a};a.get_canvas_elem=function(){return T};a.detect_mobile=function(){return B.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<ma.length;b++)if(ma[b]==a)return;ma.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<ma.length;b++)if(ma[b]==a){ma.splice(b,
1);break}}};b4w.module.nla=function(a,p){var d=p("__nla"),c=p("__time"),b=p("__print"),k=p("__util");a.set_frame=function(a){a=k.clamp(a,d.get_frame_start(),d.get_frame_end());d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.set_frame(a,c.get_timeline())};a.get_frame=function(){return d.get_frame(c.get_timeline())};a.stop=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.DE()};a.play=function(a){d.check_logic_nodes()?b.error("The active scene is using NLA script."):
d.eD(a)};a.is_play=function(){return d.is_play()};a.get_frame_start=function(){return d.get_frame_start()};a.get_frame_end=function(){return d.get_frame_end()};a.check_nla=function(){return d.check_nla()};a.check_nla_scripts=function(){return d.check_logic_nodes()};a.check_logic_nodes=function(){return d.check_logic_nodes()};a.set_range=function(a,c){d.check_logic_nodes()?b.error("The active scene is using NLA script."):(c=parseFloat(c)||d.get_frame_end(),a=parseFloat(a)||d.get_frame_end(),c=k.clamp(c,
d.get_frame_start(),d.get_frame_end()),a=k.clamp(a,d.get_frame_start(),c),d.set_range(a,c))};a.reset_range=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.reset_range()};a.set_cyclic=function(a){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.set_cyclic(a)};a.clear_callback=function(){d.check_logic_nodes()?b.error("The active scene is using NLA script."):d.clear_callback()}};b4w.module.app=function(a,p){function d(){var a=J.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=J.is_paused(),J.pause()):a||J.resume()},!1)}function c(a,b,c,d){var e=document.createElement("canvas"),f=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=f.offsetWidth+"px";e.style.height=f.offsetHeight+"px";e.width=f.offsetWidth*window.devicePixelRatio;e.height=f.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;f||(I.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body);f.appendChild(e);if(!J.init(e,b))return c&&D("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&r.insert_to_container(b,"LAST");return!0}function b(a,b){a?(b&&(document.getElementById(b).style.display="block"),V=document.getElementById(a)):(V=document.createElement("div"),
V.innerHTML=0,V.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",r.insert_to_container(V,"JUST_AFTER_CANVAS"))}function k(a,b){var c=String(a);b&&(c+="/"+String(b));V.innerHTML=c}function f(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function n(){var a=r.get_container();J.resize(a.clientWidth,a.clientHeight,!0)}function l(a,b,c){if(v.has_distance_limits(a))var d=N.get_translation(a,
Q),e=v.get_hover_cam_pivot(a,T),d=K.subtract(d,e,Q),d=Math.max(K.len(d),1);else d=10;e=N.get_rotation(a,oa);b=w.quat_to_dir(e,b,Q);b[1]=0;K.normalize(b,b);K.scale(b,d*c,b);d=N.get_translation(a,T);K.add(d,b,d);v.hover_cam_set_translation(a,d)}function u(a,b){if(v.has_distance_limits(a)){var c=v.get_hover_angle_limits(a,R);if(0>c[1]-c[0]){var d=v.get_camera_angles(a,X)[1],c=(c[0]-d)/(c[0]-c[1]),d=v.get_cam_dist_limits(a),c=Math.max(c,2/d[0]);v.rotate_hover_camera(a,0,c*b)}}else c=N.get_translation(a,
Q),d=K.scale(w.AXIS_Y,-b,T),K.add(c,d,c),v.hover_cam_set_translation(a,c)}function e(a,b,c,d){N.move_local(a,5*b,5*c,5*d)}function h(a,b,c){var d=N.get_translation(a,Q),e=v.get_pivot(a,T),d=K.dist(d,e),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));N.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function g(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function q(a,b,c,d,e){e?(e=v.get_pivot(a,Q),a=v.get_eye(a),a=K.dist(e,a)+d,d=0<b?g(b,-c,a,d):g(-b,c/(1-c),a,d)):d-=2*b*c;return d}function z(a,
b,c){function d(a,b,c,e){if(1==c){var f=t?.003*y[0]:.003*y[1];c=m.get_sensor_value(a,b,0);m.get_sensor_payload(a,b,0)===m.PL_SINGLE_TOUCH_MOVE?(Ba+="X"==e?-c*f:0,ja+="Y"==e?-c*f:0):m.get_sensor_payload(a,b,0)===m.PL_MULTITOUCH_MOVE_PAN&&(a=t?.003*y[1]:7.5E-4*y[0],qc+="X"==e?-c*a:0,pa+="Y"==e?-c*a:0)}}function f(a,b,c,d){if(1==c){c=m.get_sensor_value(a,b,1);v.get_velocity_params(a,y);if(t)e=.003*y[0],g=7.5E-4*y[1];else var e=.003*y[1],g=7.5E-4*y[0];if(1===m.get_sensor_payload(a,b,0))tb+="X"==d?-c*
e:0,Sb+="Y"==d?-c*e:0;else if(2===m.get_sensor_payload(a,b,0)||3===m.get_sensor_payload(a,b,0))Da+="X"==d?-c*g:0,ta+="Y"==d?-c*g:0}}function g(a){return a[0]&&(a[1]||a[2])}function k(a,b,c){if(1==c)switch(c=m.get_sensor_value(a,b,0),v.get_velocity_params(a,y),b){case "FORWARD":r?D[0]=1:t?(b=v.get_camera_angles(a,X)[1],b=Math.abs(b)>=Math.PI/4?w.AXIS_MZ:w.AXIS_MY,l(a,b,.5*y[0]*c)):p?h(a,-y[2],c):e(a,0,-y[0]*c,0);break;case "BACKWARD":r?D[0]=-1:t?(b=v.get_camera_angles(a,X)[1],b=Math.abs(b)>=Math.PI/
4?w.AXIS_Z:w.AXIS_Y,l(a,b,.5*y[0]*c)):p?h(a,y[2],c):e(a,0,y[0]*c,0);break;case "UP":t?u(a,30*-y[2]*c):r||e(a,0,0,-y[0]*c);break;case "DOWN":t?u(a,30*y[2]*c):r||e(a,0,0,y[0]*c);break;case "LEFT":r?D[1]=1:t?l(a,w.AXIS_MX,.5*y[0]*c):e(a,-y[0]*c,0,0);break;case "RIGHT":r?D[1]=-1:t?l(a,w.AXIS_X,.5*y[0]*c):e(a,y[0]*c,0,0);break;case "ROT_LEFT":p?v.rotate_target_camera(a,2*-y[1]*c,0):v.rotate_eye_camera(a,2*y[1]*c,0);break;case "ROT_RIGHT":p?v.rotate_target_camera(a,2*y[1]*c,0):v.rotate_eye_camera(a,2*-y[1]*
c,0);break;case "ROT_UP":p?v.rotate_target_camera(a,0,2*-y[1]*c):v.rotate_eye_camera(a,0,2*y[1]*c);break;case "ROT_DOWN":p?v.rotate_target_camera(a,0,2*y[1]*c):v.rotate_eye_camera(a,0,2*-y[1]*c)}else switch(b){case "FORWARD":case "BACKWARD":r&&(D[0]=0);break;case "LEFT":case "RIGHT":r&&(D[1]=0)}r&&(C.set_character_move_dir(r,D[0],D[1]),a=v.get_camera_angles_char(a,R),C.set_character_rotation(r,a[0],a[1]))}U=!0;aa=a;ba=b;ea=c;var n=F.get_active_camera(),p=!1,r=null,t=!1;switch(v.get_move_style(n)){case v.MS_TARGET_CONTROLS:p=
!a;break;case v.MS_EYE_CONTROLS:r=F.get_first_character();break;case v.MS_STATIC:return;case v.MS_HOVER_CONTROLS:t=!0}var y=v.get_velocity_params(n,ha);a=m.create_elapsed_sensor();if(C.has_simulated_physics(n)){var z=m.create_collision_sensor(n,null,!0);m.create_sensor_manifold(n,"CAMERA_COLLISION",m.CT_CONTINUOUS,[z],null,function(a,b,c){if(1==c&&(c=m.get_sensor_payload(a,b,0).coll_dist,0>c)){var d=m.get_sensor_payload(a,b,0).coll_norm;b=Q;K.scale(d,-.25*c,b);c=N.get_translation(a,T);K.add(c,b,c);
N.set_translation_v(a,c)}})}if(r){var z=N.get_translation(n),B=N.get_rotation(n),B=w.cam_quat_to_mesh_quat(B);z[1]-=.5;C.set_transform(r,z,B);A.append_stiff_trans(n,r,[0,.5,0]);var D=new Float32Array(2),I=!0;C.set_character_move_type(r,C.CM_FLY);m.create_kb_sensor_manifold(n,"TOGGLE_CHAR_MOVE_TYPE",m.CT_SHOT,m.KEY_C,function(){I=!I;C.set_character_move_type(r,I?C.CM_FLY:C.CM_WALK)})}if(b)b=z=B=E=G=H=m.create_custom_sensor(0);else{b=m.create_keyboard_sensor(m.KEY_W);var z=m.create_keyboard_sensor(m.KEY_S),
B=m.create_keyboard_sensor(m.KEY_A),E=m.create_keyboard_sensor(m.KEY_D),G=m.create_keyboard_sensor(m.KEY_R),H=m.create_keyboard_sensor(m.KEY_F)}var J=m.create_keyboard_sensor(m.KEY_UP),V=m.create_keyboard_sensor(m.KEY_DOWN),oa=m.create_keyboard_sensor(m.KEY_LEFT),wa=m.create_keyboard_sensor(m.KEY_RIGHT);t||(m.create_sensor_manifold(n,"FORWARD",m.CT_CONTINUOUS,[a,b],null,k),m.create_sensor_manifold(n,"BACKWARD",m.CT_CONTINUOUS,[a,z],null,k));p?(m.create_sensor_manifold(n,"ROT_UP",m.CT_CONTINUOUS,[a,
J,G],g,k),m.create_sensor_manifold(n,"ROT_DOWN",m.CT_CONTINUOUS,[a,V,H],g,k),m.create_sensor_manifold(n,"ROT_LEFT",m.CT_CONTINUOUS,[a,oa,B],g,k),m.create_sensor_manifold(n,"ROT_RIGHT",m.CT_CONTINUOUS,[a,wa,E],g,k)):t?(m.create_sensor_manifold(n,"LEFT",m.CT_CONTINUOUS,[a,oa,B],g,k),m.create_sensor_manifold(n,"RIGHT",m.CT_CONTINUOUS,[a,wa,E],g,k),m.create_sensor_manifold(n,"FORWARD",m.CT_CONTINUOUS,[a,J,b],g,k),m.create_sensor_manifold(n,"BACKWARD",m.CT_CONTINUOUS,[a,V,z],g,k),m.create_sensor_manifold(n,
"UP",m.CT_CONTINUOUS,[a,H],g,k),m.create_sensor_manifold(n,"DOWN",m.CT_CONTINUOUS,[a,G],g,k)):(m.create_sensor_manifold(n,"UP",m.CT_CONTINUOUS,[a,G],g,k),m.create_sensor_manifold(n,"DOWN",m.CT_CONTINUOUS,[a,H],g,k),m.create_sensor_manifold(n,"LEFT",m.CT_CONTINUOUS,[a,B],g,k),m.create_sensor_manifold(n,"RIGHT",m.CT_CONTINUOUS,[a,E],g,k),m.create_sensor_manifold(n,"ROT_UP",m.CT_CONTINUOUS,[a,J],g,k),m.create_sensor_manifold(n,"ROT_DOWN",m.CT_CONTINUOUS,[a,V],g,k),m.create_sensor_manifold(n,"ROT_LEFT",
m.CT_CONTINUOUS,[a,oa],g,k),m.create_sensor_manifold(n,"ROT_RIGHT",m.CT_CONTINUOUS,[a,wa],g,k));if(!c){var Sa=0;c=m.create_mouse_wheel_sensor();var xa=0;b=m.create_touch_zoom_sensor();m.create_sensor_manifold(n,"MOUSE_WHEEL",m.CT_LEVEL,[c],null,function(a,b,c){1==c&&(b=m.get_sensor_value(a,b,0),v.get_velocity_params(a,y),p||t?Sa=q(a,b,y[2],Sa,p):(y[0]*=1+b*y[2],v.set_velocity_params(a,y)))});m.create_sensor_manifold(n,"TOUCH_ZOOM",m.CT_LEVEL,[b],null,function(a,b,c){1==c&&(c=m.get_sensor_value(a,
b,0),v.get_velocity_params(a,y),m.get_sensor_payload(a,b,0)===m.PL_MULTITOUCH_MOVE_ZOOM&&(xa=q(a,c,.03*y[2],xa,p)))});m.create_sensor_manifold(n,"ZOOM_INTERPOL",m.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&(p||t))if(1E-5<Math.abs(Sa)||1E-5<Math.abs(xa)){b=m.get_sensor_value(a,b,0);c=w.smooth(Sa,0,b,.1*x);Sa-=c;var d=w.smooth(xa,0,b,.15*x);xa-=d;if(t)u(a,-(c+d));else{b=v.get_pivot(a,Q);var e=v.get_eye(a,T);.001<K.dist(b,e)+c+d?N.move_local(a,0,c+d,0):(c=K.subtract(e,b,T),d=K.normalize(c,ca),K.scale(d,
.001,d),K.add(b,d,c),N.set_translation_v(a,c),xa=Sa=0)}}else xa=Sa=0})}var tb=0,Sb=0,Da=0,ta=0;c=m.create_mouse_move_sensor("X");b=m.create_mouse_move_sensor("Y");z=m.create_mouse_click_sensor();m.create_sensor_manifold(n,"MOUSE_X",m.CT_LEVEL,[z,c],null,f,"X");m.create_sensor_manifold(n,"MOUSE_Y",m.CT_LEVEL,[z,b],null,f,"Y");var Ba=0,ja=0,qc=0,pa=0;c=m.create_touch_move_sensor("X");b=m.create_touch_move_sensor("Y");m.create_sensor_manifold(n,"TOUCH_X",m.CT_LEVEL,[c],null,d,"X");m.create_sensor_manifold(n,
"TOUCH_Y",m.CT_LEVEL,[b],null,d,"Y");m.create_sensor_manifold(n,"ROT_TRANS_INTERPOL",m.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&(1E-5<Math.abs(tb)||1E-5<Math.abs(Sb)||1E-5<Math.abs(Ba)||1E-5<Math.abs(ja)||1E-5<Math.abs(Da)||1E-5<Math.abs(ta)||1E-5<Math.abs(qc)||1E-5<Math.abs(pa))){var d=m.get_sensor_value(a,b,0),e=w.smooth(tb,0,d,.08*x);b=w.smooth(Sb,0,d,.08*x);tb-=e;Sb-=b;var f=w.smooth(Ba,0,d,.12*x);c=w.smooth(ja,0,d,.12*x);Ba-=f;ja-=c;var g=w.smooth(Da,0,d,.08*x),h=w.smooth(ta,0,d,.08*x);
Da-=g;ta-=h;var k=w.smooth(qc,0,d,.12*x),d=w.smooth(pa,0,d,.12*x);qc-=k;pa-=d;p?(v.rotate_target_camera(a,e+f,b+c),v.move_pivot(a,g+k,h+d)):t?(e+f&&l(a,w.AXIS_X,.2*(e+f)),b+c&&(e=v.get_camera_angles(a,X)[1],l(a,Math.abs(e)>Math.PI/4?w.AXIS_Z:w.AXIS_Y,.2*(b+c))),v.rotate_hover_camera(a,g+k,0)):(v.rotate_eye_camera(a,.5*(e+f),.5*(b+c)),r&&(a=v.get_camera_angles_char(a,R),C.set_character_rotation(r,a[0],a[1])))}});m.create_kb_sensor_manifold(n,"DEC_STEREO_DIST",m.CT_SHOT,m.KEY_LEFT_SQ_BRACKET,function(a){var b=
v.get_stereo_distance(a);v.set_stereo_distance(a,.9*b)});m.create_kb_sensor_manifold(n,"INC_STEREO_DIST",m.CT_SHOT,m.KEY_RIGHT_SQ_BRACKET,function(a){var b=v.get_stereo_distance(a);v.set_stereo_distance(a,1.1*b)})}function G(){var a=F.get_active_camera();U=!1;for(var b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)m.remove_sensor_manifold(a,b[c]);v.get_move_style(a)==
v.MS_EYE_CONTROLS&&F.get_first_character()&&A.remove(a)}function D(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var l=document.getElementById(d[h]);l&&l.parentNode.removeChild(l)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=
b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function B(a,b,c,d,e){function f(){var h=performance.now()-g;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&J.remove_loop_cb(f)}var g=performance.now();J.append_loop_cb(f)}p("animation");var v=p("camera"),E=p("config"),A=p("constraints"),r=p("container"),m=p("controls"),y=p("data"),t=p("debug"),J=p("main"),C=p("physics"),I=p("print"),F=p("scenes"),
N=p("transform"),w=p("util"),K=p("vec3"),x=1,V=null,U=!1,aa=!1,ba=!1,ea=!1,R=new Float32Array(2),X=new Float32Array(2),Q=new Float32Array(3),T=new Float32Array(3),ca=new Float32Array(3),oa=new Float32Array(4),ha=new Float32Array(3);a.init=function(a){function e(){var a=c(l,I,F,p),f=r.get_canvas();if(a){var m=r.get_container();n();J.set_check_gl_errors(v);B&&(b(q,u),J.set_fps_callback(k));x&&d();t&&J.append_loop_cb(function(){m.style.height=m.clientWidth/t+"px"});h&&J.append_loop_cb(function(){var a=
m.clientWidth,b=m.clientHeight;a==f.clientWidth&&b==f.clientHeight||J.resize(a,b,!0)});C&&J.append_loop_cb(function(){r.force_offsets_updating()});g(f,!0)}else g(f,!1)}function f(a){a.keyCode==m.KEY_P&&(J.is_paused()?J.resume():J.pause())}function g(){}a=a||{};var h=!1,l=null,p=null,q=null,t=0,u=null,v=!1,w=!0,x=!0,F=!0,z=!1,B=!1,A=!1,C=!1,D;for(D in a)switch(D){case "canvas_container_id":l=a.canvas_container_id;break;case "callback":g=a.callback;break;case "autoresize":h=a.autoresize;break;case "do_not_use_onload":break;
case "gl_debug":v=a.gl_debug;break;case "show_hud_debug_info":A=a.show_hud_debug_info;break;case "sfx_mix_mode":z=a.sfx_mix_mode;break;case "show_fps":B=a.show_fps;break;case "track_container_position":C=a.track_container_position;break;case "fps_wrapper_id":u=a.fps_wrapper_id;break;case "fps_elem_id":q=a.fps_elem_id;break;case "error_purge_elements":p=a.error_purge_elements;break;case "report_init_failure":F=a.report_init_failure;break;case "pause_invisible":x=a.pause_invisible;break;case "key_pause_enabled":w=
a.key_pause_enabled;break;case "force_container_ratio":t=a.force_container_ratio;break;default:E.set(D,a[D])}w&&document.addEventListener("keydown",f,!1);E.set("show_hud_debug_info",A);E.set("sfx_mix_mode",z);var I=A||z||null;"complete"==document.readyState?window.setTimeout(e,0):window.addEventListener("load",e,!1);window.addEventListener("unload",function(){y.cleanup()},!1)};a.resize_to_container=n;a.set_onclick=function(a,b){var c=f(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=
function(a,b){var c=f(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=f(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=z;a.disable_camera_controls=G;a.set_camera_move_style=function(a){var b=U;b&&G();var c=F.get_active_camera();v.set_move_style(c,a);b&&z(aa,ba,ea)};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,e){if(1==e)switch(e=
m.get_sensor_value(a,b,0),b){case "FORWARD":d?C.vehicle_throttle(a,1):N.move_local(a,0,0,1*e);break;case "BACKWARD":d?C.vehicle_throttle(a,-1):N.move_local(a,0,0,-1*e);break;case "LEFT":d?C.vehicle_steer(a,-1):N.move_local(a,1*e,0,0);break;case "RIGHT":d?C.vehicle_steer(a,1):N.move_local(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&C.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&C.vehicle_steer(a,0)}}var d=C.is_vehicle_chassis(a)||C.is_vehicle_hull(a),e=m.create_elapsed_sensor(),
f=m.create_keyboard_sensor(m.KEY_W),g=m.create_keyboard_sensor(m.KEY_S),h=m.create_keyboard_sensor(m.KEY_A),l=m.create_keyboard_sensor(m.KEY_D),k=m.create_keyboard_sensor(m.KEY_UP),n=m.create_keyboard_sensor(m.KEY_DOWN),p=m.create_keyboard_sensor(m.KEY_LEFT),q=m.create_keyboard_sensor(m.KEY_RIGHT);m.create_sensor_manifold(a,"FORWARD",m.CT_CONTINUOUS,[e,f,k],b,c);m.create_sensor_manifold(a,"BACKWARD",m.CT_CONTINUOUS,[e,g,n],b,c);m.create_sensor_manifold(a,"LEFT",m.CT_CONTINUOUS,[e,h,p],b,c);m.create_sensor_manifold(a,
"RIGHT",m.CT_CONTINUOUS,[e,l,q],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)m.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){var b=r.get_container();a=a||!1;m.register_keyboard_events(document,!1);m.register_mouse_events(b,!0,a);m.register_wheel_events(b,!0);m.register_touch_events(b,!0);m.register_device_orientation()};a.disable_controls=function(){var a=r.get_container();m.unregister_keyboard_events(document);m.unregister_mouse_events(a);
m.unregister_wheel_events(a);m.unregister_touch_events(a);m.unregister_device_orientation()};a.enable_debug_controls=function(){m.create_kb_sensor_manifold(null,"CAMERA_SHOT",m.CT_SHOT,m.KEY_K,function(){t.make_camera_frustum_shot()});m.create_kb_sensor_manifold(null,"LIGHT_SHOT",m.CT_SHOT,m.KEY_L,function(){t.make_light_frustum_shot()});m.create_kb_sensor_manifold(null,"TELEMETRY",m.CT_SHOT,m.KEY_T,function(){t.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===
a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",
d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=
typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=D;a.get_url_params=function(a){a=!!a;var b=location.href.toString();if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?
(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g,h){function l(e){a&&(k[b]=f+e+g,c>d&&e<=d||c<d&&e>=d)&&(k[b]=f+d+g,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var k=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==k[b])if(void 0!=k["webkit"+m])b="webkit"+m;else if(void 0!=k["ms"+m])b="ms"+m;else if(void 0!=k["moz"+m])b="moz"+m;else return;B(a,c,d,e,l)}};a.attr_animate=function(a,
b,c,d,e,f){function g(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),f())}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},B(a,c,d,e,g))};a.queue_animate=function(b){if(b.length){var c=b.shift(),d=c.elem,e=c.prop,f=c.from,g=c.to,h=c.duration,l=c.opt_prefix,k=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,f,g,h,l,k,m):"attr"==c.type&&a.attr_animate(d,e,f,g,h,m)}};a.set_camera_smooth_factor=function(a){x=a};a.get_camera_smooth_factor=
function(){return x}};b4w.module.camera_anim=function(a,p){function d(a,b,c,d){b=e.angle_wrap_0_2pi(a-b);a=e.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var c=p("camera"),b=p("controls"),k=p("print"),f=p("scenes"),n=p("time"),l=p("transform"),u=p("tsr"),e=p("util"),h=p("vec3"),g=p("quat"),q=new Float32Array(2),z=new Float32Array(2),G=new Float32Array(3),D=new Float32Array(3),B=new Float32Array(3),v=new Float32Array(4),
E=new Float32Array(2),A=new Float32Array(2),r=new Float32Array(8),m=new Float32Array(8),y=new Float32Array(8),t=!1,J=!1,C=!1,I=!1;a.track_to_target=function(a,d,f,m,n,p,r,t){if(!c.is_eye_camera(a))k.error("track_to_target(): wrong object");else if(a&&d){if(e.is_vector(d))var u=d;else u=B,l.get_object_center(d,!1,u);d=f||1;f=m||2;var y=n||1;n=p||1;D[0]=0;D[1]=-1;D[2]=0;var z=l.get_rotation(a);p=e.quat_to_dir(z,D);m=c.get_camera_angles(a,q);var A=l.get_translation(a);h.subtract(u,A,G);h.normalize(G,
G);var C=g.rotationTo(p,G,g.create());g.multiply(C,z,v);e.correct_cam_quat_up(v,!1);h.subtract(u,A,D);var I=h.length(D)*(1-1/f),u=Math.asin(G[1]);f=Math.acos(-G[2]/Math.abs(Math.cos(u)));0<G[0]&&(f=2*Math.PI-f);var E=f-m[0],J=u-m[1];B[0]=0;B[1]=0;B[2]=-1;f=l.get_rotation(a);0>e.quat_to_dir(f,B)[1]?(J=0<p[1]?u-Math.PI+m[1]:u+Math.PI+m[1],E=0<E?-Math.PI+E:Math.PI+E):Math.abs(E)>Math.PI&&(E=0<E?E-2*Math.PI:E+2*Math.PI);var ha=0,u=b.create_elapsed_sensor();p=Math.abs(E/d);d=Math.abs(J/d);var na=p>d?p:
d,ma=na+y,W=ma+n,M=W+y,O=E,S=J,ra=I,P=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");r&&r()};b.create_sensor_manifold(a,"TRACK_TO_TARGET",b.CT_CONTINUOUS,[u],null,function(a,d,e){if(e)if(c.is_eye_camera(a))if(e=b.get_sensor_value(a,d,0),ha+=e,ha<na){var f=E/na*e;e*=J/na;d=ha/na;d=6*d*(1-d);f*=d;e*=d;O-=f;S-=e;c.rotate_eye_camera(a,f,e)}else ha<ma?(O&&(c.rotate_eye_camera(a,O,S),O=0,t&&t()),d=(ha-na)/y,e=-I*e/y,ra-=f,l.move_local(a,0,6*e*d*(1-d),0)):ha<W?ra&&(l.move_local(a,0,ra,0),ra=0):
ha<M?(d=(ha-W)/y,e=I*e/y,e=6*e*d*(1-d),l.move_local(a,0,e,0)):(l.set_translation_v(a,A),P());else P()})}};a.auto_rotate=function(a,g){function h(f,g,k){if(1==k)if(k=c.get_move_style(f),k==c.MS_STATIC)l();else if(k!=c.MS_HOVER_CONTROLS&&c.has_horizontal_limits(f)){k=c.get_horizontal_limits(f,A);if(null===n||k[0]!=n[0]||k[1]!=n[1]){n=n||E;n.set(k);p=Math.min(.2,e.angle_wrap_0_2pi(n[1]-n[0])/2);k=n;var t=c.get_camera_angles(m,q)[0];k=d(t,k[0],k[1],z);r=a*Math.min(1,k[0]/.2,k[1]/.2)}g=b.get_sensor_value(f,
g,0);k=c.get_camera_angles(f,q)[0];k=d(k,n[0],n[1],z);k[1]>p&&k[0]>p?r=e.sign(r)*a:k[1]<p?r-=Math.pow(a,2)/.4*g:k[0]<p&&(r+=Math.pow(a,2)/.4*g);c.rotate_camera(f,g*r,0)}else n=null,g=b.get_sensor_value(f,g,0),c.rotate_camera(f,g*a,0)}function l(){b.remove_sensor_manifold(m,"AUTO_ROTATE");b.remove_sensor_manifold(m,"DISABLE_AUTO_ROTATE");g()}g=g||function(){};var m=f.get_active_camera();if(c.get_move_style(m)==c.MS_STATIC)k.error("auto_rotate(): wrong camera type");else{var n=null,p=0,r=0;if(b.check_sensor_manifold(m,
"AUTO_ROTATE"))l();else{var t=b.create_mouse_move_sensor("X"),u=b.create_mouse_move_sensor("Y"),v=b.create_mouse_click_sensor(),y=b.create_touch_move_sensor(),B=b.create_touch_zoom_sensor(),C=b.create_elapsed_sensor();b.create_sensor_manifold(m,"DISABLE_AUTO_ROTATE",b.CT_LEVEL,[t,u,v,y,B],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},l);b.create_sensor_manifold(m,"AUTO_ROTATE",b.CT_CONTINUOUS,[C],function(a){return a[0]},h)}}};a.is_auto_rotate=function(){var a=f.get_active_camera();return b.check_sensor_manifold(a,
"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=f.get_active_camera();return c.get_move_style(a)==c.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,b,d,f,g){if(c.get_move_style(a)!=c.MS_STATIC)k.error("move_camera_to_point(): wrong camera type");else if(!t)if(a)if(b){d=d||1;f=f||.01;var p=e.is_vector(a)?a:l.get_tsr(a,r),q=e.is_vector(b)?b:l.get_tsr(b,m);b=h.distance(u.get_trans_view(p),u.get_trans_view(q))/d;d=e.quat_to_dir(u.get_quat_view(p),e.AXIS_MY,G);var v=e.quat_to_dir(u.get_quat_view(q),
e.AXIS_MY,D);d=Math.min(Math.abs(h.dot(d,v)),1);f=1E3*Math.max(b,Math.acos(d)/f);t=!0;var z=n.animate(0,1,f,function(b){var c=u.interpolate(p,q,e.smooth_step(b),y);C?(n.clear_animation(z),t=C=!1):(l.set_tsr(a,c),1==b&&(t=!1,g&&g()))})}else k.error("move_camera_to_point(): you must specify the point object");else k.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=function(a,b,d,e,f){if(!J)if(a)if(b||d){J=!0;var g=0,h=0,l=0!=b?b:d,m=n.animate(0,l,e||1E3,function(e){I?
(n.clear_animation(m),J=I=!1):(g-=e,h-=e,d&&b?c.rotate_camera(a,g,h):d?c.rotate_camera(a,0,h):b&&c.rotate_camera(a,g,0),h=g=e,e==l&&(J=!1,f&&f()))})}else k.error("rotate_camera(): you must specify the rotation angle");else k.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){C=!0};a.stop_cam_rotating=function(){I=!0};a.is_moving=function(){return t};a.is_rotating=function(){return J}};b4w.module.gyroscope=function(a,p){function d(a){var b=c.create_gyro_angles_sensor(),d=!0;c.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",c.CT_CONTINUOUS,[b],null,function(a,b,g){if(0<g){n=c.get_sensor_payload(a,b,0);d&&(f[0]=n[0],f[1]=n[1],f[2]=n[2],d=!1);g=b=0;0==window.orientation&&(b=n[1]-f[1],g=n[0]-f[0],n[1]>u&&n[1]<l&&(g=0));if(180==window.orientation){b=n[1]-f[1];0>n[1]&&(b=-b);g=f[0]-n[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;n[1]>-l&&n[1]<-u&&(g=0)}if(-90==window.orientation){b=n[0]-f[0];if(b>
Math.PI/2||b<-Math.PI/2)b=0;g=f[1]-n[1];if(n[0]>e||n[0]<h)g=0}if(90==window.orientation){b=f[0]-n[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;g=n[1]-f[1];if(n[0]>e||n[0]<h)g=0}k.rotate_camera(a,g,b);f[0]=n[0];f[1]=n[1];f[2]=n[2]}})}var c=p("controls"),b=p("scenes"),k=p("camera"),f=new Float32Array(3),n=new Float32Array(3),l=110*Math.PI/180,u=70*Math.PI/180,e=70*Math.PI/180,h=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=b.get_active_camera();d(a)}};b4w.module.mixer=function(a,p){function d(){B=D.length=0;v=c();E=new Float32Array(v.length);A=new Float32Array(v.length);var a=z.get_speaker_objects();if(a.length){D.push(b());for(var d=0;d<a.length;d++)D.push(f(a[d]));D.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function c(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/
99;return a}function b(){var a=k("MASTER");a.O.push(["VOLUME",z.get_volume(null),0,1,50,!1]);var b=z.get_compressor_params();b&&(a.O.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.O.push(["KNEE",b.knee,0,40,40,!1]),a.O.push(["RATIO",b.ratio,1,20,20,!1]),a.O.push(["ATTACK",b.attack,0,1,1E3,!1]),a.O.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=z.is_muted(null)?1:0;a.sd=-1;return a}function k(a){return{id:a,O:[],ig:0,mute:-1,sd:-1,Ea:null}}function f(a){var b=k(q.get_object_name(a));b.mute=z.is_muted(a)?
1:0;b.sd=0;b.Ea=a;return b}function n(a){if(a.Ea){a.O.length=0;a.O.push(["VOLUME",z.get_volume(a.Ea),0,1,50,!1]);var b=z.get_positional_params(a.Ea);b&&(a.O.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.O.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.O.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=z.get_filter_params(a.Ea))a.O.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.O.push(["EQ_Q",b.Q,0,10,100,!1]),a.O.push(["EQ_GAIN",b.gain,-70,30,100,!1]);G.clamp(a.ig,0,a.O.length-1)}}function l(a){for(var b=
0;b<D.length;b++){var c=D[b];if(c!=a&&1==c.sd)return!0}return!1}function u(a){for(var b=0;b<D.length;b++){var c=D[b];c!=a&&0==c.mute&&0==c.sd&&z.mute(c.Ea,!1)}}function e(){if(0==D.length)return[0,-1];var a=8*Math.floor(B/8),b=a+7,a=G.clamp(a,0,D.length-1),b=G.clamp(b,0,D.length-1);return[a,b]}var h=p("controls");p("debug");var g=p("hud"),q=p("scenes"),z=p("sfx"),G=p("util"),D=[],B=0,v=null,E=null,A=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(h.get_sensor_value(b,
c,2))?-1:1,f=D[B];if(f)switch(d=f.O[f.ig],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=G.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?z.set_volume(f.Ea,d[1]):z.set_volume(null,d[1]);break;case "DIST_REF":e=z.get_positional_params(f.Ea);e.dist_ref=d[1];z.set_positional_params(f.Ea,e);break;case "ATTENUATION":e=z.get_positional_params(f.Ea);e.attenuation=d[1];z.set_positional_params(f.Ea,e);break;case "DIST_MAX":e=z.get_positional_params(f.Ea);e.dist_max=d[1];z.set_positional_params(f.Ea,
e);break;case "EQ_FREQ":e=z.get_filter_params(f.Ea);e.freq=d[1];z.set_filter_params(f.Ea,e);break;case "EQ_Q":e=z.get_filter_params(f.Ea);e.Q=d[1];z.set_filter_params(f.Ea,e);break;case "EQ_GAIN":e=z.get_filter_params(f.Ea);e.gain=d[1];z.set_filter_params(f.Ea,e);break;case "THRESHOLD":f=z.get_compressor_params();f.threshold=d[1];z.set_compressor_params(f);break;case "KNEE":f=z.get_compressor_params();f.knee=d[1];z.set_compressor_params(f);break;case "RATIO":f=z.get_compressor_params();f.ratio=d[1];
z.set_compressor_params(f);break;case "ATTACK":f=z.get_compressor_params();f.attack=d[1];z.set_compressor_params(f);break;case "RELEASE":f=z.get_compressor_params();f.release=d[1];z.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?h.reset_timer_sensor(b,c,6,.35):h.reset_timer_sensor(b,c,6,.05)}else h.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(h.get_sensor_value(a,c,0))?-1:1;if(D.length){1==d&&B<D.length-1?B++:-1==d&&0<B&&B--;d=e();for(var f=d[0];f<=
d[1];f++)n(D[f])}"SWITCH_STRIP"==c?h.reset_timer_sensor(a,c,5,.15+.3):h.reset_timer_sensor(a,c,5,.15)}else h.reset_timer_sensor(a,c,5,10)}d();var c=h.create_keyboard_sensor(h.KEY_LEFT_SQ_BRACKET),f=h.create_keyboard_sensor(h.KEY_RIGHT_SQ_BRACKET),k=h.create_keyboard_sensor(h.KEY_SEMI_COLON),p=h.create_keyboard_sensor(h.KEY_SINGLE_QUOTE),q=h.create_keyboard_sensor(h.KEY_SHIFT),F=h.create_timer_sensor(.15,!0),N=h.create_timer_sensor(.05,!0),c=[c,f,k,p,q,F,N];h.create_sensor_manifold(null,"SWITCH_STRIP",
h.CT_TRIGGER,c,function(a){return(a[0]||a[1])&&!a[4]},b);h.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",h.CT_SHOT,c,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);h.create_sensor_manifold(null,"SWITCH_PARAM",h.CT_SHOT,c,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(h.get_sensor_value(a,b,0))?-1:1,d=D[B];d&&(1==c&&d.ig<d.O.length-1?d.ig++:-1==c&&0<d.ig&&d.ig--)});h.create_sensor_manifold(null,"INC_DEC",h.CT_TRIGGER,c,function(a){return(a[2]||a[3])&&!a[4]},a);h.create_sensor_manifold(null,
"INC_DEC_HOLD",h.CT_SHOT,c,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);h.create_sensor_manifold(null,"MUTE_SOLO",h.CT_SHOT,c,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(h.get_sensor_value(a,b,2))){var c=D[B];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,z.mute(c.Ea,!0),1==c.sd&&(c.sd=0,l(c)||u(c))):(c.mute=0,l(c)||z.mute(c.Ea,!1)):0==c.mute?(c.mute=1,z.mute(null,!0)):(c.mute=0,z.mute(null,!1)))}else if((c=D[B])&&0<=c.sd)if(0==c.sd){c.sd=1;z.mute(c.Ea,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<D.length;d++){var e=D[d];e!=c&&0==e.mute&&0==e.sd&&z.mute(e.Ea,!0)}}else c.sd=0,l(c)?z.mute(c.Ea,!0):u(c)});c=h.create_elapsed_sensor();h.create_sensor_manifold(null,"MIXER_DRAW",h.CT_CONTINUOUS,[c],null,function(){if(D[B])for(var a=e(),b=a[0];b<=a[1];b++){var c=D[b];g.draw_mixer_strip(c.id,b==B,b%8,c.O,c.ig,c.mute,c.sd);if(c.Ea&&z.get_filter_params(c.Ea)){z.get_filter_freq_response(c.Ea,v,E,A);for(c=0;c<E.length;c++)E[c]=20*Math.log(E[c])/Math.LN10;g.plot_array("EQ",b%8,E,20,2E4,
-10,10)}}});c=h.create_timer_sensor(1,!0);h.create_sensor_manifold(null,"MIXER_UPDATE",h.CT_TRIGGER,[c],null,function(){for(var a=e(),b=a[0];b<=a[1];b++)n(D[b])})}};b4w.module.npc_ai=function(a,p){function d(a,b){var c=b.destination,d=B;q.get_translation(b.empty,d);var e=v;q.get_translation(b.collider,e);var f=0;b.$i?f=b.$i:b.Xe&&(f=b.Xe,b.type==t&&(f*=.5),b.type==C&&(f*=a));switch(b.type){case t:if(b.random&&b.If){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var g=m,d=E,k=b.speed,p=b.rot_speed;q.get_rotation(b.collider,g);G.transformQuat(z.AXIS_Z,g,d);d[1]=0;G.normalize(d,d);g=.5*k/Math.sin(p/2);k=G.dist(c,e);k<2*g&&G.scaleAndAdd(c,
d,2*g-k,c);b.If=!1}c[1]=e[1];f&&(c[1]+=f);break;case J:case C:b.random&&b.If&&(b.type==C?(b.speed=Math.random()+.1,g=b.CC-b.IC):g=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=e[1]+(Math.random()*g-.5*g),c[2]=10*Math.random()-5+d[2],b.If=!1),f&&(c[1]=e[1]+f)}var c=B,d=v,k=E,e=y,u=b.rig,g=b.collider,f=b.destination,D=b.speed,R=b.actions,X=l.get_current_anim_name(u);if(!l.is_play(u)||!R.Sj||-1==R.Sj.indexOf(X)){q.get_translation(g,c);var p=f[0]-c[0],Q=f[2]-c[2],p=Math.sqrt(p*p+Q*Q);if(p>
2*D*a)b.state=20,z.xz_direction(f,c,k),R=b.rig,l.is_animated(R)&&(u=b.speed,D=l.get_frame(R),R=l.get_anim_length(R),u*=R/24*(1-D/R),.9>p/u&&G.scaleAndAdd(f,k,u-p,f)),p=m,u=A,q.get_rotation(b.collider,p),G.transformQuat(z.AXIS_Z,p,d),u[0]=d[0],u[1]=0,u[2]=d[2],G.normalize(u,u),D=G.dot(u,k),R=a/(Math.abs(Math.acos(D))/Math.PI)*b.rot_speed*b.Sp,h.rotationTo(u,k,e),h.rotationTo(z.AXIS_Z,u,p),1<=Math.abs(D)?h.copy(p,e):(h.multiply(e,p,e),h.slerp(p,e,Math.min(R,1),e)),k=a,b.type!=J&&(k=Math.max(k,1/60),
p=r,u=m,h.setAxisAngle(z.AXIS_X,-Math.asin(d[1]),u),h.setAxisAngle(z.AXIS_X,-Math.atan(b.Xe/(b.speed*k)),p),h.slerp(u,p,k,p),h.multiply(e,p,e)),q.set_rotation_v(g,e),d=E,g=A,z.quat_to_dir(e,z.AXIS_Z,d),G.scale(d,b.speed*a,g),G.add(g,c,g),g[1]=b.type!=t?(f[1]-c[1])*a*.1+c[1]:f[1],q.set_translation_v(b.collider,g);else if(b.type==t)R.move?X&&-1!=R.move.indexOf(X)&&l.is_play(u)?b.state=20:(b.state=10,b.If=!0):(b.state=10,b.If=!0);else if(b.type==C||b.type==J)b.If=!0;if(n(b)&&(c=b.rig,!l.is_play(c))){e=
null;switch(b.state){case 10:e=b.actions;e=e.Sj?z.random_from_array(e.Sj):null;break;case 20:e=l.get_current_anim_name(b.rig),d=f=b.actions,d.Ke&&-1==d.Ke.indexOf(e)&&d.move&&-1!=d.move.indexOf(e)&&.33<Math.random()?(f=b.actions,e=f.Ke[f.move.indexOf(e)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(e)||!d.Ke&&!d.xf||!d.xf&&!e||d.Ke&&-1!=d.Ke.indexOf(e)||d.xf&&-1!=d.xf.indexOf(e))?(f=b.actions,f.Ke?(d=f.Ke.indexOf(e),-1!=d?(e=d+1,e=e<f.move.length?e:0,e=f.move[e]):e=-1!=f.move.indexOf(e)?e:z.random_from_array(f.move)):
e=z.random_from_array(f.move)):(d=b.actions,e=d.xf&&-1==d.xf.indexOf(e)&&d.move&&-1==d.move.indexOf(e)?z.random_from_array(f.xf):null))}e&&(l.apply(c,e),l.set_behavior(c,l.AB_FINISH_RESET),l.set_frame(c,0),l.play(c))}}}function c(a,b,c,d){if(d)if(1==c)switch(d.type){case J:a:{for(c=0;3>c;c++){var e=u.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.Xe=a<d.min_height?10:a>d.max_height?-10:0;break;case t:a=u.get_sensor_payload(a,b,0).hit_fract;d.Xe=d.vu==a?0:1-100*a;d.vu=a;
break;case C:a=u.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.Xe=100*a-1,d.Xe=.1>d.Xe?.05:0):"CLOSE_WATER"==b&&(d.$i=100*a,d.$i=d.$i<d.IC?-.02:d.$i>d.CC?.02:0)}else d.Xe=0}function b(){for(var a=0;a<D.length;a++){var b=D[a];k(b);f(b);b.rig&&l.get_current_anim_name(b.rig)&&l.play(b.rig)}}function k(a){var b=G.create(),d=a.collider;switch(a.type){case J:var e=u.create_ray_sensor(d,b,[0,-100,0],"TERRAIN",!0),f=u.create_ray_sensor(d,b,[0,-100,0],"STONE",!0),b=u.create_ray_sensor(d,b,[0,-100,
0],"WATER",!0),e=[e,f,b];u.create_sensor_manifold(d,"CLOSE_GROUND",u.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},c,a);break;case t:e=u.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];u.create_sensor_manifold(d,"CLOSE_GROUND",u.CT_CONTINUOUS,e,null,c,a);break;case C:e=u.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0),b=u.create_ray_sensor(d,b,[0,100,0],"WATER",!0),e=[e],u.create_sensor_manifold(d,"CLOSE_WATER",u.CT_CONTINUOUS,[b],null,c,a),u.create_sensor_manifold(d,"CLOSE_GROUND",
u.CT_CONTINUOUS,e,null,c,a)}}function f(a){function b(c,d,e){1==e?(q.get_translation(a.empty,a.destination),a.Sp=4):a.Sp=1}var c=a.collider;if(a.type==t){var d=u.create_collision_sensor(c,"CONSTRUCTION",!1);u.create_sensor_manifold(c,"CONSTRUCTION_COLL",u.CT_CONTINUOUS,[d],null,b)}}function n(a){var b=a.rig;if(!l.is_play(b))return!0;b=l.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.Sj)return!1;if(-1==c.Sj.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||
c.xf&&-1!=c.xf.indexOf(b)||c.Ke&&-1!=c.Ke.indexOf(b))return!1;break;default:return!1}return!0}var l=p("animation"),u=p("controls"),e=p("main"),h=p("quat"),g=p("scenes"),q=p("transform"),z=p("util"),G=p("vec3"),D=[];new Float32Array(9);var B=new Float32Array(3),v=new Float32Array(3),E=new Float32Array(3),A=new Float32Array(3),r=new Float32Array(4),m=new Float32Array(4),y=new Float32Array(4),t=a.NT_WALKING=10,J=a.NT_FLYING=20,C=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);
a.start=[];a.ended=[];a.Jl=[];a.Xe=null;a.vu=null;a.$i=null;a.If=!0;a.Sp=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.Jl[b]=!1;D.push(a)};a.enable_animation=function(){if(D.length){b();var a=u.create_elapsed_sensor();u.create_sensor_manifold(D[0].collider,"ELAPSED",u.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=u.get_sensor_value(a,b,0),b=0;b<D.length;b++){c=D[b];var f=a;if(g.is_visible(c.obj))if(c.random)d(f,c);else{for(var h=e.global_timeline(),
k=0;k<c.path.length;k++)if(!c.ended[k]){c.Jl[k]||(c.Jl[k]=!0,c.destination[0]=c.path[k][0],c.destination[1]=c.path[k][1],c.destination[2]=c.path[k][2],c.start[k]=h+c.delay[k]);if(h<c.start[k])break;d(f,c);c.ended[k]=c.If;break}a:{for(f=0;f<c.path.length;f++)if(0==c.ended[f]){f=!1;break a}f=!0}if(f)for(f=0;f<c.path.length;f++)c.Jl[f]=!1,c.ended[f]=!1}}})}};a.disable_animation=function(){if(!(0>=D.length))for(var a=0;a<D.length;a++){var b=D[a];u.check_sensor_manifolds(b.collider)&&u.remove_sensor_manifold(b.collider);
l.is_play(b.rig)&&l.stop(b.rig)}}};b4w.module.mouse=function(a,p){function d(){1==C&&(C=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);q.remove_sensor_manifold(D.get_active_camera(),"SMOOTH_PL")}function c(a){2==C&&(C=0);a.removeEventListener("mousedown",k,!1);a.removeEventListener("mouseup",f,!1);a.removeEventListener("mousemove",b,!1);q.remove_sensor_manifold(D.get_active_camera(),"SMOOTH_DRAG")}function b(a){t()&&(m[0]+=2*(a.clientX-A),m[1]+=
2*(a.clientY-r),A=a.clientX,r=a.clientY);a.preventDefault()}function k(a){A=a.clientX;r=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function f(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function n(a,b){if(.01<Math.abs(m[0])||.01<Math.abs(m[1])){var c=q.get_sensor_value(a,b,0),d=B.smooth(m[0],0,c,.1*E),e=B.smooth(m[1],0,c,.1*E),c=D.get_first_character(),f=D.get_active_camera();h.rotate_eye_camera(f,4E-4*-d,4E-4*-e);m[0]-=d;m[1]-=
e;c&&(d=h.get_camera_angles_char(f,y),z.set_character_rotation(c,d[0],d[1]))}}function l(){v.detect_mobile()||v.get_canvas_elem().addEventListener("mousemove",e)}function u(){v.detect_mobile()||(v.get_canvas_elem().removeEventListener("mousemove",e),J&&D.set_outline_intensity(J,0))}function e(a){a=g.client_to_canvas_coords(a.clientX,a.clientY,y);(a=D.pick_object(a[0],a[1]))?(D.outlining_is_enabled(a)&&D.set_outline_intensity(a,1),D.outlining_is_enabled(J)&&a!=J&&D.set_outline_intensity(J,0)):D.outlining_is_enabled(J)&&
D.set_outline_intensity(J,0);J=a}var h=p("camera"),g=p("container"),q=p("controls"),z=p("physics"),G=p("print"),D=p("scenes"),B=p("util"),v=p("main"),E=1,A=0,r=0,m=new Float32Array(2),y=new Float32Array(2),t=null,J=null,C=0;a.request_pointerlock=function(a,b,d,e,f){function g(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){c(a);a.addEventListener("mousemove",e,!1);var f=D.get_active_camera();if(!q.check_sensor_manifold(f,"SMOOTH_PL")){var h=
q.create_elapsed_sensor();q.create_sensor_manifold(f,"SMOOTH_PL",q.CT_CONTINUOUS,[h],null,n)}b()}else a.removeEventListener("mousemove",e,!1),C=0,document.removeEventListener("pointerlockchange",g,!1),document.removeEventListener("webkitpointerlockchange",g,!1),document.removeEventListener("mozpointerlockchange",g,!1),d()}if(1!=C){C=1;b=b||function(){};d=d||function(){};f=f||function(){return!0};e=e||function(a){if(f()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==
typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;m[0]+=b;m[1]+=a}};document.addEventListener("pointerlockchange",g,!1);document.addEventListener("webkitpointerlockchange",g,!1);document.addEventListener("mozpointerlockchange",g,!1);var h=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof h?h.apply(a):G.error("Pointer lock is not available")}};a.exit_pointerlock=d;
a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b){if(2!=C){C=2;d();t=b||function(){return!0};a.addEventListener("mousedown",k,!1);a.addEventListener("mouseup",f,!1);var c=D.get_active_camera();if(!q.check_sensor_manifold(c,"SMOOTH_DRAG")){var e=q.create_elapsed_sensor();q.create_sensor_manifold(c,"SMOOTH_DRAG",q.CT_CONTINUOUS,[e],null,n)}}};a.exit_mouse_drag=c;a.enable_mouse_hover_outline=
l;a.enable_mouse_hover_glow=function(){G.error("enable_mouse_hover_glow() deprecated, use enable_mouse_hover_outline() instead");l()};a.disable_mouse_hover_outline=u;a.disable_mouse_hover_glow=function(){G.error("disable_mouse_hover_glow() deprecated, use disable_mouse_hover_outline() instead");u()};a.get_coords_x=function(a){return"clientX"in a?a.clientX:a.touches&&"clientX"in a.touches[0]?a.touches[0].clientX:-1};a.get_coords_y=function(a){return"clientY"in a?a.clientY:a.touches&&"clientY"in a.touches[0]?
a.touches[0].clientY:-1};a.set_plock_smooth_factor=function(a){E=a};a.get_plock_smooth_factor=function(){return E}};b4w.module.preloader=function(a,p){var d=p("app"),c,b,k,f,n,l,u,e,h,g=null;a.create_simple_preloader=function(a){var d=null,e=null,h="#bf9221",p="#000",u;for(u in a)switch(u){case "canvas_container_id":d=a.canvas_container_id;break;case "background_container_id":e=a.background_container_id;break;case "bg_color":p=a.bg_color;break;case "bar_color":h=a.bar_color;break;case "preloader_fadeout":c=a.preloader_fadeout}a=document.createElement("div");u=document.createElement("div");a.id="simple_preloader_container";
var E=document.createElement("div"),A=document.createElement("div"),e=document.getElementById(e);g=document.getElementById(d);a.style.cssText="z-index: 4;background-color: "+p+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";u.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";E.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
h+";border-radius: 0px;";A.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+u.appendChild(E);u.appendChild(A);a.appendChild(u);document.body.appendChild(a);b="SIMPLE";k=a;f=E;n=A;l=e};a.create_rotation_preloader=function(a){var c=null,d=null,e="rgba(0,0,0,0)",f="",h="",p="rgba(0,0,0,0)",A;for(A in a)switch(A){case "canvas_container_id":c=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":e=a.frame_bg_color;break;case "bg_color":p=a.bg_color;break;case "frame_class":f=a.frame_class;break;case "anim_elem_class":h=a.anim_elem_class}a=document.createElement("div");A=document.createElement("div");var r=document.createElement("div"),m=document.createElement("div"),d=document.getElementById(d);g=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+p+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
A.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+e+";";r.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";m.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";r.className=h;A.appendChild(r);A.className=f;A.appendChild(m);
a.appendChild(A);g.appendChild(a);b="ROTATION";k=a;u=r;n=m;l=d};a.create_advanced_preloader=function(a){var c=a.preloader_width,c=c/(c-a.img_width),d=document.getElementById(a.preloader_bar_id),p=document.getElementById(a.fill_band_id),u=document.getElementById(a.preloader_caption_id),v=document.getElementById(a.preloader_container_id),E=document.getElementById(a.background_container_id);g=document.getElementById(a.canvas_container_id);b="ADVANCED";f=d;e=p;h=c;n=u;k=v;l=E};a.update_preloader=function(a){n.innerHTML=
a+"%";"SIMPLE"==b&&(f.style.width=a+"%");"ADVANCED"==b&&(f.style.width=a/h+"%",e.style.width=100-a+"%");"ROTATION"==b&&(u.style.transform="rotate("+a+"deg)");100==a&&(c?(d.css_animate(l,"opacity",1,0,1500,null,null,function(){l.parentNode.removeChild(l)}),d.css_animate(k,"opacity",1,0,1E3,null,null,function(){k.parentNode.removeChild(k)})):(k.parentNode.removeChild(k),l&&l.parentNode.removeChild(l)))}};b4w.module.storage=function(a,p){function d(a){k=a;try{f=window.localStorage}catch(c){b.warn("Applying chrome localStorage bug workaround"),f=null}f||(b.warn("localStorage is not available, initializing temporary storage"),f={})}function c(){return f[k]?JSON.parse(f[k]):{}}var b=p("__print"),k="",f=null;a.init=d;a.set=function(a,b){var d=c();d[a]=String(b);f[k]=JSON.stringify(d)};a.cleanup=function(){delete f[k]};a.get=function(a){var b=c();return b[a]?b[a]:""};a.debug=function(){b.log(c())};d("b4w")};b4w.module.screenshooter=function(a,p){var d=p("main");a.shot=function(){d.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
