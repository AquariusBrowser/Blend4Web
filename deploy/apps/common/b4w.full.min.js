var b4w=function(a){var m={};a.module=m;var c={};a.register=function(a,b){if(m[a])throw Error('Module "'+a+'" already registered');m[a]=b};a.require=function(a,b){if(!m[a])throw Error('Module "'+a+'" not found');b=b||"__B4W_DEF_NS";c[b]||(c[b]=function(a){return function(b){var d=m[b];if(!d)throw Error('Module "'+b+'" not found');d.Wh||(d.Wh={});d.Wh[a]||(d.Wh[a]={},d(d.Wh[a],c[a]));return d.Wh[a]}}(b));return c[b](a)};a.module_check=function(a){return m[a]?!0:!1};return a}({});"object"==typeof module&&module.om&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function m(){return"26.05.2015 11:58:47"}a.version=function(){return"15.05"};a.type=function(){return"RELEASE"};a.date=m;a.timestamp=function(){var a=m(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.om&&b4w.module.__version(exports);b4w.module.__config=function(a,m){function c(){return b4w.module_check(a.Tb.Bj)}function d(){for(var d=a.Tb,c=null,e=document.getElementsByTagName("script"),n=0;n<e.length;n++){for(var g=e[n].src,l=0;l<d.lr.length;l++)if(0<=g.indexOf(d.lr[l])){c=g;break}if(null!==c)break}c||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),c=document.location.href);d=c.indexOf("?");0<=d&&(c=c.substring(0,d));return c.substring(0,c.lastIndexOf("/")+1)}var b=m("__print"),
e=m("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.mw=e.Aa(a.context);a.o={alpha_sort:!0,alpha_sort_threshold:.1,sn:"5.04",pd:1E4,console_verbose:!1,do_not_load_resources:!1,al:!1,oq:1.5,Ax:10,background_color:[0,0,0,0],eg:.01,resolution_factor:1,canvas_resolution_factor:1,Vk:3,allow_cors:!1,wm:!1,tj:!0,show_hud_debug_info:!1,kD:!0,gf:"DEPTH",anaglyph_use:!1,Lk:!0,Qi:.5,td:!0,nf:!0,Ug:!0,dh:!0,Mg:!0,ph:!0,Qg:!0,antialiasing:!0,smaa:!1,
wireframe_debug:!1,Bt:!1,Xg:!0,Ii:!0,lb:!0,Gk:!0,water_dynamic:!0,shore_smoothing:!0,yh:!0,qd:1024,pn:512,pt:!0,precision:"highp",quality:a.P_HIGH,ol:!0,nz:!1,Ds:!1,Zp:!1,vt:!1,Xf:!1,Ml:!1,ar:!1,Nl:!1,jq:!1,DE:!1,Oc:!1,allow_hidpi:!1,gyro_use:!1,kq:!1,Vm:!1,enable_selectable:!0,enable_outlining:!0,Qe:!0,xr:128,Sm:!1,jn:0};a.ax=e.Aa(a.o);a.Od={Ha:-1,pq:!1,Sf:1};a.controls={lz:1/120};a.Pd={dir:"ASSETS=../../assets/",fz:15,hs:!0,rn:!1,cm:!1};a.uv=e.Aa(a.Pd);a.Tb={shaders_dir:"",BA:"include/",Bj:"built_in_data",
lr:["b4w.min.js","b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"],ts:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.vb={enabled:!0,pd:60,aj:"",Lv:!1};a.xz=e.Aa(a.vb);a.Vi={Yj:1024,Ie:384};a.bA=e.Aa(a.Vi);a.Yc={Eo:!0,qk:!1,ip:!1,Fp:!1,$p:!1};a.AA=e.Aa(a.Yc);a.Db={outlining_overview_mode:!1,$e:[1,.4,.05],Vc:1,wk:.2,xk:3.8,yk:1};a.dm={enabled:!1,dB:"MAIN_OPAQUE",cB:0,EA:"COLOR"};a.Xw=e.Aa(a.dm);a.pv=function(){var b=a.o,d=a.vb,c=a.Vi;switch(b.quality){case a.P_ULTRA:b.gf="DEPTH";
b.shore_smoothing=!0;b.nf=!0;b.Ug=!0;b.dh=!0;b.Mg=!0;b.Lk=!0;b.Qi=1;b.td=!0;b.Xg=!0;b.Ii=!0;b.lb=!0;b.Gk=!0;b.resolution_factor=1.75;c.Yj=2048;b.Vk=3;b.tj=!0;b.al=!1;b.precision="highp";b.water_dynamic=!0;b.yh=!0;b.antialiasing=!0;b.smaa=!0;b.Qg=!0;b.ph=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.Qe=!0;d.pd=120;break;case a.P_HIGH:b.gf="DEPTH";b.shore_smoothing=!0;b.nf=!0;b.Ug=!0;b.dh=!0;b.Mg=!0;b.Lk=!0;b.Qi=.5;b.td=!0;b.Xg=!0;b.Ii=!0;b.lb=!0;b.Gk=!0;b.resolution_factor=1;c.Yj=1024;b.Vk=3;b.tj=!0;
b.al=!1;b.precision="highp";b.water_dynamic=!0;b.yh=!0;b.antialiasing=!0;b.smaa=!1;b.Qg=!0;b.ph=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.Qe=!0;d.pd=60;break;case a.P_LOW:b.gf="NONE",b.shore_smoothing=!1,b.nf=!1,b.Ug=!1,b.dh=!1,b.Mg=!1,b.Lk=!1,b.Qi=.5,b.td=!1,b.Xg=!1,b.Ii=!1,b.lb=!1,b.Gk=!1,b.resolution_factor=1,c.Yj=512,b.Vk=2,b.tj=!1,b.al=!0,b.precision="mediump",b.water_dynamic=!1,b.yh=!1,b.antialiasing=!1,b.smaa=!1,b.Qg=!1,b.ph=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.Qe=!1,d.pd=60}};a.set=
function(d,c){switch(d){case "allow_cors":a.o.allow_cors=c;break;case "allow_hidpi":a.o.allow_hidpi=c;break;case "alpha":a.context.alpha=c;break;case "alpha_sort":a.o.alpha_sort=c;break;case "alpha_sort_threshold":a.o.alpha_sort_threshold=c;break;case "anaglyph_use":a.o.anaglyph_use=c;break;case "animation_framerate":a.Od.Ha=c;break;case "antialiasing":a.o.antialiasing=c;break;case "assets_dds_available":a.Pd.cm=c;break;case "assets_min50_available":a.Pd.rn=c;break;case "audio":a.Yc.Eo=c;break;case "background_color":a.o.background_color=
c;break;case "built_in_module_name":a.Tb.Bj=c;break;case "canvas_resolution_factor":a.o.canvas_resolution_factor=c;break;case "console_verbose":a.o.console_verbose=c;break;case "do_not_load_resources":a.o.do_not_load_resources=c;break;case "gyro_use":a.o.gyro_use=c;break;case "physics_enabled":a.vb.enabled=c;break;case "physics_uranium_path":a.vb.aj=c;break;case "precision":a.o.precision=c;break;case "quality":a.o.quality=c;break;case "resolution_factor":a.o.resolution_factor=c;break;case "sfx_mix_mode":a.Yc.qk=
c;break;case "shaders_dir":a.Tb.shaders_dir=c;break;case "show_hud_debug_info":a.o.show_hud_debug_info=c;break;case "smaa":a.o.smaa=c;break;case "smaa_search_texture_path":a.Tb.smaa_search_texture_path=c;break;case "smaa_area_texture_path":a.Tb.smaa_area_texture_path=c;break;case "wireframe_debug":a.o.wireframe_debug=c;break;case "enable_selectable":a.o.enable_selectable=c;break;case "enable_outlining":a.o.enable_outlining=c;break;case "outlining_overview_mode":a.Db.outlining_overview_mode=c;break;
case "glow_materials":a.o.Qe=c;break;default:b.error("Unknown config property: "+d)}};a.get=function(c){switch(c){case "allow_cors":return a.o.allow_cors;case "allow_hidpi":return a.o.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.o.alpha_sort;case "alpha_sort_threshold":return a.o.alpha_sort_threshold;case "anaglyph_use":return a.o.anaglyph_use;case "animation_framerate":return a.Od.Ha;case "antialiasing":return a.o.antialiasing;case "assets_dds_available":return a.Pd.cm;
case "assets_min50_available":return a.Pd.rn;case "audio":return a.Yc.Eo;case "background_color":return a.o.background_color;case "built_in_module_name":return a.Tb.Bj;case "canvas_resolution_factor":return a.o.canvas_resolution_factor;case "console_verbose":return a.o.console_verbose;case "do_not_load_resources":return a.o.do_not_load_resources;case "gyro_use":return a.o.gyro_use;case "physics_enabled":return a.vb.enabled;case "physics_uranium_path":return a.vb.aj;case "precision":return a.o.precision;
case "quality":return a.o.quality;case "resolution_factor":return a.o.resolution_factor;case "sfx_mix_mode":return a.Yc.qk;case "shaders_dir":return a.Tb.shaders_dir;case "show_hud_debug_info":return a.o.show_hud_debug_info;case "smaa":return a.o.smaa;case "smaa_search_texture_path":return a.Tb.smaa_search_texture_path;case "smaa_area_texture_path":return a.Tb.smaa_area_texture_path;case "wireframe_debug":return a.o.wireframe_debug;case "enable_selectable":return a.o.enable_selectable;case "enable_outlining":return a.o.enable_outlining;
case "outlining_overview_mode":return a.Db.outlining_overview_mode;case "glow_materials":return a.o.Qe;default:b.error("Unknown config property: "+c)}};a.reset=function(){a.context=e.Aa(a.mw);a.o=e.Aa(a.ax);a.Pd=e.Aa(a.uv);a.vb=e.Aa(a.xz);a.Vi=e.Aa(a.bA);a.Yc=e.Aa(a.AA);a.dm=e.Aa(a.Xw)};a.er=c;a.rA=function(){var b=a.Tb,e=a.vb;c()||""!=b.shaders_dir||(b.shaders_dir=d()+"../shaders/");if(c())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==
b.smaa_search_texture_path||""==b.smaa_area_texture_path){var f=d()+b.ts;b.smaa_search_texture_path=b.smaa_search_texture_path||f+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||f+"smaa_area_texture.png"}e.enabled&&""==e.aj&&(f=d()+b.ts,e.aj=f+"uranium.js")};a.get_std_assets_path=function(){return a.Pd.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,m){function c(a,c){var q=document.createElement("div"),p=q.style;p.position="absolute";p.backgroundColor="black";p.borderRadius="20px 20px 20px 0px";p.boxShadow="0px 0px 10px rgb(180, 180, 200)";p.opacity=1;p.padding="8px 12px";p.lineHeight="15px";p.visibility="hidden";p.fontSize="12px";var f=n.get_container();f.appendChild(q);var A=g.get_meta_tags(a),h=document.createElement("span"),L=h.style;h.innerHTML=A.title||a.name;L.fontWeight="bold";L.fontSize="12px";L.lineHeight=
"15px";L.color="#fff";L.fontFamily="Arial";e(h);q.appendChild(h);var M=A.description;if(M){var A=document.createElement("div"),G=A.style;G.position="absolute";G.bottom="0px";G.left="0px";G.backgroundColor="#000";G.borderRadius="20px 20px 20px 0px";G.boxShadow="0px 0px 10px rgb(180, 180, 200)";G.visibility="hidden";G.padding="8px 12px";G.overflow="hidden";G.lineHeight="15px";G.fontSize="12px";G.zIndex="2";q.appendChild(A);var D=document.createElement("span"),O=D.style;D.innerHTML=M;O.fontSize="12px";
O.fontFamily="Arial";O.fontWeight="bold";O.lineHeight="15px";O.color="#fff";O.visibility="hidden";A.appendChild(D);var k=!1,x=!1;f.addEventListener("click",function(a){if(!(k||x||E))if(a.target!=h&&a.target!=q||"hidden"!=G.visibility||1!=p.opacity)"visible"==G.visibility&&(p.visibility="visible",L.visibility="visible",G.visibility="hidden",O.visibility="hidden");else{p.visibility="hidden";L.visibility="hidden";G.visibility="visible";k=x=!0;a=q.offsetWidth-24;var D=q.offsetHeight-16,e=Math.min(c,d(M)),
A=b(M,e);A==D&&(G.height=A+"px");e!=a?w.animate(a,e,200,function(a){a==e&&("visible"==G.visibility&&(O.visibility="visible"),k=!1);G.width=a+"px"}):k=!1;A!=D?w.animate(D,A,200,function(a){a==A&&("visible"==G.visibility&&(O.visibility="visible"),x=!1);G.height=a+"px"}):x=!1;x||k||(O.visibility="visible")}},!1)}return q}function d(a){var b=document.createElement("div"),c=document.createElement("span"),d=b.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";
c.style.color="#fff";c.style.visibility="hidden";d.lineHeight="15px";b.appendChild(c);d.position="absolute";d.visibility="hidden";d.fontSize="12px";d.display="inline-block";d.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function b(a,b){var c=document.createElement("div"),d=document.createElement("span"),e=c.style;d.innerHTML=a;d.style.fontSize="12px";d.style.fontFamily="Arial";d.style.fontWeight="bold";d.style.color="#fff";d.style.visibility=
"hidden";e.lineHeight="15px";c.appendChild(d);e.position="absolute";e.visibility="hidden";e.fontSize="12px";e.display="inline-block";e.width=b+"px";e.lineHeight="15px";document.body.appendChild(c);d=c.offsetHeight;document.body.removeChild(c);return d}function e(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}
function h(){for(var a=0,b=0;b<B.length;b++)B[b].gm&&a++;v=new Float32Array(3*a)}var k=m("__batch"),f=m("__camera"),n=m("__container"),g=m("__objects"),l=m("__print"),y=m("__renderer"),p=m("__scenes"),w=m("__time");m("__util");var z=m("__config").o,E=!1,B=[],v=new Float32Array(0),t=new Uint8Array(16),x=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<B.length;b++)if(B[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.b4w_anchor.detect_visibility&&Boolean(p.ia(p.ah(),"ANCHOR_VISIBILITY"));b={type:a.b4w_anchor.type,
obj:a,x:0,y:0,depth:0,Kg:"out",gm:b,element:null,qh:null,Xu:a.b4w_anchor.max_width,ap:0};switch(b.type){case "ANNOTATION":b.element=c(a,b.Xu);b.ap=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.b4w_anchor.element_id),b.element||(l.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}B.push(b);h()}};a.remove=function(a){for(var b=0;b<B.length;b++){var c=B[b];if(c.obj==a){"ANNOTATION"==c.type&&(a=c,n.get_container().removeChild(a.element));
B.splice(b,1);h();break}}};a.update=function(){for(var a=0,b=0;b<B.length;b++){var c=B[b];c.gm&&(v.set(c.obj.d.g,3*a),a++);var d,e=c,A=x;d=p.Vj(p.ah());A=f.project_point(d,e.obj.d.g,A);A[0]/=z.resolution_factor;A[1]/=z.resolution_factor;e=p.Jq();A[0]/=e;A[1]/=e;d=A;A=d[0];e=d[1];d=d[2];if(A!=c.x||e!=c.y||d!=c.depth){switch(c.type){case "ANNOTATION":var g=c.element;g.style.left=Math.floor(A)+"px";g.style.top=Math.floor(e-c.ap)+"px";break;case "ELEMENT":g=c.element,g.style.left=Math.floor(A-g.offsetWidth/
2)+"px",g.style.top=Math.floor(e-g.offsetHeight/2)+"px"}c.x=A;c.y=e;c.depth=d;c.qh&&c.qh(A,e,c.Kg,c.obj,g)}}0<a&&(a=p.ia(p.ah(),"ANCHOR_VISIBILITY").p[0].D,k.rB(a,v))};a.LB=function(){for(var a=n.get_container(),b=0;b<B.length;b++){var c=B[b],d=c.obj,e=c.x,A=c.y,g=c.depth,g=0>e||0>A||0>g||1<g||p.is_hidden(d)||e>=a.clientWidth||A>=a.clientHeight?"out":"visible";if(c.gm&&"out"!=g){var g=c,f=p.ia(p.ah(),"ANCHOR_VISIBILITY"),M=p.Jq(),G=g.x*M,M=g.y*M,G=G*z.resolution_factor,M=M*z.resolution_factor,f=f.h;
y.os(f.ce,G,f.height-M,2,2,t);g=1020==t[0]+t[4]+t[8]+t[12]?"visible":"out"==g.Kg||0==t[0]+t[4]+t[8]+t[12]?"covered":g.Kg}if(g!=c.Kg){switch(c.type){case "ANNOTATION":case "ELEMENT":var D=c.element;if(!D)break;"out"==g?(D.style.visibility="hidden",D.children.length&&(D.children[0].style.visibility="hidden"),"ANNOTATION"==c.type&&1<D.children.length&&(G=D.children[1],G.style.visibility="hidden",G.children.length&&(G.children[0].style.visibility="hidden"))):"visible"==g?(D.style.visibility="visible",
D.children.length&&(D.children[0].style.visibility="visible"),D.style.opacity=1):(D.style.visibility="visible",D.style.opacity=.1,D.children.length&&(D.children[0].style.visibility="visible"),"ANNOTATION"==c.type&&1<D.children.length&&(G=D.children[1],G.style.visibility="hidden",G.children.length&&(G.children[0].style.visibility="hidden")))}c.Kg=g;c.qh&&c.qh(e,A,c.Kg,d,D)}}};a.attach_move_cb=function(a,b){for(var c=0;c<B.length;c++)B[c].obj==a&&(B[c].qh=b)};a.detach_move_cb=function(a){for(var b=
0;b<B.length;b++)B[b].obj==a&&(B[b].qh=null)};a.cleanup=function(){for(var a=0;a<B.length;a++){var b=B[a];"ANNOTATION"==b.type&&n.get_container().removeChild(b.element)}B.length=0};a.dr=function(a){return a.b4w_anchor?!0:!1};a.pause=function(){E=!0};a.resume=function(){E=!1}};b4w.module.__boundings=function(a,m){function c(a,b){for(var c=a[0],d=a[1],e=a[2],g=a[0],f=a[1],h=a[2],k=3;k<a.length;k+=3)var n=a[k],q=a[k+1],l=a[k+2],c=Math.max(c,n),d=Math.max(d,q),e=Math.max(e,l),g=Math.min(g,n),f=Math.min(f,q),h=Math.min(h,l);b.max_x=c;b.max_y=d;b.max_z=e;b.min_x=g;b.min_y=f;b.min_z=h;return b}function d(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,e=a.max_z,g=a.min_x,f=a.min_y,h=a.min_z;b[0]=g;b[1]=f;b[2]=h;b[3]=c;b[4]=f;b[5]=h;b[6]=c;b[7]=d;b[8]=h;b[9]=g;b[10]=
d;b[11]=h;b[12]=g;b[13]=f;b[14]=e;b[15]=c;b[16]=f;b[17]=e;b[18]=c;b[19]=d;b[20]=e;b[21]=g;b[22]=d;b[23]=e;return b}function b(a,b,c){f.add(b,c,a.F);f.scale(a.F,.5,a.F);a.Da=f.distance(a.F,b);return a}var e=m("__geometry"),h=m("__util"),k=m("__tsr"),f=m("vec3"),n=new Float32Array(24),g=new Float32Array(3),l=new Float32Array(3),y=new Float32Array(3);a.Np=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.QC=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Gd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.dq=function(a,b){var c=a.max_y,d=a.max_z,e=a.min_x,g=a.min_y,f=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,e);a.min_y=Math.min(b.min_y,g);a.min_z=Math.min(b.min_z,f)};a.Bv=c;a.El=function(b,e,g){g||(g=a.Gd());b=d(b,n);h.af(b,e,b);return c(b,g)};a.sx=d;a.CE=function(b,c,d){d||
(d=a.Gd());var e=c.min_x,g=c.max_x,f=c.min_y,h=c.max_y,k=c.min_z;c=c.max_z;if(e>=b.max_x||g<=b.min_x||f>=b.max_y||h<=b.min_y||k>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,e);d.max_x=Math.min(b.max_x,g);d.min_y=Math.max(b.min_y,f);d.max_y=Math.min(b.max_y,h);d.min_z=Math.max(b.min_z,k);d.max_z=Math.min(b.max_z,c);return d};a.GE=function(b,c,d){d||(d=a.Gd());var e=b.max_x-b.min_x,g=b.max_y-b.min_y,f=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*e;d.max_x=b.max_x+.5*(c-1)*e;d.min_y=b.min_y-.5*(c-1)*g;d.max_y=b.max_y+.5*(c-1)*g;d.min_z=b.min_z-.5*(c-1)*f;d.max_z=b.max_z+.5*(c-1)*f;return d};a.Gl=function(b,c,d){d||(d=a.hj());f.transformMat4(b.F,c,d.F);d.Da=b.Da*h.on(c);return d};a.Fl=function(a,b,c){c||(c={Df:new Float32Array(3),Ef:new Float32Array(3),Ff:new Float32Array(3),F:new Float32Array([0,0,0])});k.transform_vec3(a.F,b,c.F);f.copy(a.Df,c.Df);f.copy(a.Ef,c.Ef);f.copy(a.Ff,c.Ff);k.transform_dir_vec3(c.Df,b,c.Df);k.transform_dir_vec3(c.Ef,
b,c.Ef);k.transform_dir_vec3(c.Ff,b,c.Ff);return c};a.Wl=function(a,b){return{Da:a,F:new Float32Array(b)}};a.hj=function(){return{F:new Float32Array([0,0,0]),Da:0}};a.Vl=function(a,b,c,d){return{Df:new Float32Array(a),Ef:new Float32Array(b),Ff:new Float32Array(c),F:new Float32Array([d[0],d[1],d[2]])}};a.Dv=function(){return{F:new Float32Array([0,0,0]),Da:1E12}};a.ox=function(a,b){var c=f.subtract(b.F,a.F,f.create());0==f.length(c)&&f.set(1,0,0,c);var d=f.normalize(c,f.create()),c=f.scale(d,a.Da,f.create());
f.add(c,a.F,c);var e=f.scale(d,-a.Da,f.create());f.add(e,a.F,e);var g=f.scale(d,b.Da,f.create());f.add(g,b.F,g);var h=f.scale(d,-b.Da,f.create());f.add(h,b.F,h);c=[c,e,g,h];d=f.normalize(d,f.create());e=c[0];g=c[0];for(h=1;h<c.length;h++){var k=f.dot(c[h],d);k<f.dot(e,d)&&(e=c[h]);k>f.dot(g,d)&&(g=c[h])}d=[e,g];c=d[0];d=d[1];a.F=f.scale(f.add(c,d,f.create()),.5,f.create());a.Da=f.length(f.subtract(d,c,f.create()))/2};a.Op=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d-2*a);return{Da:a,height:e,
F:new Float32Array([0,(c+d)/2,0])}};a.Qp=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{Da:a,height:e,F:new Float32Array([0,(c+d)/2,0])}};a.Pp=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{Da:a,height:e,F:new Float32Array([0,(c+d)/2,0])}};a.UC=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.Jz=function(a){for(var b=0,c=0,d=0,e=0,g=0,f=0,h=0,k=0,n=0;n<a.submeshes.length;n++){var q=
a.submeshes[n];if(q.position.length){b=e=q.position[0];c=g=q.position[1];d=f=q.position[2];break}}for(n=0;n<a.submeshes.length;n++)for(var q=a.submeshes[n],q=q.position,l=0;l<q.length/3;l++)var y=q[3*l],A=q[3*l+1],N=q[3*l+2],b=Math.max(y,b),c=Math.max(A,c),d=Math.max(N,d),e=Math.min(y,e),g=Math.min(A,g),f=Math.min(N,f),h=Math.max(Math.sqrt(y*y+A*A+N*N),h),k=Math.max(Math.sqrt(y*y+N*N),k);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=g;a.b4w_bounding_box.max_z=
d;a.b4w_bounding_box.min_z=f;a.b4w_bounding_sphere_radius=h;a.b4w_bounding_cylinder_radius=k};a.jy=function(c){var d=c.subarray(0,3),h=c.subarray(6,9),k=c.subarray(12,15),n=c.subarray(18,21);c=f.subtract(h,d,g);f.normalize(c,c);var v=e.ly(d,h,k,l),v=f.cross(v,c,v);f.normalize(v,v);var t=f.create(),x=f.create();f.subtract(h,d,y);x[0]=f.dot(y,c);x[1]=f.dot(y,v);h=f.create();f.subtract(k,d,y);h[0]=f.dot(y,c);h[1]=f.dot(y,v);k=f.create();f.subtract(n,d,y);k[0]=f.dot(y,c);k[1]=f.dot(y,v);n=a.hj();k=[t,
x,h,k];t=b(n,k[0],k[1]);for(n=2;n<k.length;n++)if(f.distance(t.F,k[n])>t.Da){for(var I=t,t=k,x=k[n],h=n-1,I=b(I,x,t[0]),r=1;r<=h;r++)if(f.distance(I.F,t[r])>I.Da){for(var q=I,I=t,C=x,J=t[r],A=r-1,q=b(q,C,J),N=0;N<=A;N++)if(f.distance(q.F,I[N])>q.Da){var L=C,M=J,G=I[N],D=f.subtract(M,G,y),D=f.squaredLength(D),O=f.subtract(L,G,y),Q=f.squaredLength(O),O=f.subtract(L,M,y),Z=f.squaredLength(O),O=D*(Q+Z-D),P=Q*(Z+D-Q),D=Z*(D+Q-Z),Q=O+P+D;f.copy(L,q.F);f.scale(q.F,O/Q,q.F);f.scaleAndAdd(q.F,M,P/Q,q.F);f.scaleAndAdd(q.F,
G,D/Q,q.F);q.Da=f.distance(q.F,L)}I=q}t=I}n=t;c=f.scale(c,n.F[0],y);f.scaleAndAdd(c,v,n.F[1],c);f.add(c,d,n.F);return n}};b4w.module.__compat=function(a,m){function c(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function d(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var e=m("__config"),h=m("__extensions"),k=m("__print");
m("__util");a.lA=function(a){var n=e.Od,g=e.o,l=e.context,y=e.Vi,p=e.Yc;g.xr=a.MAX_VERTEX_UNIFORM_VECTORS;g.qd=a.getParameter(a.MAX_TEXTURE_SIZE);g.pn=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var w=Boolean(h.ey());c("Firefox")&&e.er()&&(k.warn("Firefox detected for single HTML version, disable video textures."),g.jq=!0);c("Firefox/28.0")&&(c("Linux")||c("Macintosh"))&&(k.warn("Firefox 28 detected, applying depth hack"),w=!1);c("iPad")||c("iPhone")?(k.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
l.alpha||(g.background_color[3]=1),g.vt=!0,g.smaa=!1,g.nf=!1,g.precision="highp",g.ar=!0):c("Mac OS X")&&c("Safari")&&!c("Chrome")&&(k.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),p.ip=!0,p.Fp=!0);c("Windows")&&(c("Chrome/40")||c("Firefox/33")||c("Firefox/34")||c("Firefox/35")||c("Firefox/36"))&&(k.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),g.Nl=!0);d()&&(k.warn("Mobile detected, applying various hacks for video textures."),
g.Xf=!0,c("iPad")||c("iPhone")||(k.warn("Mobile (not iOS) detected, disable playback rate for video textures."),p.$p=!0));(c("Firefox/35.0")||c("Firefox/36.0"))&&c("Windows")&&(k.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),g.kq=!0);if(c("iPhone")||b())k.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),g.Oc=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(k.warn("Not enough varyings, disable shadows on blend objects"),g.Zp=!0);if(l=h.Fq())c("Macintosh")&&
-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(k.warn("OS X / Intel HD 3000 detected, applying depth hack"),w=!1),c("Windows")&&c("Chrome")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Intel")&&(k.warn("Chrome / Windows / Intel GPU detected, applying cubemap mipmap/rgb hack"),g.Vm=!0),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(k.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),
w=!1,n.pq=!0),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(k.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),g.precision="highp",g.gf="NONE"),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(k.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),g.precision="highp",g.nf=!1),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&
-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(k.warn("Qualcomm Adreno detected, applying shader constants hack."),g.Ds=!0,-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(k.warn('Qualcomm Adreno305 detected, set "highp" precision.'),g.precision="highp"),-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(k.warn('Qualcomm Adreno330 detected, set "highp" precision.'),g.precision="highp")),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(k.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.wm=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(k.warn("Vertex textures are not allowed. Disabling vertex textures"),g.ol=!1);g.allow_hidpi&&1<window.devicePixelRatio&&(k.log("%cENABLE HIDPI MODE","color: #00a"),g.resolution_factor=1,g.smaa=!1);w||(g.Xg=!1,g.Ii=!1,g.lb=!1,g.water_dynamic=!1,g.shore_smoothing=!1,g.yh=!1,g.smaa=!1);g.pt=Boolean(h.Gq());g.ji=w;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,
a.HIGH_FLOAT).precision&&(g.precision="mediump");b()&&(k.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),y.Ie=512);b()&&c("Touch")&&(k.warn("IE11 and touchscreen detected. Behaviour of the mouse move sensor will be changed."),g.Sm=!0);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(k.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.wm=!0);c("Chrome")&&(k.warn("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),
g.Ml=!0)};a.detect_mobile=d;a.nv=function(){c("Firefox/35.0")&&c("Windows")&&(k.warn("Windows/Firefox 35 detected, forcing context's alpha"),e.context.alpha=!0)};a.Xm=b};b4w.module.__constraints=function(a,m){function c(a){var b={};b.type=a;return b}function d(a,c){a.Sa&&a.Sa.P&&e(a.Sa.P,a);c.P&&b(c.P,a);a.Sa=c}function b(a,b){if(-1==a.Fc.indexOf(b))a.Fc.push(b);else throw"Descendant object override is forbidden";}function e(a,b){var c=a.Fc.indexOf(b);if(-1!=c)a.Fc.splice(c,1);else throw"No descendant object";}function h(a,b,c){switch(b.type){case 1:var d=a.d.quat,e=b.P.d.U;c=b.P.d.quat;b.ec?(w.copy(b.ec,d),w.multiply(c,d,d)):w.copy(c,d);p.transformMat4(b.offset,
e,a.d.g);a.d.scale=b.Mk*b.P.d.scale;break;case 9:var h=a.d.g,d=a.d.quat,e=b.P.d.U;c=b.P.d.quat;w.multiply(w.invert(b.og,b.og),d,d);w.multiply(c,d,d);p.transformMat4(b.offset,e,h);w.copy(c,b.og);break;case 10:h=a.d.g;d=a.d.quat;e=b.P.d.U;c=b.P.d.quat;w.multiply(w.invert(b.og,b.og),d,d);w.multiply(c,d,d);p.transformMat4(b.offset,e,h);w.copy(c,b.og);h=a.d.quat;d=w.multiply(b.P.d.quat,b.ec,r);d=y.xq(d,E);h=y.xq(h,B);y.rotate_eye_camera(a,l.Ge(h[0],d[0]+b.cw,d[0]+b.bw),l.Ge(h[1],d[1]+b.aw,d[1]+b.dw));
break;case 12:var h=a.d.g,d=a.d.quat,e=b.P.d.U,q=b.P.d.g,x=b.GA,t=v,J=r;p.transformMat4(b.offset,e,t);l.smooth_v(t,h,c,x,h);e=v;p.sub(q,h,e);p.normalize(e,e);var m=d,h=A,q=h.subarray(0,3),t=h.subarray(3,6),R=h.subarray(6,9);p.copy(e,t);p.negate(t,t);p.normalize(t,t);Boolean(.999999<Math.abs(p.dot(e,l.AXIS_Y)))?(e=z.fromQuat(w.normalize(m,J),N),p.copy(e.subarray(0,3),q)):p.cross(l.AXIS_Y,t,q);p.normalize(q,q);p.cross(q,t,R);p.normalize(R,R);w.fromMat3(h,J);w.normalize(J,J);l.Ms(J,d,c,.16*x,d);break;
case 2:d=a.d.quat;h=I;c=r;n(b.P,b.Jv,!0,h,c);b.ec?(w.copy(b.ec,d),w.multiply(c,d,d)):w.copy(c,d);a.d.scale=b.Mk*h[3];l.transform_vec3(b.offset,h[3],c,h,a.d.g);break;case 3:h=a.d.g;d=a.d.quat;c=b.P.d.g;k(h,d,c);break;case 4:h=a.d.g;d=a.d.quat;c=b.target;k(h,d,c);break;case 5:h=a.d.g;d=a.d.quat;c=b.P.d.g;k(h,d,c);d=p.dist(h,c);if(d=d>b.dist_max?d-b.dist_max:d<b.ki?d-b.ki:0)p.sub(c,h,v),p.normalize(v,v),p.scale(v,d,v),p.add(h,v,h);break;case 6:h=a.d.g;d=a.d.quat;c=b.target;k(h,d,c);d=p.dist(h,c);if(d=
d>b.dist_max?d-b.dist_max:d<b.ki?d-b.ki:0)p.sub(c,h,v),p.normalize(v,v),p.scale(v,d,v),p.add(h,v,h);break;case 7:e=b.P.d.U;p.transformMat4(b.offset,e,a.d.g);break;case 8:q=b.P.d.g;h=a.d.g;p.add(q,b.offset,h);break;case 13:d=a.d.quat;e=b.P.d.U;c=b.P.d.quat;b.ec?(w.copy(b.ec,d),w.multiply(c,d,d)):w.copy(c,d);p.transformMat4(b.offset,e,a.d.g);break;case 11:h=b.P.d;c=g.create_sep(h.g,h.scale,h.quat,C);g.multiply(c,b.ht,c);h=a.d.g;h[0]=c[0];h[1]=c[1];h[2]=c[2];a.d.scale=c[3];d=a.d.quat;d[0]=c[4];d[1]=
c[5];d[2]=c[6];d[3]=c[7];break;case 14:c=b.P,d=y.hy(c),h=a.d.g,x=y.Wj(d,"TOP"),J=y.Wj(d,"BOTTOM"),e=x-J,b.rr?(q=y.Wj(d,"LEFT"),h[0]=q+e*b.en):(q=y.Wj(d,"RIGHT"),h[0]=q-e*b.en),h[2]=b.ft?-(x-e*b.lo):-(J+e*b.lo),y.Sy(d)?h[1]=-b.distance:(h[1]=-1,p.normalize(h,h),p.scale(h,b.distance/Math.abs(h[1]),h)),g.transform_dir_vec3(h,c.d.yb,h),p.add(c.d.g,h,h),d=a.d.quat,b.ec?(w.copy(b.ec,d),w.multiply(c.d.quat,d,d)):w.copy(c.d.quat,d)}"CAMERA"==a.d.type&&(h=l.AXIS_Y,10==b.type&&(c=b.P.d.quat,h=p.transformQuat(h,
c,L)),y.ro(a),f(a,h))}function k(a,b,c){var d=v;l.quat_to_dir(b,l.AXIS_MY,d);p.normalize(d,d);var e=t;p.subtract(c,a,e);p.normalize(e,e);a=l.Yz(d,e,I);w.multiply(a,b,b);w.normalize(b,b)}function f(a,b){var c=a.d,d=c.quat,e=l.quat_to_dir(c.quat,l.AXIS_Y,v);p.normalize(e,e);if(.999999<Math.abs(p.dot(b,e)))e=w.identity(r);else{var h=p.cross(b,e,t);p.normalize(h,h);if(c.sa==y.MS_TARGET_CONTROLS)c.ho&&p.negate(h,h);else{var g=l.quat_to_dir(c.quat,l.AXIS_Z,x);0<p.dot(g,b)&&p.negate(h,h)}c=l.quat_to_dir(c.quat,
l.AXIS_X,x);p.normalize(c,c);var g=l.clamp(p.dot(c,h),-1,1),A=Math.acos(g),e=-.999999>=g?w.setAxisAngle(e,A,r):w.rotationTo(c,h,r);w.normalize(e,e)}w.multiply(e,d,d);y.ro(a)}function n(a,b,c,d,e){var h=a.d,A=h.Rf,f=h.Hc[b];b=f.ii;a=a.pose.bones[f.Fn];var f=a.Uo,k=I,L=h.Dc,n=h.Cc,x=h.vc,l=h.uc,p=L[4*b+1],v=L[4*b+2],y=L[4*b+3],t=n[4*b+1],B=n[4*b+2],H=n[4*b+3];k[0]=(1-A)*L[4*b]+A*n[4*b];k[1]=(1-A)*p+A*t;k[2]=(1-A)*v+A*B;k[3]=(1-A)*y+A*H;L=r;n=q;L[0]=x[4*b];L[1]=x[4*b+1];L[2]=x[4*b+2];L[3]=x[4*b+3];n[0]=
l[4*b];n[1]=l[4*b+1];n[2]=l[4*b+2];n[3]=l[4*b+3];w.slerp(L,n,A,L);A=C;g.set_transcale(k,A);g.set_quat(L,A);c?(c=J,g.translate(f,a.Vu,c),g.multiply(A,c,A)):g.multiply(A,f,A);g.multiply(h.yb,A,A);d[0]=A[0];d[1]=A[1];d[2]=A[2];d[3]=A[3];e&&(e[0]=A[4],e[1]=A[5],e[2]=A[6],e[3]=A[7])}var g=m("__tsr"),l=m("__util"),y=m("__camera"),p=m("vec3");m("vec4");var w=m("quat"),z=m("mat3");m("mat4");a.rC=1;a.qC=2;a.vC=3;a.wC=4;a.lC=5;a.mC=6;a.sC=7;a.kC=8;a.pC=9;a.oC=10;a.Hd=11;a.nC=12;a.tC=13;a.uC=14;var E=new Float32Array(2),
B=new Float32Array(2),v=new Float32Array(3),t=new Float32Array(3),x=new Float32Array(3),I=new Float32Array(4),r=new Float32Array(4),q=new Float32Array(4),C=new Float32Array(16),J=new Float32Array(16),A=new Float32Array(9),N=new Float32Array(9),C=new Float32Array(8),L=new Float32Array(3);a.cp=function(a,b,e,g,A){var f=c(1);f.P=b;f.offset=new Float32Array(e);f.ec=g?new Float32Array(g):null;f.Mk=A;d(a,f);h(a,f,0)};a.bp=function(a,b,e,g,A,f){var q=c(2);q.P=b;q.Jv=e;q.offset=new Float32Array(g);q.ec=A?
new Float32Array(A):null;q.Mk=f;d(a,q);h(a,q,0)};a.fv=function(a,b,e,g){var A=c(9),f=a.d.quat,q=b.d.quat;A.P=b;A.offset=new Float32Array(e);A.og=new Float32Array(q);g&&(w.copy(g,f),w.multiply(q,f,f));d(a,A);h(a,A,0)};a.ev=function(a,b,e,g,A,f,q,k){var L=c(10),n=a.d.quat,x=b.d.quat;L.P=b;L.offset=new Float32Array(e);L.og=new Float32Array(x);L.bw=l.angle_wrap_0_2pi(A);L.cw=l.angle_wrap_0_2pi(f);L.dw=l.angle_wrap_periodic(q,-Math.PI,Math.PI);L.aw=l.angle_wrap_periodic(k,-Math.PI,Math.PI);g?(L.ec=new Float32Array(g),
w.copy(g,n),w.multiply(x,n,n)):L.ec=w.create();d(a,L);h(a,L,0)};a.dv=function(a,b,e,g){var A=c(12);A.P=b;A.offset=new Float32Array(e);A.GA=g;d(a,A);h(a,A,0)};a.hv=function(a,b,e,g){var A=c(13);A.P=b;A.offset=new Float32Array(e);A.Mk=1;A.ec=g?new Float32Array(g):null;d(a,A);h(a,A,0)};a.MC=b;a.vE=e;a.jv=function(a,b){var e=c(3);e.P=b;d(a,e);h(a,e,0)};a.kv=function(a,b){var e=c(4);e.target=new Float32Array(b);d(a,e);h(a,e,0)};a.av=function(a,b,e,g){var A=c(5);A.P=b;A.ki=e;A.dist_max=g;d(a,A);h(a,A,0)};
a.bv=function(a,b,e,g){var A=c(6);A.target=new Float32Array(b);A.ki=e;A.dist_max=g;d(a,A);h(a,A,0)};a.gv=function(a,b,e){var g=c(7);g.P=b;g.offset=new Float32Array(e);d(a,g);h(a,g,0)};a.$u=function(a,b,e){var g=c(8);g.P=b;g.offset=new Float32Array(e);d(a,g);h(a,g,0)};a.Zu=function(a,b,e){var g=c(11);g.P=b;g.ht=new Float32Array(e);d(a,g);h(a,g,0)};a.append_stiff_viewport=function(a,b,e){var g=c(14);g.P=b;if("left"in e)g.rr=!0,g.en=e.left;else if("right"in e)g.rr=!1,g.en=e.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");
return}if("top"in e)g.ft=!0,g.lo=e.top;else if("bottom"in e)g.ft=!1,g.lo=e.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in e?(g.distance=e.distance,g.ec="rotation"in e?new Float32Array(e.rotation):null,d(a,g),h(a,g,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.zB=function(a,b){a.Sa&&h(a,a.Sa,b)};a.Xz=k;a.correct_up=f;a.Tv=function(a){return a.Sa?!0:!1};a.remove=function(a){a.Sa.P&&e(a.Sa.P,a);a.Sa=null};a.ee=function(a){return a.Sa?
a.Sa.type:null};a.get_parent=function(a){return a.Sa&&a.Sa.P?a.Sa.P:null};a.de=function(a){return a.Sa&&11==a.Sa.type?a.Sa.ht:null};a.$x=n};b4w.module.__container=function(a,m){m("__anchors");var c=m("__print"),d=m("__util"),b=null,e=null;a.get_canvas=function(){return b};a.get_container=function(){return e};a.init=function(a){a&&a.parentNode?(b=a,e=a.parentNode):d.pa("canvas container is not available")};a.insert_to_container=function(a,d){d=d||"LAST";switch(d){case "FIRST":e.insertBefore(a,e.firstElementChild);break;case "JUST_BEFORE_CANVAS":e.insertBefore(a,b);break;case "JUST_AFTER_CANVAS":b.nextElementSibling?e.insertBefore(a,b.nextElementSibling):
e.appendChild(a,b);break;case "LAST":e.appendChild(a,b);break;default:c.error(d+" behavior unknown")}}};b4w.module.__controls=function(a,m){function c(a){return{type:a,value:0,da:null,ln:null,kn:null,lk:null,Tc:!1,key:0,kc:"",Ql:null,vn:!1,Pl:function(){},Ol:null,Hp:function(){},yd:null,Zn:new Float32Array(3),km:new Float32Array(3),uo:!1,ns:function(){},axis:"",Bc:0,Nh:new Float32Array(3),Hk:new Float32Array(4),threshold:0,ls:new Float32Array(4),vj:0,uj:0,vs:0,wj:0,Mc:0,repeat:!1,jp:!1,ak:0,$j:0,Zj:0,Nm:0,Mm:0,Lm:0}}function d(a,b){var c;if(a.lk){c=a.ln;for(var d=a.kn,e=0;e<c.length;e++)d[e]=c[e].value;
c=a.lk(d)}else c=!1;c||(a.value=Number(b))}function b(a){a=N.indexOf(a);-1<a?N.splice(a,1):v.error("Wrong object")}function e(a,b){for(var c=0,d=0;d<b.length;d++)for(var e=b[d].Be,G=0;G<e.length;G++)for(var g=e[G].vd,A=0;A<g.length;A++)g[A]===a&&c++;return c}function h(a,b){switch(a.type){case 80:t.remove_collision_test(a.Ql,a.kc,a.Pl);a.Tc=!0;break;case 90:t.clear_collision_impulse_test(a.Ol);a.Tc=!0;break;case 100:t.remove_ray_test(a.yd,a.kc,a.Zn,a.km,a.uo);a.Tc=!0;break;case 130:a.Tc=!0}var c=
b.indexOf(a);-1<c&&b.splice(c,1)}function k(a){for(var b=0;b<L.length;b++){var c=L[b];20==c.type&&a.keyCode==c.key&&d(c,1)}na&&a.preventDefault();ra&&ra(a)}function f(a){for(var b=0;b<L.length;b++){var c=L[b];20==c.type&&0==a.keyCode&&16==c.key&&d(c,0);20==c.type&&a.keyCode==c.key&&d(c,0)}na&&a.preventDefault();ra&&ra(a)}function n(a){var b=!1,c=null;P=!0;Q=a.clientX;Z=a.clientY;D=a.clientX;O=a.clientY;for(var e=0;e<L.length;e++){var G=L[e];50==G.type&&(d(G,1),G.da=a.which);160==G.type&&(b||(c=x.pick_object(a.clientX,
a.clientY),b=!0),G.value=c==G.yd?1:0)}H&&a.preventDefault();ja&&ja(a)}function g(a){for(var b=0;b<L.length;b++){var c=L[b];50==c.type&&d(c,0);160==c.type&&c.jp&&(c.value=0)}P=!1;H&&!xa&&a.preventDefault();ja&&ja(a)}function l(a){var b=a.clientX,c=a.clientY;D=b;O=c;if(!A.Sm||P)for(var e=b-Q,G=c-Z,g=Math.sqrt(e*e+G*G),h=0;h<L.length;h++){var f=L[h];if(40===f.type)switch(f.axis){case "X":d(f,e);f.da=b;break;case "Y":d(f,G);f.da=c;break;case "XY":d(f,g),f.da[0]=b,f.da[1]=c}}H&&!xa&&a.preventDefault();
ja&&ja(a)}function y(a){var b=a.wheelDelta||-40*a.detail,b=b*J.lz;G+=b;for(b=0;b<L.length;b++){var c=L[b];30===c.type&&d(c,G)}W&&a.preventDefault();ca&&ca(a)}function p(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.pageX,c=c.pageY,d=!1,e=null,G=0;G<L.length;G++){var g=L[G];160==g.type&&(d||(e=x.pick_object(b,c),d=!0),g.value=e==g.yd)}X[0]=b;X[1]=-1;ia[0]=c;ia[1]=-1}else 1<b.length&&(pa=ha=E(b),X[0]=b[0].pageX,X[1]=b[1].pageX,ia[0]=b[0].pageY,ia[1]=b[1].pageY);U.set(X);V.set(ia);ka&&
ka(a)}function w(b){var c=b.targetTouches;if(0!==c.length){if(1===c.length){U[0]=c[0].pageX;U[1]=-1;V[0]=c[0].pageY;V[1]=-1;var c=U[0]-X[0],e=V[0]-ia[0],G=Math.sqrt(c*c+e*e);if(-1!=X[1]&&-1!=ia[1]){var g=U[0]-X[1],A=V[0]-ia[1],h=Math.sqrt(g*g+A*A);h<G&&(c=g,e=A,G=h)}for(h=0;h<L.length;h++){var D=L[h];if(60===D.type)switch(D.da=a.PL_SINGLE_TOUCH_MOVE,D.axis){case "X":d(D,c);break;case "Y":d(D,e);break;case "XY":d(D,G)}}}else if(1<c.length){U[0]=c[0].pageX;U[1]=c[1].pageX;V[0]=c[0].pageY;V[1]=c[1].pageY;
pa=E(c);G=pa-ha;g=R;g[0]=(U[0]+U[1])/2;g[1]=(V[0]+V[1])/2;A=u;A[0]=(X[0]+X[1])/2;A[1]=(ia[0]+ia[1])/2;var f,c=g[0],e=g[1],h=A[0],D=A[1];f=Math.sqrt((c-h)*(c-h)+(e-D)*(e-D));for(h=0;h<L.length;h++)if(D=L[h],70===D.type&&Math.abs(f)<Math.abs(G)&&(D.da=a.PL_MULTITOUCH_MOVE_ZOOM,d(D,G)),60===D.type&&Math.abs(f)>Math.abs(G))switch(D.da=a.PL_MULTITOUCH_MOVE_PAN,D.axis){case "X":c=g[0]-A[0];d(D,c);break;case "Y":e=g[1]-A[1];d(D,e);break;case "XY":d(D,f)}}ba&&b.preventDefault();ka&&ka(b)}}function z(a){for(var b=
0;b<L.length;b++){var c=L[b];if(170==c.type||180==c.type)c.$j=a.beta,c.ak=a.gamma,c.Zj=a.alpha,c.value||(c.Nm=a.gamma,c.Mm=a.beta,c.Lm=a.alpha,d(c,1))}}function E(a){var b=a[0],c=a[1];a=b.pageX;var b=b.pageY,d=c.pageX,c=c.pageY;return Math.sqrt((a-d)*(a-d)+(b-c)*(b-c))}var B=m("__config"),v=m("__print"),t=m("__physics"),x=m("__scenes"),I=m("__time"),r=m("__util"),q=m("vec3"),C=m("quat"),J=B.controls,A=B.o,N=[],L=[],M={},G=0,D=0,O=0,Q=0,Z=0,P=!1,U=new Float32Array(2),V=new Float32Array(2),X=new Float32Array(2),
ia=new Float32Array(2),R=new Float32Array(2),u=new Float32Array(2),pa=0,ha=0,ea=!1,Y=0,na=!1,H=!1,W=!1,ba=!1,xa=!1,ra=null,ja=null,ca=null,ka=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(b,c){for(var e=0;e<L.length;e++){var g=L[e],h=b,A=c;if(A)switch(g.type){case 110:var f=g.yd,k=f.d.g,f=f.d.quat,n=q.dist(g.Nh,k),x=g.ls;C.invert(g.Hk,x);C.multiply(f,x,x);C.normalize(x,x);x=Math.abs(2*
Math.acos(x[3]));n/=A;g.vj=r.smooth(n,g.vj,A,.3);g.da[0]=n;n=x/A;g.uj=r.smooth(n,g.uj,A,.3);g.da[1]=n;g.vj>=g.threshold||g.uj>=g.vs?d(g,1):d(g,0);q.copy(k,g.Nh);C.copy(f,g.Hk);g.Bc=h;break;case 120:f=g.yd;k=f.d.g;f=Math.abs(k[1]-g.Nh[1])/A;g.wj=r.smooth(f,g.wj,A,.3);g.da=f;g.wj>=g.threshold?d(g,1):d(g,0);q.copy(k,g.Nh);g.Bc=h;break;case 130:!g.Tc&&0<=g.Mc&&h-g.Bc>=g.Mc&&(d(g,1),g.repeat?g.Bc=h:g.Mc=-g.Mc);break;case 140:g.Bc||(g.Bc=h);d(g,h-g.Bc);g.Bc=h;break;case 150:d(g,h);break;case 170:g.da[0]=
Math.PI*(g.ak-g.Nm)/180;g.da[1]=Math.PI*(g.$j-g.Mm)/180;g.da[2]=Math.PI*(g.Zj-g.Lm)/180;g.Nm=g.ak;g.Mm=g.$j;g.Lm=g.Zj;break;case 180:g.da[0]=Math.PI*g.ak/180,g.da[1]=Math.PI*g.$j/180,g.da[2]=Math.PI*g.Zj/180}}for(e=0;e<N.length;e++)for(A=N[e],g=A.Be,h=0;h<g.length;h++)if(k=g[h],k.jt!=Y){k.jt=Y;for(var f=k,n=f.vd,x=f.gA,H=0;H<n.length;H++)x[H]=n[H].value;var f=f.Zy(x),n=k,x=n.or,l=H=void 0;switch(n.type){case a.CT_CONTINUOUS:f?l=H=1:1==x?l=H=-1:H=0;break;case a.CT_TRIGGER:f&&-1==x?l=H=1:f||1!=x?H=
0:l=H=-1;break;case a.CT_SHOT:f&&-1==x?l=H=1:f||1!=x?H=0:(H=0,l=-1);break;case a.CT_LEVEL:H=n.nr!=f?1:0;break;default:r.pa("Wrong sensor manifold type: "+n.type)}l&&(n.or=l);if(n=H)if(x=A==M?null:A,ea=!1,k.callback(x,k.id,n,k.Mv),k.nr=f,ea){e=-1;break}}for(e=0;e<N.length;e++)for(A=N[e],g=A.Be,h=0;h<g.length;h++)for(k=g[h],A=k.vd,k=0;k<A.length;k++)switch(f=A[k],f.type){case 30:d(f,0);break;case 40:d(f,0);break;case 60:d(f,0);break;case 70:d(f,0);break;case 130:d(f,0)}G=0;Q=D;Z=O;X.set(U);ia.set(V);
ha=pa;Y++};a.create_custom_sensor=function(a){var b=c(10);d(b,a);return b};a.create_keyboard_sensor=function(a){var b=c(20);b.key=a;return b};a.create_collision_sensor=function(a,b,e){if(!a||!a.m)return v.error("Wrong collision object"),null;var g=c(80);g.Ql=a;g.kc=b||"ANY";g.vn=e||!1;g.Pl=function(a,b){d(g,a);a&&b&&e&&(g.da=g.da||new Float32Array(3),g.da[0]=b[0],g.da[1]=b[1],g.da[2]=b[2])};g.Tc=!0;return g};a.create_collision_impulse_sensor=function(a){if(!a||!a.m)return v.error("Wrong collision impulse object"),
null;var b=c(90);b.Ol=a;b.Hp=function(a){d(b,a)};b.Tc=!0;return b};a.create_ray_sensor=function(a,b,e,g,G){if(!a)return v.error("Wrong collision object"),null;var h=c(100);h.yd=a;h.Zn=b;h.km=e;h.uo=g||!1;h.kc=G||"ANY";h.ns=function(a,b){d(h,a);a&&(h.da=b)};h.Tc=!0;return h};a.create_mouse_click_sensor=function(){return c(50)};a.create_mouse_wheel_sensor=function(){return c(30)};a.create_mouse_move_sensor=function(a){var b=c(40);b.axis=a||"XY";b.da="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=
function(a){var b=c(60);b.axis=a||"XY";b.da=0;return b};a.create_touch_zoom_sensor=function(){var a=c(70);a.da=0;return a};a.create_motion_sensor=function(a,b,d){if(!a)return v.error("Wrong collision object"),null;var e=c(110);e.yd=a;var g=a.d.g;a=a.d.quat;e.ls=new Float32Array(4);e.Nh=new Float32Array(g);e.Hk=new Float32Array(a);e.vj=0;e.uj=0;e.threshold=b||.1;e.vs=d||.1;e.Bc=0;e.da=new Float32Array([0,0]);return e};a.create_vertical_velocity_sensor=function(a,b){if(!a)return v.error("Wrong collision object"),
null;var d=c(120);d.yd=a;var e=a.d.quat;d.Nh=new Float32Array(a.d.g);d.Hk=new Float32Array(e);d.wj=0;d.threshold=b||1;d.Bc=0;d.da=0;return d};a.create_timer_sensor=function(a,b){var d=c(130);d.Mc=a;d.repeat=b;d.Tc=!0;return d};a.reset_timer_sensor=function(a,b,c,d){a=a||M;a=a.Qc;if(!a||!a[b])return v.error("reset_timer_sensor(): wrong object"),null;b=a[b].vd[c];if(!b)return v.error("reset_timer_sensor(): sensor not found"),null;b.Bc=I.get_timeline();b.Mc=d};a.create_elapsed_sensor=function(){var a=
c(140);a.Bc=0;return a};a.create_gyro_delta_sensor=function(){var a=c(170);a.da=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=c(180);a.da=new Float32Array(3);return a};a.create_timeline_sensor=function(){return c(150)};a.create_selection_sensor=function(a,b){var d=c(160);d.yd=a;d.jp=b;return d};a.fA=d;a.get_sensor_value=function(a,b,c){a=a||M;a=a.Qc;if(!a||!a[b])return v.error("get_sensor_value(): wrong object"),null;b=a[b].vd[c];return b?b.value:(v.error("get_sensor_value(): sensor not found"),
null)};a.get_sensor_payload=function(a,b,c){a=a||M;a=a.Qc;if(!a||!a[b])return v.error("get_sensor_payload(): wrong object"),null;b=a[b].vd[c];return b?b.da:(v.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){N=[];L=[];M={}};a.check_sensor_manifold=function(a,b){a=a||M;if(!a.Qc)return!1;if(b&&a.Qc[b])return!0;if(!b)for(var c in a.Qc)return!0;return!1};a.remove_sensor_manifold=function(a,c){a=a||M;var d=a.Qc;if(d){var g=a.Be;if(c){var G=d[c];if(G){for(var A=G.vd,D=0;D<A.length;D++)1===
e(A[D],N)&&h(A[D],L);delete d[c];G=g.indexOf(G);-1<G?g.splice(G,1):r.pa("Incorrect manifolds array");Object.getOwnPropertyNames(d).length||b(a)}}else{for(c in d){G=d[c];A=G.vd;for(D=0;D<A.length;D++)1===e(A[D],N)&&h(A[D],L);delete d[c];G=g.indexOf(G);-1<G?g.splice(G,1):r.pa("Incorrect manifolds array")}b(a);ea=!0}}};a.create_sensor_manifold=function(a,b,c,d,g,G,A){a=a||M;a.Qc=a.Qc||{};a.Be=a.Be||[];var D=a.Qc,f=a.Be,q=D[b];if(q){d=q.vd;for(var k=0;k<d.length;k++)1===e(d[k],N)&&h(d[k],L);q=f.indexOf(q);
-1<q?f.splice(q,1):r.pa("Incorrect manifolds array")}c={id:b,type:c,vd:d.slice(0),Zy:g,gA:Array(d.length),callback:G,Mv:A,or:-1,nr:0,jt:-1};D[b]=c;f.push(c);-1==N.indexOf(a)&&N.push(a);a=c.vd;for(b=0;b<a.length;b++){D=a[b];if(D.Tc){switch(D.type){case 80:t.append_collision_test(D.Ql,D.kc,D.Pl,D.vn);break;case 90:t.apply_collision_impulse_test(D.Ol,D.Hp);break;case 100:t.append_ray_test(D.yd,D.kc,D.Zn,D.km,D.uo,D.ns);break;case 130:D.Bc=I.get_timeline(),0>D.Mc&&(D.Mc=-D.Mc)}D.Tc=!1}-1==L.indexOf(D)&&
L.push(D)}ea=!0};a.em=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.$w=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<N.length;a++){var b=N[a],c=b.Qc,b=b.Be,d;for(d in c)delete c[d];b.splice(0,b.length)}for(a=0;a<L.length;a++)h(L[a],L),a--;N.splice(0,N.length)};a.debug=function(){v.log(String(N.length)+" objects with manifolds",N);v.log(String(L.length)+" sensors",L);for(var a=[],b=[],c=0;c<L.length;c++){var d=
L[c];80==d.type&&a.push(d);100==d.type&&b.push(d)}v.log(String(a.length)+" collision sensors",a);v.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",k,!1);a.addEventListener("keyup",f,!1);na=b};a.register_mouse_events=function(a,b,c){if(c)var d=window;else d=a,d.addEventListener("mouseout",g,!1);a.addEventListener("mousedown",n,!1);d.addEventListener("mousemove",l,!1);d.addEventListener("mouseup",g,!1);H=b;xa=c};a.register_wheel_events=function(a,
b){a.addEventListener("mousewheel",y,!1);a.addEventListener("DOMMouseScroll",y,!1);W=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",p,!1);a.addEventListener("touchmove",w,!1);document.addEventListener("touchstart",function(){});ba=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&A.gyro_use&&window.addEventListener("deviceorientation",z,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",k,!1);a.removeEventListener("keyup",
f,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",n,!1);a.removeEventListener("mousemove",l,!1);a.removeEventListener("mouseout",g,!1);a.removeEventListener("mouseup",g,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",y,!1);a.removeEventListener("DOMMouseScroll",y,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",p,!1);a.removeEventListener("touchmove",w,!1);document.removeEventListener("touchstart",function(){})};
a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&A.gyro_use&&window.removeEventListener("deviceorientation",z,!1)};a.KC=function(a){ra=a};a.LC=function(a){ja=a};a.OC=function(a){ca=a};a.NC=function(a){ka=a}};b4w.module.__curve=function(a,m){function c(a,b,c,d,e){var l=d.length;e||(e=new Float32Array(l));for(var y=l+a,p=new Float32Array(y),w=1;w<=y-1;w++)p[w-1]=b>=c[w-1]&&b<c[w+1-1]?1:0;for(var z=2;z<=a;z++)for(w=1;w<=y-z;w++)p[w-1]=(0!=p[w-1]?(b-c[w-1])*p[w-1]/(c[w+z-1-1]-c[w-1]):0)+(0!=p[w+1-1]?(c[w+z-1]-b)*p[w+1-1]/(c[w+z-1]-c[w+1-1]):0);b==c[y-1]&&(p[l-1]=1);a=0;for(w=1;w<=l;w++)a+=p[w-1]*d[w-1];for(w=1;w<=l;w++)e[w-1]=0!=a?p[w-1]*d[w-1]/a:0;return e}function d(a){a=a.jk;return a[a.length-1]}function b(a){a=
a.Tp;return a[a.length-1]}var e=m("__util");a.Mw=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;b.Ze=e;a=a.points;var g=a.length/5,l=[],y=g+e,g=g+2;l[0]=0;for(var p=2;p<=y;p++)l[p-1]=p>e&&p<g?l[p-2]+1:l[p-2];b.jk=l;if("2D"==d.dimensions)b.Ve=!1;else if("3D"==d.dimensions)b.Ve=!0;else throw"Wrong curve dimensions";e=[];l=[];for(d=0;d<a.length;d+=5)e.push(a[d]),e.push(a[d+1]),e.push(a[d+2]),b.Ve&&e.push(a[d+3]),l.push(a[d+4]);b.Ul=
e;b.Fo=l;a=[];for(var d=b.Ul,e=b.Ve?4:3,l=b.Fo,y=b.jk,g=b.Ze,p=d.length/e,w=p+g,z=0,E=y[w-1]/999,B=0;1E3>B;B++){5E-6>y[w-1]-z&&(z=y[w-1]);for(var v=c(g,z,y,l),t=0;t<e;t++)for(var x=a[e*B+t]=0;x<p;x++)a[e*B+t]+=v[x]*d[e*x+t];z+=E}e=b.Ve?4:3;l=new Float32Array(1E3);l[0]=0;for(d=1;1E3>d;d+=1)y=a[(d-1)*e],g=a[(d-1)*e+1],p=a[(d-1)*e+2],w=a[d*e],z=a[d*e+1],E=a[d*e+2],l[d]=l[d-1]+Math.sqrt((w-y)*(w-y)+(z-g)*(z-g)+(E-p)*(E-p));b.Tp=l;return b};a.TA=function(a,b,e){e||(e=[]);var n=b,g=Math.max(n,0);b=g=Math.min(n,
d(a));var n=a.Ul,g=a.Ve?4:3,l=a.Fo,y=a.jk,p=a.Ze;a=n.length/g;var w=a+p;5E-6>y[w-1]-b&&(b=y[w-1]);w=new Float32Array(a);c(p,b,y,l,w);for(b=0;b<g;b++)for(l=e[b]=0;l<a;l++)e[b]+=w[l]*n[g*l+b]};a.QA=function(a,b,c){c||(c=[]);var d=a.Ul,e=a.Ve?4:3,l=a.Fo,y=a.jk,p=a.Ze;a=d.length/e;var w=a+p;5E-6>y[w-1]-b&&(b=y[w-1]);var w=new Float32Array(a),z=b;b=w;var E=l.length;b||(b=new Float32Array(E));var B=new Float32Array(E),v=new Float32Array(E),t=B,x=v;t||(t=new Float32Array(E));x||(x=new Float32Array(E));for(var I=
E+p,r=new Float32Array(I),q=new Float32Array(I),C=1;C<=I-1;C++)r[C-1]=z>=y[C-1]&&z<y[C+1-1]?1:0;z==y[I-1]&&(r[E-1]=1);for(var J=2;J<=p;J++)for(C=1;C<=I-J;C++){var A=0!=r[C-1]?r[C-1]/(y[C+J-1-1]-y[C-1]):0,N=0!=r[C+1-1]?-r[C+1-1]/(y[C+J-1]-y[C+1-1]):0,L=0!=q[C-1]?(z-y[C-1])*q[C-1]/(y[C+J-1-1]-y[C-1]):0,M=0!=q[C+1-1]?(y[C+J-1]-z)*q[C+1-1]/(y[C+J-1]-y[C+1-1]):0;r[C-1]=(0!=r[C-1]?(z-y[C-1])*r[C-1]/(y[C+J-1-1]-y[C-1]):0)+(0!=r[C+1-1]?(y[C+J-1]-z)*r[C+1-1]/(y[C+J-1]-y[C+1-1]):0);q[C-1]=A+N+L+M}for(C=1;C<=
E;C++)t[C-1]=r[C-1],x[C-1]=q[C-1];y=0;for(p=1;p<=E;p++)y+=B[p-1]*l[p-1];z=0;for(p=1;p<=E;p++)z+=v[p-1]*l[p-1];for(p=1;p<=E;p++)b[p-1]=0!=y?v[p-1]*l[p-1]/y+B[p-1]*l[p-1]*z/(y*y):0;for(l=0;l<e;l++)for(y=c[l]=0;y<a;y++)c[l]+=w[y]*d[e*y+l]};a.EE=d;a.SA=b;a.RA=function(a,c){if(0>=c)return 0;var f=d(a);if(c>=b(a))return f;var n=a.Tp,g=e.yj(n,c,0,n.length-1);return f*(g+(c-n[g])/(n[g+1]-n[g]))/1E3}};b4w.module.__dds=function(a,m){function c(a,b,c,d){var e=new Uint16Array(4),g=new Uint16Array(c*d),h=0,f=0,k=0,x=f=h=0,n=0,r=0,q=0,C=c/4;d/=4;for(var J=0;J<d;J++)for(var A=0;A<C;A++)k=b+4*(J*C+A),e[0]=a[k],e[1]=a[k+1],h=e[0]&31,f=e[0]&2016,x=e[0]&63488,n=e[1]&31,r=e[1]&2016,q=e[1]&63488,e[2]=5*h+3*n>>3|5*f+3*r>>3&2016|5*x+3*q>>3&63488,e[3]=5*n+3*h>>3|5*r+3*f>>3&2016|5*q+3*x>>3&63488,h=a[k+2],f=4*J*c+4*A,g[f]=e[h&3],g[f+1]=e[h>>2&3],g[f+2]=e[h>>4&3],g[f+3]=e[h>>6&3],f+=c,g[f]=e[h>>8&3],g[f+1]=e[h>>
10&3],g[f+2]=e[h>>12&3],g[f+3]=e[h>>14],h=a[k+3],f+=c,g[f]=e[h&3],g[f+1]=e[h>>2&3],g[f+2]=e[h>>4&3],g[f+3]=e[h>>6&3],f+=c,g[f]=e[h>>8&3],g[f+1]=e[h>>10&3],g[f+2]=e[h>>12&3],g[f+3]=e[h>>14];return g}function d(a,b,d,e){var z=new Int32Array(d,0,31),E,B,v,t,x,I;if(542327876!=z[0])return k.error("Invalid magic number in DDS header"),0;if(!z[20]&4)return k.error("Unsupported format, must contain a FourCC code"),0;E=z[21];switch(E){case f:B=8;v=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case n:B=16;v=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case g:B=16;v=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return k.error("Unsupported FourCC code:",h(E)),null}I=1;z[2]&131072&&!1!==e&&(I=Math.max(1,z[7]));t=z[4];x=z[3];z=z[1]+4;if(b)for(E=0;E<I;++E)e=Math.max(4,t)/4*Math.max(4,x)/4*B,b=new Uint8Array(d,z,e),a.compressedTexImage2D(a.TEXTURE_2D,E,v,t,x,0,b),z+=e,t=Math.max(.5*t,1),x=Math.max(.5*x,1);else if(E==f)Math.max(4,t),Math.max(4,x),b=new Uint16Array(d),d=c(b,z/2,t,x),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,t,x,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),e&&a.generateMipmap(a.TEXTURE_2D);else return k.error("No manual decoder for",h(E),"and no native support"),0;return I}function b(a,b,c,e,g,h){var f=new XMLHttpRequest;f.open("GET",c,!0);f.responseType="arraybuffer";f.onload=function(){if(200==f.status){a.bindTexture(a.TEXTURE_2D,e);var c=d(a,b,f.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<c?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}h&&
h(e)};f.send(null);return e}function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function h(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var k=m("__print"),f=e("DXT1"),n=e("DXT3"),g=e("DXT5");a.nD=c;a.MB=d;a.Kq=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.cy=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case f:b=6;break;case n:case g:b=4;break;default:k.error("Unsupported FourCC code:",h(a))}return b};
a.jE=b;a.iE=function(a,c,d,e){var g=a.createTexture();b(a,c,d,g,!0,e);return g}};b4w.module.__debug=function(a,m){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function d(a,b){typeof a!=typeof b&&k.pa("Structure assertion failed: incompatible types");for(var c in a)c in b||k.pa("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||k.pa("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&k.pa("Structure assertion failed: incompatible types for key "+c)}var b=
m("__extensions"),e=m("__print"),h=m("__textures"),k=m("__util"),f=null,n={},g=!1,l={},y=[],p=-1,w=null,z=!1;a.Qo={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Xc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(n[a[d]]=d)}f=a};a.Wv=function(a){if(g){var b=f.getError();b!=f.NO_ERROR&&(b in n?k.pa("GL Error: "+b+", gl."+n[b]+" ("+
a+")"):k.pa("Unknown GL error: "+b+" ("+a+")"))}};a.Rv=function(){if(g)switch(f.checkFramebufferStatus(f.FRAMEBUFFER)){case f.FRAMEBUFFER_COMPLETE:break;case f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case f.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case f.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case f.FRAMEBUFFER_UNSUPPORTED:e.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:e.error("FRAMEBUFFER CHECK FAILED")}};a.Uv=function(){if(-1!=p)return p;f.bindFramebuffer(f.FRAMEBUFFER,f.createFramebuffer());var a=h.Mj("DEBUG",h.Vh);h.resize(a,1,1);f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,a.Lb,a.Ra,0);f.checkFramebufferStatus(f.FRAMEBUFFER)!=f.FRAMEBUFFER_COMPLETE?(p=!0,e.warn("depth-only issue was found")):p=!1;f.bindFramebuffer(f.FRAMEBUFFER,null);return p};
a.Xv=function(a,b,d){if(g&&!f.getShaderParameter(a,f.COMPILE_STATUS))throw d=c(d),e.error("shader compilation failed:\n"+d+"\n"+f.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.Yv=function(a,d,h,k,n,p){if(g&&!f.getProgramParameter(a,f.LINK_STATUS)){var q=b.zq();q&&(n=q.getTranslatedShaderSource(h),p=q.getTranslatedShaderSource(k));n=c(n);p=c(p);e.error("shader linking failed:\n"+n+"\n\n\n"+p+"\n"+f.getProgramInfoLog(a)+" ("+d+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){g=a};a.oD=function(a){l[a]=a in l?l[a]+1:1};a.update=function(){for(var a in l)e.log(a,l[a]),l[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(k.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}y.push(a)};a.msg=function(){for(var a=1,b=0;b<y.length;b++){var c=y[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],k.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);
else c.push(arguments[b]);y.push(c)};var E=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),g=0;g<y.length;g++){var h=y[g];a=h[0];if(!(a<d)){var f=String(h[1]);c[f]||(c[f]=E[b++%E.length]);a=["%c"+(a/1E3).toFixed(6),c[f],f];for(f=2;f<h.length;f++)a.push(h[f]);e.log.apply(this,a)}}y.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-
1E3*a),d=0;d<y.length;d++){var g=y[d];a=g[0];if(!(a<c))for(var h=2;h<g.length;h++){var f=String(g[1]);3<g.length&&(f+="_"+String(h-2));b[f]||(b[f]=f+"\n");b[f]+=String(a)+" "+g[h]+"\n"}}a="";for(f in b)a+=b[f]+"\n\n";e.log(a);y.splice(0)};a.VC=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(k.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.JC=function(a,b){typeof a!=b&&k.pa("Type assertion failed: value type is not a {"+b+"}:",a)};a.HC=d;a.IC=function(a){z?d(a,w):z=!0;w=a}};b4w.module.__extensions=function(a,m){function c(a){if(a in e)return e[a];var c=b.getExtension(a)||null;e[a]=c;d.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var d=m("__print"),b=null,e={};a.Xc=function(a){b=a};a.Gq=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.ey=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.Xx=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.zq=function(){return c("WEBGL_debug_shaders")};a.Fq=function(){return c("WEBGL_debug_renderer_info")};a.Aq=function(){return c("OES_element_index_uint")};a.qy=function(){return c("OES_standard_derivatives")};a.cleanup=function(){e={}}};b4w.module.__graph=function(a){function m(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.xa.push(b,d)}function c(a,b){for(var c=a.xa,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function d(a,b,d,e){e||(e=null);if(c(a,b)&&c(a,d))a.na.push(b,d,e);else throw"Wrong node IDs";}function b(a,b){if(!c(a,b))throw"Node not found";for(var d=a.xa,e=0;e<d.length;e+=2)d[e]==b&&(d.splice(e,2),e-=2)}function e(a){a=a.xa;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function h(a,b){for(var c=a.xa,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function k(a){var b=[],c={};f(a,c);for(var d=a.xa,e=0;e<d.length;e+=2)0==v(a,d[e])&&n(a,d[e],c,b);return{xa:b,na:a.na.slice(0)}}function f(a,b){for(var c=a.xa,d=0;d<c.length;d+=2)b[c[d]]=!1}function n(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<B(a,b);e++)n(a,t(a,b,e),c,d);d.unshift(b,E(a,b))}}function g(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<B(a,b);e++){var D=t(a,b,e);g(a,D,c,d)}if(20==d||30==d)for(e=
0;e<v(a,b);e++)D=x(a,b,e),g(a,D,c,d)}}function l(a){var b=a.xa;a=a.na;for(var c=[],d=[],e=[],g=0;g<b.length;g++)e[b[2*g]]=g,c.push(g,b[2*g+1]);for(g=0;g<a.length;g+=3)d.push(e[a[g]],e[a[g+1]],a[g+2]);return{xa:c,na:d}}function y(a,b,c){if(c.jd==c.Ye){for(var d=0,e=0;d<c.Ye;d++)-1!=c.Ud[d]&&(a[e]=d,b[e]=c.Ud[d],e++);return!0}if(c.Ye>c.rh||c.of>c.pf||c.Kh>c.Mh||c.Jh>c.Lh)return!1;for(var e=d=-1,g=!1;!g&&p(c,J,d,e);)if(d=J[0],e=J[1],w(c,d,e)){var h;h=c;g={};g.si=h.si;g.ti=h.ti;g.xn=h.xn;g.Rj=h.Rj;g.Ye=
h.Ye;g.rh=h.rh;g.Ze=h.Ze;g.jd=g.tk=h.jd;g.Jh=h.Jh;g.Kh=h.Kh;g.of=h.of;g.Lh=h.Lh;g.Mh=h.Mh;g.pf=h.pf;g.Zh=-1;g.Ud=h.Ud;g.Mf=h.Mf;g.Vf=h.Vf;g.Wf=h.Wf;g.kg=h.kg;g.lg=h.lg;g.Pk=h.Pk;h.Pk[0]+=1;var g=h=g,f=d,q=e,k=g.si,n=g.ti,l=g.Ye,r=g.rh,E=g.Ud,C=g.Mf,u=g.Vf,I=g.Wf,m=g.kg,ea=g.lg;z(f<l);z(q<r);z(g.jd<l);z(g.jd<r);l=++g.jd;g.Zh=f;u[f]||(u[f]=l,g.Jh++,m[f]&&g.of++);m[f]||(m[f]=l,g.Kh++,u[f]&&g.of++);I[q]||(I[q]=l,g.Lh++,ea[q]&&g.pf++);ea[q]||(ea[q]=l,g.Mh++,I[q]&&g.pf++);E[f]=q;C[q]=f;for(E=0;E<v(k,f);E++)C=
x(k,f,E),u[C]||(u[C]=l,g.Jh++,m[C]&&g.of++);for(E=0;E<B(k,f);E++)C=t(k,f,E),m[C]||(m[C]=l,g.Kh++,u[C]&&g.of++);for(E=0;E<v(n,q);E++)C=x(n,q,E),I[C]||(I[C]=l,g.Lh++,ea[C]&&g.pf++);for(E=0;E<B(n,q);E++)C=t(n,q,E),ea[C]||(ea[C]=l,g.Mh++,I[C]&&g.pf++);g=y(a,b,h);z(1>=h.jd-h.tk);z(-1!=h.Zh);C=h.si;f=h.ti;q=h.jd;k=h.Zh;n=h.Ud;u=h.Mf;l=h.Vf;I=h.Wf;r=h.kg;m=h.lg;if(h.tk<q){l[k]==q&&(l[k]=0);for(ea=0;ea<v(C,k);ea++)E=x(C,k,ea),l[E]==q&&(l[E]=0);r[k]==q&&(r[k]=0);for(ea=0;ea<B(C,k);ea++)E=t(C,k,ea),r[E]==q&&
(r[E]=0);C=n[k];I[C]==q&&(I[C]=0);for(ea=0;ea<v(f,C);ea++)E=x(f,C,ea),I[E]==q&&(I[E]=0);m[C]==q&&(m[C]=0);for(ea=0;ea<B(f,C);ea++)E=t(f,C,ea),m[E]==q&&(m[E]=0);n[k]=-1;u[C]=-1;h.jd=h.tk;h.Zh=-1}}return g}function p(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.of,g=a.pf,h=a.Kh,f=a.Mh,q=a.Jh,k=a.Lh,n=a.jd,x=a.Ye,l=a.rh,p=a.Ud,y=a.Mf,t=a.Vf,r=a.Wf,w=a.kg,v=a.lg;if(e>n&&g>n)for(;c<x&&(-1!=p[c]||0==w[c]||0==t[c]);)c++,d=0;else if(h>n&&f>n)for(;c<x&&(-1!=p[c]||0==w[c]);)c++,d=0;else if(q>n&&k>n)for(;c<x&&
(-1!=p[c]||0==t[c]);)c++,d=0;else if(0==c&&0!=a.Ze){for(t=0;t<x&&-1!=p[c=a.Ze[t]];)t++;t==x&&(c=x)}else for(;c<x&&-1!=p[c];)c++,d=0;if(e>n&&g>n)for(;d<l&&(-1!=y[d]||0==v[d]||0==r[d]);)d++;else if(h>n&&f>n)for(;d<l&&(-1!=y[d]||0==v[d]);)d++;else if(q>n&&k>n)for(;d<l&&(-1!=y[d]||0==r[d]);)d++;else for(;d<l&&-1!=y[d];)d++;return c<x&&d<l?(b[0]=c,b[1]=d,!0):!1}function w(a,b,c){var d=a.si,e=a.ti,g=a.rh,h=a.Ud,f=a.Mf,q=a.Vf,k=a.Wf,n=a.kg,l=a.lg;z(b<a.Ye);z(c<g);z(-1==h[b]);z(-1==f[c]);if(!(0,a.xn)(E(d,
b),E(e,c)))return!1;for(var p=g=0,y=0,w=0,J=0,C=0,m=0;m<B(d,b);m++){var ea=t(d,b,m);if(-1!=h[ea]){var Y=h[ea];if(!I(e,c,Y)||!r(a.Rj,d,b,ea,e,c,Y))return!1}else q[ea]&&y++,n[ea]&&g++,q[ea]||n[ea]||J++}for(m=0;m<v(d,b);m++)if(ea=x(d,b,m),-1!=h[ea]){if(Y=h[ea],!I(e,Y,c)||!r(a.Rj,d,ea,b,e,Y,c))return!1}else q[ea]&&y++,n[ea]&&g++,q[ea]||n[ea]||J++;for(m=0;m<B(e,c);m++)if(Y=t(e,c,m),-1!=f[Y]){if(ea=f[Y],!I(d,b,ea))return!1}else k[Y]&&w++,l[Y]&&p++,k[Y]||l[Y]||C++;for(m=0;m<v(e,c);m++)if(Y=x(e,c,m),-1!=
f[Y]){if(ea=f[Y],!I(d,ea,b))return!1}else k[Y]&&w++,l[Y]&&p++,k[Y]||l[Y]||C++;return y<=w&&g<=p&&J<=C}function z(a){if(!a)throw"Assertion failed";}function E(a,b){for(var c=a.xa,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function B(a,b){for(var c=a.na,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function v(a,b){for(var c=a.na,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function t(a,b,c){a=a.na;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function x(a,
b,c){a=a.na;for(var d=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function I(a,b,c){a=a.na;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function r(a,b,c,d,e,g,h){for(var f=q(b,c,d),k=q(e,g,h),n=0;n<f;n++){for(var x=!1,l=0;l<k;l++)if(a(C(b,c,d,n),C(e,g,h,l))){x=!0;break}if(!x)return!1}return!0}function q(a,b,c){var d=0;a=a.na;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function C(a,b,c,d){a=a.na;for(var e=0,g=0;g<a.length;g+=3)if(a[g]==
b&&a[g+1]==c){if(e==d)return a[g+2];e++}return null}var J=[-1,-1];a.Mo=-1;a.yC=10;a.Jo=20;a.CC=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{xa:b,na:c}};a.gD=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{xa:c,na:d}};a.rl=m;a.PD=c;a.gd=
d;a.Ti=b;a.sg=function(a,b,c,d){if(!I(a,b,c))throw"Edge not found";a=a.na;for(var e=0,g=0;g<a.length;g+=3)if(a[g]==b&&a[g+1]==c){if(-1==d)a.splice(g,3);else{if(d==e){a.splice(g,3);break}e++}g-=3}};a.v=function(a,b){if(-1==h(a,b)){var c=e(a);m(a,c,b);return c}throw"Non-unique attribute";};a.Sz=function(a,b,c,d,e){a=a.na;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&a[g+2]==d&&(a[g+2]=e)};a.sq=e;a.sh=h;a.l=function(a,b,c,e){b=h(a,b);c=h(a,c);if(-1!=b&&-1!=c)d(a,b,c,e);else throw"Attributes not found";
};a.T=function(a,b){for(var c=a.xa,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.te=function(a,b){for(var c=a.na,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.ue=function(a,b,c){for(var d=a.na,e=0;e<d.length;e+=3)if(d[e+1]==b){var g=d[e];if(c(g,E(a,g),d[e+2]))break}};a.rf=function(a,b,c){for(var d=a.na,e=0;e<d.length;e+=3)if(d[e]==b){var g=d[e+1];if(c(g,E(a,g),d[e+2]))break}};a.mo=k;a.jB=function(a){a=k(a).xa;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.ZD=function(){};a.Zs=function(a,
b,d){if(!c(a,b))throw"No such node";var e={};f(a,e);g(a,b,e,d);b=[];for(var h in e)e[h]&&(h=Number(h),b.push(h,E(a,h)));a={xa:b,na:a.na.slice(0)};e=a.na;for(h=0;h<e.length;h+=3)b=e[h+1],c(a,e[h])&&c(a,b)||(e.splice(h,3),h-=3);return a};a.py=function(a){for(var b=[],c=a.xa,d=0;d<c.length;d+=2){var e=c[d];v(a,e)||b.push(e)}return b};a.Iq=function(a){for(var b=[],c=a.xa,d=0;d<c.length;d+=2){var e=c[d];B(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.si=l(a);e.ti=l(b);e.xn=c||function(a,
b){return a==b};e.Rj=d||function(a,b){return a==b};d=a.xa.length/2;var g=b.xa.length/2;e.Ye=d;e.rh=g;e.Ze=0;e.jd=e.tk=0;e.of=e.Jh=e.Kh=0;e.pf=e.Lh=e.Mh=0;e.Zh=-1;e.Ud=Array(d);e.Mf=Array(g);e.Vf=Array(d);e.Wf=Array(g);e.kg=Array(d);e.lg=Array(g);e.Pk=[1];for(c=0;c<d;c++)e.Ud[c]=-1,e.Vf[c]=0,e.kg[c]=0;for(c=0;c<g;c++)e.Mf[c]=-1,e.Wf[c]=0,e.lg[c]=0;g=Array(d);d=Array(d);if(y(g,d,e)){for(c=0;c<g.length;c++)g[c]=a.xa[2*g[c]],d[c]=b.xa[2*d[c]];return[g,d]}return null};a.Ua=E;a.uh=B;a.Zq=v;a.bh=t;a.Xj=
x;a.ID=q;a.$g=C;a.replace=function(a,c,d){for(var g=a.na,h=e(a),f=0;f<c.length;f++){var q=c[f];b(a,q);for(var k=0;k<g.length;k+=3)g[k]==q&&(g[k]=h),g[k+1]==q&&(g[k+1]=h),g[k]==g[k+1]&&(g.splice(k,3),k-=3)}m(a,h,d)};a.Kz=function(a,b,c,d,e){if(!I(a,b,c))throw"Edge not found";a=a.na;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&(a[g]=d,a[g+1]=e)};a.hD=function(a,b){var c=a.xa,d=a.na,e;e="digraph debug {\n    node [shape=box];\n";for(var g=0;g<c.length;g+=2){var h=c[g],f=c[g+1],f=b?b(h,f):String(h);
e+="    ";e+=String(h)+' [label="'+f.replace(/\"/g,'\\"')+'"];\n'}for(g=0;g<d.length;g+=3)c=d[g],h=d[g+1],e+="    ",e+=String(c)+" -> "+String(h)+";\n";return e+="}"}};b4w.module.__ipc=function(a){a.Ot=0;var m=a.Ht=1;a.It=2;a.Kt=3;a.Lt=4;a.Mt=5;a.Pt=6;var c=a.Rt=7,d=a.St=8,b=a.Tt=9;a.Ut=10;a.Qt=11;a.Nt=12;a.Jt=13;a.qu=100;a.Id=101;a.Vt=102;a.Wt=103;a.Xt=104;a.Zt=105;a.Yt=106;a.$t=107;a.au=108;a.bu=109;a.cu=110;a.du=111;a.eu=112;a.fu=113;a.gu=114;a.hu=115;a.iu=116;a.ju=117;a.ku=118;a.lu=119;a.mu=120;a.ou=121;a.pu=122;a.ru=123;a.Oo=124;a.su=125;a.tu=126;a.uu=127;a.vu=128;a.wu=129;a.xu=130;a.yu=131;a.zu=132;a.Au=133;a.Bu=134;a.Cu=135;a.Du=136;a.Po=137;var e=a.mj=138;
a.Eu=139;a.No=140;a.Fu=141;a.Gu=142;a.AC=143;a.nu=144;var h=null,k={msg_id:b,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),cc:new Float32Array(16)};k.cc[0]=b;var f={msg_id:c,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),cc:new Float32Array(10)};f.cc[0]=c;var n={msg_id:d,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0,cc:new Float32Array(11)};
n.cc[0]=d;var g={msg_id:m,body_id_a:0,body_id_b:0,result:0,coll_point:new Float32Array(3),cc:new Float32Array(7)};g.cc[0]=m;var l={msg_id:e,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),cc:new Float32Array(9)};l.cc[0]=e;a.init=function(a,p){a.addEventListener("message",function(a){a=a.data;var h=a[0]|0;switch(h){case b:var y=k;y.body_id=a[1];y.time=a[2];y.trans[0]=a[3];y.trans[1]=a[4];y.trans[2]=a[5];y.quat[0]=a[6];y.quat[1]=a[7];y.quat[2]=a[8];y.quat[3]=a[9];y.linvel[0]=a[10];y.linvel[1]=
a[11];y.linvel[2]=a[12];y.angvel[0]=a[13];y.angvel[1]=a[14];y.angvel[2]=a[15];break;case c:y=f;y.chassis_hull_body_id=a[1];y.prop_ind=a[2];y.trans[0]=a[3];y.trans[1]=a[4];y.trans[2]=a[5];y.quat[0]=a[6];y.quat[1]=a[7];y.quat[2]=a[8];y.quat[3]=a[9];break;case d:y=n;y.body_id=a[1];y.from[0]=a[2];y.from[1]=a[3];y.from[2]=a[4];y.to[0]=a[5];y.to[1]=a[6];y.to[2]=a[7];y.local=a[8];y.body_id_b_hit=a[9];y.cur_result=a[10];break;case m:y=g;y.body_id_a=a[1];y.body_id_b=a[2];y.result=a[3];y.coll_point[0]=a[4];
y.coll_point[1]=a[5];y.coll_point[2]=a[6];break;case e:y=l;y.body_id=a[1];y.trans[0]=a[2];y.trans[1]=a[3];y.trans[2]=a[4];y.quat[0]=a[5];y.quat[1]=a[6];y.quat[2]=a[7];y.quat[3]=a[8];break;default:y=a}p(h,y)},!1);h=a};a.cleanup=function(){h=null};a.t=function(){if(h){switch(arguments[0]|0){case b:var a=k,p=a.cc;p[1]=a.body_id;p[2]=a.time;p[3]=a.trans[0];p[4]=a.trans[1];p[5]=a.trans[2];p[6]=a.quat[0];p[7]=a.quat[1];p[8]=a.quat[2];p[9]=a.quat[3];p[10]=a.linvel[0];p[11]=a.linvel[1];p[12]=a.linvel[2];
p[13]=a.angvel[0];p[14]=a.angvel[1];p[15]=a.angvel[2];break;case c:a=f;p=a.cc;p[1]=a.chassis_hull_body_id;p[2]=a.prop_ind;p[3]=a.trans[0];p[4]=a.trans[1];p[5]=a.trans[2];p[6]=a.quat[0];p[7]=a.quat[1];p[8]=a.quat[2];p[9]=a.quat[3];break;case d:a=n;p=a.cc;p[1]=a.body_id;p[2]=a.from[0];p[3]=a.from[1];p[4]=a.from[2];p[5]=a.to[0];p[6]=a.to[1];p[7]=a.to[2];p[8]=a.local;p[9]=a.body_id_b_hit;p[10]=a.cur_result;break;case m:a=g;p=a.cc;p[1]=a.body_id_a;p[2]=a.body_id_b;p[3]=a.result;p[4]=a.coll_point[0];p[5]=
a.coll_point[1];p[6]=a.coll_point[2];break;case e:a=l;p=a.cc;p[1]=a.body_id;p[2]=a.trans[0];p[3]=a.trans[1];p[4]=a.trans[2];p[5]=a.quat[0];p[6]=a.quat[1];p[7]=a.quat[2];p[8]=a.quat[3];break;default:for(p=[],a=0;a<arguments.length;a++)p.push(arguments[a])}h.postMessage(p)}};a.Eq=function(a){switch(a){case b:return k;case c:return f;case d:return n;case m:return g;case e:return l;default:return null}}};b4w.module.__hud=function(a,m){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function d(a){b(' SCENE "'+a.name+'"');if(a.d){var c=0,d=0;f.T(a.d.nb,function(a,e){if("SINK"==e.type)b(" (F)",e.type);else{var g=e.type,h=Math.round(e.h.width)+"x"+Math.round(e.h.height),f=e.p.length,k=e.hi,n=e.enqueue&&e.Ta;n?b(" (A)",g,e.ig,h,k,"of",f):b(" (P)",g,e.ig,h,k,"of",f);e.hi=0;n&&(c+=f,d+=k)}});return[c,d]}b("No INFO")}function b(){for(var a=80+20*g[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var e="",h=0;h<b[d]-String(arguments[d]).length;h++)e+=" ";c+=e+arguments[d]}g[0]++;n.fillText(c,30,a)}function e(a,b,c){b*=a.Ea;c.x=a.x+b;c.y=a.y;c.Ea=a.Ea-2*b;c.wa=a.wa}function h(a){return a.x+a.Ea/2}function k(a){var b=n,c={x:0,y:0,Ea:0,wa:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.Ea=d;c.wa=b;e(c,.01,c);d=.02*c.wa;c.x=c.x;c.y+=d;c.Ea=c.Ea;c.wa-=2*d;d=c.Ea/8;c.x+=d*a;c.y=c.y;c.Ea=d;c.wa=c.wa;e(c,.02,c);return c}var f=m("__graph"),
n=null,g=[0,0];a.init=function(a){a=a.getContext("2d");c(a);return n=a};a.Oh=function(){n&&c(n)};a.reset=function(){var a=n;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),g[0]=0,g[1]=0)};a.DA=function(a,c){var e=n;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/c).toFixed(2));g[0]++;for(var h=e=0,f=0;f<a.length;f++){var k=d(a[f]),e=e+k[0],h=h+k[1];g[0]++}b(" ---------------------------------------------");
b("    ","TOTAL ACTIVE","","",h,"of",e)}};a.print=function(){var a=n;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,e,g,f){var v=n;if(v){b=k(b);var t=b.wa/5;b.x=b.x;b.y+=4*t;b.Ea=b.Ea;b.wa=t;v.textAlign="center";v.fillStyle="#00FF00";n.fillText(a,h(b),b.y-10);v.strokeStyle="#00FF00";v.lineWidth=.5;v.beginPath();v.moveTo(b.x,b.y);v.lineTo(b.x+b.Ea,b.y);v.lineTo(b.x+b.Ea,b.y+b.wa);v.lineTo(b.x,b.y+b.wa);v.closePath();v.stroke();if(!g&&
!f)for(g=1E6,f=-1E6,a=0;a<c.length;a++)g=Math.min(g,c[a]),f=Math.max(f,c[a]);v.textAlign="right";n.fillText(String(g),b.x-10,b.y+b.wa);n.fillText(String(f),b.x-10,b.y);v.textAlign="center";n.fillText(String(d),b.x,b.y+b.wa+15);n.fillText(String(e),b.x+b.Ea,b.y+b.wa+15);v.strokeStyle="#FF0000";v.lineWidth=1.5;v.beginPath();d=b.Ea/(c.length-1);f=b.wa/(f-g);for(a=0;a<c.length;a++)e=b.x+d*a,t=b.y+b.wa-(c[a]-g)*f,0==a?v.moveTo(e,t):v.lineTo(e,t);v.stroke()}};a.draw_mixer_strip=function(a,b,c,d,e,g,f){var v=
n;if(v)for(v.textAlign="center",v.fillStyle="#00FF00",v.font="bold 12px Courier",c=k(c),n.fillText(b?"["+a+"]":a,h(c),c.y),0<=g&&n.fillText(g?"[M]":"[ ]",h(c)-15,c.y+30),0<=f&&n.fillText(f?"[S]":"[ ]",h(c)+15,c.y+30),a={x:0,y:0,Ea:0,wa:0},b=0;b<d.length;b++){g=d[b];var t="VOLUME"==g[0];if(t){f=c.y+350;var x=c.Ea,I=a;I.x=c.x;I.y=f;I.Ea=x;I.wa=250}else{f=c.y+10+50*b;var x=c.Ea,I=c.wa,r=a;r.x=c.x;r.y=f;r.Ea=x;r.wa=I}f=v;var x=a,r=b==e,q=g[0],I=g[1],C=g[2],J=g[3],A=(J-C)/g[4],A=1>A?Math.floor(1/A-1E-5).toFixed(0).length:
0;g=g[5]?Math.log(I/C)/Math.log(J/C):(I-C)/(J-C);f.textAlign="center";r?f.fillText("["+q+"]",h(x),x.y):f.fillText(q,h(x),x.y);f.strokeStyle="#00FF00";f.lineWidth=t?3:1;t?(f.textAlign="right",f.fillText(J.toFixed(A),h(x)-10,x.y+15),f.textAlign="right",f.fillText(C.toFixed(A),h(x)-10,x.y+x.wa-15)):(f.textAlign="right",f.fillText(C.toFixed(A),x.x+28,x.y+15),f.textAlign="left",f.fillText(J.toFixed(A),x.x+x.Ea-28,x.y+15));f.beginPath();if(t){var N=x.y+15+(x.wa-30)*(1-g);f.moveTo(h(x),x.y+15);f.lineTo(h(x),
x.y+x.wa-15);f.moveTo(h(x)-5,x.y+15);f.lineTo(h(x)+5,x.y+15);f.moveTo(h(x)-5,x.y+x.wa-15);f.lineTo(h(x)+5,x.y+x.wa-15);f.moveTo(h(x)-5,N);f.lineTo(h(x)+5,N)}else{var L=x.x+30+(x.Ea-60)*g;f.moveTo(x.x+30,x.y+15);f.lineTo(x.x+x.Ea-30,x.y+15);f.moveTo(x.x+30,x.y+15-5);f.lineTo(x.x+30,x.y+15+5);f.moveTo(x.x+x.Ea-30,x.y+15-5);f.lineTo(x.x+x.Ea-30,x.y+15+5);f.moveTo(L,x.y+15-5);f.lineTo(L,x.y+15+5)}f.stroke();"EQ_Q"==q?(g=Math.log(1+1/(2*I*I)+Math.sqrt((2+1/(I*I))*(2+1/(I*I))/4-1))/Math.log(2),t?(f.textAlign=
"left",f.fillText(I.toFixed(A),h(x)+10,N),f.textAlign="left",f.fillText("("+g.toFixed(A+1)+")",h(x)+10,N+10)):(f.textAlign="right",f.fillText(I.toFixed(A),L,x.y+30),f.textAlign="left",f.fillText("("+g.toFixed(A+1)+")",L,x.y+30))):t?(f.textAlign="left",f.fillText(I.toFixed(A),h(x)+10,N)):(f.textAlign="center",f.fillText(I.toFixed(A),L,x.y+30))}}};b4w.module.__renderer=function(a,m){function c(a){for(var c=a.h,d=a.p,g=0;g<d.length;g++){var h=d[g];if(h.Ta){var f=a,k=c,n=h.sd,l=h.D,p=l.Xb;v.useProgram(p.Ni);for(var h=l.S,G=l.hp,D=p.gt,O=D.length;O--;){var w=D[O];w.Bm(v,w.dg,f,n,l,k)}k=l.Lp;v.colorMask(k,k,k,k);v.depthMask(l.W);l.Ja?v.enable(v.CULL_FACE):v.disable(v.CULL_FACE);k=l.N;for(l=0;l<k.length;l++)D=k[l],v.activeTexture(v.TEXTURE0+l),v.bindTexture(D.Lb,D.Ra);if("SKY"==f.type){k=f;p=p.Zi;l=k.h.bb.Ra;D=k.gi;for(O=0;6>O;O++)if(w=e(O),y.Nl?
(v.bindTexture(v.TEXTURE_CUBE_MAP,l),v.texImage2D(w,0,v.RGBA,1,1,0,v.RGBA,v.UNSIGNED_BYTE,B)):(v.uniformMatrix4fv(p.u_cube_view_matrix,!1,D[O]),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,w,l,0),b(h,G,n.vo)),k.rk&&3!=O){var w=k,Z=O,z=t;y.Nl?z.set(B):(v.readPixels(191,191,1,1,v.RGBA,v.UNSIGNED_BYTE,z),255!=z[0]&&255!=z[1]&&255!=z[2]||v.readPixels(191,220,1,1,v.RGBA,v.UNSIGNED_BYTE,z));var E=z[0],m=z[1],z=z[2],E=E/255,m=m/255,z=z/255;2===Z?(w.lc[3]=E,w.lc[7]=m,w.lc[11]=z):2>Z?(w.lc[4*Z]=
E,w.lc[4*Z+1]=m,w.lc[4*Z+2]=z):(w.lc[4*(Z-2)]=E,w.lc[4*(Z-2)+1]=m,w.lc[4*(Z-2)+2]=z)}f.hi+=6}else b(h,G,n.vo),f.hi++}}}function d(a){if(a){var b=(a.ba?v.COLOR_BUFFER_BIT:0)|(a.ha?v.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=E;break;case "SHADOW_CAST":a=p;break;case "DEPTH":a=w;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=z;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=E;break;default:a=y.background_color}}else b=
v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT,a=y.background_color;v.colorMask(!0,!0,!0,!0);v.depthMask(!0);v.clearColor(a[0],a[1],a[2],a[3]);v.clear(b)}function b(a,b,c){v.bindBuffer(v.ARRAY_BUFFER,a.tf);for(var d=0;d<b.length;d++){var e=b[d];v.enableVertexAttribArray(e.dg);v.vertexAttribPointer(e.dg,e.rd,v.FLOAT,!1,0,e.zv+e.Bx*c)}a.fe?(v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,a.fe),v.drawElements(a.mode,a.count,a.Rm,0)):v.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],v.disableVertexAttribArray(e.dg)}
function e(a){switch(a){case 0:return v.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return v.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return v.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return v.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return v.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return v.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function h(a){var b=a.Zi,c=[],d=[],e={},g;for(g in b){var h=!1;switch(g){case "u_proj_matrix":var f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.qa)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":f=
function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.fa)};h=!0;break;case "u_shadow_cast_billboard_view_matrix":f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Es)};h=!0;break;case "u_view_proj_prev":f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Hz)};h=!0;break;case "u_view_proj_inverse":f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Qh)};h=!0;break;case "u_sky_vp_inverse":f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.xd)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":f=function(a,
b,c,d,e,g){a.uniform3fv(b,g.Pe)};h=!0;break;case "u_camera_eye_last":f=function(a,b,c,d,e,g){a.uniform3fv(b,g.iq)};h=!0;break;case "u_camera_quat":f=function(a,b,c,d,e,g){a.uniform4fv(b,g.quat)};h=!0;break;case "u_view_max_depth":f=function(a,b,c,d,e,g){a.uniform1f(b,g.cb)};h=!0;break;case "u_camera_range":f=function(a,b,c,d,e,g){a.uniform2f(b,g.Va,g.cb)};break;case "u_csm_center_dists":f=function(a,b,c,d,e,g){a.uniform4fv(b,g.Sp)};break;case "u_cam_water_depth":f=function(a,b,c){a.uniform1f(b,c.Jl)};
h=!0;break;case "u_waves_height":f=function(a,b,c){a.uniform1f(b,c.xf)};break;case "u_waves_length":f=function(a,b,c){a.uniform1f(b,c.Fg)};break;case "u_fog_color_density":f=function(a,b,c){a.uniform4fv(b,c.Yb)};break;case "u_underwater_fog_color_density":f=function(a,b,c){a.uniform4fv(b,c.bd)};break;case "u_bloom_key":f=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":f=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":f=function(a,b,c){a.uniform1f(b,c.time)};
h=!0;break;case "u_wind":f=function(a,b,c){a.uniform3fv(b,c.fj)};break;case "u_sky_tex_dvar":f=function(a,b,c){a.uniform1f(b,c.Is)};break;case "u_sky_tex_fac":f=function(a,b,c){a.uniform4fv(b,c.Js)};break;case "u_sky_tex_color":f=function(a,b,c){a.uniform3fv(b,c.Hs)};break;case "u_horizon_color":f=function(a,b,c){a.uniform3fv(b,c.Se)};break;case "u_zenith_color":f=function(a,b,c){a.uniform3fv(b,c.yf)};break;case "u_environment_energy":f=function(a,b,c){a.uniform1f(b,c.Oe)};break;case "u_world_vec":f=
function(a,b,c,d,e,g){c=g.fa;a.uniform3fv(b,[c[4],c[5],c[6]])};h=!0;break;case "u_sky_color":f=function(a,b,c){a.uniform3fv(b,c.Ah)};break;case "u_rayleigh_brightness":f=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":f=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":f=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":f=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":f=
function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":f=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":f=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":f=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":f=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":f=function(a,b,c){a.uniform3fv(b,c.bg)};break;case "u_light_directions":f=
function(a,b,c){a.uniform3fv(b,c.$f)};break;case "u_light_color_intensities":f=function(a,b,c){a.uniform3fv(b,c.Zf)};break;case "u_light_factors":f=function(a,b,c){a.uniform4fv(b,c.ag)};break;case "u_sun_quaternion":f=function(a,b,c){a.uniform4fv(b,c.bt)};break;case "u_sun_intensity":f=function(a,b,c){a.uniform3fv(b,c.at)};break;case "u_sun_direction":f=function(a,b,c){a.uniform3fv(b,c.Uk)};break;case "u_height":f=function(a,b,c,d,e,g){a.uniform1f(b,g.height)};h=!0;break;case "u_model_matrix":f=function(a,
b,c,d){a.uniformMatrix4fv(b,!1,d.U)};h=!0;break;case "u_transb":f=function(a,b,c,d){a.uniform4fv(b,d.Dc)};h=!0;break;case "u_transa":f=function(a,b,c,d){a.uniform4fv(b,d.Cc)};h=!0;break;case "u_arm_rel_trans":f=function(a,b,c,d){a.uniform4fv(b,d.tl)};h=!0;break;case "u_arm_rel_quat":f=function(a,b,c,d){a.uniform4fv(b,d.sl)};h=!0;break;case "u_quat":f=function(a,b,c,d){a.uniform4fv(b,d.quat)};h=!0;break;case "u_quatsb":f=function(a,b,c,d){a.uniform4fv(b,d.vc)};h=!0;break;case "u_quatsa":f=function(a,
b,c,d){a.uniform4fv(b,d.uc)};h=!0;break;case "u_frame_factor":f=function(a,b,c,d){a.uniform1f(b,d.Rf)};h=!0;break;case "au_center_pos":f=function(){};h=!0;break;case "au_wind_bending_amp":f=function(a,b,c,d){a.uniform1f(b,d.dd)};h=!0;break;case "au_wind_bending_freq":f=function(a,b,c,d){a.uniform1f(b,d.ve)};h=!0;break;case "au_detail_bending_freq":f=function(a,b,c,d){a.uniform1f(b,d.Wd)};h=!0;break;case "au_detail_bending_amp":f=function(a,b,c,d){a.uniform1f(b,d.Vd)};h=!0;break;case "au_branch_bending_amp":f=
function(a,b,c,d){a.uniform1f(b,d.Rd)};h=!0;break;case "u_node_values":f=function(a,b,c,d){a.uniform1fv(b,d.ie)};h=!0;break;case "u_node_rgbs":f=function(a,b,c,d){a.uniform3fv(b,d.rc)};h=!0;break;case "u_diffuse_color":f=function(a,b,c,d,e){a.uniform4fv(b,e.Ob)};h=!0;break;case "u_diffuse_intensity":f=function(a,b,c,d,e){a.uniform1f(b,e.Ke)};h=!0;break;case "u_diffuse_params":f=function(a,b,c,d,e){a.uniform2fv(b,e.Xd)};h=!0;break;case "u_emit":f=function(a,b,c,d,e){a.uniform1f(b,e.ae)};h=!0;break;
case "u_ambient":f=function(a,b,c,d,e){a.uniform1f(b,e.Nd)};h=!0;break;case "u_specular_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.zd)};h=!0;break;case "u_specular_alpha":f=function(a,b,c,d,e){a.uniform1f(b,e.Bh)};h=!0;break;case "u_specular_params":f=function(a,b,c,d,e){a.uniform3fv(b,e.gc)};h=!0;break;case "u_reflect_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.rg)};h=!0;break;case "u_mirror_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.tn)};h=!0;break;case "u_grass_map_dim":f=function(a,b,
c,d,e){a.uniform3fv(b,e.$b)};h=!0;break;case "u_grass_size":f=function(a,b,c,d,e){a.uniform1f(b,e.Km)};h=!0;break;case "u_scale_threshold":f=function(a,b,c,d,e){a.uniform1f(b,e.Lq)};h=!0;break;case "u_cube_fog":f=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.lc)};break;case "u_jitter_amp":f=function(a,b,c,d,e){a.uniform1f(b,e.jr)};h=!0;break;case "u_jitter_freq":f=function(a,b,c,d,e){a.uniform1f(b,e.kr)};h=!0;break;case "u_wireframe_mode":f=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;
case "u_wireframe_edge_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":f=function(a,b,c){a.uniform2fv(b,c.Ty)};h=!0;break;case "u_subsample_indices":f=function(a,b,c){a.uniform4fv(b,c.Uy)};h=!0;break;case "u_refr_bump":f=function(a,b,c,d,e){a.uniform1f(b,e.ps)};h=!0;break;case "u_lamp_light_positions":f=function(a,b,c,d,e){a.uniform3fv(b,e.bn)};break;case "u_lamp_light_directions":f=function(a,b,c,d,e){a.uniform3fv(b,e.$m)};break;case "u_lamp_light_color_intensities":f=
function(a,b,c,d,e){a.uniform3fv(b,e.Zm)};break;case "u_lamp_light_factors":f=function(a,b,c,d,e){a.uniform4fv(b,e.an)};break;case "u_halo_size":f=function(a,b,c,d,e){a.uniform1f(b,e.Qq)};h=!0;break;case "u_halo_hardness":f=function(a,b,c,d,e){a.uniform1f(b,e.Nq)};h=!0;break;case "u_halo_rings_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.Pq)};h=!0;break;case "u_halo_lines_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.Oq)};h=!0;break;case "u_halo_stars_blend":f=function(a,b,c,d,e){a.uniform1f(b,e.Rq)};
h=!0;break;case "u_halo_stars_height":f=function(a,b,c,d,e){a.uniform1f(b,e.Sq)};h=!0;break;case "u_fresnel_params":f=function(a,b,c,d,e){a.uniform4fv(b,e.Uc)};h=!0;break;case "u_texture_scale":f=function(a,b,c,d,e){a.uniform3fv(b,e.qf)};h=!0;break;case "u_parallax_scale":f=function(a,b,c,d,e){a.uniform1f(b,e.ng)};h=!0;break;case "u_color_id":f=function(a,b,c,d){a.uniform3fv(b,d.Jj)};h=!0;break;case "u_line_points":f=function(a,b,c,d,e){a.uniform3fv(b,e.hE)};h=!0;break;case "u_diffuse_color_factor":f=
function(a,b,c,d,e){a.uniform1f(b,e.Je)};h=!0;break;case "u_alpha_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.Ce)};h=!0;break;case "u_specular_color_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.Ps)};h=!0;break;case "u_normal_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.Er)};h=!0;break;case "u_normalmap0_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.hg[0])};h=!0;break;case "u_normalmap1_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.hg[1])};h=!0;break;case "u_normalmap2_scale":f=function(a,b,c,
d,e){a.uniform2fv(b,e.hg[2])};h=!0;break;case "u_normalmap3_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.hg[3])};h=!0;break;case "u_foam_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":f=function(a,b,c,d,e){a.uniform2fv(b,e.mq)};h=!0;break;case "u_foam_mag":f=function(a,b,c,d,e){a.uniform2fv(b,e.lq)};h=!0;break;case "u_foam_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.vm)};h=!0;break;case "u_water_norm_uv_velocity":f=function(a,b,c,d,e){a.uniform1f(b,
e.Sh)};h=!0;break;case "u_shallow_water_col":f=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":f=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":f=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":f=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":f=function(a,b,c,d,e){a.uniform1f(b,e.Ur)};h=!0;break;case "u_p_cyclic":f=
function(a,b,c,d,e){a.uniform1i(b,e.Qr)};h=!0;break;case "u_p_max_lifetime":f=function(a,b,c,d,e){a.uniform1f(b,e.Wr)};h=!0;break;case "u_p_fade_in":f=function(a,b,c,d,e){a.uniform1f(b,e.Rr)};h=!0;break;case "u_p_fade_out":f=function(a,b,c,d,e){a.uniform1f(b,e.Sr)};h=!0;break;case "u_p_size":f=function(a,b,c,d,e){a.uniform1f(b,e.Cn)};h=!0;break;case "u_p_alpha_start":f=function(a,b,c,d,e){a.uniform1f(b,e.Nr)};h=!0;break;case "u_p_alpha_end":f=function(a,b,c,d,e){a.uniform1f(b,e.Mr)};h=!0;break;case "u_p_nfactor":f=
function(a,b,c,d,e){a.uniform1f(b,e.Bn)};h=!0;break;case "u_p_gravity":f=function(a,b,c,d,e){a.uniform1f(b,e.Tr)};h=!0;break;case "u_p_mass":f=function(a,b,c,d,e){a.uniform1f(b,e.Vr)};h=!0;break;case "u_p_size_ramp":f=function(a,b,c,d,e){a.uniform2fv(b,e.Xr)};h=!0;break;case "u_p_color_ramp":f=function(a,b,c,d,e){a.uniform4fv(b,e.Or)};h=!0;break;case "u_p_wind":f=function(a,b,c,d,e){a.uniform3fv(b,e.zk)};h=!0;break;case "u_texel_size":f=function(a,b,c){a.uniform2fv(b,c.jo)};h=!0;break;case "u_p_time":f=
function(a,b,c,d,e){a.uniform1f(b,e.sc.R.time)};h=!0;break;case "u_position":f=function(a,b,c,d,e){a.uniform3fv(b,e.Mi)};h=!0;break;case "u_va_frame_factor":f=function(a,b,c,d){a.uniform1f(b,d.tt)};h=!0;break;case "u_normal_offset":f=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":f=function(a,b,c,d,e,g){a.uniform4fv(b,g.Ek)};break;case "u_v_light_matrix":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.st)};h=!0;break;case "u_b_light_matrix":f=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.lp)};break;case "u_p_light_matrix0":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.mg[0])};h=!0;break;case "u_p_light_matrix1":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.mg[1])};h=!0;break;case "u_p_light_matrix2":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.mg[2])};h=!0;break;case "u_p_light_matrix3":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.mg[3])};h=!0;break;case "u_motion_blur_exp":f=function(a,b,c){a.uniform1f(b,c.zr)};h=!0;break;case "u_refl_plane":f=function(a,b,c,d){a.uniform4fv(b,d.dc)};
break;case "u_radial_blur_step":f=function(a,b,c){a.uniform1f(b,c.Jk)};break;case "u_god_rays_intensity":f=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":f=function(a,b,c){a.uniform1f(b,c.Eh)};break;case "u_ssao_blur_discard_value":f=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":f=function(a,b,c){a.uniform1f(b,c.Dh)};break;case "u_ssao_dist_factor":f=function(a,b,c){a.uniform1f(b,c.Ch)};break;case "u_dof_dist":f=
function(a,b,c,d,e,g){a.uniform1f(b,g.dof_distance)};h=!0;break;case "u_dof_front":f=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_front)};h=!0;break;case "u_dof_rear":f=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_rear)};h=!0;break;case "u_outline_intensity":f=function(a,b,c,d){a.uniform1f(b,d.Vc)};h=!0;break;case "u_outline_color":f=function(a,b,c){a.uniform3fv(b,c.$e)};break;case "u_draw_outline":f=function(a,b,c){a.uniform1f(b,c.im)};h=!0;break;case "u_glow_mask_small_coeff":f=function(a,b,c){a.uniform1f(b,
c.small_glow_mask_coeff)};h=!0;break;case "u_glow_mask_large_coeff":f=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};h=!0;break;case "u_brightness":f=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":f=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":f=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":f=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:f=null}f&&(f={name:g,Bm:f,dg:b[g]},h?c.push(f):(d.push(f),e[g]=f))}a.gt=
c;a.Ji=d;a.En=e}var k=m("__config"),f=m("__debug"),n=m("__textures"),g=m("__util"),l=m("__camera");m("mat4");var y=k.o,p=[1,1,1,1],w=[1,1,1,1],z=[0,0,0,1],E=[0,0,0,0],B=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var v=null,t=new Uint8Array(4);a.Xc=function(a){var b=y.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);
a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);v=a};a.li=function(a){if(a.Ta){var b=a.h;v.bindFramebuffer(v.FRAMEBUFFER,b.ce);if(a.vl){var g=b.bb;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,g.Lb,g.Ra,0)}v.viewport(0,0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&d(a);a.Fa?v.enable(v.BLEND):v.disable(v.BLEND);a.Cb?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST);if(a.ja){for(var b=a.h,g=a.p,q=0;q<g.length;q++){var k=g[q],n=k.D,A=n.Xb;v.useProgram(A.Ni);
k=k.sd;A.Ji.length||h(A);for(var A=A.Ji,t=A.length;t--;){var p=A[t];p.Bm(v,p.dg,a,k,n,b)}}a.ja=!1}switch(a.type){case "SHADOW_CAST":v.enable(v.POLYGON_OFFSET_FILL);v.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);v.cullFace(v.BACK);break;case "MAIN_PLANE_REFLECT":v.disable(v.POLYGON_OFFSET_FILL);v.cullFace(v.FRONT);break;default:v.disable(v.POLYGON_OFFSET_FILL),v.cullFace(v.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.h,g=b.bb.Ra,q=0;6>q;q++){n=e(q);b.fa=a.gi[q];l.Il(b);
v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,n,g,0);d(a);n=a.p;for(k=0;k<n.length;k++)n[k].Ta=n[k].hm[q];c(a)}else c(a);f.Wv("draw subscene: "+a.type);v.bindFramebuffer(v.FRAMEBUFFER,null)}};a.clear=function(a){v.bindFramebuffer(v.FRAMEBUFFER,a.h.ce);d(a)};a.ep=function(a){var b=a.hp;b.length=0;var c=a.S;a=a.Xb;c&&a||g.pa("Incomplete batch");c=c.Ub;a=a.attributes;for(var d in a){var e=c[d];b.push({dg:a[d],zv:4*e.offset,Bx:1<e.frames?4*e.length:0,rd:e.rd})}};a.yv=h;a.fp=function(a){var b=
a.Xb,c=a.N;a=a.Kb;v.useProgram(b.Ni);for(var d=0;d<c.length;d++)v.uniform1i(b.Zi[a[d]],d)};a.os=function(a,b,c,d,e,f){d||(d=1);e||(e=1);f||(f=new Uint8Array(4*d*e));f.length!=4*d*e&&g.pa("read_pixels(): Wrong storage");v.bindFramebuffer(v.FRAMEBUFFER,a);v.readPixels(b,c,d,e,v.RGBA,v.UNSIGNED_BYTE,f);v.bindFramebuffer(v.FRAMEBUFFER,null);return f};a.tB=function(a){var b=a.Xb;v.useProgram(b.Ni);b.Ji.length||h(b);b=b.En.u_cube_fog;b.Bm(v,b.dg,null,null,a,null)};a.Rz=function(a,b){var c=v.createFramebuffer();
v.bindFramebuffer(v.FRAMEBUFFER,c);if(a){var d=a,e=d.Ra,d=d.Lb==v.TEXTURE_CUBE_MAP?v.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Lb;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,d,e,0)}n.fr(b)?v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,b.uf):n.Ai(b)&&(d=b,e=d.Ra,d=d.Lb,v.framebufferTexture2D(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,d,e,0));f.Rv();v.bindFramebuffer(v.FRAMEBUFFER,null);return c};a.Qz=function(a,b,c,d,e){null==a?(v.bindFramebuffer(v.FRAMEBUFFER,a),v.viewport(0,0,
d,e),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT)):(n.Ai(b)&&v.deleteTexture(b.Ra),n.fr(c)?v.deleteRenderbuffer(c.uf):n.Ai(c)&&v.deleteTexture(c.Ra),v.deleteFramebuffer(a))};a.SD=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,m){function c(a,b,c){var e=a.Le;"string"==typeof c&&(a=d(a,c))&&(c=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=c;return}e.push([b,c])}function d(a,b){for(var c=a.Le,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(x[c])return x[c];if(B){var d=B[b];if(!d)return null}else{d=z.ry(a+b);if(!d)return null;d=v.cs.parse(d)}return x[c]=d}function e(a,c,d){function e(c){c=c.a;for(var d=0;d<c.length;d++){var t=c[d];switch(t.type){case "condition":a:for(var t=
t.a,w=0;w<t.length;w++){var B=t[w];switch(B.type){case "if":case "elif":var H=B.c;try{var W=g(H)}catch(J){throw"Failed to process #"+B.type+" expression: "+H.join(" ");}if(W){e(B.group);break a}break;case "else":e(B.group);break a;case "ifdef":B.name in l&&e(B.group);break;case "ifndef":B.name in l||e(B.group)}}break;case "include":t=b(E.shaders_dir,E.BA+t.file);e(t);break;case "var":case "export":case "import":break;case "define":w=t.name;l[w]=t.b;t.M&&(x[w]=t.M);break;case "error":throw"Shader error: #error "+
t.b.join(" ");case "line":break;case "pragma":D.push("#pragma "+t.name+" "+t.b.join(" "));break;case "undef":t=t.name;delete l[t];delete x[t];break;case "warning":y.warn("Shader warning: #warning "+t.b.join(" "));break;case "extension":D.push("#extension "+h(t.b,l,x,!1));break;case "#":break;case "node":p[t.name]=t;break;case "nodes_global":t=k;for(w=0;w<t.length;w++)if(B=t[w],H=p[B.id])for(var Q=0,C=0;C<H.k.length;C++){var ja=H.k[C];"node_param"==ja.type&&(ja=ja.qualifier.join(" ")+" ","vert"==a?
ja+=B.ej[Q]:"frag"==a&&(ja+=B.M[Q],null!==B.Bk[Q]&&(ja+=" = "+B.Bk[Q])),ja+=";",D.push(ja),Q++)}break;case "nodes_main":t=k;for(w=0;w<t.length;w++)if(B=t[w],H=p[B.id]){Q={};C={};for(ja=0;ja<B.Me.length;ja++)C[B.Me[ja][0]]=[B.Me[ja][1]];u=I=z=0;for(var ja=B,ca=H.k,ka=Q,K=C,ga=0;ga<ca.length;ga++){var sa=ca[ga];switch(sa.type){case "node_in":var oa=ja.K[z];if(null!==ja.Um[z]){if(("MATERIAL"==ja.id&&3===z||"MATERIAL_EXT"==ja.id&&3===z||"TEXTURE_COLOR"==ja.id||"TEXTURE_NORMAL"==ja.id)&&sa.e){ka[sa.name]=
ja.Um[z];z++;continue}var m=sa.qualifier.join(" ")+" ",m=m+oa,m=m+(" = "+ja.Um[z]),m=m+";";D.push(m)}ka[sa.name]=oa;z++;break;case "node_out":oa=ja.Oa[I];if(!sa.e||-1<r.indexOf(oa))m=sa.qualifier.join(" ")+" ",m+=oa,m+=";",D.push(m),ka[sa.name]=oa;-1<r.indexOf(oa)&&(K["USE_OUT_"+sa.name]=[1]);I++;break;case "node_param":"vert"==a?oa=ja.ej[u]:"frag"==a&&(oa=ja.M[u]),ka[sa.name]=oa,u++}}D.push("{");f(B,H.f,Q,C);D.push("}")}break;case "lamp":v[t.name]=t;break;case "lamps_main":t=G;for(w=0;w<t.length;w++)if(B=
t[w],B.Ry){D.push("{");H=v[B.type].f;for(Q=0;Q<H.length;Q++){C=H[Q];ja=[];for(ca=0;ca<C.b.length;ca++){ka=C.b[ca];switch(ka){case "LAMP_IND":ka=B.index;break;case "LAMP_LIGHT_FACT_IND":ka=B.Xy;break;case "LAMP_FAC_CHANNELS":ka=B.Wy;break;case "LAMP_SPOT_SIZE":ka=n(B.Zc);break;case "LAMP_SPOT_BLEND":ka=n(B.wg||.01);break;case "LAMP_LIGHT_DIST":ka=n(B.distance);break;case "LAMP_SHADOW_MAP_IND":ka=B.Hx?1:0}ja.push(ka)}D.push(ja.join(" "))}D.push("}")}break;case "textline":D.push(h(t.b,l,x,!1));break;
default:throw"Unknown element type: "+t.type;}}}function g(a,b){var c=h(a,l,x,!0,b);return w.cs.parse(c)}function f(a,b,c,d){for(var e=0;e<b.length;e++){var k=b[e];switch(k.type){case "node_condition":a:for(var n=a,k=k.a,q=c,t=d,G=0;G<k.length;G++){var p=k[G];switch(p.type){case "node_if":case "node_elif":var ca=p.c;try{var A=g(ca,t)}catch(K){throw"Failed to process #"+p.type+" expression: "+ca.join(" ");}if(A){f(n,p.f,q,t);break a}break;case "node_else":f(n,p.f,q,t);break a;case "node_ifdef":(p.name in
l||p.name in t)&&f(n,p.f,q,t);break;case "node_ifndef":p.name in l||p.name in t||f(n,p.f,q,t)}}break;case "textline":n=[];for(q=0;q<k.b.length;q++)t=k.b[q],t in c?n.push(c[t]):n.push(t);D.push(h(n,l,x,!0,d))}}}var k=d.yn,G=d.fn;d=d.Le||[];for(var D=[],l={},t=0;t<d.length;t++)l[d[t][0]]=[d[t][1]];for(t=0;t<k.length;t++)l["USE_NODE_"+k[t].id]=[1];var x={},p={},v={},r=[];for(t in k)for(var B in k[t].K)r.push(k[t].K[B]);e(c);var z=0,I=0,u=0;return D.join("\n")}function h(a,b,c,d,e){var g=[];k(a,b,c,d,
g,e);return g.join(" ")}function k(a,b,c,d,e,g){for(var f=0;f<a.length;f++){var h=a[f];h in b||g&&h in g?(h=g&&g[h]||b[h],0==h.length&&d?e.push(0):k(h,b,c,d,e,g)):e.push(h)}}function f(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);p.Xv(d,b,c);return d}function n(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return g(a);case 2:return"vec2("+g(a[0])+","+g(a[1])+")";case 3:return"vec3("+g(a[0])+","+g(a[1])+","+g(a[2])+")";case 4:return"vec4("+g(a[0])+","+g(a[1])+","+g(a[2])+
","+g(a[3])+")";case 9:return"mat3("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+")";case 16:return"mat4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+","+g(a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(a[13])+","+g(a[14])+","+g(a[15])+")";default:throw"Wrong glsl value dimension";}}function g(a){return a%1?String(a):String(a)+".0"}var l=m("__config"),y=m("__print"),p=m("__debug"),
w=m("__gpp_eval"),z=m("__assets");m("__util");var E=l.Tb;if(b4w.module_check("shader_texts"))var B=m("shader_texts"),v=null;else B=null,v=m("__gpp_parser");var t={},x={},I=[],r=null;a.Xc=function(a){r=a};a.s=c;a.fy=d;a.$D=function(a,b){for(var c=a.Le,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.iA=function(a){a.Le=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<b.length;d++){var e=b[d],g;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":g=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":g=1;break;case "SHADOW_TEX_RES":g=n(2048);break;case "AA_METHOD":g="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":g="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":g="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":g="POST_EFFECT_NONE";break;case "SHADOW_SRC":g="SHADOW_SRC_NONE";break;case "SHADOW_DST":g=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":g="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":g="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":g="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":g=l.o.precision;break;case "EPSILON":g="highp"==l.o.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":g="u_va_frame_factor";break;default:y.error("Unknown directive ("+a.cj+", "+a.pi+"): "+e)}c(a,e,g)}};a.MD=function(a){return a.cj};a.Bq=function(a){return a.pi};a.TD=function(a,b){for(var e=
b.Le,g=0;g<e.length;g++){var f=e[g][0],h=e[g][1];d(a,f)&&c(a,f,h)}};a.by=function(a){var c=JSON.stringify(a),d=t[c];if(d)return d;var g=a.pi,d=b(E.shaders_dir,a.cj),g=b(E.shaders_dir,g);if(!d||!g)return null;var h=e("vert",d,a),k=e("frag",g,a),d=r,n=f(d,c,h,d.VERTEX_SHADER),l=f(d,c,k,d.FRAGMENT_SHADER),g=d.createProgram();d.attachShader(g,n);d.attachShader(g,l);d.linkProgram(g);d.validateProgram(g);d.getProgramParameter(g,d.VALIDATE_STATUS)==d.xC&&y.error("shader program is not valid",c);p.Yv(g,c,
n,l,h,k);a={Ao:n,qq:l,Ni:g,attributes:{},Zi:{},Ji:[],En:{},gt:[],gb:a};k=d.getProgramParameter(g,d.ACTIVE_ATTRIBUTES);for(h=0;h<k;h++)n=d.getActiveAttrib(g,h).name,a.attributes[n]=d.getAttribLocation(g,n);k=d.getProgramParameter(g,d.ACTIVE_UNIFORMS);for(h=0;h<k;h++)n=d.getActiveUniform(g,h).name.split("[0]").join(""),a.Zi[n]=d.getUniformLocation(g,n);return t[c]=d=a};a.Ww=function(){return I};a.yq=function(){return t};a.cleanup=function(){for(var a in t){var b=t[a];r.deleteProgram(b.Ni);r.deleteShader(b.Ao);
r.deleteShader(b.qq);delete t[a]}for(var c in x)delete x[c];for(var d in I)delete I[d]};a.iD=function(a){var b=a.Le;y.log("Shader: "+a.cj+" "+a.pi+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)y.log("  "+b[a][0],b[a][1])};a.u=n;a.Ep=function(a,b){return b in a.Zi?!0:!1};a.uy=function(a){return(r.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,m){function c(a){return 65536<a.I?C.Aq()?!1:!0:!1}function d(a){return 0<a.ca.length?!0:!1}function b(a,b,c){if(!d(a))return a;c||I.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.I*(b||1)+", will use drawArrays","color: #aa0");b=a.ca;c=a.I;var g=a.H,f=a.B,h;for(h in g){var k=g[h],n=w(k,c);g[h]=e(b,k,n)}for(g=0;g<f.length;g++){var q=f[g];for(h in q)k=q[h],n=w(k,c),q[h]=e(b,k,n)}for(g=0;g<a.V.length;g++){h=a.V[g].Pb;for(var t in h)k=h[t],n=
w(k,c),h[t]=e(b,k,n)}a.I=b.length;a.ca=new Uint16Array(0);return a}function e(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var g=a[e],f=0;f<c;f++)d[c*e+f]=b[c*g+f];return d}function h(a,b){var c=a.$c,d=a.Ub[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function k(b,c){var d,e;switch(c){case a.Uh:case a.lj:d=M.TRIANGLES;e=M.STATIC_DRAW;break;case a.Lo:d=M.POINTS;e=M.STATIC_DRAW;
break;case a.kj:d=M.TRIANGLES;e=M.DYNAMIC_DRAW;break;case a.Ko:d=M.POINTS;e=M.DYNAMIC_DRAW;break;case a.Et:d=M.LINES;e=M.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.bj=e}function f(a){a.Te?(a.fe||(a.fe=M.createBuffer()),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,a.fe),M.bufferData(M.ELEMENT_ARRAY_BUFFER,a.Te,a.bj),a.Oj=a.Te.byteLength):a.Oj=0;a.tf||(a.tf=M.createBuffer());M.bindBuffer(M.ARRAY_BUFFER,a.tf);M.bufferData(M.ARRAY_BUFFER,a.$c,a.bj);a.Wp=a.$c.byteLength}function n(a){for(var b=
q.kb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].ca.length;b.ca=new Uint32Array(c);var e=c=0,g=0;if(0<a[0].V.length)for(var f=0;f<a[0].V.length;f++){for(d=0;d<a.length;d++)c+=a[d].V[f].Pb.a_position.length,e+=a[d].V[f].Pb.a_normal.length,g+=a[d].V[f].Pb.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(g)};b.V.push({dk:a[0].V[f].dk,Pb:d})}for(d=c=0;d<a.length;d++)c+=a[d].I;b.I=c;var e=a[0],h;for(h in e.H){for(d=c=0;d<a.length;d++)c+=
a[d].H[h].length;b.H[h]=new Float32Array(c)}for(h in e.B[0]){for(d=c=0;d<a.length;d++)c+=a[d].B[0][h].length;for(d=0;d<e.B.length;d++)b.B[d]=b.B[d]||{},b.B[d][h]=new Float32Array(c)}for(h=e=c=0;h<a.length;h++){for(var g=a[h],k=g.ca,f=g.I,n=g.H,d=0;d<k.length;d++)b.ca[c+d]=k[d]+e;var c=c+k.length,t;for(t in n){var k=n[t],l=e*w(k,f);b.H[t].set(k,l)}for(d=0;d<g.B.length;d++){var n=g.B[d],p=b.B[d];for(t in n)k=n[t],l=e*w(k,f),p[t].set(k,l)}e+=f}if(0<b.V.length)for(h=0;h<b.V.length;h++)for(t=b.V[h].Pb,
d=g=e=c=0;d<a.length;d++)f=a[d].V[h].Pb,t.a_position.set(f.a_position,c),t.a_normal.set(f.a_normal,e),t.a_tangent.set(f.a_tangent,g),c+=f.a_position.length,e+=f.a_normal.length,g+=f.a_tangent.length;return b}function g(a,c,d,e,g,f){var h=q.kb("SUBMESH_"+a.name+"_"+c),k=a.submeshes[c],n=k.base_length,t=a.materials[c];h.I=n;var x=!1;if(y(d,"a_texcoord")){var A=null,r=a.materials[c];c=a.submeshes[c];if(r.texture_slots.length)switch(r=r.texture_slots[0],r.texture_coords){case "UV":r=a.uv_textures.indexOf(r.uv_layer);
-1==r||0==r?A=new Float32Array(c.texcoord):1==r&&(A=new Float32Array(c.texcoord2));break;case "ORCO":for(var w=a.b4w_bounding_box,A=new Float32Array(2*c.base_length),r=(w.max_x+w.min_x)/2,B=(w.max_z+w.min_z)/2,z=w.max_x-w.min_x,w=w.max_z-w.min_z,J=0,H=0;H<c.position.length;H+=3)A[J++]=(c.position[H]-r)/z+.5,A[J++]=(B-c.position[H+2])/w+.5}null===A&&(A=new Float32Array(c.texcoord));c=A}else c=new Float32Array(0);var W,A=k.group;if(y(d,"a_influence")&&e){r=new Float32Array(4*n);B=A.length/n;z=new Float32Array(B);
for(w=0;w<B;w++)for(W in z[w]=-1,e)if(J=e[W],J.wt===w){z[w]=J.ii;break}H=3<B?B:4;e=new Float32Array(H);W=new Uint32Array(H);for(var w=new Float32Array(4),J=new Float32Array(H),H=new Uint32Array(H),ba=new Float32Array(4),E=0;E<n;E++)e.set(J),W.set(H),w.set(ba),r.set(p(A,B,E,n,z,e,W,w),4*E)}else r=new Float32Array(0);W=r;e=g?q.Aa(g):{};e.a_color={Tf:!0};e.a_color.src=y(d,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Jc:7}]:[];g={a_texcoord:c,a_influence:W};W=k.vertex_colors;c=k.color;A=a.name;
r=[];for(B=0;B<W.length;B++)r.push(W[B].name);for(var N in e)if(B=e[N].src,B.length){for(w=z=0;w<B.length;w++)z+=q.tg(B[w].Jc);g[N]=new Float32Array(z*n);for(w=J=0;w<B.length;w++){var m=B[w].name,H=B[w].Jc,ba=q.us(H),ca=r.indexOf(m);-1==ca&&q.pa('vertex color "'+m+'" for mesh "'+A+'" not found.');var E=W[ca].mask,ka=q.tg(E);(H&E)!==H&&I.error("Wrong color extraction from "+m+" to "+N+".");for(var K=m=0;K<ca;K++)m+=q.tg(W[K].mask);ca=m*n;for(m=0;m<n;m++)for(K=0;3>K;K++)ba[K]&&(g[N][m*z+(J+q.Ui(H,K))]=
c[ca+m*ka+q.Ui(E,K)]);J+=ka}}else g[N]=new Float32Array(0);N=a.uv_textures;e=k.texcoord;W=k.texcoord2;c=a.name;if(f)for(var ga in f){A=N.indexOf(ga);-1==A&&q.pa('uv map "'+ga+'" for mesh "'+c+'" not found');if(0==A)var sa=new Float32Array(e);else 1==A&&(sa=new Float32Array(W));g[f[ga]]=sa}h.H=g;h.ca=new Uint32Array(k.indices);f=k.position.length/n/3;sa=(ga=y(d,"a_normal")&&k.normal.length?!0:!1)&&y(d,"a_tangent")&&k.tangent.length?!0:!1;N=ga&&t.texture_slots.length&&y(d,"a_tangent")&&"ORCO"==t.texture_slots[0].texture_coords?
!0:!1;0<a.b4w_shape_keys.length&&(x=!0);for(g=0;g<f;g++){t=l(k,d,n,ga,sa,N,g);if(x)if(e={},e.name=a.b4w_shape_keys[g].name,h.V.push(e),0!=g){e.Pb=t;e.dk=a.b4w_shape_keys[g].value;continue}else e.Pb=l(k,d,n,ga,sa,N,g),e.dk=1;h.B.push(t)}if(1<f&&!x){a=h.B[0];var t={},oa;for(oa in a)t[oa]=new Float32Array(a[oa]);h.B.push(t)}y(d,"a_polyindex")&&(b(h,1,!0),h.H.a_polyindex=v(h));return h}function l(a,b,c,d,e,g,f){var h={},k=new Float32Array(3*c),n=new Float32Array(d?3*c:0),t=new Float32Array(e||g?4*c:0),
l=f*c*3;k.set(a.position.subarray(l,l+3*c),0);d&&(l=f*c*3,n.set(a.normal.subarray(l,l+3*c),0));if(e)l=f*c*4,t.set(a.tangent.subarray(l,l+4*c),0);else if(g)for(a=t,I.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+mesh.name+'". Please add a UV-map.'),b=0;b<c;b++)d=A,e=N,d[0]=n[3*b],d[1]=n[3*b+1],d[2]=n[3*b+2],J.cross(d,q.AXIS_Z,e),0==J.length(e)&&J.cross(d,q.AXIS_X,e),J.normalize(e,e),a[4*b]=e[0],a[4*b+1]=e[1],a[4*b+2]=e[2],a[4*b+3]=1;else if(d&&
y(b,"a_tangent"))for(t=new Float32Array(4*c),c=0;c<t.length;c++)t[c]=1;h.a_position=k;h.a_normal=n;h.a_tangent=t;return h}function y(a,b){return-1<a.indexOf(b)?!0:!1}function p(b,c,d,e,g,f,h,k){for(var n=!0,t=0;t<c;t++){var q=b[t*e+d];if(-1!==q){var l=g[t];-1!==l&&(f[t]=q,h[t]=l,n=!1)}}if(n)return k;z(f,h,a.hl,!1);for(t=b=0;4>t;t++)b+=f[t];if(.01>b)return k;for(t=0;4>t;t++)f[t]/=b;if(.01>Math.abs(f[0]-1))k[0]=h[0]+1;else for(t=0;4>t;t++)k[t]=h[t]+f[t];return k}function w(a,b){if(0==b)return 0;var c=
a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function z(b,c,d,e){for(var g=b.length,f=g,h=!1,k=e?-1:1;1<f||h;){1<f&&(f=Math.floor(f/1.247330950103979));for(var h=!1,n=0;f+n<g;n++)if(d==a.hl?0>k*(b[n]-b[n+f]):b[n]<b[n+f]&&e)h=b[n],b[n]=b[n+f],b[n+f]=h,h=c[n],c[n]=c[n+f],c[n+f]=h,h=!0}}function E(a,b,c){var d=[],e=[];J.subtract(b,a,d);J.subtract(c,a,e);J.normalize(d,d);J.normalize(e,e);return Math.acos(J.dot(d,
e))}function B(a,b,c){b||(b=[]);c=c?a.B[0].a_normal:a.B[0].a_position;if(d(a)){a=a.ca;for(var e=a.length/3,g=0;g<e;g++){var f=new Float32Array(9),h=a[3*g];f[0]=c[3*h];f[1]=c[3*h+1];f[2]=c[3*h+2];h=a[3*g+1];f[3]=c[3*h];f[4]=c[3*h+1];f[5]=c[3*h+2];h=a[3*g+2];f[6]=c[3*h];f[7]=c[3*h+1];f[8]=c[3*h+2];b[g]=f}}else for(g=0;g<c.length;g++)f=new Float32Array(9),f[0]=c[9*g],f[1]=c[9*g+1],f[2]=c[9*g+2],f[3]=c[9*g+3],f[4]=c[9*g+4],f[5]=c[9*g+5],f[6]=c[9*g+6],f[7]=c[9*g+7],f[8]=c[9*g+8],b[g]=f;return b}function v(a){for(var b=
new Float32Array(a.I),c=0;c<a.I;c++)b[c]=c%3;return b}function t(a,b,c){var d=J.dist(a,b);a=J.dist(a,c);b=J.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function x(a,b,c,d,e){c-=b;for(var g=0;g<c;g+=d)g%d==e&&vec3.normalize(a.subarray(g+b-e,g+b+1),a.subarray(g+b-e,g+b+1))}var I=m("__print"),r=m("__tsr"),q=m("__util"),C=m("__extensions"),J=m("vec3"),A=new Float32Array(3),N=new Float32Array(3),L=new Float32Array(3);a.Ld=10;a.Ro=20;a.DC=30;a.lj=10;a.Lo=20;a.kj=30;a.Ko=40;a.Et=50;a.hl=0;a.Iu=1;a.Uh=
a.lj;var M=null;a.Xc=function(a){M=a};a.jD=function(a){var b=_buffers[a];M.deleteBuffer(b.fe);M.deleteBuffer(b.tf);delete _buffers[a]};a.aB=function(e,g,h,n){c(e)&&b(e);var t=e.ca,q=e.I,l=e.B,x={},p;for(p in e.H)p in n&&!n[p].Tf||(x[p]=e.H[p]);n={Te:null,$c:null,Rm:0,count:0,Ub:{},mode:0,bj:0,Oj:0,Wp:0,tf:null,fe:null,bk:null,V:null};if(0<e.V.length){p=l[0];for(var v=1;v<e.V.length;v++){for(var A=e.V[v].Pb,r=A.a_position,y=A.a_normal,B=p.a_position,z=p.a_normal,J=r.length,E=e.V[v].dk,H=0;H<J;H++)B[H]+=
E*r[H],z[H]+=E*y[H];A=A.a_tangent;r=p.a_tangent;y=A.length;for(H=0;H<y;H++)r[H]+=E*A[H]}}if(t.length)if(p=t.length,65536>=q)var v=new Uint16Array(t),W=M.UNSIGNED_SHORT;else v=new Uint32Array(t),W=M.UNSIGNED_INT;else p=q,v=null;var E=0,H=l.length,ba;for(ba in l[0])A=l[0][ba],E+=A.length*H;for(ba in x)A=x[ba],E+=A.length;ba=new Float32Array(E);var E=0,H={},N;for(N in x)if(r=x[N],A=r.length)ba.set(r,E),H[N]={PC:N,rd:w(r,q),offset:E,frames:1,length:A},E+=A;x=l.length;for(N in l[0])if(r=l[0][N],A=r.length,
r=w(r,q),A)for(H[N]={rd:r,offset:E,frames:x,length:A},1<x&&(H[N+"_next"]={rd:r,offset:E+A,frames:x,length:A}),y=0;y<x;y++)r=l[y][N],ba.set(r,E),E+=A;n.count=p;n.Te=v;n.$c=ba;n.Rm=W;n.Ub=H;k(n,h);f(n);g!=a.Ld&&d(e)&&(n.bk={iz:new Float32Array(t.length),jz:new Float32Array(t.length),hx:new Float32Array(t.length/3),type:g});n.V=e.V;return n};a.Py=c;a.Oy=d;a.co=b;a.vB=function(a,b,c){k(a,b);a.count=c.length;a.Te=c;a.Rm=c instanceof Uint16Array?M.UNSIGNED_SHORT:M.UNSIGNED_INT};a.Yk=function(a,b,c,d){var e=
a.$c,g=a.Ub,h=g[b];h?(c&&h.rd!=c&&q.pa('invalid num_comp for "'+b+'"'),e.set(d,h.offset)):(e=e.length,h=new Float32Array(e+d.length),h.set(a.$c),h.set(d,e),a.$c=h,g[b]={rd:c,offset:e});f(a)};a.rx=h;a.mE=function(a){a.bj=M.STATIC_DRAW};a.bz=function(a){a.bj=M.DYNAMIC_DRAW};a.mt=f;a.Gp=function(a){a.fe&&M.deleteBuffer(a.fe);a.tf&&M.deleteBuffer(a.tf)};a.Uq=function(a,b){return a.submeshes[b].base_length?!1:!0};a.$s=function(a,b){for(var c=0;c<a.B.length;c++){var d=a.B[c].a_position;r.transform_vectors(d,
b,d,0);d=a.B[c].a_normal;0<d.length&&r.transform_dir_vectors(d,b,d,0);d=a.B[c].a_tangent;0<d.length&&r.transform_tangents(d,b,d,0)}(c=a.H.au_center_pos)&&c.length&&r.transform_vectors(c,b,c,0);return a};a.ZA=function(a,b){var c=a.H.au_center_pos;if(c&&c.length){var d=new Float32Array(c);r.transform_vectors(d,b,d,0);for(var e=0;e<a.B.length;e++)for(var g=0;g<d.length;g++)a.B[e].a_position[g]+=d[g]-c[g];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.YA=function(a,
b){var c=a.I,d;for(d in b){var e=b[d].length;a.H[d]=new Float32Array(e*c);for(var g=0;g<c;g++)for(var f=0;f<e;f++)a.H[d][g*e+f]=b[d][f]}};a.$A=n;a.az=function(a,c,d){if(!a.I)return q.kb("EMPTY");var e=d.length;65536<a.I*e&&!C.Aq()&&b(a,e);var g=a.ca,f=a.I,h=a.H;a=a.B;for(var k in c){var n=c[k].length,t=n*f;h[k]=new Float32Array(t);for(var l=0;l<f;l++)for(t=0;t<n;t++)h[k][l*n+t]=c[k][t]}c=q.kb("CLONE_"+e+"_SUBMESHES");c.I=f*e;c.ca=new Uint32Array(g.length*e);for(l=0;l<e;l++)for(n=g.length*l,k=f*l,
t=0;t<g.length;t++)c.ca[n+t]=g[t]+k;for(var p in h)for(g=h[p],t=g.length*e,n=w(g,f),c.H[p]=new Float32Array(t),l=0;l<e;l++)k=f*n*l,c.H[p].set(g,k);for(p in a[0])for(l=0;l<a.length;l++)for(g=a[l][p],t=g.length*e,n=w(g,f),c.B[l]=c.B[l]||{},c.B[l][p]=new Float32Array(t),t=0;t<e;t++)switch(h=d[t],k=f*n*t,p){case "a_position":r.transform_vectors(g,h,c.B[l][p],k);break;case "a_normal":r.transform_dir_vectors(g,h,c.B[l][p],k);break;case "a_tangent":r.transform_tangents(g,h,c.B[l][p],k);break;default:throw"Wrong attribute name: "+
p;}return c};a.hq=g;a.ux=function(a){var b=a.I,c=a.B[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.ca.length);for(var g=0;g<b;g++)d[12*g]=c[3*g],d[12*g+1]=c[3*g+1],d[12*g+2]=c[3*g+2],d[12*g+3]=c[3*g],d[12*g+4]=c[3*g+1],d[12*g+5]=c[3*g+2],d[12*g+6]=c[3*g],d[12*g+7]=c[3*g+1],d[12*g+8]=c[3*g+2],d[12*g+9]=c[3*g],d[12*g+10]=c[3*g+1],d[12*g+11]=c[3*g+2],e[8*g]=-.5,e[8*g+1]=-.5,e[8*g+2]=-.5,e[8*g+3]=.5,e[8*g+4]=.5,e[8*g+5]=.5,e[8*g+6]=.5,e[8*g+7]=-.5,a[6*g]=4*g+2,a[6*
g+1]=4*g+1,a[6*g+2]=4*g,a[6*g+3]=4*g+2,a[6*g+4]=4*g,a[6*g+5]=4*g+3;c=q.kb("HALO");c.B=[];c.B[0]={};c.I=4*b;c.B[0].a_position=d;c.H.a_halo_bb_vertex=e;c.ca=a;return c};a.zy=y;a.vx=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=g(a,d,b,null,null,null);e.I&&c.push(e)}return 0==c.length?q.kb("EMPTY"):1==c.length?c[0]:n(c)};a.uB=function(a,b,c){for(var d=a.Te,e=h(a,"a_position"),g=a.bk,f=g.iz,k=g.jz,g=g.hx,n=d,t=n.length/3,l=0;l<t;l++){var p=n[3*l],x=n[3*l+1],
A=n[3*l+2],r=e[3*p+1],v=e[3*p+2],y=e[3*x+1],H=e[3*x+2],w=e[3*A+1],B=e[3*A+2];f[3*l]=(e[3*p]+e[3*x]+e[3*A])/3;f[3*l+1]=(r+y+w)/3;f[3*l+2]=(v+H+B)/3}q.af(f,b,k);b=k.length/3;for(e=0;e<b;e++)f=k[3*e]-c[0],n=k[3*e+1]-c[1],t=k[3*e+2]-c[2],g[e]=f*f+n*n+t*t;c=d;d=g.length;if(!(2>d))for(k=d,e=!1;1<k||e;)for(1<k&&(k=Math.floor(k/1.247330950103979)),e=!1,b=0;k+b<d;b++)0>g[b]-g[b+k]&&(e=g[b],g[b]=g[b+k],g[b+k]=e,e=c,f=b,n=b+k,t=e[3*f],l=e[3*f+1],p=e[3*f+2],e[3*f]=e[3*n],e[3*f+1]=e[3*n+1],e[3*f+2]=e[3*n+2],e[3*
n]=t,e[3*n+1]=l,e[3*n+2]=p,e=!0);d=c;M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,a.fe);M.bufferData(M.ELEMENT_ARRAY_BUFFER,d,M.DYNAMIC_DRAW)};a.Ns=z;a.up=function(a,b,c){for(var d=b.length/3,e=a.length/3,g=[],f=Array(3),h=Array(3),k=Array(3),n=0;n<e;n++){for(var t=a[3*n],l=a[3*n+1],q=a[3*n+2],p=0;3>p;p++)f[p]=b[3*t+p],h[p]=b[3*l+p],k[p]=b[3*q+p];if(c)var p=E(f,h,k),x=E(h,k,f),A=Math.PI-p-x;else A=x=p=1;var r=g,H;H=f;var v=k,y=[],w=[],B=[];J.subtract(h,H,y);J.subtract(v,H,w);J.cross(y,w,B);J.normalize(B,B);
H=B;for(v=0;3>v;v++)y=3*l+v,w=3*q+v,r[3*t+v]=p*H[v],r[y]=x*H[v],r[w]=A*H[v]}if(c)for(var z in c)for(n=c[z],a=0;3>a;a++){b=3*n[0]+a;for(e=1;e<n.length;e++)f=3*n[e]+a,g[b]+=g[f];for(e=1;e<n.length;e++)f=3*n[e]+a,g[f]=g[b]}for(n=0;n<d;n++){c=n;z=g;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=z[e];J.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,z[e]=a[b]}return g};a.wp=function(a,b,c){for(var d={},e=b.length/3,g=0;g<e;g++){var f=String(b[3*g])+String(b[3*g+1])+String(b[3*g+2]);d[f]=[]}e=a.length;for(g=
0;g<e;g++)b=a[g],f=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),f in d&&d[f].push(b);return d};a.Dm=function(a,b,c,d){var e=B(a,null,!1);if(c)var g=B(a,null,!0);var f=e.length,h=new Float32Array(f),k=A,n=N;for(a=0;a<f;a++){var l=e[a];k.set(l.subarray(0,3));n.set(l.subarray(3,6));L.set(l.subarray(6));h[a]=Math.sqrt(t(k,n,L))}k=new Float32Array(f);k[0]=h[0];for(a=1;a<f;a++)k[a]=k[a-1]+h[a];f=k[h.length-1];h=[];for(a=0;a<b;a++){var n=f*q.Nc(d),n=q.yj(k,n,0,k.length-1),l=c?g[n]:e[n],n=a,p=l,x=d,l=
void 0,l=new Float32Array(3),r=p[0],v=p[1],y=p[2],w=p[3],H=p[4],W=p[5],z=p[6],E=p[7],J=p[8],p=q.Nc(x),x=q.Nc(x);1<p+x&&(p=1-p,x=1-x);var m=1-p-x,v=m*v+p*H+x*E,y=m*y+p*W+x*J;l[0]=m*r+p*w+x*z;l[1]=v;l[2]=y;h[n]=l}return h};a.pD=B;a.gq=v;a.JE=t;a.ly=function(a,b,c,d){var e=b[0]-a[0],g=c[0]-a[0],f=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=f*a-b*h;d[1]=g*b-e*a;d[2]=e*h-f*g;return d};a.aA=function(a,b,c){a=a.B[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-
c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.qv=function(a,b,c){var d=a.n;a=a.d.hf;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=c);for(e=0;e<d.length;e++)if(!d[e].Qf&&d[e].Ed&&!d[e].Rg){var g=d[e].S.Ub;b=d[e].S.$c;M.bindBuffer(M.ARRAY_BUFFER,d[e].S.tf);if(g.a_position){var f=g.a_position.offset,h=g.a_position.length+f,k=d[e].S.V[0].Pb.a_position;for(c=f;c<h;c++)b[c]=k[c-f];for(k=1;k<d[e].S.V.length;k++){var n=d[e].S.V[k].Pb.a_position,t=a[k].value;if(t)for(c=f;c<h;c++)b[c]+=t*n[c-f]}M.bufferSubData(M.ARRAY_BUFFER,
4*f,b.subarray(f))}if(g.a_normal){f=g.a_normal.offset;h=g.a_normal.length+f;k=d[e].S.V[0].Pb.a_normal;for(c=f;c<h;c++)b[c]=k[c-f];for(k=1;k<d[e].S.V.length;k++)if(n=d[e].S.V[k].Pb.a_normal,t=a[k].value)for(c=f;c<h;c++)b[c]+=t*n[c-f];x(b,f,h,3,2);M.bufferSubData(M.ARRAY_BUFFER,4*f,b.subarray(f))}if(g.a_tangent){f=g.a_tangent.offset;g=g.a_tangent.length+f;k=d[e].S.V[0].Pb.a_tangent;for(c=f;c<g;c++)b[c]=k[c-f];for(k=1;k<d[e].S.V.length;k++)if(h=d[e].S.V[k].Pb.a_tangent,t=a[k].value)for(c=f;c<g;c++)b[c]+=
t*h[c-f];x(b,f,g,4,3);M.bufferSubData(M.ARRAY_BUFFER,4*f,b.subarray(f))}}};a.check_shape_keys=function(a){return a.d.Ed};a.get_shape_keys_names=function(a){var b=[];if(a.d)for(var c=1;c<a.d.hf.length;c++)b.push(a.d.hf[c].name);return b};a.get_shape_key_value=function(a,b){if(a.d)for(var c=1;c<a.d.hf.length;c++)if(b==a.d.hf[c].name)return a.d.hf[c].value;return 0};a.Wq=function(a,b){var c=a.d.hf;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.vi=function(a){return a&&a.d&&a.d.kd?
!0:!1}};b4w.module.__objects=function(a,m){function c(a){a={type:a,oc:0,yy:[0,0],g:new Float32Array(3),quat:new Float32Array(4),yb:new Float32Array(8),U:new Float32Array(16),br:new Float32Array(16),Gb:new Float32Array(3),Rb:new Float32Array(3),gh:0,hh:0,Wm:!1,Jj:null,Vc:0,ho:!1,qt:!1,sa:p.MS_STATIC,xo:1,wo:1,yo:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Zd:null,it:!1,Yd:0,Nf:0,Qa:!1,Qb:null,ad:null,ub:null,jm:!0,G:null,Fi:null,mc:null,tc:null,dc:null,ri:0,mi:0,xm:0,Di:0,eg:0,ds:"",$k:!1,yc:!1,Jb:!1,
fc:!1,Vb:!1,Hb:!1,wc:!1,me:!1,If:!1,cd:!1,Pj:!1,kd:!1,lb:!1,Tg:!1,fh:!1,kk:!1,ug:!1,vk:!1,Db:!1,uk:!1,Jr:!1,hk:!1,is_visible:!1,zm:!1,gj:0,dd:0,ve:0,Wd:0,Vd:0,Rd:0,he:"",Fb:null,xj:!1,Fe:!1,ai:"",Cl:!1,Rf:0,time:0,vo:0,tt:0,je:0,qi:!1,cl:!1,Ed:!1,hf:[],ih:!1,Ee:!1,De:1,ql:0,pl:1,Wk:new Int8Array([-1,-1]),Rk:[],yr:[],Fs:[],vc:null,uc:null,Dc:null,Cc:null,Hc:null,es:null,tl:null,sl:null,ie:null,gg:null,mk:null,rc:null,fg:null,nk:null,Nb:null,zl:null,xl:null,yl:null,$a:null,Rc:null,sb:null,Gf:null,Hf:null,
scale:1,We:1E4};A.identity(a.quat);C.identity(a.yb);L.identity(a.U);L.identity(a.br);return a}function d(a){var b=a.parent;if(b&&b.Ig)return!0;switch(a.type){case "MESH":var c=g.ek(a),d=a.b4w_do_not_batch,e=a.b4w_collision,f=a.b4w_vehicle,h=a.b4w_floating,b=a.b4w_character,k=a.b4w_billboard,n=x.By(a),l=t.Vq(a),q=0<a.data.b4w_shape_keys.length,p=a.b4w_dynamic_geometry;if(!(c=c||d||e||f||q||h))a:{a=a.data;for(c=0;c<a.materials.length;c++)if("LENS_FLARES"===a.materials[c].name){c=!0;break a}c=!1}return c||
n||b||k||l||p;case "EMPTY":return b=g.ek(a),k=t.Vq(a),a=a.b4w_do_not_batch,b||k||a;default:return!0}}function b(a,c,d,g,f,h,k,n,t){for(var l=0;l<a.nodes.length;l++){var q=a.nodes[l];if("VALUE"==q.type){var p=c+q.name;g.push(q.outputs[0].default_value);f.push(p,f.length/2)}else"RGB"==q.type?(p=c+q.name,q=q.outputs[0].default_value.slice(0,3),k.push(q[0],q[1],q[2]),n.push(p,n.length/2)):"GROUP"==q.type&&(p=q.node_group.node_tree,b(p,c+q.name+"%join%",p.animation_data,g,f,h,k,n,t))}if(d)for((a=d.action)&&
e(a,c,h,f,t,n),d=d.nla_tracks,g=0;g<d.length;g++)for(k=d[g].strips,l=0;l<d[g].strips.length;l++)a=k[l].action,e(a,c,h,f,t,n)}function e(a,b,c,d,e,g){var f=a.d.M,k;for(k in f){var n=b+k.match(/"(.*?)"/)[1],f=h(d,n);null!=f?(n=a.name+"%join%"+k,c.push(n,f)):(f=h(g,n),null!=f&&(n=a.name+"%join%"+k,e.push(n,f)))}}function h(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function k(a,b,c){return{name:a,type:b,modifiers:[],particle_systems:[],constraints:[],data:null,parent:null,
b4w_vehicle_settings:null,b4w_floating_settings:null,b4w_character_settings:null,b4w_vehicle:!1,b4w_character:!1,b4w_floating:!1,n:[],So:c,Fc:[],Be:[],Md:[],Qc:null,Sa:null,Gc:null,j:null,C:[],m:null,i:null,ma:null}}function f(a){return a instanceof Array?a.slice():a}function n(a){if("object"!=typeof a||null===a)return a;var b=a instanceof Array?[]:{},c=null,d=null,e=null;a.N&&(c=a.N,a.N=null);a.Kb&&(d=a.Kb,a.Kb=null);a.V&&(e=a.V,a.V=null);for(var g in a)b[g]=a[g]&&"object"==typeof a[g]?a[g]instanceof
Float32Array?new Float32Array(a[g]):a[g]instanceof Uint32Array?new Uint32Array(a[g]):a[g]instanceof Uint16Array?new Uint16Array(a[g]):a[g]instanceof WebGLUniformLocation?a[g]:a[g]instanceof WebGLProgram?a[g]:a[g]instanceof WebGLShader?a[g]:a[g]instanceof WebGLBuffer?null:n(a[g]):a[g];c&&(b.N=c,a.N=c);d&&(b.Kb=d,a.Kb=d);e&&(b.V=e,a.V=e);return b}var g=m("__animation"),l=m("__batch"),y=m("__boundings"),p=m("__camera"),w=m("__config"),z=m("__constraints"),E=m("__curve"),B=m("__geometry"),v=m("__lights"),
t=m("__nla"),x=m("__particles"),I=m("__print"),r=m("__scenes"),q=m("__transform"),C=m("__tsr"),J=m("__util"),A=m("quat"),N=m("vec3"),L=m("mat4"),M=w.Db,G=0,D=0,O=[],Q=new Float32Array(4);a.Lj=c;a.Zk=function(a,e){var f=d(a);a.Ig=f;a.d=c("MESH"===a.type?f?"DYNAMIC":"STATIC":a.type);a.So=!1;a.Sa=null;a.Fc=[];a.C=[];a.m=null;a.i=null;a.ma=null;a.za||(a.za=null);var f=a.d,h=a.location,k=a.scale[0];J.In(a.rotation_quaternion,Q);q.set_translation(a,h);q.set_rotation(a,Q);q.set_scale(a,k);switch(a.type){case "ARMATURE":h=
a.pose.bones;for(k=0;k<h.length;k++){var n=h[k],t=n.bone,x=new Float32Array(t.matrix_local),w=new Float32Array(16);L.invert(x,w);var B=new Float32Array(n.matrix_basis),m=new Float32Array(3);N.subtract(t.tail_local,t.head_local,m);J.$B(m,w,m);n.Vu=m;n.Pu=[n].concat(n.parent_recursive);n.Uo=C.from_mat4(x,C.create());n.To=C.from_mat4(B,C.create());n.ll=C.create();n.qj=!1}h=g.Kv(a);f.Hc=h;h=g.vp(a,h);a.b4w_animation_mixing?(f.vc=new Float32Array(h.ya),f.uc=new Float32Array(h.ya),f.Dc=new Float32Array(h.g),
f.Cc=new Float32Array(h.g)):(f.vc=h.ya,f.uc=h.ya,f.Dc=h.g,f.Cc=h.g);f.es=h;f.Rf=0;f.Ee=a.b4w_animation_mixing;break;case "MESH":f.ug=M.outlining_overview_mode||a.b4w_selectable;f.vk=a.b4w_selectable;f.Db=M.outlining_overview_mode||a.b4w_outlining;f.uk=a.b4w_outlining;f.Jr=M.outlining_overview_mode||a.b4w_outline_on_select;f.Fe=a.b4w_billboard;f.Ev=a.b4w_pres_glob_orientation;f.ai="BASIC";f.Cl="SPHERICAL"==a.b4w_billboard_geometry;f.Fi={wk:a.b4w_outline_settings.outline_duration,xk:a.b4w_outline_settings.outline_period,
yk:a.b4w_outline_settings.outline_relapses};f.ug&&(a.d.Jj=J.rq(G),G++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.cl=a.data.b4w_vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;k=a.d;if(a.data.b4w_shape_keys.length)for(k.Ed=!0,h=0;h<a.data.b4w_shape_keys.length;h++)n={},n.value=a.data.b4w_shape_keys[h].value,n.name=a.data.b4w_shape_keys[h].name,k.hf.push(n);else k.Ed=!1;if(k=g.get_first_armature_object(a)){h=a.d;t=a.data.vertex_groups;if(t.length){x=k.data.bones;
w=k.pose.bones;B=0;n={};for(m=0;m<x.length;m++){var Y=x[m].name,na=J.keysearch("name",Y,t);if(na){var H=J.Hm(w,"name",Y);n[Y]={sp:m,ii:B++,Fn:H,wt:na.index}}}t=B;h.Hc=n;n=g.Dq();h.je=t;t>2*n?(h.ih=!1,I.error('too many bones for "'+a.name+'" / '+h.je+" bones (max "+n+" with blending, "+2*n+" without blending). Skinning will be disabled.")):h.ih=!0}h=a.d.Hc;h=g.vp(k,h);k.b4w_animation_mixing?(f.vc=new Float32Array(h.ya),f.uc=new Float32Array(h.ya),f.Dc=new Float32Array(h.g),f.Cc=new Float32Array(h.g)):
(f.vc=h.ya,f.uc=h.ya,f.Dc=h.g,f.Cc=h.g);f.tl=new Float32Array(4);f.sl=A.create();f.es=h;f.Rf=0}k=a.d;h=a.data.materials;n=[];t=[];x=[];w=[];B=[];m=[];for(Y=0;Y<h.length;Y++)na=h[Y],(H=na.node_tree)&&b(H,na.name+"%join%",H.animation_data,n,t,x,w,B,m);k.ie=n;k.gg=t;k.mk=x;k.rc=w;k.fg=B;k.nk=m;a.n=[];f.yc=a.b4w_shadow_cast;f.Jb=a.b4w_shadow_receive;f.fc=a.b4w_shadow_cast_only&&f.yc;f.Vb=a.b4w_reflexible;f.Hb=a.b4w_reflexible_only&&f.Vb;f.wc=a.b4w_reflective;f.me=a.b4w_reflection_type;a.kl=null;if(a.b4w_reflective)if(k=
a.d,"CUBE"==a.b4w_reflection_type)k.mc=D++;else{a:{h=a.constraints;for(n=0;n<h.length;n++)if(t=h[n],"LOCKED_TRACK"==t.type&&"REFLECTION PLANE"==t.name){h=t.target;break a}h=null}if(h){n=null;for(t=0;t<O.length;t++)if(O[t]==h){n=t;break}null==n?(O.push(h),k.tc=O.length-1):k.tc=n;a.kl=h}}f.If=a.b4w_caustics;f.cd=a.b4w_wind_bending;f.gj=a.b4w_wind_bending_angle;k=l.fC(a.b4w_wind_bending_angle,l.Av(a.data.b4w_bounding_box),a.scale[0]);f.dd=k;f.ve=a.b4w_wind_bending_freq;f.Wd=a.b4w_detail_bending_freq;
f.Vd=a.b4w_detail_bending_amp;f.Rd=a.b4w_branch_bending_amp;f.fh=!1;f.he=a.b4w_main_bend_stiffness_col;k=a.b4w_detail_bend_colors;f.Fb={};f.Fb.qr=k.leaves_stiffness_col;f.Fb.pr=k.leaves_phase_col;f.Fb.Lr=k.overall_stiffness_col;f.Tg=a.b4w_do_not_cull;f.Pj=a.b4w_disable_fogging;f.kd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";k=a.data.materials[0];f.ri=k.physics.friction;f.mi=k.physics.elasticity;f.Di=0;f.We=1E4;f.eg=a.b4w_lod_transition;f.kk=!0;break;case "CAMERA":p.Nv(a);p.vv(a);
break;case "LAMP":v.Vy(a);break;case "CURVE":if(k=E.Mw(a))a.Uu=k;break;case "EMPTY":f.Nb=y.Gd(),k=y.hj(),f.Rc=k}if(!e&&(a.parent&&"OBJECT"==a.parent_type?(h=f.g,n=f.quat,k=f.scale,z.cp(a,a.parent,h,n,k)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(h=f.g,n=f.quat,k=f.scale,z.bp(a,a.parent,a.parent_bone,h,n,k)):a.za&&a.za.b4w_group_relative?(k=C.create_sep(f.g,f.scale,f.quat),z.Zu(a,a.za,k)):a.za&&!a.za.b4w_group_relative&&(q.w(a),C.multiply(a.za.d.yb,a.d.yb,a.d.yb),q.set_translation(a,
C.get_trans_view(a.d.yb)),q.set_scale(a,C.get_scale(a.d.yb)),q.set_rotation(a,C.get_quat_view(a.d.yb))),k=a.dupli_group))for(h=k.objects,k=0;k<h.length;k++)h[k].za=a;a.field&&(f.xm=a.field.strength,r.lt(a));f.$k=a.game.use_collision_compound;f.ds=a.game.physics_type;q.w(a)};a.DB=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||q.w(c);c.b4w_use_default_animation&&g.ek(c)&&(g.apply_def(c),c.C.length&&g.play(c,null,g.SLOT_ALL))}};a.ac=function(a){return a.Ig?
!0:!1};a.xi=function(a){return"MESH"==a.type&&a.Ig?!0:!1};a.get_meta_tags=function(a){a=a.b4w_object_tags;return{title:a?a.title:"",description:a?a.description:"",category:a?a.category:""}};a.cleanup=function(){D=G=0;O=[]};a.$q=k;a.copy=function(a,b,c){b=k(b,a.type,!1);var d=[];if(c){for(var e=0;e<a.n.length;e++)a.n[e].Qf||(b.n.push(n(a.n[e])),d.push(a.n[e].S));for(e=0;e<a.n.length;e++)if(a.n[e].Qf){var g=n(a.n[e]);b.n.push(g);for(var h=0;h<d.length;h++)d[h]==a.n[e].S&&(g.S=b.n[h].S)}}else b.n=f(a.n);
b.d=n(a.d);a.Ig&&(b.Ig=a.Ig);a.za&&(b.za=a.za);a.Md&&(b.Md=f(a.Md));!a.m||a.b4w_vehicle||a.b4w_character||a.b4w_floating||(b.m=n(a.m));b.game=n(a.game);b.b4w_collision_id=a.b4w_collision_id;b.b4w_correct_bounding_offset=a.b4w_correct_bounding_offset;b.b4w_collision=a.b4w_collision;b.data=a.data;b.particle_systems=c?n(a.particle_systems):f(a.particle_systems);if(c)for(e=0;e<b.n.length;e++){b.n[e].S&&B.mt(b.n[e].S);if("PARTICLES"==b.n[e].type&&b.n[e].Hn)for(h=0;h<b.tE.length;h++)if(b.particle_systems[h].name==
b.n[e].Hn){b.n[e].sc=b.particle_systems[h];break}b.n[e].th=b.uuid;l.sB(b.n[e],J.Ng(b.d,0))}b.uuid=J.Cm();b.d.Wm=!0;b.d.Jj=J.rq(G);G++;return b};a.nw=n;a.ty=function(a,b){for(var c=a.d.gg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.ny=function(a,b){for(var c=a.d.fg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}};b4w.module.__particles=function(a,m){function c(){throw"_rand() undefined";}function d(a,b,c,d,e,g,f){var h=a.R.fm,k=a.R.ld,l=a.R.time;a=a.R.gs;for(var m=b?4:1,J=0;J<h.length;J+=m){var A=h[J];if(A>a&&A<=l)for(A=0;8>A;A++)k[8*J+A]=e[A];for(A=0;8>A;A++)y[A]=k[8*J+A];A=p;A[0]=c[3*J];A[1]=c[3*J+1];A[2]=c[3*J+2];n.transform_vec3(A,y,A);g[3*J]=A[0];g[3*J+1]=A[1];g[3*J+2]=A[2];var N=p;N[0]=d[3*J];N[1]=d[3*J+1];N[2]=d[3*J+2];n.transform_dir_vec3(N,y,N);f[3*J]=N[0];f[3*J+1]=N[1];f[3*J+2]=N[2];if(b)for(A=1;4>
A;A++)g[3*(J+A)]=g[3*J],g[3*(J+A)+1]=g[3*J+1],g[3*(J+A)+2]=g[3*J+2],f[3*(J+A)]=N[0],f[3*(J+A)+1]=N[1],f[3*(J+A)+2]=N[2]}}function b(a){a?(f.UA(a),c=function(){return f.Iz()}):c=function(){return Math.random()}}var e=m("__config"),h=m("__geometry"),k=m("__scenes"),f=m("__util"),n=m("__tsr"),g=m("vec3"),l=e.Od,y=new Float32Array(8),p=new Float32Array(3);a.eh=function(a){return 0<a.particle_systems.length?!0:!1};a.Om=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.ND=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.By=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.Mx=function(a,e,k,n){k.R=k.R||{};var p=h.vx(e),t=k.settings.count,x=k.settings.frame_start/l.Ha,y=k.settings.frame_end/l.Ha,r=k.settings.lifetime/l.Ha,q=k.settings.lifetime_random,m=k.settings.emit_from,J=
k.settings.factor_random,A=k.settings.angular_velocity_mode,N=k.settings.angular_velocity_factor,L=k.settings.b4w_randomize_emission,M=k.settings.b4w_cyclic;b(k.seed);var G=k.R.XB="WORLD"==k.settings.b4w_coordinate_system?!0:!1;k.R.frame=0;if(e=!a.Uf){var D;D=[];for(var O=0;O<t;O++)D.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);D=new Float32Array(D);for(var O=[],Q=0;Q<t;Q++)O.push(4*Q,4*Q+2,4*Q+1,4*Q,4*Q+3,4*Q+2);O=new Uint16Array(O)}switch(m){case "VERT":for(var Q=p.B[0].a_position,p=p.B[0].a_normal,Z=Q.length/
3,m=[],P=0;P<t;P++){var U=Math.round((Z-1)*c());m.push(U);e&&(m.push(U),m.push(U),m.push(U))}Z=[];for(P=0;P<m.length;P++)Z.push(Q[3*m[P]]),Z.push(Q[3*m[P]+1]),Z.push(Q[3*m[P]+2]);Q=new Float32Array(Z);Z=[];for(P=0;P<m.length;P++)Z.push(p[3*m[P]]),Z.push(p[3*m[P]+1]),Z.push(p[3*m[P]+2]);m=new Float32Array(Z);break;case "FACE":Q=[];m=[];P=[];f.ck(0,P);Z=h.Dm(p,t,!1,P);f.ck(0,P);p=h.Dm(p,t,!0,P);for(P=0;P<Z.length;P++)Q.push(Z[P][0],Z[P][1],Z[P][2]),e&&(Q.push(Z[P][0],Z[P][1],Z[P][2]),Q.push(Z[P][0],
Z[P][1],Z[P][2]),Q.push(Z[P][0],Z[P][1],Z[P][2])),m.push(p[P][0],p[P][1],p[P][2]),e&&(m.push(p[P][0],p[P][1],p[P][2]),m.push(p[P][0],p[P][1],p[P][2]),m.push(p[P][0],p[P][1],p[P][2]));Q=new Float32Array(Q);m=new Float32Array(m);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}m=[Q,m];p=m[0];m=m[1];k.R.Mi=new Float32Array(p);k.R.qz=new Float32Array(m);k.R.Bz=new Float32Array(p.length);k.R.rz=new Float32Array(m.length);k.R.time=0;k.R.gs=
-1;Q=[];y=(y-x)/t;for(Z=0;Z<t;Z++)P=L?y*Z+10*y*(.5-c()):y*Z,M||(P+=x),Q.push(P),e&&(Q.push(P),Q.push(P),Q.push(P));x=new Float32Array(Q);k.R.fm=new Float32Array(x);k.R.Xp=new Float32Array(x);k.R.ld=new Float32Array(8*x.length);for(L=0;L<8*x.length;L++)for(M=0;8>M;M++)k.R.ld[8*L+M]=n[M];G&&d(k,e,p,m,n,p,m);k=[];n=r*q;for(q=0;q<t;q++)G=n*c(),k.push(r-G),e&&(k.push(r-G),k.push(r-G),k.push(r-G));r=new Float32Array(k);k=[];for(n=0;n<t;n++){q=[c()-.5,c()-.5,c()-.5];g.normalize(q,q);k.push(J*q[0]);k.push(J*
q[1]);k.push(J*q[2]);switch(A){case "NONE":k.push(0);break;case "SPIN":case "VELOCITY":k.push(N);break;case "RAND":k.push(2*N*(c()-.5));break;default:throw"Undefined velocity factor";}if(e)for(q=k.slice(-4),G=0;12>G;G++)k.push(q[G%4])}t=new Float32Array(k);J=f.kb("EMITTER_PARTICLES");A=f.Sc();A.a_position=p;A.a_normal=m;J.B[0]=A;e?(a.$d=h.kj,J.ca=O):(a.$d=h.Ko,J.ca=new Uint16Array(0));J.I=p.length/3;J.H.a_p_delay=x;J.H.a_p_lifetime=r;J.H.a_p_vels=t;e&&(J.H.a_p_bb_vertex=D);return J};a.AB=function(a){for(var b=
a.n,c=0;c<b.length;c++){var e=b[c],g=b[c].sc;if(g){var f=e.S;if(!g.R.XB)break;var k=g.R.Bz,n=g.R.rz;d(g,!e.Uf,g.R.Mi,g.R.qz,a.d.yb,k,n);h.bz(f);h.Yk(f,"a_position",3,k);h.Yk(f,"a_normal",3,n)}}};a.jA=function(a,b,c){var d=b.settings.lifetime/l.Ha,e=b.settings.normal_factor,g=9.81*b.settings.effector_weights.gravity,f=b.settings.effector_weights.wind,h=b.settings.mass,n=b.settings.b4w_fade_in/l.Ha,p=b.settings.b4w_fade_out/l.Ha,y=b.settings.b4w_cyclic;a.Ur=b.settings.frame_end/l.Ha-b.settings.frame_start/
l.Ha;a.Qr=y?1:0;a.Bn=e;a.Tr=g;e=k.wy();a.zk[0]=e[0]*f;a.zk[1]=e[1]*f;a.zk[2]=e[2]*f;a.Wr=d;a.Vr=h;a.Rr=n;a.Sr=p;a.Uf?(d=c.halo.size,f=c.halo.hardness,30>f?(f=.5,h=.9):40>f?(f=.1,h=1):50>f?(f=0,h=.8):(f=0,h=.5)):(d=b.settings.particle_size,h=f=1);a.Cn=d;a.Nr=f;a.Mr=h;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;f=Math.min(2*d.length,b.length);for(h=0;h<f;h+=2)n=
d[h/2],b[h]=n.position,b[h+1]=(n.color[0]+n.color[1]+n.color[2])/3;a.Yr=d.length}a.Xr.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;f=Math.min(4*d.length,c.length);for(h=0;h<f;h+=4)n=d[h/4],c[h]=n.position,c[h+1]=n.color[0],c[h+2]=n.color[1],c[h+3]=n.color[2];a.Pr=d.length}a.Or.set(c)};a.tA=function(a,b){a.R.gs=a.R.time;a.R.time=b};a.Dz=
function(a){for(var b=a.I,c=a.B[0].a_position,d=a.H.a_texcoord,e=[],g=[],f=0;f<b;f++)g.push(c[3*f]),g.push(c[3*f+1]),e.push(c[3*f+2]);e=new Float32Array(e);g=new Float32Array(g);a.H.a_lf_dist=e;a.H.a_lf_bb_vertex=g;a.H.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.n;for(var d=0;d<a.length;d++){var e=a[d],g=e.sc;g&&g.name==b&&(e.Cn=c)}};a.set_normal_factor=function(a,b,c){a=a.n;for(var d=0;d<a.length;d++){var e=a[d],g=e.sc;g&&g.name==b&&(e.Bn=c)}};a.set_factor=function(a,b,c){a=a.n;for(var d=
0;d<a.length;d++){var e=a[d],g=e.sc;if(g&&g.name==b){var f=g.R.fm;if(1==c)g=f;else if(0==c)for(var k=!e.Uf,n=k?4:1,g=g.R.Xp,l=0;l<g.length;l+=n)g[l]=1E4,k&&(g[l+1]=g[l],g[l+2]=g[l],g[l+3]=g[l]);else for(var p=1/c,g=g.R.Xp,n=(k=!e.Uf)?4:1,y=0,l=0;l<g.length;l+=n)l>=y?(g[l]=f[l],y+=p):g[l]=1E4,k&&(g[l+1]=g[l],g[l+2]=g[l],g[l+3]=g[l]);h.Yk(e.S,"a_p_delay",1,g)}}};a.JB=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var e=a[d];if("EMITTER"==e.settings.type)for(var g=e.R.fm,d=0;d<8*g.length;d++)e.R.ld[8*
d]=b[0],e.R.ld[8*d+1]=b[1],e.R.ld[8*d+2]=b[2],e.R.ld[8*d+3]=b[3],e.R.ld[8*d+4]=c[0],e.R.ld[8*d+5]=c[1],e.R.ld[8*d+6]=c[2],e.R.ld[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,m){function c(a,b,c,d){for(var e=[],f=[],h=[],m=[],B=2*c/(a-1),v=2*d/(b-1),t=0;t<a;t++)for(var x=-c+t*B,I=0;I<b;I++)if(f.push(x,0,-d+I*v),h.push(0,1,0),m.push(t/(a-1),I/(b-1)),t&&I){var r=t*b+I,q=r-1,C=(t-1)*b+I,J=C-1;e.push(r,q,C);e.push(q,J,C)}a=k.Sc();a.a_position=new Float32Array(f);a.a_normal=new Float32Array(h);h=k.kb("GRID_PLANE");h.B[0]=a;h.H.a_texcoord=new Float32Array(m);h.ca=new Uint32Array(e);h.I=f.length/3;return h}function d(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=4){var h=a[f+1],z=a[f+2],m=a[f+3];e(a[f],d);e(h,d);e(z,d);e(m,d);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=k.Sc();a.a_position=new Float32Array(d);b=k.kb("FROM_QUADS");b.B[0]=a;b.ca=new Uint32Array(c);b.I=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function e(a,b){b.push(a[0],a[1],a[2])}var h=m("__geometry"),k=m("__util"),f=m("__config").o;a.FD=function(a){for(var b=k.kb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=k.Sc();d.a_point=
new Float32Array(c);b.B[0]=d;b.ca=new Uint32Array(c);b.I=2*a;return b};a.GD=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.ED=c;a.Rx=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==m-1)||1==b%2&&(0==a||a==z-1)?!0:!1}var e=c/=Math.pow(2,a-1),w=c,z=b+1,m=b+1;b=[];c=[];for(var B=0,v=0,t=-1,x=[],I=0;I<a;I++){for(var r=2*e/(z-1),q=2*w/(m-1),C=[],J=[],A=0,N=0;N<z;N++){for(var L=-e+N*r,M=[],G=0;G<m;G++){var D=-w+G*q;if(L>-B&&L<B&&D>-v&&D<v)M.push(-1),A++;else{for(var O=null,Q=0;Q<x.length;Q+=
3)if(L==x[Q]&&D==x[Q+1]){O=x[Q+2];break}Q=null!==O?O:t+1;d(N,G)?(M.push(-2),A++):(null==O&&(0==G||G==m-1||0==N||N==z-1?(O=I==a-1?r:2*r,C.push(L,D,Q)):O=r,c.push(L,O,D),t++),M.push(Q));if(N&&G)if(1==N)if(d(N-1,G)){if(1<G){var D=Q-1,O=J[N-1][G+1],Z=O-1;b.push(Q,D,Z)}else O=J[N-1][G+1],Z=O-1;b.push(Q,Z,O)}else d(N,G)||(D=Q-1,O=J[N-1][G],b.push(Q,D,O));else if(N==z-1){if(!d(N,G))if(G==m-1)D=Q-1,O=J[N-1][G-1],Z=J[N-2][G],b.push(Q,D,O),b.push(Q,O,Z);else{var D=Q-1,O=J[N-1][G],Z=O-1,P=O+1;b.push(Q,D,Z);
b.push(Q,Z,O);b.push(Q,O,P);2==G&&(P=J[N-2][G-2],b.push(D,P,Z))}}else 1==G?d(N,G-1)?(D=J[N-1][G],O=J[N-1][G-1],b.push(Q,O,D)):(D=M[G-1],O=J[N-1][G],Z=J[N-2][G-1],b.push(Q,D,O),b.push(D,Z,O)):G==m-1?d(N,G)||(D=M[G-1],O=J[N-1][G-1],Z=J[N-2][G],b.push(Q,D,O),b.push(Q,O,Z)):-1!=J[N-1][G]&&-1!=J[N-1][G-1]&&-1!=M[G-1]?(D=M[G-1],O=J[N-1][G],Z=J[N-1][G-1],b.push(Q,D,O),b.push(D,Z,O),G==m-2&&d(N,G+1)&&(P=J[N-1][G+1],b.push(Q,O,P))):G==m-2&&d(N,G+1)&&(O=J[N-1][G],P=J[N-1][G+1],b.push(Q,O,P))}}J.push(M)}x=C;
B=e;v=w;e*=2;w*=2}2E4>B&&(a=-(2*B)/(z-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-B,a,-v),c.push(-B,a,v),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(B,a,-v),c.push(B,a,v),Q=t+1,b.push(Q+3,Q+2,Q+1,Q+2,Q+0,Q+1,Q+6,Q+4,Q+2,Q+4,Q+0,Q+2,Q+5,Q+7,Q+1,Q+7,Q+3,Q+1,Q+5,Q+4,Q+7,Q+7,Q+4,Q+6));a=k.Sc();a.a_position=new Float32Array(c);e=k.kb("multigrid_plane");e.B[0]=a;e.ca=new Uint32Array(b);e.I=c.length/3;f.Bt&&(h.co(e,1,!0),a.a_polyindex=h.gq(e));return e};a.DD=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],d=[],f=0;f<b;f+=3){var h=a[f+1],z=a[f+2];e(a[f],d);e(h,d);e(z,d);c.push(f,f+1,f+2)}a=k.Sc();a.a_position=new Float32Array(d);b=k.kb("FROM_TRIANGLES");b.B[0]=a;b.ca=new Uint32Array(c);b.I=d.length/3;return b};a.CD=d;a.Nx=function(a){a=k.aC(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=d(b);a.name="FRUSTUM";return a};a.mb=function(){var a=k.kb("FULLSCREEN_TRI"),
b=k.Sc();b.a_position=new Float32Array([0,0,1,0,0,1]);a.B[0]=b;a.ca=new Uint32Array([0,1,2]);a.I=3;return a};a.Ox=function(){var a=k.kb("FULLSCREEN_QUAD"),b=k.Sc();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.B[0]=b;a.ca=new Uint32Array([0,2,1,1,2,3]);a.I=4;return a};a.Jx=function(){var a=k.kb("BILLBOARD"),b=k.Sc();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.B[0]=b;a.ca=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.Kx=function(){var a=k.kb("CUBEMAP_BOARD"),b=k.Sc();
b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.B[0]=b;a.ca=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.uq=function(a,c){var d=k.kb("UV_SPHERE"),f,p,w=[],z=[],m=[];for(p=0;8>=p;p++)for(f=0;16>=f;f++){var B=f/16,v=p/8;z.push(-a*Math.cos(2*B*Math.PI)*Math.sin(v*Math.PI)+c[0],a*Math.cos(v*Math.PI)+c[1],a*Math.sin(2*B*Math.PI)*Math.sin(v*Math.PI)+c[2])}for(p=B=0;8>p;p++)for(f=0;16>f;f++){var v=b(z,17*p+f+1),t=b(z,17*p+f),x=b(z,17*(p+1)+f),I=b(z,17*(p+1)+f+1);Math.abs(v[1])==a+c[1]?(e(v,w),
e(x,w),e(I,w),m.push(B,B+1,B+2),B+=3):Math.abs(x[1])==a+c[1]?(e(v,w),e(t,w),e(x,w),m.push(B,B+1,B+2),B+=3):(e(v,w),e(t,w),e(x,w),e(I,w),m.push(B,B+1,B+2),m.push(B,B+2,B+3),B+=4)}f={};f.a_position=w;z=h.wp(m,z,w);f.a_normal=h.up(m,w,z);f.a_tangent=[];d.H.a_influence=[];d.H.a_color=[];d.H.a_texcoord=[];d.B[0]=f;d.ca=m;d.I=w.length/3;return d};a.tq=function(a){var b=k.kb("INDEX"),c=k.Sc();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.B[0]=c;b.ca=new Uint16Array(0);b.I=a;return b}};b4w.module.__prerender=function(a,m){function c(a,c){var d=a.sd,e=c.h;d.is_visible=!1;var g;if(!(g=!d||d.fh)){var f=e.Pe,k=d.sb.F;g=d.We;f=Math.sqrt((k[0]-f[0])*(k[0]-f[0])+(k[1]-f[1])*(k[1]-f[1])+(k[2]-f[2])*(k[2]-f[2]));k=d.eg*d.sb.Da;g=!(f>=d.Di&&f<g+k)}if(g)return!1;d.is_visible=!0;(g="OUTLINE_MASK"==c.type&&!Boolean(d.Vc))||(e=e.Uj,d.Tg?g=!1:("STATIC"===d.type?(g=d.sb,d=g.F,d=h.PA(d,e,g.Da)):(g=d.Hf,d=g.F,d=h.mx(d,e,g.Df,g.Ef,g.Ff)),g=d));return g?!1:"WIREFRAME"==c.type?a.D.wireframe_mode==b.Qo.WM_DEBUG_SPHERES?
a.D.Rg:!a.D.Rg:!0}var d=m("__config"),b=m("__debug"),e=m("__geometry"),h=m("__util"),k=m("__renderer"),f=m("vec3"),n=d.o,g="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Gn=function(a){if(-1<g.indexOf(a.type)){for(var b=!1,d=a.p,h=0;h<d.length;h++){var m=d[h];if("MAIN_CUBE_REFLECT"==a.type)for(var E=0;6>E;E++)a.h.Uj=a.Zl[E],m.hm[E]=c(m,a),m.hm[E]&&(b=!0);else m.Ta=c(m,a),m.Ta&&
(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?a.Ta=!0:(a.Ta&&k.clear(a),a.Ta=!1)}}if("MAIN_BLEND"==a.type&&n.alpha_sort&&a.p){b=a.h.Pe;d=f.dist(b,a.Dt)>n.alpha_sort_threshold;for(h=0;h<a.p.length;h++)if(E=a.p[h],m=E.sd,m.zm||d){var B=E.D;if(B&&B.Fa&&B.ye!=e.Ld){B=B.S;if(!B||!E.Ta)continue;(E=B.bk)&&E.type==e.Ro&&e.uB(B,m.U,b)}m.zm=!1}d&&a.Dt.set(b)}}};b4w.module.__print=function(a){function m(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}var c=!1,d=0,b=0;a.vA=function(a){c=a};a.log=function(){if(c){var a=m(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){d++;var a=m(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){b++;var a=m(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=
m(arguments,"B4W INFO");console.info.apply(console,a)};a.px=function(){d++;var a=m(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.qx=function(){b++;var a=m(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){c&&console.time.apply(console,arguments)};a.timeEnd=function(){c&&console.timeEnd.apply(console,arguments)};a.group=function(){c&&console.group.apply(console,arguments)};a.groupCollapsed=function(){c&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){c&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.vy=function(){return b};a.gy=function(){return d};a.clear_errors_warnings=function(){d=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,m){function c(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function d(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.strips.length;e++){var g=d.strips[e];"action"in g||(g.action=null,b("strip",g,"action"));"action_frame_start"in g||(g.action_frame_start=0,b("strip",g,"action_frame_start"));"action_frame_end"in g||(g.action_frame_end=g.frame_end-g.frame_start,b("strip",g,"action_frame_end"));"repeat"in g||(g.repeat=1,b("strip",g,"repeat"));"use_reverse"in g||(g.use_reverse=!1,b("strip",g,"use_reverse"));"scale"in
g||(g.scale=1,b("strip",g,"scale"))}}function b(a,b,c){c=c+">>"+a;c in z||(z[c]={bo:[],ss:"undefined",type:a});z[c].bo.push(b.name)}function e(a,b){param_id in z||(z[param_id]={bo:[],ss:"deprecated",type:a});z[param_id].bo.push(b.name)}function h(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=g.Lf(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=g.Gj(d[c]);e.submeshes.push(f)}return e}
var k=m("__boundings"),f=m("__curve"),n=m("__print"),g=m("__util"),l=m("vec3"),y=m("vec4"),p=m("quat"),w=m("mat4"),z={};a.Dp=function(a){return 5.04<=a};a.Sv=function(a){z={};var f=a.worlds;if(0==f.length){n.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var h={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,b4w_fog_color:[.5,
.5,.5],b4w_fog_density:0,texture_slots:[]};f.push(h)}for(var f=a.worlds,k=0;k<f.length;k++){var h=f[k],l=h.b4w_shadow_settings;"csm_resolution"in l||(b("world",h,"b4w_shadow_settings.csm_resolution"),l.csm_resolution=2048);"self_shadow_polygon_offset"in l||(b("world",h,"b4w_shadow_settings.self_shadow_polygon_offset"),l.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in l||(b("world",h,"b4w_shadow_settings.self_shadow_normal_offset"),l.self_shadow_normal_offset=.01);"b4w_enable_csm"in l||
(b("world",h,"b4w_shadow_settings.b4w_enable_csm"),l.b4w_enable_csm=!1);"csm_num"in l||(b("world",h,"b4w_shadow_settings.csm_num"),l.csm_num=1);"csm_first_cascade_border"in l||(b("world",h,"b4w_shadow_settings.csm_first_cascade_border"),l.csm_first_cascade_border=10);"first_cascade_blur_radius"in l||(b("world",h,"b4w_shadow_settings.first_cascade_blur_radius"),l.first_cascade_blur_radius=3);"csm_last_cascade_border"in l||(b("world",h,"b4w_shadow_settings.csm_last_cascade_border"),l.csm_last_cascade_border=
100);"last_cascade_blur_radius"in l||(b("world",h,"b4w_shadow_settings.last_cascade_blur_radius"),l.last_cascade_blur_radius=1.5);"fade_last_cascade"in l||(b("world",h,"b4w_shadow_settings.fade_last_cascade"),l.fade_last_cascade=!0);"blend_between_cascades"in l||(b("world",h,"b4w_shadow_settings.blend_between_cascades"),l.blend_between_cascades=!0);l=h.b4w_ssao_settings;"dist_factor"in l||(b("world",h,"b4w_ssao_settings.dist_factor"),l.dist_factor=0,l.samples=16);"hemisphere"in l||(b("world",h,"b4w_ssao_settings.hemisphere"),
l.hemisphere=!1);"blur_depth"in l||(b("world",h,"b4w_ssao_settings.blur_depth"),l.blur_depth=!1);"blur_discard_value"in l||(b("world",h,"b4w_ssao_settings.blur_discard_value"),l.blur_discard_value=1);"use_sky_blend"in h||(b("world",h,"use_sky_blend"),h.use_sky_blend=!1);"use_sky_paper"in h||(b("world",h,"use_sky_paper"),h.use_sky_paper=!1);"use_sky_real"in h||(b("world",h,"use_sky_real"),h.use_sky_real=!1);"b4w_outline_color"in h||(h.b4w_outline_color="b4w_glow_color"in h?h.b4w_glow_color:[1,1,1],
b("world",h,"b4w_outline_color"));"b4w_outline_factor"in h||(h.b4w_outline_factor="b4w_glow_factor"in h?h.b4w_glow_factor:1,b("world",h,"b4w_outline_factor"));"b4w_small_glow_mask_coeff"in h||(b("world",h,"b4w_small_glow_mask_coeff"),h.b4w_small_glow_mask_coeff=2);"b4w_large_glow_mask_coeff"in h||(b("world",h,"b4w_large_glow_mask_coeff"),h.b4w_large_glow_mask_coeff=2);"b4w_small_glow_mask_width"in h||(b("world",h,"b4w_small_glow_mask_width"),h.b4w_small_glow_mask_width=2);"b4w_large_glow_mask_width"in
h||(b("world",h,"b4w_large_glow_mask_width"),h.b4w_large_glow_mask_width=6);"b4w_fog_density"in h||(b("world",h,"b4w_fog_density"),h.b4w_fog_density=0);"b4w_sky_settings"in h&&"rayleigh_brightness"in h.b4w_sky_settings||(b("world",h,"rayleigh_brightness"),h.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,
mie_collection_power:.5,mie_distribution:.4});"render_sky"in h.b4w_sky_settings||(b("world",h,"render_sky"),h.b4w_sky_settings.render_sky=!1);"b4w_bloom_settings"in h?("blur"in h.b4w_bloom_settings||(b("world",h,"b4w_bloom_settings.blur"),h.b4w_bloom_settings.blur=4),"edge_lum"in h.b4w_bloom_settings||(b("world",h,"b4w_bloom_settings.edge_lum"),h.b4w_bloom_settings.edge_lum=1)):(b("world",h,"b4w_bloom_settings"),h.b4w_bloom_settings={key:.2,blur:4});"b4w_motion_blur_settings"in h?("motion_blur_factor"in
h.b4w_motion_blur_settings||(b("world",h,"b4w_motion_blur_settings.motion_blur_factor"),h.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in h.b4w_motion_blur_settings||(b("world",h,"b4w_motion_blur_settings.motion_blur_decay_threshold"),h.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",h,"b4w_motion_blur_settings"),h.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});"b4w_color_correction_settings"in h||(b("world",
h,"b4w_color_correction_settings"),h.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in h.b4w_god_rays_settings||(b("world",h,"b4w_god_rays_settings.steps_per_pass"),h.b4w_god_rays_settings.steps_per_pass=10);"b4w_render_glow_over_blend"in h||(h.b4w_render_glow_over_blend=!1,b("world",h,"b4w_render_glow_over_blend"));l=h.texture_slots;for(h=0;h<l.length;h++){var p=l[h];"blend_type"in p||(p.blend_type="MIX",b("world_texture_slot",p,"blend_type"));"use_map_blend"in
p||(p.use_map_blend=!1,b("world_texture_slot",p,"use_map_blend"));"use_map_horizon"in p||(p.use_map_horizon=!0,b("world_texture_slot",p,"use_map_horizon"));"use_map_zenith_up"in p||(p.use_map_zenith_up=!1,b("world_texture_slot",p,"use_map_zenith_up"));"use_rgb_to_intensity"in p||(p.use_rgb_to_intensity=!1,b("world_texture_slot",p,"use_rgb_to_intensity"));"invert"in p||(p.invert=!1,b("world_texture_slot",p,"invert"));"color"in p||(p.color=[1,0,1],b("world_texture_slot",p,"color"));"blend_factor"in
p||(p.blend_factor=0,b("world_texture_slot",p,"blend_factor"));"horizon_factor"in p||(p.horizon_factor=1,b("world_texture_slot",p,"horizon_factor"));"zenith_up_factor"in p||(p.zenith_up_factor=0,b("world_texture_slot",p,"zenith_up_factor"));"zenith_down_factor"in p||(p.zenith_down_factor=0,b("world_texture_slot",p,"zenith_down_factor"));"default_value"in p||(p.default_value=1,b("world_texture_slot",p,"default_value"))}}h=a.scenes;for(k=0;k<h.length;k++)f=h[k],"b4w_use_nla"in f||(f.b4w_use_nla=!1,
b("scene",f,"b4w_use_nla")),"fps"in f||(f.fps=24,b("scene",f,"fps")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,b("scene",f,"b4w_nla_cyclic")),"b4w_nla_script"in f||(f.b4w_nla_script=[],b("scene",f,"b4w_nla_script")),"b4w_detect_collisions"in f&&(e("scene",f),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,
ratio:12,attack:.003,release:.25},b("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,b("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,b("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=!1,b("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=
!0,b("scene",f,"b4w_enable_antialiasing")),"b4w_tags"in f||(f.b4w_tags={title:"",description:""},b("scene",f,"b4w_tags")),"b4w_enable_object_selection"in f||(f.b4w_enable_object_selection="AUTO",b("scene",f,"b4w_enable_object_selection")),"b4w_enable_outlining"in f||(f.b4w_enable_outlining="AUTO",b("scene",f,"b4w_enable_outlining")),"b4w_enable_glow_materials"in f||(f.b4w_enable_glow_materials="AUTO",b("scene",f,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in f||(f.b4w_enable_anchors_visibility=
"AUTO",b("scene",f,"b4w_enable_anchors_visibility"));f=a.meshes;for(k=0;k<f.length;k++){l=f[k];l.b4w_bounding_box||(b("mesh",l,"b4w_bounding_box"),l.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});l.uv_textures||(b("mesh",l,"uv_textures"),l.uv_textures=[]);l.b4w_bounding_sphere_center||(l.b4w_bounding_sphere_center=[0,0,0]);l.b4w_bounding_cylinder_center||(l.b4w_bounding_cylinder_center=[0,0,0]);l.b4w_bounding_ellipsoid_center||(l.b4w_bounding_ellipsoid_center=[0,0,0]);l.b4w_bounding_ellipsoid_axes||
(h=l.b4w_bounding_box,l.b4w_bounding_ellipsoid_axes=[(h.max_x-h.min_x)/2,(h.max_y-h.min_y)/2,(h.max_z-h.min_z)/2]);"b4w_shape_keys"in l||(l.b4w_shape_keys=[],b("mesh",l,"b4w_shape_keys"));for(var h=l,p=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],r=null,q=0;q<p.length;q++)h[p[q]]&&(r?(h[p[q]]=!1,n.warn('WARNING property "'+p[q]+'" of object "'+h.name+'" has been set to "false". Foreground property "'+r+'" already exists.')):r=
p[q]);for(h=0;h<l.b4w_vertex_anim.length;h++)p=l.b4w_vertex_anim[h],"allow_nla"in p||(b('mesh["b4w_vertex_anim"]',l,"allow_nla"),p.allow_nla=!0)}h=a.cameras;for(k=0;k<h.length;k++)f=h[k],f.type||(f.type="PERSP",b("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,e("camera",f)),"b4w_trans_velocity"in f||(f.b4w_trans_velocity=1,b("camera",f,"b4w_trans_velocity")),"b4w_rot_velocity"in f||(f.b4w_rot_velocity=1,b("camera",f,"b4w_rot_velocity")),"b4w_zoom_velocity"in f||(f.b4w_zoom_velocity=
.1,b("camera",f,"b4w_zoom_velocity")),"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,b("camera",f,"b4w_use_distance_limits")),"b4w_distance_min"in f||(f.b4w_distance_min=1,b("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,b("camera",f,"b4w_distance_max")),"b4w_horizontal_translation_min"in f||(f.b4w_horizontal_translation_min=-100,b("camera",f,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in f||(f.b4w_horizontal_translation_max=100,
b("camera",f,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in f||(f.b4w_vertical_translation_min=-100,b("camera",f,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in f||(f.b4w_vertical_translation_max=100,b("camera",f,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in f||(f.b4w_use_horizontal_clamping=!1,b("camera",f,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in f||(f.b4w_rotation_left_limit=-Math.PI,b("camera",f,"b4w_rotation_left_limit")),
"b4w_rotation_right_limit"in f||(f.b4w_rotation_right_limit=Math.PI,b("camera",f,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in f||(f.b4w_horizontal_clamping_type="LOCAL",b("camera",f,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,b("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=-Math.PI/2,b("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in f||(f.b4w_rotation_up_limit=
Math.PI/2,b("camera",f,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in f||(f.b4w_vertical_clamping_type="LOCAL",b("camera",f,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in f||(f.b4w_hover_angle_min=Math.PI/6,b("camera",f,"b4w_hover_angle_min")),"b4w_hover_angle_max"in f||(f.b4w_hover_angle_max=Math.PI/6,b("camera",f,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in f||(f.b4w_enable_hover_hor_rotation=!0,b("camera",f,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in f||
(f.b4w_use_panning=!0,b("camera",f,"b4w_use_panning"));h=a.lamps;for(k=0;k<h.length;k++)f=h[k],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,b("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=!1,b("lamp",f,"b4w_dynamic_intensity")),"use_diffuse"in f||(f.use_diffuse=!0,b("lamp",f,"use_diffuse")),"use_specular"in f||(f.use_specular=!0,b("lamp",f,"use_specular"));h=a.speakers;for(k=0;k<h.length;k++)f=h[k],"b4w_behavior"in f||(f.b4w_behavior=f.b4w_background_music?
"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in f||(f.b4w_disable_doppler=!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=!1),"b4w_loop_count"in f||(f.b4w_loop_count=0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in f||(f.b4w_playlist_id=
""),f.animation_data&&d(f.animation_data);h=a.textures;for(k=0;k<h.length;k++)f=h[k],"b4w_anisotropic_filtering"in f||(f.b4w_anisotropic_filtering="OFF",b("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,b("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=[1,1],b("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=[1,1],b("texture",f,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in f||(f.b4w_parallax_steps=
5,b("material",f,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in f||(f.b4w_parallax_lod_dist=10,b("material",f,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,b("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=100,b("texture",f,"b4w_max_shore_dist")),"b4w_disable_compression"in f||(f.b4w_disable_compression=
!1,b("texture",f,"b4w_disable_compression")),"b4w_source_type"in f||(f.b4w_source_type="",b("texture",f,"b4w_source_type")),"b4w_source_id"in f||(f.b4w_source_id="",b("texture",f,"b4w_source_id")),"b4w_source_size"in f||(f.b4w_source_size=1024,b("texture",f,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in f||(f.b4w_enable_canvas_mipmapping=!0,b("texture",f,"b4w_enable_canvas_mipmapping"));f=a.materials;for(k=0;k<f.length;k++){r=f[k];"b4w_node_mat_type"in r&&e("material",r);"b4w_skydome"in r&&
e("material",r);"b4w_procedural_skydome"in r&&e("material",r);r.b4w_water&&("b4w_water_shore_smoothing"in r||(r.b4w_water_shore_smoothing=!1,b("material",r,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in r||(r.b4w_water_dynamic=!1,b("material",r,"b4w_water_dynamic")),"b4w_waves_height"in r||(r.b4w_waves_height=1,b("material",r,"b4w_waves_height")),"b4w_waves_length"in r||(r.b4w_waves_length=1,b("material",r,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in r||(r.b4w_water_dst_noise_scale0=.05,
b("material",r,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in r||(r.b4w_water_dst_noise_scale1=.03,b("material",r,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in r||(r.b4w_water_dst_noise_freq0=1.3,b("material",r,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in r||(r.b4w_water_dst_noise_freq1=1,b("material",r,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in r||(r.b4w_water_dir_min_shore_fac=.4,b("material",r,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
r||(r.b4w_water_dir_freq=.5,b("material",r,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in r||(r.b4w_water_dir_noise_scale=.05,b("material",r,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in r||(r.b4w_water_dir_noise_freq=.07,b("material",r,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in r||(r.b4w_water_dir_min_noise_fac=.5,b("material",r,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in r||(r.b4w_water_dst_min_fac=.2,b("material",r,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
r||(r.b4w_water_waves_hor_fac=5,b("material",r,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in r||(r.b4w_water_absorb_factor=6,b("material",r,"b4w_water_absorb_factor")),"b4w_water_fog_color"in r||(r.b4w_water_fog_color=new Float32Array(3),r.b4w_water_fog_color=[.5,.7,.7],b("material",r,"b4w_water_fog_color")),"b4w_foam_factor"in r||(r.b4w_foam_factor=5,b("material",r,"b4w_foam_factor")),"b4w_generated_mesh"in r||(r.b4w_generated_mesh=!1,b("material",r,"b4w_generated_mesh")),"b4w_water_num_cascads"in
r||(r.b4w_water_num_cascads=5,b("material",r,"b4w_water_num_cascads")),"b4w_water_subdivs"in r||(r.b4w_water_subdivs=64,b("material",r,"b4w_water_subdivs")),"b4w_water_detailed_dist"in r||(r.b4w_water_detailed_dist=1E3,b("material",r,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in r||(r.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in r||(r.b4w_dynamic_grass_color="");"diffuse_intensity"in r||(r.diffuse_intensity=1,b("material",r,"diffuse_intensity"));"b4w_use_ghost"in r||(r.b4w_use_ghost=
!1);"b4w_collision_margin"in r||(r.b4w_collision_margin=.04,b("material",r,"b4w_collision_margin"));"b4w_collision_group"in r||(r.b4w_collision_group=128,b("material",r,"b4w_collision_group"));"b4w_collision_mask"in r||(r.b4w_collision_mask=127,b("material",r,"b4w_collision_mask"));"b4w_do_not_render"in r||(r.b4w_do_not_render=!1,b("material",r,"b4w_do_not_render"));"HALO"!=r.type||"b4w_halo_sky_stars"in r||(r.b4w_halo_sky_stars=!1,b("material",r,"b4w_halo_sky_stars"));"HALO"!=r.type||"b4w_halo_stars_blend_height"in
r||(r.b4w_halo_stars_blend_height=10,b("material",r,"b4w_halo_stars_blend_height"));"HALO"!=r.type||"b4w_halo_stars_min_height"in r||(r.b4w_halo_stars_min_height=0,b("material",r,"b4w_halo_stars_min_height"));"specular_shader"in r||(r.specular_shader="COOKTORR",b("material",r,"specular_shader"));"diffuse_shader"in r||(r.diffuse_shader="LAMBERT",b("material",r,"diffuse_shader"));"roughness"in r||(r.roughness=.5,b("material",r,"roughness"));"diffuse_fresnel"in r||(r.diffuse_fresnel=.1,b("material",
r,"diffuse_fresnel"));"diffuse_fresnel_factor"in r||(r.diffuse_fresnel_factor=.5,b("material",r,"diffuse_fresnel_factor"));"specular_slope"in r||(r.specular_slope=.2,b("material",r,"specular_slope"));"specular_toon_size"in r||(r.specular_toon_size=.5,b("material",r,"specular_toon_size"));"specular_toon_smooth"in r||(r.specular_toon_smooth=.1,b("material",r,"specular_toon_smooth"));"specular_alpha"in r||(r.specular_alpha=1,b("material",r,"specular_alpha"));"b4w_wettable"in r||(r.b4w_wettable=!1,b("material",
r,"b4w_wettable"));"b4w_refractive"in r||(r.b4w_refractive=!1,b("material",r,"b4w_refractive"));"b4w_refr_bump"in r||(r.b4w_refr_bump=0,b("material",r,"b4w_refr_bump"));"b4w_shallow_water_col"in r||(r.b4w_shallow_water_col=[0,.8,.3],b("material",r,"b4w_shallow_water_col"));"b4w_shore_water_col"in r||(r.b4w_shore_water_col=[0,.9,.2],b("material",r,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in r||(r.b4w_shallow_water_col_fac=1,b("material",r,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in
r||(r.b4w_shore_water_col_fac=.5,b("material",r,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in r||(r.b4w_water_sss_strength=5.9,b("material",r,"b4w_water_sss_strength"));"b4w_water_sss_width"in r||(r.b4w_water_sss_width=.45,b("material",r,"b4w_water_sss_width"));"b4w_render_above_all"in r||(r.b4w_render_above_all=!1,b("material",r,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in r||(r.b4w_water_norm_uv_velocity=.05,b("material",r,"b4w_water_norm_uv_velocity"));l=r.texture_slots;for(h=
0;h<l.length;h++)p=l[h],"blend_type"in p||(p.blend_type="MIX",b("texture_slot",p,"blend_type"));if(r.node_tree){l=r.node_tree.nodes;for(h=0;h<l.length;h++)c(l[h]);r.node_tree.animation_data&&d(r.node_tree.animation_data)}}f=a.node_groups;for(k=0;k<f.length;k++)for(l=f[k].node_tree.nodes,h=0;h<l.length;h++)c(l[h]);f=a.objects;for(k=0;k<f.length;k++){l=f[k];switch(l.type){case "MESH":"b4w_dynamic_geometry"in l||(l.b4w_dynamic_geometry=!1);"b4w_reflexible"in l||(l.b4w_reflexible=!1);"b4w_reflexible_only"in
l||(l.b4w_reflexible_only=!1);"b4w_reflective"in l||(l.b4w_reflective=!1);"b4w_reflection_type"in l||(l.b4w_reflection_type="PLANE",b("object",l,"b4w_reflection_type"));"b4w_wind_bending"in l||(l.b4w_wind_bending=!1,b("object",l,"b4w_wind_bending"));"b4w_wind_bending_angle"in l||(l.b4w_wind_bending_angle=10,l.b4w_wind_bending_freq=.25,b("object",l,"wind bending params"));"b4w_detail_bending_amp"in l||(l.b4w_detail_bending_amp=.1,l.b4w_branch_bending_amp=.3,b("object",l,"detail bending params"));"b4w_detail_bending_freq"in
l||(l.b4w_detail_bending_freq=1,b("object",l,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in l||(l.b4w_main_bend_stiffness_col="",b("object",l,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in l||(l.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",l,"b4w_detail_bend_colors"));"b4w_caustics"in l||(l.b4w_caustics=!1);"vertex_groups"in l&&l.vertex_groups.length&&l.data&&0==l.data.vertex_groups.length&&(l.data.vertex_groups=
l.vertex_groups,delete l.vertex_groups,b("object",l,"vertex_groups"));"b4w_vertex_anim"in l&&l.b4w_vertex_anim.length&&l.data&&0==l.data.b4w_vertex_anim.length&&(l.data.b4w_vertex_anim=l.b4w_vertex_anim,delete l.b4w_vertex_anim,b("object",l,"b4w_vertex_anim"));"b4w_do_not_render"in l||(l.b4w_do_not_render=!1);"use_ghost"in l.game||(l.game.use_ghost=!1);"use_sleep"in l.game||(l.game.use_sleep=!1);"velocity_min"in l.game||(l.game.velocity_min=0);"velocity_max"in l.game||(l.game.velocity_max=0);"collision_group"in
l.game||(l.game.collision_group=1);"collision_mask"in l.game||(l.game.collision_mask=255);"b4w_vehicle_settings"in l?l.b4w_vehicle_settings&&("steering_ratio"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.steering_ratio=10),"steering_max"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.steering_max=1),"inverse_control"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.inverse_control=!1),"force_max"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.force_max=1500),"brake_max"in l.b4w_vehicle_settings||
(l.b4w_vehicle_settings.brake_max=100),"speed_ratio"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_stiffness=
20),"suspension_damping"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.floating_factor=3),"floating_factor"in l.b4w_vehicle_settings||
(l.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.water_rot_damp=.9)):(l.b4w_vehicle_settings=null,b("object",l,"b4w_vehicle_settings"));"b4w_floating_settings"in l?l.b4w_floating_settings&&("floating_factor"in l.b4w_floating_settings||(l.b4w_floating_settings.floating_factor=3),"water_lin_damp"in l.b4w_floating_settings||(l.b4w_floating_settings.water_lin_damp=
.8),"water_rot_damp"in l.b4w_floating_settings||(l.b4w_floating_settings.water_rot_damp=.8)):(l.b4w_floating_settings=null,b("object",l,"b4w_floating_settings"));"b4w_character_settings"in l?l.b4w_character_settings&&("walk_speed"in l.b4w_character_settings||(l.b4w_character_settings.walk_speed=4),"run_speed"in l.b4w_character_settings||(l.b4w_character_settings.run_speed=8),"step_height"in l.b4w_character_settings||(l.b4w_character_settings.step_height=.25),"jump_strength"in l.b4w_character_settings||
(l.b4w_character_settings.jump_strength=5),"waterline"in l.b4w_character_settings||(l.b4w_character_settings.waterline=0)):(l.b4w_character_settings=null,b("object",l,"b4w_character_settings"));"b4w_selectable"in l||(l.b4w_selectable=!1,b("object",l,"b4w_selectable"));"b4w_outlining"in l||(l.b4w_outlining=!1,b("object",l,"b4w_outlining"));"b4w_outline_on_select"in l||(l.b4w_outline_on_select=!1,b("object",l,"b4w_outline_on_select"));"b4w_billboard"in l||(l.b4w_billboard=!1,b("object",l,"b4w_billboard"));
"b4w_billboard_geometry"in l||(l.b4w_billboard_geometry="SPHERICAL",b("object",l,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in l||(l.b4w_pres_glob_orientation=!1,b("object",l,"b4w_pres_glob_orientation"));"b4w_outline_settings"in l||("b4w_glow_settings"in l?l.b4w_outline_settings=l.b4w_glow_settings:(l.b4w_outline_settings={},l.b4w_outline_settings.outline_duration=1,l.b4w_outline_settings.outline_period=1,l.b4w_outline_settings.outline_relapses=0),b("object",l,"b4w_outline_settings"));
"b4w_lod_transition"in l||(l.b4w_lod_transition=.01,b("object",l,"b4w_lod_transition"));"lod_levels"in l||(l.lod_levels=[],b("object",l,"lod_levels"));"b4w_animation_mixing"in l||(l.b4w_animation_mixing=!1,b("object",l,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in l||(l.b4w_group_relative=!1,b("object",l,"b4w_group_relative")),"b4w_anchor"in l||(l.b4w_anchor=null,b("object",l,"b4w_anchor")),!l.b4w_anchor||"max_width"in l.b4w_anchor||(l.b4w_anchor.max_width=250)}"collision_margin"in
l.game||(l.game.collision_margin=.04,b("object",l,"collision_margin"));"b4w_anim_behavior"in l||(l.b4w_anim_behavior=l.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",l,"b4w_anim_behavior"));if(!("rotation_quaternion"in l)){h=[0,0,0,1];g.euler_to_quat(l.rotation_euler,h);var p=h,r=h[0],q=h[1],y=h[2];p[0]=h[3];p[1]=r;p[2]=q;p[3]=y;l.rotation_quaternion=h;b("object",l,"rotation_quaternion")}"webgl_do_not_batch"in l&&(l.b4w_do_not_batch=l.webgl_do_not_batch)&&e("object",l);"b4w_shadow_cast_only"in
l||(l.b4w_shadow_cast_only=!1,b("object",l,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in l||(l.b4w_correct_bounding_offset="AUTO",b("object",l,"b4w_correct_bounding_offset"));p=l.particle_systems;for(h=0;h<p.length;h++)r=p[h],q=r.settings,"use_rotation_dupli"in q||(q.use_rotation_dupli=!1,b("object",q,"use_rotation_dupli")),"use_whole_group"in q||(q.use_whole_group=!1,b("object",q,"use_whole_group")),r.transforms||(r.transforms=new Float32Array,b("particle_system",r,"transforms")),"b4w_billboard_align"in
q||(q.b4w_billboard_align="VIEW",b("particle_settings",q,"b4w_billboard_align")),"b4w_dynamic_grass"in q||(q.b4w_dynamic_grass=!1,b("object",q,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in q||(q.b4w_dynamic_grass_scale_threshold=.01,b("object",q,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in q||(q.b4w_initial_rand_rotation=!1,b("particle_settings",q,"b4w_initial_rand_rotation")),"b4w_rotation_type"in q||(q.b4w_rotation_type="Z",b("particle_settings",q,"b4w_rotation_type")),
"b4w_rand_rotation_strength"in q||(q.b4w_rand_rotation_strength=1,b("particle_settings",q,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in q||(q.b4w_hair_billboard=!1,b("particle_settings",q,"b4w_hair_billboard")),"b4w_hair_billboard_type"in q||(q.b4w_hair_billboard_type="BASIC",b("particle_settings",q,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in q||(q.b4w_hair_billboard_jitter_amp=0,b("particle_settings",q,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in
q||(q.b4w_hair_billboard_jitter_freq=0,b("particle_settings",q,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in q||(q.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",q,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in q||(q.b4w_wind_bend_inheritance="PARENT",b("particle_settings",q,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in q||(q.b4w_shadow_inheritance="PARENT",b("particle_settings",q,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in
q||(q.b4w_reflection_inheritance="PARENT",b("particle_settings",q,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in q||(q.b4w_vcol_from_name="",b("particle_settings",q,"b4w_vcol_from_name")),"b4w_vcol_to_name"in q||(q.b4w_vcol_to_name="",b("particle_settings",q,"b4w_vcol_to_name")),"b4w_coordinate_system"in q||(q.b4w_coordinate_system="LOCAL",b("particle_settings",q,"b4w_coordinate_system")),"b4w_allow_nla"in q||(q.b4w_allow_nla=!0,b("particle_settings",q,"b4w_allow_nla"));"constraints"in l||
(l.constraints=[],b("object",l,"constraints"));p=l.modifiers;for(h=0;h<p.length;h++){a:{r=p[h];switch(r.type){case "ARRAY":if(!("fit_type"in r)){n.error("WARNING Incomplete modifier "+String(r.type)+' for "'+l.name+'", reexport "'+a.b4w_filepath_blend+'" scene');r=!1;break a}}r=!0}r||(p.splice(h,1),h--)}"animation_data"in l||(l.animation_data={action:null,nla_tracks:[]},b("object",l,"animation_data"));l.animation_data&&("action"in l.animation_data||(l.animation_data.action=null,n.warn("no action in animation data "+
l.name)),"nla_tracks"in l.animation_data||(l.animation_data.nla_tracks=[],n.warn("no NLA in animation data "+l.name)),d(l.animation_data));"b4w_collision_id"in l||(l.b4w_collision_id="",b("material",l,"b4w_collision_id"));h=l.scale;0==h[0]&&0==h[1]&&0==h[2]?h=!0:(p=Math.abs((h[1]-h[2])/h[1]),h=.001>Math.abs((h[0]-h[1])/h[0])&&.001>p);h||n.warn("non-uniform scale for object "+l.name)}for(var w in z)k=z[w],h=w.match(/.*?(?=>>|$)/i)[0],n.warn("WARNING "+String(h)+" is "+k.ss+" for "+k.type+", reexport "+
a.b4w_filepath_blend)};a.Pv=function(a,b){"num_channels"in a||(a.num_channels=1,n.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.ov=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=h(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=b,n=e,r=0,q=0,m=0,J=new Float32Array(16),e=[],A=1;A<
n.count;A++){n.use_constant_offset&&(r+=n.constant_offset_displace[0],q+=n.constant_offset_displace[1],m+=n.constant_offset_displace[2]);if(n.use_relative_offset)var z=d.b4w_bounding_box,r=r+(z.max_x-z.min_x)*n.relative_offset_displace[0],q=q+(z.max_y-z.min_y)*n.relative_offset_displace[1],m=m+(z.max_z-z.min_z)*n.relative_offset_displace[2];g.kB(r,q,m,J);for(var L=z=h(d),M=J,G=0;G<L.submeshes.length;G++){var D=L.submeshes[G];g.af(D.position,M,D.position,0);g.bC(D.normal,M,D.normal);g.hB(D.tangent,
M,D.tangent)}e.push(z)}for(A=0;A<e.length;A++)for(n=d,r=e[A],q=0;q<n.submeshes.length;q++){m=n.submeshes[q];J=r.submeshes[q];z=m.base_length;L=m.indices.length;m.base_length+=J.base_length;for(var O in m)if("base_length"!=O)if("indices"==O)for(m[O]=g.oB(m[O],J[O]),M=L;M<m.indices.length;M++)m.indices[M]+=z;else"vertex_colors"!=O&&(m[O]=g.zx(m[O],J[O]))}break;case "CURVE":for(var d=b,A=e.object.Uu,n=new Float32Array(16),q=A.Ve?4:3,r=new Float32Array(q),q=new Float32Array(q),m=new Float32Array(3),J=
new Float32Array(4),z=new Float32Array(4),L=new Float32Array(3),M=new Float32Array(3),G=new Float32Array(3),D=new Float32Array(4),Q=new Float32Array(4),Z=0;Z<d.submeshes.length;Z++){var P=d.submeshes[Z],U=P.position,V=P.normal,P=P.tangent,X;a:switch(X=e.deform_axis,X){case "POS_X":case "NEG_X":X=0;break a;case "POS_Y":case "NEG_Y":X=1;break a;case "POS_Z":case "NEG_Z":X=2;break a;default:throw"Wrong deform axis value "+X;}L[0]=0;L[1]=0;L[2]=0;L[X]=1;for(var ia=f.SA(A),R=0;R<U.length/3;R++){G[0]=U[3*
R];G[1]=U[3*R+1];G[2]=U[3*R+2];var u=G[X],pa=f.RA(A,u);f.TA(A,pa,r);m[0]=r[0];m[1]=r[1];m[2]=r[2];f.QA(A,pa,q);M[0]=q[0];M[1]=0;M[2]=q[2];l.normalize(M,M);p.rotationTo(L,M,J);0>u?(r[0]=M[0],r[1]=M[1],r[2]=M[2],l.scale(r,u,r),l.add(m,r,m)):u>ia&&(r[0]=M[0],r[1]=M[1],r[2]=M[2],l.scale(r,u-ia,r),l.add(m,r,m));w.fromRotationTranslation(J,m,n);A.Ve&&(p.setAxisAngle(L,r[3],z),l.transformQuat(G,z,G));G[X]=0;l.transformMat4(G,n,G);U[3*R]=G[0];U[3*R+1]=G[1];U[3*R+2]=G[2];V.length&&(D[0]=V[3*R],D[1]=V[3*R+
1],D[2]=V[3*R+2],D[3]=0,y.transformMat4(D,n,D),V[3*R]=D[0],V[3*R+1]=D[1],V[3*R+2]=D[2]);P.length&&(Q[0]=P[3*R],Q[1]=P[3*R+1],Q[2]=P[3*R+2],Q[3]=0,y.transformMat4(Q,n,Q),P[3*R]=Q[0],P[3*R+1]=Q[1],P[3*R+2]=Q[2])}}}k.Jz(b)}return b};a.fD=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],
specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,
use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.wv=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,e=0;e<d.length;e++){var f=d[e];switch(f.type){case "SELECT":case "SELECT_PLAY":for(var g=0;g<a.length;g++){var h=
a[g];h.name==f.object&&(h.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(g=0;g<a.length;g++)h=a[g],h.name==f.object&&(h.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,m){function c(a){a=Fa.Aa(a);a.ce=null;a.bb=null;a.Ic=null;return a}function d(a,c){var d=[];S.te(a,function(b,c,f){-1<d.indexOf(f)?S.Sz(a,b,c,f,e(f)):d.push(f)});S.T(a,function(b,f){for(var g=0;g<f.la.length;g++){var h=f.la[g];c||"MAIN_PLANE_REFLECT"!=f.type&&"MAIN_CUBE_REFLECT"!=f.type&&"MAIN_XRAY"!=f.type||(h.Bg=!0);-1<d.indexOf(h)?f.la[g]=e(h):d.push(h)}"ANTIALIASING"==f.type&&S.ue(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.la.length;c++){var d=
b.la[c];d.Z=T.r;d.Y=T.r}});c||S.ue(a,b,function(a,b,c){"DEPTH"==c.L&&(c.Bg=!0)})});S.T(a,function(c){var d={};b(a,c,d);for(var e in d){c=d[e];for(var f=c[0],g=0;g<c.length;g++)if(c[g].Z==T.r){f=c[g];break}for(var h=c[0],g=0;g<c.length;g++)if(c[g].Y==T.r){h=c[g];break}for(var K=c[0],g=0;g<c.length;g++)if(!c[g].Bg){K=c[g];break}for(g=0;g<c.length;g++)c[g].Z=f.Z,c[g].Y=h.Y,c[g].Bg=K.Bg}})}function b(a,c,d){S.ue(a,c,function(c,e,f){f.Ma&&f.L==f.ea&&(d[f.L]=d[f.L]||[],-1==d[f.L].indexOf(f)&&d[f.L].push(f),
b(a,c,d))});S.rf(a,c,function(a,b,c){c.Ma&&(d[c.L]=d[c.L]||[],-1==d[c.L].indexOf(c)&&d[c.L].push(c))});c=S.Ua(a,c);if("MOTION_BLUR"==c.type)for(var e=0;e<c.la.length;e++){var f=c.la[e];d[f.L].push(f)}}function e(a){if(a.ra)throw"Failed to clone slink with attached texture";return Fa.Lf(a)}function h(a){var b=S.mo(a),c=[];S.T(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var e=[];break;default:e=c}for(var h=0;h<d.la.length;h++){var K=
d.la[h],k=l(e,K,f(K));K.ra=k;d.Cd[h]=k}for(h=0;h<d.Cd.length;h++)k=d.Cd[h],g(e,k);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":e=[]}S.rf(b,a,function(c,d,g){if(!g.ra){if((c=n(b,a,g.L))&&g.Ma&&!g.ra){d=e;for(var h=c,K=0;K<d.length;K++){var k=d[K];k.io===h&&k.Pi++}}else c=l(e,g,f(g));g.ra=c}});S.ue(b,a,function(a,b,c){g(e,c.ra)});S.rf(b,a,function(a,b,c){c.ra&&"NONE"==c.ea&&g(e,c.ra)})})}function k(a){p(a,function(b,c,d){b.Oh&&(ra(a,
d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ra(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.mf*=Ya.resolution_factor)})}function f(a){a=Fa.Lf(a);delete a.ea;delete a.Ma;delete a.ra;return JSON.stringify(a)}function n(a,b,c){var d=null;S.ue(a,b,function(a,b,e){if(e.Ma&&e.L==e.ea&&e.L==c&&e.ra)return d=e.ra,!0});S.rf(a,b,function(a,b,e){if(e.Ma&&e.L==c&&e.ra)return d=e.ra,!0});return d}function g(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.io===b&&d.Pi&&d.Pi--}}
function l(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.Pi){d=f;break}}if(d)return d.Pi++,d.io;b=y(b);a.push({id:c,Pi:1,io:b});return b}function y(a){var b=a.mf*a.size;switch(a.L){case "COLOR":var c=T.Mj("COLOR",T.Hg);T.resize(c,b,b);T.Pn(c,a.Z,a.Y);return c;case "DEPTH":return a.Bg?(c=T.Mj("DEPTH_RBUF",T.Gg),T.resize(c,b,b)):(c=T.Mj("DEPTH_TEX",T.Vh),T.resize(c,b,b),T.Pn(c,a.Z,a.Y)),c;case "CUBEMAP":return c=T.vw(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.L;}}function p(a,b){var c=!1;S.te(a,function(d,e,f){if(f&&(d=S.Ua(a,d),e=S.Ua(a,e),b(f,!1,d,e)))return c=!0});c||S.T(a,function(a,c){for(var d=0;d<c.la.length;d++)if(b(c.la[d],!0,c,null))return!0})}function w(a){S.T(a,function(b,c){if("SINK"!=c.type){var d=c.h;S.rf(a,b,function(a,b,c){c.Ma&&c.ra&&(oa.Nk(d,c.L,c.ra),c.L==c.ea&&b.h&&oa.Nk(b.h,c.L,c.ra))});for(var e=0;e<c.la.length;e++){var f=c.la[e];f.Ma&&f.L==f.ea&&oa.Nk(d,f.L,c.Cd[e])}!d.bb&&!d.Ic||d.ce||(d.ce=Xa.Rz(d.bb,d.Ic))}})}function z(a){var b=
null,c=0;S.T(a,function(a,d){if(d.type==ta.dB){if(c==ta.cB)return b=d,!0;c++}});return b}function E(a,b){var c=S.sh(a,b),d=r("NONE"),e=S.v(a,d),f=S.Iq(a)[0];S.te(a,function(b,c){c==f&&S.Kz(a,b,f,b,e)});S.te(a,function(e,f,g){if(e==c)return S.l(a,b,d,t(ta.EA,"u_color",g.size,g.mf,g.Oh)),!0});S.gd(a,e,f,t("SCREEN","NONE",.5,.5,!0))}function B(a,b){var c=v("SHADOW_CAST");c.Xl=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.cn){case "SPOT":case "POINT":c.h=oa.jb(oa.Mb);oa.Ok(c.h,
180*b.Zc/Math.PI,.1,2*b.distance);break;default:c.h=oa.jb(oa.Af)}return c}function v(a){return{type:a,Ka:"",Fa:!1,Zr:!1,vl:!1,rk:!1,hi:0,time:0,h:null,gi:null,Zl:[],p:[],la:[],Cd:[],fj:new Float32Array(3),Dt:new Float32Array(3),$b:new Float32Array(3),Yb:new Float32Array(4),lc:new Float32Array(16),Is:0,Oe:0,ig:0,$f:null,bg:null,Zf:null,ag:null,Se:new Float32Array(3),yf:new Float32Array(3),Js:new Float32Array(4),at:new Float32Array([0,0,0]),Uk:new Float32Array(3),bt:new Float32Array(4),Hs:new Float32Array(3),
Gi:0,im:0,zi:!1,$e:new Float32Array(3),vf:0,Xa:null,bl:!1,jf:new Float32Array(2),kf:new Float32Array(2),zh:0,nh:0,Jl:0,bd:null,xf:0,Fg:0,wf:0,If:!1,zp:0,Ap:new Float32Array(2),yp:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Ah:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,Eh:0,
Dh:0,Ch:0,Ts:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,mh:0,Jk:0,Hh:0,Xl:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,st:null,lp:null,mg:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Dl:0,pm:0,ok:0,pk:0,zr:0,Fk:"",Ty:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,jo:new Float32Array(2),A:new Float32Array(2),Ta:!0,enqueue:!0,ba:!0,ha:!0,Cb:!0,ja:!0,se:1}}function t(a,
b,c,d,e){return{L:a,ea:b,size:c,mf:d,Oh:e,Ma:!0,ra:null,Bg:!1,Z:T.Jd,Y:T.Jd}}function x(a,b){for(var c=0,d=ka(a,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=ca(a,f,"SHADOW_CAST").h,b.st=f.fa,b.lp=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.mg=b.mg||[],b.mg[c]=f.qa,c++)}}function I(){var a=v("GRASS_MAP");a.h=oa.jb(oa.Ae);return a}function r(a){var b=v("POSTPROCESSING");b.ba=!1;b.ha=!1;b.Cb=!1;b.h=oa.jb(oa.qb);b.Fk=a;switch(a){case "NONE":b.A[0]=1;b.A[1]=1;break;case "GRAYSCALE":b.A[0]=
1;b.A[1]=1;break;case "X_BLUR":b.A[0]=1;b.A[1]=0;break;case "Y_BLUR":b.A[0]=0;b.A[1]=1;break;case "X_GLOW_BLUR":b.A[0]=1;b.A[1]=0;break;case "Y_GLOW_BLUR":b.A[0]=0;b.A[1]=1;break;case "X_EXTEND":b.A[0]=1;b.A[1]=0;break;case "Y_EXTEND":b.A[0]=0;b.A[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function q(a){var b=v("BLOOM_BLUR");b.ba=!1;b.ha=!1;b.Cb=!1;b.h=oa.jb(oa.qb);b.Fk=a;switch(a){case "X_BLUR":b.A[0]=1;b.A[1]=0;break;case "Y_BLUR":b.A[0]=0;b.A[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+
a;}return b}function C(a,b){var c=v("GLOW_COMBINE");c.ba=!1;c.ha=!1;c.Cb=!1;c.small_glow_mask_coeff=b.Re.small_glow_mask_coeff;c.large_glow_mask_coeff=b.Re.large_glow_mask_coeff;c.small_glow_mask_width=b.Re.small_glow_mask_width;c.large_glow_mask_width=b.Re.large_glow_mask_width;c.A[0]=1;c.A[1]=1;c.h=a;return c}function J(a,b,c,d,e,f,g,h,K){var k=v("MAIN_"+a);if("OPAQUE"===a)k.ba=!0,k.ha=c,k.Fa=!1;else if("BLEND"===a)k.ba=!1,k.ha=!1,k.Fa=!0;else if("XRAY"===a)k.ba=!1,k.ha=!0,k.Fa=!0;else if("PLANE_REFLECT"===
a||"CUBE_REFLECT"===a)k.ba=!0,k.ha=!0,k.Fa=!1;else if("GLOW"===a)k.ba=!0,k.ha=!1,k.Fa=!1;else throw"wrong main subscene type";k.Fa&&h&&(k.self_shadow_normal_offset=h.self_shadow_normal_offset);k.h=b;if(a=g.Tn)k.Js.set([a.Fv,a.Ey,a.jC,a.iC]),k.Hs.set(a.color),k.Is=a.Ba;k.Se.set(g.Se);k.yf.set(g.yf);k.Oe=g.Oe;k.Yb=f;d&&(k.Xa=d,d.Yb&&(k.bd=new Float32Array(d.Yb)),k.xf=d.waves_height,k.Fg=d.waves_length,k.wf=d.wf,d.Ej&&K&&(k.If=!0,k.zp=d.Ej,k.Ap.set(d.Ll),k.yp=d.Kl),d.Qk&&(k.bl=!0,f=d.CA,k.jf[0]=(f[0]+
f[1])/2,k.jf[1]=(f[2]+f[3])/2,k.kf[0]=f[0]-f[1],k.kf[1]=f[2]-f[3],k.zh=d.zh,k.nh=d.nh));k.$f=new Float32Array(3*e);k.bg=new Float32Array(3*e);k.Zf=new Float32Array(3*e);k.ag=new Float32Array(0==e%2?2*e:2*e+2);return k}function A(a,b){var c=v("COLOR_PICKING");b&&(c.type+="_XRAY",c.ba=!1,c.ha=!0);c.enqueue=!1;c.h=a;return c}function N(a){var b=v("WIREFRAME");b.Ta=!1;b.ba=!1;b.ha=!1;b.h=a;return b}function L(a){var b=v("ANCHOR_VISIBILITY");b.ba=!0;b.ha=!1;b.A[0]=1;b.A[1]=1;b.h=a;return b}function M(a,
b){var c=v("DEPTH");c.h=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function G(a){var b=v("DEPTH_PACK");b.ba=!1;b.ha=!1;b.h=a;return b}function D(a,b,c){var d=v("SSAO");d.ba=!1;d.ha=!1;d.Cb=!1;d.h=a;d.A[0]=1;d.A[1]=1;d.Yb=b;d.bd=new Float32Array(b);d.Eh=c.radius_increase;d.ssao_hemisphere=c.Dy;d.Dh=c.influence;d.Ch=c.dist_factor;d.Ts=c.Zz;return d}function O(a,b){var c=v("SSAO_BLUR");c.ba=!1;c.ha=!1;c.Cb=!1;c.A[0]=1;c.A[1]=1;c.h=a;c.ssao_blur_depth=b.Hv;c.ssao_blur_discard_value=
b.qp;return c}function Q(){var a=v("ANTIALIASING");a.ba=!1;a.ha=!1;a.Cb=!1;a.se=1/Ya.resolution_factor;a.A[0]=1;a.A[1]=1;a.h=oa.jb(oa.qb);return a}function Z(a){var b=v(a);b.ba="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ha=!1;b.Cb=!1;b.se=1/Ya.resolution_factor;b.A[0]=1;b.A[1]=1;b.h=oa.jb(oa.qb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.Uy=new Float32Array(4));return b}function P(a,b,c,d){var e=v("COMPOSITING");e.ba=!1;e.ha=!1;e.Cb=!1;e.A[0]=1;e.A[1]=1;e.h=oa.jb(oa.qb);
e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function U(a,b){var c=v("MOTION_BLUR");c.ba=!1;c.ha=!1;c.Cb=!1;c.h=oa.jb(oa.qb);c.vl=!0;c.ok=a;c.pk=b;return c}function V(a){var b=v("DOF");b.ba=!1;b.ha=!1;b.Cb=!1;b.A[0]=1;b.A[1]=1;b.h=a;b.se=b.h.dof_power;return b}function X(a){var b=v("OUTLINE_MASK");b.Cb=!1;b.A[0]=1;b.A[1]=1;b.h=a;return b}function ia(a){var b=v("OUTLINE");b.$e.set(a.$e);b.Gi=a.Gi;b.pm=5;b.Dl=3;b.Cb=!1;b.h=oa.jb(oa.qb);return b}function R(){var a=v("REFRACT");a.ba=
!1;a.ha=!1;a.Cb=!1;a.h=oa.jb(oa.qb);return a}function u(a,b,c,d,e,f,g){var h=v("GOD_RAYS");h.ba=!1;h.ha=!1;h.Cb=!1;h.Se=[1,1,1];h.yf=[1,1,1];h.Oe=1;h.Zr=d;h.vf=b;h.Jk=e;h.mh=c;h.Hh=g;h.h=a;h.ig=f;h.$f=new Float32Array(3*f);h.bg=new Float32Array(3*f);h.Zf=new Float32Array(3*f);h.A[0]=1;h.A[1]=1;h.ag=new Float32Array(0==f%2?2*f:2*f+2);return h}function pa(a,b){var c=v("GOD_RAYS_COMBINE");c.ba=!1;c.ha=!1;c.Cb=!1;c.h=oa.jb(oa.qb);c.god_rays_intensity=a;c.ig=b;c.$f=new Float32Array(3*b);c.bg=new Float32Array(3*
b);c.Zf=new Float32Array(3*b);c.A[0]=1;c.A[1]=1;c.ag=new Float32Array(0==b%2?2*b:2*b+2);return c}function ha(a,b){var c=v("SKY");c.enqueue=!1;c.ba=!1;c.ha=!1;c.Cb=!1;var d=oa.jb(oa.qb);d.width=Na.Ie;d.height=Na.Ie;c.h=d;c.gi=Fa.Lx();c.ig=a;c.$f=new Float32Array(3*a);c.bg=new Float32Array(3*a);c.Zf=new Float32Array(3*a);c.ag=new Float32Array(0==a%2?2*a:2*a+2);c.Se=[1,1,1];c.yf=[1,1,1];c.Oe=1;c.Ah.set(b.Ah);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;
c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;c.A[0]=1;c.A[1]=1;return c}function ea(){var a=v("COPY");a.ba=!1;a.ha=!1;a.h=oa.jb(oa.qb);return a}function Y(){var a=v("ANAGLYPH");a.ba=!1;
a.ha=!1;a.h=oa.jb(oa.qb);return a}function na(){var a=v("LUMINANCE");a.ba=!1;a.ha=!1;a.A[0]=1;a.A[1]=1;a.h=oa.jb(oa.qb);return a}function H(){var a=v("AVERAGE_LUMINANCE");a.ba=!1;a.ha=!1;a.A[0]=1;a.A[1]=1;a.h=oa.jb(oa.qb);return a}function W(a,b,c,d){var e=v("LUMINANCE_TRUNCED");e.ba=!1;e.ha=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.A[0]=1;e.A[1]=1;e.h=d;e.$f=new Float32Array(3*c);e.bg=new Float32Array(3*c);e.Zf=new Float32Array(3*c);e.ag=new Float32Array(0==c%2?2*c:2*c+2);return e}function ba(a){var b=
v("BLOOM");b.ba=!1;b.ha=!1;b.A[0]=1;b.A[1]=1;b.h=oa.jb(oa.qb);b.bloom_blur=a;return b}function xa(){var a=v("SINK");a.enqueue=!1;return a}function ra(a,b,c){if(b.type===c)return!0;b=K(a,b);for(var d=0;d<b.length;d++)if(ra(a,b[d],c))return!0;return!1}function ja(a,b,c){if(b.type===c)return!0;b=ka(a,b);for(var d=0;d<b.length;d++)if(ja(a,b[d],c))return!0;return!1}function ca(a,b,c){if(b.type===c)return b;b=ka(a,b);for(var d=0;d<b.length;d++){var e=ca(a,b[d],c);if(e)return e}return null}function ka(a,
b){var c=S.sh(a,b);if(c==S.Mo)throw"Subscene not in graph";for(var d=[],e=S.Zq(a,c),f=0;f<e;f++){var g=S.Xj(a,c,f);g!=c&&d.push(S.Ua(a,g))}return d}function K(a,b){var c=S.sh(a,b);if(c==S.Mo)throw"Subscene not in graph";for(var d=[],e=S.uh(a,c),f=0;f<e;f++){var g=S.bh(a,c,f);g!=c&&d.push(S.Ua(a,g))}return d}function ga(a){var b=[],c=[];p(a,function(a){a.ra&&-1==b.indexOf(a.ra)&&(b.push(a.ra),c.push(a.ra,b.length-1))});return c}function sa(a,b){var c;c=""+(a.L+"\\n");c+="NONE"!=a.ea?a.ea+"\\n":"";
c+="(";if(a.Oh){var d=a.mf;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.L){c+=" ";if(a.Bg)c+="RR";else{var d=a.Z,e=a.Y,f="";d==T.r?f+="L":d==T.Jd&&(f+="N");e==T.r?f+="L":e==T.Jd&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.ra&&(c+=" "+b[d+1])}return c+")\\n"}var oa=m("__camera"),Ca=m("__config"),Ha=m("__debug"),S=m("__graph"),Xa=m("__renderer"),T=m("__textures"),Fa=m("__util");m("vec4");var ta=Ca.dm,Ya=Ca.o,Na=Ca.Vi;a.Zv=function(a){switch(a.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;
default:return!0}};a.nB=p;a.Gw=function(a,b,e){function f(d,e){var h=c(va[e]);b.G.push(h);h=J(d,h,!1,Pa,Xa,Aa,Ka,Ga,a.xg);l.push(h);S.v(g,h);S.l(g,K[e],h,p[e]);"XRAY"==d?h.la.push(t("DEPTH","DEPTH",1,1,!0)):S.l(g,K[e],h,ca[e]);ab&&(S.l(g,ab,h,Pb),S.l(g,ab,h,Qb));if(Db){for(var k=0;k<v.length;k++)S.l(g,v[k],h,ja[k]);var k=ga[e],n=t("COLOR","u_scene_depth",1,1,!0);n.Z=T.Jd;n.Y=T.Jd;S.l(g,k,h,n)}if(ka.length)for(n=ka.length/va.length,k=0;k<n;k++){var H=n*e+k;S.l(g,ka[H],h,y[H])}if(Ca.length)for(k=0;k<
Ca.length;k++)S.l(g,Ca[k],h,ra[k]);sa.length&&S.l(g,sa[e],h,m[e]);return h}var g=S.create(),K=[],l=[],ga=[],n=[],p=[],ca=[],ka=[],y=[],sa=[],m=[],v=[],ja=[],Ca=[],ra=[],Xa=a.mr,Pa=a.Xa,Rb=a.Ln,Eb=a.nf,xc=a.dh,fc=a.dz,ob=a.xb,pc=a.Mg,yc=a.ph,mb=a.Qg,Fb=a.antialiasing,Ka=a.Go,Aa=a.Yb,Ga=a.wd,xb=a.hz,ib=a.Gv,Sb=a.Ov,Gb=a.xy,Hb=a.vz,yb=a.Ug,Db=a.ex,Ra=Boolean(e.length),va=[];if(a.anaglyph_use&&!Ra){var pb=b.G[0],Tb=c(pb);oa.wr(pb,oa.rb);oa.wr(Tb,oa.Ab);va.push(pb,Tb);b.G.push(Tb)}else{var qa=b.G[0];va.push(qa)}if(Rb){oa.qo(va[0],
Ga);for(var rb=Ga.csm_num,aa=0;aa<rb;aa++){var zb=B(aa,Ga);S.v(g,zb);v.push(zb);var $a=Ga.csm_resolution,qa=zb.h;qa.width=$a;qa.height=$a;zb.ba=!1;ja.push(t("DEPTH","u_shadow_map"+aa,$a,1,!1));(Ha.Uv()||Ya.kq)&&zb.la.push(t("COLOR","COLOR",$a,1,!1))}}if(ob&&ob.Fr&&!Ra)for(aa=0;aa<ob.Fr;aa++){qa=oa.jb(oa.Mb);qa.width=Na.Ie;qa.height=Na.Ie;oa.Ok(qa,90,.1,100);oa.ff(qa,qa.va);var Ba=J("CUBE_REFLECT",qa,!1,Pa,Xa,Aa,Ka,null,a.xg);Ba.gi=Fa.Px();for(var ya=0;6>ya;ya++)Ba.Zl.push(oa.yw());S.v(g,Ba);var sb=
t("CUBEMAP","u_cube_reflection",Na.Ie,1,!1);sb.Z=T.r;sb.Y=T.r;var $b=t("DEPTH","DEPTH",Na.Ie,1,!1);ra.push(sb);Ba.la.push($b);Ca.push(Ba);ob.Nj.push(Ba)}if(ob&&0<ob.Kk.length&&!Ra)for(aa=0;aa<va.length;aa++)for(ya=0;ya<ob.Kk.length;ya++)qa=c(va[aa]),qa.dc=new Float32Array(4),b.G.push(qa),Ba=J("PLANE_REFLECT",qa,!1,Pa,Xa,Aa,Ka,null,a.xg),S.v(g,Ba),sb=t("COLOR","u_plane_reflection",1,Ya.Qi,!0),sb.Z=T.r,sb.Y=T.r,$b=t("DEPTH","DEPTH",1,Ya.Qi,!0),y.push(sb),Ba.la.push($b),ka.push(Ba),ob.Li.push(Ba);K=
[];l=[];if(a.lb){var ab=I();S.v(g,ab);$a=Na.Yj;ab.h.width=$a;ab.h.height=$a;var Pb=t("DEPTH","u_grass_map_depth",$a,1,!1);Pb.Z=T.r;Pb.Y=T.r;var Qb=t("COLOR","u_grass_map_color",$a,1,!1);Qb.Z=T.r;Qb.Y=T.r}else Qb=Pb=ab=null;for(var Ub=[],zc=[],Vb=[],nb=[],aa=0;aa<va.length;aa++){var qa=va[aa],bb={};ca.push(t("DEPTH","DEPTH",1,1,!0));if(Db){var mc=c(qa);b.G.push(mc);bb=M(mc,Ga);S.v(g,bb);if(Rb){Vb.push(bb);for(ya=0;ya<v.length;ya++)zb=v[ya],S.l(g,zb,bb,ja[ya]);var Kb=t("COLOR","u_color",1,1,!0),F=t("DEPTH",
"u_depth",1,1,!0);if(Eb){var gc=c(qa);b.G.push(gc);var qb=a.VA,Ib=D(gc,Aa,qb);S.v(g,Ib);var Lb=t("COLOR","u_ssao_mask",1,1,!0);S.l(g,bb,Ib,Kb);S.l(g,bb,Ib,F);var da=c(qa);b.G.push(da);var gb=O(da,qb);S.v(g,gb);var Oa=t("COLOR","u_shadow_mask",1,1,!0);S.l(g,Ib,gb,Lb);S.l(g,bb,gb,F)}var Ab=c(mc);b.G.push(Ab);var ua=G(Ab);S.v(g,ua);S.l(g,bb,ua,t("DEPTH","u_depth",1,1,!0));ga.push(ua)}else ga.push(bb);ab&&(S.l(g,ab,bb,Pb),S.l(g,ab,bb,Qb))}Ba=J("OPAQUE",qa,!Db,Pa,Xa,Aa,Ka,null,a.xg);S.v(g,Ba);l.push(Ba);
zc.push(Ba);Db&&(S.l(g,bb,Ba,ca[aa]),Lb?S.l(g,gb,Ba,Oa):Rb&&S.l(g,bb,Ba,t("COLOR","u_shadow_mask",1,1,!0)));var Wb=t("COLOR","u_color",1,1,!0);p.push(t("COLOR","COLOR",1,1,!0));ab&&(S.l(g,ab,Ba,Pb),S.l(g,ab,Ba,Qb));if(ka.length)for(var tb=ka.length/va.length,ya=0;ya<tb;ya++){var ad=tb*aa+ya;S.l(g,ka[ad],Ba,y[ad])}if(Ca.length)for(ya=0;ya<Ca.length;ya++)S.l(g,Ca[ya],Ba,ra[ya])}K=l;l=[];if(!Ra&&a.fw){qa=c(K[0].h);b.G.push(qa);var Sa=A(qa,!1);S.v(g,Sa);if(a.we){qa=c(K[0].h);b.G.push(qa);var qc=A(qa,
!0);S.v(g,qc);S.l(g,Sa,qc,t("COLOR","COLOR",1,1,!0));S.l(g,Sa,qc,t("DEPTH","DEPTH",1,1,!0))}}else Sa=null;if(fc.td&&!Ra)for(aa=0;aa<va.length;aa++){var Ac=R();S.v(g,Ac);S.l(g,K[aa],Ac,Wb);sa.push(Ac);m.push(t("COLOR","u_refractmap",1,1,!0))}if(a.Jm){for(aa=0;aa<va.length;aa++)Ba=f("BLEND",aa),Ub.push(Ba);K=l;l=[]}if(a.Qe){for(aa=0;aa<va.length;aa++){var Jc=c(va[aa]);b.G.push(Jc);var nc=J("GLOW",Jc,!1,Pa,Xa,Aa,Ka);S.v(g,nc);S.l(g,zc[aa],nc,ca[aa]);var Mb=r("X_GLOW_BLUR");Mb.Ka="GLOW_MASK_SMALL";Mb.se=
a.Re.small_glow_mask_width;var Ta=t("COLOR","u_color",1,1,!0);Ta.Z=T.r;Ta.Y=T.r;S.v(g,Mb);S.l(g,nc,Mb,Ta);var Ia=r("Y_GLOW_BLUR");Ia.Ka="GLOW_MASK_SMALL";Ia.se=a.Re.small_glow_mask_width;var bd=t("COLOR","u_color",1,.5,!0);bd.Z=T.r;bd.Y=T.r;S.v(g,Ia);S.l(g,Mb,Ia,bd);var Kc=r("X_GLOW_BLUR");Kc.Ka="GLOW_MASK_LARGE";Kc.se=a.Re.large_glow_mask_width;var cd=t("COLOR","u_color",1,.5,!0);cd.Z=T.r;cd.Y=T.r;S.v(g,Kc);S.l(g,Ia,Kc,cd);var dd=r("Y_GLOW_BLUR");dd.Ka="GLOW_MASK_LARGE";dd.se=a.Re.large_glow_mask_width;
var ac=t("COLOR","u_color",1,.25,!0);ac.Z=T.r;ac.Y=T.r;S.v(g,dd);S.l(g,Kc,dd,ac);var ed=c(va[aa]);b.G.push(ed);var oc=C(ed,a);S.v(g,oc);a.Jm?S.l(g,Ub[aa],oc,t("COLOR","u_src_color",1,1,!0)):S.l(g,zc[aa],oc,t("COLOR","u_src_color",1,1,!0));var nd=t("COLOR","u_glow_mask_small",1,.5,!0);nd.Z=T.r;nd.Y=T.r;S.l(g,Ia,oc,nd);var hc=t("COLOR","u_glow_mask_large",1,.25,!0);hc.Z=T.r;hc.Y=T.r;S.l(g,dd,oc,hc);n.push(oc)}K=n;l=[]}if(!a.Jm){for(aa=0;aa<va.length;aa++)Ba=f("BLEND",aa),Ub.push(Ba);K=l;l=[]}if(a.we){for(aa=
0;aa<va.length;aa++){var Bc=f("XRAY",aa);nb.push(Bc)}K=l;l=[]}if(Ya.wireframe_debug){for(aa=0;aa<va.length;aa++){qa=Fa.Aa(va[aa]);b.G.push(qa);var ic=N(qa);l.push(ic);S.v(g,ic);S.l(g,K[aa],ic,p[aa]);S.l(g,K[aa],ic,ca[aa]);ab&&(S.l(g,ab,ic,Pb),S.l(g,ab,ic,Qb))}K=l;l=[]}if(!Ra&&a.Wu){qa=Fa.Aa(va[0]);b.G.push(qa);var Xb=L(qa);S.v(g,Xb);S.l(g,K[0],Xb,ca[0])}if(xc&&Db&&!Ra){for(aa=0;aa<va.length;aa++){var ub=Gb.mh,fd=Gb.Jy,rc=Gb.Hh,cb=K[aa],bc=Pa?1:0,Lc=t("DEPTH","u_input",1,1,!0);Lc.Z=T.r;Lc.Y=T.r;var Cc=
t("COLOR","u_input",1,.25,!0);Cc.Z=T.r;Cc.Y=T.r;var Yb=ub/rc,Dc=c(va[aa]);b.G.push(Dc);var Mc=u(Dc,bc,ub,!0,Yb,Xa,rc);S.v(g,Mc);S.l(g,cb,Mc,Lc);var Yb=ub/rc*.5,Jb=c(va[aa]);b.G.push(Jb);var gd=u(Jb,bc,ub,!1,Yb,Xa,rc);S.v(g,gd);S.l(g,Mc,gd,Cc);var Yb=ub/rc*.25,hd=c(va[aa]);b.G.push(hd);var rd=u(hd,bc,ub,!1,Yb,Xa,rc);S.v(g,rd);S.l(g,gd,rd,Cc);var Ec=pa(fd,Xa);l.push(Ec);S.v(g,Ec);S.l(g,cb,Ec,t("COLOR","u_main",1,1,!0));S.l(g,rd,Ec,t("COLOR","u_god_rays",1,1,!0))}K=l;l=[]}if(pc&&!Ra){for(aa=0;aa<va.length;aa++){var cb=
K[aa],Nc=na();S.v(g,Nc);S.l(g,cb,Nc,t("COLOR","u_input",1,1,!0));var Oc=H();S.v(g,Oc);Oc.h.width=1;Oc.h.height=1;var Nb=t("COLOR","u_input",1,.25,!0);Nb.Z=T.r;Nb.Y=T.r;var od=t("COLOR","u_luminance",1,.25,!0);od.Z=T.r;od.Y=T.r;S.l(g,Nc,Oc,Nb);var ud=ib.key,sd=ib.jx,pd=c(va[aa]);b.G.push(pd);var db=W(ud,sd,Xa,pd);S.v(g,db);S.l(g,cb,db,t("COLOR","u_main",1,1,!0));S.l(g,Nc,db,od);S.l(g,Oc,db,t("COLOR","u_average_lum",1,1,!1));var Zb=t("COLOR","u_color",1,.25,!0);Zb.Z=T.r;Zb.Y=T.r;Mb=q("X_BLUR");S.v(g,
Mb);S.l(g,db,Mb,Zb);Ia=q("Y_BLUR");S.v(g,Ia);S.l(g,Mb,Ia,Zb);var Tc=ba(ib.blur);S.v(g,Tc);var Uc=t("COLOR","u_bloom",1,.25,!0);Uc.Z=T.r;Uc.Y=T.r;S.l(g,Ia,Tc,Uc);S.l(g,cb,Tc,t("COLOR","u_main",1,1,!0));l.push(Tc)}K=l;l=[]}if(yc&&!Ra){for(aa=0;aa<K.length;aa++){var vd=K[aa],Vc=U(xb.ok,xb.pk);l.push(Vc);S.v(g,Vc);S.l(g,vd,Vc,t("COLOR","u_mb_tex_curr",1,1,!0));Vc.la.push(t("COLOR","u_mb_tex_accum",1,1,!0))}K=l;l=[]}if(yb&&Db&&!Ra){for(aa=0;aa<K.length;aa++){var cb=K[aa],sc=c(va[aa]);b.G.push(sc);Zb=t("COLOR",
"u_color",1,1,!0);Zb.Z=T.r;Zb.Y=T.r;var tc=r("X_BLUR");S.v(g,tc);S.l(g,cb,tc,Zb);var uc=r("Y_BLUR");S.v(g,uc);S.l(g,tc,uc,Zb);var bb=Ub[aa],Wc=V(sc);sc.dof_distance=b.dof_distance;sc.Zd=b.Zd;sc.dof_front=b.dof_front;sc.dof_rear=b.dof_rear;sc.dof_power=b.dof_power;sc.dof_on=1;l.push(Wc);S.v(g,Wc);S.l(g,cb,Wc,t("COLOR","u_sharp",1,1,!0));S.l(g,uc,Wc,t("COLOR","u_blurred",1,1,!0));S.l(g,bb,Wc,t("DEPTH","u_depth",1,1,!0))}K=l;l=[]}if(!Ra&&a.outline){for(aa=0;aa<va.length;aa++){var cb=K[aa],Xc=c(va[aa]);
b.G.push(Xc);var id=X(Xc);S.v(g,id);var Fc=r("X_EXTEND"),Pc=t("COLOR","u_color",1,1,!0),Yc=t("COLOR","u_outline_mask",1,1,!0);Fc.zi=!0;S.v(g,Fc);S.l(g,id,Fc,Pc);var Bb=t("COLOR","u_color",1,.5,!0);Bb.Z=T.r;Bb.Y=T.r;var Gc=r("Y_EXTEND");Gc.zi=!0;S.v(g,Gc);S.l(g,Fc,Gc,Bb);tc=r("X_BLUR");tc.zi=!0;S.v(g,tc);S.l(g,Gc,tc,Bb);var jd=t("COLOR","u_color",1,.25,!0);jd.Z=T.r;jd.Y=T.r;var cc=t("COLOR","u_outline_mask_blurred",1,.25,!0);cc.Z=T.r;cc.Y=T.r;uc=r("Y_BLUR");uc.zi=!0;S.v(g,uc);S.l(g,tc,uc,jd);var Zc=
ia(Hb);S.v(g,Zc);S.l(g,cb,Zc,t("COLOR","u_outline_src",1,1,!0));S.l(g,id,Zc,Yc);S.l(g,uc,Zc,cc);l.push(Zc)}K=l;l=[]}if(mb&&!Ra){for(aa=0;aa<K.length;aa++){var cb=K[aa],Qc=P(Sb.brightness,Sb.contrast,Sb.exposure,Sb.saturation);S.v(g,Qc);S.l(g,cb,Qc,t("COLOR","u_color",1,1,!0));l.push(Qc)}K=l;l=[]}if(Fb){for(aa=0;aa<K.length;aa++)if(cb=K[aa],Ya.smaa){var dc=t("COLOR","u_color",1,1,!0);dc.Z=T.r;dc.Y=T.r;var vc=Z("SMAA_EDGE_DETECTION");S.v(g,vc);S.l(g,cb,vc,dc);var Rc=Z("SMAA_BLENDING_WEIGHT_CALCULATION");
S.v(g,Rc);S.l(g,vc,Rc,dc);var ma=t("COLOR","u_search_tex",1,1,!1),Ua=t("COLOR","u_area_tex",1,1,!1);ma.Z=T.r;ma.Y=T.r;Ua.Z=T.r;Ua.Y=T.r;Rc.la.push(ma);Rc.la.push(Ua);var kd=Z("SMAA_NEIGHBORHOOD_BLENDING");S.v(g,kd);S.l(g,cb,kd,dc);var wc=t("COLOR","u_blend",1,1,!0);wc.Z=T.r;wc.Y=T.r;S.l(g,Rc,kd,wc);l.push(kd)}else{var La=Q();S.v(g,La);var Wa=t("COLOR","u_color",1,1,!0);Wa.Z=T.r;Wa.Y=T.r;S.l(g,cb,La,Wa);if(1<Ya.resolution_factor){var qd=r("NONE");S.v(g,qd);S.l(g,La,qd,Wa);l.push(qd)}else l.push(La)}K=
l;l=[]}if(a.anaglyph_use&&!Ra){var jb=Y();S.v(g,jb);S.l(g,K[0],jb,t("COLOR","u_sampler_left",1,1,!0));S.l(g,K[1],jb,t("COLOR","u_sampler_right",1,1,!0));l.push(jb)}else l.push(K[0]);var ld=S.sh(g,K[0]),Hc=!1;S.ue(g,ld,function(a,b,c){if(c.L==c.ea)return Hc=!0});if(Hc){var jc=ea();S.v(g,jc);S.l(g,K[0],jc,t("COLOR","u_color",1,1,!0));K=l;l=[];l.push(jc)}Sa&&(qc?l.push(qc):l.push(Sa));Xb&&l.push(Xb);if(!Ra&&a.Sk.procedural_skydome){var Ic=ha(Xa,a.Sk);S.v(g,Ic);l.push(Ic)}var ec=xa();S.v(g,ec);for(aa=
0;aa<l.length;aa++){var kc=l[aa];switch(kc.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":S.l(g,kc,ec,t("COLOR","NONE",1,1,!0));S.l(g,kc,ec,t("DEPTH","NONE",1,1,!0));break;case "SKY":S.l(g,kc,ec,t("CUBEMAP","u_sky",Na.Ie,1,!1));break;case "ANCHOR_VISIBILITY":S.l(g,kc,ec,t("COLOR","NONE",1,1,!0));break;default:if(Ra){var td=e[0].d,Sc=t("COLOR","OFFSCREEN",1,1,!0);Sc.ra=td;S.l(g,l[aa],ec,Sc);for(ya=1;ya<e.length;ya++){var lc=e[ya].d,jc=ea();S.v(g,jc);S.l(g,l[aa],jc,t("COLOR","u_color",1,1,!0));
Sc=t("COLOR","OFFSCREEN",1,lc.vg/td.vg,!0);Sc.ra=lc;S.l(g,jc,ec,Sc)}}else S.l(g,l[aa],ec,t("SCREEN","NONE",1,1,!0))}}if(ta.enabled){var $c=z(g);$c&&E(g,$c)}d(g,Db);1<Ya.resolution_factor&&k(g);h(g);w(g);for(aa=0;aa<Vb.length;aa++)x(g,Vb[aa]);for(aa=0;aa<Ub.length;aa++)x(g,Ub[aa]);for(aa=0;aa<nb.length;aa++)x(g,nb[aa]);return g};a.WD=v;a.xc=function(a,b,c){var d=a.se;a.jo[0]=b*a.A[0]*d;a.jo[1]=c*a.A[1]*d};a.Ib=function(a,b){a.se=b};a.sD=function(a){var b=null;S.T(a,function(a,c){return c.h&&null===
c.h.ce?(b=c,!0):!1});return b};a.Ga=function(a,b,c){a=ka(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.OD=ra;a.Cy=ja;a.Cq=ka;a.KD=K;a.Ca=function(a,b){var c=null;S.T(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Vw=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ga(a);S.T(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==
d.type&&(f+=" ("+d.Fk.replace(/_/g," ")+")");if(d.h){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.h.bb&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.h.Ic&&(f+="D"+c[g+1])}d.la.length&&(f+="\\n-----\\n");for(g=0;g<d.la.length;g++)f+=sa(d.la[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});S.te(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+sa(e,c)+'" style="'+(e.Ma?"solid":"dotted")+
'"];\n'});return b+="}"};a.Hw=function(a){a=S.jB(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,m){function c(){return{name:"",type:0,source:"",width:0,height:0,Tl:1,sj:!0,vg:1024,cq:!1,Sd:null,La:null,wh:null,xs:1,pe:0,xh:!1,dl:!1,Yf:!1,J:0,oa:0,Yg:0,NB:!1,zg:!1,un:0,Zb:0,Lb:0,Ra:null,uf:null}}function d(d,e,f,g){var h=d.type,k=new Uint8Array([204,204,204,255]),l=c();switch(h){case "DATA_TEX2D":case "IMAGE":var n=q.createTexture(),p=q.TEXTURE_2D;q.bindTexture(p,n);q.texImage2D(p,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,k);d.image&&"MOVIE"==d.image.source&&(l.Yf=
!0,l.J=d.frame_start,l.oa=d.frame_offset,l.Yg=d.frame_duration,l.NB=d.use_auto_refresh,l.zg=d.use_cyclic,l.un=d.movie_length,0!=l.oa&&w.warn('Frame offset for texture "'+d.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":n=q.createTexture();p=q.TEXTURE_2D;q.bindTexture(p,n);if("NONE"==d.b4w_source_type)return null;if("SCENE"==d.b4w_source_type)if(d.b4w_source_id&&(f=B.keysearch("name",d.b4w_source_id,f)))l.vg=d.b4w_source_size,f.fd=f.fd||[],f.fd.push(d),
q.texImage2D(p,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":n=q.createTexture();p=q.TEXTURE_CUBE_MAP;q.bindTexture(p,n);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var t=0;6>t;t++)v.Vm?q.texImage2D(q["TEXTURE_CUBE_MAP_"+f[t]],0,q.RGB,1,1,0,q.RGB,q.UNSIGNED_BYTE,k):q.texImage2D(q["TEXTURE_CUBE_MAP_"+f[t]],0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,k);break;case "VORONOI":case "BLEND":return null;default:return w.error('texture "'+
d.name+'" has unsupported type "'+h+'"'),null}("NONE"!=h||d.b4w_enable_canvas_mipmapping&&"CANVAS"==d.b4w_source_type)&&"DATA_TEX2D"!=h?v.Vm&&"ENVIRONMENT_MAP"==h?q.texParameteri(p,q.TEXTURE_MIN_FILTER,q.LINEAR):q.texParameteri(p,q.TEXTURE_MIN_FILTER,C[v.Vk]):q.texParameteri(p,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(p,q.TEXTURE_MAG_FILTER,q.LINEAR);k=p;f=d.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=e);"OFF"!==f&&v.tj&&(e=E.Xx())&&(f=parseFloat(f.split("x")[0]),q.texParameterf(k,e.TEXTURE_MAX_ANISOTROPY_EXT,
f));"REPEAT"!=d.extension||d.b4w_shore_dist_map?(q.texParameteri(p,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(p,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE)):(q.texParameteri(p,q.TEXTURE_WRAP_S,q.REPEAT),q.texParameteri(p,q.TEXTURE_WRAP_T,q.REPEAT));l.type=a.Hg;l.width=1;l.height=1;l.Ra=n;l.Lb=p;"CANVAS"==d.b4w_source_type&&"NONE"==h?(h=d.b4w_source_id,n=d.b4w_source_size,l.cq=d.b4w_enable_canvas_mipmapping,l.name=h,l.source="CANVAS",p=document.createElement("canvas"),p.width=n,p.height=n,l.Sd=p.getContext("2d"),
g in I||(I[g]={}),I[g][h]=l,b(l)):"SCENE"==d.b4w_source_type&&"NONE"==h?(l.name=d.b4w_source_id,l.source="SCENE"):(l.name=d.name,l.source=h,q.generateMipmap(p),q.bindTexture(p,null));return d.d=l}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Lb;q.bindTexture(b,a.Ra);var c=f(a),d=n(a),e=a.Sd.canvas;q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(b,0,c,c,d,e);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!1);a.cq&&q.generateMipmap(b);q.bindTexture(b,null);a.width=e.width;a.height=e.height}
function e(a){var b=a.Lb;q.bindTexture(b,a.Ra);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(b,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.wh[a.pe]);q.bindTexture(b,null)}function h(a){q.texParameteri(a,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(a,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.texParameteri(a,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(a,q.TEXTURE_MIN_FILTER,q.LINEAR)}function k(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}
function f(b){switch(b.type){case a.Hg:b=q.RGBA;break;case a.il:b=q.RGB;break;case a.nj:b=q.RGBA;break;case a.oj:b=q.RGB;break;case a.Vh:b=q.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function n(b){switch(b.type){case a.Hg:b=q.UNSIGNED_BYTE;break;case a.il:b=q.UNSIGNED_BYTE;break;case a.nj:b=q.FLOAT;break;case a.oj:b=q.FLOAT;break;case a.Vh:b=q.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function g(a,b){return b in r&&a in r[b]?(v.Oc?r[b][a].xh=!0:r[b][a].La.play(),
!0):null}function l(a,b){if(b in r&&a in r[b]){var c=r[b][a];v.Oc?(c.pe=c.oa,e(c),c.pe++):c.La.currentTime=c.oa/c.Zb;return!0}return null}function y(a,b){return b in r&&a in r[b]?(v.Oc?r[b][a].xh=!1:r[b][a].La.pause(),!0):null}var p=m("__config"),w=m("__print"),z=m("__dds"),E=m("__extensions"),B=m("__util"),v=p.o,t=p.Od,x=p.Yc;a.Jd=0;a.r=0;a.Mu=0;a.Ku=0;a.Lu=0;a.Ju=0;a.Hg=10;a.il=20;a.nj=30;a.oj=40;a.Vh=50;a.Gg=60;var I={},r={},q=null,C;a.Xc=function(b){C=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,
b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.Jd=b.NEAREST;a.r=b.LINEAR;a.Mu=b.NEAREST_MIPMAP_NEAREST;a.Ku=b.LINEAR_MIPMAP_NEAREST;a.Lu=b.NEAREST_MIPMAP_LINEAR;a.Ju=b.LINEAR_MIPMAP_LINEAR;q=b};a.ay=function(a,b){return b in I&&a in I[b]?I[b][a].Sd:null};a.yB=function(a,c){return c in I&&a in I[c]?(b(I[c][a]),!0):!1};a.Mj=function(b,d){var e=c();e.name=b;e.type=d;e.source="NONE";if(d==a.Gg)e.uf=q.createRenderbuffer();else{var f=q.TEXTURE_2D,g=q.createTexture();q.bindTexture(f,g);q.texParameteri(f,
q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(f,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(f,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(f,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.bindTexture(f,null);e.Lb=f;e.Ra=g}return e};a.vw=function(b){var d=q.createTexture(),e=q.TEXTURE_CUBE_MAP;q.bindTexture(e,d);q.texParameteri(e,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(e,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(e,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(e,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);
for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)q.texImage2D(q[f[g]],0,q.RGBA,b,b,0,q.RGBA,q.UNSIGNED_BYTE,null);q.bindTexture(e,null);e=c();e.name="CUBEMAP";e.type=a.Hg;e.source="NONE";e.width=3*b;e.height=2*b;e.Tl=1;e.Ra=d;e.Lb=q.TEXTURE_CUBE_MAP;return e};a.Pn=function(b,c,d){if(b.type!=a.Gg){var e=b.Lb;q.bindTexture(e,b.Ra);c&&q.texParameteri(e,
q.TEXTURE_MIN_FILTER,c);d&&q.texParameteri(e,q.TEXTURE_MAG_FILTER,d);q.bindTexture(e,null)}};a.JD=function(b){if(b.type==a.Gg)return{min:a.Jd,$y:a.Jd};var c=b.Lb;q.bindTexture(c,b.Ra);b=q.getTexParameter(c,q.TEXTURE_MIN_FILTER);var d=q.getTexParameter(c,q.TEXTURE_MAG_FILTER);q.bindTexture(c,null);return{min:b,$y:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Gg)q.bindRenderbuffer(q.RENDERBUFFER,b.uf),q.renderbufferStorage(q.RENDERBUFFER,q.DEPTH_COMPONENT16,
c,d),q.bindRenderbuffer(q.RENDERBUFFER,null);else{var e=b.Lb;q.bindTexture(e,b.Ra);var g=f(b),h=n(b);q.texImage2D(e,0,g,c,d,0,g,h,null);q.bindTexture(e,null)}c>v.qd||d>v.qd?w.error('Slink texture "'+b.name+'" has unsupported size'):(b.width=c,b.height=d)}};a.Pw=d;a.KB=function(a){var b=a.Lb;q.bindTexture(b,a.Ra);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);4!=a.La.length?q.texImage2D(b,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.La):q.texImage2D(b,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,a.La);q.bindTexture(b,null)};
a.HB=e;a.$i=function(a,b,c,d,e){var f=a.source,g=a.Lb;q.bindTexture(g,a.Ra);if(4==b.length){var l=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==f)if(l)q.texImage2D(g,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=z.Kq(b);if(c.width>v.qd||c.height>v.qd){w.error("texture has unsupported size",d);return}z.MB(q,E.Gq(),b,!0);k(c.width,c.height)&&(a.kp||w.warn("using NPOT texture",d),h(g));a.width=c.width;a.height=c.height;a.Tl=z.cy(b)}else{q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,
!0);if(b.width>v.qd||b.height>v.qd){w.error("texture has unsupported size",d);return}a.Yf?v.Oc?b&&(e in r||(r[e]={}),r[e][a.name]=a,a.wh=b,a.Zb=a.un/b.length,a.Yg=Math.round(a.Yg/a.Zb),a.oa=Math.round(a.oa/a.Zb),a.J=Math.round(a.J/a.Zb),a.pe=a.oa,q.texImage2D(g,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.wh[0])):(a.La=b,a.La.loop=a.zg,b&&(e in r||(r[e]={}),r[e][a.name]=a),a.Zb=t.Ha,b.duration&&(a.Zb=a.un/b.duration),x.$p||(b.playbackRate=t.Ha/a.Zb,x.Fp&&2<b.playbackRate&&(b.playbackRate=2)),q.texImage2D(g,
0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.La)):q.texImage2D(g,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,b);v.Oc&&a.Yf?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);k(b.width,b.height)?(a.kp||(a.Yf?w.warn("using NPOT video texture",d):w.warn("using NPOT texture",d)),h(g)):a.Yf||q.generateMipmap(g)}else if("ENVIRONMENT_MAP"==f)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],l){for(l=0;6>l;l++)e=c[l],q.texImage2D(q["TEXTURE_CUBE_MAP_"+
e[0]],0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!1);f=b.width/3;if(f>v.pn||f>v.pn){w.error("cubemap has unsupported size",d);return}for(l=0;6>l;l++){e=c[l];var n=document.createElement("canvas");n.width=f;n.height=f;var p=n.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(p.translate(0,f),p.scale(1,-1)):(p.translate(f,0),p.scale(-1,1));p.drawImage(b,e[1]*f,e[2]*f,f,f,0,0,f,f);q.texImage2D(q["TEXTURE_CUBE_MAP_"+e[0]],0,q.RGBA,q.RGBA,
q.UNSIGNED_BYTE,n)}a.width=3*f;a.height=2*f;k(b.width/3,b.height/2)?(w.warn("using NPOT cube map texture",d),h(g)):q.generateMipmap(g)}else"DATA_TEX2D"==f&&(q.texImage2D(g,0,q.RGBA,b.width,b.height,0,q.RGBA,q.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);q.bindTexture(g,null)};a.dx=function(a){q.deleteTexture(a)};a.Ai=function(a){return a&&a.name&&(a.Ra||a.uf)?!0:!1};a.fr=function(a){return a&&a.name&&a.uf?!0:!1};a.aE=function(b){return b.type==a.nj||b.type==a.oj?!0:!1};a.sy=function(b){var c=
0;switch(b.type){case a.Hg:case a.il:c=4;break;case a.nj:case a.oj:c=16;break;case a.Vh:c=3;break;case a.Gg:c=2}return c};a.Tx=function(a){var b=null,b={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};d(b,null,a,0);b.image={filepath:null};return b};a.cleanup=function(){if(!v.Oc)for(var a in r)for(var b in r[a])r[a][b].La.pause(),r[a][b].La.src="",r[a][b].La.load();I={};r={}};a.play_video=g;a.reset_video=l;a.pause_video=y;a.pause=function(){for(var a in r)for(var b in r[a])v.Oc&&
!r[a][b].xh||!v.Oc&&r[a][b].La.paused||(y(b,a),r[a][b].dl=!0)};a.reset=function(){for(var a in r)for(var b in r[a])l(b,a),r[a][b].dl=!1};a.play=function(a){for(var b in r)for(var c in r[b])if(!a||r[b][c].dl)g(c,b),r[b][c].dl=!1}};b4w.module.__assets=function(a,m){function c(){return z.er()?m(z.Tb.Bj).data:null}function d(){var a={pj:null,Tu:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.pj=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.pj in b&&(a.status=200,b[a.pj]&&(a.response=a.Tu(b[a.pj])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,d=0;d<b.length;d++){var l=b[d];20===l.state&&c++;if(c>=I.fz)break;if(10===l.state)switch(l.state=20,c++,l.type){case a.AT_ARRAYBUFFER:e(l,"arraybuffer");break;case a.AT_JSON:e(l,"json");break;case a.AT_TEXT:e(l,"text");break;case a.AT_AUDIOBUFFER:h(l);break;case a.AT_IMAGE_ELEMENT:k(l);
break;case a.AT_AUDIO_ELEMENT:f(l);break;case a.jj:n(l);break;case a.ij:g(l);break;default:v.pa("Wrong asset type: "+l.type)}}}function e(a,b){var e=c(),f=e&&a.q in e?new d:new XMLHttpRequest;f.open("GET",a.q,!0);"text"==b?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==b?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=b;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var c=f.response;if(c){if("json"==b&&
"string"==typeof c)try{c=JSON.parse(c)}catch(d){a.ib(null,a.uri,a.type,a.q,a.ob);E.error(d+" (parsing JSON "+a.q+")");return}a.ib(c,a.uri,a.type,a.q,a.ob)}else a.ib(null,a.uri,a.type,a.q,a.ob),E.error("empty responce when trying to get "+a.q)}else a.ib(null,a.uri,a.type,a.q,a.ob),E.error(f.status+" when trying to get "+a.q);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.ks(b.loaded/b.total)},!1);f.send(null)}function h(a){var b=c(),e=b&&a.q in b?new d:new XMLHttpRequest;
e.open("GET",a.q,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?B.Zw(b,function(b){a.ib(b,a.uri,a.type,a.q,a.ob);a.state=30},function(){a.ib(null,a.uri,a.type,a.q,a.ob);E.error("failed to decode "+a.q);a.state=30}):(a.ib(null,a.uri,a.type,a.q,a.ob),E.error("empty responce when trying to get "+a.q),a.state=30)}else a.ib(null,a.uri,a.type,a.q,a.ob),E.error(e.status+" when trying to get "+a.q),a.state=
30};e.send(null)}function k(a){var b=document.createElement("img");r.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.ib(b,a.uri,a.type,a.q,a.ob),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.ib(null,a.uri,a.type,a.q,a.ob),E.error("could not load image: "+a.q),a.state=30)},!1);var d=c();if(d&&a.q in d)if(d[a.q]){var e=y(a.q);b.src="data:"+e+";base64,"+d[a.q]}else x.Xm()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=
new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.q}function f(a){var b=document.createElement("audio");r.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.ib(b,a.uri,a.type,a.q,a.ob),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.ib(null,a.uri,a.type,a.q,a.ob),E.error("could not load sound: "+a.q),a.state=30)},!1);var d=c();if(d&&a.q in d)if(d[a.q]){var e=p(a.q);b.src="data:"+e+";base64,"+d[a.q];40!=a.state&&(a.ib(b,
a.uri,a.type,a.q,a.ob),a.state=30)}else x.Xm()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.q,r.Xf&&b.load();setTimeout(function(){b.HA=1},5E3)}function n(a){function b(){40!=a.state&&(a.ib(null,a.uri,a.type,a.q),E.error("could not load video: "+a.q,a.ob),a.state=30)}var d=document.createElement("video");d.muted=!0;if(r.allow_cors||r.Xf)d.crossOrigin="Anonymous";d.addEventListener("loadeddata",function(){d.removeEventListener("error",
b,!1);40!=a.state&&(a.ib(d,a.uri,a.type,a.q,a.ob),a.state=30)},!1);d.addEventListener("error",b,!1);var e=c();if(e&&a.q in e)if(e[a.q]){var f=w(a.q);d.src="data:"+f+";base64,"+e[a.q];40!=a.state&&(a.ib(d,a.uri,a.type,a.q,a.ob),a.state=30)}else x.Xm()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),d.dispatchEvent(e);else d.src=a.q,r.Xf&&d.load();setTimeout(function(){d.HA=1},1E4)}function g(a){function b(c){a.ib(c,a.uri,a.type,a.q,a.ob)}var e=
c(),f=e&&a.q in e?new d:new XMLHttpRequest;f.open("GET",a.q,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var c=f.response;c?l(c,b):(a.ib(null,a.uri,a.type,a.q,a.ob),E.error("empty responce when trying to get "+a.q))}else a.ib(null,a.uri,a.type,a.q,a.ob),E.error(f.status+" when trying to get "+a.q);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.ks(b.loaded/b.total)},!1);f.send(null)}function l(a,
b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],pp:[],Zb:c[4]},g=20,h=0;h<e;h++){var k=c[g/4],l=new Blob([d.subarray(g+4,g+4+k)],{type:"image/jpg"}),n=document.createElement("img");n.src=window.URL.createObjectURL(l);f.images.push(n);f.pp.push(l);g+=k+8-k%4}n.onload=function(){for(var a=0;a<f.images.length;a++)window.URL.revokeObjectURL(f.images[a].src);delete f.pp;b(f)}}function y(a){var b="image";switch(v.Fm(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+=
"/png"}return b}function p(a){var b="audio";switch(v.Fm(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function w(a){var b="video";switch(v.Fm(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var z=m("__config"),E=m("__print"),B=m("__sfx"),v=m("__util"),t=m("__version"),x=m("__compat"),I=z.Pd,r=z.o;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=
30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.jj=70;a.ij=80;var q=[],C=0,J={};a.Xi=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.ry=function(a){if(J[a])return J[a];var b=I.hs?a+t.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return J[a]=b;v.pa("Error XHR: responce is empty, GET "+a)}else v.pa("Error XHR: "+
c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<q.length;a++)q[a].state=40;q=[];C=0;J={}};a.enqueue=function(a,d,e,f){for(var g=0;g<a.length;g++){var h=a[g],h={uri:h[0],type:h[1],q:h[2],ob:h[3],state:10,ib:d||function(){},$r:e||function(){},ks:f||function(){},as:C};if(I.hs){var k=c();k&&h.q in k||(h.q+=t.timestamp())}q.push(h)}b(q);C++};a.update=function(){b(q);for(var a=q,c=0,d=!0,e=0;e<a.length;e++){var f=a[e];f.as===a[c].as?30!==f.state&&(d=!1):(d&&(a[e-1].$r(),d=e-c,a.splice(c,d),e-=
d),c=e,d=30===a[e].state?!0:!1);e===a.length-1&&d&&(a[e].$r(),a.splice(c))}}};b4w.module.__loader=function(a,m){function c(b,c,e,f){var g=v,h=z.create(),k;for(k in c){var l=d(c[k]);(f&&l.eb||!b&&l.wb)&&y(l);z.v(h,l)}for(k in c)for(l=c[k],l.name=k,b=0;b<l.K.length;b++)z.l(h,c[l.K[b]],l,null);c=d({name:"out",Pa:a.Ft,ab:function(a,b,c,d,e){0===b.id&&(g.$n=!0);w(b)||(b.status=2);b.ur(b.id,!0);e(b,c);E.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},fb:5});var n=[];if(e)for(e=z.Iq(h),b=0;b<e.length;b++)n.push(z.Ua(h,e[b]));else z.T(h,function(a,b){b.Za||n.push(b)});z.v(h,
c);for(b=0;b<n.length;b++)c.K.push(n[b].name),z.l(h,n[b],c,null);return h}function d(a){a.Za=a.Za||!1;a.Pa||0===a.Pa||(a.Pa=a.ed);a.K=a.K||[];a.yi=a.yi||!1;a.Sn=a.Sn||!1;a.fb=a.fb||0;a.eb=a.eb||!1;a.wb=a.wb||!1;a.status=0;a.kE=0;a.hn=0;a.Kf=a.Kf||null;return a}function b(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];z.Ua(a.Ad,f).yi&&(z.rf(a.Ad,f,function(d){var e=!0;z.ue(a.Ad,d,function(a,b){if(!b.yi)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function e(a){function c(b,d){var e=z.Ua(a.Ad,b),f=z.Ua(a.Ad,d),g=f.Pa-e.Pa;0==g&&(g=e.Za-f.Za);return g}var d=[],e=a.re,f=!1;do{var g=b(a,e);d.push.apply(d,e);0<g.length&&(f=!0);e=g}while(0<g.length);f&&d.sort(c);a.re=d;return a.re.length}function h(a,b,c){if(b.Sn)return b.yi=!0,f(a,b),!1;if(!b.ab&&!b.Jf&&!b.ci)return f(a,b),!1;if(0==b.status&&(b.status++,b.ab))return b.ab(c,a,b,b.Kf,f,n),!0;if(1==b.status){if(b.Jf)return b.Jf(c,a,b,b.Kf,f,n),!0;b.status++}return 2==
b.status&&(b.status++,b.ci)?(b.ci(c,a,b,b.Kf,f,n),!0):!1}function k(a){if(0==a.Tk)return 100;var b=0;z.T(a.Ad,function(c,d){a.do_not_load_resources&&d.eb||(b+=d.hn*d.fb)});return B.trunc(100*b/a.Tk)}function f(a,b){b.yi=!0;b.status=3;g(a,b,1)}function n(a,b,c){1>c?g(a,b,c):b.status++}function g(a,b,c){var d=v;if(b.ab||b.Jf||b.ci)if(b.hn=c,b=k(a),a.Up!=b||1==c)a.Yn(b,performance.now()-a.et),a.Up=b,d.mn=!0}function l(a,b){var c=null;z.T(a.Ad,function(a,d){if(d.name==b)return c=d,1});return c}function y(a){a.Sn=
!0;a.hn=1}function p(a){a.Yn=null;a.Sl=null;a.Ad=null;a.re=null}function w(a){return a&&(3==a.status||4==a.status)}var z=m("__graph"),E=m("__print"),B=m("__util");a.ed=0;a.ze=1;a.Ft=2;var v=null;a.Hq=function(){return v};a.Iw=function(){var a={Dd:[],bm:0,rj:0,$n:!1,mn:!1};return v=a};a.Qw=function(a,b,d,e,f,g,h,k){var l=v,n={id:l.Dd.length,status:0,q:b,mp:"",ur:d||function(){},gn:k||!1,OE:g,et:0,Up:0,Tk:0,Mn:!1,Yn:e||function(){},Sl:f||function(){},Ad:null,re:null,Qm:!1,Pm:!1,Tm:!1};a=c(0===n.id,
a,g,h);n.Ad=a;b=[];d=z.py(a);for(e=0;e<d.length;e++)b.push(d[e]);n.re=b;z.T(a,function(a,b){!(b.ab||b.Jf||b.ci)||n.do_not_load_resources&&b.eb||(n.Tk+=b.fb)});l.Dd.push(n);l.rj++;return n.id};a.GB=function(b){var c=v;if(c&&0!=v.rj)if(c.mn)c.mn=!1;else{var d=performance.now();do{var f=c.Dd[c.bm],g=b[f.id];if(!w(f))if(0==f.status&&(f.status=1,f.et=performance.now(),f.Yn(0,0)),e(f)){var k=f,l=k.re.length;do{var n=z.Ua(k.Ad,k.re[0]),y=h(k,n,g);n.Pa==a.ze&&(k.Mn=!0);n=k.re.shift();k.re.push(n);l--}while(!y&&
0!=l)}else k=c,l=f,l.Sl(g,l),l.status=3,k.rj--,p(l);c.$n&&(c.bm=(c.bm+1)%c.Dd.length);if(f.Mn){f.Mn=!1;break}}while(16>performance.now()-d)}};a.Vo=function(a){var b=v;a.Sl(null,a);a.status=3;b.rj--;p(a);a.status=4;0===a.id&&(b.$n=!0);a.ur(a.id,!1)};a.FE=n;a.Gs=function(a,b){var c=l(a,b);null!==c&&y(c)};a.iB=w;a.is_primary_loaded=function(a){var b=v;if(!b)return!1;a|=0;return b.Dd[a]&&(3==b.Dd[a].status||2==b.Dd[a].status)};a.cleanup=function(){v=null}};b4w.module.__nla=function(a,m){function c(){return{type:"CLIP",J:0,X:0,oe:!1,paused:!1,Cf:"",$h:"",Eb:0,Yh:0,Xh:0,fq:0,eq:0,Ih:!1,rt:!1,scale:1,repeat:1}}function d(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;if(c)for(var e=0;e<c.length;e++)b.push(c[e])}c=a.nodes;for(e=0;e<c.length;e++){var f=c[e];f.node_group&&(f=f.node_group.node_tree)&&d(f,b)}}function b(a,b){for(var c=a.b4w_nla_script,d=b.df,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",J:f.frame_range[0],
X:f.frame_range[1],Ue:!1});break;case "SELECT":case "SELECT_PLAY":var g=B.od(B.zf,f.object,0),h=B.oy(a),k=h.indexOf(g);if(-1==k){E.error("NLA script error: non-selectable object");return}for(var f={type:f.type,Ls:"SELECT"==f.type?f.target_slot:e+1,FA:e+1,ef:-1,eA:h.length,dA:k,J:f.frame_range[0],X:f.frame_range[1],Ue:!1},k=[],l=0;l<h.length;l++)k.push(w.create_selection_sensor(h[l],!0));w.create_sensor_manifold(g,"NLA_SELECT_"+e,w.CT_SHOT,k,w.$w,function(a,c,d,e){if(!(b.Bb>=b.df.length)&&(d=b.df[b.Bb],
"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.Ue)){for(d=0;d<e.eA;d++)if(w.get_sensor_value(a,c,d)&&d==e.dA){e.ef=1;return}e.ef=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",Un:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",Un:f.target_slot,iw:f.condition,Ri:f.register1,Si:f.register2,zn:f.number1,An:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",Lz:f.registerd,sz:f.number1});break;case "MATH":d.push({type:"MATH",uz:f.operation,Ri:f.register1,Si:f.register2,zn:f.number1,
An:f.number2,vh:f.registerd});break;case "SHOW":case "HIDE":g=B.od(B.zf,f.object,0);d.push({type:f.type,obj:g});break;case "REDIRECT":d.push({type:"REDIRECT",url:f.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",wz:f.param_name,vh:f.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function e(a,b,c,d){if(a.df.length){if(a.Bb>=a.df.length)if(a.cyclic)a.Bb=0;else{a.oa-=I.Ha*c;return}var f=k(a,b,!1,d),g=a.df[a.Bb];switch(g.type){case "PLAY":g.Ue?f>=g.X&&(g.Ue=!1,a.Bb++,e(a,b,c,d)):(a.oa+=g.J-
f,g.Ue=!0,h(a,g));break;case "SELECT":case "SELECT_PLAY":-1<g.ef?"SELECT"==g.type||"SELECT_PLAY"==g.type&&0==g.ef?(a.Bb=g.ef?g.Ls:g.FA,g.ef=-1,e(a,b,c,d)):g.Ue?f>=g.X&&(g.Ue=!1,a.Bb=g.Ls,g.ef=-1,e(a,b,c,d)):(a.oa+=g.J-f,g.Ue=!0,h(a,g)):a.oa-=I.Ha*c;break;case "JUMP":a.Bb=g.Un;e(a,b,c,d);break;case "CONDJUMP":var f=-1==g.Ri?g.zn:a.ud[g.Ri],l=-1==g.Si?g.An:a.ud[g.Si],n=!1;switch(g.iw){case "EQUAL":f==l&&(n=!0);break;case "NOTEQUAL":f!=l&&(n=!0);break;case "LESS":f<l&&(n=!0);break;case "GREATER":f>l&&
(n=!0);break;case "LEQUAL":f<=l&&(n=!0);break;case "GEQUAL":f>=l&&(n=!0)}n?a.Bb=g.Un:a.Bb++;e(a,b,c,d);break;case "REGSTORE":a.ud[g.Lz]=g.sz;a.Bb++;e(a,b,c,d);break;case "MATH":f=-1==g.Ri?g.zn:a.ud[g.Ri];l=-1==g.Si?g.An:a.ud[g.Si];switch(g.uz){case "ADD":a.ud[g.vh]=f+l;break;case "MUL":a.ud[g.vh]=f*l;break;case "SUB":a.ud[g.vh]=f-l;break;case "DIV":0==l&&t.pa("Division by zero in NLA script"),a.ud[g.vh]=f/l}a.Bb++;e(a,b,c,d);break;case "SHOW":B.show_object(g.obj);a.Bb++;e(a,b,c,d);break;case "HIDE":B.hide_object(g.obj);
a.Bb++;e(a,b,c,d);break;case "REDIRECT":window.location.href=g.url;a.df.length=0;break;case "PAGEPARAM":a:{f=location.href.toString();if(-1!=f.indexOf("?"))for(f=f.split("?")[1].split("&"),l=0;l<f.length;l++)if(n=f[l].split("="),1<n.length&&n[0]==g.wz){f=Number(n[1]);break a}f=0}a.ud[g.vh]=f;a.Bb++;e(a,b,c,d);break;case "NOOP":a.Bb++,e(a,b,c,d)}}}function h(a,b){for(var c=a.df,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.ef=-1)}}function k(a,b,c,d){b=(b-d)*I.Ha+a.oa-a.J;a.cyclic&&c&&(b%=a.X-a.J+1);return b+=
a.J}function f(a,b){a=t.clamp(a,b.J,b.X);var c=a-b.J,d=(b.X-b.J)/b.repeat,c=c/d&&0==c%d?b.Xh:b.Yh+c%d/b.scale;b.rt&&(c=b.Xh-c+b.Yh);return c}function n(a,b,c){b?x.pause_video(a.name,c):(x.reset_video(a.name,c),x.play_video(a.name,c))}function g(a,b){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],k=c();k.type=h.type;k.J=h.frame_start;k.X=h.frame_end;k.Eb=b;k.Yh=h.action_frame_start;k.Xh=h.action_frame_end;k.rt=h.use_reverse;k.scale=h.scale;k.repeat=h.repeat;
h.action&&(k.Cf=h.action.name,k.$h=h.action.uuid);d.push(k)}}return d}function l(a){return v.ge(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var y=m("__animation"),p=m("__camera"),w=m("__controls"),z=m("__config");m("__loader");var E=m("__print"),B=m("__scenes"),v=m("__sfx"),t=m("__util"),x=m("__textures"),I=z.Od,r=z.o,q=[],C=-1;a.FB=function(a,e,f){e={J:a.frame_start,X:a.frame_end,oa:0,Bi:-1,oc:f,cyclic:e,le:[],N:[],df:[],ik:!1,ym:!1,yE:a.name,Bb:0,ud:{R1:0,R2:0,R3:0,
R4:0,R5:0,R6:0,R7:0,R8:0}};a.Ya=e;b(a,e);for(var h=B.Ia(a,"ALL",B.DATA_ID_ALL),k=0;k<h.length;k++){var n=h[k],w=0,m=[];if((f=n.animation_data)&&f.nla_tracks.length){var z=f.nla_tracks;if(t.is_armature(n)||p.is_camera(n)||t.is_mesh(n)||t.fk(n)||v.ge(n))z=g(z,w),z.length&&(m=m.concat(z),w++)}l(n)&&(z=n.data.animation_data.nla_tracks,z=g(z,w),z.length&&(m=m.concat(z),w++));if(y.Tq(n)){var x=n.data.materials;for(f=0;f<x.length;f++){var C=x[f].node_tree;if(C&&(z=[],d(C,z),z=g(z,w),z.length)){for(var C=
w,I=z,V=y.vq(),X=[],ia=0,R=0;R<I.length;R++){var u=I[R];""!=u.$h?u=t.keysearch("uuid",u.$h,V):(u=u.Cf,u=t.keysearch("name",u,V)||t.keysearch("name",u+"_B4W_BAKED",V));var u=u.fcurves,pa=[],ha;for(ha in u)pa.push(ha);X.push(pa)}for(R=0;R<X.length;R++){V=!1;for(u=0;u<R;u++)if(t.tv(X[R],X[u])){I[R].Eb=I[u].Eb;V=!0;break}V||(I[R].Eb=w+ia++)}w=C+ia;m=m.concat(z)}}}for(f=0;f<n.particle_systems.length;f++)z=n.particle_systems[f],x=z.settings,"EMITTER"==x.type&&x.b4w_allow_nla&&(x=c(),x.type="CLIP",x.J=e.J,
x.X=e.X+1,x.Cf=z.name,x.Eb=w,x.Yh=x.J,x.Xh=x.X,m.push(x),w++);z=w+1;if(t.is_mesh(n)&&n.data)for(f=0;f<n.data.b4w_vertex_anim.length;f++)C=n.data.b4w_vertex_anim[f],C.allow_nla&&(w=z,x=c(),x.type="CLIP",x.J=e.J,x.X=e.X+1,x.Cf=C.name,x.Eb=w,x.Yh=x.J,x.Xh=x.X,m.push(x));m.length&&(n.jl=m,e.le.push(n))}a=a.d.Ph;for(f=0;f<a.length;f++)if(ha=a[f].d,ha.La||ha.wh)x=c(),x.type="VIDEO",h=1,r.Oc&&(h=ha.Zb),x.J=Math.min(ha.J*h,e.X),x.X=ha.zg?e.X:Math.min((ha.Yg+ha.J+ha.oa)*h,e.X),x.Cf=a[f].name,ha.Ru=x,e.N.push(ha);
a=e.J;f=e.X;for(ha=0;ha<e.le.length;ha++)for(h=e.le[ha],k=h.jl,n=0;n<k.length;n++)m=k[n],x=h.name+" ["+m.J+":"+m.X+"]",m.J=Math.max(a,m.J),m.X=Math.min(f+1,m.X),m.J>m.X?(E.warn("NLA: out of scene range: "+x),k.splice(n,1),n--):m.Cf||"CLIP"!=m.type||(E.warn('NLA: no action in strip for object "'+h.name+'".'),k.splice(n,1),n--);for(a=0;a<e.le.length;a++)for(f=e.le[a].jl,ha=0;ha<f.length;ha++){h=f[ha];k=e.J;n=e.X+1;for(m=0;m<f.length;m++)x=f[m],h.Eb==x.Eb&&(x.X<=h.J&&(k=h.J),x.J>=h.X&&(n=Math.min(n,
x.J)));h.fq=k;h.eq=n}q.push(e)};a.start=function(){C=0};a.update=function(a,b){if(!(0>C)){0==C&&(C=a);for(var c=0;c<q.length;c++){var d=q[c];if(d.ik&&!d.ym)d.oa-=I.Ha*b;else{e(d,a,b,C);for(var g=k(d,a,!0,C),h=0;h<d.le.length;h++){for(var l=d.le[h],p=l.jl,t=0;t<p.length;t++){var r=p[t];"SOUND"==r.type&&g<d.Bi-1E-6&&(r.oe=!1)}for(t=0;t<p.length;t++)switch(r=p[t],r.type){case "CLIP":if(r.fq<=g&&g<r.eq&&!r.oe){var w=l,m=r;""!=m.$h?y.mv(w,m.$h,m.Eb):y.apply(w,m.Cf,m.Eb);y.set_behavior(w,y.AB_FINISH_STOP,
m.Eb);var z=f(m.J,m);y.set_current_frame_float(w,z,m.Eb);for(w=0;w<p.length;w++)p[w]!=r&&p[w].Eb==r.Eb&&(p[w].oe=!1);r.oe=!0}r.oe&&(w=l,m=f(g,r),z=y.get_current_frame_float(w,r.Eb),1E-6<Math.abs(m-z)&&y.set_current_frame_float(w,m,r.Eb));break;case "SOUND":(g<d.Bi-1E-6||d.Bi<r.J)&&r.J<=g&&g<r.X&&!r.oe&&(v.play(l,(r.J-g)/I.Ha,(r.X-r.J)/I.Ha),r.oe=!0),d.Bi<r.X&&r.X<=g&&r.oe&&(r.oe=!1)}}for(h=0;h<d.N.length;h++)r=d.N[h].Ru,r.J<=Math.round(g)&&Math.round(g)<r.X&&!r.Ih&&(n(d.N[h],r.Ih,d.oc),r.Ih=!0),r.X<=
Math.round(g)&&r.Ih&&(n(d.N[h],r.Ih,d.oc),r.Ih=!1);d.Bi=g;d.ym=!1}}}};a.cleanup=function(){q.length=0;C=-1};a.Vq=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||l(a)||y.Tq(a)?!0:!1};a.set_frame=function(a,b){var c=B.get_active();c.Ya&&(c.Ya.oa-=k(c.Ya,b,!0,C)-a,c.Ya.ym=!0)};a.get_frame=function(a){var b=B.get_active();return b.Ya?k(b.Ya,a,!0,C):-1};a.WA=function(){var a=B.get_active();a.Ya&&(a.Ya.ik=!0)};a.Az=function(){var a=B.get_active();a.Ya&&(a.Ya.ik=!1)};a.get_frame_start=
function(){var a=B.get_active();return a.Ya?a.Ya.J:-1};a.get_frame_end=function(){var a=B.get_active();return a.Ya?a.Ya.X:-1};a.is_play=function(){var a=B.get_active();return a.Ya?!a.Ya.ik:!1};a.check_nla=function(){var a=B.get_active();return a.Ya?a.b4w_use_nla:!1};a.check_nla_scripts=function(){var a=B.get_active();return a.Ya?0<a.b4w_nla_script.length:!1}};b4w.module.__camera=function(a,m){function c(b){b=b.d;switch(b.sa){case a.MS_TARGET_CONTROLS:b.gh=U.dist(b.g,b.Gb);b.hh=b.G[0].top;break;case a.MS_HOVER_CONTROLS:b.Qa&&(b.gh=U.dist(b.g,b.Rb),b.hh=b.G[0].top)}}function d(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Va:new Float32Array([0,0,0,0]),cb:new Float32Array([0,0,0,0])}}function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function e(b){var c={type:b,name:"",mf:1,width:0,height:0,ce:null,bb:null,Ic:null,va:0,qc:0,Va:0,cb:0,left:0,right:0,top:0,bottom:0,Pe:new Float32Array(3),iq:new Float32Array(3),quat:new Float32Array(4),fa:new Float32Array(16),RC:new Float32Array(16),qa:new Float32Array(16),Qh:new Float32Array(16),Hz:new Float32Array(16),xd:new Float32Array(16),Es:new Float32Array(16),Fd:new Float32Array(16),
dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Zd:null,dof_on:0,Uj:d(),Yi:0,Bd:0,dc:null,fi:null,Yl:null,Sp:new Float32Array(4),Ek:new Float32Array(4)};if(b==a.qb)return c;switch(b){case a.Mb:n(c,40,.1,1E3);break;case a.Ec:n(c,2.5,.1,1E3);break;case a.Kd:break;case a.Ae:break;case a.Af:break;case a.rb:case a.Ab:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function h(b,c,d){if(b.type!=a.rb&&b.type!=a.Ab)throw"set_stereo_params(): wrong camera type";
b.Yi=c;b.Bd=d;r(b,b.va);if(Z.ga())for(c=Z.get_active(),b=c.d.wd,c=Z.Vj(c).d.G,d=0;d<c.length;d++)L(c[d],b)}function k(a,b){return f(a.d.quat,b)}function f(a,b){var c=P.quat_to_dir(a,P.AXIS_Y,ha),d=P.quat_to_dir(a,P.AXIS_Z,ea),e=-Math.asin(c[1]/U.length(c)),c=Math.abs(e)>Math.PI/4?U.scale(d,-P.sign(e),Y):U.scale(c,-P.sign(d[1]),Y),f=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=P.sign(e)*Math.PI-e);d=f;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function n(b,c,d,e,f){switch(b.type){case a.Mb:case a.rb:case a.Ab:b.qc=
c;b.va=1;break;case a.Ec:b.top=c;b.va=1;break;case a.Kd:delete b.qc;b.qc=c;b.va=f/c;break;case a.Ae:b.top=c;b.va=f/c;break;default:Q.error("set_frustum(): Unsupported camera type: "+b.type)}b.Va=d;b.cb=e}function g(b,c){var d=c.d.g,e=c.d.quat,f=ra;R.rotateX(c.d.U,-Math.PI/2,f);R.invert(f,b.fa);if(b.dc){var f=b.dc[0],g=b.dc[1],h=b.dc[2],k=b.dc[3],l=ra;l[0]=1-2*f*f;l[1]=-2*f*g;l[2]=-2*f*h;l[3]=0;l[4]=-2*f*g;l[5]=1-2*g*g;l[6]=-2*g*h;l[7]=0;l[8]=-2*f*h;l[9]=-2*g*h;l[10]=1-2*h*h;l[11]=0;l[12]=-2*f*k;l[13]=
-2*g*k;l[14]=-2*h*k;l[15]=1;R.multiply(b.fa,l,b.fa);r(b,b.va,!0);f=W;g=ra;R.invert(b.fa,g);R.transpose(g,g);V.transformMat4(b.dc,g,f);g=ba;g[0]=(P.sign(f[0])+b.qa[8])/b.qa[0];g[1]=(P.sign(f[1])+b.qa[9])/b.qa[5];g[2]=-1;g[3]=(1+b.qa[10])/b.qa[14];V.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.qa[2]=f[0];b.qa[6]=f[1];b.qa[10]=f[2]+1;b.qa[14]=f[3]}b.type==a.rb?b.fa[12]+=b.Bd/2:b.type==a.Ab&&(b.fa[12]-=b.Bd/2);R.multiply(b.qa,b.fa,b.Fd);C(b);q(b);U.copy(b.Pe,b.iq);U.copy(d,b.Pe);X.copy(e,
b.quat)}function l(b,c,d,e){R.lookAt(c,d,e,b.fa);b.type==a.rb?b.fa[12]+=b.Bd/2:b.type==a.Ab&&(b.fa[12]-=b.Bd/2);R.multiply(b.qa,b.fa,b.Fd);C(b);q(b);U.copy(c,b.Pe)}function y(a){var b=a.d.G;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];g(e,a);P.qm(e.Fd,e.Uj);if(e.Zd)if(e.dof_on){var f=U.dist(c.g,e.Zd.location);e.dof_distance=f}else e.dof_distance=0}}function p(b){b=b.d;if(b.sa==a.MS_TARGET_CONTROLS){var c=P.quat_to_dir(b.quat,P.AXIS_Z,ha);b.ho=0<c[1]}}function w(b,c){var d=
b.d,e=d.Qb;!e||d.sa!=a.MS_EYE_CONTROLS&&d.sa!=a.MS_TARGET_CONTROLS||(c&&(d=k(b,u),e.left+=d[0],e.right+=d[0]),e.left=P.angle_wrap_0_2pi(e.left),e.right=P.angle_wrap_0_2pi(e.right))}function z(b,c){var d=b.d,e=d.ad;!e||d.sa!=a.MS_EYE_CONTROLS&&d.sa!=a.MS_TARGET_CONTROLS||(c&&(d=k(b,u),e.Wa+=d[1],e.Na+=d[1]),e.Wa=P.angle_wrap_periodic(e.Wa,-Math.PI,Math.PI),e.Na=P.angle_wrap_periodic(e.Na,-Math.PI,Math.PI))}function E(b){var c=b.d;if(A(b)&&c.G[0].type===a.Ec){if(c.sa===a.MS_TARGET_CONTROLS)var d=U.dist(c.g,
c.Gb),c=d/c.gh*c.hh;else c.Qa&&c.sa===a.MS_HOVER_CONTROLS?(d=U.distance(c.g,c.Rb),c=d/c.gh*c.hh):c=b.d.G[0].top;for(var e in b.d.G)d=b.d.G[e],d.top=c,r(d,d.va);y(b)}}function B(a,b,c,d,e){var f=a.d,g=b,h=c;if(d||e)a=k(a,pa),d&&(g=b-a[0]),e&&(h=c-a[1]);if(g||h)b=X.identity(na),g&&(g=X.setAxisAngle(P.AXIS_Y,g,H),X.multiply(b,g,b)),h&&(g=P.quat_to_dir(f.quat,P.AXIS_X,ha),h=X.setAxisAngle(g,h,H),X.normalize(h,h),X.multiply(b,h,b)),X.multiply(b,f.quat,f.quat)}function v(a,b,c,d,e){var f=a.d,g=b,h=c;if(d||
e){var l=k(a,pa);d&&(g=b-l[0]);e&&(h=c-l[1])}x(a,a.d.Gb,g,h);a=k(a,pa);a=P.angle_wrap_periodic(a[1],-Math.PI,Math.PI);f.ho=Math.abs(a)>Math.PI/2}function t(a,b,c,d,e){var f=a.d,g=b,h=c;if(d||e){var l=k(a,pa);d&&(g=b-l[0]);e&&(h=c-l[1])}f.jm||(g=0);x(a,f.Rb,g,h);h&&I(a)}function x(a,b,c,d){var e=a.d;if(c||d){var f=X.identity(na);c&&(c=X.setAxisAngle(P.AXIS_Y,c,H),X.multiply(f,c,f));a=N(a);d&&(!a||a&&e.Qa)&&(a=P.quat_to_dir(e.quat,P.AXIS_X,ha),d=X.setAxisAngle(a,d,H),X.normalize(d,d),X.multiply(f,d,
f));P.Wz(e.g,b,f,e.g);X.multiply(f,e.quat,e.quat)}}function I(a){var b=a.d;if(b.Qa){var c=k(a,u)[1];a=a.d;a.ub.Na-a.ub.Wa?(c=(a.ub.Na-c)/(a.ub.Na-a.ub.Wa),c=Math.max(c,0)):c=0;c=c*(a.Nf-a.Yd)+a.Yd;a=P.quat_to_dir(b.quat,P.AXIS_MY,ha);U.normalize(a,a);U.scale(a,c,a);U.subtract(b.Rb,a,b.g)}}function r(b,c,d){switch(b.type){case a.Mb:if(!c)throw"No aspect ratio";b.va=c;case a.Kd:R.perspective(P.Ik(b.qc),b.va,b.Va,b.cb,b.qa);break;case a.Ec:if(!c)throw"No aspect ratio";b.va=c;case a.Ae:c=b.top*b.va;R.ortho(-c,
c,-b.top,b.top,b.Va,b.cb,b.qa);break;case a.Af:R.ortho(b.left,b.right,b.bottom,b.top,b.Va,b.cb,b.qa);break;case a.rb:case a.Ab:if(!c)throw"No aspect ratio";b.va=c;var e=Math.tan(b.qc*Math.PI/360);c=b.Va*e;var f=b.va*b.Yi*e;b.type==a.rb?(e=f-b.Bd/2,f+=b.Bd/2):(e=f+b.Bd/2,f-=b.Bd/2);e=-(b.Va/b.Yi*e);f*=b.Va/b.Yi;R.frustum(e,f,-c,c,b.Va,b.cb,b.qa);b.left=e;b.right=f;break;case a.qb:return;default:throw"Wrong camera type: "+b.type;}d||(R.multiply(b.qa,b.fa,b.Fd),C(b),q(b))}function q(a){R.copy(a.fa,a.xd);
a.xd[12]=0;a.xd[13]=0;a.xd[14]=0;a.xd[15]=1;R.multiply(a.qa,a.xd,a.xd);R.invert(a.xd,a.xd)}function C(a){R.copy(a.fa,a.Qh);R.multiply(a.qa,a.Qh,a.Qh);R.invert(a.Qh,a.Qh)}function J(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Va);d||(d=b.cb);var g,h,k,l,n,p,H,q;switch(b.type){case a.qb:throw"Extraction from NONE camera is not possible";case a.Mb:case a.Kd:g=c*Math.tan(b.qc*Math.PI/360);l=-g;h=g*b.va;k=-h;n=d/c*g;q=-n;p=n*b.va;H=-p;break;case a.Ec:case a.Ae:k=b.top*b.va;g=n=b.top;h=p=k;l=q=-b.top;
k=H=-k;break;case a.Af:g=n=b.top;h=p=b.right;l=q=b.bottom;k=H=b.left;break;case a.rb:case a.Ab:n=c/b.Va;g=c*Math.tan(b.qc*Math.PI/360);l=-g;h=b.right*n;k=b.left*n;H=d/c;n=g*H;q=-n;p=h*H;H*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=l;e[2]=-c;e[3]=h;e[4]=l;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=k;e[10]=g;e[11]=-c;e[12]=H;e[13]=q;e[14]=-d;e[15]=H;e[16]=n;e[17]=-d;e[18]=p;e[19]=n;e[20]=-d;e[21]=p;e[22]=q;e[23]=-d;f&&(c=ra,R.invert(b.fa,c),P.af(e,c,e,0));return e}function A(a){return"CAMERA"===
a.type?!0:!1}function N(b){return A(b)&&b.d&&b.d.sa==a.MS_HOVER_CONTROLS?!0:!1}function L(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.fi){var d=b.csm_num;a.fi=Array(d);for(var e=0;e<d;e++)a.fi[e]=new Float32Array(3);a.Yl=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Va:M(b,a,d-1),f=M(b,a,d),e=J(a,e,f,ja),e=D.jy(e);a.fi[d].set(e.F);a.Yl[d]=e.Da;a.Sp[d]=U.length(e.F);a.Ek[d]=G(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Ek[0]=b.first_cascade_blur_radius}function M(a,b,c){var d=
a.csm_num,e=P.clamp(a.csm_first_cascade_border,b.Va,b.cb);a=P.clamp(a.csm_last_cascade_border,b.Va,b.cb);return P.clamp(G(e,a,d,c),b.Va,b.cb)}function G(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var D=m("__boundings");m("__config");var O=m("__constraints"),Q=m("__print"),Z=m("__scenes"),P=m("__util"),U=m("vec3"),V=m("vec4"),X=m("quat"),ia=m("mat3"),R=m("mat4");a.qb=10;a.Mb=20;a.Ec=30;a.Kd=40;a.Ae=50;a.Af=60;a.rb=70;a.Ab=80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=
2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var u=new Float32Array(2),pa=new Float32Array(2),ha=new Float32Array(3),ea=new Float32Array(3),Y=new Float32Array(3),na=new Float32Array(4),H=new Float32Array(4),W=new Float32Array(4),ba=new Float32Array(4),xa=new Float32Array(16),ra=new Float32Array(16),ja=new Float32Array(24);a.Nv=function(d){var f=d.d,g=d.data;switch(g.type){case "PERSP":var h=e(a.Mb);if(g.angle_y)var l=g.angle_y/Math.PI*180;n(h,l,g.clip_start,g.clip_end);break;case "ORTHO":h=e(a.Ec),
n(h,g.ortho_scale/2,g.clip_start,g.clip_end)}h.name=d.name;f.it=!1;f.sa=b(g.b4w_move_style);f.dof_distance=d.data.dof_distance;f.Zd=d.data.dof_object;f.dof_front=d.data.b4w_dof_front;f.dof_rear=d.data.b4w_dof_rear;f.dof_power=d.data.b4w_dof_power;f.jm=d.data.b4w_enable_hover_hor_rotation;f.G=[h];f.xo=d.data.b4w_trans_velocity;f.wo=d.data.b4w_rot_velocity;f.yo=d.data.b4w_zoom_velocity;f.sa==a.MS_TARGET_CONTROLS&&(f.Gb.set(g.b4w_target),p(d));g=d.d;l=g.sa;if(l===a.MS_TARGET_CONTROLS||l===a.MS_EYE_CONTROLS||
l===a.MS_HOVER_CONTROLS){var H=d.data,q=null,r=null,y=null;l===a.MS_TARGET_CONTROLS||l===a.MS_EYE_CONTROLS?(H.b4w_use_panning&&(g.qt=H.b4w_use_panning),H.b4w_use_horizontal_clamping&&(q={left:H.b4w_rotation_left_limit,right:H.b4w_rotation_right_limit}),H.b4w_use_vertical_clamping&&(r={Na:H.b4w_rotation_down_limit,Wa:H.b4w_rotation_up_limit}),l===a.MS_TARGET_CONTROLS&&(g.Qa=H.b4w_use_distance_limits&&H.b4w_distance_min<=H.b4w_distance_max,g.Qa&&(g.Yd=H.b4w_distance_min,g.Nf=H.b4w_distance_max))):l===
a.MS_HOVER_CONTROLS&&(H.b4w_use_horizontal_clamping&&H.b4w_horizontal_translation_min<=H.b4w_horizontal_translation_max&&(q={left:H.b4w_horizontal_translation_min,right:H.b4w_horizontal_translation_max}),H.b4w_use_vertical_clamping&&H.b4w_vertical_translation_min<=H.b4w_vertical_translation_max&&(r={Na:H.b4w_vertical_translation_min,Wa:H.b4w_vertical_translation_max}),g.Qa=H.b4w_use_distance_limits&&H.b4w_hover_angle_min<=H.b4w_hover_angle_max&&H.b4w_distance_min<=H.b4w_distance_max,g.Qa&&(y={Na:H.b4w_hover_angle_min,
Wa:H.b4w_hover_angle_max},g.Yd=H.b4w_distance_min,g.Nf=H.b4w_distance_max));var m=q;m&&l==a.MS_EYE_CONTROLS&&(m.left*=-1,m.right*=-1);if(m=r)switch(l){case a.MS_TARGET_CONTROLS:m.Na*=-1;m.Wa*=-1;break;case a.MS_HOVER_CONTROLS:var ba=-m.Na;m.Na=-m.Wa;m.Wa=ba}(m=y)&&l==a.MS_HOVER_CONTROLS&&(m.Na*=-1,m.Wa*=-1);g.Qb=q;g.ad=r;g.ub=y;w(d,"LOCAL"==H.b4w_horizontal_clamping_type);z(d,"LOCAL"==H.b4w_vertical_clamping_type)}if(f.sa===a.MS_HOVER_CONTROLS)if(f=d.d,f.Qa){g=d.d;l=P.quat_to_dir(g.quat,P.AXIS_MY,
ha);H=W;H.set(P.AXIS_Y);H[3]=0;l=P.line_plane_intersect(H,0,g.g,l,g.Rb);if(!l||100<U.len(l))g.Rb[0]=g.g[0],g.Rb[1]=0,g.Rb[2]=g.g[2];g=k(d,u);f=P.Ge(g[1],f.ub.Wa,f.ub.Na);0<g[1]&&Q.warn("Active hover camera has wrong orientation");f?t(d,0,f):I(d)}else f.jm=!1;h.type==a.Ec&&c(d)};a.Gy=c;a.yw=d;a.jb=e;a.SC=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.bb);case "DEPTH":return Boolean(a.Ic);case "SCREEN":return!Boolean(a.bb)&&!Boolean(a.Ic);default:throw"Wrong attachment type: "+
b;}};a.Nk=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.bb=c;break;case "DEPTH":a.Ic=c;break;case "SCREEN":a.bb=null;a.Ic=null;break;default:throw"Wrong attachment type: "+b;}};a.HD=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.bb;case "DEPTH":return a.Ic;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.wr=function(b,c){if(b.type!=a.Mb||c!=a.rb&&c!=a.Ab)throw"make_stereo(): wrong camera type";b.type=c;h(b,6,.065)};a.sA=h;a.get_camera_angles=k;a.xq=f;
a.get_camera_angles_char=function(a,b){k(a,b);b[0]=P.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.d,d=P.quat_to_dir(c.quat,P.AXIS_MY,ha),e=Math.asin(d[1]/U.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?P.quat_to_dir(c.quat,P.AXIS_MZ,ea):P.quat_to_dir(c.quat,P.AXIS_Z,ea)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.Ok=n;a.kA=function(b,c,d,e,f,g,h){switch(b.type){case a.Af:b.left=
c;b.right=d;b.bottom=e;b.top=f;b.Va=g;b.cb=h;break;default:Q.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.sa};a.wA=g;a.zE=l;a.Bs=function(a,b,c){var d=ha;d[0]=0;d[1]=-1;d[2]=0;U.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=ea;e[0]=0;e[1]=0;e[2]=-1;U.transformQuat(e,c,e);l(a,b,d,e)};a.wx=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];R.lookAt(a,b,c,ra);R.invert(ra,ra);R.rotateX(ra,Math.PI/2,ra);ia.fromMat4(ra,xa);X.fromMat3(xa,
e)};a.xB=y;a.wB=function(b){var c=b.d,d=b.d;if(d.sa===a.MS_TARGET_CONTROLS||d.sa===a.MS_EYE_CONTROLS){if(d.Qb){var e=d.Qb.left,f=d.Qb.right,g=k(b,u);(g=d.sa==a.MS_TARGET_CONTROLS?P.Ge(g[0],e,f):P.Ge(g[0],f,e))&&(d.sa==a.MS_TARGET_CONTROLS?v(b,g,0):B(b,g,0))}d.ad&&(e=d.ad.Na,f=d.ad.Wa,g=k(b,u),(g=d.sa==a.MS_TARGET_CONTROLS?P.Ge(g[1],f,e):P.Ge(g[1],e,f))&&(d.sa==a.MS_TARGET_CONTROLS?v(b,0,g):B(b,0,g)));d.sa===a.MS_TARGET_CONTROLS&&d.Qa&&(g=b.d,e=U.subtract(g.g,g.Gb,ha),f=U.length(e),f>g.Nf?(U.scale(e,
g.Nf/f,e),U.add(g.Gb,e,g.g)):f<g.Yd&&(f=P.quat_to_dir(g.quat,P.AXIS_MY,ea),U.scale(f,100*g.Yd,f),U.add(e,f,e),U.scale(e,-g.Yd/U.length(e),e),U.add(g.Gb,e,g.g)))}d.sa===a.MS_HOVER_CONTROLS&&(d=b.d,g=d.Qa?d.Rb:d.g,d.Qb&&(e=P.clamp(g[0],d.Qb.left,d.Qb.right)-g[0],g[0]+=e,d.Qa&&(d.g[0]+=e)),d.ad&&(e=P.clamp(g[2],d.ad.Na,d.ad.Wa)-g[2],g[2]+=e,d.Qa&&(d.g[2]+=e)),d=b.d,d.Qa&&d.ub&&(g=k(b,u)[1],g=P.Ge(g,d.ub.Wa,d.ub.Na),P.quat_to_dir(d.quat,P.AXIS_MY,ha),g&&t(b,0,g)));E(b);switch(c.sa){case a.MS_TARGET_CONTROLS:O.Xz(c.g,
c.quat,c.Gb);O.correct_up(b,P.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.Sa||O.correct_up(b,P.AXIS_Y)}p(b)};a.ro=p;a.Cz=w;a.Gz=z;a.EB=E;a.rotate_eye_camera=B;a.rotate_target_camera=v;a.rotate_hover_camera=t;a.Fy=I;a.bE=function(b){switch(b.type){case a.Mb:case a.Ec:case a.rb:case a.Ab:return!0;default:return!1}};a.Vx=function(b){b=b.d.G[0];switch(b.type){case a.Mb:case a.Kd:case a.rb:case a.Ab:return Math.PI*b.qc/180;default:return Q.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.ff=r;
a.Il=q;a.xp=C;a.tx=J;a.vv=function(a){a=a.d;var b=D.Gd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Nb=b;var c=D.Wl(1,[0,0,0]);a.Rc=c;a.xl=D.Op(1,b);a.zl=D.Qp(1,b);a.yl=D.Pp(1,b)};a.is_camera=A;a.is_target_camera=function(b){return A(b)&&b.d&&b.d.sa==a.MS_TARGET_CONTROLS?!0:!1};a.is_eye_camera=function(b){return A(b)&&b.d&&b.d.sa==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=N;a.qo=L;a.Tw=M;a.project_point=function(b,c,d){b=b.d.G[0];switch(b.type){case a.Mb:case a.Kd:case a.Ec:case a.Ae:case a.rb:case a.Ab:var e=
W;e.set(c);e[3]=1;V.transformMat4(e,b.Fd,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return Q.error("Non-compatible camera"),d}};a.hy=function(a){return a.d.G[0]};a.Wj=function(b,c){switch(b.type){case a.Mb:case a.Kd:case a.rb:case a.Ab:var d=Math.tan(P.Ik(b.qc)/2);switch(c){case "LEFT":return-d*b.va;case "RIGHT":return d*b.va;case "TOP":return d;case "BOTTOM":return-d}break;case a.Ec:case a.Ae:switch(c){case "LEFT":return-b.top*
b.va;case "RIGHT":return b.top*b.va;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.Af:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:P.pa("Unknown camera type")}};a.Sy=function(b){switch(b.type){case a.Ec:case a.Ae:case a.Af:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.Mb:case a.Kd:case a.rb:case a.Ab:var d=P.Ik(b.qc);return c?d*b.va:d;default:return 0}}};b4w.module.__lights=function(a,m){function c(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Og:new Float32Array(3),Zc:0,wg:0,Sx:!1,bq:!1,Ag:!0,sf:!0,Ne:1,distance:25,rD:"INVERSE_SQUARE"}}function d(a){a.Og[0]=a.color[0]*a.Ne;a.Og[1]=a.color[1]*a.Ne;a.Og[2]=a.color[2]*a.Ne}var b=m("__util"),e=m("vec3");a.VD=c;a.Vy=function(a){var k=a.data,f=c(k.type);f.name=a.name;f.Ag=k.use_diffuse;f.sf=k.use_specular;var n=b.quat_to_dir(a.d.quat,b.AXIS_Y,[]);e.normalize(n,
n);f.direction[0]=n[0];f.direction[1]=n[1];f.direction[2]=n[2];f.color[0]=k.color[0];f.color[1]=k.color[1];f.color[2]=k.color[2];f.Ne=k.energy;d(f);f.distance=k.distance;if("POINT"===f.type||"SPOT"===f.type)f.distance=k.distance;"SPOT"===f.type?(f.wg=k.spot_blend,f.Zc=k.spot_size):"POINT"===f.type&&(f.Zc=Math.PI/2);f.Sx=k.b4w_generate_shadows;f.bq=k.b4w_dynamic_intensity;a.ma=f};a.mA=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];d(a)};a.oA=function(a,b){a.wg=b};a.nA=function(a,b){a.distance=
b};a.pA=function(a,b){a.Zc=b};a.ys=function(a,b){a.Ne=b;d(a)};a.Ym=function(a){return"LAMP"===a.type?!0:!1};a.BB=function(a){if("LAMP"!=a.type)throw"Wrong light object";var c=a.ma;c&&b.quat_to_dir(a.d.quat,b.AXIS_Y,c.direction)}};b4w.module.__scenes=function(a,m){function c(){Ka||(Ka=d(Ga));return Ka}function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.fd||!c.fd.length)return c}return null}function b(){if(!Aa)throw"No active scene available";return Aa}function e(a,b,c,d){for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.oc==d){e=g;break}}return e}function h(a,b){b||(b="ALL");var c=[];k(a.objects,b,c);return c}function k(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||
c.push(e);(e=e.dupli_group)&&k(e.objects,b,c)}}function f(b){if("NONE"==za.gf||!b.b4w_render_shadows)return!1;var c=!1,d=!1;if(0==Y(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=Y(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function n(a){if(!a.ua)return!1;a=a.ua.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].ma.type)return!0;return!1}function g(a){if(!za.shore_smoothing)return!1;a=na(a);for(var b=0;b<a.length;b++){var c=
a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function l(b){var c=na(b),d=[];b=Y(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<c.length;e++){var f=c[e];if(f.b4w_water){for(var g={},h=0;h<b.length;h++)for(var k=b[h],l=k.data.materials,K=0;K<l.length;K++)l[K]==f&&(g.wf=k.location[1]);if(za.ji)for(g.Yb=f.b4w_water_fog_color.slice(0),g.Yb.push(f.b4w_water_fog_density),f.b4w_water_dynamic?(g.Vg=!0,g.waves_height=f.b4w_waves_height,g.waves_length=f.b4w_waves_length,g.dst_noise_scale0=f.b4w_water_dst_noise_scale0,
g.dst_noise_scale1=f.b4w_water_dst_noise_scale1,g.dst_noise_freq0=f.b4w_water_dst_noise_freq0,g.dst_noise_freq1=f.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=f.b4w_water_dir_min_shore_fac,g.dir_freq=f.b4w_water_dir_freq,g.dir_noise_scale=f.b4w_water_dir_noise_scale,g.dir_noise_freq=f.b4w_water_dir_noise_freq,g.dir_min_noise_fac=f.b4w_water_dir_min_noise_fac,g.dst_min_fac=f.b4w_water_dst_min_fac,g.waves_hor_fac=f.b4w_water_waves_hor_fac):(g.Vg=!1,g.waves_height=0,g.waves_length=0),g.Ej=null,g.Kl=
null,g.Ll=new Float32Array(2),g.Qk=null,f=f.texture_slots,h=0;h<f.length;h++)k=f[h].texture,"VORONOI"==k.type&&(g.Ej=k.noise_scale,g.Ll.set([.3,.7]),g.Kl=k.noise_intensity),!0===k.b4w_shore_dist_map&&(g.Qk=k.image,g.zh=k.image.size[0],g.CA=k.b4w_shore_boundings,g.nh=k.b4w_max_shore_dist);else g.waves_height=0,g.waves_length=0,g.Ej=null,g.Kl=null,g.Ll=null,g.Yb=null,g.Vg=!1;d.push(g)}}if(0<d.length){g=d[0];if(!g.Vg)for(e=0;e<d.length;e++)d[e].Vg&&(g=d[e]);return g}return null}function y(a){function b(a){if(a){a=
a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.td=!0)}}}var c={};a=na(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.td=!0);e.node_tree&&b(e.node_tree)}return c}function p(b){if(!za.Lk||!b.b4w_render_reflections)return null;var c=[],d=0;b=Y(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];if(f.d.wc)if("CUBE"==f.d.me)d++;else{var g=f.kl;f.kl=null;if(g){g.d||
kb.Zk(g,!1);for(var f=null,h=0;h<c.length;h++)if(c[h]==g){f=h;break}null==f&&c.push(g)}}}return{Kk:c,Fr:d,Nj:[],Li:[]}}function w(a,b){var c={},d=a.world.b4w_sky_settings;c.rs=d.render_sky;c.procedural_skydome=d.procedural_skydome&&b;c.use_as_environment_lighting=d.use_as_environment_lighting;c.Ah=d.color;c.rayleigh_brightness=d.rayleigh_brightness;c.mie_brightness=d.mie_brightness;c.spot_brightness=d.spot_brightness;c.scatter_strength=d.scatter_strength;c.rayleigh_strength=d.rayleigh_strength;c.mie_strength=
d.mie_strength;c.rayleigh_collection_power=d.rayleigh_collection_power;c.mie_collection_power=d.mie_collection_power;c.mie_distribution=d.mie_distribution;c.Vb=d.reflexible;c.Hb=d.reflexible_only;!b&&d.procedural_skydome&&Ea.warn("There is no sun on the scene. Procedural sky won't be rendered");return c}function z(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.Dy=a.hemisphere;b.Hv=a.blur_depth;b.qp=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;
b.Zz=a.samples;return b}function E(a){var b={};a=a.world.b4w_bloom_settings;b.blur=a.blur;b.jx=a.edge_lum;b.key=a.key;return b}function B(a){var b={};a=a.world.b4w_motion_blur_settings;b.ok=a.motion_blur_decay_threshold;b.pk=a.motion_blur_factor;return b}function v(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function t(a){var b={};a=a.world.b4w_god_rays_settings;b.Jy=a.intensity;b.mh=a.max_ray_length;
b.Hh=a.steps_per_pass;return b}function x(a){var b={};a=a.world;b.$e=a.b4w_outline_color;b.Gi=a.b4w_outline_factor;return b}function I(a){var b={};a=a.world;b.small_glow_mask_coeff=a.b4w_small_glow_mask_coeff;b.large_glow_mask_coeff=a.b4w_large_glow_mask_coeff;b.small_glow_mask_width=a.b4w_small_glow_mask_width;b.large_glow_mask_width=a.b4w_large_glow_mask_width;return b}function r(a,b){var c=a.world,d=c.light_settings,e={};e.Oe=d.environment_energy;e.so=d.use_environment_light;e.lm=d.environment_color;
e.Se=c.horizon_color.slice(0);e.yf=c.zenith_color.slice(0);e.VB=c.use_sky_paper;e.UB=c.use_sky_blend;e.WB=c.use_sky_real;e.Ks=null;e.Tn=null;e.mm=null;if(e.so&&"SKY_TEXTURE"==e.lm&&!(b.rs&&b.procedural_skydome&&b.use_as_environment_lighting)){for(var d=null,f=0;f<c.texture_slots.length;f++)if(c.texture_slots[f].texture.b4w_use_as_environment_lighting){d=c.texture_slots[f];break}d?e.mm=d:(Ea.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),
e.so=!1)}for(f=0;f<c.texture_slots.length;f++)if(c.texture_slots[f].texture.b4w_use_as_skydome){c=c.texture_slots[f];e.Ks=c;e.Tn={Fv:c.blend_factor,Ey:c.horizon_factor,jC:c.zenith_up_factor,iC:c.zenith_down_factor,color:c.color,Ba:c.default_value,invert:c.invert,TB:c.use_rgb_to_intensity,op:c.blend_type,PB:c.use_map_blend,QB:c.use_map_horizon,SB:c.use_map_zenith_up,RB:c.use_map_zenith_down};break}return e}function q(b){if(!za.lb)return!1;var c=!1,d=!1;b=Y(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){for(var f=
b[e],g=f.data.materials,h=0;h<g.length;h++)g[h].b4w_terrain&&(c=!0);f=f.particle_systems;for(h=0;h<f.length;h++)g=f[h].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}function C(b){if(Pa.outlining_overview_mode)return!0;if(za.enable_selectable)switch(b.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Y(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.ug)return!0;return!1}else return!1}function J(b){if(Pa.outlining_overview_mode)return!0;
if(za.enable_outlining)switch(b.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Y(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.Db)return!0;return!1}else return!1}function A(b){if(za.Qe)switch(b.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Y(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++)if(Ob.Cp(d[e]))return!0;return!1}else return!1}function N(b){b=Y(b,"MESH",a.DATA_ID_ALL);
for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++){var f=d[e],g=f.game_settings.alpha_blend;if(f.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function L(b){switch(b.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0}b=Y(b,"EMPTY",a.DATA_ID_ALL);for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_anchor&&d.b4w_anchor.detect_visibility)return!0}return!1}function M(a,b,c){var d=wa.sh(a,b);wa.ue(a,d,function(a,b,d){if(d.Ma){switch(d.L){case "COLOR":case "CUBEMAP":a=
b.h.bb;break;case "DEPTH":a=b.h.Ic;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.uf)throw"Batch texture can't use renderbuffer";fa.Ep(c.Xb,d.ea)&&T.Lg(c,a,d.ea)}}});for(a=0;a<b.la.length;a++){var d=b.la[a],e=b.Cd[a];switch(d.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;
default:if(e.uf)throw"Batch texture can't use renderbuffer";fa.Ep(c.Xb,d.ea)&&T.Lg(c,e,d.ea)}}}function G(a,b){return{Ta:!0,hm:[!0,!0,!0,!0,!0,!0],sd:a,D:b}}function D(a,b,c,d,e){switch(a.type){case "MAIN_OPAQUE":O(a,b,c,"OPAQUE",d,e);break;case "MAIN_BLEND":O(a,b,c,"BLEND",d,e);break;case "MAIN_XRAY":O(a,b,c,"XRAY",d,e);break;case "MAIN_GLOW":O(a,b,c,"GLOW",d,e);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var f=b.d,g=b.n,h=0;h<g.length;h++){var k=g[h];if(("MAIN"==k.type||"NODES"==
k.type||"PARTICLES"==k.type)&&"REFLECT"==k.Ka){if("MAIN_PLANE_REFLECT"==a.type){var l;a:{if(d.d.xb){l=d.d.xb.Li;for(var K=0;K<l.length;K++)if(l[K]==a){l=K;break a}}l=null}if(l==f.tc)continue}else{a:{if(d.d.xb)for(l=d.d.xb.Nj,K=0;K<l.length;K++)if(l[K]==a){l=K;break a}l=null}if(l==f.mc)continue}e||(Q(k,a,b,c,"REFLECT",d),l=k.gb,fa.s(l,"DISABLE_FOG",0),fa.s(l,"WATER_EFFECTS",0),"special_skydome.glslf"==fa.Bq(l)&&fa.s(l,"REFLECTION_PASS",1),fa.s(l,"SHADOW_SRC","SHADOW_SRC_NONE"),fa.s(l,"TEXTURE_NORM",
0),P(d,k),T.zb(k),U(k));a.p.push(G(f,k))}}break;case "DEPTH":f=b.d;b=b.n;for(g=0;g<b.length;g++)if(h=b[g],"DEPTH"==h.type&&!h.fc&&"DEPTH"==h.Ka){if(!e){k=h;K=a;l=f;var n=c,H=d,p=k.gb;if(la.Cy(n,K,"SHADOW_CAST"))if(k.Jb){if("DEPTH"!=za.gf)throw"Wrong shadows type";fa.s(p,"SHADOW_SRC","SHADOW_SRC_DEPTH");fa.s(p,"SHADOW_DST","SHADOW_DST_MASK");T.ul(k,H.d.wd);la.Cq(n,K)}else fa.s(p,"SHADOW_SRC","SHADOW_SRC_NONE"),fa.s(p,"SHADOW_DST","SHADOW_DST_MASK");else fa.s(p,"SHADOW_SRC","SHADOW_SRC_NONE"),fa.s(p,
"SHADOW_DST","SHADOW_DST_NONE");k.lb&&(K=la.Ca(n,"GRASS_MAP"))&&X(k,K,l);T.zb(k);U(k)}a.p.push(G(f,h));M(c,a,h);V(h)}break;case "SHADOW_CAST":f=!1;g=b.d;b=b.n;h=la.Ca(c,"GRASS_MAP");for(k=0;k<b.length;k++)if(l=b[k],"DEPTH"==l.type&&"SHADOW_CAST"==l.Ka){f=!0;if(!e){if("DEPTH"!=za.gf)throw"Wrong shadows type";fa.s(l.gb,"SHADOW_SRC","SHADOW_SRC_NONE");fa.s(l.gb,"SHADOW_DST","SHADOW_DST_DEPTH");l.lb&&h&&X(l,h,g);T.ka(l,"SHADOW_TEX_RES",fa.u(d.d.wd.csm_resolution));T.zb(l);U(l)}a.p.push(G(g,l))}f&&R(a,
la.Ca(c,"MAIN_OPAQUE"),a.p,d,!0);break;case "COLOR_PICKING":pa(a,b,e);break;case "COLOR_PICKING_XRAY":pa(a,b,e);break;case "OUTLINE_MASK":c=b.d;d=b.n;for(b=0;b<d.length;b++)f=d[b],"COLOR_ID"==f.type&&"OUTLINE"==f.Ka&&(e||(T.ka(f,"USE_OUTLINE",1),T.zb(f),U(f)),a.p.push(G(c,f)));break;case "GRASS_MAP":c=b.d;d=b.n;for(b=0;b<d.length;b++)f=d[b],"GRASS_MAP"==f.type&&(e||(T.zb(f),U(f)),a.p.push(G(c,f)),f=a.h,l=c.$a,g=a.$b[0],h=a.$b[1],k=a.$b[2],0==g&&0==h?(g=l.min_y,h=l.max_y):(g=Math.min(g,l.min_y),h=
Math.max(h,l.max_y)),l=1E-4*(h-g),a.$b[0]=g-l,a.$b[1]=h+l,ta.Ok(f,k/2,-h,-g,k/2),ta.ff(f));break;case "WIREFRAME":for(d=b.d,b=b.n,f=0;f<b.length;f++)g=b[f],"WIREFRAME"==g.type&&(e||(g.lb&&(h=la.Ca(c,"GRASS_MAP"))&&X(g,h,d),T.zb(g),U(g)),a.p.push(G(d,g)),M(c,a,g),V(g))}}function O(a,b,c,d,e,f){for(var g=b.d,h=b.n,k=0;k<h.length;k++){var l=h[k];l.fc||l.Hb||"MAIN"!=l.type&&"NODES"!=l.type&&"NODES_GLOW"!=l.type&&"PARTICLES"!=l.type||!("OPAQUE"==l.Ka&&"OPAQUE"==d||"BLEND"==l.Ka&&"BLEND"==d||"XRAY"==l.Ka&&
"XRAY"==d||"NODES_GLOW"==l.type&&"GLOW"==d)||(f||(Q(l,a,b,c,d,e),P(e,l),T.zb(l),U(l)),a.p.push(G(g,l)),M(c,a,l),V(l))}a.p.sort(function(a,b){var c;if(a.D&&b.D){c=a.D.Fa;var d=b.D.Fa;(c=c==d?0:c>d?1:-1)||(c=a.D.jg,d=b.D.jg,c=c==d?0:c>d?1:-1)}else c=0;return c})}function Q(a,b,c,d,e,f){var g=c.d;if("OPAQUE"===e)var h=la.Ca(d,"SHADOW_CAST")&&a.Jb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE";else if("BLEND"===e||"XRAY"===e)if(la.Ca(d,"SHADOW_CAST")&&a.Jb)switch(za.gf){case "DEPTH":h="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";
}else h="SHADOW_SRC_NONE";else if("REFLECT"===e||"GLOW"===e)h="SHADOW_SRC_NONE";else throw"Wrong main subscene type";e=a.gb;var k=f.d.wd;fa.s(e,"SHADOW_SRC",h);T.ul(a,k);h=b.ig;fa.s(e,"NUM_LIGHTS",h);fa.s(e,"NUM_LFACTORS",0==h%2?h/2:Math.floor(h/2)+1);"special_skydome.glslf"==fa.Bq(e)&&fa.s(e,"REFLECTION_PASS",0);fa.s(e,"SSAO_ONLY",0);b.Xa&&b.bd?fa.s(e,"WATER_EFFECTS",1):fa.s(e,"WATER_EFFECTS",0);b.Xa&&b.If&&g.If?(fa.s(e,"CAUSTICS",1),fa.s(e,"CAUST_SCALE",b.zp),fa.s(e,"CAUST_SPEED",fa.u(b.Ap,2)),
fa.s(e,"CAUST_BRIGHT",b.yp)):fa.s(e,"CAUSTICS",0);b.Xa&&(fa.s(e,"WAVES_HEIGHT",fa.u(b.xf)),fa.s(e,"WAVES_LENGTH",fa.u(b.Fg)),fa.s(e,"WATER_LEVEL",fa.u(b.wf)));-1!==a.Kb.indexOf("u_mirrormap")?fa.s(e,"REFLECTION_TYPE","REFL_MIRRORMAP"):a.wc?null!=g.mc&&la.Ca(d,"MAIN_CUBE_REFLECT")?(c=f.d.xb?f.d.xb.Nj[c.d.mc]:null)?(c=c.h.bb,T.Lg(a,c,"u_cube_reflection"),fa.s(e,"REFLECTION_TYPE","REFL_CUBE")):fa.s(e,"REFLECTION_TYPE","REFL_NONE"):null!=g.tc&&la.Ca(d,"MAIN_PLANE_REFLECT")?(c=f.d.xb?f.d.xb.Li[c.d.tc]:
null)?(c=c.h.bb,T.Lg(a,c,"u_plane_reflection"),fa.s(e,"REFLECTION_TYPE","REFL_PLANE")):fa.s(e,"REFLECTION_TYPE","REFL_NONE"):fa.s(e,"REFLECTION_TYPE","REFL_NONE"):fa.s(e,"REFLECTION_TYPE","REFL_NONE");(h=la.Ca(d,"SKY"))?a.js?(c=h.h.bb,T.Lg(a,c,"u_sky")):za.Gk?(a.lc=h.lc,fa.s(e,"PROCEDURAL_FOG",1)):fa.s(e,"PROCEDURAL_FOG",0):fa.s(e,"PROCEDURAL_FOG",0);c=f.d.Go;c.so&&(fa.s(e,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==c.lm?(c=c.mm?T.Zx(c.mm,!1):h.h.bb,fa.s(e,"SKY_TEXTURE",1),T.Lg(a,c,"u_sky_texture")):
"SKY_COLOR"==c.lm&&fa.s(e,"SKY_COLOR",1));a.lb&&(c=la.Ca(d,"GRASS_MAP"))&&X(a,c,g);a.Kn?(za.ji&&fa.s(e,"USE_REFRACTION_CORRECTION",1),"NODES"==a.type||"NODES_GLOW"==a.type?(fa.s(e,"REFRACTIVE",1),f.d.td?fa.s(e,"USE_REFRACTION",1):fa.s(e,"USE_REFRACTION",0)):f.d.td?fa.s(e,"REFRACTIVE",1):fa.s(e,"REFRACTIVE",0)):(fa.s(e,"REFRACTIVE",0),fa.s(e,"USE_REFRACTION",0),fa.s(e,"USE_REFRACTION_CORRECTION",0));a.vf&&(a.Do&&la.Ca(d,"DEPTH")?fa.s(e,"SHORE_SMOOTHING",1):fa.s(e,"SHORE_SMOOTHING",0),a.water_dynamic&&
b.Xa&&b.xf?fa.s(e,"DYNAMIC",1):fa.s(e,"DYNAMIC",0));"PARTICLES"==a.type&&(fa.s(e,"SIZE_RAMP_LENGTH",a.Yr),fa.s(e,"COLOR_RAMP_LENGTH",a.Pr));if(!a.Qf)for(b=a.N,d=0;d<b.length;d++)if(c=b[d],"SCENE"==c.source)for(g=0;g<Ga.length;g++)for(var h=Ga[g],k=Ga[g].fd,l=0;l<k.length;l++)k[l].d==c&&wa.l(xb,h,f,null);if(a.jh){b=0;for(var K in a.jh)b++;a.bn=new Float32Array(3*b);a.$m=new Float32Array(3*b);a.Zm=new Float32Array(3*b);a.an=new Float32Array(4*b);fa.s(e,"NUM_LAMP_LIGHTS",b);for(d=0;d<f.ua.LAMP.length;d++)Z(a,
f.ua.LAMP[d])}}function Z(a,b){var c=b.uuid;if(c in a.jh){c=a.jh[c];a.bn.set(b.d.g,3*c);a.$m.set(b.ma.direction,3*c);a.Zm.set(b.ma.Og,3*c);var d=Tb,e=b.ma;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.sf?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var f=d[0]=Math.cos(e.Zc/2);d[1]=e.wg*(1-f)}a.an.set(d,4*c)}}function P(b,c){var d=Y(b,"LAMP",a.DATA_ID_ALL);c.gb.fn=[];for(var e=u(d)||d[0],f=0;f<d.length;f++){var g=d[f].ma;if("SPOT"==g.type||"POINT"==g.type)var h=Math.cos(g.Zc/
2);if("SPOT"==g.type)var k=g.wg*(1-h);var l=g.index;c.gb.fn.push({type:g.type,index:l,Xy:Math.floor(l/2),Wy:0==l%2?"rg":"ba",Zc:h,wg:k,distance:g.distance,Ry:g.Ag||g.sf,Hx:l==e.ma.index})}}function U(a){var b=a.Xb.attributes,c=a.S.Ub,d;for(d in b)c[d]||Da.pa('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES"==a.type||"NODES_GLOW"==a.type)if(b=fa.uy(a.Xb.Ao),10<b&&("MAIN"==a.type&&Ea.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Lc.join(", ")+'"'),"NODES"==a.type||
"NODES_GLOW"==a.type))d=c=0,a.Dg&&(c=Da.nd(a.Dg)),a.hb&&(d=Da.nd(a.hb)),Ea.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Lc.join(", ")+'"')}function V(a){8<a.N.length&&Ea.warn("too many textures used - "+a.N.length+' (max 8), materials "'+a.Lc.join(", ")+'"')}function X(a,b,c){a.$b=b.$b;var d=b.$b[0],e=b.$b[1],f=b.$b[2];c=c.Nb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.$b[2]=f;b=b.h;ta.Ok(b,f/2,-e,-d,f/2);ta.ff(b);d=a.Km||0;d=
0==d?c:Math.max(d,c);a.Km=d}function ia(a){var b=ba(a,"MAIN_OPAQUE"),c=!0;wa.T(a.d.nb,function(d,e){"SHADOW_CAST"===e.type&&(R(e,b,e.p,a,c),c=!1)})}function R(b,c,d,e,f){if(0!=d.length){var g=b.h;c=c.h;var h=Y(e,"LAMP",a.DATA_ID_ALL),h=u(h)||h[0],k=h.d;ta.Bs(g,k.g,k.quat);lb.copy(c.Pe,g.Pe);hb.copy(c.fa,g.Es);if("SPOT"==h.ma.type||"POINT"==h.ma.type)ta.ff(g,g.va);else{h=$a;Fa.Gd(h);for(k=0;k<d.length;k++){var l=d[k].sd;0==k?Fa.Np(l.$a,h):Fa.dq(h,l.$a)}d=Fa.sx(h,aa);Da.af(d,g.fa,d);if(e.d.wd.enable_csm){e=
lb.copy(c.fi[b.Xl],pb);h=hb.invert(c.fa,rb);Da.af(e,h,e);Da.af(e,g.fa,e);b=c.Yl[b.Xl];if(f)for(sb=0,f=2;f<d.length;f+=3)sb=Math.min(sb,d[f]);f=$a;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=sb}else{b=f=$a;c=zb;c.set(d);e=Ra/9;d=hb.identity(rb);hb.rotate(d,e,Da.AXIS_MZ,d);k=h=-1;for(l=0;10>l;l++){var K=Fa.Bv(c,Ba),n=(K.max_x-K.min_x)*(K.max_y-K.min_y);if(-1==h||n<h)h=n,k=l,Fa.Np(K,b);Da.af(c,d,c)}b=k*e;0<b&&(c=hb.identity(rb),hb.rotate(c,b,Da.AXIS_MZ,c),hb.multiply(c,
g.fa,g.fa));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}ta.kA(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);ta.ff(g)}Da.qm(g.Fd,g.Uj)}}function u(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function pa(a,b,c){var d=b.d;b=b.n;for(var e=0;e<b.length;e++){var f=b[e];"COLOR_ID"==f.type&&
("COLOR_PICKING"==a.type&&"COLOR_ID"==f.Ka||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==f.Ka)&&(c||(T.ka(f,"USE_OUTLINE",0),T.zb(f),U(f)),a.p.push(G(d,f)))}}function ha(a,b){for(var c=W(b,ob),d=a.ma,e=a.d,f=d.index,g=0;g<c.length;g++){var h=c[g];h.bg.set(e.g,3*f);h.$f.set(d.direction,3*f);h.Zf.set(d.Og,3*f);switch(d.type){case "SUN":if(h.bt.set(e.quat),h.at=d.Og,"SKY"===h.type){var k=pb;k[0]=k[1]=k[2]=1;var l=Math.acos(lb.dot(h.Uk,k)),k=Math.acos(lb.dot(d.direction,k));h.rk=Math.floor(l/.025)!=
Math.floor(k/.025)?!0:!1;lb.copy(d.direction,h.Uk);ea(b,h)}else lb.copy(d.direction,h.Uk);case "HEMI":case "POINT":case "SPOT":break;default:Ea.error("Unknown light type: "+d.type+'".')}l=va;l[0]=d.Ag?1:0;l[1]=d.sf?1:0;h.ag.set(l,2*f);h.ja=!0;for(l=0;l<h.p.length;l++)k=h.p[l].D,k.jh&&Z(k,a)}}function ea(a,b){Va.li(b);if(b.rk)for(var c=W(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].p,f=0;f<e.length;f++){var g=e[f];g.Ta&&(g=g.D,T.Qv(g)&&Va.tB(g))}}function Y(b,
c,d){if(!b.ua)throw"Access to uninitialized scene";b=b.ua[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.oc==d&&c.push(f)}return c}function na(b){var c=[];b=Y(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function H(a,b,c){for(var d=a.d,e=a.camera.d.G,f=0;f<e.length;f++){var g=e[f];ta.ff(g,b/c);d.Ln&&ta.qo(g,d.wd)}d.Ln&&(d.sk=!0,ba(a,"DEPTH").ja=!0,ba(a,
"MAIN_BLEND").ja=!0);var h=d.nb;la.nB(h,function(d,e,f){if(d.Oh){var g=d.mf*b,k=d.mf*c;if(e)for(e=0;e<f.la.length;e++)f.la[e]==d&&Qa.resize(d.ra,g,k);else switch(Qa.Ai(d.ra)&&Qa.resize(d.ra,g,k),d=f.h,d.width=g,d.height=k,f.type){case "DOF":xa(a,{dof_power:f.h.dof_power,dof_on:f.h.dof_on});break;case "GLOW_COMBINE":ja(a,{small_glow_mask_width:f.small_glow_mask_width,large_glow_mask_width:f.large_glow_mask_width});break;case "BLOOM":ra(a,{bloom_blur:f.bloom_blur});break;case "OUTLINE":f=la.Ga(h,f,
"POSTPROCESSING");g=la.Ga(h,f,"POSTPROCESSING");k=la.Ga(h,g,"POSTPROCESSING");d=la.Ga(h,k,"POSTPROCESSING");la.xc(f,1/b,1/c);la.xc(g,1/b,1/c);la.xc(k,1/b,1/c);la.xc(d,1/b,1/c);break;case "ANTIALIASING":case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":case "SSAO":case "SSAO_BLUR":la.xc(f,1/b,1/c)}}})}function W(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];wa.T(a.d.nb,function(a,b){b.type==e&&c.push(b)})}return c}function ba(a,
b){return la.Ca(a.d.nb,b)}function xa(a,b){var c=ba(a,"DOF");if(!c)return Ea.error("DOF is not enabled on the scene. Check camera settings"),0;var d=a.d.nb;"boolean"==typeof b.dof_on&&(c.h.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.h.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.h.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.h.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.h.dof_power=b.dof_power;var e=la.Ga(d,c,"POSTPROCESSING"),d=la.Ga(d,
e,"POSTPROCESSING");la.Ib(e,c.h.dof_power);la.xc(e,1/c.h.width,1/c.h.height);la.Ib(d,c.h.dof_power);la.xc(d,1/c.h.width,1/c.h.height)}c.ja=!0}function ra(a,b){var c=ba(a,"LUMINANCE_TRUNCED"),d=ba(a,"BLOOM");if(!c||!d)return Ea.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.ja=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.ja=!0);if("number"==typeof b.bloom_blur){var e=a.d.nb,c=la.Ga(e,d,"BLOOM_BLUR"),e=la.Ga(e,c,"BLOOM_BLUR");
d.bloom_blur=b.bloom_blur;la.Ib(c,b.bloom_blur);la.xc(c,1/d.h.width,1/d.h.height);la.Ib(e,b.bloom_blur);la.xc(e,1/d.h.width,1/d.h.height)}}function ja(a,b){var c=ba(a,"GLOW_COMBINE");if(!c)return Ea.error("Glow is not enabled on the scene"),null;for(var d=a.d.nb,e=la.Cq(d,c),f=0;f<e.length;++f){var g=e[f];if("POSTPROCESSING"===g.type&&"GLOW_MASK_LARGE"===g.Ka)var h=g;if("POSTPROCESSING"===g.type&&"GLOW_MASK_SMALL"===g.Ka)var k=g}e=la.Ga(d,h,"POSTPROCESSING");d=la.Ga(d,k,"POSTPROCESSING");"number"==
typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.ja=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,c.ja=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,la.Ib(k,b.small_glow_mask_width),la.xc(k,1/c.h.width,1/c.h.height),k.ja=!0,la.Ib(d,b.small_glow_mask_width),la.xc(d,1/c.h.width,1/c.h.height),d.ja=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,
la.Ib(h,b.large_glow_mask_width),la.xc(h,1/c.h.width,1/c.h.height),h.ja=!0,la.Ib(e,b.large_glow_mask_width),la.xc(e,1/c.h.width,1/c.h.height),e.ja=!0)}function ca(a,b){var c=ba(Aa,"MAIN_OPAQUE");if(!c||!c.Xa)return Ea.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.xf,e=c.Fg,f=c.wf,g=c.Xa;if(!d||!g.Vg)return g.wf;var h=lb.length(c.fj),k=c.time;h&&(k*=h);var l=va;l[0]=20/e*(a-.25*k);l[1]=20/e*(b-.25*k);h=Da.Bp(l);l[0]=17/e*(b+.1*k);l[1]=17/e*(a+.1*k);var l=Da.Bp(l),
h=h+l-1,K=g.dst_noise_scale0,l=g.dst_noise_scale1,n=g.dst_noise_freq0,p=g.dst_noise_freq1,H=va;H[0]=K*(a+n*k);H[1]=K*(b+n*k);K=Da.Vn(H);H[0]=l*(b-p*k);H[1]=l*(a-p*k);l=Da.Vn(H);l*=d*K;if(c.bl)if(p=(a-c.jf[0])/c.kf[0],H=(c.jf[1]+b)/c.kf[1],p+=.5,H+=.5,1<p||0>p||1<H||0>H)d=l;else var p=Da.wq(Aa.d.Qn,c.zh,p,H),K=g.dir_freq,ga=g.dir_noise_scale,q=g.dir_noise_freq,n=g.dir_min_noise_fac,H=g.dst_min_fac,c=e/c.nh/Math.PI,ga=[ga/e*(a+q*k),ga/e*(b+q*k)],e=Math.sqrt(p),d=d*Math.max(p,g.dir_min_shore_fac)*Math.sin(e/
c+K*k)*Math.max(Da.Vn(ga),n),g=Math.max(e,H),d=d*(1-g)+l*g,h=h*p;else d=l;return f+(d+.05*h)}function ka(a,b){a.zi&&"POSTPROCESSING"==a.type&&b.Ta!=a.Ta&&(a.Ta=b.Ta);b.Ta||"OUTLINE"!=a.type||(a.im=0)}function K(a,b,c,d){var e=wa.Ua(a,b);ta.Nk(e.h,c,d);e.vl=!0;wa.rf(a,b,function(b,e,f){f.Ma&&f.L==c&&la.Zv(f)&&ga(a,b,f.ea,d)});wa.ue(a,b,function(b,e,f){f.Ma&&f.L==c&&f.L==f.ea&&K(a,b,c,d)})}function ga(a,b,c,d){a=wa.Ua(a,b).p;for(b=0;b<a.length;b++)T.Tz(a[b].D,d,c)}function sa(a){var b=ba(a,"GRASS_MAP");
if(b){var c=b.h,d=a.camera.d,e=d.g;a=pb;a[0]=0;a[1]=-b.$b[2]/2;a[2]=0;lb.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=qa;b[0]=0;b[1]=0;b[2]=0;b[3]=1;ta.Bs(c,a,b)}}function oa(a,b){wa.T(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.la[0]||!d.Cd[0])throw"Wrong MOTION_BLUR subscene";var e=d.la[0],f=d.Cd[0];d.Cd[0]=d.h.bb;wa.rf(a,c,function(b,c,d){d.Ma&&ga(a,b,d.ea,f)});K(a,c,e.L,f);ga(a,c,e.ea,d.Cd[0]);d.zr=Math.exp(-b/d.pk)}})}function Ca(b,c){var d=0,e=b.Su;0==e.ko&&(e.ko=c);var f=c-
e.ko;if(e.qs&&f/e.Mc>=e.qs)a.clear_outline_anim(b);else{f%=e.Mc;if(f<e.Kr)switch(e=f/(e.Kr/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}b.d.Vc=d}}function Ha(a){wa.T(a.d.nb,function(a,b){b.ja=!0})}function S(a){if("WIND"==a.field.type){a=a.d;Da.quat_to_dir(a.quat,Da.AXIS_Y,ya);lb.normalize(ya,ya);lb.scale(ya,a.xm,ya);a=Ga;for(var b=0;b<a.length;b++)for(var c=W(a[b],yc),d=0;d<c.length;d++)c[d].fj.set(ya)}}function Xa(a){var c=
b();if(c=ba(c,"OUTLINE"))c.$e.set(a),c.ja=!0}var T=m("__batch"),Fa=m("__boundings"),ta=m("__camera"),Ya=m("__config"),Na=m("__constraints"),vb=m("__data"),Ja=m("__debug"),Cb=m("__geometry"),wa=m("__graph"),Ma=m("__hud"),Ob=m("__nodemat"),kb=m("__objects");m("__particles");var wb=m("__physics"),Za=m("__prerender"),eb=m("__primitives"),Ea=m("__print"),Va=m("__renderer"),la=m("__scenegraph"),fb=m("__sfx"),fa=m("__shaders"),Qa=m("__textures"),Da=m("__util"),lb=m("vec3"),hb=m("mat4"),za=Ya.o,Pa=Ya.Db,
Rb=Ya.Od,Eb="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),xc=["ARMATURE","EMPTY","MESH","SPEAKER"],fc="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.zC=fc;var ob="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),pc="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),
yc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),mb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Fb=0,Ka=null,Aa=null,Ga=[],xb=null,ib=[],Sb=0,Gb=0,Hb=1,yb=0,Db=0,Ra=Math.PI/2;a.zf=0;a.fl=1;a.gl=2;a.DATA_ID_ALL=-1;var va=new Float32Array(2),pb=new Float32Array(3);new Float32Array(4);var Tb=new Float32Array(4),qa=new Float32Array(4),
rb=new Float32Array(16),aa=new Float32Array(24),zb=new Float32Array(24),$a=Fa.Gd(),Ba=Fa.Gd(),ya=new Float32Array(3),sb=null;a.set_active=function(a){Aa=a;fb.hA(a)};a.Fz=function(a,b){var c=a.d,d=la.Hw(c.nb);if(a==b){H(a,Sb,Gb);for(var e=0;e<d.length;e++)a.d.qg.push(d[e])}else for(e=a.fd[0],H(a,e.d.vg,e.d.vg),e=0;e<d.length;e++)b.d.qg.push(d[e]);d=W(a,yc);for(e=0;e<d.length;e++)d[e].fj.set(ya);for(e=0;e<c.qg.length;e++)"SHADOW_CAST"==c.qg[e].type&&Va.li(c.qg[e])};a.ah=c;a.sm=d;a.get_active=b;a.ga=
function(){return Aa?!0:!1};a.Vj=function(a){return a.camera};a.ui=function(){return Ga};a.my=function(){if(1==Ga.length)return Ga;for(var a=[],b=0;b<Ga.length;b++){var c=Ga[b];if(!c.fd.length){b=wa.sh(xb,c);b=wa.Zs(xb,b,wa.Jo);b=wa.mo(b);wa.T(b,function(b,c){a.push(c)});break}}return a};a.od=function(b,c,d,f){for(var g=Ga,h=null,k=0;k<g.length;k++){var l=Y(g[k],"ALL",a.DATA_ID_ALL);switch(b){case a.zf:h=e(c,l,!1,d);break;case a.fl:h=null;(l=e(c,l,!1,f))&&l.dupli_group&&(h=e(d,l.dupli_group.objects,
!0,f));break;case a.gl:for(var h=null,K=0;K<c.length;K++)if((h=e(c[K],l,0!=K,d))&&h.dupli_group)l=h.dupli_group.objects;else break}if(h)break}return h};a.iv=function(a,b,c){for(var d in xc){var e=xc[d],f=h(a,e),g=b.d.Ph,k=!1;for(d=0;d<c.length;d++)if(k=!0,c[d].d&&c[d].d.Yf){for(var l=0;l<g.length;l++)g[l]==c[d]&&(k=!1);k&&g.push(c[d])}e in b.ua||(b.ua[e]=[]);for(l=0;l<f.length;l++)Da.is_armature(f[l])&&f[l].proxy||(b.ua.ALL.push(f[l]),b.ua[e].push(f[l]))}};a.cv=function(b,c){b.ua={ALL:[]};for(var d in Eb){var e=
Eb[d],k=h(b,e);b.ua[e]=[];for(var K=0;K<k.length;K++)Da.is_armature(k[K])&&k[K].proxy||(b.ua.ALL.push(k[K]),b.ua[e].push(k[K]))}b.fd=b.fd||[];b.d=b.d||{};b.Ya=null;e=b.d;k=b.camera.d;d=b.world.b4w_shadow_settings;K=e.wd={};d.csm_resolution>za.qd?(K.csm_resolution=za.qd,Ea.error("Shadow map texture has unsupported size. Changed to "+za.qd+".")):K.csm_resolution=d.csm_resolution;K.self_shadow_polygon_offset=d.self_shadow_polygon_offset;K.self_shadow_normal_offset=d.self_shadow_normal_offset;K.enable_csm=
d.b4w_enable_csm;var H=Y(b,"LAMP",a.DATA_ID_ALL);if(H=u(H)||H[0])K.cn=H.ma.type,K.Zc=H.ma.Zc,K.distance=H.ma.distance,"SPOT"!=K.cn&&"POINT"!=K.cn||!K.enable_csm||(Ea.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),K.enable_csm=!1);K.enable_csm?(K.csm_num=d.csm_num,K.csm_first_cascade_border=d.csm_first_cascade_border,K.first_cascade_blur_radius=d.first_cascade_blur_radius,K.csm_last_cascade_border=d.csm_last_cascade_border,K.last_cascade_blur_radius=d.last_cascade_blur_radius,
K.fade_last_cascade=d.fade_last_cascade,K.blend_between_cascades=d.blend_between_cascades):(K.csm_num=1,K.csm_first_cascade_border=d.csm_first_cascade_border,K.first_cascade_blur_radius=d.first_cascade_blur_radius,K.csm_last_cascade_border=d.csm_last_cascade_border,K.last_cascade_blur_radius=d.last_cascade_blur_radius,K.fade_last_cascade=!1,K.blend_between_cascades=!1);e.Ph=[];for(d=0;d<c.length;d++)c[d].d&&c[d].d.Yf&&e.Ph.push(c[d]);d=b.world.b4w_fog_color;e.Yb=new Float32Array([d[0],d[1],d[2],b.world.b4w_fog_density]);
e.xg=n(b);e.Sk=w(b,e.xg);e.Go=r(b,e.Sk);e.mr=Y(b,"LAMP",a.DATA_ID_ALL).length;e.Xa=l(b);e.dz=y(b);e.we=N(b);e.Wu=L(b);e.Gr=0;k.G[0].type!=ta.Mb&&za.anaglyph_use?(Ea.warn("Anaglyph stereo is disabled for the non-perspective camera"),d=!1):d=za.anaglyph_use;e.anaglyph_use=d;e.Ln=za.ji&&f(b);e.vD=b.world.b4w_fog_color;e.shore_smoothing=g(b);e.xb=p(b);e.Gv=E(b);e.hz=B(b);e.Ov=v(b);e.xy=t(b);e.vz=x(b);e.Re=I(b);e.Ug=za.Ug&&(0<k.dof_distance||k.Zd);e.lb=q(b);e.ph=za.ph&&b.b4w_enable_motion_blur;e.Qg=za.Qg&&
b.b4w_enable_color_correction;e.antialiasing=za.antialiasing&&b.b4w_enable_antialiasing;e.Mg=za.Mg&&b.b4w_enable_bloom&&e.xg;e.nf=za.nf&&b.b4w_enable_ssao;e.VA=z(b);e.dh=za.dh&&b.b4w_enable_god_rays&&e.xg;e.td=za.td&&b.b4w_render_refractions;e.ex=za.ji;e.fw=C(b);e.outline=J(b);e.Qe=A(b);e.Jm=b.world.b4w_render_glow_over_blend;d=b.fd.sort(function(a,b){return b.d.vg-a.d.vg});e.nb=la.Gw(e,k,d);e.qg=[];e.sk=!1;e.wn=!1;Ga.push(b);xb||(xb=wa.create());wa.v(xb,b)};a.Rl=h;a.Gm=function(a){return a.d.nb};
a.Ix=function(a){wa.T(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=T.Rp(c.Fk);break;case "SSAO":d=T.Nw(c);break;case "SSAO_BLUR":d=T.Ow(c);break;case "DEPTH_PACK":d=T.ww();break;case "REFRACT":case "COPY":d=T.Rp("NONE");break;case "GOD_RAYS":la.Ga(a,c,"WIREFRAME")||la.Ga(a,c,"MAIN_BLEND")||la.Ga(a,c,"GOD_RAYS");d=T.Aw(c.Zr,c.vf,c.Hh);break;case "GOD_RAYS_COMBINE":la.Ga(a,c,"WIREFRAME")||la.Ga(a,c,"MAIN_BLEND");la.Ga(a,c,"GOD_RAYS");d=T.Bw();break;case "MOTION_BLUR":d=T.Ew(c.ok);
break;case "DOF":var d=T.xw(),e=la.Ga(a,c,"POSTPROCESSING"),f=la.Ga(a,e,"POSTPROCESSING");la.Ib(e,c.h.dof_power);la.Ib(f,c.h.dof_power);break;case "OUTLINE":var d=T.Fw(),e=la.Ga(a,c,"POSTPROCESSING"),f=la.Ga(a,e,"POSTPROCESSING"),g=la.Ga(a,f,"POSTPROCESSING"),h=la.Ga(a,g,"POSTPROCESSING");la.Ib(f,c.Dl);la.Ib(e,c.Dl);la.Ib(h,c.pm*c.Gi);la.Ib(g,c.pm*c.Gi);break;case "GLOW_COMBINE":d=T.zw();break;case "COMPOSITING":d=T.uw();break;case "ANTIALIASING":d=T.qw();break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
T.Lw(c.type);break;case "ANAGLYPH":d=T.ow();break;case "SKY":d=T.Kw();break;case "LUMINANCE":d=T.Cw();break;case "AVERAGE_LUMINANCE":d=T.rw();break;case "LUMINANCE_TRUNCED":d=T.Dw();break;case "BLOOM_BLUR":d=T.sw();break;case "BLOOM":d=la.Ga(a,c,"BLOOM_BLUR");e=la.Ga(a,d,"BLOOM_BLUR");la.Ib(d,c.bloom_blur);la.Ib(e,c.bloom_blur);d=T.tw();break;case "VELOCITY":d=T.Rw();break;case "ANCHOR_VISIBILITY":d=T.pw()}d&&(e=G(kb.Lj("NONE"),d),U(d),c.p.push(e),M(a,c,d),V(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=
a.d.nb,e=b.d;!la.Ca(d,"SHADOW_CAST")&&e.Jb&&(e.Jb=!1);e=W(a,fc);c&&(wb.has_physics(b)&&wb.append_object(b,a),a.ua.ALL.push(b),a.ua[b.type].push(b),b.za&&b.za.dupli_group.objects&&(b.origin_name=b.name,b.za.dupli_group.objects.push(b)));for(var f=0;f<e.length;f++)D(e[f],b,d,a,c);break;case "LAMP":b.ma.index=a.d.Gr++;c=W(a,ob);for(d=0;d<c.length;d++)c[d].ig++;ha(b,a)}};a.remove_object=function(a){if(!a.d.Wm)return!1;var c=b();vb.Ez(c,a,!1);var d=c.ua.ALL.indexOf(a);-1!=d&&c.ua.ALL.splice(d,1);d=c.ua[a.type].indexOf(a);
-1!=d&&c.ua[a.type].splice(d,1);a.za&&a.za.dupli_group.objects&&(d=a.za.dupli_group.objects.indexOf(a),-1!=d&&a.za.dupli_group.objects.splice(d,1));Na.Tv(a)&&Na.remove(a);return!0};a.FC=D;a.On=function(a){a.d.sk=!0};a.dy=function(a,b){for(var c=a.d.wd,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=ta.Tw(c,b,e);return d};a.hide_object=function(a){a.d.fh=!0};a.show_object=function(a){a.d.fh=!1};a.is_hidden=function(a){return a.d.fh};a.Oz=function(a,b,c){b=b.d;a=W(a,fc);for(var d=0;d<a.length;d++)for(var e=
a[d].p,f=e.length-1;0<=f;f--){var g=e[f];g.sd==b&&(g.D&&c&&Cb.Gp(g.D.S),e.splice(f,1))}};a.check_object=function(a,b){return b.ua[a.type]&&-1<b.ua[a.type].indexOf(a)?!0:!1};a.IA=function(a){var b=a.ua.LAMP;if(b.length==a.d.Gr){for(var c=[],d=0;d<b.length;d++)c[b[d].ma.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].ma,g=b[c[e]].ma;if(g.Ag&&g.sf&&(!f.Ag||!f.sf)||!f.Ag&&(g.Ag||!f.sf&&g.sf))f=c[d],c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].ma.index=d,ha(b[c[d]],a)}};
a.yg=ha;a.cleanup=function(){for(var a=0;a<Ga.length;a++){var b=Ga[a];wa.T(b.d.nb,function(a,b){if("SINK"!=b.type){var c=b.h;Va.Qz(c.ce,c.bb,c.Ic,c.width,c.height);for(var c=b.p,d=0;d<c.length;d++){var e=c[d].D;e&&T.ew(e)}}});b.d.nb=[];b.d.qg=[]}Aa=Ka=null;Ga.length=0;xb=null;ib.length=0;ya[0]=0;ya[1]=0;ya[2]=0};a.vr=function(a,b,c){a=ta.tx(a,a.Va,a.cb,null,!0);var d=eb.Nx(a);a=kb.Lj("DYNAMIC");a.$a=a.Nb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.sb=a.Rc=Fa.Dv();var e=
a.sb.Da;a.Hf=a.Gf=Fa.Vl([e,0,0],[0,e,0],[0,0,e],a.sb.F);c=T.Jw(d,c);b.p.push(G(a,c))};a.Ia=Y;a.LD=function(a){return[a.frame_start,a.frame_end]};a.Cs=function(a,b,c,d,e){Sb=a;Gb=b;Hb=c;yb=e;Db=d;Aa&&H(Aa,a,b)};a.bB=W;a.ia=ba;a.get_environment_colors=function(a){a=W(a,ob)[0];var b=a.Se,c=a.yf,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Oe,d,e]};a.set_environment_colors=function(a,b,c,d){a=W(a,ob);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Oe=b);c&&f.Se.set(c);
d&&f.yf.set(d);f.ja=!0}};a.get_sky_params=function(a){if(a=ba(a,"SKY")){var b={};b.color=Array(3);lb.copy(a.Ah,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=
a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=ba(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.Ah.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=
b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),
"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.ja=!0,c.rk=!0,ea(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=W(a,pc)[0].Yb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=W(a,pc),d=0;d<c.length;d++){var e=c[d];e.Yb.set(b);e.ja=!0}};a.get_ssao_params=function(a){var b=ba(a,"SSAO");a=ba(a,"SSAO_BLUR");if(!b)return null;var c=b.p[0].D,d={};d.ssao_quality=T.tb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;
d.ssao_blur_depth=a.ssao_blur_depth;d.qp=a.ssao_blur_discard_value;d.radius_increase=b.Eh;d.influence=b.Dh;d.dist_factor=b.Ch;d.ssao_only=b.ssao_only;d.ssao_white=T.tb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=ba(a,"SSAO"),d=ba(a,"SSAO_BLUR");if(!c)return Ea.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.p[0].D;T.ka(e,"SSAO_QUALITY",b.ssao_quality);T.zb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.p[0].D,T.ka(e,"SSAO_HEMISPHERE",
b.ssao_hemisphere),T.zb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.p[0].D,T.ka(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),T.zb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.Eh&&(c.Eh=b.Eh);"number"==typeof b.Dh&&(c.Dh=b.Dh);"number"==typeof b.Ch&&(c.Ch=b.Ch);if("number"==typeof b.ssao_only){c=ba(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.p.length;f++)e=c.p[f].D,T.ka(e,"SSAO_ONLY",b.ssao_only),T.zb(e,!0)}"number"==
typeof b.ssao_white&&(e=c.p[0].D,T.ka(e,"SSAO_WHITE",b.ssao_white),T.zb(e,!0));c.ja=!0;d.ja=!0};a.get_dof_params=function(a){a=ba(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.h.dof_distance;b.dof_front=a.h.dof_front;b.dof_rear=a.h.dof_rear;b.dof_power=a.h.dof_power;b.Zd=a.h.Zd;return b};a.set_dof_params=xa;a.get_god_rays_params=function(a){var b=W(a,["GOD_RAYS"]);a=ba(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].mh;c.god_rays_intensity=a.god_rays_intensity;
c.god_rays_steps=T.tb(b[0].p[0].D,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=W(a,["GOD_RAYS"]),d=ba(a,"GOD_RAYS_COMBINE");if(!c||!d)return Ea.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].mh=e,c[f].Jk=e/c[f].Hh/(f+1),c[f].ja=!0;if("number"==typeof b.god_rays_steps)for(var g=fa.u(b.god_rays_steps,
1),e=c[0].mh,f=0;f<c.length;f++){c[f].Hh=g;c[f].Jk=e/g/(f+1);c[f].ja=!0;var h=c[f].p[0].D;T.ka(h,"STEPS_PER_PASS",g);T.zb(h,!0)}d.ja=!0};a.get_bloom_params=function(a){var b=ba(a,"LUMINANCE_TRUNCED");a=ba(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=ra;a.get_glow_material_params=function(a){a=ba(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=
a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=ja;a.get_wind_params=function(){var a=ya,b=lb.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=Y(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return Ea.error("There is no wind on the scene"),
0;d=g.d;"number"==typeof c.wind_dir&&(pb=[0,c.wind_dir/180*Math.PI,-Math.PI/2],Da.euler_to_quat(pb,qa),d.quat.set(qa),S(g));"number"==typeof c.wind_strength&&(d.xm=c.wind_strength,S(g));Ha(b)};a.cA=function(a){a.d.wn=!0};a.get_water_surface_level=ca;a.get_water_mat_params=function(a,b){var c=ba(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.xf,b.waves_length=c.Fg,c.bd)){b.water_fog_density=c.bd[3];var d=b.water_fog_color=[];d[0]=c.bd[0];d[1]=c.bd[1];d[2]=c.bd[2]}};a.set_water_params=function(a,b){var c=
ba(a,"MAIN_OPAQUE");if(!c||!c.Xa)return Ea.error("set_water_params() - no water parameters on the scene"),null;c=c.Xa;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==
typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Vg=b.water_dynamic);for(var d=W(a,mb),e=0;e<d.length;e++){var f=d[e];
"number"==typeof b.water_fog_density&&c.Yb&&(f.bd[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.Yb&&f.bd.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.xf=b.waves_height);"number"==typeof b.waves_length&&(f.Fg=b.waves_length);f.ja=!0}};a.get_shore_dist=function(a,b){var c=ba(Aa,"MAIN_OPAQUE");if(!c.bl)return 100;var d=c.nh,e=c.wf,f=(a[0]-c.jf[0])/c.kf[0],g=(c.jf[1]+a[2])/c.kf[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*Da.wq(Aa.d.Qn,c.zh,f,g),e=(e-a[1])*
b,e=Math.sqrt(c*c+e*e)};a.update=function(a,c){for(var d=b().camera.d,e=0;e<Ga.length;e++){var f=Ga[e],g=f.d.nb;if(f.d.Xa)var h=d.g[1]-ca(d.g[0],d.g[2]);for(var k=f.d.Ph,l=0;l<k.length;l++){var K=k[l].d,n=K.La,H=K.Yg+K.oa;if(n){var p=Math.round(n.currentTime*K.Zb),ga=K.oa/K.Zb;if(p<K.oa-(za.Xf?5:0)||k[l].d.zg&&p>H)n.currentTime=ga;!K.zg&&p>H&&n.pause();2<=n.readyState&&!n.paused&&Qa.KB(K)}else if(K.wh){n=Math.min(K.wh.length,K.Yg+K.oa);if(K.pe<K.oa||K.zg&&K.pe>=n)K.pe=K.oa;!K.zg&&K.pe>=n&&(K.xh=!1);
n=Math.round(a*Rb.Ha/K.Zb)*K.xs;n!=Fb&&K.xh&&(Qa.HB(K),K.pe++);Fb=n}}wa.T(g,function(b,c){-1<yc.indexOf(c.type)&&(c.time=a);f.d.Xa&&(c.Jl=h)})}for(e=0;e<Ga.length;e++)if(f=Ga[e],l=f.d,d=l.qg,l.sk&&(ia(f),l.sk=!1),l.wn&&(sa(f),l.wn=!1),d.length){f.b4w_enable_motion_blur&&oa(l.nb,c);if(l.outline){for(var q=0,e=0;e<f.ua.MESH.length;e++)l=f.ua.MESH[e],q+=l.d.Vc,-1!=ib.indexOf(l)&&Ca(l,a);wa.T(f.d.nb,function(a,b){"OUTLINE"===b.type&&(b.im=q)})}g=null;for(l=0;l<d.length;l++)"OUTLINE_MASK"==d[l].type&&
(g=l);for(l=0;l<d.length;l++)k=d[l],Za.Gn(k),null!==g&&ka(k,d[g]),Va.li(k)}za.show_hud_debug_info&&Ma.DA(Ga,c)};a.Em=function(a){var b=[];wa.T(a.d.nb,function(a,c){b.push(c)});return b};a.apply_outline_anim=function(a,b,c,d){a.Su={ko:0,Kr:b,Mc:c,qs:d};-1==ib.indexOf(a)&&ib.push(a)};a.clear_outline_anim=function(a){a.d.Vc=0;a=ib.indexOf(a);-1!=a&&ib.splice(a,1)};a.bD=function(){ib=[]};a.get_cam_water_depth=function(){var a=ba(Aa,"MAIN_BLEND"),b=Aa;return a||b.d.Xa?a.Jl:null};a.get_object_data_id=function(a){return a.d.oc};
a.ot=Ha;a.yA=function(a,b){switch(b){case "WM_NONE":a.Ta=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.p.length;c++)a.p[c].D.wireframe_mode=Ja.Qo[b];a.Ta=!0}a.Fa="WM_TRANSPARENT_WIREFRAME"==b;a.ja=!0};a.xA=function(a,b){for(var c=0;c<a.p.length;c++)a.p[c].D.wireframe_edge_color=b,a.ja=!0};a.Zo=function(a,b){for(var c=0;c<b.length;c++)a.ua.ALL.push(b[c]),a.ua.MESH.push(b[c])};a.lt=S;a.pick_object=function(b,d){var e=
c();if(!e)return Ea.error("No active scene"),null;var f=ba(e,"COLOR_PICKING");if(f){b-=Db;d-=yb;b*=Hb;d*=Hb;Za.Gn(f);Va.li(f);var g=ba(e,"COLOR_PICKING_XRAY");g?(Za.Gn(g),Va.li(g),f=g.h):f=f.h;d=f.height-d;for(var h=Va.os(f.ce,b,d),f=Y(e,"MESH",a.DATA_ID_ALL),g=0;g<f.length;g++){var k=f[g].d,l=k.Jj;if(l&&3>Math.abs(255*l[0]-h[0])&&3>Math.abs(255*l[1]-h[1])&&3>Math.abs(255*l[2]-h[2]))return k.Db&&k.Jr&&(Pa.outlining_overview_mode?(Xa(Pa.$e),k.Vc=Pa.Vc,a.apply_outline_anim(f[g],Pa.wk,Pa.xk,Pa.yk)):
(Xa(e.world.b4w_outline_color),k.Vc=e.world.b4w_outline_factor,e=k.Fi,a.apply_outline_anim(f[g],e.wk,e.xk,e.yk))),f[g]}}else Ea.error("Object Selection is not available on the scene");return null};a.set_outline_color=Xa;a.wy=function(){return ya};a.oy=function(b){var c=[];b=Y(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.ug&&c.push(e)}return c};a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);
return b};a.qB=function(){for(var b=Aa,c=Y(b,"MESH",a.DATA_ID_ALL),d=0;d<c.length;d++)for(var e=c[d].n,f=0;f<e.length;f++){var g=e[f];if("MAIN"==g.type||"NODES"==g.type)P(b,g),T.zb(g)}};a.Jq=function(){return Hb};a.kt=function(a,b){var c=b.d.sb.F,d=a.d.xb?a.d.xb.Nj[b.d.mc]:null;if(d){var e=pb;lb.negate(c,e);for(c=0;6>c;c++){var f=d.gi[c],g=d.Zl[c],h=d.h;hb.translate(Da.Gt[c],e,f);hb.multiply(h.qa,f,h.Fd);Da.qm(h.Fd,g)}}};a.xv=function(a,b){b.d.xb&&(a.d.dc=b.d.xb.Li[a.d.tc].h.dc)};a.nt=function(a,
b){var c=b.d.xb.Kk[a],d=b.d.xb.Li[a].h;Da.lB(c.d.g,c.d.quat,Da.AXIS_Y,d.dc);ta.wA(d,b.camera)}};b4w.module.__physics=function(a,m){function c(a,b){for(var d=a.Fc,e=0;e<d.length;e++)d[e].d.$k&&b.push(d[e]),c(d[e],b)}function d(a,c){if(V)switch(a){case C.Ot:V.m.Ct=!0;C.t(C.qu,Date.now()-performance.now(),Q.pd,Q.Lv?Z.oq:0);break;case C.Pt:r.log(c);break;case C.Kt:r.error(c);break;case C.Lt:q.fbmsg.apply(this,c.slice(1));break;case C.Tt:var d=b(c.body_id);if(d){var e=c.trans,f=c.quat,g=c.linvel,h=c.angvel,d=d.m;d.$l=c.time;N.set_sep(e,1,f,d.am);G.copy(g,d.sr);G.copy(h,d.$o)}break;case C.Rt:(e=b(c.chassis_hull_body_id))&&
N.set_sep(c.trans,1,c.quat,e.j.Oi[c.prop_ind]);break;case C.Mt:if(d=b(c[1]))e=c[4],d=d.Gc.zj[c[2]],A.set_translation(d,c[3]),A.set_rotation(d,e),A.w(d);break;case C.Ut:if(d=b(c[1]))d.j.speed=c[2];break;case C.Ht:for(var e=c.body_id_a,d=c.body_id_b,f=c.result,g=c.coll_point,e=parseInt(e),h=V.m.p,k=0;k<h.length;k++)for(var l=h[k].vb,n=0;n<l.hd.length;n++){for(var p=l.hd[n],t=p.Ak,y=!1,w=0;w<t.length;w++){var m=t[w];if(m[0]===e&&m[1]===d){p.bs[w]=f;y=!0;break}}if(y){t=p.bs;for(w=y=0;w<t.length;w++)y=
y||t[w];p.callback(y,g)}}break;case C.It:if(d=b(c[1]))d=d.m,d.Ij&&d.Ij(c[2]);break;case C.St:if(d=b(c.body_id))for(d=d.m,f=c.from,g=c.to,h=c.local,k=c.body_id_b_hit,l=c.cur_result,n=0;n<d.bf.length;n++)if(t=d.bf[n],L.Hj(t.L,f)&&L.Hj(t.ea,g)&&t.local==h){for(e in t.ne)t.ne[e]=1;-1!=k&&(t.ne[k]=l);for(var p=t.kc,w=t.callback,t=t.ne,y=!1,m=1,z=0;z<V.m.p.length;z++){var v=V.m.p[z].vb;if(("ANY"==p||v.id==p)&&v.O in t&&1!==t[v.O]){y=!0;m=t[v.O];break}}w(y,m)}break;case C.Qt:console.log("Physics message ping: ",
performance.now()-c[1]);break;case C.Nt:P=c[1];break;case C.Jt:console.log(c[1]);break;default:r.error("Wrong message: "+a)}}function b(a){return ia[a]||null}function e(){R.body++;return R.body}function h(a){return{O:a,nn:0,gk:!1,lf:!0,dE:!1,is_character:!1,My:!1,Kj:null,id:"",dD:{},hd:[],Ij:null,bf:[],$l:0,am:new Float32Array([0,0,0,1,0,0,0,1]),sr:new Float32Array(3),$o:new Float32Array(3),Dj:new Float32Array(3),Cj:new Float32Array(4)}}function k(a,b){switch(a){case "BOX":var c=b.Nb;break;case "CYLINDER":c=
b.zl;break;case "CONE":c=b.yl;break;case "SPHERE":c=b.Rc;break;case "CAPSULE":c=b.xl}return c}function f(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.F&&(b.center=a.F);"number"===typeof a.Da&&(b.radius=a.Da);"number"===typeof a.height&&
(b.height=a.height);return b}function n(a,b,c,d){var e=a.d.g,f=b.d.U,g=new Float32Array(16);O.invert(f,g);f=new Float32Array(3);G.transformMat4(e,g,f);switch(b.j.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Nb;C.t(C.Wt,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:C.t(C.Vt,c,f,a.HE)}}function g(a){return a.m&&a.m.Kj?!0:!1}function l(a,b,c,d,e,f,g,h,k,l){var n;R.Mp++;n=R.Mp.toString(16);C.t(C.cu,n,a,h,b.m.O,c,d,e.m.O,f,g,k,l);b.m.Kj=n}function y(a){var b=a.m;if(b&&
(0===b.nn||!0===b.gk||!1===b.lf||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.m.Dj[0]||a.d.g[1]!=a.m.Dj[1]||a.d.g[2]!=a.m.Dj[2]||a.d.quat[0]!=a.m.Cj[0]||a.d.quat[1]!=a.m.Cj[1]||a.d.quat[2]!=a.m.Cj[2])){a.m.Dj.set(a.d.g);a.m.Cj.set(a.d.quat);var b=a.m,c=C.Eq(C.mj);c.body_id=a.m.O;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=pa,D.identity(pa)):c.quat=a.d.quat;C.t(C.mj,c)}a=a.Fc;for(b=0;b<a.length;b++)y(a[b])}function p(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;G.transformQuat(e,
a,e)}function w(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.m.p.length;e++){var f=b.m.p[e];if("ANY"==a||f.vb.id==a)f=f.vb.O,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function z(a,b){C.t(C.Id,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=L.dp(e.L)+L.dp(e.ea)+String(e.local);c[f]=c[f]||{L:e.L,ea:e.ea,local:e.local,rp:[]};var g=c[f].rp,h;for(h in e.ne)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].L,e=c[f].ea,h=c[f].local,g=c[f].rp,C.t(C.Oo,a,d,e,h,g)}else C.t(C.Oo,
a,null,null,!1,null)}function E(a,b){if(b.Gh){var c=a.m.O,d=b.Wg*b.nq,e=b.bi*b.tp,f=-b.Fh*b.ao*2*Math.PI/b.Vs;b.cr&&(f*=-1);switch(b.type){case 10:C.t(C.Id,c);C.t(C.Gu,c,d,e,f);break;case 20:C.t(C.Id,c),C.t(C.Fu,c,d,e,f)}}}function B(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function v(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function t(a){return a.b4w_character?!0:!1}function x(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?
!0:!1}var I=m("__config");m("__constraints");var r=m("__print"),q=m("__debug"),C=m("__ipc");m("__renderer");var J=m("__scenes"),A=m("__transform"),N=m("__tsr"),L=m("__util"),M=m("__version"),G=m("vec3"),D=m("quat"),O=m("mat4"),Q=I.vb,Z=I.o,P=0,U=null,V=null,X=[],ia={},R={body:0,Mp:0,shape:0},u=new Float32Array(3),pa=new Float32Array(4),ha=new Float32Array(4),ea=new Float32Array(16),Y=new Float32Array(8),na=new Float32Array(8);a.Hy=function(a){if(V)r.warn("Multiple physics scenes are currently not supported");
else{a.m={Ct:!1,p:[]};var b=Q.aj+M.timestamp();r.log("%cLOAD PHYSICS","color: #0a0",b,"Max FPS: "+Q.pd);U=new Worker(b);C.init(U,d);V=a}};a.$v=function(a){return a.m?a.m.Ct:!0};a.cleanup=function(){if(V){U.terminate();V=U=null;X.length=0;ia={};for(var a in R)R[a]=0}};a.append_object=function(a,b){var d=a.d;if(!d)throw"No object render: "+a.name;if(a.parent&&d.$k)return null;var p=[];d.$k&&c(a,p);if(B(a)||v(a)||t(a)||x(a)||a.b4w_collision){var q,y=a,w=d.ds,m=y.d,K=y.game,ga=e();if("CAMERA"==y.type)var sa=
K.use_collision_bounds?K.collision_bounds_type:"BOX",z=k(sa,m),u=m.ri,A=m.mi,u=.5,A=0;else"EMPTY"==y.type?(sa="EMPTY",z=null,A=u=0):(sa=K.use_collision_bounds?K.collision_bounds_type:"BOX",z=k(sa,m),u=m.ri,A=m.mi);var S=m.g,I=m.quat,T=K.use_ghost,Q=K.use_sleep,N=K.mass,M=K.velocity_min,Z=K.velocity_max,P=K.damping,Y=K.rotation_damping,U=K.collision_margin,R=K.collision_group,na=K.collision_mask,pa=m.Rc.Da,kb=f(z),wb=y.b4w_correct_bounding_offset,Za;var eb=sa;if(p.length){var Ea=[],Va={};Va.quat=new Float32Array([0,
0,0,1]);Va.trans=new Float32Array(3);Va.worker_bounding=kb;Va.bounding_type=eb;Ea.push(Va);O.invert(m.U,ea);D.invert(m.quat,ha);for(var la=0;la<p.length;la++){var fb={},fa=p[la],Qa=fa.game.collision_bounds_type,Da=new Float32Array(4),lb=new Float32Array(3);G.transformMat4(fa.d.g,ea,lb);D.multiply(ha,fa.d.quat,Da);fb.trans=lb;fb.quat=Da;fb.bounding_type=Qa;fb.worker_bounding=f(k(Qa,fa.d));Ea.push(fb)}Za=Ea}else Za=[];C.t(C.Zt,ga,S,I,w,T,Q,N,M,Z,P,Y,U,R,na,sa,kb,pa,u,A,Za,wb);X.push(y);ia[ga]=y;var hb=
h(ga);hb.type=w;hb.nn=N;hb.gk=T;q=hb;a.m=q;var za={D:null,vb:q};b.m.p.push(za)}else for(var Pa=a.n||[],Rb=0;Rb<Pa.length;Rb++){var Eb=Pa[Rb],xc;if(xc="PHYSICS"==Eb.type){var fc;a:{for(var ob=b.m.p,pc=0;pc<ob.length;pc++){var yc=ob[pc].D;if(yc&&yc.id==Eb.id){fc=!0;break a}}fc=!1}xc=!fc}if(xc)if(Eb.Ac.I)if(Eb.vf&&b.d.Xa){var mb=Eb,Fb=V,Ka=J.ia(Fb,"MAIN_OPAQUE");C.t(C.gu,Ka.wf);if(Ka.Xa&&mb.eC){var Aa={};Aa.dst_noise_scale0=mb.dst_noise_scale0;Aa.dst_noise_scale1=mb.dst_noise_scale1;Aa.dst_noise_freq0=
mb.dst_noise_freq0;Aa.dst_noise_freq1=mb.dst_noise_freq1;Aa.dir_min_shore_fac=mb.dir_min_shore_fac;Aa.dir_freq=mb.dir_freq;Aa.dir_noise_scale=mb.dir_noise_scale;Aa.dir_noise_freq=mb.dir_noise_freq;Aa.dir_min_noise_fac=mb.dir_min_noise_fac;Aa.dst_min_fac=mb.dst_min_fac;Aa.waves_hor_fac=mb.waves_hor_fac;var Ga=Ka.xf,xb=Ka.Fg;Ka.bl?C.t(C.No,Aa,Ka.kf[0],Ka.kf[1],Ka.jf[0],Ka.jf[1],Ka.nh,Ga,xb,Ka.zh,Fb.d.Qn):C.t(C.No,Aa,0,0,0,0,0,Ga,xb,0,null)}}else{var ib;if(Eb.OB){var Sb=a,Gb=Eb,Hb=e(),yb=Gb.Ac;C.t(C.eu,
Hb,yb.B[0].a_position,yb.ca||null,Sb.d.g,Gb.Jp,Gb.Ip,Gb.Kp);var Db=h(Hb);Db.gk=!0;ib=Db}else{var Ra=a,va=Eb,pb=e(),Tb=va.Ac;C.t(C.fu,pb,Tb.B[0].a_position,Tb.ca||null,Ra.d.g,va.ri,va.mi,va.Jp,va.Ip,va.Kp);ib=h(pb)}q=ib;q.id=Eb.kc;za={D:Eb,vb:q};b.m.p.push(za)}else r.error("Object "+a.name+" has collision material with no assigned vertices")}if(B(a)||v(a)){var qa=a,rb=qa.m.O;B(qa)?(qa.j.type=10,C.t(C.$t,rb,qa.j.eB,qa.j.gB,qa.j.fB,qa.j.gC,qa.j.gz)):v(qa)&&(qa.j.type=20,C.t(C.Yt,rb,qa.j.um,qa.j.Bo,qa.j.Co));
if(qa.j.pg){var aa=qa.j.pg;switch(qa.j.type){case 10:n(aa[1],qa,rb,!0);n(aa[0],qa,rb,!0);n(aa[3],qa,rb,!1);n(aa[2],qa,rb,!1);break;case 20:for(var zb=0;zb<aa.length;zb++)n(aa[zb],qa,rb,!1)}}qa.m.id=qa.b4w_vehicle_settings.name;E(a,a.j)}else if(t(a)){var $a=a.d,Ba=a.m,ya=$a.Nb.max_y-$a.Nb.min_y,sb=Ba.O,$b=a.b4w_character_settings,ab=$b.walk_speed,Pb=$b.run_speed,Qb=$b.step_height,Ub=$b.jump_strength,zc=$b.waterline,Vb=L.gx(a);C.t(C.au,sb,Vb,ya,ab,Pb,Qb,Ub,zc);Ba.is_character=!0}else if(x(a)){var nb=
a,bb=nb.m.O;C.t(C.du,bb,nb.Gc.um,nb.Gc.Bo,nb.Gc.Co);if(nb.Gc.zj)for(var mc=nb.Gc.zj,Kb=0;Kb<mc.length;Kb++){var F=mc[Kb],gc=F.d.g,qb=nb.d.U,Ib=new Float32Array(16);O.invert(qb,Ib);var Lb=new Float32Array(3);G.transformMat4(gc,Ib,Lb);C.t(C.Xt,bb,Lb,F.Iv)}nb.m.My=!0}else a.b4w_collision&&(q.id=a.b4w_collision_id);for(Rb=0;Rb<X.length;Rb++)if(a=X[Rb],a.m){var da=a;if(!g(da))for(var gb=0;gb<da.constraints.length;gb++){var Oa=da.constraints[gb],Ab=Oa.target,ua=Oa.pivot_type;if("RIGID_BODY_JOINT"==Oa.type&&
Ab.m){var Wb=new Float32Array([Oa.pivot_x,Oa.pivot_y,Oa.pivot_z]),tb,ad=new Float32Array([Oa.axis_x,Oa.axis_y,Oa.axis_z]);tb=L.euler_to_quat(ad,new Float32Array(4));var Sa=O.fromRotationTranslation(tb,Wb,new Float32Array(16)),qc=O.multiply(da.d.U,Sa,new Float32Array(16)),Ac=O.invert(Ab.d.U,new Float32Array(16)),Jc=O.multiply(Ac,qc,Ac),nc=L.lh(Jc),Mb=L.matrix_to_quat(Jc),Ta=Oa,Ia={};Ia.use_limit_x=Ta.use_limit_x;Ia.use_limit_y=Ta.use_limit_y;Ia.use_limit_z=Ta.use_limit_z;Ia.use_angular_limit_x=Ta.use_angular_limit_x;
Ia.use_angular_limit_y=Ta.use_angular_limit_y;Ia.use_angular_limit_z=Ta.use_angular_limit_z;Ia.limit_max_x=Ta.limit_max_x;Ia.limit_min_x=Ta.limit_min_x;Ia.limit_max_y=Ta.limit_max_y;Ia.limit_min_y=Ta.limit_min_y;Ia.limit_max_z=Ta.limit_max_z;Ia.limit_min_z=Ta.limit_min_z;Ia.limit_angle_max_x=Ta.limit_angle_max_x;Ia.limit_angle_min_x=Ta.limit_angle_min_x;Ia.limit_angle_max_y=Ta.limit_angle_max_y;Ia.limit_angle_min_y=Ta.limit_angle_min_y;Ia.limit_angle_max_z=Ta.limit_angle_max_z;Ia.limit_angle_min_z=
Ta.limit_angle_min_z;l(ua,da,Wb,tb,Ab,nc,Mb,Ia,null,null)}}}};a.yx=b;a.update=function(){for(var a=0;a<X.length;a++){var b=X[a],c=b.m;if(c.lf&&c.$l){var d=performance.now()/1E3-c.$l,d=Math.min(d,10/Q.pd),d=d-1/Q.pd;Z.nz&&(d=0);var e=Y;N.Iy(c.am,d,c.sr,c.$o,Y);A.uA(b,e);A.w(b);y(b);if(b.j)for(var c=b,d=c.j.pg,e=c.d.yb,f=Y,g=0;g<d.length;g++){var h=d[g];N.multiply(e,c.j.Oi[g],f);A.set_tsr(h,f);A.w(h)}b.j&&b.j.Gh&&(c=b.j,d=c.Gh)&&(e=b.j.Ws,h=ea,f=b.d.g,g=b.d.quat,L.oo(b.j.Xs,g,f,h),L.lh(h,d.d.g),L.matrix_to_quat(h,
d.d.quat),h=pa,L.po(e,g,f,h),e=ha,D.setAxisAngle(h,-c.Fh*c.ao*2*Math.PI,e),D.multiply(e,d.d.quat,d.d.quat),A.w(d));b.j&&b.j.Xn&&(c=b.j,d=c.Xn)&&(f=b.j.Rs,e=ea,g=b.d.g,h=b.d.quat,L.oo(b.j.Ss,h,g,e),L.lh(e,d.d.g),L.matrix_to_quat(e,d.d.quat),e=pa,L.po(f,h,g,e),f=ha,g=Math.abs(c.speed)*c.Qs,g>c.qn&&(g=c.qn),D.setAxisAngle(e,-g,f),D.multiply(f,d.d.quat,d.d.quat),A.w(d));b.j&&b.j.fo&&(c=b.j,d=c.fo)&&(e=b.j.ct,h=ea,f=b.d.g,g=b.d.quat,L.oo(b.j.dt,g,f,h),L.lh(h,d.d.g),L.matrix_to_quat(h,d.d.quat),b=pa,L.po(e,
g,f,b),e=ha,D.setAxisAngle(b,-Math.abs(c.Wg)*c.Yp,e),D.multiply(e,d.d.quat,d.d.quat),A.w(d))}}if(a=V)a=J.ia(a,"MAIN_OPAQUE"),a.Xa&&0<a.Xa.waves_height&&(b=G.length(a.fj),C.t(C.Eu,a.time*b))};a.Ux=function(){return V};a.pause=function(){V&&C.t(C.ru)};a.resume=function(){V&&C.t(C.uu)};a.enable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(!a.lf){var b=a.O;a.lf=!0;C.t(C.pu,b)}};a.disable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(a.lf){var b=a.O;a.lf=!1;C.t(C.ou,
b)}};a.has_physics=function(a){return a.m?!0:!1};a.has_dynamic_physics=function(a){return(a=a.m)&&a.lf&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.nn&&0==a.gk?!0:!1};a.has_simulated_physics=function(a){return(a=a.m)&&a.lf?!0:!1};a.set_gravity=function(a,b){C.t(C.Du,a.m.O,b)};a.Ay=g;a.apply_constraint=l;a.clear_constraint=function(a){a=a.m;C.t(C.tu,a.Kj);a.Kj=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=N.create_sep(c,1,d,Y);f=N.create_sep(f,1,g,na);N.invert(c,c);N.multiply(f,c,c);
A.get_tsr(e,f);N.multiply(f,c,c);A.set_tsr(b,c);A.w(b);a.set_transform(b,b.d.g,b.d.quat)};a.set_transform=function(a,b,c){N.set_sep(a.d.g,1,a.d.quat,a.m.am);var d=C.Eq(C.mj);d.body_id=a.m.O;d.trans=b;d.quat=c;C.t(C.mj,d)};a.sync_transform=y;a.apply_velocity=function(a,b,c,d){p(a,b,c,d,u);a=a.m.O;C.t(C.Id,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(u[0]),f=Math.abs(u[1]),g=Math.abs(u[2]);u[0]=e?u[0]/e*Math.max(e,b):0;u[1]=f?u[1]/f*Math.max(f,c):0;u[2]=g?u[2]/g*Math.max(g,d):0;C.t(C.Po,
a,u[0],u[1],u[2])};a.apply_velocity_world=function(a,b,c,d){a=a.m.O;C.t(C.Id,a);C.t(C.Po,a,b,c,d)};a.apply_force=function(a,b,c,d){p(a,b,c,d,u);a=a.m.O;C.t(C.Id,a);C.t(C.hu,a,u[0],u[1],u[2])};a.apply_torque=function(a,b,c,d){p(a,b,c,d,u);a=a.m.O;C.t(C.Id,a);C.t(C.ju,a,u[0],u[1],u[2])};a.set_character_move_dir=function(a,b,c){a=a.m.O;C.t(C.Id,a);C.t(C.xu,a,b,c)};a.set_character_move_type=function(a,b){C.t(C.yu,a.m.O,b)};a.set_character_walk_velocity=function(a,b){C.t(C.Cu,a.m.O,b)};a.set_character_run_velocity=
function(a,b){C.t(C.Au,a.m.O,b)};a.set_character_fly_velocity=function(a,b){C.t(C.vu,a.m.O,b)};a.character_jump=function(a){C.t(C.ku,a.m.O)};a.character_rotation_inc=function(a,b,c){C.t(C.lu,a.m.O,b,c)};a.set_character_rotation=function(a,b,c){C.t(C.zu,a.m.O,b,c)};a.set_character_rotation_h=function(a,b){C.t(C.wu,a.m.O,b)};a.set_character_rotation_v=function(a,b){C.t(C.Bu,a.m.O,b)};a.$C=function(){return!1};a.YC=function(){return!1};a.WC=function(){r.error("check_collision() deprecated");return!1};
a.XC=function(){r.error("check_collision_any() deprecated");return!1};a.ZC=function(){r.error("check_ray_hit() deprecated");return!1};a.ME=function(){r.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.m,f=e.O;b=b||"ANY";for(var g=0;g<e.hd.length;g++){var h=e.hd[g];if(h.kc==b&&h.callback==c)return}g=[];a=a.m.O;h=[];w(b,V,h,null);for(var k=0;k<h.length;k++){var l=h[k];a<l?g.push([a,l]):a>l&&g.push([l,a])}h={kc:b,callback:c,Ak:g,bs:new Uint8Array(g.length),
vn:d||!1};e.hd.push(h);C.t(C.Id,f);C.t(C.bu,g,d)};a.remove_collision_test=function(a,b,c){a=a.m;b=b||"ANY";for(var d=0;d<a.hd.length;d++){var e=a.hd[d];if(e.kc==b&&e.callback==c){a.hd.splice(d,1);d--;for(var e=e.Ak,f=V.m.p,g=0;g<f.length;g++)for(var h=f[g].vb,k=0;k<h.hd.length;k++)for(var l=h.hd[k],n=0;n<l.Ak.length;n++)for(var p=l.Ak[n],q=0;q<e.length;q++){var t=e[q];p[0]===t[0]&&p[1]===t[1]&&(e.splice(q,1),q--)}e.length&&C.t(C.su,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.m;c?(C.t(C.iu,
c.O),c.Ij=b):r.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=function(a){var b=a.m;b?(C.t(C.mu,b.O),b.Ij=null):r.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.m;if(g){a=g.O;b=b||"ANY";c={L:new Float32Array(c),ea:new Float32Array(d),local:e,callback:f,kc:b,ne:{}};w(b,V,null,c.ne);delete c.ne[a];for(var h in c.ne)c.ne[h]=1;g.bf.push(c);z(a,g.bf)}else r.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,
d,e){if(b=a.m){a=b.O;for(var f=0;f<b.bf.length;f++){var g=b.bf[f];L.Hj(g.L,c)&&L.Hj(g.ea,d)&&g.local==e&&(b.bf.splice(f,1),f--)}z(a,b.bf)}else r.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.j;c.Wg=b;E(a,c)};a.vehicle_steer=function(a,b){var c=a.j;c.Fh=b;E(a,c)};a.vehicle_brake=function(a,b){var c=a.j;c.bi=b;E(a,c)};a.is_vehicle_chassis=B;a.is_vehicle_hull=v;a.Ly=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||
"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.Ky=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.Ny=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.hr=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.gr=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.ir=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?
!0:!1};a.get_vehicle_speed=function(a){return a.j.speed};a.hC=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=t;a.cE=x;a.iy=function(){return P};a.Yw=function(){C.t(C.nu)};a.Nz=function(a){var b=X.indexOf(a);-1!=b?(X.splice(b,1),a.m&&delete ia[a.m.O]):r.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,m){function c(a,b){if(a)for(var c=ea(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}eb[b.id]=null;Ea[b.id]=null}function d(a,b,c){var d;a instanceof ArrayBuffer&&(a=ca.Kq(a));d=a.width;a=a.height;Ha.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Va)&&c&&Ha.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,f){d=b.q;if(!d)throw"Nothing requested";ga.enqueue([[d,ga.AT_JSON,
d]],function(d,f,g,k){if(d){Ha.log("%cLOAD METADATA","color: #616",k);h(d);for(var l in d)a[l]=d[l];(d=a.binaries[0].binfile)?b.mp=d:(K.Gs(b,"load_binaries"),K.Gs(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)Ha.px(a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)Ha.qx(a.b4w_export_warnings[d]);e(b,c)}else K.Vo(b)},null,function(a){f(b,c,a)})}function e(a,b,c,d,e,f){d=R(b.q)+b.mp;if(!d)throw"Binary data is missing";
ga.enqueue([[d,ga.AT_ARRAYBUFFER,d]],function(d,f,g,h){d?(Ha.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c)):K.Vo(b)},null,function(a){f(b,c,a)})}function h(a){var b=Ma.sn.split(".").map(function(a){return a|0}),c=a.b4w_format_version.split(".").map(function(a){return a|0});c[0]<b[0]&&Ja.pa("Incompatible file version: "+a.b4w_format_version+", required: "+Ma.sn+". Reexport scene with the latest B4W addon to fix it.");c[1]<b[1]&&Ha.warn("Version mismatch. File version: "+ +a.b4w_format_version+
", required: "+Ma.sn+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");Ma.jn=parseFloat(a.b4w_format_version)}function k(a,b,c,d,e){d=a.bin_data;var g=a.binaries[0],h=a.objects,k=a.meshes;a=a.actions;for(var l=Ja.Vv(),K=["indices"],n=["normal","tangent"],p=["color","group"],ga=["position","texcoord","texcoord2"],q=0;q<k.length;q++)for(var t=k[q].submeshes,r=0;r<t.length;r++)for(var y in t[r]){var w=t[r][y][1];if(-1!=K.indexOf(y)){var H=4*t[r][y][0]+g["int"],
m=t[r],z=y,sa=d;if(l)var v=new Uint32Array(sa,H,w);else for(var v=new Uint32Array(w),sa=new DataView(sa),D=0;D<w;D++)v[D]=sa.getUint32(H+4*D,!0);m[z]=v}else if(-1!=ga.indexOf(y))H=4*t[r][y][0]+g["float"],t[r][y]=f(d,H,w,l);else if(-1!=n.indexOf(y)){H=2*t[r][y][0]+g["short"];m=t[r];z=y;sa=d;v=new Float32Array(w);sa=new DataView(sa);for(D=0;D<w;D++)v[D]=sa.getInt16(H+2*D,!0)/32767;m[z]=v}else if(-1!=p.indexOf(y)){H=2*t[r][y][0]+g.ushort;m=t[r];z=y;sa=d;v=new Float32Array(w);sa=new DataView(sa);for(D=
0;D<w;D++)v[D]=sa.getUint16(H+2*D,!0)/65535;m[z]=v}}for(y=0;y<h.length;y++)for(k=h[y].particle_systems,K=0;K<k.length;K++)n=k[K],n.transforms=f(d,4*n.transforms[0]+g["float"],n.transforms[1],l);for(h=0;h<a.length;h++){y=a[h];var k=y.fcurves,K=y.frame_range,p=K[0],ga=K[1],q=ba.Yx(p,ga),K=null,r=t=!1,ka;for(ka in k)t|=-1<ka.indexOf("rotation_euler"),r|=-1<ka.indexOf("rotation_quaternion");n=[];for(ka in k)if(t&&r&&-1<ka.indexOf("rotation_euler"))delete k[ka];else{var w=k[ka],u;for(u in w)H=w[u],m=f(d,
g["float"]+4*H.bin_data_pos[0],H.bin_data_pos[1],l),z=new Float32Array(q),null===K&&(K=new Int8Array(q)),ba.rv(H,m,z,K,p,ga),H.ic=z;-1<ka.indexOf("rotation_euler")&&(ba.xx(k[ka]),n.push(ka))}for(p=0;p<n.length;p++)ga=n[p],q=ga.replace("euler","quaternion"),k[q]=k[ga],delete k[ga];y.Ou=K}e(b,c)}function f(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function n(a,b,c,d,e){0===b.id&&(la=a);var f=a.cameras,
h=a.groups,k=a.materials,K=a.meshes,n=a.node_groups,p=a.objects,ga=a.particles,q=a.scenes,t=a.speakers,r=a.textures,y=a.worlds;n||(Ha.warn('"node_groups" datablock undefined. reexport main scene.'),n=a.node_groups=[]);for(var w="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),H={},m=0;m<w.length;m++)for(var z=a[w[m]],sa=0;sa<z.length;sa++){var v=z[sa];H[v.uuid]=v}for(var D=0;D<q.length;D++){for(var ka=
q[D],u=ka.objects,x=0;x<u.length;x++)B(u,x,H);ka.camera&&B(ka,"camera",H);ka.world&&B(ka,"world",H)}for(D=0;D<h.length;D++)for(var W=h[D].objects,x=0;x<W.length;x++)B(W,x,H);for(D=0;D<p.length;D++){var O=p[D];O.dupli_group&&B(O,"dupli_group",H);O.parent&&B(O,"parent",H);if(O.animation_data){var C=O.animation_data;C.action&&B(C,"action",H);if(C.nla_tracks)for(x=0;x<C.nla_tracks.length;x++)for(var ja=C.nla_tracks[x],ca=0;ca<ja.strips.length;ca++)ja.strips[ca].action&&B(ja.strips[ca],"action",H)}switch(O.type){case "MESH":if(!O.data)throw"mesh not found for object "+
O.name;B(O,"data",H);for(var A=O.modifiers,x=0;x<A.length;x++){var G=A[x];"ARMATURE"==G.type?B(G,"object",H):"CURVE"==G.type&&B(G,"object",H)}var I=O.particle_systems;if(I)for(x=0;x<I.length;x++)B(I[x],"settings",H);break;case "ARMATURE":B(O,"data",H);for(var Q=O.pose.bones,ta=O.data.bones,x=0;x<Q.length;x++){var J=Q[x];J.bone=ta[J.bone];for(var xa=J.parent_recursive,ca=0;ca<xa.length;ca++)xa[ca]=Q[xa[ca]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":B(O,"data",H)}var Xa=O.constraints;
if(Xa)for(x=0;x<Xa.length;x++){var M=Xa[x];M.target&&B(M,"target",H)}var Z=O.lod_levels;if(Z)for(x=0;x<Z.length;x++){var P=Z[x];P.object&&B(P,"object",H)}}for(D=0;D<K.length;D++)for(var F=K[D].materials,x=0;x<F.length;x++)B(F,x,H);for(D=0;D<k.length;D++){for(var ra=k[D],Fa=ra.texture_slots,x=0;x<Fa.length;x++)B(Fa[x],"texture",H);var ha=ra.node_tree;ha&&E(ha,H)}for(D=0;D<n.length;D++)(ha=n[D].node_tree)&&E(ha,H);for(D=0;D<r.length;D++){var U=r[D],R=U.type;"IMAGE"!=R&&"ENVIRONMENT_MAP"!=R||B(U,"image",
H)}for(D=0;D<f.length;D++){var Ya=f[D];Ya.dof_object&&B(Ya,"dof_object",H)}for(D=0;D<t.length;D++){var Oa=t[D];Oa.sound&&B(Oa,"sound",H);if(Oa.animation_data&&(C=Oa.animation_data,C.action&&B(C,"action",H),C.nla_tracks))for(x=0;x<C.nla_tracks.length;x++)for(ja=C.nla_tracks[x],ca=0;ca<ja.strips.length;ca++)ja.strips[ca].action&&B(ja.strips[ca],"action",H)}for(D=0;D<ga.length;D++){for(var Ab=ga[D],Fa=Ab.texture_slots,x=0;x<Fa.length;x++)B(Fa[x],"texture",H);Ab.dupli_group&&B(Ab,"dupli_group",H);Ab.dupli_object&&
B(Ab,"dupli_object",H)}for(D=0;D<y.length;D++)if(Fa=y[D].texture_slots)for(x=0;x<Fa.length;x++)B(Fa[x],"texture",H);S.Sv(a);for(var ua=a.textures,Wb=g(a)?a.scenes[0].b4w_anisotropic_filtering:l().b4w_anisotropic_filtering,na=0;na<ua.length;na++)g(a)||"SCENE"!=ua[na].b4w_source_type||(ua[na].b4w_source_id=""),Na.Pw(ua[na],Wb,a.scenes,b.id);for(var Ea={},V=a.objects,vb=0;vb<V.length;vb++){var fa=V[vb];if("MESH"===fa.type&&!fa.particle_systems.length)for(var Za=fa.data,Va=Za.name,X=Za.submeshes,ia=Za.materials,
fb=0;fb<X.length;fb++)0!==X[fb].base_length||Ea[Va]||(ia[fb]&&Ha.warn('material "'+ia[fb].name+'" is not assigned to any face (object "'+fa.name+'").'),Ea[Va]=!0)}for(var Ma=a.meshes,eb=0;eb<Ma.length;eb++){var Qa=Ma[eb];Qa.materials.length||Qa.uv_textures.length&&Ha.warn('mesh "'+Qa.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},
raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",
b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var pa=a.meshes,Ob=Ja.keysearch("name","DEFAULT",a.materials),Da=0;Da<pa.length;Da++){var za=pa[Da];0==za.materials.length&&
za.materials.push(Ob)}for(var hb=a.actions,Pa=b.id,Bc=0;Bc<hb.length;Bc++){var ic=hb[Bc];ic.Qu=Pa;ba.Yu(ic)}for(var Xb=a.scenes,ub=0;ub<Xb.length;ub++){for(var fd=Xb[ub],rc=T.Rl(fd,"ALL"),cb=[],bc=0;bc<rc.length;bc++)for(var Lc=rc[bc].particle_systems,Cc=0;Cc<Lc.length;Cc++){var Yb=Lc[Cc].settings;if("HAIR"==Yb.type)if("OBJECT"==Yb.render_type)oa.Zk(Yb.dupli_object,!0);else if("GROUP"==Yb.render_type){for(var Dc=Yb.dupli_group,Mc=T.Rl(fd,"EMPTY"),Jb=0;Jb<Mc.length;Jb++)Mc[Jb].dupli_group==Dc&&cb.push(Mc[Jb]);
for(Jb=0;Jb<Dc.objects.length;Jb++)oa.Zk(Dc.objects[Jb],!0)}else Ha.warn("render type",Yb.render_type,"not supported for particle systems ("+Yb.name+").")}for(bc=0;bc<cb.length;bc++)L(cb[bc],[fd])}Y(a,b.id);for(var gd=a.scenes,hd=0;hd<gd.length;hd++){for(var rd=gd[hd],Ec=[],Nc=[],Oc=gd[hd].objects,Nb=0;Nb<Oc.length;Nb++){var od=Oc[Nb];N(Oc,od,Ec,Nc);var ud=od.dupli_group;if(ud)for(var sd=ud.objects,pd=0;pd<sd.length;pd++)N(sd,sd[pd],Ec,Nc)}for(Nb=0;Nb<Nc.length;Nb++)L(Nc[Nb],[rd]);for(Nb=0;Nb<Ec.length;Nb++)Ja.lv(Ec[Nb][0],
Ec[Nb][1])}Y(a,b.id);var db=ea(a,b.id);S.wv(db,a.scenes);for(na=0;na<db.length;na++){var Zb=db[na];!g(a)&&Zb.parent&&-1<lb.indexOf(Zb.parent.type)&&(Zb.parent="");oa.Zk(Zb,!1);Zb.d.oc=b.id}for(var Tc=0;Tc<db.length;Tc++){var Uc=db[Tc];if("MESH"==Uc.type){var vd=ba.get_first_armature_object(Uc);if(vd){var Vc=vd.d;if(Vc.Ee){var sc=Uc.d.Hc,tc=[],uc;for(uc in sc){var Wc=sc[uc];tc.push(4*Wc.ii,4*Wc.sp)}Vc.yr.push(tc)}Vc.Rk.push(Uc.d)}}}for(var Xc=-1,id=-1,Fc=ba.Dq(),Pc=0;Pc<db.length;Pc++){var Yc=db[Pc],
Bb=Yc.d;if(Ja.is_mesh(Yc)&&Bb.ih){var Gc=Bb.je;Gc>Xc&&(Xc=Gc);Fc>=Gc&&Gc>id&&(id=Gc)}}for(Pc=0;Pc<db.length;Pc++)Yc=db[Pc],Bb=Yc.d,Ja.is_mesh(Yc)&&Bb.ih&&(Bb.qi=!0,Xc<Fc?Bb.je=Xc:Bb.je<=Fc?Bb.je=id:(Ha.warn('too many bones for "'+Yc.name+'" / '+Bb.je+" bones (max "+Fc+" with blending, "+2*Fc+" without blending). Blending between frames will be disabled."),Bb.je=Xc,Bb.qi=!1),Bb.qi=Bb.qi&&!wb.pq);for(var jd=0;jd<db.length;jd++){var cc=db[jd];if(Ja.is_mesh(cc)){var Zc=cc.lod_levels.length;if(Zc)for(var Qc=
cc,dc=0;dc<Zc;dc++){var vc=cc.lod_levels[dc].object;if(!vc){Qc.d.kk=!0;Qc.d.We=cc.lod_levels[dc].distance;break}vc.d.eg=cc.d.eg;Qc.d.We=cc.lod_levels[dc].distance;vc.d.Di=cc.lod_levels[dc].distance;if(cc.lod_levels[dc+1])vc.d.We=cc.lod_levels[dc+1].distance;else{vc.d.kk=!0;vc.d.We=1E4;break}Qc.d.kk=!1;Qc=vc}}}for(var Rc=0;Rc<db.length;Rc++){var ma=db[Rc];if(ma.b4w_vehicle){var Ua=ma.b4w_vehicle_settings;if("CHASSIS"==Ua.part){ma.j={};ma.j.nq=Ua.force_max;ma.j.tp=Ua.brake_max;ma.j.eB=Ua.suspension_compression;
ma.j.gB=Ua.suspension_stiffness;ma.j.fB=Ua.suspension_damping;ma.j.gC=Ua.wheel_friction;ma.j.xE=Ua.roll_influence;ma.j.gz=Ua.max_suspension_travel_cm;ma.j.Wg=0;ma.j.bi=1;ma.j.Fh=0;ma.j.speed=0;ma.j.pg=[];ma.j.Oi=[];ma.j.Gh=null;for(var kd=ma.za?ma.za.dupli_group.objects:db,wc=0;wc<kd.length;wc++){var La=kd[wc];if(La.b4w_vehicle){var Wa=La.b4w_vehicle_settings;if(Ca.Ly(La)&&Ua.name==Wa.name){var qd=Ca.hC(La.b4w_vehicle_settings.part);ma.j.pg[qd]=La;ma.j.Oi[qd]=new Float32Array(8)}else if(Ca.hr(La)&&
Ua.name==Wa.name){ma.j.Gh=La;ma.j.ao=Wa.steering_max;ma.j.Vs=Wa.steering_ratio;ma.j.cr=Wa.inverse_control;var jb=wa.invert(ma.d.U,new Float32Array(16)),ld=wa.multiply(jb,La.d.U,jb);ma.j.Xs=ld;var Hc=new Float32Array([1,0,0,0]);Cb.transformMat4(Hc,ld,Hc);ma.j.Ws=Hc}else if(Ca.gr(La)&&Ua.name==Wa.name){ma.j.Xn=La;ma.j.Qs=Wa.speed_ratio;ma.j.qn=Wa.max_speed_angle;var jb=wa.invert(ma.d.U,new Float32Array(16)),jc=wa.multiply(jb,La.d.U,jb);ma.j.Ss=jc;var Ic=new Float32Array([1,0,0,0]);Cb.transformMat4(Ic,
jc,Ic);ma.j.Rs=Ic}else if(Ca.ir(La)&&Ua.name==Wa.name){ma.j.fo=La;ma.j.Yp=Wa.delta_tach_angle;var jb=wa.invert(ma.d.U,new Float32Array(16)),ec=wa.multiply(jb,La.d.U,jb);ma.j.dt=ec;var kc=new Float32Array([1,0,0,0]);Cb.transformMat4(kc,ec,kc);ma.j.ct=kc}}}if(4!=ma.j.pg.length)throw"Not enough wheels for chassis "+ma.name;}else if("HULL"==Ua.part){ma.j={};ma.j.pg=[];ma.j.Oi=[];ma.j.nq=Ua.force_max;ma.j.tp=Ua.brake_max;ma.j.um=Ua.floating_factor;ma.j.Bo=Ua.water_lin_damp;ma.j.Co=Ua.water_rot_damp;ma.j.Wg=
0;ma.j.bi=1;ma.j.Fh=0;ma.j.speed=0;ma.j.Gh=null;for(var td=ma.za?ma.za.dupli_group.objects:db,wc=0;wc<td.length;wc++)La=td[wc],La.b4w_vehicle&&(Wa=La.b4w_vehicle_settings,Ca.Ky(La)&&Ua.name==Wa.name?(ma.j.pg.push(La),ma.j.Oi.push(new Float32Array(8))):Ca.hr(La)&&Ua.name==Wa.name?(ma.j.Gh=La,ma.j.ao=Wa.steering_max,ma.j.Vs=Wa.steering_ratio,ma.j.cr=Wa.inverse_control,jb=wa.invert(ma.d.U,new Float32Array(16)),ld=wa.multiply(jb,La.d.U,jb),ma.j.Xs=ld,Hc=new Float32Array([1,0,0,0]),Cb.transformMat4(Hc,
ld,Hc),ma.j.Ws=Hc):Ca.gr(La)&&Ua.name==Wa.name?(ma.j.Xn=La,ma.j.Qs=Wa.speed_ratio,ma.j.qn=Wa.max_speed_angle,jb=wa.invert(ma.d.U,new Float32Array(16)),jc=wa.multiply(jb,La.d.U,jb),ma.j.Ss=jc,Ic=new Float32Array([1,0,0,0]),Cb.transformMat4(Ic,jc,Ic),ma.j.Rs=Ic):Ca.ir(La)&&Ua.name==Wa.name&&(ma.j.fo=La,ma.j.Yp=Wa.delta_tach_angle,jb=wa.invert(ma.d.U,new Float32Array(16)),ec=wa.multiply(jb,La.d.U,jb),ma.j.dt=ec,kc=new Float32Array([1,0,0,0]),Cb.transformMat4(kc,ec,kc),ma.j.ct=kc))}}}for(var Sc=0;Sc<
db.length;Sc++){var lc=db[Sc];if(lc.b4w_floating){var $c=lc.b4w_floating_settings;if("MAIN_BODY"==$c.part){lc.Gc={};lc.Gc.um=$c.floating_factor;lc.Gc.Bo=$c.water_lin_damp;lc.Gc.Co=$c.water_rot_damp;lc.Gc.zj=[];for(var yd=lc.za?lc.za.dupli_group.objects:db,wd=0;wd<yd.length;wd++){var md=yd[wd];if(md.b4w_floating){var zd=md.b4w_floating_settings;Ca.Ny(md)&&$c.name==zd.name&&(lc.Gc.zj.push(md),md.Iv=md.b4w_floating_settings.synchronize_position)}}}}}for(na=0;na<a.scenes.length;na++){var xd=a.scenes[na];
kb.enabled&&xd.b4w_enable_physics&&(g(a)||!Ca.has_physics(l())&&xd==T.sm(a))&&Ca.Hy(xd)}e(b,c)}function g(a){return a==la?!0:!1}function l(){return T.sm(la.scenes)}function y(a,b,c,d,e){!g(a)&&1<a.scenes.length&&(a.scenes=[T.sm(a.scenes)],Ha.warn("loading data contains multiple scenes.","Only the first one will be loaded."));d=l();-1==wb.Ha&&(wb.Ha=d.fps);for(var f=0;f<a.scenes.length;f++){var h=a.scenes[f];if(g(a)&&!h.camera)throw"Scene check failed: No camera";for(var k=T.Rl(h,"MESH"),K=0;K<k.length;K++){var n=
k[K],p=S.ov(n);p&&(a.meshes.push(p),n.data=p)}for(var K=ea(a,b.id),n=a.meshes,p=n.slice(0),ga=0;ga<K.length;ga++){var q=K[ga];"MESH"==q.type&&(q=p.indexOf(q.data),-1<q&&p.splice(q,1))}for(ga=0;ga<p.length;ga++)n.splice(n.indexOf(p[ga]),1);g(a)?(T.cv(h,a.textures),h.d.Ph.length&&(b.Qm=!0),h.b4w_enable_audio&&ta.gp(h),K=T.Gm(h),n=h.b4w_batch_grid_size):(T.iv(h,d,a.textures),h.b4w_enable_audio&&!d.i&&ta.gp(d),K=T.Gm(d),n=d.b4w_batch_grid_size);p=[];xa.Qx(K,n,k,d.d.Go,d.d.Sk,p,d.d.mr);g(a)?(T.Zo(h,p),
T.Ix(K)):T.Zo(d,p)}d=a.materials;if(Ob.cm&&Ma.pt)for(a=0;a<d.length;a++){k=d[a];K=k.texture_slots;for(f=0;f<K.length;f++)if(n=K[f],p=n.texture,"IMAGE"==p.type||"ENVIRONMENT_MAP"==p.type)h=p.image,h.hc||(-1<h.filepath.indexOf(".dds")?h.hc=!0:(h.hc=!p.b4w_disable_compression&&!n.use_map_normal&&"ENVIRONMENT_MAP"!=p.type&&!p.b4w_shore_dist_map&&"MOVIE"!=h.source,h.hc&&(h.filepath+=".dds")));if(f=k.node_tree)for(k=f.nodes,f=0;f<k.length;f++)h=k[f],"TEXTURE"==h.type&&(K=h.texture)&&(h=K.image)&&!h.hc&&
(h.hc=K.d.sj&&!K.b4w_disable_compression&&"MOVIE"!=h.source,h.hc&&(h.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.hc=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function p(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},h={},k={},l=0;l<d.length;l++){var K=d[l];f[K.uuid]=K;h[K.uuid]=K}for(l=0;l<a.length;l++)K=a[l],g[K.uuid]=K,k[K.uuid]=K;w(a,null,k,h);for(var n in h)n in f||d.push(h[n]);for(n in k)n in g||a.push(k[n]);e(b,c)}function w(a,b,c,d){for(var e=
[],f=0;f<a.length;f++){var g=a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var k=c[g.uuid],l=k.constraints,g=0;g<l.length;g++){var K=Ja.Lf(l[g]);K.name+="_CLONE";h.constraints.push(K)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=Ja.Lf(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=h.b4w_anim_behavior,k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=
0;f<e.length;f++)h=Ja.Hm(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],b&&(l=Ja.Lf(h),h="origin_name"in h?h.origin_name:h.name,l.name=b+"*"+h,l.origin_name=h,z(l),c[l.uuid]=l,e[g.uuid]=l.uuid,g.uuid=l.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],k=Ja.Lf(l),k.name=Ja.Xk(l.name+"_CLONE"),k.uuid=sa.Xq("Group"+k.name),d[k.uuid]=k,g.uuid=k.uuid,w(k.objects,h.name,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=
e[h.parent.uuid]:h.parent&&(Ha.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var n in e)fb[n]=e[n]}function z(a){a.uuid=
sa.Xq("Object"+a.name)}function E(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&B(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in fb&&(e.lamp.uuid=fb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&B(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];v(f,"from_node",c);v(f,"to_node",c);t(f,"from_socket",f.from_node.outputs);t(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&B(c,"action",b),c.nla_tracks)for(d=
0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&B(e.strips[f],"action",b)}function B(a,b,c){(c=c[a[b].uuid])||Ha.error("Dangling link found:",b,a);a[b]=c}function v(a,b,c){c=Ja.keysearch("name",a[b].name,c);a[b]=c}function t(a,b,c){c=Ja.keysearch("identifier",a[b].identifier,c);a[b]=c}function x(a,b,c,e,f,g){if(!Ma.do_not_load_resources){for(var h=R(b.q),k=a.images,l={},K=[],n=0;n<k.length;n++){var p=k[n],q=p.uuid;if("FILE"===p.source||"MOVIE"===p.source){var t=
I(p,a.textures);if(!t.length)Ha.warn("image ",p.name," has no users.");else if(!(t[0].b4w_shore_dist_map||"MOVIE"===p.source&&Ma.jq)){t=pa(h+p.filepath);if("FILE"===p.source){var r=p.hc?ga.AT_ARRAYBUFFER:ga.AT_IMAGE_ELEMENT;Ob.rn&&Ma.al&&(t=ga.Xi(t),"dds"==t[1]?(t=ga.Xi(t[0]),t=t[0]+".min50."+t[1]+".dds"):t=t[0]+".min50."+t[1])}else"MOVIE"===p.source&&(Ma.Oc?(t=ga.Xi(t),t=t[0]+".altconv.seq",r=ga.ij):(t=ga.Xi(t),r=ta.detect_video_container(t[1]),t=r!=t[1]?t[0]+".altconv."+r:t[0]+"."+r,r=ga.jj));K.push([q,
r,t]);l[q]=p}}}K.length?(e.Yq=0,ga.enqueue(K,function(f,h,k,n){if(f){if(k==ga.jj||k==ga.ij){if(k==ga.jj)var p=f.videoWidth,q=f.videoHeight;else p=f.images[0].width,q=f.images[0].height;Ha.log("%cLOAD VIDEO "+p+"x"+q,"color: #"+(2048<p||2048<q?"a00":1024<p||1024<q?"aa0":"0a0"),n);-1==n.indexOf(Va)&&Ha.warn("video",n,"is not from app root.")}else d(f,n,!0);h=l[h];n=I(h,a.textures);for(p=0;p<n.length;p++){var q=n[p],t=q.image.filepath;k==ga.ij?(q.d.xs=f.Zb,Na.$i(q.d,f.images,h.hc,t,b.id)):Na.$i(q.d,
f,h.hc,t,b.id)}}f=++e.Yq/K.length;g(b,c,f)},function(){Ha.log("%cLOADED ALL IMAGES","color: #0a0");f(b,c)})):f(b,c)}}function I(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function r(a,b,c,d,e,f){if(!Ma.do_not_load_resources){a=ea(a,b.id);for(var g=R(b.q),h=[],k={},l=0;l<a.length;l++){var K=a[l];if(q(K)){var n=K.data.sound,p=n.uuid;"BACKGROUND_MUSIC"==ta.Im(K)?(p=Ja.Cm(),b.Pm=!0):"NONE"!=ta.Im(K)&&Ma.ar&&(b.Tm=!0);if(!(p in k)){k[p]=[];n=pa(g+n.filepath);switch(ta.Os(K)){case ta.el:var t=
ga.AT_AUDIOBUFFER;break;case ta.Ho:t=ga.AT_AUDIO_ELEMENT}var n=ga.Xi(n),r=ta.detect_audio_container(n[1]),n=r!=n[1]?n[0]+".altconv."+r:n[0]+"."+r;h.push([p,t,n])}k[p].push(K)}}h.length?ga.enqueue(h,function(a,e,g,l){if(a)for(Ha.log("%cLOAD SOUND","color: #0aa",l),-1==l.indexOf(Va)&&Ha.warn("sound",l,"is not from app root."),e=k[e],g=0;g<e.length;g++)ta.IB(e[g],a);a=++d.JA/h.length;f(b,c,a)},function(){Ha.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,c)}}function q(a){return ta.ge(a)&&ta.Os(a)!=
ta.Io?!0:!1}function C(a,b){for(var c=T.Ia(a,"SPEAKER",T.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];ta.ge(e)&&(ta.is_cyclic(e)||b)&&ta.play_def(e)}}function J(a){a=a.d.Ph;for(var b=0;b<a.length;b++)Ma.Oc&&a[b].use_auto_refresh?a[b].d.xh=!0:a[b].d.La&&a[b].use_auto_refresh&&a[b].d.La.play()}function A(a,b,c,d,e){Fa.start();Ha.log("%cSTART NLA","color: #0a0");e(b,c)}function N(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],h=g.object;
if(h){var k=Ja.Gj(h);k.name=b.name+"_LOD_"+String(f+1);z(k);k.lod_levels=[];c.push([a,k]);d.push(h);g.object=k}}}function L(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function M(a,b,c,d,e){d=!0;for(var f=0;f<a.scenes.length;f++)if(!Ca.$v(a.scenes[f])){d=!1;break}d&&(e(b,c),Ha.log("%cPHYSICS READY","color: #0a0"))}function G(a,b,c,d,e){d=l();for(var f=
0;f<a.scenes.length;f++){var h=a.scenes[f],k=g(a)?Ca.has_physics(h):Ca.has_physics(d)||Ca.has_physics(h);g(a)||(h=d);for(var K=0;K<hb.length;K++)for(var n=T.Ia(h,hb[K],T.DATA_ID_ALL),p=0;p<n.length;p++){var ga=n[p];ga.d.oc==b.id&&kb.enabled&&k&&(Ca.append_object(ga,h),b.gn&&Ca.has_physics(ga)&&Ca.disable_simulation(ga))}}e(b,c)}function D(a,b,c,e,f){var g={};e=[];for(var h=a.scenes,k=0;k<a.scenes.length;k++){var l=h[k];if(l.d.Xa&&(l=l.d.Xa.Qk)&&"FILE"===l.source){var K=l.uuid,n=pa(R(b.q)+l.filepath);
e.push([K,l.hc?ga.AT_ARRAYBUFFER:ga.AT_IMAGE_ELEMENT,n]);g[K]=l}}e.length?ga.enqueue(e,function(c,e,f,k){if(c){d(c,k,!0);e=g[e];k=I(e,a.textures);for(f=0;f<k.length;f++){var l=k[f];Na.$i(l.d,c,e.hc,l.image.filepath,b.id)}for(f=0;f<h.length;f++)if(k=h[f],k.d.Xa.Qk===e){var K=c,n=document.createElement("canvas"),l=e.size[0],p=e.size[1];n.width=l;n.height=p;n=n.getContext("2d");n.drawImage(K,0,0);K=n.getImageData(0,0,l,p).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=1/65025;n[2]=1/255;n[3]=1;for(var l=
l*p,p=new Float32Array(l),ga=0;ga<l;ga++)p[ga]=n[1]*K[4*ga+2]+n[2]*K[4*ga+3];k.d.Qn=p}}},function(){f(b,c)}):f(b,c)}function O(a,b,c,e,f){if(Ma.antialiasing&&Ma.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var k=T.ia(e,g[h]);k&&a.push(k)}if(a.length){e=[];h=ga.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,ra.Tb.smaa_search_texture_path]);e.push(["AREA_TEXTURE",h,ra.Tb.smaa_area_texture_path]);
for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.la;for(h=0;h<a.length;h++)if(g=a[h],"u_search_tex"==g.ea)var l=g.ra;else if("u_area_tex"==g.ea)var K=g.ra;break}e.length?ga.enqueue(e,function(a,c,e,f){a&&(d(a,f,!1),c="SEARCH_TEXTURE"==c?l:K,c.source="IMAGE",c.kp=!0,Na.$i(c,a,-1!=f.indexOf(".dds")?1:0,f,b.id),Na.Pn(c,Na.r,Na.r))},function(){f(b,c)}):f(b,c)}else f(b,c)}else f(b,c)}function Q(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];g(a)||(e=l());for(var f=
T.Ia(e,"LAMP",T.DATA_ID_ALL),h=0;h<f.length;h++){var k=f[h];k.d.oc==b.id&&(b.gn&&Ja.is_mesh(k)&&T.hide_object(k),d.nl.push({ws:e,obj:k}))}f=T.Ia(e,"ALL",T.DATA_ID_ALL);for(h=0;h<f.length;h++)k=f[h],"LAMP"!=k.type&&k.d.oc==b.id&&(b.gn&&Ja.is_mesh(k)&&T.hide_object(k),d.nl.push({ws:e,obj:k}))}}function Z(a,b,c,d,e,f){e=d.nl;var g=d.Ir;e.length?(a=e[g].obj,g=e[g].ws,T.append_object(g,a,!1),-1!=za.indexOf(a.type)&&g.b4w_enable_audio&&ta.append_object(a,g),W.dr(a)&&W.append(a),d=++d.Ir/e.length,"LAMP"==
a.type&&T.IA(g),null!=a.d.mc&&T.kt(g,a),a.d.wc&&"PLANE"==a.d.me&&g.d.xb&&(T.xv(a,g),T.nt(a.d.tc,g))):d=1;f(b,c,d)}function P(a,b,c,d,e){if(g(a)){d=T.my();for(var f=T.ah(),h=0;h<d.length;h++){var k=d[h];T.Fz(k,f);k.b4w_use_nla&&Fa.FB(k,k.b4w_nla_cyclic,b.id)}T.set_active(f)}else T.ot(l());a=ea(a,b.id);oa.DB(a);e(b,c)}function U(a,b,c,d,e){if(g(a))for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||J(a.scenes[d]),C(a.scenes[d]);else a.scenes[0].b4w_use_nla||J(l()),C(l());e(b,c)}function V(a,b,c,
d,e){Ma.Xf&&(b.Qm||b.Pm||b.Tm)?fa||X(a,e,b,c):e(b,c)}function X(a,b,c,d){var e=Pa.parentElement;Da=e.style.zIndex;e.style.zIndex="999";fa=document.createElement("div");fa.style.position="relative";fa.style.height="88px";fa.style.width="88px";var f=Math.round(Pa.offsetWidth/2-44);fa.style.top=Math.round(Pa.offsetHeight/2-44).toString()+"px";fa.style.left=f.toString()+"px";fa.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
fa.style.backgroundSize="88px";Qa=document.createElement("div");Qa.style.position="relative";Qa.style.height=Pa.offsetHeight.toString()+"px";Qa.style.width=Pa.offsetWidth.toString()+"px";Qa.style.background="rgba(0, 0, 0, 0.5)";Qa.style.zIndex="999";e.appendChild(Qa);Qa.appendChild(fa);fa.addEventListener("click",function(){c.Qm&&(Na.play(),Na.pause(),Na.reset());if(c.Pm){if(g(a))for(var e=0;e<a.scenes.length;e++)C(a.scenes[e],!0);else C(l(),!0);ta.pause()}c.Tm&&ta.zz();ia();b(c,d)},!1)}function ia(){if(fa){var a=
Pa.parentElement;a.style.zIndex=Da;Qa.removeChild(fa);a.removeChild(Qa);fa=Qa=null;Da=0}}function R(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function u(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function pa(a){var b=
a.split("://",2);return 1<b.length?(b[1]=u(b[1]),b.join("://")):u(a)}function ha(a,b,c){ba.is_animated(b)&&ba.remove(b);T.clear_outline_anim(b);Ca.has_physics(b)&&(Ca.disable_simulation(b),Ca.Nz(b));ja.check_sensor_manifold(b)&&ja.remove_sensor_manifold(b);T.Oz(a,b,c);ta.ge(b)&&ta.LA(b);W.dr(b)&&W.remove(b)}function ea(a,b){Ea[b]||Y(a,b);return Ea[b]}function Y(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)na(c[e].objects,0,g(a),d);Ea[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var h=
c[f],k=0;k<h.length;k++)Ea[b].push(h[k])}function na(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],f=0;f<a.length;f++){var g=a[f],h=H(g);e[h]=e[h]||[];(c||-1==lb.indexOf(g.type))&&-1==e[h].indexOf(g)&&e[h].push(g);(g=g.dupli_group)&&na(g.objects,b+1,c,d)}}function H(a){return(a=a.parent||ba.get_first_armature_object(a))?1+H(a):0}var W=m("__anchors"),ba=m("__animation"),xa=m("__batch"),ra=m("__config"),ja=m("__controls"),ca=m("__dds"),ka=m("__extensions");m("__lights");var K=m("__loader"),ga=m("__assets"),
sa=m("__md5"),oa=m("__objects"),Ca=m("__physics"),Ha=m("__print"),S=m("__reformer"),Xa=m("__renderer"),T=m("__scenes"),Fa=m("__nla"),ta=m("__sfx"),Ya=m("__shaders"),Na=m("__textures"),vb=m("__nodemat"),Ja=m("__util");m("__transform");var Cb=m("vec4"),wa=m("mat4"),Ma=ra.o,Ob=ra.Pd,kb=ra.vb,wb=ra.Od,Za=ra.Yc,eb=null,Ea=null,Va="",la=!1,fb={},fa=null,Qa=null,Da=0,lb=["LAMP","CAMERA"],hb=["MESH","CAMERA","EMPTY"],za=["SPEAKER"],Pa=null;a.is_primary_loaded=function(a){return K.is_primary_loaded(a)};a.update=
function(){K.GB(eb)};a.zA=function(a){Pa=a};a.CB=function(a,b){if(fa){Qa.style.height=b.toString()+"px";Qa.style.width=a.toString()+"px";var c=Math.round(a/2-44);fa.style.top=Math.round(b/2-44).toString()+"px";fa.style.left=c.toString()+"px"}};a.load=function(a,d,f,g,h){var l={load_main:{Pa:K.ze,Za:!1,K:[],eb:!1,fb:500,wb:!1,ab:b},duplicate_objects:{Pa:K.ed,Za:!1,K:["load_main"],eb:!1,fb:50,wb:!1,ab:p},load_binaries:{Pa:K.ze,Za:!1,K:["load_main"],eb:!1,fb:500,wb:!1,ab:e},prepare_bindata:{Pa:K.ed,
Za:!1,K:["duplicate_objects","load_binaries"],eb:!1,fb:0,wb:!1,ab:k},prepare_root_datablocks:{Pa:K.ed,Za:!1,K:["duplicate_objects","prepare_bindata"],eb:!1,fb:150,wb:!1,ab:n},prepare_root_scenes:{Pa:K.ed,Za:!1,K:["prepare_root_datablocks"],eb:!1,fb:350,wb:!1,ab:y},load_smaa_textures:{Pa:K.ze,Za:!0,K:["prepare_root_scenes"],eb:!1,fb:10,wb:!0,ab:O},load_shoremap:{Pa:K.ze,Za:!0,K:["prepare_root_scenes"],eb:!1,fb:10,wb:!0,ab:D},load_textures:{Pa:K.ze,Za:!0,K:["prepare_root_scenes"],eb:!0,fb:500,wb:!1,
ab:x,Kf:{Yq:0}},wait_physics_workers:{Pa:K.ze,Za:!0,K:["load_shoremap"],eb:!1,fb:20,wb:!1,Jf:M},add_physics_objects:{Pa:K.ed,Za:!1,K:["wait_physics_workers"],eb:!1,fb:20,wb:!1,ab:G},add_objects:{Pa:K.ed,Za:!1,K:["add_physics_objects"],eb:!1,fb:800,wb:!1,ab:Q,Jf:Z,ci:P,Kf:{nl:[],Ir:0}},load_speakers:{Pa:K.ze,Za:!0,K:["add_objects"],eb:!0,fb:30,wb:!1,ab:r,Kf:{JA:0}},mobile_media_start:{Pa:K.ed,Za:!Ma.Xf,K:["load_textures","load_speakers"],eb:!0,fb:5,wb:!1,ab:V,Jf:V},synchronize_media:{Pa:K.ed,Za:!0,
K:["mobile_media_start"],eb:!0,fb:70,wb:!1,ab:U},start_nla:{Pa:K.ed,Za:!0,K:["mobile_media_start"],eb:!1,fb:5,wb:!1,ab:A}},ga=K.Hq();ga||(ga=K.Iw(),eb={},Ea={},fb={});eb[ga.Dd.length]={};return K.Qw(l,a,d,f,c,g||Za.ip,Ma.do_not_load_resources,h)};a.unload=function(a){var b=K.Hq();if(!b||!b.Dd.length||a&&!K.iB(b.Dd[a]))Ha.error("Unable to unload data!");else{if(0==a)Ha.log("%cUNLOAD ALL","color: #00a"),W.cleanup(),ba.cleanup(),ta.cleanup(),Fa.cleanup(),T.cleanup(),K.cleanup(),Ca.cleanup(),oa.cleanup(),
Ja.cleanup(),Xa.cleanup(),vb.cleanup(),Ya.cleanup(),ja.cleanup(),ka.cleanup(),ga.cleanup(),Na.cleanup(),Ea=null,fb={},la=!1,eb=null;else{Ha.log("%cUNLOAD DATA "+a,"color: #00a");ba.Mz(a);for(var b=T.ui(),c=0;c<b.length;c++)for(var d=b[c],e=T.Ia(d,"ALL",T.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.oc==a){ha(d,g,!0);e.splice(f,1);var h=T.Ia(d,g.type,T.DATA_ID_ALL),g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}ia()}};a.Ez=ha;a.set_debug_resources_root=function(a){Va=a}};b4w.module.__batch=function(a,m){function c(a){a={type:a,Ka:"",id:0,Pz:0,th:"",N:[],Kb:[],Lc:[],di:[],Dg:null,hb:{},Xb:null,gb:null,hp:[],sc:null,S:null,Hc:null,Ed:!1,Rg:!1,Vp:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,jr:0,kr:0,Lq:0,Km:0,$b:new Float32Array(3),lc:new Float32Array(16),Fa:!1,Lp:!1,W:!1,we:!1,Ja:!1,Cg:!1,kd:!1,yc:!1,fc:!1,Jb:!1,Vb:!1,Hb:!1,wc:!1,lb:!1,js:!1,$d:U.Uh,ye:U.Ld,Qf:!1,Hn:"",BE:"",Mq:!1,Qq:0,Nq:0,Rq:0,Sq:0,Pq:new Float32Array(3),Oq:new Float32Array(3),Uf:!1,Nd:0,ae:0,
Ke:1,rg:0,Ps:0,Bh:1,ng:0,Je:0,Ce:1,Er:0,tn:0,jg:0,ps:0,Xd:Array(2),gc:new Float32Array(3),qf:new Float32Array(3),zd:new Float32Array(3),Ob:new Float32Array(4),Uc:new Float32Array(4),jh:null,bn:null,$m:null,Zm:null,an:null,vf:!1,water_dynamic:!1,Do:!1,yt:!1,zt:0,At:0,xt:0,Sh:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,mq:new Float32Array(2),lq:new Float32Array(2),vm:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),hg:null,Kn:!1,Ur:0,Qr:0,
Bn:0,Tr:0,Wr:0,Vr:0,Rr:0,Sr:0,Cn:0,Nr:0,Mr:0,Yr:0,Pr:0,zk:new Float32Array(3),Xr:new Float32Array(8),Or:new Float32Array(16)};a.Ob[3]=1;a.Lp=!0;a.W=!0;return a}function d(a){switch(a.type){case "MAIN":case "NODES":case "PARTICLES":a.Ka=a.Fa?a.we?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.Ka="DEPTH";break;case "COLOR_ID":a.Ka=a.we?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a,b){for(var c=[],d=ea.Ca(b,"SHADOW_CAST"),f=ea.Ca(b,"MAIN_PLANE_REFLECT"),g=ea.Ca(b,"MAIN_CUBE_REFLECT"),h=ea.Ca(b,"OUTLINE_MASK"),
k=ea.Ca(b,"COLOR_PICKING"),l=0;l<a.n.length;l++){var n=a.n[l],p=null;"DEPTH"==n.type&&d&&n.yc&&(p=e(n),p.Ka="SHADOW_CAST");"MAIN"!=n.type&&"NODES"!=n.type&&"PARTICLES"!=n.type||!f&&!g||n.Fa||!n.Vb||(p=e(n),p.Ka="REFLECT");"COLOR_ID"==n.type&&(h&&k?(p=e(n),p.Ka="OUTLINE"):h&&!k&&(n.Ka="OUTLINE"));p&&(p.Qf=!0,N(p,a.d.id),c.push(p))}a.n.push.apply(a.n,c)}function e(a){var b=a.S,c=a.sc;a.S=null;a.sc=null;var d=ia.nw(a);a.S=b;d.S=b;a.sc=c;d.sc=c;return d}function h(a,b,c){for(var d=[],e=0;e<a.length;e++){var g=
a[e],h=g.d,k=n(g.data.b4w_bounding_box),l=g.data.b4w_bounding_cylinder_radius,p=g.data.b4w_bounding_sphere_radius,q=g.data.b4w_bounding_sphere_center,t=g.data.b4w_bounding_ellipsoid_axes,r=g.data.b4w_bounding_ellipsoid_center;if(h.Fe){var p=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),l=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),y=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),y=Math.sqrt(p*p+l*l+y*y),p=Math.sqrt(p*p+l*l);k.max_x=k.max_y=k.max_z=y;k.min_x=k.min_y=k.min_z=-y;l=p;p=y;q[0]=q[1]=q[2]=
0;t[0]=t[1]=t[2]=y;r[0]=r[1]=r[2]=0}h.Nb=k;y=O.El(k,h.U);h.$a=y;var y=h,H=l;y.zl=O.Qp(H,k);y.xl=O.Op(l,k);y.yl=O.Pp(H,k);q=O.Wl(p,q);h.Rc=q;q=O.Gl(q,h.U);h.sb=q;t=O.Vl([t[0],0,0],[0,t[1],0],[0,0,t[2]],r);h.Gf=t;t=O.Fl(t,h.yb);h.Hf=t;d=d.concat(f(g,h,b,c))}return d}function k(a,b,c,d){for(var e=[],g=[],h={},k=0;k<a.length;k++){var l=a[k],p=l.d,q=n(l.data.b4w_bounding_box),t=O.El(q,p.U),r=O.Wl(l.data.b4w_bounding_sphere_radius,l.data.b4w_bounding_sphere_center),y=O.Gl(r,p.U),w=l.data.b4w_bounding_ellipsoid_axes,
w=O.Vl([w[0],0,0],[0,w[1],0],[0,0,w[2]],l.data.b4w_bounding_ellipsoid_center),m=O.Fl(w,p.yb);p.Nb=q;p.$a=t;p.Rc=r;p.sb=y;p.Gf=w;p.Hf=m;q={};q.yc=p.yc;q.fc=p.fc;q.Jb=p.Jb;q.ug=p.ug;q.vk=p.vk;q.Db=p.Db;q.uk=p.uk;q.Fi=p.Fi;q.Vb=p.Vb;q.Hb=p.Hb;q.wc=p.wc;q.mc=p.mc;q.tc=p.tc;q.me=p.me;q.If=p.If;q.cd=p.cd;q.he=p.he;q.Fb=p.Fb;q.Fe=p.Fe;q.ai=p.ai;q.lb=p.lb;q.Tg=p.Tg;q.Pj=p.Pj;q.ie=p.ie;q.gg=p.gg;q.mk=p.mk;q.rc=p.rc;q.fg=p.fg;q.nk=p.nk;q.kd=p.kd;t=p.sb.F;q.yy=0==c?[0,0]:[Math.floor(t[0]/c),Math.floor(t[2]/
c)];q.We=p.We;q.Di=p.Di;q.eg=p.eg;p=JSON.stringify(q);h[p]=h[p]||[];h[p].push(l)}for(var D in h){q=JSON.parse(D);c=h[D];var l=ia.Lj("STATIC"),z;for(z in q)l[z]=q[z];l.oc=a[0].d.oc;l.dd=0;l.ve=0;l.Wd=0;l.Vd=0;l.Rd=0;l.fh=!1;for(k=0;k<c.length;k++)p=c[k],0==k?(l.$a=W.Aa(p.d.$a),l.sb=W.Aa(p.d.sb),l.Gf=W.Aa(p.d.Gf),l.Hf=W.Aa(p.d.Hf)):(O.dq(l.$a,p.d.$a),O.ox(l.sb,p.d.sb));l.Nb=W.Aa(l.$a);l.Rc=W.Aa(l.sb);g.push({Wb:l,le:c})}for(a=0;a<g.length;a++)for(h=g[a].Wb,k=g[a].le,D=0;D<k.length;D++){z=k[D];c=f(z,
h,b,d);l=z.d;l=H.create_sep(l.g,l.scale,l.quat);p={};h.cd&&(p.au_center_pos=[l[0],l[1],l[2]],p.au_wind_bending_amp=[z.d.dd],p.au_wind_bending_freq=[z.b4w_wind_bending_freq],p.au_detail_bending_amp=[z.b4w_detail_bending_amp],p.au_detail_bending_freq=[z.b4w_detail_bending_freq],p.au_branch_bending_amp=[z.b4w_branch_bending_amp]);for(q=0;q<c.length;q++)y=c[q].Wb,t=c[q].Ac,r=c[q].D,y.hk?y.Fe?U.ZA(t,l):U.$s(t,l):("COLOR_ID"==r.type&&(y=c[q].Wb=z.d,r.th=z.uuid,I(r,y),N(r,W.Ng(y,0))),t=U.$s(t,l),U.YA(t,
p));e=e.concat(c)}return e}function f(a,b,d,e){for(var f=[],h=g(d,b),k=W.Ng(b,0),n=a.data,p=n.materials,t=0;t<h.length;t++){var r=h[t];if(!a.b4w_do_not_render||"PHYSICS"==r)for(var y=0;y<p.length;y++){var H=p[y];if(("LENS_FLARES"!=H.name||0!=e)&&!U.Uq(n,y)){var w=c(r);if(A(w,H)){w.$d=b.Ed||b.kd?U.kj:U.Uh;I(w,b);for(var m=w,D=a.particle_systems,z=0;z<D.length;z++){var v=D[z].settings.b4w_vcol_from_name,ka=D[z].settings.b4w_vcol_to_name;""!==v&&""!==ka&&(m.hb[v]={Tf:!1,src:[{name:v,Jc:7}]})}"DYNAMIC"==
b.type&&(w.th=a.uuid);N(w,k);m=U.hq(n,y,w.di,w.Hc,w.hb,w.Dg);"LENS_FLARES"==H.name&&(m=R.Dz(m));f.push({D:w,Ac:m,Kc:[H.name],Wb:b,Wc:[a]})}}}}h=a.particle_systems;if(0<h.length&&f.length){e=!0;for(t=0;t<h.length;t++)if(h[t].settings.use_render_emitter){e=!1;break}t=f[0].D;h=f[0].Ac;n=[];p=a.particle_systems;r=a.data;for(y=0;y<p.length;y++)if(H=p[y],w=H.settings,w.count)if("EMITTER"==w.type){if("DYNAMIC"==b.type){m=c("PARTICLES");D=r.materials;z=H.settings.material-1;z>=D.length&&(Z.warn('Wrong material used for rendering particle system "'+
H.name+'"'),z=0);D=D[z];"HALO"===H.settings.render_type&&(m.Uf=!0);l(m,D);I(m,b);z=m;v=H;switch(v.settings.b4w_billboard_align){case "VIEW":q(z,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":q(z,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":q(z,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":q(z,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}q(z,"BILLBOARD",0);Y.s(z.gb,"WORLD_SPACE","WORLD"==v.settings.b4w_coordinate_system?1:
0);m.kd=!0;m.th=a.name+"_"+w.uuid;m.Hn=H.name;N(m,k);m.sc=H;w=R.Mx(m,r,H,a.d.yb);R.jA(m,H,D);n.push({D:m,Ac:w,Kc:[D.name],Wb:b,Wc:[a]})}}else if("HAIR"==w.type){m=W.ck(H.seed);w.b4w_dynamic_grass&&(b.Tg=!0);var x=pa.Dp(ja.jn)&&!w.b4w_initial_rand_rotation&&!w.b4w_hair_billboard,u=4;x&&(u=8);if(H.transforms.length)var B=H.transforms;else for(var D=U.Dm(h,w.count,!1,m),B=new Float32Array(D.length*u),O=0;O<D.length;O++)z=.75+.5*W.Nc(m),B[O*u]=D[O][0],B[O*u+1]=D[O][1],B[O*u+2]=D[O][2],B[O*u+3]=z,x&&(B[O*
u+4]=1,B[O*u+5]=0,B[O*u+6]=0,B[O*u+7]=0);D=ea.Ca(d,"GRASS_MAP")?!0:!1;if("OBJECT"==w.render_type)z=[g(d,w.dupli_object.d,!0)],H=J(a,b,t,h,[w.dupli_object],z,[B],w,H,D,m,!1),n=n.concat(H);else if("GROUP"==w.render_type){v=w.dupli_group.objects;ka=!1;z=[];for(O=0;O<v.length;O++){var C=g(d,w.dupli_group.objects[O].d,!0);z.push(C)}if(w.use_whole_group){for(var ka=B,B=v,O=x,x=u,u={},C=new Float32Array([0,0,0,1]),ca=0;ca<ka.length;ca+=x)for(var E=0;E<B.length;E++){var G=ba.create();ba.scale(B[E].d.g,B[E].d.scale,
G);var Q=ba.clone([ka[ca],ka[ca+1],ka[ca+2]]);u[E]||(u[E]=new Float32Array(ka.length));O&&(u[E][ca+4]=C[0]=ka[ca+4],u[E][ca+5]=C[1]=ka[ca+5],u[E][ca+6]=C[2]=ka[ca+6],u[E][ca+7]=C[3]=ka[ca+7],W.In(C,C),W.mB(G,C,G));ba.add(Q,G,Q);u[E][ca]=Q[0];u[E][ca+1]=Q[1];u[E][ca+2]=Q[2];u[E][ca+3]=ka[ca+3]}B=u;ka=!0}else if(w.use_group_count){G=v;Q=w.dupli_weights;O=m;C={};ca=[];for(E=0;E<G.length;E++)for(var L=G[E],L=L.origin_name||L.name,xa=0;xa<Q.length;xa++){var M=Q[xa];L==M.name.split(": ")[0]&&ca.push(M)}Q.length!=
ca.length&&Z.error("dupli weights match failed");for(E=0;E<B.length;E+=u){var P,Q=ca;P=[0];for(G=0;G<Q.length;G++)P[G+1]=P[G]+Q[G].count;Q=P[P.length-1]*W.Nc(O);for(G=L=0;G<P.length;G++)if(Q>=P[G]&&Q<P[G+1]){L=G;break}P=L;C[P]=C[P]||[];C[P].push(B[E],B[E+1],B[E+2],B[E+3]);x&&C[P].push(B[E+4],B[E+5],B[E+6],B[E+7])}for(P in C)C[P]=new Float32Array(C[P]);B=C}else{O=m;C=v.length;ca={};for(E=0;E<B.length;E+=u){var ra=Math.floor(C*W.Nc(O));ca[ra]=ca[ra]||[];ca[ra].push(B[E],B[E+1],B[E+2],B[E+3]);x&&ca[ra].push(B[E+
4],B[E+5],B[E+6],B[E+7])}for(ra in ca)ca[ra]=new Float32Array(ca[ra]);B=ca}H=J(a,b,t,h,v,z,B,w,H,D,m,ka);n=n.concat(H)}"INSTANCE"==w.b4w_wind_bend_inheritance&&(a.d.dd=0)}else throw"Unknown particle settings type";a=n;f=e?a:f.concat(a)}return f}function n(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function g(a,b,c){var d=["MAIN","NODES","NODES_GLOW"];(b.ug&&ea.Ca(a,"COLOR_PICKING")||b.Db&&ea.Ca(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID");ea.Ca(a,
"WIREFRAME")&&d.push("WIREFRAME");d.push("PHYSICS");(ea.Ca(a,"DEPTH")||ea.Ca(a,"SHADOW_CAST"))&&d.push("DEPTH");ea.Ca(a,"GRASS_MAP")&&d.push("GRASS_MAP");if(b.fc||b.Hb)for(a=null,b.fc&&(a="MAIN NODES NODES_GLOW COLOR_ID PHYSICS WIREFRAME".split(" ")),b.Hb&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?W.sv(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function l(a,b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render||b.use_nodes)c=!1;else{p(a,b);
c=b.game_settings.alpha_blend;a.we=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.jg=b.offset_z;a.qf.set([1,1,1]);var d=b.texture_slots;xa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Ob);switch(b.name){case "LENS_FLARES":M(a,"special_lens_flares.glslv","special_lens_flares.glslf");r(a,"a_position");r(a,"a_texcoord");var e=w(d[0],null);G(a,e);break;default:M(a,"main.glslv","main.glslf");var f=z("use_map_color_diffuse",d),g=z("use_map_color_spec",d),h=z("use_map_normal",
d),k=z("use_map_mirror",d),l=z("use_stencil",d);c=f[0];g=g[0];h=h[0];k=k[0];f=f[1];d=l[0]&&z("use_rgb_to_intensity",d)[0];if(c){switch(c.blend_type){case "MIX":q(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":q(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}e=w(c,null);G(a,e,"u_colormap0");a.Je=c.diffuse_color_factor;a.Ce=c.use_map_alpha?c.alpha_factor:0;a.qf.set(c.scale)}l=c&&c==g;g&&(l||(e=w(g,null),G(a,e,"u_specmap0")),a.Ps=g.specular_color_factor);if(h&&(r(a,"a_normal"),
r(a,"a_tangent"),e=w(h,null),G(a,e,"u_normalmap0"),a.Er=h.normal_factor,e=h.texture,e.b4w_use_map_parallax&&ja.Ii)){var n=Y.u(e.b4w_parallax_steps),H=Y.u(e.b4w_parallax_lod_dist);q(a,"PARALLAX",1);q(a,"PARALLAX_STEPS",n);q(a,"PARALLAX_LOD_DIST",H);a.ng=e.b4w_parallax_scale}k&&(e=w(k,null),G(a,e,"u_mirrormap"),a.tn=k.mirror_factor);if(k=c&&f&&d?1:0)e=w(f,null),G(a,e,"u_colormap1"),e=w(d,null),G(a,e,"u_stencil0");(e=c||g||h)&&a.qf.set(e.scale);q(a,"TEXTURE_SPEC",void 0==g?0:1);q(a,"ALPHA_AS_SPEC",l?
1:0);q(a,"TEXTURE_STENCIL_ALPHA_MASK",k);r(a,"a_position");r(a,"a_normal");(c||g||h)&&r(a,"a_texcoord");if(b.b4w_water){a.vf=!0;a.Do=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;k=b.texture_slots;M(a,"special_water.glslv","special_water.glslf");r(a,"a_position");r(a,"a_texcoord");r(a,"a_normal");r(a,"a_tangent");ja.Bt?(r(a,"a_polyindex"),a.W=!0,a.wireframe_edge_color=[0,0,0],q(a,"DEBUG_WIREFRAME",1)):q(a,"DEBUG_WIREFRAME",0);e=z("use_map_normal",k);l=z("use_map_mirror",k)[0];e.length&&
(n=w(e[0]),G(a,n,"u_normalmap0"),a.Sh=b.b4w_water_norm_uv_velocity);q(a,"NUM_NORMALMAPS",e.length);a.hg=Array(e.length);for(n=0;n<e.length;n++)a.hg[n]=new Float32Array(2),a.hg[n].set([e[n].scale[0],e[n].scale[1]]);l&&(e=w(l),G(a,e,"u_mirrormap"),a.tn=l.mirror_factor);l=null;for(n=0;n<k.length;n++){var m=k[n];if(!0===m.texture.b4w_water_foam){l=m;break}}l&&ja.Xg?(q(a,"FOAM",1),e=w(l),G(a,e,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.mq.set(l.texture.b4w_foam_uv_freq),a.lq.set(l.texture.b4w_foam_uv_magnitude),
a.vm[0]=l.scale[0],a.vm[1]=l.scale[1]):q(a,"FOAM",0);for(n=0;n<k.length;n++)if(m=k[n],!0===m.texture.b4w_shore_dist_map){var D=m;break}D&&ja.ol?(D=w(D),G(a,D,"u_shore_dist_map"),q(a,"SHORE_PARAMS",1),D=m.texture.b4w_shore_boundings,q(a,"MAX_SHORE_DIST",Y.u(m.texture.b4w_max_shore_dist)),q(a,"SHORE_MAP_SIZE_X",Y.u(D[0]-D[1])),q(a,"SHORE_MAP_SIZE_Y",Y.u(D[2]-D[3])),q(a,"SHORE_MAP_CENTER_X",Y.u((D[0]+D[1])/2)),q(a,"SHORE_MAP_CENTER_Y",Y.u((D[2]+D[3])/2))):q(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&
ja.ji?(q(a,"GENERATED_MESH",1),a.yt=!0,a.zt=b.b4w_water_num_cascads,a.At=b.b4w_water_subdivs,a.xt=b.b4w_water_detailed_dist):q(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){var m=Y.u(b.b4w_water_dst_noise_scale0),D=Y.u(b.b4w_water_dst_noise_scale1),k=Y.u(b.b4w_water_dst_noise_freq0),l=Y.u(b.b4w_water_dst_noise_freq1),e=Y.u(b.b4w_water_dir_min_shore_fac),n=Y.u(b.b4w_water_dir_freq),H=Y.u(b.b4w_water_dir_noise_scale),ka=Y.u(b.b4w_water_dir_noise_freq),u=Y.u(b.b4w_water_dir_min_noise_fac),x=Y.u(b.b4w_water_dst_min_fac),
W=Y.u(b.b4w_water_waves_hor_fac);q(a,"DST_NOISE_SCALE_0",m);q(a,"DST_NOISE_SCALE_1",D);q(a,"DST_NOISE_FREQ_0",k);q(a,"DST_NOISE_FREQ_1",l);q(a,"DIR_MIN_SHR_FAC",e);q(a,"DIR_FREQ",n);q(a,"DIR_NOISE_SCALE",H);q(a,"DIR_NOISE_FREQ",ka);q(a,"DIR_MIN_NOISE_FAC",u);q(a,"DST_MIN_FAC",x);q(a,"WAVES_HOR_FAC",W)}B(a,b);v(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;
q(a,"ABSORB",Y.u(b.b4w_water_absorb_factor));q(a,"SSS_STRENGTH",Y.u(b.b4w_water_sss_strength));q(a,"SSS_WIDTH",Y.u(b.b4w_water_sss_width))}"HALO"===b.type&&(m=b.halo,M(a,"halo.glslv","halo.glslf"),q(a,"NUM_RINGS",m.ring_count),q(a,"NUM_LINES",m.line_count),q(a,"NUM_STARS",m.star_tip_count),q(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.di=["a_position"],a.Qq=m.size,a.Nq=m.hardness/20,a.Pq.set(m.b4w_halo_rings_color),a.Oq.set(m.b4w_halo_lines_color),a.Rq=1/b.b4w_halo_stars_blend_height,a.Sq=b.b4w_halo_stars_min_height,
a.Mq=!0);q(a,"TEXCOORD",0);q(a,"NORMAL_TEXCOORD",0);c&&y(a,c,"TEXTURE_COLOR0_CO");f&&y(a,f,"TEXTURE_COLOR1_CO");d&&y(a,d,"TEXTURE_STENCIL_ALPHA_MASK_CO");g&&y(a,g,"TEXTURE_SPEC_CO");h&&y(a,h,"TEXTURE_NORM_CO");q(a,"SHADELESS",b.use_shadeless?1:0);a.Cg=b.use_shadeless}c=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===c?0:1);q(a,"ALPHA_CLIP","CLIP"===c?1:0);q(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(q(a,"VERTEX_COLOR",1),r(a,"a_color")):q(a,"VERTEX_COLOR",
0);a.Nd=b.ambient;a.Ke=b.diffuse_intensity;a.ae=b.emit;a.zd.set(b.specular_color);a.Bh=b.specular_alpha;B(a,b);v(a,b);b.b4w_wettable?q(a,"WETTABLE",1):q(a,"WETTABLE",0);E(a,b);a.Kn=b.b4w_refractive;a.ps=b.b4w_refr_bump;c=!0}break;case "NODES":c=t(a,b);break;case "NODES_GLOW":c=t(a,b,!0);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(p(a,b),a.Fa)c=!1;else{M(a,"depth.glslv","depth.glslf");r(a,"a_position");r(a,"a_normal");g=b.game_settings.alpha_blend;
q(a,"ALPHA","OPAQUE"===g?0:1);a.qf.set([1,1,1]);if((c=z("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===g){a.qf.set(c.scale);q(a,"TEXTURE_COLOR",1);r(a,"a_texcoord");if("IMAGE"==c.texture.d.source||"ENVIRONMENT_MAP"==c.texture.d.source)g=w(c),G(a,g,"u_colormap0");"NONE"==c.texture.d.source&&(g=w(c),G(a,g,"u_colormap0"))}else q(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.OB=b.b4w_use_ghost,a.kc=b.b4w_collision_id,a.Jp=b.b4w_collision_margin,a.Ip=b.b4w_collision_group,a.Kp=
b.b4w_collision_mask,a.ri=b.physics.friction,a.mi=b.physics.elasticity,c=!0):b.b4w_water?(a.vf=!0,a.eC=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=
b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)c=!1;else{p(a,b);a.ye=U.Ld;a.W=!0;a.Fa=!1;g=b.game_settings.alpha_blend;a.we=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;M(a,"color_id.glslv","color_id.glslf");r(a,"a_position");g=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===g?0:1);a.qf.set([1,1,1]);if((c=z("use_map_color_diffuse",b.texture_slots)[0])&&
"CLIP"===g){a.qf.set(c.scale);q(a,"TEXTURE_COLOR",1);r(a,"a_texcoord");if("IMAGE"==c.texture.d.source||"ENVIRONMENT_MAP"==c.texture.d.source)g=w(c),G(a,g,"u_colormap0");"NONE"==c.texture.d.source&&(g=w(c),G(a,g,"u_colormap0"))}else q(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(p(a,b),a.Fa=!1,a.ye=U.Ld,a.W=!0,M(a,"grass_map.glslv","grass_map.glslf"),r(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,g=b.b4w_dynamic_grass_color?
b.b4w_dynamic_grass_color:null,a.hb.a_grass_size={Tf:!0,src:[]},c?(a.hb.a_grass_size.src.push({name:c,Jc:4}),q(a,"DYNAMIC_GRASS_SIZE",1)):q(a,"DYNAMIC_GRASS_SIZE",0),a.hb.a_grass_color={Tf:!0,src:[]},g?(a.hb.a_grass_color.src.push({name:g,Jc:7}),q(a,"DYNAMIC_GRASS_COLOR",1)):q(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?c=!1:(M(a,"wireframe.glslv","wireframe.glslf"),r(a,"a_position"),r(a,"a_normal"),r(a,"a_polyindex"),
a.W=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=!1;else{c=b.texture_slots;if(a.Uf)M(a,"particles_color.glslv","particles_color.glslf");else if(M(a,"particles_texture.glslv","particles_texture.glslf"),c=z("use_map_color_diffuse",c)[0]){q(a,"TEXTURE_COLOR",1);switch(c.blend_type){case "MIX":q(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":q(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Je=c.diffuse_color_factor;
a.Ce=c.use_map_alpha?c.alpha_factor:0;c=w(c);G(a,c)}xa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Ob);a.Nd=b.ambient;a.Ke=b.diffuse_intensity;a.ae=b.emit;a.zd.set(b.specular_color);a.Bh=b.specular_alpha;r(a,"a_position");r(a,"a_normal");c=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===c?0:1);q(a,"ALPHA_CLIP","CLIP"===c?1:0);q(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);B(a,b);v(a,b);p(a,b);c=b.game_settings.alpha_blend;a.we=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=
c;a.jg=b.offset_z;c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function y(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":q(a,c,"TEXTURE_COORDS_UV_ORCO");q(a,"TEXCOORD",1);break;case "NORMAL":q(a,c,"TEXTURE_COORDS_NORMAL");q(a,"NORMAL_TEXCOORD",1);break;default:q(a,c,0)}}function p(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Fa=!0;a.ye=U.Ro;a.W=!0;break;case "ALPHA":a.Fa=!0;a.ye=U.Ld;a.W=!0;break;case "CLIP":a.Fa=!1;a.ye=U.Ld;a.W=!0;break;case "ADD":a.Fa=
!0;a.ye=U.Ld;a.W=!1;break;case "OPAQUE":a.Fa=!1;a.ye=U.Ld;a.W=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.Ja=c.use_backface_culling}function w(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&na.$i(d,b,c.hc,c.filepath);return d}function z(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function E(a,b){var c=b.raytrace_transparency;a.Uc[0]=c.fresnel;a.Uc[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.rg=c.reflect_factor;a.Uc[2]=
c.fresnel;a.Uc[3]=1-c.fresnel_factor/5}function B(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":q(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":q(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":q(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:Z.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.gc[0]=b.specular_intensity;
a.gc[1]=c;a.gc[2]=d}function v(a,b){switch(b.diffuse_shader){case "LAMBERT":q(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.Xd[0]=0;a.Xd[1]=0;break;case "OREN_NAYAR":q(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.Xd[0]=b.roughness;a.Xd[1]=0;break;case "FRESNEL":q(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.Xd[0]=b.diffuse_fresnel;a.Xd[1]=b.diffuse_fresnel_factor;break;default:Z.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Xd[0]=0,a.Xd[1]=0}}function t(a,b,c){if(!b.use_nodes||
b.b4w_do_not_render)return!1;var d=X.gw(b.node_tree,c?W.Cm():b.uuid,!1,b.name,c);if(!d)return Z.error('Failed to create node graph for material "'+b.name+'", disable nodes'),x(a,b),!0;M(a,"nodes.glslv","nodes.glslf");q(a,"NODES_GLOW",c?1:0);c=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===c?0:1);q(a,"ALPHA_CLIP","CLIP"===c?1:0);q(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);r(a,"a_position");p(a,b);a.jg=b.offset_z;c=b.game_settings.alpha_blend;a.we=b.b4w_render_above_all&&"OPAQUE"!=
c&&"CLIP"!=c;xa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Ob);a.ae=b.emit;a.Nd=b.ambient;E(a,b);b.b4w_wettable?q(a,"WETTABLE",1):q(a,"WETTABLE",0);a.gb.yn=X.hw(d);var e=!1;V.T(d,function(b,c){switch(c.type){case "GEOMETRY_UV":var d=c.data.name,f=c.data.value;a.Dg||(a.Dg={});a.Dg[f]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.hb[d]={Tf:!0,src:[{name:c.data.value}]};f=0;if("GEOMETRY_VC"==c.type)f=7;else for(var g=
0;g<c.Oa.length;g++){var h="RGB".indexOf(c.Oa[g].identifier);-1<h&&(f|=1<<2-h)}a.hb[d].src[0].Jc=f;break;case "GEOMETRY_NO":r(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":d=c.data.value;r(a,"a_normal");q(a,"DIFFUSE_SHADER","DIFFUSE_"+d.fx);q(a,"SPECULAR_SHADER","SPECULAR_"+d.OA);q(a,"SHADELESS_MAT",d.Cg?1:0);a.Cg=d.Cg;a.Bh=d.Bh;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;f=c.data.value;!1!==f.d.sj&&(f.d.sj="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);G(a,f.d,d);break;
case "TEXTURE_NORMAL":case "B4W_PARALLAX":q(a,"CALC_TBN_SPACE",1);r(a,"a_normal");r(a,"a_tangent");d=c.data.name;f=c.data.value;f.d.sj=!1;G(a,f.d,d);break;case "LAMP":c.data&&(a.jh=c.data);break;case "B4W_REFRACTION":a.Kn=!0}});e||(a.Cg=!0);return!0}function x(a,b){M(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===c?0:1);q(a,"ALPHA_CLIP","CLIP"===c?1:0);q(a,"SHADELESS",1);r(a,"a_position");r(a,"a_normal");xa.set(1,0,1,1,a.Ob);q(a,"VERTEX_COLOR",0);a.jg=b.offset_z;
p(a,b)}function I(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.hk?q(a,"AU_QUALIFIER","attribute"):q(a,"AU_QUALIFIER","uniform"),q(a,"STATIC_BATCH",0)):(q(a,"AU_QUALIFIER","attribute"),q(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(P.qy()?q(a,"WIREFRAME_QUALITY",1):q(a,"WIREFRAME_QUALITY",0),a.Rg?(q(a,"DEBUG_SPHERE",1),a.Vp?q(a,"DEBUG_SPHERE_DYNAMIC",1):q(a,"DEBUG_SPHERE_DYNAMIC",0)):q(a,"DEBUG_SPHERE",0),q(a,"ALPHA",1));b.Ed&&(a.Ed=b.Ed);b.cd?(""!==b.he?(a.hb.a_bending_col_main={Tf:!0,src:[{name:b.he,
Jc:4}]},r(a,"a_bending_col_main"),""!==b.Fb.qr&&""!==b.Fb.pr&&""!==b.Fb.Lr?(a.hb.a_bending_col_detail={Tf:!0,src:[{name:b.Fb.qr,Jc:4},{name:b.Fb.pr,Jc:2},{name:b.Fb.Lr,Jc:1}]},r(a,"a_bending_col_detail"),r(a,"a_normal"),q(a,"DETAIL_BEND",1)):q(a,"DETAIL_BEND",0),q(a,"MAIN_BEND_COL",1)):q(a,"MAIN_BEND_COL",0),q(a,"WIND_BEND",1)):q(a,"WIND_BEND",0);b.xj?q(a,"BEND_CENTER_ONLY",1):q(a,"BEND_CENTER_ONLY",0);q(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.Ev|0);b.Fe?q(a,"BILLBOARD",1):q(a,"BILLBOARD",0);b.Fe&&
b.hk?q(a,"HAIR_BILLBOARD",1):q(a,"HAIR_BILLBOARD",0);b.Cl?q(a,"BILLBOARD_SPHERICAL",1):q(a,"BILLBOARD_SPHERICAL",0);switch(b.ai){case "RANDOM":q(a,"BILLBOARD_RANDOM",1);q(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":q(a,"BILLBOARD_RANDOM",0);q(a,"BILLBOARD_JITTERED",1);break;default:q(a,"BILLBOARD_RANDOM",0),q(a,"BILLBOARD_JITTERED",0)}b.lb&&ja.ol?q(a,"DYNAMIC_GRASS",1):q(a,"DYNAMIC_GRASS",0);a.lb=b.lb;a.kd=b.kd;a.yc=b.yc;a.fc=b.fc;a.Jb=b.Jb&&!a.Cg&&!(a.Fa&&ja.Zp);a.Vb=b.Vb;a.Hb=b.Hb;a.wc=b.wc;
b.ih?(r(a,"a_influence"),q(a,"SKINNED",1),b.qi?q(a,"FRAMES_BLENDING",1):q(a,"FRAMES_BLENDING",0),q(a,"MAX_BONES",b.je)):(q(a,"SKINNED",0),q(a,"FRAMES_BLENDING",0));b.cl?(q(a,"VERTEX_ANIM",1),ja.vt?q(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):q(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):q(a,"VERTEX_ANIM",0);if(b.ih&&b.cl)throw"Skinning and vertex animation are mutually exlusive";b.Pj?q(a,"DISABLE_FOG",1):q(a,"DISABLE_FOG",0);b.Hc&&(a.Hc=b.Hc);if("NODES"==a.type||"NODES_GLOW"==a.type){for(var c=
a.gb.yn,d=b.gg,e=b.fg,f=0;f<c.length;f++){var g=c[f];switch(g.id){case "VALUE":var h=g.Bk[0];if(h)for(var k=0;k<d.length;k+=2)if(d[k]==h){g.Me.push(["VALUE_IND",d[k+1]]);break}break;case "RGB":if(h=g.Bk[0])for(k=0;k<e.length;k+=2)if(e[k]==h){g.Me.push(["RGB_IND",e[k+1]]);break}}}q(a,"NUM_VALUES",b.ie.length);q(a,"NUM_RGBS",b.rc.length)}}}function r(a,b){var c=a.di;-1==c.indexOf(b)&&c.push(b)}function q(a,b,c){Y.s(a.gb,b,c)}function C(a,b){if("PHYSICS"==a.type)a.Ac=b;else{var c=a.ye,d=a.$d;a.Mq&&(b=
U.ux(b));a.yt&&(b=u.Rx(a.zt,a.At,a.xt));c=U.aB(b,c,d,a.hb);a.S=c;a.kd||c.bk||a.Ed||(c.Te=null,c.$c=null);c=b.B.length;a.num_vertices=b.I*c;a:switch(a.$d){case U.Uh:case U.lj:case U.kj:d=!0;break a;default:d=!1}d?U.Oy(b)?a.num_triangles=b.ca.length/3*c:a.num_triangles=b.I/3*c:a.num_triangles=0}}function J(a,b,d,e,f,g,h,k,l,n,p,q){var t=[],r=k.b4w_dynamic_grass;if(!n&&r)return t;for(var y="INSTANCE"==k.b4w_wind_bend_inheritance,w="INSTANCE"==k.b4w_shadow_inheritance,m="INSTANCE"==k.b4w_reflection_inheritance,
D=[],z=[],v=0;v<f.length;v++){var u=f[v],x=W.Gj(b);x.Fe=k.b4w_hair_billboard;x.ai=k.b4w_hair_billboard_type;x.Cl="SPHERICAL"==k.b4w_hair_billboard_geometry;x.lb=r;x.hk=!0;x.ie=u.d.ie;x.gg=u.d.gg;x.rc=u.d.rc;x.fg=u.d.fg;y?(x.cd=u.d.cd,x.gj=u.d.gj,x.ve=u.d.ve,x.Wd=u.d.Wd,x.he=u.d.he,x.Vd=u.d.Vd,x.Rd=u.d.Rd,x.dd=u.d.dd,x.Fb=u.d.Fb,x.xj=!1):(x.cd=a.d.cd,x.gj=a.d.gj,x.ve=a.d.ve,x.Wd=a.d.Wd,x.he=a.d.he,x.Vd=a.d.Vd,x.Rd=a.d.Rd,x.dd=a.d.dd,x.Fb=a.d.Fb,x.xj=!0);w?(x.yc=u.d.yc,x.fc=u.d.fc,x.Jb=u.d.Jb):(x.yc=
a.d.yc,x.fc=a.d.fc,x.Jb=a.d.Jb);m?(x.Vb=u.d.Vb,x.Hb=u.d.Hb,x.wc=u.d.wc,x.mc=u.d.mc,x.tc=u.d.tc,x.me=u.d.me):(x.Vb=a.d.Vb,x.Hb=a.d.Hb,x.wc=a.d.wc,x.mc=a.d.mc,x.tc=a.d.tc,x.me=a.d.me);D.push(x);var B=h[v];B||(B=new Float32Array);q&&W.ck(l.seed,p);var O=new Float32Array(3),C=new Float32Array([0,0,0,1]),ca=[],E=pa.Dp(ja.jn)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,G=4;E&&(G=8);for(var Q=0;Q<B.length;Q+=G){O[0]=B[Q];O[1]=B[Q+1];O[2]=B[Q+2];var L=B[Q+3];if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var J=
new Float32Array([W.Nc(p),W.Nc(p),W.Nc(p)]);ba.normalize(J,J);break;case "Z":J=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}ra.setAxisAngle(J,k.b4w_rand_rotation_strength*(2*Math.PI*W.Nc(p)-Math.PI),C)}else E&&(C.set(B.subarray(Q+4,Q+8)),W.In(C,C),k.use_whole_group||(k.use_rotation_dupli?ra.multiply(C,u.d.quat,C):ra.multiply(C,ka,C)));var M=H.create_sep(O,L,C);ca.push(M)}z.push(ca)}for(var P={},v=0;v<f.length;v++){var Y=g[v],x=D[v],ha={};x.cd&&
(ha.au_wind_bending_amp=[x.dd],ha.au_wind_bending_freq=[x.ve],ha.au_detail_bending_freq=[x.Wd],ha.au_detail_bending_amp=[x.Vd],ha.au_branch_bending_amp=[x.Rd],x.dd=0,x.ve=0,x.Wd=0,x.Vd=0,x.Rd=0);var ea=W.Ng(x,0),ca=z[v];if(ca.length)for(var R=f[v].data,na=R.materials,Q=0;Q<na.length;Q++)if(!U.Uq(R,Q))for(var V=0;V<Y.length;V++){var X=c(Y[V]),ia=na[Q];if(A(X,ia)){X.$d=U.Uh;I(X,x);X.th=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(X.jr=k.b4w_hair_billboard_jitter_amp,X.kr=k.b4w_hair_billboard_jitter_freq);
r&&(X.Lq=k.b4w_dynamic_grass_scale_threshold);y||(delete X.hb.a_bending_col_main,delete X.hb.a_bending_col_detail);N(X,ea);var mb=U.hq(R,Q,X.di,X.Hc,X.hb,X.Dg),Fb=U.az(mb,ha,ca),Ka=Fb,Aa=ca;Ka.H.au_center_pos=new Float32Array(3*Ka.I);for(var Ga=Aa.length,xb=Ka.I/Ga,ib=0;ib<Ga;ib++)for(var Sb=Aa[ib],Gb=3*xb*ib,Hb=0;Hb<xb;Hb++)Ka.H.au_center_pos[Gb+3*Hb]=Sb[0],Ka.H.au_center_pos[Gb+3*Hb+1]=Sb[1],Ka.H.au_center_pos[Gb+3*Hb+2]=Sb[2];Fb=Ka;if(x.cd&&x.xj){var yb=Fb,Db=a.d.U;yb.H.a_emitter_center=new Float32Array(3*
yb.I);var Ra=xa.fromValues(0,0,0,1);xa.transformMat4(Ra,Db,Ra);for(var va=0;va<yb.I;va++)yb.H.a_emitter_center[3*va]=Ra[0],yb.H.a_emitter_center[3*va+1]=Ra[1],yb.H.a_emitter_center[3*va+2]=Ra[2];Fb=yb}var pb=k.b4w_vcol_from_name,Tb=k.b4w_vcol_to_name,qa=X,rb=d,aa=!y,zb=R,$a=[];if(""!==pb&&""!==Tb){var Ba,ya=Tb,sb=qa.hb,$b=[],ab=void 0;for(ab in sb)for(var Pb=sb[ab].src,Qb=0,Ub=0;Ub<Pb.length;Ub++){var zc=Pb[Ub].Jc;ya==Pb[Ub].name&&$b.push(ab,zc,Qb);Qb+=W.tg(zc)}Ba=$b;if(0<Ba.length)for(var Vb=0;Vb<
Ba.length;Vb+=3)$a.push({ni:pb,Sj:7,Ck:Ba[Vb],Dk:Ba[Vb+1],Qj:Ba[Vb+2]});else U.zy(qa.di,"a_color")&&Tb==zb.active_vcol_name&&$a.push({ni:pb,Sj:7,Ck:"a_color",Dk:7,Qj:0})}aa&&("a_bending_col_main"in rb.hb&&$a.push({ni:"a_bending_col_main",Sj:4,Ck:"a_bending_col_main",Dk:4,Qj:0}),"a_bending_col_detail"in rb.hb&&$a.push({ni:"a_bending_col_detail",Sj:7,Ck:"a_bending_col_detail",Dk:7,Qj:0}));for(var nb=Fb,bb=ca,mc=e,Kb=$a,F=X.hb,gc=!1,qb=0;qb<Kb.length;qb++){var Ib=Kb[qb].ni,Lb=mc.H[Ib];if(Lb&&0<Lb.length){gc=
!0;break}}if(gc){var da,gb=a.d.Nb,Oa=mc.B[0].a_position,Ab=bb,ua=P,Wb=new Float32Array(3),tb=new Float32Array(3),ad=new Uint32Array(Ab.length);if(!("verts_indices"in ua)){ua.Td=new Float32Array(3);ua.Qd=new Float32Array(3);ua.zo=new Uint32Array(Oa.length/3);ua.Ei=new Uint32Array(Oa.length/3);ua.Td[0]=(gb.max_x-gb.min_x)/20;ua.Td[1]=(gb.max_y-gb.min_y)/20;ua.Td[2]=(gb.max_z-gb.min_z)/20;ua.Qd[0]=gb.min_x;ua.Qd[1]=gb.min_y;ua.Qd[2]=gb.min_z;for(var Sa=0;Sa<Oa.length/3;Sa++){var qc=W.trunc((Oa[3*Sa]-
ua.Qd[0])/ua.Td[0]),Ac=W.trunc((Oa[3*Sa+1]-ua.Qd[1])/ua.Td[1]),Jc=W.trunc((Oa[3*Sa+2]-ua.Qd[2])/ua.Td[2]),qc=W.clamp(qc,0,19),Ac=W.clamp(Ac,0,19),Jc=W.clamp(Jc,0,19);ua.zo[Sa]=Sa;ua.Ei[Sa]=Jc*Math.pow(20,2)+20*Ac+qc}U.Ns(ua.Ei,ua.zo,U.hl,!0);ua.Eg=new Uint32Array(Math.pow(20,3));for(Sa=0;Sa<ua.Ei.length;Sa++)ua.Eg[ua.Ei[Sa]]++;delete ua.Ei;for(Sa=1;Sa<ua.Eg.length;Sa++)ua.Eg[Sa]+=ua.Eg[Sa-1]}for(var nc=0;nc<Ab.length;nc++){Wb[0]=Ab[nc][0];Wb[1]=Ab[nc][1];Wb[2]=Ab[nc][2];for(var Mb=1E10,Ta=-1,Ia=W.trunc((Wb[0]-
ua.Qd[0])/ua.Td[0]),bd=W.trunc((Wb[1]-ua.Qd[1])/ua.Td[1]),Kc=W.trunc((Wb[2]-ua.Qd[2])/ua.Td[2]),Ia=W.clamp(Ia,0,19),bd=W.clamp(bd,0,19),Kc=W.clamp(Kc,0,19),cd=Kc*Math.pow(20,2)+20*bd+Ia,dd=ua.Eg[cd],ac=0==cd?0:ua.Eg[cd-1];ac<dd;ac++){var ed=ua.zo[ac];tb[0]=Oa[3*ed];tb[1]=Oa[3*ed+1];tb[2]=Oa[3*ed+2];ba.sub(tb,Wb,tb);var oc=ba.sqrLen(tb);oc<=Mb&&(Mb=oc,Ta=ed)}if(-1==Ta)for(ac=0;ac<Oa.length/3;ac++)tb[0]=Oa[3*ac],tb[1]=Oa[3*ac+1],tb[2]=Oa[3*ac+2],ba.sub(tb,Wb,tb),oc=ba.sqrLen(tb),oc<=Mb&&(Mb=oc,Ta=ac);
ad[nc]=Ta}da=ad;for(var nd=nb.I/bb.length,qb=0;qb<Kb.length;qb++){var hc=Kb[qb].Ck,Bc=Kb[qb].Dk,Ib=Kb[qb].ni,ic=Kb[qb].Sj,Lb=mc.H[Ib];switch(hc){case "a_bending_col_main":var Xb=1;break;case "a_bending_col_detail":Xb=3;break;case "a_color":Xb=3;break;default:for(var ub=Xb=0;ub<F[hc].src.length;ub++)Xb+=W.tg(F[hc].src[ub].Jc)}if(Lb&&0<Lb.length){var fd=W.tg(ic),rc=W.tg(Bc),cb=ic&Bc,bc=W.us(cb);cb!=Bc&&Z.error("Wrong color extraction from "+Ib+" to "+hc+".");if("a_bending_col_main"==hc||"a_bending_col_detail"==
hc)nb.H[hc]=new Float32Array(nb.I*rc);for(ub=0;ub<bb.length;ub++){var Lc=da[ub],Cc=Lc*fd,Yb=ub*nd*Xb;if(-1!=Lc)for(var Dc=0;Dc<nd;Dc++)for(var Mc=Dc*Xb,Jb=0;Jb<bc.length;Jb++)bc[Jb]&&(nb.H[hc][Yb+Mc+(Kb[qb].Qj+W.Ui(Bc,Jb))]=Lb[Cc+W.Ui(ic,Jb)])}}else nb.H[hc]=new Float32Array(0)}}Fb=nb;t.push({D:X,Ac:Fb,Kc:[ia.name],Wb:x,Wc:[a]})}}}return t}function A(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=X.Cp(b));return c=c&&l(a,b)}function N(a,b){for(var c=null,d=null,e=0;e<a.N.length;e++){var f=a.N[e].Sd;f&&(c||
(c={}),c[e]=f,a.N[e].Sd=null);if(f=a.N[e].La)d||(d={}),d[e]=f,a.N[e].La=null}a.id=0;a.Pz=b;a.id=W.Ng(a,b);if(c)for(var g in c)a.N[g].Sd=c[g];if(d)for(g in d)a.N[g].La=d[g]}function L(a,b,d,e,f){var g=c("WIREFRAME");M(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.Rg=!0;g.W=!0;g.th=d;f&&(g.Vp=!0);I(g,b);N(g,W.Ng(b,0));e?(b=u.uq(1,a.F),U.aA(b,[a.Df[0],a.Ef[1],a.Ff[2]],a.F)):b=u.uq(a.Da,a.F);U.co(b,1,!0);b.H.a_polyindex=U.gq(b);C(g,b);return g}function M(a,b,c){a.gb={cj:b,pi:c,Le:[],fn:[],
yn:[]};Y.iA(a.gb)}function G(a,b,c){1==a.N.length&&0==a.Kb.length&&a.Kb.push("default0");c=c||"default"+String(a.N.length);-1==a.Kb.indexOf(c)&&(a.N.push(b),a.Kb.push(c));a.Xb&&ha.fp(a)}function D(a){if(!a.gb)throw"No shaders info for batch "+a.name;a.Xb=Y.by(a.gb);ha.yv(a.Xb);ha.ep(a);ha.fp(a)}var O=m("__boundings"),Q=m("__config"),Z=m("__print"),P=m("__extensions"),U=m("__geometry"),V=m("__graph"),X=m("__nodemat"),ia=m("__objects"),R=m("__particles"),u=m("__primitives"),pa=m("__reformer"),ha=m("__renderer"),
ea=m("__scenegraph"),Y=m("__shaders"),na=m("__textures"),H=m("__tsr"),W=m("__util"),ba=m("vec3"),xa=m("vec4"),ra=m("quat"),ja=Q.o,ca=["MAIN","NODES"],ka=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);a.UD=c;a.Qx=function(a,e,f,g,l,n,p){for(var t=[],y=[],H=[],m=0;m<f.length;m++){var D=f[m];ia.ac(D)?y.push(D):H.push(D)}m=[];m=m.concat(h(y,a,p));y=m=m.concat(k(H,a,e,p));m=[];D=[];H={};for(e=0;e<y.length;e++){var z=y[e].D,x=y[e].Wb,v=null;if(z.id in H){var ka=H[z.id],B=D[ka].D,ba=D[ka].Wb,E=null,
A=null;for(p=0;p<z.N.length;p++){var I=z.N[p].Sd;I&&(E||(E={}),E[p]=I,z.N[p].Sd=null);if(I=z.N[p].La)A||(A={}),A[p]=I,z.N[p].La=null}W.Ys(z,B)&&W.Ys(x,ba)&&(v=D[ka]);if(E)for(p in E)z.N[p].Sd=E[p];if(A)for(p in A)z.N[p].La=A[p];if(!v){do z.id++;while(H[z.id])}}v||(v={D:z,Wb:y[e].Wb,Wc:[],eo:[],Kc:[]},H[z.id]=D.length,D.push(v));v.Wc=v.Wc.concat(y[e].Wc);y[e].Ac&&y[e].Ac.I&&v.eo.push(y[e].Ac);v.Kc=v.Kc.length?v.Kc.concat(y[e].Kc):y[e].Kc;U.Ns(v.Kc,v.eo,U.Iu,!1)}for(e=0;e<D.length;e++){y=D[e].eo;if(0==
y.length)p=W.kb(W.Xk("%empty"));else if(1==y.length)p=y[0];else{H=[];for(p=0;p<y.length;p++)U.Py(y[p])||H.push(p);if(H.length<y.length)for(p=0;p<H.length;p++)U.co(y[H[p]]);p=U.$A(y)}m.push({D:D[e].D,Wb:D[e].Wb,Ac:p,Kc:D[e].Kc,Wc:D[e].Wc})}t.push.apply(t,m);for(m=0;m<t.length;m++)t[m].D.Lc=t[m].Kc,C(t[m].D,t[m].Ac);for(m=0;m<t.length;m++)if(e=t[m].D,"STATIC"==t[m].Wb.type&&"COLOR_ID"!=e.type)D=ia.$q(W.Xk("%meta"),"MESH",!0),D.d=t[m].Wb,D.n=[e],n.push(D);else for(y=[],p=0;p<t[m].Wc.length;p++)if(D=
t[m].Wc[p],-1==y.indexOf(D.name)){for(H=0;H<D.n.length;H++)if(D.n[H]==e)throw"Batch already exist in object";D.n.push(e);y.push(D.name)}if(ja.wireframe_debug){for(m=0;m<t.length;m++)if(e=t[m].Wb,"DYNAMIC"==e.type&&(D=t[m].Wc[0],-1<ca.indexOf(t[m].D.type))){y=!1;for(p=0;p<D.n.length;p++)D.n[p].Rg&&(y=!0);y||(e=L(e.Gf,e,D.name,!0,!0),D.n.push(e))}for(m=0;m<n.length;m++)D=n[m],e=D.d,-1<ca.indexOf(D.n[0].type)&&(e=L(e.Rc,e,D.name,!1),D.n.push(e))}if(l.rs){e=c("MAIN");M(e,"special_skydome.glslv","special_skydome.glslf");
if(l.procedural_skydome)q(e,"PROCEDURAL_SKYDOME",1),e.js=!0;else{if(t=g.Tn){q(e,"WO_SKYTEX",1);m=w(g.Ks,null);G(e,m,"u_sky");t.invert&&q(e,"MTEX_NEGATIVE",1);t.TB&&q(e,"MTEX_RGBTOINT",1);switch(t.op){case "MIX":m=0;break;case "ADD":m=1;break;case "SUBTRACT":m=2;break;case "MULTIPLY":m=3;break;case "SCREEN":m=4;break;case "OVERLAY":m=5;break;case "DIFFERENCE":m=6;break;case "DIVIDE":m=7;break;case "DARKEN":m=8;break;case "LIGHTEN":m=9;break;case "HUE":m=10;break;case "SATURATION":m=11;break;case "VALUE":m=
12;break;case "COLOR":m=13;break;case "SOFT_LIGHT":m=14;break;case "LINEAR_LIGHT":m=15;break;default:Z.warn('Unknown sky texture blend type"'+t.op+'"'),m=0}q(e,"BLENDTYPE",m);t.PB&&q(e,"WOMAP_BLEND",1);t.QB&&q(e,"WOMAP_HORIZ",1);t.SB&&q(e,"WOMAP_ZENUP",1);t.RB&&q(e,"WOMAP_ZENDOWN",1)}g.UB&&q(e,"WO_SKYBLEND",1);g.VB&&q(e,"WO_SKYPAPER",1);g.WB&&q(e,"WO_SKYREAL",1)}l.Vb&&(e.Vb=!0,l.Hb&&(e.Hb=!0));r(e,"a_position");e.jg=99999;g=u.Ox();C(e,g);D=ia.$q(W.Xk("%meta"),"MESH",!0);D.d=ia.Lj("DYNAMIC");D.d.Tg=
!0;D.d.Nb=O.Gd();D.d.Rc=O.hj();D.d.$a=O.Gd();D.d.sb=O.hj();D.n=[e];n.push(D)}for(m=0;m<f.length;m++)for(p=0;p<f[m].n.length;p++)d(f[m].n[p]);for(m=0;m<n.length;m++)for(p=0;p<n[m].n.length;p++)d(n[m].n[p]);for(m=0;m<f.length;m++)b(f[m],a);for(m=0;m<n.length;m++)b(n[m],a)};a.fC=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Av=n;a.Zx=w;a.ul=function(a,b){q(a,"CSM_SECTION0",0);q(a,"CSM_SECTION1",
0);q(a,"CSM_SECTION2",0);q(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)q(a,"CSM_SECTION"+String(c),1);q(a,"SHADOW_TEX_RES",Y.u(b.csm_resolution));q(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);q(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.ka=q;a.tb=function(a,b){return Y.fy(a.gb,b)};a.sB=N;a.Lg=G;a.Tz=function(a,b,c){c=a.Kb.indexOf(c);-1<c&&(a.N[c]=b)};a.Jw=function(a,b){var d=c("MAIN");d.Fa=!0;xa.set(b[0],b[1],b[2],.5,d.Ob);d.$d=U.lj;C(d,a);M(d,"main.glslv","main.glslf");
q(d,"SHADELESS",1);D(d);return d};a.zb=D;a.Qv=function(a){return a.Xb.Ji.length?a.Xb.En.u_cube_fog?!0:!1:!1};a.ww=function(){var a=c("DEPTH_PACK");a.Ja=!0;a.W=!1;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");D(a);return a};a.Rp=function(a){var b=c("POSTPROCESSING");M(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":q(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":q(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");
break;case "X_BLUR":q(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":q(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":q(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":q(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":q(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":q(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;default:throw"Wrong postprocessing effect: "+a;}b.Ja=!0;b.W=!1;a=u.mb();C(b,a);D(b);return b};a.Nw=function(a){var b=
c("SSAO");b.W=!1;b.Ja=!0;var d=u.mb();C(b,d);M(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");q(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Ts);q(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:na.Tx(a)};d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=w(a,d);G(b,a,"u_ssao_special_tex");
D(b);return b};a.Ow=function(a){var b=c("SSAO_BLUR");b.W=!1;b.Ja=!0;var d=u.mb();C(b,d);M(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");q(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);D(b);return b};a.xw=function(){var a=c("DOF");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");q(a,"DEPTH_RGBA",1);D(a);return a};a.Fw=function(){var a=c("OUTLINE");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv",
"postprocessing/outline.glslf");D(a);return a};a.zw=function(){var a=c("GLOW_COMBINE");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");D(a);return a};a.Aw=function(a,b,d){var e=c("GOD_RAYS");e.W=!1;e.Ja=!0;var f=u.Jx();C(e,f);M(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");q(e,"DEPTH_RGBA",a?1:0);q(e,"WATER_EFFECTS",b?1:0);q(e,"STEPS_PER_PASS",Y.u(d,1));D(e);return e};a.Bw=function(){var a=c("GOD_RAYS_COM");a.W=!1;a.Ja=
!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");D(a);return a};a.Kw=function(){var a=c("SKY");a.W=!1;a.Ja=!0;var b=u.Kx();C(a,b);M(a,"procedural_skydome.glslv","procedural_skydome.glslf");q(a,"WATER_EFFECTS",1);D(a);return a};a.qw=function(){var a=c("ANTIALIASING");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");q(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");D(a);return a};a.Lw=function(a){var b=
c("SMAA"),d=u.mb();C(b,d);M(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");q(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");q(b,"SMAA_PASS",a);q(b,"SMAA_PREDICATION",0);q(b,"SMAA_REPROJECTION",0);D(b);b.W=!1;b.Ja=!0;return b};a.uw=function(){var a=c("COMPOSITING");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");D(a);return a};a.Ew=function(a){var b=c("MOTION_BLUR");b.Ja=!0;b.W=!1;var d=u.mb();C(b,d);M(b,"postprocessing/postprocessing.glslv",
"postprocessing/motion_blur.glslf");q(b,"BLUR_DECAY_THRESHOLD",Y.u(a));D(b);return b};a.ow=function(){var a=c("ANAGLYPH");a.Ja=!0;a.W=!1;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");D(a);return a};a.Cw=function(){var a=c("LUMINANCE");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");D(a);return a};a.rw=function(){var a=c("LUMINANCE");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance_av.glslf");D(a);return a};a.Dw=function(){var a=c("LUMINANCE_X_BLUR");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");D(a);return a};a.sw=function(){var a=c("POSTPROCESSING");a.Ja=!0;a.W=!1;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");D(a);return a};a.tw=function(){var a=c("BLOOM");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv",
"postprocessing/bloom_combine.glslf");D(a);return a};a.Rw=function(){var a=c("VELOCITY");a.W=!1;a.Ja=!0;var b=u.mb();C(a,b);M(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");D(a);return a};a.pw=function(){var a=c("ANCHOR_VISIBILITY");a.W=!0;a.Ja=!0;a.$d=U.Lo;M(a,"anchors.glslv","anchors.glslf");var b=u.tq(1);C(a,b);q(a,"ANCHOR_NUM",1);D(a);a.Mi=new Float32Array([0,0,0]);return a};a.rB=function(a,b){var c=b.length/3;if(c!=a.Mi.length/3){var d=u.tq(c);C(a,d);q(a,"ANCHOR_NUM",
c);D(a)}a.Mi=b};a.aa=function(a,b,c){for(var d=0;d<a.n.length;d++)if(a.n[d].type==c&&!a.n[d].Qf&&-1!=a.n[d].Lc.indexOf(b))return a.n[d];return null};a.pc=function(a,b,c){for(var d=0;d<a.n.length;d++)if(a.n[d].type==c&&a.n[d].Qf&&-1!=a.n[d].Lc.indexOf(b))return a.n[d];return null};a.zs=function(a,b){a.Ob.set(b.Ob);a.Ke=b.Ke;a.zd.set(b.zd);a.gc.set(b.gc);a.ae=b.ae;a.Nd=b.Nd;a.Je=b.Je;a.Ce=b.Ce;a.rg=b.rg;a.Uc.set(b.Uc);a.ng=b.ng;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;
a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Sh=b.Sh};a.TC=function(a,b){for(var c=a.n,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.ew=function(a){for(var b=a.N,c=0;c<b.length;c++)na.dx(b[c].Ra);U.Gp(a.S)}};b4w.module.__nodemat=function(a,m){function c(a,b,c,l,n){if(b in W)return W[b];for(var p=R.create(),q=a.nodes,t=a.links,r=a.animation_data,m=0;m<q.length;m++)if(!B(p,q[m],0,r,l))return W[b]=null;if(c&&-1==z(a,p,"GROUP_OUTPUT","group"))return null;m=O(p);if(!Q(p,t,m))return null;if(c)return p;for(m=0;m<t.length;m++){c=t[m];for(var q=k(c.from_node,p),H=k(c.to_node,p),D=0;D<q.length;D++)for(var v=0;v<H.length;v++){for(var x=q[D],u=H[v],ba=R.Ua(p,x),C=R.Ua(p,u),E=p,A=C,C=[],G=c.from_socket.identifier,
I=c.to_socket.identifier,N=ba.Oa,ba=0;ba<N.length;ba++)if(N[ba].identifier==G){C.push(ba);break}A=A.K;for(ba=0;ba<A.length;ba++)if(A[ba].identifier==I){C.push(ba);break}2==C.length&&R.gd(E,x,u,C)}}h(p);a=n?z(a,p,"B4W_GLOW_OUTPUT","material",!0):z(a,p,"OUTPUT","material");if(-1==a)return W[b]=null;f(p);p=R.Zs(p,a,R.Jo);d(p);g(p);y(p);w(p);e(p,r,l);return W[b]=p}function d(a){R.T(a,function(c,d){for(var e=d.K,f=d.Oa,g=0;g<e.length;g++)b(a,e[g],c,g,1);for(g=0;g<f.length;g++)b(a,f[g],c,g,0)})}function b(a,
b,c,d,e){if(b.Sb){var f=!0;R.te(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.Sb=!1)}}function e(a,b,c){var d=[];R.te(a,function(e,f,g){var h=R.Ua(a,e),k=R.Ua(a,f),h=pa.is_vector(h.Oa[g[0]].Ba),k=pa.is_vector(k.K[g[1]].Ba);if(h!=k){var l,n={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},p={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};h&&!k?l=E("vector_to_scalar","B4W_VECTOSCAL",[n],[p]):!h&&k&&(l=E("scalar_to_vector","B4W_SCALTOVEC",
[p],[n]));B(a,l,0,b,c);d.push([e,f,a.xa[a.xa.length-2],g])}});for(var e=0;e<d.length;++e)R.sg(a,d[e][0],d[e][1],-1),R.gd(a,d[e][0],d[e][2],[d[e][3][0],0]),R.gd(a,d[e][2],d[e][1],[0,d[e][3][1]])}function h(a){var b=[];R.T(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":R.te(a,function(a,e,f){a==c&&"Translucency"==d.Oa[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)R.gd(a,b[c],b[c+1],b[c+2])}function k(a,b){var c=[];R.T(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;
throw"Node not found";}function f(a){var b=[];R.T(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var f=n(a,d);if(-1!=f){var g=R.Xj(a,f,0);R.sg(a,f,d,-1);-1!=g&&R.sg(a,g,f,-1);d=R.Ua(a,f);e.data=d.data;e.M[0]=d.M[0];R.Ti(a,f)}e.K.splice(1,1)}else if("REROUTE"==e.type){for(var e=R.Xj(a,d,0),h=R.uh(a,d),f=[],g=[],k=[],l=0;l<h;l++){var p=R.bh(a,d,l),q=g.indexOf(p);-1!=q?k[q]+=1:(g.push(p),k.push(1),f.push(d,
p))}if(-1!=e)for(h=R.$g(a,e,d,0)[0],l=0;l<g.length;l++)for(p=0;p<k[l];p++)q=R.$g(a,d,g[l],p)[1],R.gd(a,e,g[l],[h,q]);for(l=0;l<f.length;l+=2)R.sg(a,f[l],f[l+1],-1)}}}function n(a,b){for(var c=a.na,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function g(a){var b=[];R.T(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=
b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(p(f,k.jc)){g=[];h=R.uh(a,e);for(q=0;q<h;q++){var l=R.bh(a,e,q),n=R.$g(a,e,l,0);g.push(e,l,n);R.gd(a,k.id,l,n)}for(var q=0;q<g.length;q+=3)R.sg(a,g[q],g[q+1],0);R.Ti(a,e);g=!1;break}}g&&(k={id:e,jc:f},c.push(k))}}function l(a){for(var b={},c=0;c<a.xa.length;c+=2){var d=a.xa[c];b[d]=[]}for(c=0;c<a.na.length;c+=3){var e=a.na[c],f=a.na[c+1];b[f].push(e);b[f].push(b[e])}for(d in b)b[d]=JSON.stringify(b[d]).match(/\d+/g)||[],b[d]=b[d].map(function(a){return parseInt(a)});
return b}function y(a){var b=[];R.T(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=l(a),d=[],e=0;e<b.length;e+=2){for(var f=b[e],g=b[e+1],h=!0,k=0;k<d.length;k++){var n=d[k];if(!(3<=n.oh.length||!p(g,n.jc)||-1<c[f].indexOf(n.id)||-1<c[n.id].indexOf(f))){for(var q=!1,t=0;t<n.oh.length;t++){var y=n.oh[t].id;if(-1<c[f].indexOf(y)||-1<c[y].indexOf(f)){q=!0;break}}if(!q){for(var k=[],y=R.Zq(a,f),r={},t=0;t<y;t++)q=R.Xj(a,f,t),q in r||(r[q]=0),h=
R.$g(a,q,f,r[q]++),k.push(q,f,h);for(var y=[],r=R.uh(a,f),m={},t=0;t<r;t++)q=R.bh(a,f,t),q in m||(m[q]=0),h=R.$g(a,f,q,m[q]++),y.push(f,q,h);h=k.concat(y);for(t=0;t<h.length;t+=3)R.sg(a,h[t],h[t+1],0);R.Ti(a,f);t={id:f,jc:g,kx:k,lx:y};n.oh.push(t);h=!1;break}}}h&&(n={id:f,jc:g,oh:[]},d.push(n))}for(e=0;e<d.length;e++){n=d[e];c=n.oh.length;for(k=0;k<c;k++){g=n.oh[k];t=g.jc;f=g.kx;g=g.lx;n.jc.K[k+1].Sb=t.K[0].Sb;n.jc.K[k+1].Ba=t.K[0].Ba;n.jc.Oa[2*(k+1)].Sb=t.Oa[0].Sb;n.jc.Oa[2*(k+1)].Ba=t.Oa[0].Ba;
n.jc.Oa[2*(k+1)+1].Sb=t.Oa[1].Sb;n.jc.Oa[2*(k+1)+1].Ba=t.Oa[1].Ba;for(t=0;t<f.length;t+=3)q=f[t],h=f[t+2],h[1]+=k+1,R.gd(a,q,n.id,h);for(t=0;t<g.length;t+=3)q=g[t+1],h=g[t+2],h[0]+=2*(k+1),R.gd(a,n.id,q,h);n.jc.Me.push(["USE_uv"+(k+2),1])}R.Ti(a,n.id);R.rl(a,n.id,n.jc)}}}function p(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==
b.data.value;default:return!1}}function w(a){var b=[];R.T(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],l=R.uh(a,d),n=0;n<l;n++){var p=R.bh(a,d,n);if("SEPRGB"!=R.Ua(a,p).type){f=!1;break}g.push(d,p);for(var q={},t=R.uh(a,p),f=0;f<t;f++){var y=R.bh(a,p,f);y in q||(q[y]=0);var r=R.$g(a,p,y,q[y]++);g.push(p,y);k[r[0]].push(d,y,r)}h.push(p);f=!0}if(f){for(n=d=l=0;n<k.length;n++)k[n].length&&(l++,d|=1<<2-n);if(l){e.type+=
l;e.Oa=[];for(n=0;n<k.length;n++)if(k[n].length)for(e.Oa.push({Ba:0,identifier:"RGB"[n],Sb:!0,name:"RGB"[n]}),f=0;f<k[n].length;f+=3)k[n][f+2][0]=pa.Ui(d,n);for(n=0;n<g.length;n+=2)R.sg(a,g[n],g[n+1],0);for(n=0;n<h.length;n++)R.Ti(a,h[n]);for(n=0;n<k.length;n++)for(f=0;f<k[n].length;f+=3)R.gd(a,k[n][f],k[n][f+1],k[n][f+2])}}}}function z(a,b,c,d,e){a=a.nodes;for(var f=null,g=0;g<a.length;g++){var h=a[g];e?"GROUP"==h.type&&h.node_tree_name==c&&(f=h):h.type==c&&(f=h)}return f?k(f,b)[0]:(ia.error('No "'+
c+'" node in node '+d),-1)}function E(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function B(a,b,c,d,e){var f=b.name,g=b.type,h=[],k=[],l=[],n=[],p=null,y=[];switch(g){case "CAMERA":k=[];l=M(b);break;case "COMBRGB":case "COMBHSV":k=L(b);l=M(b);break;case "GEOMETRY":a:{for(var g=b.outputs,m=0;m<g.length;m++)if(g[m].is_linked){g=!0;break a}g=!1}if(!g)return!0;g=r(b,c);if(!g)return ia.error("Geometry output is not supported"),!1;switch(g){case "GEOMETRY_UV":if(!b.uv_layer)return ia.error('Missing uv layer in node "',
b.name,'"'),!1;p=I("param_GEOMETRY_UV_a");m=I("param_GEOMETRY_UV_v");h.push(G(p));h.push(G(m));l.push(J(b,"UV"));n.push(G(m));p={name:p,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return ia.error("Missing vertex color layer in node ",b.name),!1;p=I("param_GEOMETRY_VC_a");m=I("param_GEOMETRY_VC_v");h.push(G(p));h.push(G(m));l.push(J(b,"Vertex Color"));n.push(G(m));p={name:p,value:b.color_layer};break;case "GEOMETRY_NO":l.push(J(b,"Normal"));break;case "GEOMETRY_FB":l.push(J(b,"Front/Back"));
break;case "GEOMETRY_VW":l.push(J(b,"View"));break;case "GEOMETRY_GL":l.push(J(b,"Global"))}break;case "GROUP":m=b.node_tree_name;switch(m){case "B4W_LINEAR_TO_SRGB":if(!v(b,[1],[1])){p=t(b,e);break}g="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!v(b,[1],[1])){p=t(b,e);break}g="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!v(b,[1],[1])){p=t(b,e);break}g="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!v(b,[1,1],[1])){p=t(b,e);break}g="B4W_REFLECT";break;case "B4W_REFRACTION":if(!v(b,
[1,0],[1])){p=t(b,e);break}g="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!v(b,[1,1,0,0,0],[1])){p=t(b,e);break}var g="B4W_PARALLAX",H=I("temp_texture");n.push(G(H));break;case "B4W_CLAMP":if(!v(b,[1],[1])){p=t(b,e);break}g="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!v(b,[0,0,0,0,0],[0])){p=t(b,e);break}g="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!v(b,[],[0])){p=t(b,e);break}g="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!v(b,[0,0,0],[0])){p=t(b,e);break}g="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":g=
"B4W_GLOW_OUTPUT";break;default:p=t(b,e)}k=L(b);l=M(b);"B4W_TRANSLUCENCY"==m&&(m=N("TranslucencyParams","TranslucencyParams",[0,0,0,0]),m.Sb=l[0].Sb,l.push(m));break;case "LAMP":p=b.lamp;if(!p)return ia.error("There is no lamp in node: "+b.name),!1;l.push(J(b,"Color"));l.push(J(b,"Light Vector"));l.push(J(b,"Distance"));l.push(J(b,"Visibility Factor"));p.uuid in ba?y.push(["LAMP_INDEX",String(ba[p.uuid])]):(ba[p.uuid]=xa,y.push(["LAMP_INDEX",String(xa++)]));p=ba;break;case "NORMAL":k=L(b);l=M(b);
m=J(b,"Normal");n.push(G(I("param_NORMAL_Normal"),m.Ba,3));break;case "MAPPING":m=b.vector_type;g="MAPPING";k.push(C(b,"Vector"));l.push(J(b,"Vector"));var H=b.rotation,w=b.scale,D=b.translation,z=Y.create(),x=pa.nx(H),W=new Float32Array([w[0],0,0,0,w[1],0,0,0,w[2]]);Y.multiply(x,W,z);z=pa.cz(z,na.create());switch(m){case "POINT":z[12]=D[0];z[13]=D[1];z[14]=D[2];break;case "TEXTURE":z[12]=D[0];z[13]=D[1];z[14]=D[2];z=na.invert(z,z);break;case "NORMAL":na.invert(z,z),na.transpose(z,z)}switch(m){case "NORMAL":y.push(["MAPPING_IS_NORMAL",
1]);case "TEXTURE":y.push(["MAPPING_TRS_MATRIX",u.u(z,16)]);break;case "POINT":0!==ea.length(H)?y.push(["MAPPING_TRS_MATRIX",u.u(z,16)]):(0!==ea.length(w)&&y.push(["MAPPING_SCALE",u.u(w,3)]),0!==ea.length(D)&&y.push(["MAPPING_TRANSLATION",u.u(D,3)]));break;case "VECTOR":0!==ea.length(H)?y.push(["MAPPING_TRS_MATRIX",u.u(z,16)]):0!==ea.length(w)&&y.push(["MAPPING_SCALE",u.u(w,3)])}b.use_min&&y.push(["MAPPING_MIN_CLIP",u.u(b.min,3)]);b.use_max&&y.push(["MAPPING_MAX_CLIP",u.u(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":p=
C(b,"Color");p.Ba.splice(3);k.push(p);(p=C(b,"Alpha"))?k.push(p):k.push(N("Alpha","Alpha",1));p=C(b,"Spec");p.Ba.splice(3);k.push(p);m=C(b,"Normal");m.Ba.splice(3);k.push(m);l.push(J(b,"Color"));l.push(J(b,"Alpha"));l.push(J(b,"Normal"));"MATERIAL_EXT"==g&&((p=C(b,"Emit"))?k.push(p):k.push(N("Emit","Emit",0)),p=C(b,"Translucency"),p.Ba=0,p.name="Translucency",p.identifier="Translucency",p?k.push(p):k.push(N(p.name,p.identifier,p.Ba)),p=C(b,"Translucency"),p.Ba=[0,0,0,0],p.name="TranslucencyParams",
p.identifier="TranslucencyParams",p?k.push(p):k.push(N(p.name,p.identifier,p.Ba)),p=C(b,"Reflectivity"),H=C(b,"Ray Mirror"),p?H="Reflectivity":H?(p=H,H="Ray Mirror"):H="Reflectivity",p?k.push(p):k.push(N(H,H,0)),(p=C(b,"SpecTra"))?k.push(p):k.push(N("SpecTra","SpecTra",0)),l.push(J(b,"Diffuse")),l.push(J(b,"Spec")));H=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":p=b.specular_hardness;break;case "WARDISO":p=b.specular_slope;break;case "TOON":p=b.specular_toon_size;H=b.specular_toon_smooth;
break;default:ia.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),p=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":D=w=0;break;case "OREN_NAYAR":w=b.roughness;D=0;break;case "FRESNEL":w=b.diffuse_fresnel;D=b.diffuse_fresnel_factor;break;default:ia.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),D=w=0}n.push(G(I("param_MATERIAL_diffuse"),[w,D],2));n.push(G(I("param_MATERIAL_spec"),[b.specular_intensity,
p,H],3));p={name:b.name,value:{OA:b.specular_shader,fx:b.diffuse_shader,Cg:b.use_shadeless,Bh:b.specular_alpha}};m.Sb&&y.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&y.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&y.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":g="MATH_ADD";break;case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";
break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g="MATH_ARCSINE";break;case "ARCCOSINE":g="MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g="MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g="MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";
break;default:return ia.error("Unsupported MATH operation: "+b.operation),!1}y.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=L(b);l=M(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g="MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g=
"MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";break;case "DODGE":g="MIX_RGB_DODGE";break;case "BURN":g="MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return ia.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}y.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);
k=L(b);l=M(b);break;case "OUTPUT":k=L(b);l=[];break;case "RGB":m=e+"%join%"+b.name;m={name:"-1",value:m};n.push(m);l.push(J(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=L(b);l=M(b);break;case "TEXTURE":g=q(b);if("TEXTURE_EMPTY"==g)l.push(J(b,"Color")),l.push(J(b,"Normal")),l.push(J(b,"Value"));else if("TEXTURE_ENVIRONMENT"==g)k.push(C(b,"Vector")),l.push(J(b,"Color")),l.push(J(b,"Value"));else{if("TEXTURE_NORMAL"==g&&"ENVIRONMENT_MAP"==b.texture.type)return ia.error("Wrong output for ENVIRONMENT_MAP texture: "+
b.name),!1;for(w=0;4>w;++w)w?(p=N("Vector"+w,"Vector"+w,[0,0,0]),"TEXTURE_COLOR"==g&&(m=N("Color"+w,"Color"+w,[0,0,0]),H=N("Value"+w,"Value"+w,0)),"TEXTURE_NORMAL"==g&&(m=N("Normal"+w,"Normal"+w,[0,0,0]),H=N("Value"+w,"Value"+w,0))):(p=C(b,"Vector"),"TEXTURE_COLOR"==g&&(m=J(b,"Color"),H=J(b,"Value")),"TEXTURE_NORMAL"==g&&(m=J(b,"Normal"),H=J(b,"Value"))),k.push(p),l.push(m),l.push(H)}H=I("param_TEXTURE_texture");n.push(G(H));p={name:H,value:b.texture};break;case "VALUE":g="VALUE";m=e+"%join%"+b.name;
m={name:"-1",value:m};n.push(m);l.push(J(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":g="VECT_MATH_ADD";break;case "SUBTRACT":g="VECT_MATH_SUBTRACT";break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g="VECT_MATH_NORMALIZE";break;default:return ia.error("Unsupported VECT_MATH operation: "+b.operation),!1}k=L(b);l=M(b);break;default:k=L(b),l=M(b)}f={name:f,type:g,
ej:h,K:k,Oa:l,M:n,data:p,Me:y};R.rl(a,R.sq(a),f);if(f="GEOMETRY"==b.type)a:{f=b.outputs;for(k=h=0;k<f.length;k++)if(f[k].is_linked&&h++>c){f=!0;break a}f=!1}return f&&!B(a,b,++c,d,e)?!1:!0}function v(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,g=0;g<b.length;g++){var h=d[g],k=b[g];if(!h||h.default_value instanceof Array!=k)return ia.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=e[g],d=c[g],!b||
b.default_value instanceof Array!=d)return ia.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1;return!0}function t(a,b){var d=a.node_group.node_tree,e={},f;for(f in d)if("links"==f||"nodes"==f){e[f]=[];for(var g=0;g<d[f].length;g++){e[f][g]={};for(var h in d[f][g])if("links"==f){e[f][g][h]={};for(var k in d[f][g][h])e[f][g][h][k]=x(d[f][g][h][k])}else e[f][g][h]=x(d[f][g][h])}}else e[f]=x(d[f]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==
d)f=E("Group input","GROUP_INPUT",[],a.inputs),g=E("Group output","GROUP_OUTPUT",a.outputs,[]),h=null,h="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d&&(ra.quality==ha.P_LOW||ra.wm)?{from_node:f,from_socket:f.outputs[1],to_node:g,to_socket:g.inputs[0]}:{from_node:f,from_socket:f.outputs[0],to_node:g,to_socket:g.inputs[0]},e.nodes=[f,g],e.links=[h];d=a.name;f=e.nodes;g=e.links;for(h=0;h<f.length;h++)f[h].name=D(f[h].type,d,f[h].name);for(h=0;h<g.length;h++)g[h].from_node.name=D(g[h].from_node.type,d,
g[h].from_node.name),g[h].to_node.name=D(g[h].to_node.type,d,g[h].to_node.name);return{oz:c(e,a.node_group.uuid,!0,b),pz:e.links}}function x(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?pa.Gj(a):a}function I(a){H[a]||(H[a]=0);var b=a+H[a],b=b.replace(/ /g,"_").replace(/\//g,"_");H[a]++;return b}function r(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";
case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function q(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.is_linked)switch(g.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ia.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),
"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function C(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return A(e)}return null}function J(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return A(e)}return null}function A(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=pa.is_vector(a)?a.slice(0):
a;return{name:b,identifier:c,Sb:d,Ba:a}}function N(a,b,c){return{name:a,identifier:b,Sb:!1,Ba:c}}function L(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=A(a.inputs[c]);d.Ba.length&&d.Ba.splice(3);b.push(d)}return b}function M(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=A(a.outputs[c]);b.push(d)}return b}function G(a,b,c){b=null===b||void 0===b?null:u.u(b,c);return{name:a,value:b}}function D(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function O(a){var b=
[];R.T(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function Q(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.oz,f=c[d].data.pz;if(!e)return!1;R.T(e,function(b,c){R.rl(a,R.sq(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);X(c[d],b,a)}return!0}function Z(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function P(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=
c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function U(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function V(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],g,h=0;h<c.K.length;h++)if(f.from_socket.identifier==c.K[h].identifier){g=c.K[h].Ba;break}for(var h=
f,l=b,n=g,p=k(h.to_node,l),q=0;q<p.length;q++)for(var t=R.Ua(l,p[q]),y=0;y<t.K.length;y++)if(t.K[y].identifier==h.to_socket.identifier){t.K[y].Ba=n;break}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function X(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],k=0;k<b.length;k++){var l=b[k];Z(l.from_node,d,l,e,g,h);Z(l.to_node,d,l,f,g,h)}f=P(b,f,g);e=P(b,h,e);U(b,f);V(b,c,a,f);if(e.length){var n;R.T(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(n=b)});V(b,c,n,e)}}var ia=m("__print"),R=m("__graph"),
u=m("__shaders"),pa=m("__util"),ha=m("__config"),ea=m("vec3");m("vec4");var Y=m("mat3"),na=m("mat4"),H={},W={},ba={},xa=0;new Float32Array(4);var ra=ha.o;a.gw=c;a.hw=function(a){var b=[],c={};H={};var d=R.mo(a);R.T(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],l=[],n=0;n<d.K.length;n++){var p=d.K[n];if(p.Sb)e.push(null),f.push(null);else{e.push(I("in_"+d.type+"_"+p.identifier));var q=u.u(p.Ba,0);ra.Ds&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==p.identifier||"Color2"==p.identifier||"Fac"==
p.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==p.identifier||"Value_001"==p.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==p.identifier)&&(p=q,p=p.replace(/(,)/g,"$1 "),p=p.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),p=p.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=p=p.replace(/\s+/g,""));f.push(q)}}for(n=0;n<d.Oa.length;n++)p=d.Oa[n],p.Sb?g.push(null):g.push(I("out_"+d.type+"_"+p.identifier));for(n=0;n<d.M.length;n++)p=d.M[n],h.push(p.name),
k.push(p.value);for(n=0;n<d.ej.length;n++)l.push(d.ej[n].name);e={id:d.type,K:e,Um:f,Oa:g,M:h,Bk:k,ej:l,Me:JSON.parse(JSON.stringify(d.Me))};b.push(e);c[a]=e});R.te(d,function(a,b,e){var f=R.Ua(d,a);R.Ua(d,b);var g=f.Oa[e[0]];a=c[a].Oa;b=c[b].K;f=a[e[0]]||I("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.Cp=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=
function(){for(var a in W)delete W[a];for(var b in ba)delete ba[b];xa=0}};b4w.module.__animation=function(a,m){function c(a,b){var c=a.C[b];c&&c.tm&&c.oi&&(c.oi=!1,c.tm(a))}function d(a,b,c){c=a.C[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.nc=d;c.Jg=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.ut=d}function b(a,b,c){a=a.C[c];a.type=50;a.Jg=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.sc=b}function e(a){return a.replace(/_B4W_BAKED$/,"")}function h(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:u.pa("Wrong animation behavior")}}function k(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&f(d,b)}return b}function f(a,b){if(a.animation_data){var c=a.animation_data.action;c&&u.nd(c.fcurves)&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&
f(e,b)}}function n(a){return u.is_mesh(a)&&a.d.cl?!0:!1}function g(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function l(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function y(a,b,d,e){x(a,b,d,e);c(a,d);a.d.Ee&&(q(a,b),r(a,b))}function p(a,b,c){var d=b.frame_range,e=b.d,f=a.C[c];f.Jg=b.name;f.ml=d;f.Xo=e.yz;f.Wo=e.Cv;f.Fj=e.Fj;f.start=d[0];f.length=d[1]-d[0];f.nc=d[0];d=u.nd(e.Aj);if(u.is_armature(a)&&d){f.type=
10;var g=w(a,b);g||(g=C(a,b,B(a)),a.Md.push(b,g));f.g=g.g;f.ya=g.ya;var f=a.d,g=f.Rk,h=a.C[c],e=h.Rn,k;a:{k=f.Fs;for(var l=0;l<k.length;l+=2)if(b==k[l]){k=k[l+1];break a}k=null}if(k)h.Rn=k;else{for(h=0;h<g.length;h++)k=C(a,b,g[h].Hc),e.push(k);f.Fs.push(b,e)}f.Ee&&(b=f.Wk,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),z(a))}else if(X.ge(a)&&(e.M.volume||e.M.pitch))f.volume=e.M.volume||null,f.pitch=e.M.pitch||null,f.type=40;else if("MESH"==a.type&&t(b)){f.type=60;e=w(a,b);if(!e){e=[];h=[];
k=[];var l=[],n=b.d,p=a.d.mk,q=a.d.nk;for(g in n.M){var y=b.name+"%join%"+g;v(g,y,n,h,e,p);v(g,y,n,l,k,q)}e={YB:e,values:h,Uz:k,Vz:l};a.Md.push(b,e)}f.Br=e.YB;f.Dr=e.values;f.Ar=e.Uz;f.Cr=e.Vz}else if(g=e.M.tsr){f.type=20;e=w(a,b);if(!e){e=b.d.Hr;h=[];k=[];for(l=0;l<e;l++)h.push(g.subarray(8*l,8*l+4)),k.push(g.subarray(8*l+4,8*l+8));e={g:h,ya:k};a.Md.push(b,e)}f.g=e.g;f.ya=e.ya;P.eh(a)&&P.JB(a,f.g,f.ya)}else return V.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),
!1;u.is_armature(a)&&!d&&E(a,c);return!0}function w(a,b){for(var c=a.Md,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function z(a){var b=a.d.Wk;if(-1!=b[0]&&-1!=b[1]){var c=a.C;a=c[b[1]].nc;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.nc;d=Math.floor(a);b.nc=d+e}}function E(a,b){var c=a.d.Wk,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.C;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function B(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=
b[d].name;c[e]={sp:d,ii:d,Fn:u.Hm(a,"name",e),wt:-1}}return c}function v(a,b,c,d,e,f){for(var g=0;g<f.length;g+=2)b==f[g]&&(e.push(f[g+1]),d.push(new Float32Array(c.M[a])))}function t(a){a=a.d;for(var b in a.M)if(-1!=b.indexOf("nodes"))return!0;return!1}function x(a,b,c,d){if((c=a.C[c])&&null!=c.type&&(c.play||d)){var e=a.d;d=c.nc;var f=c.start,g=c.length;d+=c.speed*b*Y.Ha;var h=c.type,k=c.speed;if(0<=k&&d>=f+g||0>k&&d<f)switch(c.oi=!0,c.behavior){case 10:d=0<=k?(d-f)%g+f:f+g-1E-6;break;case 20:d=
0<=k?f:f+g-1E-6;c.play=!1;break;case 30:d=0<=k?f+g-1E-6:f,c.play=!1}c.nc=d;switch(h){case 10:if(!e.Ee){d=I(c,d,na);b=d[0];f=d[1];d=d[2];e.vc=c.ya[b];e.uc=c.ya[f];e.Dc=c.g[b];e.Cc=c.g[f];e.Rf=d;e=e.Rk;c=c.Rn;for(g=0;g<e.length;g++)h=e[g],k=c[g],h.vc=k.ya[b],h.uc=k.ya[f],h.Dc=k.g[b],h.Cc=k.g[f],h.Rf=d;ia.w(a)}break;case 20:h=d=I(c,d,na);(e=H)||(e=new Float32Array(4));var f=h[0],g=h[1],h=h[2],k=c.g,l=k[f][1],n=k[f][2],p=k[g][1],q=k[g][2];e[0]=(1-h)*k[f][0]+h*k[g][0];e[1]=(1-h)*l+h*p;e[2]=(1-h)*n+h*q;
f=d;(g=ba)||(g=new Float32Array(4));h=c.ya;ha.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=d[2];h=c.g;d=(1-g)*h[d[0]][3]+g*h[d[1]][3];c.no&&(g=W,ia.get_translation(a,g),u.smooth_v(e,g,b,c.no,e));c.Jn&&(g=xa,ia.get_rotation(a,g),u.Ms(f,g,b,c.Jn,f));c=c.Fj;c[0]&&ia.set_translation(a,e);c[1]&&ia.set_rotation(a,f);c[2]&&ia.set_scale(a,d);ia.w(a);U.sync_transform(a);break;case 30:(a=na)||(a=Array(3));f=d-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);d=b+1;f-=b;10!=c.behavior&&
d==c.length&&(d=--b,f=1);c=c.ut;a[0]=b+c;a[1]=d+c;a[2]=f;d=na;e.vo=d[0];e.tt=d[2];break;case 40:d=I(c,d,na);b=d[0];e=d[1];d=d[2];c.volume&&X.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&X.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:P.tA(c.sc,d/Y.Ha);break;case 60:d=I(c,d,na);b=d[0];e=d[1];d=d[2];k=c.Dr;l=c.Br;f=c.Cr;c=c.Ar;for(g=0;g<l.length;g++)n=k[g],h=l[g],a.d.ie[h]=(1-d)*n[b]+d*n[e];for(g=0;g<c.length;g++)k=f[g],h=c[g],k=ea.lerp(k.subarray(3*b,3*b+3),k.subarray(3*e,3*e+3),
d,H),a.d.rc[h]=k[0],a.d.rc[h+1]=k[1],a.d.rc[h+2]=k[2];break;default:u.pa("Unknown animation type:"+h)}}}function I(a,b,c){c||(c=Array(3));var d=a.ml[0],e=a.ml[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Xo;e=Math.floor(b);a=a.Wo[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function r(a,b){var c=a.d,d=c.De,e=c.Wk,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.C[f];if(g.play||0==b)var h=I(g,g.nc,na),k=h[0],l=h[1],h=h[2],n=g.ya[k],p=g.ya[l],k=g.g[k],l=g.g[l];else d=1}else d=1;e=a.C[e];if(e.play||0==b)var h=I(e,e.nc,
na),q=h[0],t=h[1],h=h[2];else if(-1!=f&&g.play)d=0;else return;f=e.ya[q];g=e.ya[t];q=e.g[q];e=e.g[t];if(1==d)c.vc.set(f),c.uc.set(g),c.Dc.set(q),c.Cc.set(e);else if(0==d)c.vc.set(n),c.uc.set(p),c.Dc.set(k),c.Cc.set(l);else{for(t=0;t<n.length;t+=4){for(var y=ba,m=xa,r=0;4>r;r++)y[r]=n[t+r],m[r]=f[t+r];ha.slerp(y,m,d,y);for(r=0;4>r;r++)c.vc[t+r]=y[r];for(r=0;4>r;r++)y[r]=p[t+r],m[r]=g[t+r];ha.slerp(y,m,d,y);for(r=0;4>r;r++)c.uc[t+r]=y[r]}u.np(k,q,d,c.Dc);u.np(l,e,d,c.Cc)}ia.w(a);d=c.Rk;n=c.yr;for(t=
0;t<d.length;t++){p=d[t];k=n[t];for(l=0;l<k.length;l+=2)for(q=k[l],f=k[l+1],g=0;4>g;g++)p.vc[q+g]=c.vc[f+g],p.uc[q+g]=c.uc[f+g],p.Dc[q+g]=c.Dc[f+g],p.Cc[q+g]=c.Cc[f+g];p.Rf=h}}}function q(a,b){var c=a.d,d=c.De,e=c.ql;if(0!=e){var d=c.pl-d,f=e*b;u.sign(d)==u.sign(e)&&Math.abs(f)<Math.abs(d)?c.De+=f:(c.De=c.pl,c.ql=0)}}function C(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.Hr,h=0;h<g;h++){for(var k=0;k<d.length;k++){var l=d[k],n=R.create(),p=b.d.Aj[l.name];p&&R.copy(p.subarray(8*h,8*h+8),n);l.To=
n;l.qj=!1}k=J(a,c);e.push(k.g);f.push(k.ya)}return{g:e,ya:f}}function J(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var k=b[h],l=k.ii,n=e[k.Fn],k=f,p=g,q=n.Pu,t=q[q.length-1],y=t.ll;t.qj||R.identity(y);for(t=q.length-1;0<=t;t--){var n=q[t],m=n.ll;if(n.qj)y=m;else{var r=n.Uo,H=n.To;R.invert(r,ra);R.multiply(H,ra,ra);R.multiply(r,ra,ra);R.multiply(y,ra,m);y=m;n.qj=!0}}n=n.ll;k[0]=n[0];k[1]=n[1];k[2]=n[2];k[3]=n[3];p[0]=n[4];p[1]=n[5];p[2]=n[6];p[3]=n[7];
ha.normalize(p,p);for(k=0;4>k;k++)p=4*l+k,c[p]=f[k],d[p]=g[k]}c=new Float32Array(c);d=new Float32Array(d);return{g:c,ya:d}}function A(a){var b=[0,0,0],c;for(c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1);return b}function N(a,b,c,d,e,f,g){var h=a+(b-a)/2,k=L(h,d,e,f,g)-c;return.02>Math.abs(k)?h:0<k?N(a,h,c,d,e,f,g):N(h,b,c,d,e,f,g)}function L(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function M(a,b){if(!a.C.length)for(var c=0;8>c;c++)a.C.push(null);
a.C[b]={type:null,Jg:null,ml:null,Xo:0,Wo:null,Fj:null,ya:null,g:null,Rn:[],play:!1,behavior:20,nc:0,start:0,length:0,no:0,Jn:0,oi:!1,ut:null,speed:1,volume:null,pitch:null,Dr:[],Br:[],Cr:[],Ar:[]};a.Md=a.Md||[];-1==ja.indexOf(a)&&ja.push(a)}function G(a,b){ia.w(a);U.sync_transform(a);y(a,0,b,!0)}function D(a,c,e){e=e||0;if(u.is_mesh(a)){var f=u.keysearch("name",c,a.data.b4w_vertex_anim);if(f)return M(a,e),d(a,f,e),G(a,e),!0;if((f=u.keysearch("name",c,a.particle_systems))&&"EMITTER"==f.settings.type)return M(a,
e),b(a,f,e),G(a,e),!0}if(f=u.keysearch("name",c,ca)||u.keysearch("name",c+"_B4W_BAKED",ca)){M(a,e);if(p(a,f,e))return G(a,e),!0;a.C[e]=null}V.error('Unsupported object: "'+a.name+'" or animation name: "'+c+'"');return!1}function O(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&Q(d))return!0}return!1}function Q(a){if(a.animation_data)return!0;a=a.nodes;for(var b=0;b<a.length;b++){var c=a[b];if(c.node_group&&
(c=c.node_group.node_tree)&&Q(c))return!0}return!1}var Z=m("__config"),P=m("__particles"),U=m("__physics"),V=m("__print");m("__scenes");var X=m("__sfx"),ia=m("__transform"),R=m("__tsr"),u=m("__util"),pa=m("__reformer");m("mat4");var ha=m("quat");m("vec4");var ea=m("vec3"),Y=Z.Od;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=
5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var na=Array(3),H=new Float32Array(3),W=new Float32Array(3),ba=new Float32Array(4),xa=new Float32Array(4),ra=new Float32Array(8);new Float32Array(16);var ja=[],ca=[];a.Dq=function(){return u.trunc((Z.o.xr-50)/4)};a.frame_to_sec=function(a){return a/Y.Ha};a.update=function(a){for(var b=0;b<ja.length;b++){for(var d=ja[b],e=0;8>e;e++)x(d,a,e);d.d.Ee&&(q(d,a),r(d,a))}for(b=0;b<ja.length;b++)for(d=ja[b],e=0;8>
e&&d.C.length;e++)c(d,e)};a.vq=function(){return ca};a.get_anim_names=function(a){var b=[];if(n(a))for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var d,c=[];for(d=0;d<ca.length;d++){var f=ca[d],g=f.d;u.nd(f.d.Aj)?"ARMATURE"==a.type&&c.push(f):g.M.volume||g.M.pitch?X.ge(a)&&c.push(f):!t(f)&&u.nd(f.fcurves)&&c.push(f)}"MESH"==a.type&&(c=c.concat(k(a)));d=c;for(c=0;c<d.length;c++)b.push(e(d[c].name));if(P.eh(a)&&P.Om(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);
return b};a.XA=e;a.get_anim_type=function(a,b){var c=a.C[b];return c?c.type:null};a.apply_def=function(a){var c=0,e,f=[];if((e=a.animation_data)&&e.action&&(e=e.action,u.nd(e.fcurves))){var g=u.nd(e.d.Aj);"ARMATURE"!=a.type&&g||f.push(e)}X.ge(a)&&a.data.animation_data&&a.data.animation_data.action&&f.push(a.data.animation_data.action);"MESH"==a.type&&(f=f.concat(k(a)));e=f;for(f=0;f<e.length;f++)g=e[f],M(a,c),p(a,g,c)?(G(a,c),a.C[c].behavior=h(a.b4w_anim_behavior),c++):a.C[c]=null;e=a.particle_systems;
for(f=0;f<e.length;f++){var g=e[f],l=g.settings;"EMITTER"==l.type&&(M(a,c),b(a,g,c),G(a,c),a.C[c].behavior=h(a.b4w_anim_behavior),l.b4w_cyclic&&(a.C[c].behavior=10),c++)}n(a)&&(M(a,c),d(a,a.data.b4w_vertex_anim[0],c),G(a,c),a.C[c].behavior=h(a.b4w_anim_behavior))};a.get_first_armature_object=g;a.play=function(a,b,c){l(a.C,c,function(a){a.play=!0;a.tm=b?b:null;a.oi=!1});a.d.Ee&&z(a)};a.stop=function(a,b){l(a.C,b,function(a){a.play=!1;a.tm=null;a.oi=!1})};a.is_play=function(a,b){var c=a.C[b];return c?
c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.C;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.nc=b,y(a,0,c,!0))}else if(e=d[c])e.nc=b,y(a,0,c,!0)};a.get_current_frame_float=function(a,b){var c=a.C[b];return c&&c.nc?c.nc:0};a.is_cyclic=function(a,b){var c=a.C[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){l(a.C,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.C[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){l(a.C,d,function(a){a.no=b||0;a.Jn=
c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.C[c]=null;else a.C[b]=null;a.d.Ee&&E(a,b)};a.update_object_animation=y;a.ek=function(a){if("ARMATURE"==a.type||g(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||P.eh(a)&&P.Om(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||O(a)?!0:!1};a.is_animated=function(a){return Boolean(a.C.length)};a.Kv=B;a.vp=J;a.Yu=function(a){function b(a,c){for(var d=
0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);ha.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,e,h){if(-1<c.search(f)){a=b;c=c.split('"')[1];var k=g}else 8==h?(c="tsr",k=g):k=1<h?new Float32Array(h):0;if(!a[c]){h=a;b=c;if("object"==typeof k&&k.length)for(var l=k.length,n=new Float32Array(e*l),p=0;p<e;p++)for(var q=0;q<l;q++)n[p*l+q]=k[q];else if("number"==
typeof k)for(n=new Float32Array(e),p=0;p<e;p++)n[p]=k;else u.pa("Wrong storage default value");h[b]=n}return a[c]}a.d={};var e=a.d;e.yz=1/Y.Sf;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=R.create(),h=a.fcurves,k={},l={},n=0,p;for(p in h){var q=h[p],t;for(t in q){var y=q[t],m=y.ic;pa.Pv(y,a);y=y.num_channels;n||(n=m.length);for(var y=d(k,l,p,n,y),r=y.length/n,H=c(p,t|0),w=0;w<n;w++)y[w*r+H]=m[w]}}for(var D in k)"tsr"==D&&b(k[D],n);for(var z in l)b(l[z],n);e.M=k;e.Aj=l;e.Cv=a.Ou;e.Hr=n;e.Fj="tsr"in
k?A(h):null;ca.push(a)};a.Yx=function(a,b){return(b-a)*Y.Sf+1};a.rv=function(a,b,c,d,e,f){var g,h,k=new Float32Array(2),l=new Float32Array(2),n=new Float32Array(2),p=new Float32Array(2),q=b[1],t=b[2],y=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var m=0,r=0,H=null;e<=f;e++)if(e<q)for(var w=0;w<Y.Sf;w++)c[m++]=t;else if(e>y)for(w=0;w<Y.Sf;w++)c[m++]=a;else{var D=b[r],z=3;0===D&&(z+=2);0===H&&(z+=2);var v=2===D?0:1;if(b[r+1]==b[r+z+1])H=D,r+=z;else{w=0;e==b[r+1]&&(v&&(d[m]=1),c[m]=b[r+2],
m++,w++);if(e==y)for(;w<Y.Sf;w++)c[m++]=a;else for(k[0]=b[r+1],k[1]=b[r+2],0!==D?(l[0]=0,l[1]=0):0===H?(l[0]=b[r+5],l[1]=b[r+6]):(l[0]=b[r+3],l[1]=b[r+4]),0!==D?(n[0]=0,n[1]=0):(n[0]=b[r+z+3],n[1]=b[r+z+4]),p[0]=b[r+z+1],p[1]=b[r+z+2];w<Y.Sf;w++){var x=e+w/Y.Sf;switch(D){case 0:g=k;h=l;var B=n,W=p,ba=[],O=[],C=void 0,E=void 0,A=void 0,C=void 0;ba[0]=g[0]-h[0];ba[1]=g[1]-h[1];O[0]=W[0]-B[0];O[1]=W[1]-B[1];A=W[0]-g[0];C=Math.abs(ba[0]);E=Math.abs(O[0]);0!=C+E&&C+E>A&&(C=A/(C+E),h[0]=g[0]-C*ba[0],h[1]=
g[1]-C*ba[1],B[0]=W[0]-C*O[0],B[1]=W[1]-C*O[1]);v&&(d[m]=1);c[m]=L(N(0,1,x,k[0],l[0],n[0],p[0]),k[1],l[1],n[1],p[1]);m++;break;case 1:h=k[0];B=k[1];g=W=(p[1]-B)/(p[0]-h);h=B-W*h;v&&(d[m]=1);c[m]=g*x+h;m++;break;case 2:v&&(d[m]=1);c[m]=b[r+2];m++;break;default:u.pa("Unknown keyframe intepolation mode: "+D)}}e+1==b[r+z+1]&&(H=D,r+=z)}}};a.tD=function(a){for(var b=0;b<a.length;b++)if(a[b].EC)return a[b];return!1};a.apply=D;a.mv=function(a,b,c){c=c||0;var d=u.keysearch("uuid",b,ca);if(d){M(a,c);if(p(a,
d,c)){G(a,c);return}a.C[c]=null}V.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.ZB=function(a,b){var c=u.keysearch("name",b,ca)||u.keysearch("name",b+"_B4W_BAKED",ca);return c?u.nd(c.fcurves)?!0:!1:u.keysearch("name",b,a.particle_systems)?!0:!1};a.get_slot_num_by_anim=function(a,b){for(var c=a.C,d=0;d<c.length;d++){var f=c[d];if(f&&e(f.Jg)==e(b))return d}return-1};a.Wx=function(a,b){var c=a.C[b];return c&&c.Jg?e(c.Jg):null};a.remove=function(a){a.C.length=0;a=ja.indexOf(a);
-1!=a&&ja.splice(a,1)};a.Mz=function(a){for(var b=ca.length-1;0<=b;b--)ca[b].Qu==a&&ca.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.C.length)return D(a,b,0)?0:-1;for(var c=0;c<a.C.length;c++)if(!a.C[c])return D(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.ql=(b-a.d.De)/c;a.d.pl=b};a.set_speed=function(a,b,c){l(a.C,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.C[b].speed};a.get_anim_start_frame=function(a,b){return a.C[b].start};a.get_anim_length=function(a,
b){return a.C[b].length};a.Tq=O;a.cleanup=function(){ja.length=0;ca.length=0};a.xx=function(a){var b=(a[0]||a[1]||a[2]).ic.length,c=ba,d=H,e=Boolean(a[0]);e||(a[0]={ic:new Float32Array(b),num_channels:8});var f=Boolean(a[1]);f||(a[1]={ic:new Float32Array(b),num_channels:8});var g=Boolean(a[2]);g||(a[2]={ic:new Float32Array(b),num_channels:8});a[3]={ic:new Float32Array(b),num_channels:8};for(var h=0;h<b;h++)d[0]=e?a[0].ic[h]:0,d[1]=f?a[1].ic[h]:0,d[2]=g?a[2].ic[h]:0,u.euler_to_quat(d,c),a[0].ic[h]=
c[3],a[1].ic[h]=c[0],a[2].ic[h]=c[1],a[3].ic[h]=c[2]}};b4w.module.__time=function(a,m){m("__util");var c=0,d=0,b=[],e=0,h=[];a.As=function(a){c=a;d=performance.now();for(a=0;a<b.length;a++){var e=b[a];c>e.nm&&(b.splice(a,1),a--,e.callback())}for(a=0;a<h.length;a++){var e=h[a],n=1-(e.nm-c)/e.duration,n=Math.min(n,1);e.callback(e.L+n*(e.ea-e.L));1==n&&(h.splice(a,1),a--)}};a.get_timeline=function(){return c};a.set_timeout=function(a,f){var h;e++;h=e;b.push({id:h,callback:a,nm:c+(performance.now()-d+f)/1E3});return h};a.clear_timeout=function(a){for(var c=
0;c<b.length;c++)if(b[c].id==a){b.splice(c,1);break}};a.animate=function(a,b,d,e){d/=1E3;h.push({callback:e,L:a,ea:b,nm:c+d,duration:d});e(a)};a.reset=function(){d=c=0;e=b.length=0}};b4w.module.__transform=function(a,m){function c(a,b){var c=a.d;c.g[0]=b[0];c.g[1]=b[1];c.g[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function d(a){var c=a.d,p=n.ah();"CAMERA"==a.type&&e.ro(a);h.zB(a,r);"CAMERA"==a.type&&e.wB(a);var t=c.g,m=c.scale,v=c.quat;l.set_sep(t,m,v,c.yb);var x=c.U;B.identity(x);B.fromQuat(v,x);"CAMERA"!=a.type&&y.$z(x,m,x);x[12]=t[0];x[13]=t[1];x[14]=t[2];B.invert(x,c.br);a.C.length&&f.Om(a)&&f.AB(a);c.Nb&&c.$a&&(b.El(c.Nb,x,c.$a),b.Gl(c.Rc,
x,c.sb),b.Fl(c.Gf,c.yb,c.Hf),c.yc&&n.On(p),null!=c.mc&&p&&n.kt(p,a));if(p&&p.d.xb)for(x=p.d.xb.Kk,m=0;m<x.length;m++)if(x[m]==a){n.nt(m,p);break}switch(a.type){case "SPEAKER":g.NA(a,r);break;case "CAMERA":e.xB(a);p&&n.Vj(p)==a&&g.Yy(p,t,v,r);break;case "LAMP":k.BB(a);p&&n.yg(a,p);break;case "EMPTY":a.field&&n.lt(a);break;case "MESH":t=a.modifiers;v=null;for(m=0;m<t.length;m++)x=t[m],"ARMATURE"==x.type&&(v=x.object);v&&(l.invert(v.d.yb,I),l.multiply(I,c.yb,I),w.set(I[0],I[1],I[2],I[3],c.tl),z.set(I[4],
I[5],I[6],I[7],c.sl))}"LAMP"!=a.type&&"CAMERA"!=a.type||!p||(n.On(p),n.cA(p));a=a.Fc;for(m=0;m<a.length;m++)d(a[m]);c.zm=!0}var b=m("__boundings"),e=m("__camera"),h=m("__constraints"),k=m("__lights"),f=m("__particles"),n=m("__scenes"),g=m("__sfx"),l=m("__tsr"),y=m("__util"),p=m("vec3"),w=m("vec4"),z=m("quat"),E=m("mat3"),B=m("mat4"),v=new Float32Array(3),t=new Float32Array(4),x=new Float32Array(9),I=new Float32Array(8),r=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){r=a};a.set_translation=
function(a,b){h.ee(a)==h.Hd?l.set_trans(b,h.de(a)):a.d.g.set(b)};a.get_translation=function(a,b){h.ee(a)==h.Hd?p.copy(l.get_trans_view(h.de(a)),b):p.copy(a.d.g,b)};a.set_rotation=function(a,b){h.ee(a)==h.Hd?l.set_quat(b,h.de(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){h.ee(a)==h.Hd?z.copy(l.get_quat_view(h.de(a)),b):z.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(h.ee(a)==h.Hd){var c=y.euler_to_quat(b,t);l.set_quat(c,h.de(a))}else y.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,
b){h.ee(a)==h.Hd?l.set_scale(b,h.de(a)):a.d.scale=b};a.get_scale=function(a){return h.ee(a)==h.Hd?l.get_scale(h.de(a)):a.d.scale};a.get_tsr=function(a,b){if(h.ee(a)==h.Hd)l.copy(h.de(a),b);else{var c=a.d;l.set_sep(c.g,c.scale,c.quat,b)}};a.set_tsr=function(a,b){h.ee(a)==h.Hd?l.copy(b,h.de(a)):c(a,b)};a.uA=c;a.get_object_size=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=
function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,p.copy(b.sb.F,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,p.transformMat4(c,b.U,c));return c};a.move_local=function(a,b,c,d){a=a.d;v[0]=b;v[1]=c;v[2]=d;b=E.fromMat4(a.U,x);p.transformMat3(v,b,v);p.add(a.g,v,a.g)};a.w=d;a.distance=function(a,b){return p.dist(a.d.g,b.d.g)};a.tz=function(a,b){return p.dist(a.d.g,b)};a.get_object_bounding_box=function(a){return{max_x:a.d.$a.max_x,min_x:a.d.$a.min_x,
max_y:a.d.$a.max_y,min_y:a.d.$a.min_y,max_z:a.d.$a.max_z,min_z:a.d.$a.min_z}}};b4w.module.__tsr=function(a,m){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function d(a,b,c){var d=b[0],e=b[1],f=b[2],h=b[3],k=b[4],m=b[5],v=b[6];b=b[7];var t=a[0]*h,x=a[1]*h,I=a[2]*h;a=b*t+m*I-v*x;var h=b*x+v*t-k*I,r=b*I+k*x-m*t,t=-k*t-m*x-v*I;c[0]=a*b+t*-k+h*-v-r*-m;c[1]=h*b+t*-m+r*-k-a*-v;c[2]=r*b+t*-v+a*-m-h*-k;c[0]+=d;c[1]+=e;c[2]+=f;return c}var b=m("__util"),e=m("vec3"),h=m("quat");m("mat4");var k=new Float32Array(3),f=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,d,e){e||(e=new Float32Array(8));c(a,b,d,e);return e};a.set_sep=c;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.set_quat=function(a,b){b[4]=a[0];b[5]=
a[1];b[6]=a[2];b[7]=a[3]};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],e=a[1],k=a[2];f[0]=a[4];f[1]=a[5];f[2]=a[6];f[3]=a[7];h.invert(f,f);var m=f[0],E=f[1],B=f[2],v=f[3],d=d*c,e=e*c,t=k*c,k=v*d+E*t-B*e,x=v*e+B*d-m*t,I=v*t+m*e-E*d,d=-m*d-E*e-B*t;b[0]=-(k*v+d*-m+x*-B-I*-E);b[1]=-(x*v+d*-E+I*-m-k*-B);b[2]=-(I*v+d*-B+k*-E-x*-m);b[3]=c;b[4]=m;
b[5]=E;b[6]=B;b[7]=v;return b};a.from_mat4=function(a,d){var e=b.lh(a,k),h=b.on(a),p=b.matrix_to_quat(a,f);c(e,h,p,d);return d};a.multiply=function(a,b,c){d(b,a,c);c[3]=a[3]*b[3];var e=a[4],f=a[5],h=a[6];a=a[7];var k=b[4],m=b[5],B=b[6];b=b[7];c[4]=e*b+a*k+f*B-h*m;c[5]=f*b+a*m+h*k-e*B;c[6]=h*b+a*B+e*m-f*k;c[7]=a*b-e*k-f*m-h*B;return c};a.transform_vec3=d;a.transform_vec3_inv=function(a,b,c){var d=b[3],e=a[0]-b[0],f=a[1]-b[1],h=a[2]-b[2];a=b[4];var k=b[5],m=b[6];b=b[7];var v=a*a+k*k+m*m+b*b,v=v?1/v:
0;a=-a*v;k=-k*v;m=-m*v;b*=v;var v=b*e+k*h-m*f,t=b*f+m*e-a*h,x=b*h+a*f-k*e,e=-a*e-k*f-m*h;c[0]=v*b+e*-a+t*-m-x*-k;c[1]=t*b+e*-k+x*-a-v*-m;c[2]=x*b+e*-m+v*-k-t*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var e=a.length,f=b[0],h=b[1],k=b[2],m=b[3],v=b[4],t=b[5],x=b[6];b=b[7];for(var I=0;I<e;I+=3){var r=a[I]*m,q=a[I+1]*m,C=a[I+2]*m,J=b*r+t*C-x*q,A=b*q+x*r-v*C,N=b*C+v*q-t*r,r=-v*r-t*q-x*C;c[d+I]=J*b+r*-v+A*-x-N*-t;c[d+I+1]=A*b+r*-t+N*-v-J*-x;c[d+I+2]=N*b+r*-x+J*
-t-A*-v;c[d+I]+=f;c[d+I+1]+=h;c[d+I+2]+=k}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var e=a.length,f=b[3],h=b[4],k=b[5],m=b[6];b=b[7];for(var v=0;v<e;v+=3){var t=a[v]*f,x=a[v+1]*f,I=a[v+2]*f,r=b*t+k*I-m*x,q=b*x+m*t-h*I,C=b*I+h*x-k*t,t=-h*t-k*x-m*I;c[d+v]=r*b+t*-h+q*-m-C*-k;c[d+v+1]=q*b+t*-k+C*-h-r*-m;c[d+v+2]=C*b+t*-m+r*-k-q*-h}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],e=b[4],f=b[5],h=b[6];b=b[7];var k=a[0]*d,m=a[1]*d,v=a[2]*d;a=b*k+f*v-h*m;var d=b*m+h*k-e*v,t=b*
v+e*m-f*k,k=-e*k-f*m-h*v;c[0]=a*b+k*-e+d*-h-t*-f;c[1]=d*b+k*-f+t*-e-a*-h;c[2]=t*b+k*-h+a*-f-d*-e;return c};a.transform_tangents=function(a,b,c,d){d||(d=0);var e=a.length,f=b[3],h=b[4],k=b[5],m=b[6];b=b[7];for(var v=0;v<e;v+=4){var t=a[v]*f,x=a[v+1]*f,I=a[v+2]*f,r=b*t+k*I-m*x,q=b*x+m*t-h*I,C=b*I+h*x-k*t,t=-h*t-k*x-m*I;c[d+v]=r*b+t*-h+q*-m-C*-k;c[d+v+1]=q*b+t*-k+C*-h-r*-m;c[d+v+2]=C*b+t*-m+r*-k-q*-h;c[d+v+3]=a[v+3]}return c};a.translate=function(a,b,c){var d=a[3],e=a[4],f=a[5],h=a[6],k=a[7],m=b[0]*
d,v=b[1]*d,t=b[2]*d;b=k*m+f*t-h*v;var d=k*v+h*m-e*t,x=k*t+e*v-f*m,m=-e*m-f*v-h*t;c[0]=a[0]+b*k+m*-e+d*-h-x*-f;c[1]=a[1]+d*k+m*-f+x*-e-b*-h;c[2]=a[2]+x*k+m*-h+b*-f-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){d||(d=new Float32Array(8));e.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var f=a[3];d[3]=f+c*(b[3]-f);h.slerp(a.subarray(4),b.subarray(4),c,d.subarray(4));return d};a.qD=function(a,b,c,d){d||(d=new Float32Array(8));var e=a.subarray(0,
3),f=b.subarray(0,3),k=d.subarray(0,3);k[0]=f[0]*(c+1)-e[0]*c;k[1]=f[1]*(c+1)-e[1]*c;k[2]=f[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);e=d.subarray(4);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;h.normalize(e,e);return d};a.Iy=function(a,b,c,d,e){e[0]=a[0]+b*c[0];e[1]=a[1]+b*c[1];e[2]=a[2]+b*c[2];e[3]=a[3];c=d[0];var f=d[1];d=d[2];var h=a[4],k=a[5],m=a[6],v=a[7];e[4]=.5*(c*v+f*m-d*k);e[5]=.5*(f*v+d*h-c*m);e[6]=.5*(d*v+c*k-
f*h);e[7]=.5*(-c*h-f*k-d*m);e[4]=a[4]+e[4]*b;e[5]=a[5]+e[5]*b;e[6]=a[6]+e[6]*b;e[7]=a[7]+e[7]*b;a=e[4];b=e[5];c=e[6];f=e[7];a=a*a+b*b+c*c+f*f;0<a&&(a=1/Math.sqrt(a),e[4]*=a,e[5]*=a,e[6]*=a,e[7]*=a)}};b4w.module.__util=function(a,m){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function d(a,b){var c=a instanceof Array?[]:{},e;for(e in a)c[e]=!a[e]||"object"!=typeof a[e]||-1!=b.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:d(a[e],b);return c}function b(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function e(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function h(a,b){var c=b;switch(typeof a){case "number":return k(a,
c);case "string":return f(a,c);case "boolean":return k(a|0,c);case "function":case "undefined":return k(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=k(a[d],c);else if(d)for(d=0;d<a.length;d++)c=h(a[d],c);else for(var e in a)c=h(a[e],c)}else c=k(0,c)}return c}function k(a,b){var c=b;Q[0]=a;c=(c<<5)-c+Z[0];c&=c;c=(c<<5)-c+Z[1];return c&c}function f(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function n(a){return(34*a+1)*a%289}function g(a){return a-Math.floor(a)}function l(a){return y((34*a+5)*a)}function y(a){return a-289*Math.floor(a/289)}function p(a){return a-7*Math.floor(a/7)}function w(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function z(a){return w(a,0,2*Math.PI)}function E(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||
d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!B(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!B(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function B(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return E(a,b);default:return!0}}var v=m("__print"),t=m("vec3"),x=m("vec4"),I=m("quat"),
r=m("mat3"),q=m("mat4"),C=0,J={},A=new Float32Array(3),N=new Float32Array(3),L=new Float32Array(4),M=new Float32Array(4),G=new Float32Array(9),D=new Float32Array(16),O=new Float32Array(16),Q=new Float64Array(1),Z=new Uint32Array(Q.buffer),P=new Float32Array([0,0,0]),U=new Float32Array([0,0,0,1]),V=new Float32Array([0,0,0,1,0,0,0,1]),X=new Float32Array([1,0,0]),ia=new Float32Array([0,1,0]),R=new Float32Array([0,0,1]),u=new Float32Array([-1,0,0]),pa=new Float32Array([0,-1,0]),ha=new Float32Array([0,
0,-1]),ea=Math.floor(44488.07041494893),Y=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])];a.Nu=P;a.Hu=U;a.BC=V;a.AXIS_X=X;a.AXIS_Y=ia;a.AXIS_Z=R;a.AXIS_MX=u;a.AXIS_MY=pa;a.AXIS_MZ=ha;a.Gt=Y;a.keyfind=c;a.zx=function(a,b){var c=
a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.oB=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Vv=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.sv=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.fE=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==
b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.eE=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.Hm=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.lv=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.aD=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.rE=
function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.pE=function(a,b){var d=c("name",b,a);1<d.length&&v.error("obj_by_name(): name resolution ambiguity");return d};a.qE=function(a,b){var d=c("name",b,a),e=d.length;1<e&&v.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,k=0;k<h.length;k++)f.push(h[k])}return d=d.concat(f)};a.kB=function(a,b,
c,d){d||(d=new Float32Array(16));q.identity(d);d[12]=a;d[13]=b;d[14]=c};var na=1;a.Iz=function(){na=(69069*na+5)%Math.pow(2,32);return Math.round(na/65536)%32768/32767};a.UA=function(a){na=a};a.Nc=function(a){var b=a[0]%ea*48271-3399*Math.floor(a[0]/ea);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.ck=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/
2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.nx=function(a){var b=r.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,l=f*e,n=f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-k;b[4]=g*n+h;b[5]=d*f;b[6]=g*h+n;b[7]=g*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=
Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));t.transformQuat(b,a,c);return c};a.lD=function(a,b,c){c||(c=new Float32Array(4));a=t.normalize(a,A);var d=t.dot(b,a);a=t.cross(b,a,N);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.lB=
function(a,b,c,d){d||(d=new Float32Array(4));t.transformQuat(c,b,d);d[3]=-t.dot(a,d)};a.gx=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":A[0]=0;A[1]=-1;A[2]=0;t.transformQuat(A,b,A);N[0]=0;N[1]=0;N[2]=-1;break;case "MESH":A[0]=0;A[1]=0;A[2]=1;t.transformQuat(A,b,A);N[0]=0;N[1]=0;N[2]=1;break;case "EMPTY":A[0]=0,A[1]=1,A[2]=0,t.transformQuat(A,b,A),N[0]=0,N[1]=1,N[2]=0}A[1]=0;t.normalize(A,A);a=t.dot(A,N);return Math.acos(a)*(0<-A[0]*N[2]?-1:1)};a.np=function(a,b,c,d){if(0!=c){d=d||[];for(var e=
0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.KE=function(){C++;return C.toString(16)};a.Xk=function(a){J[a]||(J[a]=0);var b=a+J[a];J[a]++;return b};a.Sc=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.kb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,I:0,ca:null,B:[],H:b,V:[]}};a.Lf=function(a){return JSON.parse(JSON.stringify(a))};a.cD=function(a,b){var c=[],
e;for(e in b){var f=b[e];if(f)for(var g=0;g<f.length;g++)c.push(f[g])}return d(a,c)};a.Aa=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.Aa(b[d]):b[d];return c};a.Gj=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof
Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.fk=function(a){return"EMPTY"===a.type?!0:!1};a.is_armature=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));r.fromMat4(a,G);var c=G[0],d=G[3],e=G[6],f=G[1],g=G[4],h=G[7],k=G[2],l=G[5],n=G[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*
k+l*l+n*n)||1;G[0]/=c;G[3]/=c;G[6]/=c;G[1]/=f;G[4]/=f;G[7]/=f;G[2]/=k;G[5]/=k;G[8]/=k;I.fromMat3(G,b);return b};a.lh=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.on=function(a){L[0]=.577350269189626;L[1]=.577350269189626;L[2]=.577350269189626;L[3]=0;x.transformMat4(L,a,L);return x.length(L)};a.qm=function(a,c){var d=c.left,e=c.right,f=c.top,g=c.bottom,h=c.Va,k=c.cb;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];
e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];b(d);b(e);b(f);b(g);b(h);b(k)};a.PA=function(a,b,c){return c<-e(a,b.left)||c<-e(a,b.right)||c<-e(a,b.top)||c<-e(a,b.bottom)||c<-e(a,b.Va)||c<-e(a,b.cb)?!0:!1};a.mx=function(a,b,c,d,f){g=t.dot(c,b.cb);h=t.dot(d,b.cb);
k=t.dot(f,b.cb);g=Math.sqrt(g*g+h*h+k*k);if(g<-e(a,b.Va)||g<-e(a,b.cb))return!0;var g=t.dot(c,b.left),h=t.dot(d,b.left),k=t.dot(f,b.left);if(Math.sqrt(g*g+h*h+k*k)<-e(a,b.left))return!0;g=t.dot(c,b.right);h=t.dot(d,b.right);k=t.dot(f,b.right);if(Math.sqrt(g*g+h*h+k*k)<-e(a,b.right))return!0;g=t.dot(c,b.top);h=t.dot(d,b.top);k=t.dot(f,b.top);if(Math.sqrt(g*g+h*h+k*k)<-e(a,b.top))return!0;g=t.dot(c,b.bottom);h=t.dot(d,b.bottom);k=t.dot(f,b.bottom);return Math.sqrt(g*g+h*h+k*k)<-e(a,b.bottom)?!0:!1};
a.af=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.bC=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.hB=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*
k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.$B=function(a,b,c){c||(c=new Float32Array(3));L[0]=a[0];L[1]=a[1];L[2]=a[2];L[3]=0;x.transformMat4(L,b,L);c[0]=L[0];c[1]=L[1];c[2]=L[2]};a.uD=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.aC=function(a){for(var b=[],c=0;c<a.length;c+=
3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.yj=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.yj(b,c,d,f-1):b[f]<c?a.yj(b,c,f+1,e):f};a.He=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.Hj=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.$z=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.oo=function(a,
b,c,d){d||(d=new Float32Array(16));b=q.fromRotationTranslation(b,c,D);q.multiply(b,a,d)};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=q.fromRotationTranslation(c,d,D);1!==b&&(d=q.identity(O),b=t.set(b,b,b,A),q.scale(d,b,d),q.multiply(c,d,c));t.transformMat4(a,c,e);return e};a.po=function(a,b,c,d){d||(d=new Float32Array(4));b=q.fromRotationTranslation(b,c,D);x.transformMat4(a,b,d)};a.XD=function(a,b,c,d,e){e||(e=new Float32Array(3));b=q.fromRotationTranslation(c,d,D);q.invert(b,
b);t.transformMat4(a,b,e);return e};a.IE=function(a,b,c){c||(c=new Float32Array(16));q.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.oE=function(b,c,d){a.lh(b,c);c[3]=a.on(b);a.matrix_to_quat(b,d)};a.dp=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.Wz=function(a,b,c,d){d||(d=new Float32Array(3));t.subtract(b,a,A);t.transformQuat(A,c,A);t.subtract(b,A,d)};a.Lx=function(){A[0]=0;A[1]=0;A[2]=0;var a=new Float32Array(16),b=new Float32Array(16),
c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);q.lookAt(A,[-1,0,0],[0,-1,0],a);q.scale(a,[-1,1,1],a);q.scale(a,[-1,1,-1],b);q.lookAt(A,[0,-1,0],[0,0,-1],c);q.scale(c,[1,1,-1],c);q.scale(c,[1,-1,-1],d);q.lookAt(A,[0,0,-1],[0,-1,0],e);q.scale(e,[-1,1,1],e);q.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Px=function(){A[0]=0;A[1]=0;A[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=
new Float32Array(16);q.lookAt(A,[1,0,0],[0,-1,0],a);q.scale(a,[-1,1,-1],b);q.lookAt(A,[0,1,0],[0,0,1],c);q.scale(c,[1,-1,-1],d);q.lookAt(A,[0,0,1],[0,-1,0],e);q.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Ng=function(a,b){return h(a,b)};a.hash_code=h;a.QD=f;a.nE=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,n,p,t,m,q,r,y;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];
h=a[2];k=a[3];l=a[4];n=a[5];p=a[6];t=a[7];m=a[8];q=a[9];r=a[10];y=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=l;c[5]=n;c[6]=p;c[7]=t;c[8]=m;c[9]=q;c[10]=r;c[11]=y;c[12]=f*d+l*e+m*b+a[12];c[13]=g*d+n*e+q*b+a[13];c[14]=h*d+p*e+r*b+a[14];c[15]=k*d+t*e+y*b+a[15];return c};a.cz=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*
a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.Ik=function(a){return a*Math.PI/180};a.bx=function(a){return 180*a/Math.PI};a.Vn=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,h=1-f,e=b+.211324865405187-f,k=a+
.211324865405187-h,l=b+-.577350269189626,p=a+-.577350269189626,c=c%289,d=d%289,t=n(n(d)+c),h=n(n(d+h)+c+f),m=n(n(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+k*k),0),f=Math.max(.5-(l*l+p*p),0),q=2*g(.024390243902439*t)-1,r=2*g(.024390243902439*h)-1,y=2*g(.024390243902439*m)-1,t=Math.abs(q)-.5,h=Math.abs(r)-.5,m=Math.abs(y)-.5,q=q-Math.floor(q+.5),r=r-Math.floor(r+.5),y=y-Math.floor(y+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(q*q+t*t)),d=d*d*d*d*(1.79284291400159-.85373472095314*
(r*r+h*h)),f=f*f*f*f*(1.79284291400159-.85373472095314*(y*y+m*m));return 130*(c*(q*b+t*a)+d*(r*e+h*k)+f*(y*l+m*p))};a.Bp=function(a){var b=1/7,c=b/2,d=y(Math.floor(a[0])),e=y(Math.floor(a[1])),f=g(a[0]);a=g(a[1]);var h=f-.5,k=f-1.5,f=a-.5;a-=1.5;var n=l(d),t=l(d+1),q=n,d=t,n=l(n+e),t=l(t+e),q=l(q+e+1),d=l(d+e+1),e=h+.7*(p(n)*b+c),m=k+.7*(p(t)*b+c),h=h+.7*(p(q)*b+c),k=k+.7*(p(d)*b+c),n=f+.7*(p(Math.floor(n*b))*b+c),f=f+.7*(p(Math.floor(t*b))*b+c),q=a+.7*(p(Math.floor(q*b))*b+c),b=a+.7*(p(Math.floor(d*
b))*b+c);return Math.min(e*e+n*n,m*m+f*f,h*h+q*q,k*k+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=t.transformQuat(b,a,A);b=c[0];var f=c[1];c=c[2];G[0]=f*f+c*c;G[1]=-f*b;G[2]=-c*b;G[3]=-b*f;G[4]=b*b+c*c;G[5]=-c*f;G[6]=-b*c;G[7]=-f*c;G[8]=b*b+f*f;t.transformMat3(a,G,a);t.normalize(a,a);I.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=L,d=M,c=I.setAxisAngle([0,1,0],Math.PI,I.create()),d=I.setAxisAngle([1,0,0],Math.PI/2,I.create());
I.multiply(c,d,c);I.multiply(a,c,b);return b};a.cleanup=function(){C=0;J={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.Ms=function(a,b,c,d,e){e||(e=new Float32Array(a.length));I.slerp(a,b,Math.exp(-c/d),e)};a.YD=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?
!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=r.fromQuat(a,G);N[0]=0;N[1]=1;N[2]=0;A[0]=c[3];A[1]=c[4];A[2]=c[5];var d=t.cross(N,A,A);t.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);N[0]=c[0];N[1]=c[1];N[2]=c[2];t.normalize(N,N);I.rotationTo(N,d,M);I.multiply(M,a,a)};a.wq=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);
c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.tg=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.us=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Ui=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.Cm=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=
16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.nd=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];t.normalize(c,c)};a.mB=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,n=f*e-g*d,p=g*n-h*l,h=h*k-f*n,f=f*l-g*k;c[0]=
d+2*k*b+2*p;c[1]=e+2*l*b+2*h;c[2]=a+2*n*b+2*f};a.pa=function(a){a&&v.error.apply(v,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=w;a.angle_wrap_0_2pi=z;a.Fm=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Ys=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=E(e,f)}if(!d)return!1}return!0};a.In=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};
a.rq=function(a){a+=1;132651<a&&v.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){L.set(a);L[3]=b;M.set(d);M[3]=0;a=x.dot(L,M);if(0==a)return null;M.set(c);M[3]=1;a=-x.dot(L,M)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.eD=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.Yz=function(a,b,c){var d=t.dot(a,b);-.9999999>d?(t.cross(X,a,A),
1E-6>t.length(A)&&t.cross(ia,a,A),t.normalize(A,A),I.setAxisAngle(A,Math.PI,c)):(t.cross(a,b,A),c.set(A),c[3]=1+d,I.normalize(c,c));return c};a.Ge=function(a,b,c){if(b==c)return c-a;a=z(a);b=z(b);c=z(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=z(c+b);a=z(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a){return a*a*(3-2*a)};a.tv=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1}};b4w.module.__sfx=function(a,m){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;E.warn("deprecated WebAudio implementation");return null}E.warn("WebAudio is not supported");return null}function d(a,c,d){var e=a.i;if("NONE"!=e.behavior){d||(d=0);var g=e.loop,l=e.pitch;if(e.src&&(g||0<=d)){e.wl=Math.floor(5E4*Math.random());var n=A.currentTime+c;e.zc=n;e.state=20;b(a);"POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior?(c=A.createBufferSource(),
c.buffer=e.src,c.playbackRate.value=l,g?(e.pb&&e.pb.disconnect(),c.loop=!0,c.start(n),e.duration=0):(g=c.buffer?c.buffer.duration:0,d>g?(g=n+d+e.be,c.loop=!0,c.start(n),c.stop(g),e.duration=d):(c.loop=!1,c.start(n),e.duration=g)),c.connect(e.bc),e.pb=c,h(e),k(e)):"BACKGROUND_MUSIC"==e.behavior&&(B.clear_timeout(e.Al),B.clear_timeout(e.Bl),d=function(){var b=a.i,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.pb=b.pb||A.createMediaElementSource(c),b.pb.connect(b.bc),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==c?d():e.Al=B.set_timeout(d,1E3*c),e.duration=g?0:w(a));f(e,n)}}}function b(a){var b=a.i;if(!b.bc){var c=a.d.g;a=a.d.quat;if(x.qk){var d=A.createBiquadFilter();d.type="peaking"}else d=null;var e=A.createGain();switch(b.behavior){case "POSITIONAL":var f=A.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);b.dn.set(c);c=I;v.quat_to_dir(a,
v.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);b.direction.set(c);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.jw;f.coneOuterAngle=b.kw;f.coneOuterGain=b.lw;var g=A.createGain();g.gain.value=p(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.bc=f;if(b.Rh){var h=A.createGain();e.connect(h);h.connect(A?N.i.bc:null)}else h=null,e.connect(A?N.i.bc:null);break;case "BACKGROUND_SOUND":f=null;g=A.createGain();g.gain.value=p(b);d?(b.bc=d,d.connect(g)):
b.bc=g;g.connect(e);b.Rh?(h=A.createGain(),e.connect(h),h.connect(A?N.i.bc:null)):(h=null,e.connect(A?N.i.bc:null));break;case "BACKGROUND_MUSIC":h=f=null,g=A.createGain(),g.gain.value=p(b),d?(b.bc=d,d.connect(g)):b.bc=g,g.connect(e),e.connect(A?N.i.bc:null)}b.Hi=f;b.md=d;b.Zg=g;b.Pf=e;b.ms=h}}function e(a){var b=a.i,c=b.duration,b=b.delay+b.cx*Math.random();d(a,b,c)}function h(a){a.Rh&&a.ms.gain.cancelScheduledValues(a.zc);a.Ki&&a.pb.playbackRate.cancelScheduledValues(a.zc);a.dj=a.zc}function k(a){if(a.Rh||
a.Ki){var b=a.ms,c=a.pb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.zc;M[0]=a.wl;for(var f=0;5>f;){var g=a.pitch+a.Ki*v.Nc(M);if(e>=a.dj){if(a.Rh){var h=1-v.clamp(a.Rh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.Ki&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.dj=e-.001}}}function f(a,b){if(a.rm||a.be){var c=a.Pf;c.gain.cancelScheduledValues(b);a.rm?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.rm)):c.gain.setValueAtTime(1,b);a.be&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),
c.gain.linearRampToValueAtTime(0,b+a.duration+a.be))}}function n(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.i;if(20==b.state||40==b.state){var c=b.Pf,d=A.currentTime;b.be&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.be));"BACKGROUND_MUSIC"==b.behavior?b.src&&(B.clear_timeout(b.Al),B.clear_timeout(b.Bl),b.Bl=B.set_timeout(function(){var b=a.i.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.be)):(c=b.pb,b.duration<c.buffer.duration?b.be&&20==
b.state?c.stop(d+b.be):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.zc=0,b.Dn=0,b.Hl=0);b.state=30}}function g(a){a=a.i;if(20==a.state){var b=A.currentTime;a.Dn=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.zc){M[0]=a.wl;for(var d=a.pb.buffer.duration,e=a.zc;e<b;)c=a.pitch+a.Ki*v.Nc(M),e+=d/c;c*=d/c-(e-b)}else c=0;a.Hl=c;a.pb.stop(0);a.pb.disconnect();h(a)}a.state=40}}function l(a){var b=a.i;if(40==b.state){var c=A.currentTime;b.zc+=c-b.Dn;if("BACKGROUND_MUSIC"==
b.behavior)b.src.play();else{a=a.i;var d=A.createBufferSource();d.loop=a.pb.loop;d.buffer=a.pb.buffer;d.playbackRate.value=a.pb.playbackRate.value;a.Hi?d.connect(a.Hi):d.connect(a.Zg);a.pb=d;b.dj=c;b.pb.start(b.zc,b.Hl);k(b)}f(b,b.zc);b.state=20}}function y(a){return!a.i||20!=a.i.state&&40!=a.i.state&&30!=a.i.state?!1:!0}function p(a){return a.muted?0:a.volume}function w(a){a=a.i;return(a=a.src)?a.duration:0}var z=m("__config"),E=m("__print"),B=m("__time"),v=m("__util"),t=m("vec3"),x=z.Yc;a.Io=10;
a.el=20;a.Ho=30;var I=new Float32Array(3),r=new Float32Array(3),q=new Float32Array(3),C=[],J=[],A=null,N=null,L=[],M=[1],G=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(C.push("ogg"),C.push("ogv")),""!=a.canPlayType("audio/mpeg")&&C.push("mp3"),""!=a.canPlayType("audio/mp4")&&(C.push("mp4"),C.push("m4v")),""!=a.canPlayType("audio/webm")&&C.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&
J.push("ogv"),""!=b.canPlayType("video/mp4")&&J.push("m4v"),""!=b.canPlayType("video/webm")&&J.push("webm"));(A=x.Eo?c():null)&&E.log("%cINIT WEBAUDIO: "+A.sampleRate+"Hz","color: #00a")};a.gp=function(a){var b={cg:new Float32Array(3),tr:new Float32Array(3),kh:new Float32Array(3)};a.i=b;if(A){var c=A.createGain(),d=A.createGain();b.Zg=c;b.Pf=d;c.connect(d);d.connect(A.destination);if(a.b4w_enable_dynamic_compressor){var d=A.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=
e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.ei=d;b.bc=d}else b.ei=null,b.bc=c;c=A.listener;b.Sg=z.o.Ml;b.Sg||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.Of=0}};a.hA=function(a){N=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<C.indexOf(a)?a:"ogg"==a&&-1<C.indexOf("mp4")?"mp4":"mp3"==a&&-1<C.indexOf("ogg")?"ogg":"mp4"==a&&-1<C.indexOf("ogg")?"ogg":"ogv"==
a&&-1<C.indexOf("m4v")?"m4v":"webm"==a&&-1<C.indexOf("m4v")?"m4v":"m4v"==a&&-1<C.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<J.indexOf(a)?a:"ogv"==a&&-1<J.indexOf("m4v")?"m4v":"webm"==a&&-1<J.indexOf("m4v")?"m4v":"m4v"==a&&-1<J.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.i={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.i.behavior=A?b.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var c=a.i,d;A?(window.MediaElementAudioSourceNode?d=!0:(E.warn("MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.i.behavior="NONE");a.i.Sg=b.b4w_disable_doppler&&z.o.Ml;a.i.muted=b.muted;a.i.volume=b.volume;a.i.pitch=b.pitch;a.i.attenuation=b.attenuation;a.i.dist_ref=b.distance_reference;a.i.dist_max=b.distance_max||1E4;a.i.jw=b.cone_angle_inner;a.i.kw=b.cone_angle_outer;
a.i.lw=b.cone_volume_outer;a.i.cyclic=b.b4w_cyclic_play;a.i.loop=b.b4w_loop;a.i.delay=b.b4w_delay;a.i.cx=b.b4w_delay_random;a.i.Rh=b.b4w_volume_random;a.i.Ki=b.b4w_pitch_random;a.i.rm=b.b4w_fade_in;a.i.be=b.b4w_fade_out;a.i.zc=0;a.i.Dn=0;a.i.Hl=0;a.i.duration=0;a.i.dj=0;a.i.wl=1;a.i.src=null;a.i.state=10;a.i.dn=new Float32Array(3);a.i.direction=new Float32Array(3);a.i.Wn=new Float32Array(3);a.i.Al=-1;a.i.Bl=-1;a.i.Of=0;L.push(a)};a.Os=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.i.behavior){case "POSITIONAL":return a.el;
case "BACKGROUND_SOUND":return a.el;case "BACKGROUND_MUSIC":return a.Ho;case "NONE":return a.Io;default:throw"Wrong speaker behavior";}};a.IB=function(a,b){var c=a.i;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.zz=function(){var a=A.createBufferSource();a.buffer=A.createBuffer(1,22050,22050);a.connect(A.destination);a.start(0)};a.Zw=function(a,b,c){A?A.decodeAudioData(a,b,c):c()};a.LA=
function(a){n(a);delete a.i;L.splice(L.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<L.length;a++){var b=L[a].i;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.pb&&b.pb.disconnect()}N&&N.i&&(a=N.i,a.cg[0]=0,a.cg[1]=0,a.cg[2]=0,a.kh[0]=0,a.kh[1]=0,a.kh[2]=0);N=null;L.splice(0);G=null};a.update=function(a){if(A&&0!=L.length){for(var b=0;b<L.length;b++){var c=L[b],d=c.i,f=A.currentTime;A&&!d.loop&&d.cyclic&&20==d.state&&d.duration&&d.zc+d.duration<f&&e(c);20==d.state&&3>d.dj-f&&k(d)}G&&G.qe.length&&
(-1==G.Ma||a>G.Yo+G.aq[G.Ma])&&(b=G,-1<b.Ma&&n(b.qe[b.Ma]),-1==b.Ma&&b.random?c=Math.round(Math.random()*(b.qe.length-1)):b.random?(c=1+Math.round(Math.random()*(b.qe.length-2)),c=(b.Ma+c)%b.qe.length):c=(b.Ma+1)%b.qe.length,e(b.qe[c]),b.Ma=c,b.Yo=a)}};a.play=d;a.play_def=e;a.stop=n;a.is_play=function(a){return 20==a.i.state};a.KA=g;a.MA=l;a.playrate=function(a,b){var c=a.i;c.pitch=b;!y(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.pb.playbackRate.value=b,h(c),k(c))};a.get_playrate=
function(a){return a.i.pitch};a.cyclic=function(a,b){a.i.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.i.cyclic};a.Yy=function(a,b,c,d){if(A&&a.i){var e=I;e[0]=0;e[1]=-1;e[2]=0;t.transformQuat(e,c,e);r[0]=0;r[1]=0;r[2]=-1;t.transformQuat(r,c,r);c=A.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],r[0],r[1],r[2]);a.i.tr.set(e);!a.i.Sg&&d&&(q[0]=(b[0]-a.i.cg[0])/d,q[1]=(b[1]-a.i.cg[1])/d,q[2]=(b[2]-a.i.cg[2])/d,v.smooth_v(q,a.i.kh,d,.3,q),c.setVelocity(q[0],q[1],q[2]),a.i.kh.set(q));
a.i.cg.set(b)}};a.listener_reset_speed=function(a,b){if(A&&N.i&&!N.i.Sg){var c=I;b?c.set(b):c.set(N.i.tr);t.scale(c,a,c);A.listener.setVelocity(c[0],c[1],c[2]);N.i.kh.set(c)}};a.NA=function(a,b){var c=a.i;if(y(a)&&"POSITIONAL"==c.behavior){var d=a.d.g,e=c.Hi;e.setPosition(d[0],d[1],d[2]);var f=I;v.quat_to_dir(a.d.quat,v.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.dn;!c.Sg&&b&&(r[0]=(d[0]-f[0])/b,r[1]=(d[1]-f[1])/b,r[2]=(d[2]-f[2])/b,v.smooth_v(r,c.Wn,b,.3,r),e.setVelocity(r[0],r[1],r[2]),c.Wn.set(r));
f.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.i;if(y(a)&&"POSITIONAL"==d.behavior&&!d.Sg){var e=I;c?e.set(c):e.set(d.direction);t.scale(e,b,e);d.Hi.setVelocity(e[0],e[1],e[2]);d.Wn.set(e);d.dn.set(a.d.g)}};a.ge=function(a){return a.i?!0:!1};a.Im=function(a){return a.i.behavior};a.check_active_speakers=function(){for(var a=0;a<L.length;a++)if(y(L[a]))return!0;return!1};a.qA=function(a){var b=N.i;b&&(b.volume=a,A&&(b.Zg.gain.value=p(b)))};a.ky=function(){var a=N.i;return a?a.volume:0};a.set_volume=
function(a,b){var c=a.i;c.volume=b;y(a)&&(c.Zg.gain.value=p(c))};a.get_volume=function(a){return a.i.volume};a.mute=function(a,b){a.i.muted=Boolean(b);y(a)&&(a.i.Zg.gain.value=p(a.i))};a.is_muted=function(a){return a.i.muted};a.mz=function(a){var b=N.i;b&&(b.muted=Boolean(a),A&&(b.Zg.gain.value=p(b)))};a.Qy=function(){var a=N.i;return a?a.muted:!1};a.get_speaker_objects=function(){return L};a.pause=function(){for(var a=0;a<L.length;a++)g(L[a])};a.resume=function(){for(var a=0;a<L.length;a++)l(L[a])};
a.set_compressor_params=function(a,b){if(a.i&&a.i.ei){var c=a.i.ei;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.i||!a.i.ei)return null;a=a.i.ei;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(y(a)){a=a.i;var d=a.Pf,e=A.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,
e+c);a.Of=c}};a.unduck=function(a){if(y(a)){a=a.i;var b=a.Pf,c=A.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Of);a.Of=0}};a.ix=function(a,b){if(A){var c=N.i,d=c.Pf,e=A.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Of=b}};a.pB=function(){if(A){var a=N.i,b=a.Pf,c=A.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Of);a.Of=0}};a.apply_playlist=function(a,b,c){G={Ma:-1,Yo:0,random:c,
qe:[],aq:[]};for(c=0;c<a.length;c++){var d=a[c],e=w(d);0==e?E.warn("Ignoring speaker with zero duration: "+d.name):(n(d),d.i.cyclic=!1,G.qe.push(d),G.aq.push(e+b))}};a.get_duration=w;a.clear_playlist=function(){if(G)for(var a=G.qe,b=0;b<a.length;b++)n(a[b]);G=null};a.get_positional_params=function(a){return(a=a.i)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.i;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=
b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Hi;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.i;c&&c.md&&(c.md.frequency.value=b.freq,c.md.Q.value=b.Q,c.md.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.i)&&a.md?{freq:a.md.frequency.value,Q:a.md.Q.value,gain:a.md.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.i;if(!a||!a.md)return null;a.md.getFrequencyResponse(b,
c,d)}};b4w.module.vec3=function(a){var m="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new m(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new m(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,c){var h=new m(3);h[0]=a;h[1]=b;h[2]=c;return h};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,c,h){h[0]=a;h[1]=b;h[2]=c;return h};a.add=function(a,b,c){c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c};
a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);return c};
a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};a.scaleAndAdd=function(a,b,c,h){h[0]=a[0]+b[0]*c;h[1]=a[1]+b[1]*c;h[2]=a[2]+b[2]*c;return h};a.distance=function(a,b){var c=b[0]-a[0],h=b[1]-a[1],k=b[2]-a[2];return Math.sqrt(c*c+h*h+k*k)};a.dist=a.distance;a.squaredDistance=function(a,b){var c=b[0]-a[0],h=b[1]-a[1],k=b[2]-a[2];return c*c+h*h+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};a.len=a.length;a.squaredLength=
function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var c=a[0],h=a[1],k=a[2],c=c*c+h*h+k*k;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,c){var h=a[0],k=a[1];a=a[2];var f=b[0],n=b[1];b=b[2];c[0]=k*b-a*n;c[1]=
a*f-h*b;c[2]=h*n-k*f;return c};a.lerp=function(a,b,c,h){var k=a[0],f=a[1];a=a[2];h[0]=k+c*(b[0]-k);h[1]=f+c*(b[1]-f);h[2]=a+c*(b[2]-a);return h};a.random=function(a,b){a=a||1;var e=2*c()*Math.PI,h=2*c()-1,k=Math.sqrt(1-h*h)*a;b[0]=Math.cos(e)*k;b[1]=Math.sin(e)*k;b[2]=h*a;return b};a.transformMat4=function(a,b,c){var h=a[0],k=a[1];a=a[2];var f=b[3]*h+b[7]*k+b[11]*a+b[15],f=f||1;c[0]=(b[0]*h+b[4]*k+b[8]*a+b[12])/f;c[1]=(b[1]*h+b[5]*k+b[9]*a+b[13])/f;c[2]=(b[2]*h+b[6]*k+b[10]*a+b[14])/f;return c};a.transformMat3=
function(a,b,c){var h=a[0],k=a[1];a=a[2];c[0]=h*b[0]+k*b[3]+a*b[6];c[1]=h*b[1]+k*b[4]+a*b[7];c[2]=h*b[2]+k*b[5]+a*b[8];return c};a.transformQuat=function(a,b,c){var h=a[0],k=a[1],f=a[2];a=b[0];var n=b[1],g=b[2];b=b[3];var l=b*h+n*f-g*k,m=b*k+g*h-a*f,p=b*f+a*k-n*h,h=-a*h-n*k-g*f;c[0]=l*b+h*-a+m*-g-p*-n;c[1]=m*b+h*-n+p*-a-l*-g;c[2]=p*b+h*-g+l*-n-m*-a;return c};a.rotateX=function(a,b,c,h){var k=[],f=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];f[0]=k[0];f[1]=k[1]*Math.cos(c)-k[2]*Math.sin(c);f[2]=
k[1]*Math.sin(c)+k[2]*Math.cos(c);h[0]=f[0]+b[0];h[1]=f[1]+b[1];h[2]=f[2]+b[2];return h};a.rotateY=function(a,b,c,h){var k=[],f=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];f[0]=k[2]*Math.sin(c)+k[0]*Math.cos(c);f[1]=k[1];f[2]=k[2]*Math.cos(c)-k[0]*Math.sin(c);h[0]=f[0]+b[0];h[1]=f[1]+b[1];h[2]=f[2]+b[2];return h};a.rotateZ=function(a,b,c,h){var k=[],f=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];f[0]=k[0]*Math.cos(c)-k[1]*Math.sin(c);f[1]=k[0]*Math.sin(c)+k[1]*Math.cos(c);f[2]=k[2];h[0]=f[0]+
b[0];h[1]=f[1]+b[1];h[2]=f[2]+b[2];return h};a.forEach=function(){var c=a.create();return function(a,e,h,k,f,n){e||(e=3);h||(h=0);for(k=k?Math.min(k*e+h,a.length):a.length;h<k;h+=e)c[0]=a[h],c[1]=a[h+1],c[2]=a[h+2],f(c,n,c),a[h]=c[0],a[h+1]=c[1],a[h+2]=c[2];return a}}();a.GC=function(c,b){var e=a.fromValues(c[0],c[1],c[2]),h=a.fromValues(b[0],b[1],b[2]);a.normalize(e,e);a.normalize(h,h);e=a.dot(e,h);return 1<e?0:Math.acos(e)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var m="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new m(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new m(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,c,h){var k=new m(4);k[0]=a;k[1]=b;k[2]=c;k[3]=h;return k};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,c,h,k){k[0]=a;k[1]=b;k[2]=c;k[3]=h;return k};a.add=function(a,b,c){c[0]=
a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);c[3]=
Math.min(a[3],b[3]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);c[3]=Math.max(a[3],b[3]);return c};a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};a.scaleAndAdd=function(a,b,c,h){h[0]=a[0]+b[0]*c;h[1]=a[1]+b[1]*c;h[2]=a[2]+b[2]*c;h[3]=a[3]+b[3]*c;return h};a.distance=function(a,b){var c=b[0]-a[0],h=b[1]-a[1],k=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+h*h+k*k+f*f)};a.dist=a.distance;a.squaredDistance=
function(a,b){var c=b[0]-a[0],h=b[1]-a[1],k=b[2]-a[2],f=b[3]-a[3];return c*c+h*h+k*k+f*f};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1],h=a[2];a=a[3];return Math.sqrt(b*b+c*c+h*h+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],c=a[1],h=a[2];a=a[3];return b*b+c*c+h*h+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var c=a[0],h=a[1],k=a[2],f=a[3],c=c*c+h*h+k*k+f*f;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c,b[3]=a[3]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,c,h){var k=a[0],f=a[1],n=a[2];a=a[3];h[0]=k+c*(b[0]-k);h[1]=f+c*(b[1]-f);h[2]=n+c*(b[2]-n);h[3]=a+c*(b[3]-a);return h};a.random=function(d,b){d=d||1;b[0]=c();b[1]=c();b[2]=c();b[3]=c();a.normalize(b,b);a.scale(b,d,b);return b};a.transformMat4=function(a,b,c){var h=a[0],
k=a[1],f=a[2];a=a[3];c[0]=b[0]*h+b[4]*k+b[8]*f+b[12]*a;c[1]=b[1]*h+b[5]*k+b[9]*f+b[13]*a;c[2]=b[2]*h+b[6]*k+b[10]*f+b[14]*a;c[3]=b[3]*h+b[7]*k+b[11]*f+b[15]*a;return c};a.transformQuat=function(a,b,c){var h=a[0],k=a[1],f=a[2],n=b[0],g=b[1],l=b[2];b=b[3];var m=b*h+g*f-l*k,p=b*k+l*h-n*f,w=b*f+n*k-g*h,h=-n*h-g*k-l*f;c[0]=m*b+h*-n+p*-l-w*-g;c[1]=p*b+h*-g+w*-n-m*-l;c[2]=w*b+h*-l+m*-g-p*-n;c[3]=a[3];return c};a.forEach=function(){var c=a.create();return function(a,e,h,k,f,n){e||(e=4);h||(h=0);for(k=k?Math.min(k*
e+h,a.length):a.length;h<k;h+=e)c[0]=a[h],c[1]=a[h+1],c[2]=a[h+2],c[3]=a[h+3],f(c,n,c),a[h]=c[0],a[h+1]=c[1],a[h+2]=c[2],a[h+3]=c[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,m){var c=m("vec3"),d=m("vec4"),b=m("mat3"),e="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new e(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),e=c.fromValues(0,1,0);return function(n,g,l){var m=c.dot(n,g);if(-.9999999>m)return c.cross(d,n,b),1E-6>c.length(b)&&c.cross(e,n,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,l),l;if(.9999999<m)return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l;c.cross(n,
g,b);l[0]=b[0];l[1]=b[1];l[2]=b[2];l[3]=1+m;return a.normalize(l,l)}}();a.setAxes=function(){var c=b.create();return function(b,d,e,g){c[0]=d[0];c[3]=d[1];c[6]=d[2];c[1]=e[0];c[4]=e[1];c[7]=e[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,g),g)}}();a.clone=d.clone;a.fromValues=d.fromValues;a.copy=d.copy;a.set=d.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=d.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],l=a[2];a=a[3];var m=b[0],p=b[1],w=b[2];b=b[3];c[0]=d*b+a*m+e*w-l*p;c[1]=e*b+a*p+l*m-d*w;c[2]=l*b+a*w+d*p-e*m;c[3]=a*b-d*m-e*p-l*w;return c};a.mul=a.multiply;a.scale=d.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],e=a[1],l=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*m;c[1]=e*b+l*m;c[2]=l*b-e*m;c[3]=a*b-d*m;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],e=a[1],l=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*
b-l*m;c[1]=e*b+a*m;c[2]=l*b+d*m;c[3]=a*b-e*m;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],e=a[1],l=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*m;c[1]=e*b-d*m;c[2]=l*b+a*m;c[3]=a*b-l*m;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=d.dot;a.lerp=d.lerp;a.slerp=function(a,b,c,d){var e=a[0],l=a[1],m=a[2];a=a[3];var p=b[0],w=b[1],z=b[2];b=b[3];var E,B,v;B=e*p+l*w+m*z+a*b;0>B&&(B=-B,p=-p,w=-w,
z=-z,b=-b);1E-6<1-B?(E=Math.acos(B),v=Math.sin(E),B=Math.sin((1-c)*E)/v,c=Math.sin(c*E)/v):B=1-c;d[0]=B*e+c*p;d[1]=B*l+c*w;d[2]=B*m+c*z;d[3]=B*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],l=a[3],m=c*c+d*d+e*e+l*l,m=m?1/m:0;b[0]=-c*m;b[1]=-d*m;b[2]=-e*m;b[3]=l*m;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=d.length;a.len=a.length;a.squaredLength=d.squaredLength;a.sqrLen=a.squaredLength;a.normalize=d.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,l=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*l+l]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+l]-a[3*l+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[l]=(a[3*l+d]+a[3*d+l])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var m="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new m(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[4];d[4]=a[5];d[5]=a[6];d[6]=a[8];d[7]=a[9];d[8]=a[10];return d};a.clone=function(a){var d=new m(9);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.copy=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=
a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,d){if(d===a){var b=a[1],e=a[2],h=a[5];d[1]=a[3];d[2]=a[6];d[3]=b;d[5]=a[7];d[6]=e;d[7]=h}else d[0]=a[0],d[1]=a[3],d[2]=a[6],d[3]=a[1],d[4]=a[4],d[5]=a[7],d[6]=a[2],d[7]=a[5],d[8]=a[8];return d};a.invert=function(a,d){var b=a[0],e=a[1],h=a[2],k=a[3],f=a[4],n=a[5],g=a[6],l=a[7],m=a[8],p=m*f-n*l,w=-m*k+n*g,z=
l*k-f*g,E=b*p+e*w+h*z;if(!E)return null;E=1/E;d[0]=p*E;d[1]=(-m*e+h*l)*E;d[2]=(n*e-h*f)*E;d[3]=w*E;d[4]=(m*b-h*g)*E;d[5]=(-n*b+h*k)*E;d[6]=z*E;d[7]=(-l*b+e*g)*E;d[8]=(f*b-e*k)*E;return d};a.adjoint=function(a,d){var b=a[0],e=a[1],h=a[2],k=a[3],f=a[4],n=a[5],g=a[6],l=a[7],m=a[8];d[0]=f*m-n*l;d[1]=h*l-e*m;d[2]=e*n-h*f;d[3]=n*g-k*m;d[4]=b*m-h*g;d[5]=h*k-b*n;d[6]=k*l-f*g;d[7]=e*g-b*l;d[8]=b*f-e*k;return d};a.determinant=function(a){var d=a[3],b=a[4],e=a[5],h=a[6],k=a[7],f=a[8];return a[0]*(f*b-e*k)+a[1]*
(-f*d+e*h)+a[2]*(k*d-b*h)};a.multiply=function(a,d,b){var e=a[0],h=a[1],k=a[2],f=a[3],n=a[4],g=a[5],l=a[6],m=a[7];a=a[8];var p=d[0],w=d[1],z=d[2],E=d[3],B=d[4],v=d[5],t=d[6],x=d[7];d=d[8];b[0]=p*e+w*f+z*l;b[1]=p*h+w*n+z*m;b[2]=p*k+w*g+z*a;b[3]=E*e+B*f+v*l;b[4]=E*h+B*n+v*m;b[5]=E*k+B*g+v*a;b[6]=t*e+x*f+d*l;b[7]=t*h+x*n+d*m;b[8]=t*k+x*g+d*a;return b};a.mul=a.multiply;a.translate=function(a,d,b){var e=a[0],h=a[1],k=a[2],f=a[3],n=a[4],g=a[5],l=a[6],m=a[7];a=a[8];var p=d[0];d=d[1];b[0]=e;b[1]=h;b[2]=k;
b[3]=f;b[4]=n;b[5]=g;b[6]=p*e+d*f+l;b[7]=p*h+d*n+m;b[8]=p*k+d*g+a;return b};a.rotate=function(a,d,b){var e=a[0],h=a[1],k=a[2],f=a[3],n=a[4],g=a[5],l=a[6],m=a[7];a=a[8];var p=Math.sin(d);d=Math.cos(d);b[0]=d*e+p*f;b[1]=d*h+p*n;b[2]=d*k+p*g;b[3]=d*f-p*e;b[4]=d*n-p*h;b[5]=d*g-p*k;b[6]=l;b[7]=m;b[8]=a;return b};a.scale=function(a,d,b){var e=d[0];d=d[1];b[0]=e*a[0];b[1]=e*a[1];b[2]=e*a[2];b[3]=d*a[3];b[4]=d*a[4];b[5]=d*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.Fx=function(a,d){d[0]=1;d[1]=0;d[2]=
0;d[3]=0;d[4]=1;d[5]=0;d[6]=a[0];d[7]=a[1];d[8]=1;return d};a.Dx=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=b;d[2]=0;d[3]=-b;d[4]=e;d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};a.Ex=function(a,d){d[0]=a[0];d[1]=0;d[2]=0;d[3]=0;d[4]=a[1];d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};a.fromMat2d=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=0;d[3]=a[2];d[4]=a[3];d[5]=0;d[6]=a[4];d[7]=a[5];d[8]=1;return d};a.fromQuat=function(a,d){var b=a[0],e=a[1],h=a[2],k=a[3],f=b+b,n=e+e,g=h+h,b=b*f,l=e*f,e=e*n,m=h*f,p=
h*n,h=h*g,f=k*f,n=k*n,k=k*g;d[0]=1-e-h;d[3]=l-k;d[6]=m+n;d[1]=l+k;d[4]=1-b-h;d[7]=p-f;d[2]=m-n;d[5]=p+f;d[8]=1-b-e;return d};a.normalFromMat4=function(a,d){var b=a[0],e=a[1],h=a[2],k=a[3],f=a[4],n=a[5],g=a[6],l=a[7],m=a[8],p=a[9],w=a[10],z=a[11],E=a[12],B=a[13],v=a[14],t=a[15],x=b*n-e*f,I=b*g-h*f,r=b*l-k*f,q=e*g-h*n,C=e*l-k*n,J=h*l-k*g,A=m*B-p*E,N=m*v-w*E,m=m*t-z*E,L=p*v-w*B,p=p*t-z*B,w=w*t-z*v,z=x*w-I*p+r*L+q*m-C*N+J*A;if(!z)return null;z=1/z;d[0]=(n*w-g*p+l*L)*z;d[1]=(g*m-f*w-l*N)*z;d[2]=(f*p-n*
m+l*A)*z;d[3]=(h*p-e*w-k*L)*z;d[4]=(b*w-h*m+k*N)*z;d[5]=(e*m-b*p-k*A)*z;d[6]=(B*J-v*C+t*q)*z;d[7]=(v*r-E*J-t*I)*z;d[8]=(E*C-B*r+t*x)*z;return d};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.Cx=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var m="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new m(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var d=new m(16);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.copy=function(a,d){d[0]=a[0];d[1]=
a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,d){if(d===a){var b=a[1],e=a[2],h=a[3],k=a[6],f=a[7],n=a[11];d[1]=a[4];d[2]=a[8];d[3]=a[12];d[4]=b;d[6]=a[9];d[7]=a[13];d[8]=e;d[9]=k;d[11]=a[14];d[12]=h;d[13]=f;
d[14]=n}else d[0]=a[0],d[1]=a[4],d[2]=a[8],d[3]=a[12],d[4]=a[1],d[5]=a[5],d[6]=a[9],d[7]=a[13],d[8]=a[2],d[9]=a[6],d[10]=a[10],d[11]=a[14],d[12]=a[3],d[13]=a[7],d[14]=a[11],d[15]=a[15];return d};a.invert=function(a,d){var b=a[0],e=a[1],h=a[2],k=a[3],f=a[4],n=a[5],g=a[6],l=a[7],m=a[8],p=a[9],w=a[10],z=a[11],E=a[12],B=a[13],v=a[14],t=a[15],x=b*n-e*f,I=b*g-h*f,r=b*l-k*f,q=e*g-h*n,C=e*l-k*n,J=h*l-k*g,A=m*B-p*E,N=m*v-w*E,L=m*t-z*E,M=p*v-w*B,G=p*t-z*B,D=w*t-z*v,O=x*D-I*G+r*M+q*L-C*N+J*A;if(!O)return null;
O=1/O;d[0]=(n*D-g*G+l*M)*O;d[1]=(h*G-e*D-k*M)*O;d[2]=(B*J-v*C+t*q)*O;d[3]=(w*C-p*J-z*q)*O;d[4]=(g*L-f*D-l*N)*O;d[5]=(b*D-h*L+k*N)*O;d[6]=(v*r-E*J-t*I)*O;d[7]=(m*J-w*r+z*I)*O;d[8]=(f*G-n*L+l*A)*O;d[9]=(e*L-b*G-k*A)*O;d[10]=(E*C-B*r+t*x)*O;d[11]=(p*r-m*C-z*x)*O;d[12]=(n*N-f*M-g*A)*O;d[13]=(b*M-e*N+h*A)*O;d[14]=(B*I-E*q-v*x)*O;d[15]=(m*q-p*I+w*x)*O;return d};a.adjoint=function(a,d){var b=a[0],e=a[1],h=a[2],k=a[3],f=a[4],n=a[5],g=a[6],l=a[7],m=a[8],p=a[9],w=a[10],z=a[11],E=a[12],B=a[13],v=a[14],t=a[15];
d[0]=n*(w*t-z*v)-p*(g*t-l*v)+B*(g*z-l*w);d[1]=-(e*(w*t-z*v)-p*(h*t-k*v)+B*(h*z-k*w));d[2]=e*(g*t-l*v)-n*(h*t-k*v)+B*(h*l-k*g);d[3]=-(e*(g*z-l*w)-n*(h*z-k*w)+p*(h*l-k*g));d[4]=-(f*(w*t-z*v)-m*(g*t-l*v)+E*(g*z-l*w));d[5]=b*(w*t-z*v)-m*(h*t-k*v)+E*(h*z-k*w);d[6]=-(b*(g*t-l*v)-f*(h*t-k*v)+E*(h*l-k*g));d[7]=b*(g*z-l*w)-f*(h*z-k*w)+m*(h*l-k*g);d[8]=f*(p*t-z*B)-m*(n*t-l*B)+E*(n*z-l*p);d[9]=-(b*(p*t-z*B)-m*(e*t-k*B)+E*(e*z-k*p));d[10]=b*(n*t-l*B)-f*(e*t-k*B)+E*(e*l-k*n);d[11]=-(b*(n*z-l*p)-f*(e*z-k*p)+m*
(e*l-k*n));d[12]=-(f*(p*v-w*B)-m*(n*v-g*B)+E*(n*w-g*p));d[13]=b*(p*v-w*B)-m*(e*v-h*B)+E*(e*w-h*p);d[14]=-(b*(n*v-g*B)-f*(e*v-h*B)+E*(e*g-h*n));d[15]=b*(n*w-g*p)-f*(e*w-h*p)+m*(e*g-h*n);return d};a.determinant=function(a){var d=a[0],b=a[1],e=a[2],h=a[3],k=a[4],f=a[5],n=a[6],g=a[7],l=a[8],m=a[9],p=a[10],w=a[11],z=a[12],E=a[13],B=a[14];a=a[15];return(d*f-b*k)*(p*a-w*B)-(d*n-e*k)*(m*a-w*E)+(d*g-h*k)*(m*B-p*E)+(b*n-e*f)*(l*a-w*z)-(b*g-h*f)*(l*B-p*z)+(e*g-h*n)*(l*E-m*z)};a.multiply=function(a,d,b){var e=
a[0],h=a[1],k=a[2],f=a[3],n=a[4],g=a[5],l=a[6],m=a[7],p=a[8],w=a[9],z=a[10],E=a[11],B=a[12],v=a[13],t=a[14];a=a[15];var x=d[0],I=d[1],r=d[2],q=d[3];b[0]=x*e+I*n+r*p+q*B;b[1]=x*h+I*g+r*w+q*v;b[2]=x*k+I*l+r*z+q*t;b[3]=x*f+I*m+r*E+q*a;x=d[4];I=d[5];r=d[6];q=d[7];b[4]=x*e+I*n+r*p+q*B;b[5]=x*h+I*g+r*w+q*v;b[6]=x*k+I*l+r*z+q*t;b[7]=x*f+I*m+r*E+q*a;x=d[8];I=d[9];r=d[10];q=d[11];b[8]=x*e+I*n+r*p+q*B;b[9]=x*h+I*g+r*w+q*v;b[10]=x*k+I*l+r*z+q*t;b[11]=x*f+I*m+r*E+q*a;x=d[12];I=d[13];r=d[14];q=d[15];b[12]=x*e+
I*n+r*p+q*B;b[13]=x*h+I*g+r*w+q*v;b[14]=x*k+I*l+r*z+q*t;b[15]=x*f+I*m+r*E+q*a;return b};a.mul=a.multiply;a.translate=function(a,d,b){var e=d[0],h=d[1];d=d[2];var k,f,n,g,l,m,p,w,z,E,B,v;a===b?(b[12]=a[0]*e+a[4]*h+a[8]*d+a[12],b[13]=a[1]*e+a[5]*h+a[9]*d+a[13],b[14]=a[2]*e+a[6]*h+a[10]*d+a[14],b[15]=a[3]*e+a[7]*h+a[11]*d+a[15]):(k=a[0],f=a[1],n=a[2],g=a[3],l=a[4],m=a[5],p=a[6],w=a[7],z=a[8],E=a[9],B=a[10],v=a[11],b[0]=k,b[1]=f,b[2]=n,b[3]=g,b[4]=l,b[5]=m,b[6]=p,b[7]=w,b[8]=z,b[9]=E,b[10]=B,b[11]=v,
b[12]=k*e+l*h+z*d+a[12],b[13]=f*e+m*h+E*d+a[13],b[14]=n*e+p*h+B*d+a[14],b[15]=g*e+w*h+v*d+a[15]);return b};a.scale=function(a,d,b){var e=d[0],h=d[1];d=d[2];b[0]=a[0]*e;b[1]=a[1]*e;b[2]=a[2]*e;b[3]=a[3]*e;b[4]=a[4]*h;b[5]=a[5]*h;b[6]=a[6]*h;b[7]=a[7]*h;b[8]=a[8]*d;b[9]=a[9]*d;b[10]=a[10]*d;b[11]=a[11]*d;b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.rotate=function(a,d,b,e){var h=b[0],k=b[1];b=b[2];var f=Math.sqrt(h*h+k*k+b*b),n,g,l,m,p,w,z,E,B,v,t,x,I,r,q,C,J,A,N,L;if(1E-7>Math.abs(f))return null;
f=1/f;h*=f;k*=f;b*=f;n=Math.sin(d);g=Math.cos(d);l=1-g;d=a[0];f=a[1];m=a[2];p=a[3];w=a[4];z=a[5];E=a[6];B=a[7];v=a[8];t=a[9];x=a[10];I=a[11];r=h*h*l+g;q=k*h*l+b*n;C=b*h*l-k*n;J=h*k*l-b*n;A=k*k*l+g;N=b*k*l+h*n;L=h*b*l+k*n;h=k*b*l-h*n;k=b*b*l+g;e[0]=d*r+w*q+v*C;e[1]=f*r+z*q+t*C;e[2]=m*r+E*q+x*C;e[3]=p*r+B*q+I*C;e[4]=d*J+w*A+v*N;e[5]=f*J+z*A+t*N;e[6]=m*J+E*A+x*N;e[7]=p*J+B*A+I*N;e[8]=d*L+w*h+v*k;e[9]=f*L+z*h+t*k;e[10]=m*L+E*h+x*k;e[11]=p*L+B*h+I*k;a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);
return e};a.rotateX=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var h=a[4],k=a[5],f=a[6],n=a[7],g=a[8],l=a[9],m=a[10],p=a[11];a!==b&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[4]=h*d+g*e;b[5]=k*d+l*e;b[6]=f*d+m*e;b[7]=n*d+p*e;b[8]=g*d-h*e;b[9]=l*d-k*e;b[10]=m*d-f*e;b[11]=p*d-n*e;return b};a.rotateY=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var h=a[0],k=a[1],f=a[2],n=a[3],g=a[8],l=a[9],m=a[10],p=a[11];a!==b&&(b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=h*d-g*e;b[1]=k*d-l*e;b[2]=f*d-m*e;b[3]=n*d-p*e;b[8]=h*e+g*d;b[9]=k*e+l*d;b[10]=f*e+m*d;b[11]=n*e+p*d;return b};a.rotateZ=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var h=a[0],k=a[1],f=a[2],n=a[3],g=a[4],l=a[5],m=a[6],p=a[7];a!==b&&(b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=h*d+g*e;b[1]=k*d+l*e;b[2]=f*d+m*e;b[3]=n*d+p*e;b[4]=g*d-h*e;b[5]=l*d-k*e;b[6]=m*d-f*e;b[7]=p*d-n*e;return b};
a.Fx=function(a,d){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=a[0];d[13]=a[1];d[14]=a[2];d[15]=1;return d};a.Ex=function(a,d){d[0]=a[0];d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a[1];d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=a[2];d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.Dx=function(a,d,b){var e=d[0],h=d[1];d=d[2];var k=Math.sqrt(e*e+h*h+d*d),f;if(1E-7>Math.abs(k))return null;k=1/k;e*=k;h*=k;d*=k;k=Math.sin(a);a=Math.cos(a);f=1-a;b[0]=e*e*f+a;b[1]=h*e*f+d*
k;b[2]=d*e*f-h*k;b[3]=0;b[4]=e*h*f-d*k;b[5]=h*h*f+a;b[6]=d*h*f+e*k;b[7]=0;b[8]=e*d*f+h*k;b[9]=h*d*f-e*k;b[10]=d*d*f+a;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.zD=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=e;d[6]=b;d[7]=0;d[8]=0;d[9]=-b;d[10]=e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.AD=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=0;d[2]=-b;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=b;d[9]=0;d[10]=e;d[11]=0;d[12]=0;d[13]=0;
d[14]=0;d[15]=1;return d};a.BD=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=b;d[2]=0;d[3]=0;d[4]=-b;d[5]=e;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.fromRotationTranslation=function(a,d,b){var e=a[0],h=a[1],k=a[2],f=a[3],n=e+e,g=h+h,l=k+k;a=e*n;var m=e*g,e=e*l,p=h*g,h=h*l,k=k*l,n=f*n,g=f*g,f=f*l;b[0]=1-(p+k);b[1]=m+f;b[2]=e-g;b[3]=0;b[4]=m-f;b[5]=1-(a+k);b[6]=h+n;b[7]=0;b[8]=e+g;b[9]=h-n;b[10]=1-(a+p);b[11]=0;b[12]=d[0];b[13]=d[1];b[14]=d[2];
b[15]=1;return b};a.fromQuat=function(a,d){var b=a[0],e=a[1],h=a[2],k=a[3],f=b+b,n=e+e,g=h+h,b=b*f,l=e*f,e=e*n,m=h*f,p=h*n,h=h*g,f=k*f,n=k*n,k=k*g;d[0]=1-e-h;d[1]=l+k;d[2]=m-n;d[3]=0;d[4]=l-k;d[5]=1-b-h;d[6]=p+f;d[7]=0;d[8]=m+n;d[9]=p-f;d[10]=1-b-e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.frustum=function(a,d,b,e,h,k,f){var n=1/(d-a),g=1/(e-b),l=1/(h-k);f[0]=2*h*n;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*h*g;f[6]=0;f[7]=0;f[8]=(d+a)*n;f[9]=(e+b)*g;f[10]=(k+h)*l;f[11]=-1;f[12]=0;f[13]=0;f[14]=
k*h*2*l;f[15]=0;return f};a.perspective=function(a,d,b,e,h){a=1/Math.tan(a/2);var k=1/(b-e);h[0]=a/d;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=(e+b)*k;h[11]=-1;h[12]=0;h[13]=0;h[14]=2*e*b*k;h[15]=0;return h};a.uE=function(a,d,b,e){var h=Math.tan(a.LE*Math.PI/180),k=Math.tan(a.mD*Math.PI/180),f=Math.tan(a.gE*Math.PI/180);a=Math.tan(a.wE*Math.PI/180);var n=2/(f+a),g=2/(h+k);e[0]=n;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=g;e[6]=0;e[7]=0;e[8]=-((f-a)*n*.5);e[9]=(h-k)*g*.5;e[10]=b/
(d-b);e[11]=-1;e[12]=0;e[13]=0;e[14]=b*d/(d-b);e[15]=0;return e};a.ortho=function(a,d,b,e,h,k,f){var n=1/(a-d),g=1/(b-e),l=1/(h-k);f[0]=-2*n;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*g;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*l;f[11]=0;f[12]=(a+d)*n;f[13]=(e+b)*g;f[14]=(k+h)*l;f[15]=1;return f};a.lookAt=function(c,d,b,e){var h,k,f,n,g,l,m,p,w=c[0],z=c[1];c=c[2];f=b[0];n=b[1];k=b[2];m=d[0];b=d[1];h=d[2];if(1E-7>Math.abs(w-m)&&1E-7>Math.abs(z-b)&&1E-7>Math.abs(c-h))return a.identity(e);d=w-m;b=z-b;m=c-h;p=1/Math.sqrt(d*
d+b*b+m*m);d*=p;b*=p;m*=p;h=n*m-k*b;k=k*d-f*m;f=f*b-n*d;(p=Math.sqrt(h*h+k*k+f*f))?(p=1/p,h*=p,k*=p,f*=p):f=k=h=0;n=b*f-m*k;g=m*h-d*f;l=d*k-b*h;(p=Math.sqrt(n*n+g*g+l*l))?(p=1/p,n*=p,g*=p,l*=p):l=g=n=0;e[0]=h;e[1]=n;e[2]=d;e[3]=0;e[4]=k;e[5]=g;e[6]=b;e[7]=0;e[8]=f;e[9]=l;e[10]=m;e[11]=0;e[12]=-(h*w+k*z+f*c);e[13]=-(n*w+g*z+l*c);e[14]=-(d*w+b*z+m*c);e[15]=1;return e};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.Cx=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.cs=function(){function a(c,d,b,e,h,k){this.message=c;this.offset=e;this.Ci=h;this.Pg=k;this.name="SyntaxError"}(function(a,d){function b(){this.constructor=a}b.prototype=d.prototype;a.prototype=new b})(a,Error);return{SyntaxError:a,parse:function(c){function d(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function b(a){if(gc!==a){gc>a&&(gc=0,qb={Ci:1,Pg:1,Wi:!1});var b=qb,d,e;for(d=
gc;d<a;d++)e=c.charAt(d),"\n"===e?(b.Wi||b.Ci++,b.Pg=1,b.Wi=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(b.Ci++,b.Pg=1,b.Wi=!0):(b.Pg++,b.Wi=!1);gc=a}return qb}function e(a){F<Ib||(F>Ib&&(Ib=F,Lb=[]),Lb.push(a))}function h(){var a,b,d;a=F;b=V();b!==u?(b=k(),b!==u?(d=V(),d!==u?(da++,10===c.charCodeAt(F)?(d=Ub,F++):(d=u,0===da&&e(zc)),d===u&&(c.substr(F,2)===Vb?(d=Vb,F+=2):(d=u,0===da&&e(nb)),d===u&&(13===c.charCodeAt(F)?(d=bb,F++):(d=u,0===da&&e(mc)))),da--,d===u&&0===da&&e(Qb),d===u&&(d=null),d!==u?
a=b:(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u);return a}function k(){var a,b,d,g,h,k,l,p;a=F;b=f();if(b!==u){d=[];g=F;h=V();h!==u?(44===c.charCodeAt(F)?(k=ea,F++):(k=u,0===da&&e(Y)),k!==u?(l=V(),l!==u?(p=f(),p!==u?g=h=[h,k,l,p]:(F=g,g=u)):(F=g,g=u)):(F=g,g=u)):(F=g,g=u);for(;g!==u;)d.push(g),g=F,h=V(),h!==u?(44===c.charCodeAt(F)?(k=ea,F++):(k=u,0===da&&e(Y)),k!==u?(l=V(),l!==u?(p=f(),p!==u?g=h=[h,k,l,p]:(F=g,g=u)):(F=g,g=u)):(F=g,g=u)):(F=g,g=u);d!==u?a=b=0==d.length?b:d[d.length-1]:(F=a,a=u)}else F=
a,a=u;return a}function f(){var a,b,d,f;a=F;b=n();b!==u?(d=V(),d!==u?(63===c.charCodeAt(F)?(d=na,F++):(d=u,0===da&&e(H)),d!==u?(d=V(),d!==u?(d=k(),d!==u?(f=V(),f!==u?(58===c.charCodeAt(F)?(f=W,F++):(f=u,0===da&&e(ba)),f!==u?(f=V(),f!==u?(f=k(),f!==u?a=b?d:f:(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u);a===u&&(a=n());return a}function n(){var a,b,c,d,e,f,h,k;a=F;b=g();if(b!==u){c=[];d=F;e=V();e!==u?(f=U(),f!==u?(h=V(),h!==u?(k=g(),k!==u?d=e=[e,f,
h,k]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=U(),f!==u?(h=V(),h!==u?(k=g(),k!==u?d=e=[e,f,h,k]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else F=a,a=u}else F=a,a=u;return a}function g(){var a,b,c,d,e,f,g,h;a=F;b=l();if(b!==u){c=[];d=F;e=V();e!==u?(f=P(),f!==u?(g=V(),g!==u?(h=l(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=P(),f!==u?(g=V(),g!==u?(h=
l(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else F=a,a=u}else F=a,a=u;return a}function l(){var a,b,c,d,e,f,g,h;a=F;b=y();if(b!==u){c=[];d=F;e=V();e!==u?(f=Z(),f!==u?(g=V(),g!==u?(h=y(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=Z(),f!==u?(g=V(),g!==u?(h=y(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a|=c[b][3];
else F=a,a=u}else F=a,a=u;return a}function y(){var a,b,c,d,e,f,g,h;a=F;b=p();if(b!==u){c=[];d=F;e=V();e!==u?(f=Q(),f!==u?(g=V(),g!==u?(h=p(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=Q(),f!==u?(g=V(),g!==u?(h=p(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else F=a,a=u}else F=a,a=u;return a}function p(){var a,b,c,d,e,f,g,h;a=F;b=w();if(b!==u){c=[];d=F;e=V();e!==u?(f=O(),
f!==u?(g=V(),g!==u?(h=w(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=O(),f!==u?(g=V(),g!==u?(h=w(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else F=a,a=u}else F=a,a=u;return a}function w(){var a,b,c,d,e,f,g,h;a=F;b=z();if(b!==u){c=[];d=F;e=V();e!==u?(f=D(),f!==u?(g=V(),g!==u?(h=z(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,
e=V(),e!==u?(f=D(),f!==u?(g=V(),g!==u?(h=z(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else F=a,a=u}else F=a,a=u;return a}function z(){var a,b,c,d,e,f,g,h;a=F;b=E();if(b!==u){c=[];d=F;e=V();e!==u?(f=G(),f!==u?(g=V(),g!==u?(h=E(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=G(),f!==u?(g=V(),g!==u?(h=E(),h!==u?d=e=[e,
f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else F=a,a=u}else F=a,a=u;return a}function E(){var a,b,c,d,e,f,g,h;a=F;b=B();if(b!==u){c=[];d=F;e=V();e!==u?(f=M(),f!==u?(g=V(),g!==u?(h=B(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=M(),f!==u?(g=V(),g!==u?(h=B(),h!==u?d=e=[e,f,g,
h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else F=a,a=u}else F=a,a=u;return a}function B(){var a,b,c,d,e,f,g,h;a=F;b=v();if(b!==u){c=[];d=F;e=V();e!==u?(f=L(),f!==u?(g=V(),g!==u?(h=v(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=L(),f!==u?(g=V(),g!==u?(h=v(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=
b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else F=a,a=u}else F=a,a=u;return a}function v(){var a,b,c,d,e,f,g,h;a=F;b=t();if(b!==u){c=[];d=F;e=V();e!==u?(f=N(),f!==u?(g=V(),g!==u?(h=t(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);for(;d!==u;)c.push(d),d=F,e=V(),e!==u?(f=N(),f!==u?(g=V(),g!==u?(h=t(),h!==u?d=e=[e,f,g,h]:(F=d,d=u)):(F=d,d=u)):(F=d,d=u)):(F=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=
Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else F=a,a=u}else F=a,a=u;return a}function t(){var a,b,f;a=F;c.substr(F,7)===xa?(b=xa,F+=7):(b=u,0===da&&e(ra));b!==u?(f=V(),f!==u?(f=I(),f!==u?a=f:(F=a,a=u)):(F=a,a=u)):(F=a,a=u);if(a===u){a=F;b=x();if(b!==u)if(f=V(),f!==u)if(c.substr(F,2)===kb?(f=kb,F+=2):(f=u,0===da&&e(wb)),f===u&&(c.substr(F,2)===Za?(f=Za,F+=2):(f=u,0===da&&e(eb))),f!==u){a:{a=b;switch(f){case "++":b=++a;break a;case "--":b=--a;break a}b=void 0}a=b}else F=a,a=u;else F=a,a=u;else F=
a,a=u;a===u&&(a=x());a===u&&(a=F,c.substr(F,2)===kb?(b=kb,F+=2):(b=u,0===da&&e(wb)),b===u&&(c.substr(F,2)===Za?(b=Za,F+=2):(b=u,0===da&&e(eb)),b===u&&(43===c.charCodeAt(F)?(b=Ea,F++):(b=u,0===da&&e(Va)),b===u&&(45===c.charCodeAt(F)?(b=la,F++):(b=u,0===da&&e(fb)),b===u&&(126===c.charCodeAt(F)?(b=fa,F++):(b=u,0===da&&e(Qa)),b===u&&(33===c.charCodeAt(F)?(b=Da,F++):(b=u,0===da&&e(lb))))))),b!==u?(f=V(),f!==u?(f=t(),f!==u?a=b=d(b,f):(F=a,a=u)):(F=a,a=u)):(F=a,a=u))}return a}function x(){var a,b,d;da++;
var f;a=F;48===c.charCodeAt(F)?(b=sa,F++):(b=u,0===da&&e(oa));if(b!==u)if(T.test(c.charAt(F))?(b=c.charAt(F),F++):(b=u,0===da&&e(Fa)),b!==u){b=F;d=[];f=q();if(f!==u)for(;f!==u;)d.push(f),f=q();else d=u;b=d!==u?c.substring(b,F):d;b!==u?a=b=parseInt("0x"+b):(F=a,a=u)}else F=a,a=u;else F=a,a=u;if(a===u){a=F;48===c.charCodeAt(F)?(b=sa,F++):(b=u,0===da&&e(oa));if(b===u)if(b=F,S.test(c.charAt(F))?(d=c.charAt(F),F++):(d=u,0===da&&e(Xa)),d!==u){var g;f=[];g=r();if(g!==u)for(;g!==u;)f.push(g),g=r();else f=
u;f===u&&(f=null);f!==u?b=d=[d,f]:(F=b,b=u)}else F=b,b=u;a=b!==u?c.substring(a,F):b;a!==u&&(a=parseInt(a))}da--;a===u&&0===da&&e(ga);a===u&&(b=C(),b!==u&&(b=0),a=b,a===u&&(a=F,40===c.charCodeAt(F)?(b=ja,F++):(b=u,0===da&&e(ca)),b!==u?(b=V(),b!==u?(b=k(),b!==u?(d=V(),d!==u?(41===c.charCodeAt(F)?(d=ka,F++):(d=u,0===da&&e(K)),d!==u?a=b:(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u)));return a}function I(){var a,b,d,f,g;b=C();b!==u&&(b=0);a=b;if(a===u){b=[];f=d=F;da++;40===c.charCodeAt(F)?(g=ja,
F++):(g=u,0===da&&e(ca));g===u&&(41===c.charCodeAt(F)?(g=ka,F++):(g=u,0===da&&e(K)));da--;g===u?f=void 0:(F=f,f=u);f!==u?(g=ia(),g!==u?d=f=[f,g]:(F=d,d=u)):(F=d,d=u);if(d!==u)for(;d!==u;)b.push(d),f=d=F,da++,40===c.charCodeAt(F)?(g=ja,F++):(g=u,0===da&&e(ca)),g===u&&(41===c.charCodeAt(F)?(g=ka,F++):(g=u,0===da&&e(K))),da--,g===u?f=void 0:(F=f,f=u),f!==u?(g=ia(),g!==u?d=f=[f,g]:(F=d,d=u)):(F=d,d=u);else b=u;b!==u&&(b=1);a=b;a===u&&(a=F,40===c.charCodeAt(F)?(b=ja,F++):(b=u,0===da&&e(ca)),b!==u?(d=V(),
d!==u?(f=I(),f!==u?(g=V(),g!==u?(41===c.charCodeAt(F)?(b=ka,F++):(b=u,0===da&&e(K)),b!==u?a=f:(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u)):(F=a,a=u))}return a}function r(){var a;Ca.test(c.charAt(F))?(a=c.charAt(F),F++):(a=u,0===da&&e(Ha));return a}function q(){var a;ta.test(c.charAt(F))?(a=c.charAt(F),F++):(a=u,0===da&&e(Ya));return a}function C(){var a,b;da++;b=a=F;da++;var d,f,g,h;d=F;c.substr(F,7)===xa?(f=xa,F+=7):(f=u,0===da&&e(ra));f!==u?(g=F,da++,h=A(),da--,h===u?g=void 0:(F=g,g=u),g!==u?d=f=
[f,g]:(F=d,d=u)):(F=d,d=u);da--;d===u?b=void 0:(F=b,b=u);if(b!==u){da++;b=F;d=J();if(d!==u){f=[];for(g=A();g!==u;)f.push(g),g=A();f!==u?b=d+=f.join(""):(F=b,b=u)}else F=b,b=u;da--;b===u&&0===da&&e(Na);b!==u?a=b:(F=a,a=u)}else F=a,a=u;da--;a===u&&0===da&&e(Na);return a}function J(){var a;Ma.test(c.charAt(F))?(a=c.charAt(F),F++):(a=u,0===da&&e(Ob));a===u&&(36===c.charCodeAt(F)?(a=vb,F++):(a=u,0===da&&e(Ja)),a===u&&(95===c.charCodeAt(F)?(a=Cb,F++):(a=u,0===da&&e(wa))));return a}function A(){var a;a=
J();a===u&&(a=r());return a}function N(){var a,b,d,f;a=F;42===c.charCodeAt(F)?(b=hb,F++):(b=u,0===da&&e(za));b===u&&(47===c.charCodeAt(F)?(b=Pa,F++):(b=u,0===da&&e(Rb)),b===u&&(37===c.charCodeAt(F)?(b=Eb,F++):(b=u,0===da&&e(xc))));b!==u?(d=F,da++,61===c.charCodeAt(F)?(f=fc,F++):(f=u,0===da&&e(ob)),da--,f===u?d=void 0:(F=d,d=u),d!==u?a=b:(F=a,a=u)):(F=a,a=u);return a}function L(){var a,b,d;a=F;43===c.charCodeAt(F)?(b=Ea,F++):(b=u,0===da&&e(Va));b!==u?(b=F,da++,43===c.charCodeAt(F)?(d=Ea,F++):(d=u,
0===da&&e(Va)),d===u&&(61===c.charCodeAt(F)?(d=fc,F++):(d=u,0===da&&e(ob))),da--,d===u?b=void 0:(F=b,b=u),b!==u?a="+":(F=a,a=u)):(F=a,a=u);a===u&&(a=F,45===c.charCodeAt(F)?(b=la,F++):(b=u,0===da&&e(fb)),b!==u?(b=F,da++,45===c.charCodeAt(F)?(d=la,F++):(d=u,0===da&&e(fb)),d===u&&(61===c.charCodeAt(F)?(d=fc,F++):(d=u,0===da&&e(ob))),da--,d===u?b=void 0:(F=b,b=u),b!==u?a="-":(F=a,a=u)):(F=a,a=u));return a}function M(){var a;c.substr(F,2)===pc?(a=pc,F+=2):(a=u,0===da&&e(yc));a===u&&(c.substr(F,2)===mb?
(a=mb,F+=2):(a=u,0===da&&e(Fb)));return a}function G(){var a;c.substr(F,2)===Ka?(a=Ka,F+=2):(a=u,0===da&&e(Aa));a===u&&(c.substr(F,2)===Ga?(a=Ga,F+=2):(a=u,0===da&&e(xb)),a===u&&(60===c.charCodeAt(F)?(a=ib,F++):(a=u,0===da&&e(Sb)),a===u&&(62===c.charCodeAt(F)?(a=Gb,F++):(a=u,0===da&&e(Hb)))));return a}function D(){var a;c.substr(F,2)===yb?(a=yb,F+=2):(a=u,0===da&&e(Db));a===u&&(c.substr(F,2)===Ra?(a=Ra,F+=2):(a=u,0===da&&e(va)));return a}function O(){var a,b,d;a=F;38===c.charCodeAt(F)?(b=pb,F++):
(b=u,0===da&&e(Tb));b!==u?(b=F,da++,38===c.charCodeAt(F)?(d=pb,F++):(d=u,0===da&&e(Tb)),da--,d===u?b=void 0:(F=b,b=u),b!==u?a="&":(F=a,a=u)):(F=a,a=u);return a}function Q(){var a,b,d;a=F;94===c.charCodeAt(F)?(b=qa,F++):(b=u,0===da&&e(rb));b!==u?(b=F,da++,94===c.charCodeAt(F)?(d=qa,F++):(d=u,0===da&&e(rb)),da--,d===u?b=void 0:(F=b,b=u),b!==u?a="^":(F=a,a=u)):(F=a,a=u);return a}function Z(){var a,b,d;a=F;124===c.charCodeAt(F)?(b=aa,F++):(b=u,0===da&&e(zb));b!==u?(b=F,da++,124===c.charCodeAt(F)?(d=aa,
F++):(d=u,0===da&&e(zb)),da--,d===u?b=void 0:(F=b,b=u),b!==u?a="|":(F=a,a=u)):(F=a,a=u);return a}function P(){var a;c.substr(F,2)===$a?(a=$a,F+=2):(a=u,0===da&&e(Ba));a!==u&&(a="&&");return a}function U(){var a;c.substr(F,2)===ya?(a=ya,F+=2):(a=u,0===da&&e(sb));a!==u&&(a="||");return a}function V(){var a,b;a=[];for(b=X();b!==u;)a.push(b),b=X();return a}function X(){var a;da++;ab.test(c.charAt(F))?(a=c.charAt(F),F++):(a=u,0===da&&e(Pb));da--;a===u&&0===da&&e($b);return a}function ia(){var a;c.length>
F?(a=c.charAt(F),F++):(a=u,0===da&&e(Kb));return a}var R=1<arguments.length?arguments[1]:{},u={},pa={start:h},ha=h,ea=",",Y={type:"literal",value:",",description:'","'},na="?",H={type:"literal",value:"?",description:'"?"'},W=":",ba={type:"literal",value:":",description:'":"'},xa="defined",ra={type:"literal",value:"defined",description:'"defined"'},ja="(",ca={type:"literal",value:"(",description:'"("'},ka=")",K={type:"literal",value:")",description:'")"'},ga={type:"other",description:"number"},sa=
"0",oa={type:"literal",value:"0",description:'"0"'},Ca=/^[0-9]/,Ha={type:"class",value:"[0-9]",description:"[0-9]"},S=/^[1-9]/,Xa={type:"class",value:"[1-9]",description:"[1-9]"},T=/^[xX]/,Fa={type:"class",value:"[xX]",description:"[xX]"},ta=/^[0-9a-fA-F]/,Ya={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Na={type:"other",description:"identifier"},vb="$",Ja={type:"literal",value:"$",description:'"$"'},Cb="_",wa={type:"literal",value:"_",description:'"_"'},Ma=/^[a-zA-Z]/,Ob={type:"class",
value:"[a-zA-Z]",description:"[a-zA-Z]"},kb="++",wb={type:"literal",value:"++",description:'"++"'},Za="--",eb={type:"literal",value:"--",description:'"--"'},Ea="+",Va={type:"literal",value:"+",description:'"+"'},la="-",fb={type:"literal",value:"-",description:'"-"'},fa="~",Qa={type:"literal",value:"~",description:'"~"'},Da="!",lb={type:"literal",value:"!",description:'"!"'},hb="*",za={type:"literal",value:"*",description:'"*"'},Pa="/",Rb={type:"literal",value:"/",description:'"/"'},Eb="%",xc={type:"literal",
value:"%",description:'"%"'},fc="=",ob={type:"literal",value:"=",description:'"="'},pc="<<",yc={type:"literal",value:"<<",description:'"<<"'},mb=">>",Fb={type:"literal",value:">>",description:'">>"'},Ka="<=",Aa={type:"literal",value:"<=",description:'"<="'},Ga=">=",xb={type:"literal",value:">=",description:'">="'},ib="<",Sb={type:"literal",value:"<",description:'"<"'},Gb=">",Hb={type:"literal",value:">",description:'">"'},yb="==",Db={type:"literal",value:"==",description:'"=="'},Ra="!=",va={type:"literal",
value:"!=",description:'"!="'},pb="&",Tb={type:"literal",value:"&",description:'"&"'},qa="^",rb={type:"literal",value:"^",description:'"^"'},aa="|",zb={type:"literal",value:"|",description:'"|"'},$a="&&",Ba={type:"literal",value:"&&",description:'"&&"'},ya="||",sb={type:"literal",value:"||",description:'"||"'},$b={type:"other",description:"whitespace"},ab=/^[\t\x0B\f ]/,Pb={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},Qb={type:"other",description:"end of line"},Ub="\n",zc={type:"literal",
value:"\n",description:'"\\n"'},Vb="\r\n",nb={type:"literal",value:"\r\n",description:'"\\r\\n"'},bb="\r",mc={type:"literal",value:"\r",description:'"\\r"'},Kb={type:"any",description:"any character"},F=0,gc=0,qb={Ci:1,Pg:1,Wi:!1},Ib=0,Lb=[],da=0,gb;if("startRule"in R){if(!(R.Us in pa))throw Error("Can't start parsing from rule \""+R.Us+'".');ha=pa[R.Us]}gb=ha();if(gb!==u&&F===c.length)return gb;gb!==u&&F<c.length&&e({type:"end",description:"end of input"});throw function(d,e,f){function g(a){var b=
1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+
b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=b(f),l=f<c.length?c.charAt(f):null;null!==e&&g(e);return new a(null!==d?d:h(e,l),0,0,f,k.Ci,k.Pg)}(null,Lb,Ib);}}}()};b4w.module.__md5=function(a){function m(a,f){var h=a[0],g=a[1],l=a[2],m=a[3],h=d(h,g,l,m,f[0],7,-680876936),m=d(m,h,g,l,f[1],12,-389564586),l=d(l,m,h,g,f[2],17,606105819),g=d(g,l,m,h,f[3],22,-1044525330),h=d(h,g,l,m,f[4],7,-176418897),m=d(m,h,g,l,f[5],12,1200080426),l=d(l,m,h,g,f[6],17,-1473231341),g=d(g,l,m,h,f[7],22,-45705983),h=d(h,g,l,m,f[8],7,1770035416),m=d(m,h,g,l,f[9],12,-1958414417),l=d(l,m,h,g,f[10],17,-42063),g=d(g,l,m,h,f[11],22,-1990404162),h=d(h,g,l,m,f[12],7,1804603682),m=d(m,h,g,l,
f[13],12,-40341101),l=d(l,m,h,g,f[14],17,-1502002290),g=d(g,l,m,h,f[15],22,1236535329),h=b(h,g,l,m,f[1],5,-165796510),m=b(m,h,g,l,f[6],9,-1069501632),l=b(l,m,h,g,f[11],14,643717713),g=b(g,l,m,h,f[0],20,-373897302),h=b(h,g,l,m,f[5],5,-701558691),m=b(m,h,g,l,f[10],9,38016083),l=b(l,m,h,g,f[15],14,-660478335),g=b(g,l,m,h,f[4],20,-405537848),h=b(h,g,l,m,f[9],5,568446438),m=b(m,h,g,l,f[14],9,-1019803690),l=b(l,m,h,g,f[3],14,-187363961),g=b(g,l,m,h,f[8],20,1163531501),h=b(h,g,l,m,f[13],5,-1444681467),m=
b(m,h,g,l,f[2],9,-51403784),l=b(l,m,h,g,f[7],14,1735328473),g=b(g,l,m,h,f[12],20,-1926607734),h=c(g^l^m,h,g,f[5],4,-378558),m=c(h^g^l,m,h,f[8],11,-2022574463),l=c(m^h^g,l,m,f[11],16,1839030562),g=c(l^m^h,g,l,f[14],23,-35309556),h=c(g^l^m,h,g,f[1],4,-1530992060),m=c(h^g^l,m,h,f[4],11,1272893353),l=c(m^h^g,l,m,f[7],16,-155497632),g=c(l^m^h,g,l,f[10],23,-1094730640),h=c(g^l^m,h,g,f[13],4,681279174),m=c(h^g^l,m,h,f[0],11,-358537222),l=c(m^h^g,l,m,f[3],16,-722521979),g=c(l^m^h,g,l,f[6],23,76029189),h=
c(g^l^m,h,g,f[9],4,-640364487),m=c(h^g^l,m,h,f[12],11,-421815835),l=c(m^h^g,l,m,f[15],16,530742520),g=c(l^m^h,g,l,f[2],23,-995338651),h=e(h,g,l,m,f[0],6,-198630844),m=e(m,h,g,l,f[7],10,1126891415),l=e(l,m,h,g,f[14],15,-1416354905),g=e(g,l,m,h,f[5],21,-57434055),h=e(h,g,l,m,f[12],6,1700485571),m=e(m,h,g,l,f[3],10,-1894986606),l=e(l,m,h,g,f[10],15,-1051523),g=e(g,l,m,h,f[1],21,-2054922799),h=e(h,g,l,m,f[8],6,1873313359),m=e(m,h,g,l,f[15],10,-30611744),l=e(l,m,h,g,f[6],15,-1560198380),g=e(g,l,m,h,f[13],
21,1309151649),h=e(h,g,l,m,f[4],6,-145523070),m=e(m,h,g,l,f[11],10,-1120210379),l=e(l,m,h,g,f[2],15,718787259),g=e(g,l,m,h,f[9],21,-343485551);a[0]=h+a[0]&4294967295;a[1]=g+a[1]&4294967295;a[2]=l+a[2]&4294967295;a[3]=m+a[3]&4294967295}function c(a,b,c,d,e,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function d(a,b,d,e,h,m,p){return c(b&d|~b&e,a,b,h,m,p)}function b(a,b,d,e,h,m,p){return c(b&e|d&~e,a,b,h,m,p)}function e(a,b,d,e,h,m,p){return c(d^(b|~e),a,b,h,
m,p)}var h="0123456789abcdef".split("");a.Xq=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),y=[],p=void 0,p=0;64>p;p+=4)y[p>>2]=e.charCodeAt(p)+(e.charCodeAt(p+1)<<8)+(e.charCodeAt(p+2)<<16)+(e.charCodeAt(p+3)<<24);m(a,y)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(m(a,e),d=0;16>d;d++)e[d]=0;e[14]=8*
c;m(a,e);for(b=0;b<a.length;b++){c=a[b];d="";for(e=0;4>e;e++)d+=h[c>>8*e+4&15]+h[c>>8*e&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a ; a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"textline",b:"void main ( ) { float b ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",
a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { mat4 ck ; vec3 cl , cm , cn , co ; cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"cm = vec3 ( 0.0 ) ; cn = vec3 ( 0.0 ) ; co = vec3 ( 0.0 ) ; bv ( cl , cm , cn , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["cm","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"cn = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"ck = ao ( u_camera_eye , cn , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ck = ai ( u_camera_eye , cn , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"co = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ; ck = ck * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , co ) ;".split(" ")}]}}]},{type:"textline",b:"d cp = av ( cl - cm , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ck ) ; cp . b = cn ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d cp = av ( cl , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["co","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"co = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cj ( cp . a , cp . b , co ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cp . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:"void main ( ) { float e_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:"e_ = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"e_ = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( e_ < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cq ( cD ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( eU ( cJ . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { float fT ; vec2 fU ; vec4 fV , fW ; mat4 fX , fY ; vec3 fZ , f_ , ga , gb ; fZ = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"fZ = mix ( fZ , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"f_ = vec3 ( 0.0 ) ; ga = vec3 ( 0.0 ) ; gb = vec3 ( 0.0 ) ; bv ( fZ , f_ , ga , gb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["f_","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"f_ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"d gc = fE ( fZ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , f_ , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"ga = ( u_model_matrix * vec4 ( f_ , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:["fX","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fX","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"fY = ao ( u_camera_eye , ga , fX , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"fY = ai ( u_camera_eye , ga , fX ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"gb = ( u_model_matrix * vec4 ( f_ , 1.0 ) ) . xyz ; fY = fY * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gb ) ;".split(" ")}]}}]},{type:"textline",b:"d gc = av ( fZ - f_ , f_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , fY ) ; gc . b = ga ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gc = av ( fZ , f_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["gb","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cj ( gc . a , gc . b , gb ) ;".split(" ")}]}}]},{type:"textline",b:"fV = u_view_matrix * vec4 ( gc . a , 1.0 ) ; fW = u_proj_matrix * fV ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"fW . xy += u_subpixel_jitter * fW . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( gc . a ) ; cJ = fV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],
group:{type:"group",a:[{type:"textline",b:"cD = - fV . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"fU = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; fT = SHADOW_TEX_RES / 2.0 ; fU = floor ( fU * fT + 0.5 ) / fT - fU ; fW . xy += fU ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","fW",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","fT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","fT",";"]}]}}]}]}}]},
{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fT , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = vec4 ( 1.0 , fT ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","fT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","fT",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 fU ; mat4 fV ; vec3 fW ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fW = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; fV = ai ( u_camera_eye , fW , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"fV = fV * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d fX = av ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , fV ) ; fX . b = fW ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d fX = av ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"fU = u_proj_matrix * u_view_matrix * vec4 ( fX . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"fT = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fT","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["fT","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","fU",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 ga ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gc = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gc = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float ge ( float gd ) { return gd - floor ( gd * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gn ( inout float gf , in float gg [ gc ] , in float gh ) { float gi , gj , gk , gl ; for ( int gm = 0 ; gm < NUM_RINGS ; gm ++ ) { gi = 40.0 * gg [ gm ] ; gj = 300.0 * ( ge ( gi ) - 0.005 ) ; gk = gi ; gl = abs ( gk * ( u_halo_size * gj - gh ) ) ; gf += 1.0 - min ( gl , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gw ( inout float go , in float gp [ gc ] , in float gq ) { float gr , gs , gt , gu ; for ( int gv = 0 ; gv < NUM_LINES ; gv ++ ) { gr = gp [ gv ] ; gs = gr ; gt = 1000.0 * ( ge ( gr ) - 0.005 ) ; gu = 20.0 * abs ( gs * a . x + gt * a . y ) ; go += 1.0 - min ( gu , 1.0 ) ; } go *= gq ; }".split(" ")}]}}]},{type:"textline",b:"void gD ( inout float gx , in vec2 gy ) { float gz , gA , gB , gC ; gA = atan ( gy . y , gy . x ) ; gA *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; gB = cos ( gA ) ; gC = sin ( gA ) ; gA = ( gB * gy . x + gC * gy . y ) * ( gB * gy . y - gC * gy . x ) ; gz = abs ( gA ) ; if ( gz < 1.0 ) { gz = ( 0.01 * u_halo_size ) / ( gz ) ; gx *= sqrt ( min ( gz , 1.0 ) ) ; } } void main ( ) { vec3 gE ; float gF , gG , gH , gI ; gF = ( a . x * a . x + a . y * a . y ) ; gG = sqrt ( gF ) ; gF = max ( 1.0 - gF , 0.0 ) ; gF = pow ( gF , u_halo_hardness ) ; gH = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float gJ [ gc ] ; for ( int gK = 0 ; gK < gc ; gK ++ ) { gJ [ gK ] = fract ( gb / ( float ( gK ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"gI = 0.0 ; gn ( gI , gJ , gG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"gG = 0.0 ; gw ( gG , gJ , gF ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"gD ( gF , a ) ;".split(" ")}]}}]},{type:"textline",b:"gF *= gH ; gE = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"gI *= gF ; gE += u_halo_rings_color * gI ; gF += gI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"gG *= gH ; gE += u_halo_lines_color * gG ; gF += gG ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"gF *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gI = u_halo_stars_blend * ( ga . y - u_halo_stars_height ) ; gF *= clamp ( gI , 0.0 , 1.0 ) ; gF *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"fX ( gE ) ; f_ ( gE , gF ) ; gl_FragColor = vec4 ( gE , gF ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gb ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ga",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 gc , gd ; mat4 ge , gf ; vec3 gg ; gg = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gb = fract ( gg . x + gg . y + gg . z ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ge = N ( gg , u_view_matrix ) ; gf = u_view_matrix ; gf [ 3 ] [ 0 ] = 0.0 ; gf [ 3 ] [ 1 ] = 0.0 ; gf [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ge = N ( gg , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"gc = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; gc = ge * gc ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",
b:"gd = u_proj_matrix * gf * gc ; gd . z = 0.99999 * gd . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["ga","=","gc",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gd = u_proj_matrix * u_view_matrix * gc ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gd",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gc ; gc = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gc , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform",
"float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_CUBE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",
b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || REFLECTION_TYPE == REFL_CUBE".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float",
"u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ; varying vec3 jD ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jF",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec4 kr , ks , kt , ku ; mat3 kv ; vec3 kw , kx , ky , kz , kA , kB , kC , kD ; vec2 kE , kF , kG , kH ; float kI , kJ , kK , kL , kM ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kI = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["kE","=","a",";"]}]}}]},{type:"textline",b:["kw","=","jD",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) kw = kw ; else kw = - kw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],
group:{type:"group",a:[{type:"textline",b:"kx = cross ( kw , jE . xyz ) * jE . w ; kv = mat3 ( jE . xyz , kx , kw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"kJ = length ( cJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kF = normalize ( u_view_matrix_frag * vec4 ( jD , 0.0 ) ) . st ; kF = kF * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( kJ < PARALLAX_LOD_DIST ) { kK = clamp ( 0.5 * ( PARALLAX_LOD_DIST - kJ ) , 0.0 , 1.0 ) ; kK = u_parallax_scale * kK ; kx = normalize ( jB * kv ) ; kL = 1.0 / PARALLAX_STEPS ; kG = kx . xy * kK / ( PARALLAX_STEPS * kx . z ) ; kK = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:["kH","=",
"kF",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kH","=","kE",";"]}]}}]},{type:"textline",b:"kM = texture2D ( u_normalmap0 , kH ) . a ; for ( float kN = 1.0 ; kN <= PARALLAX_STEPS ; kN ++ ) { if ( kM < kK ) { kK -= kL ; kH -= kG ; kM = texture2D ( u_normalmap0 , kH ) . a ; } } kG = kH + kG ; kL = texture2D ( u_normalmap0 , kG ) . a - ( kK + kL ) ; kM = kM - kK ; kK = kM / ( kM - kL ) ; kH = kK * kG + ( 1.0 - kK ) * kH ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kE += kH - kF ;".split(" ")}]}}]},{type:"textline",b:["kF","=","kH",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kF += kH - kE ;".split(" ")}]}}]},{type:"textline",b:["kE","=","kH",";"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],
group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kr = texture2D ( u_normalmap0 , kF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kr = texture2D ( u_normalmap0 , kE ) ;".split(" ")}]}}]},{type:"textline",b:"kx = kr . rgb - 0.5 ; kx = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , kx , u_normal_factor ) ; kx = kv * kx ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["kx","=","kw",";"]}]}}]},{type:"textline",b:"kx = normalize ( kx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kF = normalize ( u_view_matrix_frag * vec4 ( kx , 0.0 ) ) . st ; kF = kF * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"kw = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ky = jF ; fV ( ky ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kr = vec4 ( ky , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kr","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["kM","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_colormap0 , kF ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_colormap0 , kE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"fV ( ks . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_colormap1 , kF ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_colormap1 , kE ) ;".split(" ")}]}}]},{type:"textline",b:"fV ( kt . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"ku = texture2D ( u_stencil0 , kF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ku = texture2D ( u_stencil0 , kE ) ;".split(" ")}]}}]},{type:"textline",b:"ks = mix ( ks , kt , ku . r ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"kr . rgb = mix ( kr . rgb , ks . rgb , u_diffuse_color_factor ) ; kL = u_alpha_factor * ks . a ; kL += ( 1.0 - step ( 0.0 , kL ) ) ; kr . a = mix ( kL , 1.0 , u_diffuse_color . a ) ; kM = ks . a ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"kr . rgb *= mix ( vec3 ( 1.0 ) , ks . rgb , u_diffuse_color_factor ) ; kr . a = ks . a ; kM = ks . a ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"ky = u_diffuse_intensity * kr . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["kz","=","ky",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kA = u_environment_energy * kq ( kx ) ; kA = u_ambient * kA ; kK = eZ ( ky ) ; kB = u_emit * kr . rgb ; kC = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],
group:{type:"group",a:[{type:"textline",b:"kD = vec3 ( kM ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kD = texture2D ( u_specmap0 , kF ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kD = texture2D ( u_specmap0 , kE ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"fV ( kD . rgb ) ; kC = mix ( kC , kD , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"kL = u_specular_params [ 0 ] ; kG = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; kD = kL * kC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"gO kO = jh ( kB , kA , ky ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO kO = jc ( kB , kA , ky , kD , jC , kx , kw , kG , u_diffuse_params , kK , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"kz = kO . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || REFLECTION_TYPE == REFL_CUBE".split(" "),
group:{type:"group",a:[{type:"textline",b:"j_ ( kz , kw , kx , u_reflect_factor ) ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:"j_ ( kz , kw , kx , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kz += kO . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",
a:[{type:"textline",b:"kz = max ( kz - sqrt ( 0.01 * - min ( kI , 0.0 ) ) , 0.5 * kz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"jA ( kz , kI , u_time , kK , kx , u_sun_direction , u_sun_intensity , u_sun_quaternion , jC , kJ ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"kM = kr . a ; if ( kM <= 0.5 ) discard ; kM = 1.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kM = kr . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kM += kO . a . a * kD . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kM","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kz = mix ( kn ( cI , kx . xz * u_refr_bump ) , kz , kM ) ; kM = 1.0 ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"kL = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"kC = gm ( u_cube_fog , kw ) ; kt = vec4 ( kC , u_fog_color_density . a ) ; fV ( kt . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kt = u_fog_color_density ; kt . rgb *= kL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"gC ( kz , kJ , kw , u_cam_water_depth , u_underwater_fog_color_density , kt , kI , kL ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( kz , kJ , kt ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),
group:{type:"group",a:[{type:"textline",b:"kz = vec3 ( dC . a ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","kz",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kz , kM ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kz , kM ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},
{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ; varying vec3 jD ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jF",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec4 kr , ks ; float kt , ku , kv ; mat4 kw ; vec3 kx , ky , kz , kA , kB , kC , kD ; kx = a_position ; ky = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"kz = vec3 ( a_tangent ) ; kA = a_tangent [ 3 ] * cross ( ky , kz ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kB = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; kC = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; kB = kB - u_camera_eye ; kA = cross ( kB , kC ) ; kz = cross ( kC , kA ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"kz = vec3 ( 0.0 ) ; kA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kx = mix ( kx , a_position_next , u_va_frame_factor ) ; ky = mix ( ky , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"kB = vec3 ( a_tangent ) ; kC = a_tangent_next [ 3 ] * cross ( a_normal_next , kB ) ; kz = mix ( kz , kB , u_va_frame_factor ) ; kA = mix ( kA , kC , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bv ( kx , kz , kA , ky ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["kB","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kB = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d kE = fE ( kx , kz , kA , ky , kB , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"kC = ( u_model_matrix * vec4 ( kB , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"kw = ao ( u_camera_eye , kC , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kw = ai ( u_camera_eye , kC , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"kD = ( u_model_matrix * vec4 ( kB , 1.0 ) ) . xyz ; kw = kw * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kD ) ;".split(" ")}]}}]},{type:"textline",b:"d kE = av ( kx - kB , kB , kz , kA , ky , kw ) ; kE . b = kC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d kE = av ( kx , kB , kz , kA , ky , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"kt = ( dot ( cross ( kE . e , kE . c ) , kE . d ) < 0.0 ) ? - 1.0 : 1.0 ; jE = vec4 ( kE . c , kt ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( kE . a , kE . b , ky ) ;".split(" ")}]}}]},{type:"textline",b:"jC = kE . a ; jD = kE . e ; jB = u_camera_eye - kE . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"jF = kE . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["jF","=","a_color",";"]}]}}]},{type:"textline",b:"kr = u_view_matrix * vec4 ( kE . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["cJ","=","kr",";"]}]}}]},{type:"textline",b:"ks = u_proj_matrix * kr ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"ks . xy += u_subpixel_jitter * ks . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["fO","(","ks",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( kE . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"kt = ks . x ; ku = ks . y ; kv = ks . w ; cI . x = ( kt + kv ) / 2.0 ; cI . y = ( ku + kv ) / 2.0 ; cI . z = kv ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jG = - kr . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","ks",";","}"]}]};a["nodes.glslf"]=
{type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",
file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_CUBE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 jC ; varying vec4 cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 kr = vec3 ( ZERO_VALUE_NODES ) ; vec3 ks = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},
{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 kw ( in vec3 kt , in float ku ) { vec3 kv ; kv = kr ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",
b:"kv = kn ( cI , kt . xz * ku ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kv = texture2D ( u_refractmap , cI . xy / cI . z ) . rgb ; fV ( kv ) ;".split(" ")}]}}]},{type:"textline",b:["return","kv",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kB ( vec3 kx ) { float ky , kz ; vec4 kA ; kA = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; kA = mix ( vec4 ( kx . bg , kA . wz ) , vec4 ( kx . gb , kA . xy ) , step ( kx . b , kx . g ) ) ; kA = mix ( vec4 ( kA . xyw , kx . r ) , vec4 ( kx . r , kA . yzx ) , step ( kA . x , kx . r ) ) ; ky = kA . x - min ( kA . w , kA . y ) ; kz = 1.0e-10 ; return vec3 ( abs ( kA . z + ( kA . w - kA . y ) / ( 6.0 * ky + kz ) ) , ky / ( kA . x + kz ) , kA . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kF ( vec3 kC ) { vec3 kD ; vec4 kE ; kE = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; kD = abs ( fract ( vec3 ( kC . r , kC . r , kC . r ) + kE . xyz ) * 6.0 - kE . www ) ; return kC . b * mix ( kE . xxx , clamp ( kD - kE . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , kC . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 kH ( vec2 kG ) { return vec3 ( kG * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","||","USE_NODE_TEXTURE_NORMAL","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec2 kJ ( vec3 kI ) { return vec2 ( kI . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",k:[{type:"node_out",name:"lH",qualifier:["vec3"],e:!0},{type:"node_out",name:"lI",qualifier:["float"],e:!0},{type:"node_out",name:"lJ",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lH"],f:[{type:"textline",b:"lH = normalize ( kW . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lI"],f:[{type:"textline",b:"lI = abs ( kW . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lJ"],
f:[{type:"textline",b:"lJ = length ( kW . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"lK",qualifier:["float"],e:!1},{type:"node_in",name:"lL",qualifier:["float"],e:!1},{type:"node_in",name:"lM",qualifier:["float"],e:!1},{type:"node_out",name:"lN",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lN = vec3 ( lK , lL , lM ) ;".split(" ")}]},{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"lO",qualifier:["float"],e:!1},{type:"node_in",name:"lP",qualifier:["float"],
e:!1},{type:"node_in",name:"lQ",qualifier:["float"],e:!1},{type:"node_out",name:"lR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lR = kF ( vec3 ( lO , lP , lQ ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"lS",qualifier:["vec3"],e:!1},{type:"node_param",name:"kK",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"lS = kH ( kK ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"lT",qualifier:["vec3"],e:!1},{type:"node_param",name:"kL",
qualifier:["varying","vec3"]}],f:[{type:"textline",b:["lT","=","kL",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"lU",qualifier:["float"],e:!1},{type:"node_param",name:"kM",qualifier:["varying","float"]}],f:[{type:"textline",b:["lU","=","kM",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"lV",qualifier:["float"],e:!1},{type:"node_out",name:"lW",qualifier:["float"],e:!1},{type:"node_param",name:"kN",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"lV = kN [ 0 ] ; lW = kN [ 1 ] ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"lX",qualifier:["float"],e:!1},{type:"node_out",name:"lY",qualifier:["float"],e:!1},{type:"node_out",name:"lZ",qualifier:["float"],e:!1},{type:"node_param",name:"kO",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"lX = kO [ 0 ] ; lY = kO [ 1 ] ; lZ = kO [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",k:[{type:"node_out",name:"l_",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["l_","=","ln",";"]}]},{type:"node",name:"GEOMETRY_FB",
k:[{type:"node_out",name:"ma",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ma = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mb",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mb","=","lm",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"mc",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mc = vec3 ( lo . r , - lo . b , lo . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",
name:"md",qualifier:["float"],e:!1},{type:"node_in",name:"me",qualifier:["float"],e:!1},{type:"node_in",name:"mf",qualifier:["float"],e:!1},{type:"node_in",name:"mg",qualifier:["float"],e:!1},{type:"node_in",name:"mh",qualifier:["vec3"],e:!1},{type:"node_out",name:"mi",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ls = kB ( mh ) ; ls [ 0 ] += ( md - 0.5 ) ; if ( ls [ 0 ] > UNITY_VALUE_NODES ) ls [ 0 ] -= UNITY_VALUE_NODES ; else if ( ls [ 0 ] < ZERO_VALUE_NODES ) ls [ 0 ] += UNITY_VALUE_NODES ; ls *= vec3 ( UNITY_VALUE_NODES , me , mf ) ; ls = mix ( ks , mix ( kr , ls , step ( kr , ls ) ) , step ( ls , ks ) ) ; mi = mix ( mh , kF ( ls ) , mg ) ;".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"mj",qualifier:["float"],e:!1},{type:"node_in",name:"mk",qualifier:["vec3"],e:!1},{type:"node_out",name:"ml",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ml = mix ( mk , ks - mk , mj ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"mm",qualifier:["vec3"],e:!0},{type:"node_out",name:"mn",qualifier:["vec3"],e:!1},{type:"node_out",name:"mo",qualifier:["float"],e:!1},{type:"node_out",name:"mp",qualifier:["float"],e:!0}],f:[{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_mm"],f:[{type:"textline",b:"mm = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"kX = u_lamp_light_factors [ LAMP_INDEX ] ; lt = u_lamp_light_directions [ LAMP_INDEX ] ; lu = u_lamp_light_positions [ LAMP_INDEX ] ; le = kX . z ; if ( le != - UNITY_VALUE_NODES ) { mn = lu - jC ; mo = length ( mn ) ; mn = normalize ( mn ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mp"],f:[{type:"textline",b:"mp = le / ( le + mo * mo ) ; le = kX . x ; lf = kX . y ; if ( le > - UNITY_VALUE_NODES ) { lg = dot ( mn , lt ) ; lg *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( lg - le ) / lf ) ; mp *= lg ; }".split(" ")}]}]},
{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mn"],f:[{type:"textline",b:["mn","=","lt",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mo"],f:[{type:"textline",b:"mo = length ( lu - jC ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mp"],f:[{type:"textline",b:["mp","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",k:[{type:"node_in",name:"mq",qualifier:["vec3"],e:!1},{type:"node_out",
name:"mr",qualifier:["vec3"],e:!0},{type:"node_out",name:"ms",qualifier:["float"],e:!0},{type:"node_param",name:"kP",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mr"],f:[{type:"textline",b:["mr","=","kP",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ms"],f:[{type:"textline",b:"ms = - dot ( mq , kP ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",k:[{type:"node_in",name:"mt",qualifier:["vec3"],e:!1},{type:"node_out",name:"mu",qualifier:["vec3"],
e:!1}],f:[{type:"textline",b:"mu = - ( u_view_matrix_frag * vec4 ( mt , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"mv",qualifier:["vec3"],e:!1},{type:"node_out",name:"mw",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mw","=","mv",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"mw = ( MAPPING_TRS_MATRIX * vec4 ( mw , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",
name:"MAPPING_SCALE",f:[{type:"textline",b:"mw = mw * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"mw = mw + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"mw = max ( mw , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",b:"mw = min ( mw , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"mw = normalize ( mw ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"mx",qualifier:["float"],e:!1},{type:"node_in",name:"my",qualifier:["float"],e:!1},{type:"node_out",name:"mz",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mz = mx + my ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mz = clamp ( mz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"mA",qualifier:["float"],e:!1},{type:"node_in",name:"mB",qualifier:["float"],e:!1},{type:"node_out",name:"mC",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mC = mA - mB ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mC = clamp ( mC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",k:[{type:"node_in",name:"mD",qualifier:["float"],e:!1},{type:"node_in",
name:"mE",qualifier:["float"],e:!1},{type:"node_out",name:"mF",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mF = mD * mE ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mF = clamp ( mF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"mG",qualifier:["float"],e:!1},{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_out",name:"mI",qualifier:["float"],e:!1}],f:[{type:"textline",
b:"mI = ( mH != ZERO_VALUE_NODES ) ? mG / mH : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mI = clamp ( mI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"mJ",qualifier:["float"],e:!1},{type:"node_in",name:"mK",qualifier:["float"],e:!1},{type:"node_out",name:"mL",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mL = sin ( mJ ) ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mL = clamp ( mL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mK",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"mM",qualifier:["float"],e:!1},{type:"node_in",name:"mN",qualifier:["float"],e:!1},{type:"node_out",name:"mO",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mO = cos ( mM ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"mO = clamp ( mO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mN",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"mP",qualifier:["float"],e:!1},{type:"node_in",name:"mQ",qualifier:["float"],e:!1},{type:"node_out",name:"mR",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mR = tan ( mP ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mR = clamp ( mR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mQ",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"mS",qualifier:["float"],e:!1},{type:"node_in",name:"mT",qualifier:["float"],e:!1},{type:"node_out",name:"mU",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mU = ( mS <= UNITY_VALUE_NODES && mS >= - UNITY_VALUE_NODES ) ? asin ( mS ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mU = clamp ( mU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mT",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"mV",qualifier:["float"],e:!1},{type:"node_in",name:"mW",qualifier:["float"],e:!1},{type:"node_out",name:"mX",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mX = ( mV <= UNITY_VALUE_NODES && mV >= - UNITY_VALUE_NODES ) ? acos ( mV ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mX = clamp ( mX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mW",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"mY",qualifier:["float"],e:!1},{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_out",name:"m_",qualifier:["float"],e:!1}],f:[{type:"textline",b:"m_ = atan ( mY ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"m_ = clamp ( m_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mZ",";"]}]},{type:"node",name:"MATH_POWER",
k:[{type:"node_in",name:"na",qualifier:["float"],e:!1},{type:"node_in",name:"nb",qualifier:["float"],e:!1},{type:"node_out",name:"nc",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( na < ZERO_VALUE_NODES || na == ZERO_VALUE_NODES && nb == ZERO_VALUE_NODES ) nc = ZERO_VALUE_NODES ; else nc = pow ( na , nb ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nc = clamp ( nc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_LOGARITHM",k:[{type:"node_in",name:"nd",qualifier:["float"],e:!1},{type:"node_in",name:"ne",qualifier:["float"],e:!1},{type:"node_out",name:"nf",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nf = ( nd > ZERO_VALUE_NODES && ne > ZERO_VALUE_NODES ) ? log2 ( nd ) / log2 ( ne ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nf = clamp ( nf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MINIMUM",k:[{type:"node_in",name:"ng",qualifier:["float"],e:!1},{type:"node_in",name:"nh",qualifier:["float"],e:!1},{type:"node_out",name:"ni",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ni = min ( ng , nh ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ni = clamp ( ni , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"nj",qualifier:["float"],e:!1},{type:"node_in",
name:"nk",qualifier:["float"],e:!1},{type:"node_out",name:"nl",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nl = max ( nj , nk ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nl = clamp ( nl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"nm",qualifier:["float"],e:!1},{type:"node_in",name:"nn",qualifier:["float"],e:!1},{type:"node_out",name:"no",qualifier:["float"],e:!1}],
f:[{type:"textline",b:"no = floor ( nm + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"no = clamp ( no , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nn",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"np",qualifier:["float"],e:!1},{type:"node_in",name:"nq",qualifier:["float"],e:!1},{type:"node_out",name:"nr",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nr = ( np < nq ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nr = clamp ( nr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"ns",qualifier:["float"],e:!1},{type:"node_in",name:"nt",qualifier:["float"],e:!1},{type:"node_out",name:"nu",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nu = ( ns > nt ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nu = clamp ( nu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"nv",qualifier:["float"],e:!1},{type:"node_in",name:"nw",qualifier:["float"],e:!1},{type:"node_out",name:"nx",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nx = abs ( nw ) > 0.000001 ? mod ( nv , nw ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nx = clamp ( nx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"ny",qualifier:["float"],e:!1},{type:"node_in",name:"nz",qualifier:["float"],e:!1},{type:"node_out",name:"nA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nA = abs ( ny ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nA = clamp ( nA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nz",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"nB",
qualifier:["float"],e:!1},{type:"node_in",name:"nC",qualifier:["vec3"],e:!1},{type:"node_in",name:"nD",qualifier:["vec3"],e:!1},{type:"node_out",name:"nE",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nE = mix ( nC , nD , le ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nE = clamp ( nE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",
k:[{type:"node_in",name:"nF",qualifier:["float"],e:!1},{type:"node_in",name:"nG",qualifier:["vec3"],e:!1},{type:"node_in",name:"nH",qualifier:["vec3"],e:!1},{type:"node_out",name:"nI",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( nF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nI = mix ( nG , nG + nH , lf ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nI = clamp ( nI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"nJ",qualifier:["float"],e:!1},{type:"node_in",name:"nK",qualifier:["vec3"],e:!1},{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_out",name:"nM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nM = mix ( nK , nK * nL , lg ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nM = clamp ( nM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"nN",qualifier:["float"],e:!1},{type:"node_in",name:"nO",qualifier:["vec3"],e:!1},{type:"node_in",name:"nP",qualifier:["vec3"],e:!1},{type:"node_out",name:"nQ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nQ = mix ( nO , nO - nP , le ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nQ = clamp ( nQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"nR",qualifier:["float"],e:!1},{type:"node_in",name:"nS",qualifier:["vec3"],e:!1},{type:"node_in",name:"nT",qualifier:["vec3"],e:!1},{type:"node_out",name:"nU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( nR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lg = UNITY_VALUE_NODES - lf ; nU = ks - ( vec3 ( lg ) + lf * ( ks - nT ) ) * ( ks - nS ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",
b:"nU = clamp ( nU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"nV",qualifier:["float"],e:!1},{type:"node_in",name:"nW",qualifier:["vec3"],e:!1},{type:"node_in",name:"nX",qualifier:["vec3"],e:!1},{type:"node_out",name:"nY",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lg = UNITY_VALUE_NODES - le ; nX += step ( nX , kr ) ; nY = lg * nW + le * nW / nX ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nY = clamp ( nY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"nZ",qualifier:["float"],e:!1},{type:"node_in",name:"n_",qualifier:["vec3"],e:!1},{type:"node_in",name:"oa",qualifier:["vec3"],e:!1},{type:"node_out",name:"ob",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( nZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ob = mix ( n_ , abs ( n_ - oa ) , lf ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ob = clamp ( ob , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"oc",qualifier:["float"],e:!1},{type:"node_in",name:"od",qualifier:["vec3"],e:!1},{type:"node_in",name:"oe",qualifier:["vec3"],e:!1},{type:"node_out",name:"of",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; of = min ( od . rgb , oe . rgb * lg ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"of = clamp ( of , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"og",qualifier:["float"],e:!1},{type:"node_in",name:"oh",qualifier:["vec3"],e:!1},{type:"node_in",name:"oi",qualifier:["vec3"],e:!1},{type:"node_out",name:"oj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( og , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oj = max ( oh . rgb , oi . rgb * le ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oj = clamp ( oj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"ok",qualifier:["float"],e:!1},{type:"node_in",name:"ol",qualifier:["vec3"],e:!1},{type:"node_in",name:"om",qualifier:["vec3"],e:!1},{type:"node_out",name:"on",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( ok , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lt = vec3 ( UNITY_VALUE_NODES - lf ) ; on = mix ( ol * ( lt + 2.0 * lf * om ) , ks - ( lt + 2.0 * lf * ( ks - om ) ) * ( ks - ol ) , step ( 0.5 , ol ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"on = clamp ( on , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"oo",qualifier:["float"],e:!1},{type:"node_in",name:"op",qualifier:["vec3"],e:!1},{type:"node_in",name:"oq",qualifier:["vec3"],e:!1},{type:"node_out",name:"or",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lu = ks - lg * oq ; lt = clamp ( op / lu , 0.0 , 1.0 ) ; or = mix ( mix ( lt , ks , step ( lu , kr ) ) , op , step ( op , kr ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"or = clamp ( or , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"os",qualifier:["float"],e:!1},{type:"node_in",name:"ot",qualifier:["vec3"],e:!1},{type:"node_in",name:"ou",qualifier:["vec3"],e:!1},{type:"node_out",name:"ov",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( os , 0.0 , 1.0 ) ; lt = vec3 ( 1.0 - le ) ; lu = lt + le * ou ; lt = clamp ( ks - ( ks - ot ) / lu , 0.0 , 1.0 ) ; ov = mix ( lt , kr , step ( lu , kr ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ov = clamp ( ov , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"ow",qualifier:["float"],e:!1},{type:"node_in",name:"ox",qualifier:["vec3"],e:!1},{type:"node_in",name:"oy",qualifier:["vec3"],e:!1},{type:"node_out",name:"oz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( ow , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oz = ox ; lu = kB ( oy ) ; if ( lu . y != ZERO_VALUE_NODES ) { lt = kB ( oz ) ; lt . x = lu . x ; lv = kF ( lt ) ; oz = mix ( oz , lv , lf ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oz = clamp ( oz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"oA",qualifier:["float"],e:!1},{type:"node_in",name:"oB",qualifier:["vec3"],e:!1},{type:"node_in",name:"oC",qualifier:["vec3"],e:!1},{type:"node_out",name:"oD",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; le = UNITY_VALUE_NODES - lg ; oD = oB ; lu = kB ( oD ) ; if ( lu . y != ZERO_VALUE_NODES ) { lv = kB ( oC ) ; lu . y = le * lu . y + lg * lv . y ; oD = kF ( lu ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oD = clamp ( oD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"oE",qualifier:["float"],e:!1},{type:"node_in",name:"oF",qualifier:["vec3"],e:!1},{type:"node_in",name:"oG",qualifier:["vec3"],e:!1},{type:"node_out",name:"oH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( oE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; le = UNITY_VALUE_NODES - lf ; lv = kB ( oF ) ; lw = kB ( oG ) ; lv . z = le * lv . z + lf * lw . z ; oH = kF ( lv ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oH = clamp ( oH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"oI",qualifier:["float"],e:!1},{type:"node_in",name:"oJ",qualifier:["vec3"],e:!1},{type:"node_in",name:"oK",qualifier:["vec3"],e:!1},{type:"node_out",name:"oL",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oL = oJ ; lx = kB ( oK ) ; if ( lx . y != ZERO_VALUE_NODES ) { lw = kB ( oL ) ; lw . x = lx . x ; lw . y = lx . y ; ly = kF ( lw ) ; oL = mix ( oL , ly , lg ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oL = clamp ( oL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"oM",qualifier:["float"],e:!1},{type:"node_in",name:"oN",qualifier:["vec3"],e:!1},{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_out",name:"oP",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lf = UNITY_VALUE_NODES - le ; lx = oO + oN - oO * oN ; oP = oN * ( vec3 ( lf ) + vec3 ( le ) * ( ( ks - oN ) * oO + lx ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oP = clamp ( oP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"oQ",qualifier:["float"],e:!1},{type:"node_in",name:"oR",qualifier:["vec3"],e:!1},{type:"node_in",name:"oS",qualifier:["vec3"],e:!1},{type:"node_out",name:"oT",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oT = oR + lg * ( 2.0 * oS - ks ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oT = clamp ( oT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"oU",qualifier:["vec3"],e:!1},{type:"node_in",name:"oV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"lp = oU ; ld = oV ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"oW",qualifier:["vec3"],e:!1},{type:"node_in",name:"oX",qualifier:["float"],e:!1},{type:"node_in",
name:"oY",qualifier:["vec3"],e:!1},{type:"node_in",name:"oZ",qualifier:["vec3"],e:!0},{type:"node_out",name:"o_",qualifier:["vec3"],e:!0},{type:"node_out",name:"pa",qualifier:["float"],e:!0},{type:"node_out",name:"pb",qualifier:["vec3"],e:!0},{type:"node_param",name:"kQ",qualifier:["const","vec2"]},{type:"node_param",name:"kR",qualifier:["const","vec3"]}],f:[{type:"textline",b:"ly = clamp ( oW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lx = kR [ 0 ] * clamp ( oY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"lz = normalize ( oZ ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lz","=","ln",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT","&&","!","NODES_GLOW"],f:[{type:"textline",b:"lA = k_ * ly ; lB = lb * u_environment_energy * kq ( lz ) ; lf = eZ ( ly ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"kU = vec2 ( kQ [ 0 ] , kQ [ 1 ] ) ; kV = vec2 ( kR [ 1 ] , kR [ 2 ] ) ; lG = jc ( lA , lB , ly , lx , lo , lz , lm , kV , kU , lf , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"lG = jh ( lA , lB , ly ) ;".split(" ")}]}]},{type:"textline",b:["lc","=","lf",";"]}]},{type:"node_else",f:[{type:"textline",b:"lG . a = vec4 ( ly , ZERO_VALUE_NODES ) ; lG . b = kr ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_o_"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"o_ = lG . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["o_","=","kr",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"o_ += lG . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pa"],f:[{type:"textline",b:"pa = clamp ( oX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pa += lG . a . a * lx . r * la ; pa = clamp ( pa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pb"],f:[{type:"textline",b:["pb","=","lz",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"lq = lG . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lq","=","kr",";"]}]}]},{type:"textline",b:["lr","=","lz",";"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_in",name:"pd",qualifier:["float"],e:!1},{type:"node_in",name:"pe",qualifier:["vec3"],e:!1},{type:"node_in",name:"pf",
qualifier:["vec3"],e:!0},{type:"node_in",name:"pg",qualifier:["float"],e:!1},{type:"node_in",name:"ph",qualifier:["float"],e:!1},{type:"node_in",name:"pi",qualifier:["vec4"],e:!1},{type:"node_in",name:"pj",qualifier:["float"],e:!1},{type:"node_in",name:"pk",qualifier:["float"],e:!1},{type:"node_out",name:"pl",qualifier:["vec3"],e:!0},{type:"node_out",name:"pm",qualifier:["float"],e:!0},{type:"node_out",name:"pn",qualifier:["vec3"],e:!0},{type:"node_out",name:"po",qualifier:["vec3"],e:!0},{type:"node_out",
name:"pp",qualifier:["vec3"],e:!0},{type:"node_param",name:"kS",qualifier:["const","vec2"]},{type:"node_param",name:"kT",qualifier:["const","vec3"]}],f:[{type:"textline",b:"lx = clamp ( pc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lC = kT [ 0 ] * clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"lD = normalize ( pf ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lD","=","ln",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT","&&","!","NODES_GLOW"],f:[{type:"textline",b:"le = eZ ( lx ) ; lE = pg * lx ; lF = lb * u_environment_energy * kq ( lD ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"kV = vec2 ( kS [ 0 ] , kS [ 1 ] ) ; kU = vec2 ( kT [ 1 ] , kT [ 2 ] ) ; lG = jc ( lE , lF , lx , lC , lo , lD , lm , kU , kV , le , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ph , pi ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"lG = jh ( lE , lF , lx ) ;".split(" ")}]}]},{type:"textline",b:["lc","=","le",";"]}]},{type:"node_else",f:[{type:"textline",b:"lG . a = vec4 ( lx , ZERO_VALUE_NODES ) ; lG . b = kr ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pl"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"pl = lG . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["pl","=","kr",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["REFLECTION_TYPE","!=","REFL_NONE"],f:[{type:"textline",b:"j_ ( pl , lm , lD , pj ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pl += lG . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pm"],f:[{type:"textline",b:"pm = clamp ( pd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pm += lG . a . a * lC . r * pk ; pm = clamp ( pm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pn"],f:[{type:"textline",b:["pn","=","lD",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_po"],f:[{type:"textline",b:"po = lG . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pp"],f:[{type:"textline",b:"pp = lG . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"lq = lG . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lq",
"=","kr",";"]}]}]},{type:"textline",b:["lr","=","lD",";"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"pq",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pq = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"pr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ps",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ps = pr . r * 0.35 + pr . g * 0.45 + pr . b * 0.2 ;".split(" ")}]},{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"pt",qualifier:["vec3"],
e:!1},{type:"node_out",name:"pu",qualifier:["float"],e:!0},{type:"node_out",name:"pv",qualifier:["float"],e:!0},{type:"node_out",name:"pw",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pu"],f:[{type:"textline",b:"pu = pt . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pv"],f:[{type:"textline",b:"pv = pt . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pw"],f:[{type:"textline",b:"pw = pt . b ;".split(" ")}]}]}]},
{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"px",qualifier:["vec3"],e:!1},{type:"node_out",name:"py",qualifier:["float"],e:!0},{type:"node_out",name:"pz",qualifier:["float"],e:!0},{type:"node_out",name:"pA",qualifier:["float"],e:!0}],f:[{type:"textline",b:"lC = kB ( px ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_py"],f:[{type:"textline",b:"py = lC . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pz"],f:[{type:"textline",b:"pz = lC . g ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pA"],f:[{type:"textline",b:"pA = lC . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"pB",qualifier:["float"],e:!1},{type:"node_in",name:"pC",qualifier:["float"],e:!1},{type:"node_in",name:"pD",qualifier:["float"],e:!1},{type:"node_out",name:"pE",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pE = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( pB - pD ) * pC ) ) ) ;".split(" ")}]},{type:"node",
name:"GAMMA",k:[{type:"node_in",name:"pF",qualifier:["vec3"],e:!1},{type:"node_in",name:"pG",qualifier:["float"],e:!1},{type:"node_out",name:"pH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pH = max ( kr , pF ) ; pH = pow ( pH , vec3 ( pG ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"pI",qualifier:["vec3"],e:!1},{type:"node_out",name:"pJ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pJ = max ( kr , pI ) ; pJ = pow ( pJ , vec3 ( 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"pK",qualifier:["vec3"],e:!1},{type:"node_out",name:"pL",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pL = max ( kr , pK ) ; pL = pow ( pL , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",k:[{type:"node_out",name:"pM",qualifier:["vec3"],e:!1},{type:"node_out",name:"pN",qualifier:["vec3"],e:!1},{type:"node_out",name:"pO",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pO = pM [ 0 ] = pM [ 1 ] = pM [ 2 ] = pN [ 0 ] = pN [ 1 ] = pN [ 2 ] = 0.0 ;".split(" ")}]},
{type:"node",name:"TEXTURE_ENVIRONMENT",k:[{type:"node_in",name:"pP",qualifier:["vec3"],e:!1},{type:"node_out",name:"pQ",qualifier:["vec3"],e:!0},{type:"node_out",name:"pR",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"kX = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , pP ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pQ"],f:[{type:"textline",b:"pQ = kX . xyz ; fV ( pQ ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pR"],f:[{type:"textline",b:"pR = kX . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"pS",qualifier:["vec3"],e:!0},{type:"node_in",name:"pT",qualifier:["vec3"],e:!0},{type:"node_in",name:"pU",qualifier:["vec3"],e:!0},{type:"node_in",name:"pV",qualifier:["vec3"],e:!0},{type:"node_out",name:"pW",qualifier:["vec3"],e:!0},{type:"node_out",name:"pX",qualifier:["float"],e:!0},{type:"node_out",name:"pY",qualifier:["vec3"],
e:!0},{type:"node_out",name:"pZ",qualifier:["float"],e:!0},{type:"node_out",name:"p_",qualifier:["vec3"],e:!0},{type:"node_out",name:"qa",qualifier:["float"],e:!0},{type:"node_out",name:"qb",qualifier:["vec3"],e:!0},{type:"node_out",name:"qc",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_COLOR_var_texture , kJ ( pS ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pW"],f:[{type:"textline",b:"pW = kX . xyz ; fV ( pW ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pX"],f:[{type:"textline",b:"pX = kX . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_COLOR_var_texture , kJ ( pT ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pY"],f:[{type:"textline",b:"pY = kX . xyz ; fV ( pY ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_pZ"],f:[{type:"textline",b:"pZ = kX . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_COLOR_var_texture , kJ ( pU ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_p_"],f:[{type:"textline",b:"p_ = kX . xyz ; fV ( p_ ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qa"],f:[{type:"textline",b:"qa = kX . w ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_uv4"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_COLOR_var_texture , kJ ( pV ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qb"],f:[{type:"textline",b:"qb = kX . xyz ; fV ( qb ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qc"],f:[{type:"textline",b:"qc = kX . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"qd",qualifier:["vec3"],e:!0},{type:"node_in",name:"qe",qualifier:["vec3"],
e:!0},{type:"node_in",name:"qf",qualifier:["vec3"],e:!0},{type:"node_in",name:"qg",qualifier:["vec3"],e:!0},{type:"node_out",name:"qh",qualifier:["vec3"],e:!0},{type:"node_out",name:"qi",qualifier:["float"],e:!0},{type:"node_out",name:"qj",qualifier:["vec3"],e:!0},{type:"node_out",name:"qk",qualifier:["float"],e:!0},{type:"node_out",name:"ql",qualifier:["vec3"],e:!0},{type:"node_out",name:"qm",qualifier:["float"],e:!0},{type:"node_out",name:"qn",qualifier:["vec3"],e:!0},{type:"node_out",name:"qo",
qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_NORMAL_var_texture , kJ ( qd ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qh"],f:[{type:"textline",b:"qh = normalize ( kY * ( kX . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qi"],f:[{type:"textline",b:"qi = kX . w ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_uv2"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_NORMAL_var_texture , kJ ( qe ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qj"],f:[{type:"textline",b:"qj = normalize ( kY * ( kX . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qk"],f:[{type:"textline",b:"qk = kX . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_NORMAL_var_texture , kJ ( qf ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ql"],f:[{type:"textline",b:"ql = normalize ( kY * ( kX . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qm"],f:[{type:"textline",b:"qm = kX . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_NORMAL_var_texture , kJ ( qg ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qn"],f:[{type:"textline",b:"qn = normalize ( kY * ( kX . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qo"],f:[{type:"textline",b:"qo = kX . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",k:[{type:"node_out",name:"qp",qualifier:["float"],e:!1}],f:[{type:"textline",b:"qp = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"qq",qualifier:["vec3"],e:!1},{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_out",name:"qs",qualifier:["vec3"],e:!1},{type:"node_out",name:"qt",qualifier:["float"],
e:!0}],f:[{type:"textline",b:"qs = qq + qr ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qt"],f:[{type:"textline",b:"qt = ( abs ( qs [ 0 ] ) + abs ( qs [ 1 ] ) + abs ( qs [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"qu",qualifier:["vec3"],e:!1},{type:"node_in",name:"qv",qualifier:["vec3"],e:!1},{type:"node_out",name:"qw",qualifier:["vec3"],e:!1},{type:"node_out",name:"qx",qualifier:["float"],e:!0}],f:[{type:"textline",
b:"qw = qu - qv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qx"],f:[{type:"textline",b:"qx = ( abs ( qw [ 0 ] ) + abs ( qw [ 1 ] ) + abs ( qw [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"qy",qualifier:["vec3"],e:!1},{type:"node_in",name:"qz",qualifier:["vec3"],e:!1},{type:"node_out",name:"qA",qualifier:["vec3"],e:!1},{type:"node_out",name:"qB",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qA = qy + qz ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qB"],f:[{type:"textline",b:"qB = length ( qA ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qA"],f:[{type:"textline",b:"qA = normalize ( qA ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"qC",qualifier:["vec3"],e:!1},{type:"node_in",name:"qD",qualifier:["vec3"],e:!1},{type:"node_out",name:"qE",qualifier:["vec3"],e:!1},{type:"node_out",name:"qF",qualifier:["float"],e:!0}],f:[{type:"textline",
b:["qE","=","kr",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qF"],f:[{type:"textline",b:"qF = dot ( qC , qD ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"qG",qualifier:["vec3"],e:!1},{type:"node_in",name:"qH",qualifier:["vec3"],e:!1},{type:"node_out",name:"qI",qualifier:["vec3"],e:!1},{type:"node_out",name:"qJ",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qI = cross ( qG , qH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_qJ"],f:[{type:"textline",b:"qJ = length ( qI ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_in",name:"qL",qualifier:["vec3"],e:!1},{type:"node_out",name:"qM",qualifier:["vec3"],e:!1},{type:"node_out",name:"qN",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qM = normalize ( qK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qN"],f:[{type:"textline",b:"qN = length ( qK ) ;".split(" ")}]}]},
{type:"textline",b:["qL",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"qO",qualifier:["vec3"],e:!1},{type:"node_in",name:"qP",qualifier:["vec3"],e:!1},{type:"node_out",name:"qQ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"qQ = reflect ( - qO , qP ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"qR",qualifier:["vec3"],e:!1},{type:"node_in",name:"qS",qualifier:["float"],e:!1},{type:"node_in",name:"qT",qualifier:["const","float"],e:!1},{type:"node_in",
name:"qU",qualifier:["const","float"],e:!1},{type:"node_out",name:"qV",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"lg = length ( kW ) ; if ( lg < qU ) { kU = kJ ( qR ) ; lh = clamp ( 0.5 * ( qU - lg ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lh = qS * lh ; lC = normalize ( lm * kY ) ; li = UNITY_VALUE_NODES / qT ; kV = lC . xy * lh / ( qT * lC . z ) ; lj = UNITY_VALUE_NODES ; lk = texture2D ( node_B4W_PARALLAX_var_texture , kU ) . a ; for ( float qW = 1.0 ; qW <= qT ; qW ++ ) { if ( lk < lj ) { lj -= li ; kU -= kV ; lk = texture2D ( node_B4W_PARALLAX_var_texture , kU ) . a ; } } kV = kU + kV ; li = texture2D ( node_B4W_PARALLAX_var_texture , kV ) . a - ( lj + li ) ; lj = lk - lj ; lj = lj / ( lj - li ) ; kU = lj * kV + ( UNITY_VALUE_NODES - lj ) * kU ; qV = kH ( kU ) ; } else qV = qR ;".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"qX",qualifier:["vec3"],e:!1},{type:"node_out",name:"qY",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"qY = clamp ( qX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"qZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"q_",qualifier:["float"],e:!1},{type:"node_out",name:"ra",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ra = kw ( qZ , q_ ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"rb",qualifier:["float"],e:!1},{type:"node_in",name:"rc",qualifier:["float"],e:!1},{type:"node_in",name:"rd",qualifier:["float"],e:!1},{type:"node_in",name:"re",qualifier:["float"],e:!1},{type:"node_in",name:"rf",qualifier:["float"],e:!1},{type:"node_out",name:"rg",qualifier:["float"],e:!0},{type:"node_out",name:"rh",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rg"],f:[{type:"textline",b:["rg","=","rb",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rh"],f:[{type:"textline",b:"rh = vec4 ( rc , rd , re , rf ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"ri",qualifier:["float"],e:!1}],f:[{type:"textline",b:["ri","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"rj",qualifier:["float"],e:!1},{type:"node_in",name:"rk",qualifier:["float"],e:!1},{type:"node_in",name:"rl",qualifier:["float"],e:!1},{type:"node_out",name:"rm",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"rm = smoothstep ( rk , rl , rj ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",k:[{type:"node_in",name:"rn",qualifier:["vec3"],e:!1},{type:"node_in",name:"ro",qualifier:["float"],e:!1}],f:[{type:"textline",b:"lp = rn ; ld = ro ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",k:[{type:"node_in",name:"rp",qualifier:["vec3"],e:!1},{type:"node_out",name:"rq",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rq = ( rp . r + rp . g + rp . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",k:[{type:"node_in",name:"rr",qualifier:["float"],e:!1},{type:"node_out",name:"rs",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rs [ 0 ] = rr ; rs [ 1 ] = rr ; rs [ 2 ] = rr ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec2 kU , kV ; vec4 kW , kX ; mat3 kY ; float kZ , k_ , la , lb , lc , ld , le , lf , lg , lh , li , lj , lk ; vec3 ll , lm , ln , lo , lp , lq , lr , ls , lt , lu , lv , lw , lx , ly , lz , lA , lB , lC , lD , lE , lF ;".split(" ")},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["ll","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kZ = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",
b:["lm","=","jD",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lm = lm ; else lm = - lm ;".split(" ")}]}}]},{type:"textline",b:"ln = normalize ( lm ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"lo = cross ( lm , jE . xyz ) * jE . w ; kY = mat3 ( jE . xyz , lo , lm ) ; kY = kY ;".split(" ")}]}}]},{type:"textline",b:"lo = u_camera_eye_frag - jC ; lm = normalize ( lo ) ; lo = jC ; kW = cJ ; k_ = u_emit ; la = u_specular_alpha ; lb = u_ambient ; gO lG ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"lC = lp ; li = ld ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lC = max ( lC - sqrt ( 0.01 * - min ( kZ , ZERO_VALUE_NODES ) ) , 0.5 * lC ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"jA ( lC , kZ , u_time , lc , lr , u_sun_direction , ll , u_sun_quaternion , jC , length ( cJ ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"lj = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"lp = gm ( u_cube_fog , lm ) ; kX = vec4 ( lp , u_fog_color_density . a ) ; fV ( kX . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kX = u_fog_color_density ; kX . rgb *= lj ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"gC ( lC , length ( cJ ) , lm , u_cam_water_depth , u_underwater_fog_color_density , kX , kZ , lj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( lC , length ( cJ ) , kX ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"if ( li < 0.5 ) discard ; li = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"kV = texture2DProj ( u_shadow_mask , cI ) . rg ; ld = kV . g ; lC = vec3 ( ld ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","lC",")",";"]},{type:"condition",a:[{type:"if",c:"ALPHA && ! ALPHA_CLIP || NODES_GLOW".split(" "),group:{type:"group",a:[{type:"textline",
b:"f_ ( lC , li ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lC , li ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",
";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 jC ; varying vec4 cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec3","jD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION",
"&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"kK",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["kK","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"kP",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["kP","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"kQ",qualifier:["varying","float"]}],f:[{type:"textline",b:["kQ","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"kR",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["kR","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"kS",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["kS","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec4 kT ; float kU , kV , kW ; mat4 kX ; vec3 kY , kZ , k_ , la , lb , lc , ld ; kY = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kZ = a_normal ; k_ = vec3 ( a_tangent ) ; la = a_tangent [ 3 ] * cross ( kZ , k_ ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",
b:"kZ = a_normal ; k_ = vec3 ( 0.0 ) ; la = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kZ = vec3 ( 0.0 ) ; k_ = vec3 ( 0.0 ) ; la = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kY = mix ( kY , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"kZ = mix ( kZ , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"lb = vec3 ( a_tangent ) ; lc = a_tangent_next [ 3 ] * cross ( a_normal_next , lb ) ; k_ = mix ( k_ , lb , u_va_frame_factor ) ; la = mix ( la , lc , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bv ( kY , k_ , la , kZ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["lb","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"lc = ( u_model_matrix * vec4 ( lb , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],
group:{type:"group",a:[{type:"textline",b:"kX = ao ( u_camera_eye , lc , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kX = ai ( u_camera_eye , lc , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"ld = ( u_model_matrix * vec4 ( lb , 1.0 ) ) . xyz ; kX = kX * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ld ) ;".split(" ")}]}}]},
{type:"textline",b:"d le = av ( kY - lb , lb , k_ , la , kZ , kX ) ; le . b = lc ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d le = av ( kY , lb , k_ , la , kZ , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( le . a , le . b , kZ ) ;".split(" ")}]}}]},{type:"textline",b:"jC = le . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"jD = le . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kU = ( dot ( cross ( le . e , le . c ) , le . d ) < 0.0 ) ? - 1.0 : 1.0 ; jE = vec4 ( le . c , kU ) ;".split(" ")}]}}]},{type:"textline",b:"cJ = u_view_matrix * vec4 ( le . a , 1.0 ) ; kT = u_proj_matrix * cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"kT . xy += u_subpixel_jitter * kT . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["fO","(","kT",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( le . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:"kU = kT . x ; kV = kT . y ; kW = kT . w ; cI . x = ( kU + kW ) / 2.0 ; cI . y = ( kV + kW ) / 2.0 ; cI . z = kW ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jG = - cJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","kT",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float kT ; varying vec3 jF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cJ",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 kU ; float kV ; kV = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; kV = smoothstep ( u_p_alpha_start , u_p_alpha_end , kV ) ; kV = u_diffuse_color . a * kT * ( 1.0 - clamp ( kV , 0.0 , 1.0 ) ) ; kU = jF * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gg ( kU , length ( cJ ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","kU",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kU , kV ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kU , kV ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float kT ; varying vec3 jF ; varying vec3 cJ ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float lG ; vec4 lH ; kU lI ; lI = lF ( ) ; lH = u_view_matrix * vec4 ( lI . b , 1.0 ) ; gl_Position = u_proj_matrix * lH ; kT = lI . c ; jF = lI . d ; cJ = lH . xyz ; lG = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = lI . a * lG ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",
a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float kT ; varying vec3 jF ; varying vec2 a ; varying vec3 jB ; varying vec3 jC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec2 kr ; float ks ; vec3 kt , ku , kv , kw , kx , ky ; vec4 kz , kA ; kz = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"kA = texture2D ( u_sampler , a ) ; fV ( kA . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"kz . rgb = mix ( kz . rgb , kA . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"kz . rgb *= mix ( vec3 ( 1.0 ) , kA . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"kz . a = kA . a ;".split(" ")}]}}]},{type:"textline",b:"kz . rgb *= jF ; kt = u_diffuse_intensity * kz . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"ku = u_emit * kz . rgb ; kv = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_ENVIRONMENT_LIGHT && ! SKY_TEXTURE && SKY_COLOR".split(" "),group:{type:"group",a:[{type:"textline",b:"kw = u_environment_energy * kq ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kw = u_environment_energy * kq ( kv ) ;".split(" ")}]}}]},{type:"textline",
b:"kw = u_ambient * kw ; ks = u_specular_params [ 0 ] ; kr = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; kx = ks * u_specular_color ; ky = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO kB = jc ( ku , kw , kt , kx , jC , kv , ky , kr , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"gO kB = jh ( ku , kw , kt ) ;".split(" ")}]}}]},{type:"textline",b:"kx = kB . a . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kx","=","kt",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gg ( kx , length ( cJ ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"ks = kz . a * kT ; fX ( kx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&",
"!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kx , ks ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kx , ks ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",
b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float kT ; varying vec3 jF ; varying vec2 a ; varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float kt ( vec2 kr , vec2 ks ) { return ( atan ( ks . y , ks . x ) - atan ( kr . y , kr . x ) ) ; } void main ( ) { vec4 ku , kv , kw ; mat4 kx ; float ky ; kU kz ; kz = lF ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { ky = kz . e ; kx = N ( kz . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { ky = kz . e ; kx = x ( ) ; kx [ 3 ] = vec4 ( kz . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { ky = kz . e ; kx = B ( radians ( 90.0 ) ) ; kx [ 3 ] = vec4 ( kz . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { ky = kt ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + kz . e ; kx = z ( radians ( - 90.0 ) ) ; kx [ 3 ] = vec4 ( kz . b , 1.0 ) ; } ku = vec4 ( a_p_bb_vertex * 2.0 * kz . a * u_p_size , 0.0 , 1.0 ) ; ku = kx * D ( ky ) * ku ; kv = u_view_matrix * ku ; kw = u_proj_matrix * kv ; gl_Position = kw ; kT = kz . c ; jF = kz . d ; a = a_p_bb_vertex + 0.5 ; jC = ku . xyz ; jB = u_camera_eye - ku . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cJ","=","kv",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 lG ; const float lH = 0.99 ; const float lI = 1.8 ; const int lJ = 8 ; float lP ( vec3 lK , vec3 lL ) { float lM , lN , lO ; lM = dot ( lL , lL ) ; lN = 2.0 * dot ( lL , lK ) ; lO = dot ( lK , lK ) - 1.0 ; lM = lN * lN - 4.0 * lM * lO ; lM = sqrt ( lM ) ; lN = ( - lN - lM ) / 2.0 ; lM = lO / lN ; return lM ; } float lW ( float lQ , float lR ) { float lS , lT , lU , lV ; lS = 3.0 * ( 1.0 - lR * lR ) ; lT = 2.0 * ( 2.0 + lR * lR ) ; lU = 1.0 + lQ * lQ ; lV = pow ( 1.0 + lR * lR - 2.0 * lR * lQ , 1.5 ) ; lV = max ( lV , 0.00001 ) ; return ( lS / lT ) * ( lU / lV ) ; } float mb ( vec3 lX , vec3 lY , float lZ ) { vec3 l_ ; float ma ; ma = dot ( lY , - lX ) ; if ( ma < 0.0 ) { return 1.0 ; } l_ = lX + ma * lY ; if ( length ( l_ ) < lZ ) { return 0.0 ; } else if ( length ( l_ ) >= lZ ) { l_ = normalize ( l_ ) * lZ - lX ; ma = acos ( dot ( normalize ( l_ ) , lY ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( ma * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 mf ( float mc , vec3 md , float me ) { return md - md * pow ( u_sky_color , vec3 ( me / mc ) ) ; } void main ( ) { float mg , mh , mi , mj , mk , ml , mm , mn , mo ; vec3 mp , mq , mr , ms , mt , mu , mv ; mp = normalize ( lG ) ; mq = u_sun_direction ; mg = dot ( mp , mq ) ; mh = lW ( mg , - 0.01 ) * u_rayleigh_brightness * mq . y ; mi = lW ( mg - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - mq . y ) ; mg = smoothstep ( 0.0 , 100.0 , lW ( mg , 0.9995 ) ) * u_spot_brightness ; mr = vec3 ( 0.0 , lH , 0.0 ) ; mj = lP ( mr , mp ) ; mk = mj / float ( lJ ) ; ml = mb ( mr , mp , lH - 0.3 ) ; ms = vec3 ( 0.0 , 0.0 , 0.0 ) ; mt = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int mw = 0 ; mw < lJ ; mw ++ ) { mm = mk * float ( mw ) ; mu = mr + mp * mm ; mn = mb ( mu , mq , lH - 0.2 ) ; mo = lP ( mu , mq ) ; mv = mf ( mo , vec3 ( lI ) , u_scatter_strength ) * mn ; ms += mf ( sqrt ( mm ) , u_sky_color * mv , u_rayleigh_strength ) ; mt += mf ( mm , mv , u_mie_strength ) ; } ms = ms * ml * pow ( mj , u_rayleigh_collection_power ) / float ( lJ ) ; mt = ( mt * ml * pow ( mj , u_mie_collection_power ) ) / float ( lJ ) ; mt = vec3 ( mg * mt + mi * mt + mh * ms ) ; fX ( mt ) ; gl_FragColor = vec4 ( mt , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 lG ; void main ( ) { vec4 kr , ks ; kr = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; ks = u_cube_view_matrix * kr ; lG = ks . xyz ; gl_Position = kr ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 kr ; kr = texture2D ( u_sampler , a ) ; fX ( kr . rgb ) ; f_ ( kr . rgb , kr . a ) ; gl_FragColor = kr ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { vec2 kr ; float ks ; vec4 kt ; vec3 ku ; a = a_texcoord ; ku = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; kt = u_proj_matrix * u_view_matrix * vec4 ( ku , 0.0 ) ; kt . x /= kt . w ; kt . y /= kt . w ; kt += 99999.0 * step ( kt . z , 0.0 ) ; kt += 100.0 * ( step ( 1.0 , abs ( kt . x ) ) + step ( 1.0 , abs ( kt . y ) ) ) ; kt . x = - a_lf_dist * kt . x ; kt . y = - a_lf_dist * kt . y ; ks = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; kr = vec2 ( a_lf_bb_vertex . x / ks , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float kv = 1.9 ; kr *= ( 1.0 + kv * length ( kt . xy ) ) ; } gl_Position = vec4 ( kt . xy + kr , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","||","PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","PROCEDURAL_SKYDOME","&&","WO_SKYTEX"],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},
{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_world_vec",";"]}]}}]},{type:"textline",b:"vec3 kw ( vec3 kr , vec3 ks , float kt , float ku ) { float kv ; kv = kt * ku ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","==","MTEX_BLEND"],group:{type:"group",a:[{type:"textline",
b:"return lX ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_ADD"],group:{type:"group",a:[{type:"textline",b:"return ma ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SUB"],group:{type:"group",a:[{type:"textline",b:"return me ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_MUL"],group:{type:"group",a:[{type:"textline",b:"return mj ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SCREEN"],group:{type:"group",
a:[{type:"textline",b:"return mo ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_OVERLAY"],group:{type:"group",a:[{type:"textline",b:"return mt ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DIFF"],group:{type:"group",a:[{type:"textline",b:"return mx ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DIV"],group:{type:"group",a:[{type:"textline",b:"return mB ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==",
"MTEX_DARK"],group:{type:"group",a:[{type:"textline",b:"return mF ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_LIGHT"],group:{type:"group",a:[{type:"textline",b:"return mJ ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_BLEND_HUE"],group:{type:"group",a:[{type:"textline",b:"return mP ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_BLEND_SAT"],group:{type:"group",a:[{type:"textline",b:"return mV ( ks , kr , kv ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","==","MTEX_BLEND_VAL"],group:{type:"group",a:[{type:"textline",b:"return na ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_BLEND_COLOR"],group:{type:"group",a:[{type:"textline",b:"return ng ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SOFT_LIGHT"],group:{type:"group",a:[{type:"textline",b:"return nl ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_LIN_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"return np ( ks , kr , kv ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float kE ( float kx , float ky , float kz , float kA ) { float kB ; vec3 kC , kD ; kC = vec3 ( kx ) , kD = vec3 ( ky ) ; kB = kz * kA ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","==","MTEX_BLEND"],group:{type:"group",a:[{type:"textline",b:"return lX ( kD , kC , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_ADD"],group:{type:"group",a:[{type:"textline",b:"return ma ( kC , kD , kB ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","==","MTEX_SUB"],group:{type:"group",a:[{type:"textline",b:"return me ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_MUL"],group:{type:"group",a:[{type:"textline",b:"return nv ( kx , ky , kB , kA ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SCREEN"],group:{type:"group",a:[{type:"textline",b:"return nB ( kx , ky , kB , kA ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_OVERLAY"],group:{type:"group",a:[{type:"textline",
b:"return nH ( kx , ky , kB , kA ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DIFF"],group:{type:"group",a:[{type:"textline",b:"return mx ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DIV"],group:{type:"group",a:[{type:"textline",b:"return mB ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DARK"],group:{type:"group",a:[{type:"textline",b:"return mF ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_LIGHT"],
group:{type:"group",a:[{type:"textline",b:"return mJ ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SOFT_LIGHT"],group:{type:"group",a:[{type:"textline",b:"return nl ( kD , kC , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_LIN_LIGHT"],group:{type:"group",a:[{type:"textline",b:"return np ( kD , kC , kB ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["!","PROCEDURAL_SKYDOME"],group:{type:"group",
a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","lG",";"]},{type:"condition",a:[{type:"if",c:"! PROCEDURAL_SKYDOME && ( WO_SKYTEX || WO_SKYBLEND )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 kF ; float kG , kH , kI ; vec3 kJ , nI , nJ , nK , nL ; nI = normalize ( lG ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"kJ = textureCube ( u_sky , nI ) . rgb ;".split(" ")}]}},{type:"elif",c:"! ( WO_SKYTEX || WO_SKYBLEND )".split(" "),group:{type:"group",a:[{type:"textline",b:"kJ = u_horizon_color ; fX ( kJ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"nJ = vec3 ( a , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nJ = normalize ( vec3 ( a , 1.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"kG = abs ( a . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kG = ( a . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kH = acos ( nI . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"kG = abs ( kH * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kG = 1.0 - kH * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},
{type:"textline",b:"nK = u_horizon_color ; nL = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"kH = 1.0 ; kF = textureCube ( u_sky , nI ) ; fV ( kF . rgb ) ; kH = kF . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"kH = dot ( kF . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["!","MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"kF = vec4 ( vec3 ( 1.0 ) - kF . rgb , kF . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kH = 1.0 - kH ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ","||","WOMAP_ZENUP","||","WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"kF = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kH = kF . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"nK = kw ( kF . rgb , nK , kH , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP","||","WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:["kI","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( nJ , u_world_vec ) >= 0.0 ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"kI = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"else kI = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",
b:"kI = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"kI = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( kI != 0.0 ) nL = kw ( kF . rgb , nL , kH , kI ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_BLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["!","MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"kH = dot ( kF . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"kG = kE ( u_sky_tex_dvar , kG , kH , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"kJ = mix ( nK , nL , kG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kJ","=","nK",";"]}]}}]},{type:"textline",b:["fX","(","kJ",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"fX ( nK ) ; fX ( nL ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],
group:{type:"group",a:[{type:"textline",b:"kJ = mix ( nK , nL , kG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kJ","=","nK",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"fV ( kJ ) ; kI = u_camera_eye_frag . y - WATER_LEVEL ; kI = min ( - kI * 0.03 , 0.8 ) ; kH = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; nJ = vec3 ( 0.0 ) ; kF = u_underwater_fog_color_density ; kF . rgb = mix ( kF . rgb , nJ , min ( - nI . y + kI , 1.0 ) ) * kH ; kG = clamp ( sign ( nI . y - 0.05 * kI ) , 0.0 , 1.0 ) ; kJ = mix ( kF . rgb , kJ , kG ) ; fX ( kJ ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( kJ , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 lG ;".split(" ")},{type:"condition",a:[{type:"if",c:"! PROCEDURAL_SKYDOME && ( WO_SKYTEX || WO_SKYBLEND )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 kr , ks ; kr = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; ks = u_sky_vp_inverse * kr ; lG = ks . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:"! PROCEDURAL_SKYDOME && ( WO_SKYTEX || WO_SKYBLEND )".split(" "),group:{type:"group",a:[{type:"textline",b:"a = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","kr",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube",
"u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || WATER_EFFECTS".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform",
"float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float kr = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:"( NUM_NORMALMAPS > 0 || FOAM ) && ! GENERATED_MESH".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","jD",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jE ; varying vec3 nI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nK",";"]}]}}]},{type:"condition",a:[{type:"if",
c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nL",";"]}]}}]},{type:"include",
file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING","&&","USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 nX ( in vec2 nM , in vec3 nN , in vec3 nO , in vec3 nP , out float nQ ) { float nR , nS , nT ; vec2 nU ; vec3 nV , nW ; nV = reflect ( - nO , nN ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:"nU = nM . xy + nN . xz * REFL_BUMP / jG ; nQ = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"nW = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nW = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"nR = dot ( nO , nN ) ; nQ *= max ( 1.0 - 1.0 / nR , 1.0 ) ; } else { nW = texture2D ( u_plane_reflection , nU ) . rgb ; fV ( nW ) ; }".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],
group:{type:"group",a:[{type:"textline",b:"nQ = u_mirror_factor ; nW = nP * textureCube ( u_mirrormap , nV ) . rgb ; fV ( nW ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nQ = u_reflect_factor ; nW = nP * vec3 ( 0.3 , 0.5 , 1.0 ) ; fV ( nW ) ;".split(" ")}]}}]},{type:"textline",b:"nV = normalize ( nV + nO ) ; nR = 1.0 - dot ( nO , nV ) ; nS = u_fresnel_params [ 3 ] ; nT = u_fresnel_params [ 2 ] ; nS = nS + ( 1.0 - nS ) * pow ( nR , nT ) ; nQ = min ( nQ * nS , 1.0 ) ; return nW ; } void main ( ) { vec4 nY ; vec2 nZ , n_ , oa ; float ob , oc , od , oe , of , og ; vec3 oh , oi , oj , ok , ol , om , on ; mat3 oo ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"oo = mat3 ( jE , nI , jD ) ;".split(" ")}]}}]},{type:"textline",b:"oh = normalize ( jD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"oo = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"oh = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"ob = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0","||","FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nZ = vec2 ( nJ . x , - nJ . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"nZ = vec2 ( jC . x , - jC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nZ","=","a",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"oi = vec3 ( 0.0 ) ; oj = texture2D ( u_normalmap0 , nZ * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; oi += oj ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"ok = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["ok","+=","oj",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"oj = texture2D ( u_normalmap0 , nZ * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; oi += oj ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["ok","+=","oj",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"oj = texture2D ( u_normalmap0 , nZ * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; oi += oj ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["ok","+=","oj",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"oj = texture2D ( u_normalmap0 , nZ * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; oi += oj ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",
a:[{type:"textline",b:["ok","+=","oj",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"oj = oo * ok ; if ( ! g ( oj , vec3 ( 0.0 ) ) ) oj = normalize ( oj ) ; ok = mix ( oh , oj , 0.2 ) ; ok = normalize ( ok ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"oh = mix ( oh , normalize ( oo * oi ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"oh = mix ( oh , normalize ( oo * oi ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"oh = normalize ( oh ) ;".split(" ")}]}}]},{type:"textline",b:"oj = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"n_ = cI . xy / cI . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",
a:[{type:"textline",b:"oc = jG * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"od = u_diffuse_color . a ; nY = texture2DProj ( u_scene_depth , cI ) ; oe = cu ( nY ) ; of = max ( oe - jG , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"oa = n_ + oh . xz * u_refr_bump / jG ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],
group:{type:"group",a:[{type:"textline",b:"og = kf ( oe , oa , n_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"oa = n_ ; og = oe ;".split(" ")}]}}]},{type:"textline",b:"oe = max ( og - jG , 0.0 ) ; og = u_view_max_depth / ABSORB * oe ; if ( u_cam_water_depth < 0.0 ) oe = 0.0 ; else oe = min ( od * og , 1.0 ) ; og = u_view_max_depth / ABSORB * of ; od = min ( 15.0 * od * u_view_max_depth * of , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"og = u_view_max_depth / ABSORB * of ; if ( u_cam_water_depth > 0.0 ) od = min ( od * og , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"od *= min ( 5.0 * oc , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"od = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"oe = 1.0 - od ; oa = n_ + oh . xz * REFR_BUMP / jG ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",
a:[{type:"textline",b:"oi = texture2D ( u_refractmap , oa ) . rgb ; fV ( oi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"og = pow ( min ( nK . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; ol = mix ( u_shallow_water_col , u_diffuse_color . rgb , og ) ; og = pow ( min ( nK . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; ol = mix ( u_shore_water_col , ol , og ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"ol = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"og = max ( 1.0 - u_view_max_depth * of , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"og = 1.0 - od ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"of = max ( ob / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"om = normalize ( vec3 ( nK . r , 0.0 , nK . g ) ) ; om = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , om , 0.8 ) ) ; ob = 1.25 * max ( dot ( ok , om ) - 0.2 , 0.0 ) ; ob += max ( dot ( ok , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; og += ob * ( 1.0 - nK . b ) ; of *= ( 1.0 - 0.95 * pow ( nK . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"og += of ; og = min ( u_foam_factor * og , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"nY = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + nZ * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"ob = u_specular_params [ 0 ] ; oa = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; om = ob * u_specular_color ; ok = u_environment_energy * kq ( oh ) ; ok = u_ambient * ok ; ok = ok + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:"on = nX ( n_ , oh , oj , ok , of ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"on = nX ( vec2 ( 0.0 ) , oh , oj , ok , of ) ;".split(" ")}]}}]},{type:"textline",b:"ol = u_diffuse_intensity * ol ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO op = jc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ol , om , jC , oh , oj , oa , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gO op = jh ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ol ) ;".split(" ")}]}}]},{type:"textline",b:"ol = op . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"ob = max ( dot ( u_sun_direction , - jD ) + SSS_WIDTH , 0.0 ) * max ( dot ( - oj , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; ob = clamp ( SSS_STRENGTH * ob , 0.0 , 1.0 ) ; ol = mix ( ol , u_shallow_water_col , ob ) ; ol = mix ( ol , u_shore_water_col , ob ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ol = mix ( oi , ol , oe ) ;".split(" ")}]}}]},{type:"textline",b:"ol = mix ( ol , on , of ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"ob = mix ( nY . g , nY . r , max ( 4.0 * ( og - 0.75 ) , 0.0 ) ) ; ob = mix ( nY . b , ob , max ( 2.0 * og - 1.0 , 0.0 ) ) ; ob = mix ( 0.0 , ob , og ) ; ol = mix ( ol , ok , ob ) ;".split(" ")}]}}]},{type:"textline",
b:"ol += op . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"om = gm ( u_cube_fog , oj ) ; nY = vec4 ( om , u_fog_color_density . a ) ; fV ( nY . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nY","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"if ( u_cam_water_depth < 0.0 ) { gK ( ol , oc , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gg ( ol , oc , nY ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( ol , oc , nY ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["fX","(","ol",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"od = max ( od , op . b . r ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["od","+=","ob",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"f_ ( ol , od ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"oh = fwidth ( nL ) ; oi = smoothstep ( vec3 ( 0.0 ) , oh * kr , nL ) ; oe = min ( min ( oi . x , oi . y ) , oi . z ) ; oe = clamp ( oe , 0.0 , 1.0 ) ; ol = mix ( u_wireframe_edge_color , ol , oe ) ; od = mix ( 1.0 , od , oe ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( ol , od ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",
b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},
{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:"! GENERATED_MESH && ( NUM_NORMALMAPS > 0 || FOAM )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jE ; varying vec3 nI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nJ",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 kw ( in vec2 kr ) { float ks ; vec4 kt ; vec2 ku ; ku = 0.5 + vec2 ( ( kr . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( kr . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; kt = texture2D ( u_shore_dist_map , ku ) ; const vec2 kv = vec2 ( 1.0 / 255.0 , 1.0 ) ; ks = dot ( kt . ba , kv ) ; ku = normalize ( kt . rg * 2.0 - 1.0 ) ; return vec3 ( ku , ks ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void kI ( inout vec3 kx , in float ky , in vec3 kz ) { vec2 kA , kB , kC ; float kD , kE , kF , kG , kH ; kD = dx ( DST_NOISE_SCALE_0 * ( kx . xz + DST_NOISE_FREQ_0 * ky ) ) * dx ( DST_NOISE_SCALE_1 * ( kx . zx - DST_NOISE_FREQ_1 * ky ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"kE = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; kF = kz . b ; kG = sqrt ( kF ) ; kE = max ( kF , DIR_MIN_SHR_FAC ) * sin ( kG / kE + DIR_FREQ * ky ) ; kH = max ( dx ( DIR_NOISE_SCALE * ( kx . xz + DIR_NOISE_FREQ * ky ) ) , DIR_MIN_NOISE_FAC ) ; kE *= kH ; kH = WAVES_HEIGHT * mix ( kE , kD , max ( kG , DST_MIN_FAC ) ) ; kA = kz . rg ; kG = WAVES_HOR_FAC * kE * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - kF ) , 0.0 ) ; kA = kG * kA ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"kH = WAVES_HEIGHT * kD ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"kB = 2.0 * ( kx . xz - 0.1 * ky ) ; kC = 1.3 * ( kx . zx + 0.03 * ky ) ; kE = da ( 0.5 * kB ) . x + da ( 0.5 * kC ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"kx . xz += kA ; kE *= kF ;".split(" ")}]}}]},{type:"textline",b:"kH += SMALL_WAVES_FAC * kE ;".split(" ")}]}}]},{type:"textline",
b:"kx . y += kH ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 kJ , nM ; vec2 nN ; float nO , nP , nQ ; vec3 nR , nS , nT , nU ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) nL = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) nL = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) nL = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["nR","=","a_position",";"]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"nO = abs ( nR . y ) ; nN = u_camera_eye . xz - mod ( u_camera_eye . xz , nO ) ; nR . y = WATER_LEVEL ; nR . xz += nN ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",">","0","||","FOAM"],group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d nV = av ( nR , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DYNAMIC","&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"nJ = nV . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"nK = kw ( nV . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nP = length ( u_wind ) ; nQ = u_time ; nQ *= nP ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",
b:["nP","=","nO",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nP","=","0.1",";"]}]}}]},{type:"textline",b:"nR = nV . a + vec3 ( nP , 0.0 , 0.0 ) ; nS = nV . a + vec3 ( 0.0 , 0.0 , nP ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"nT = kw ( nR . xz ) ; nU = kw ( nS . xz ) ; kI ( nR , nQ , nT ) ; kI ( nS , nQ , nU ) ; kI ( nV . a , nQ , nK ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kI ( nR , nQ , vec3 ( 0.0 ) ) ; kI ( nS , nQ , vec3 ( 0.0 ) ) ; kI ( nV . a , nQ , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { nV . a . y = WATER_LEVEL - 1.0 ; nR . y = nV . a . y ; nS . y = nV . a . y ; }".split(" ")}]}}]},{type:"textline",b:"nT = normalize ( nR - nV . a ) ; nU = normalize ( nS - nV . a ) ; jD = normalize ( cross ( nU , nT ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"jE = nU ; nI = cross ( jD , jE ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"nO = dot ( jD , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; nP = clamp ( 0.8 - nO , 0.0 , 1.0 ) ; jD = mix ( jD , vec3 ( 0.0 , 1.0 , 0.0 ) , nP ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"jC = nV . a ; jB = u_camera_eye - nV . a ; kJ = u_view_matrix * vec4 ( nV . a , 1.0 ) ; nM = u_proj_matrix * kJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:"nQ = nM . x ; nO = nM . y ; nP = nM . w ; cI . x = ( nQ + nP ) / 2.0 ; cI . y = ( nO + nP ) / 2.0 ; cI . z = nP ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"jG = - kJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","nM",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",
name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 nL ; const float kr = 1.0 ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 ks = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 ks = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 kt = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 ku = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 kv = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float kw , kx ; vec3 ky , kz ; ky = vec3 ( 0.0 ) ; kw = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"kz = sign ( nL - vec3 ( 0.02 * kr ) ) ; if ( kz . x < 0.0 || kz . y < 0.0 || kz . z < 0.0 ) { ky = ks ; kw = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"kz = sign ( nL - vec3 ( 0.02 * kr ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( kz . x < 0.0 || kz . y < 0.0 || kz . z < 0.0 ) ky = u_wireframe_edge_color ; else ky = kv ; kw = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( kz . x < 0.0 || kz . y < 0.0 || kz . z < 0.0 ) kw = 1.0 ; else kw = 0.0 ; ky = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( kz . x < 0.0 || kz . y < 0.0 || kz . z < 0.0 ) ky = u_wireframe_edge_color ; else if ( gl_FrontFacing ) ky = kt ; else ky = ku ; kw = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"kz = fwidth ( nL ) ; kz = smoothstep ( vec3 ( 0.0 ) , kz * kr , nL ) ; kx = min ( min ( kz . x , kz . y ) , kz . z ) ; kx = clamp ( kx , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { ky = vec3 ( mix ( u_wireframe_edge_color , kv , kx ) ) ; kw = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { ky = u_wireframe_edge_color ; kw = mix ( 1.0 , 0.0 , kx ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) ky = mix ( u_wireframe_edge_color , kt , kx ) ; else ky = mix ( u_wireframe_edge_color , ku , kx ) ; kw = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["fX","(","ky",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"f_ ( ky , kw ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ky , kw ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["varying","vec3","nL",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 kr ; mat4 ks ; vec3 kt , ku , kv , kw , kx ; if ( a_polyindex == 0.0 ) nL = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) nL = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) nL = vec3 ( 0.0 , 0.0 , 1.0 ) ; kt = a_position ; ku = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d ky = av ( kt , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kt = mix ( kt , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"kv = vec3 ( 0.0 ) ; kw = vec3 ( 0.0 ) ; bv ( kt , kv , kw , ku ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["kv","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kv = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d ky = fE ( kt , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , kv , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"kw = ( u_model_matrix * vec4 ( kv , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"ks = ao ( u_camera_eye , kw , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ks = ai ( u_camera_eye , kw , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"kx = ( u_model_matrix * vec4 ( kv , 1.0 ) ) . xyz ; ks = ks * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kx ) ;".split(" ")}]}}]},{type:"textline",b:"d ky = av ( kt - kv , kv , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ks ) ; ky . b = kw ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d ky = av ( kt , kv , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( ky . a , ky . b , ku ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kr = u_view_matrix * vec4 ( ky . a , 1.0 ) ; gl_Position = u_proj_matrix * kr ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 kr , ks ; kr = texture2D ( u_sampler_left , a ) ; ks = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( kr [ 0 ] , ks [ 1 ] , ks [ 2 ] , kr [ 3 ] + ks [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 ku ( float kr , float ks ) { vec2 kt ; kt = a + vec2 ( kr , ks ) * u_texel_size ; return texture2D ( u_color , kt ) ; } float ky ( vec4 kv ) { float kw ; vec3 kx ; kx = vec3 ( 0.299 , 0.587 , 0.114 ) ; kw = dot ( kv . rgb , kx ) ; return kw ; } vec4 nN ( ) { vec2 kz ; float kA , kB , kC , kD , kE , kF ; vec4 kG , kH , kI , kJ , nM ; kG = ku ( - 1.0 , - 1.0 ) ; kH = ku ( 1.0 , - 1.0 ) ; kI = ku ( - 1.0 , 1.0 ) ; kJ = ku ( 1.0 , 1.0 ) ; nM = ku ( 0.0 , 0.0 ) ; kA = ky ( kG ) ; kB = ky ( kH ) ; kC = ky ( kI ) ; kD = ky ( kJ ) ; kE = ky ( nM ) ; kF = min ( kE , min ( min ( kA , kB ) , min ( kC , kD ) ) ) ; kE = max ( kE , max ( max ( kA , kB ) , max ( kC , kD ) ) ) ; kz . x = - ( ( kA + kB ) - ( kC + kD ) ) ; kz . y = ( ( kA + kC ) - ( kB + kD ) ) ; kA = max ( ( kA + kB + kC + kD ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; kB = 1.0 / ( min ( abs ( kz . x ) , abs ( kz . y ) ) + kA ) ; kz = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , kz * kB ) ) * u_texel_size ; kG = 0.5 * ( texture2D ( u_color , a + kz * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + kz * ( 2.0 / 3.0 - 0.5 ) ) ) ; kH = kG * 0.5 + 0.25 * ( texture2D ( u_color , a + kz * - 0.5 ) + texture2D ( u_color , a + kz * 0.5 ) ) ; kC = ky ( kH ) ; if ( ( kC < kF ) || ( kC > kE ) ) return kG ; else return kH ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 or ( ) { bool nO , nP , nQ , nR , nS ; float nT , nU , nV , nW , nX , nY , nZ , n_ , oa , ob , oc , od , oe , of , og ; vec4 oh , oi , oj , ok , ol ; vec2 om , on , oo , op , oq ; om . x = a . x ; om . y = a . y ; oh = texture2D ( u_color , om ) ; oi = ku ( 0.0 , 1.0 ) ; oj = ku ( 1.0 , 0.0 ) ; ok = ku ( 0.0 , - 1.0 ) ; ol = ku ( - 1.0 , 0.0 ) ; nT = ky ( oi ) ; nU = ky ( oj ) ; nV = ky ( ok ) ; nW = ky ( ol ) ; nX = ky ( oh ) ; nY = max ( nT , nX ) ; nZ = min ( nT , nX ) ; nY = max ( nU , nY ) ; nZ = min ( nU , nZ ) ; n_ = max ( nV , nW ) ; oa = min ( nV , nW ) ; n_ = max ( n_ , nY ) ; nY = min ( oa , nZ ) ; oa = n_ * FXAA_QUALITY_EDGE_THRESHOLD ; nZ = n_ - nY ; n_ = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , oa ) ; nO = nZ < n_ ; if ( nO ) return oh ; oi = ku ( - 1.0 , - 1.0 ) ; oj = ku ( 1.0 , 1.0 ) ; ok = ku ( 1.0 , - 1.0 ) ; ol = ku ( - 1.0 , 1.0 ) ; nY = ky ( oi ) ; oa = ky ( oj ) ; n_ = ky ( ok ) ; ob = ky ( ol ) ; oc = nV + nT ; od = nW + nU ; nZ = 1.0 / nZ ; oe = oc + od ; oc = ( - 2.0 * nX ) + oc ; od = ( - 2.0 * nX ) + od ; of = n_ + oa ; n_ = nY + n_ ; og = ( - 2.0 * nU ) + of ; n_ = ( - 2.0 * nV ) + n_ ; nY = nY + ob ; ob = ob + oa ; oa = ( abs ( oc ) * 2.0 ) + abs ( og ) ; oc = ( abs ( od ) * 2.0 ) + abs ( n_ ) ; og = ( - 2.0 * nW ) + nY ; od = ( - 2.0 * nT ) + ob ; n_ = abs ( og ) + oa ; ob = abs ( od ) + oc ; og = nY + of ; oa = u_texel_size . x ; nO = n_ >= ob ; od = oe * 2.0 + og ; if ( ! nO ) nV = nW ; if ( ! nO ) nT = nU ; if ( nO ) oa = u_texel_size . y ; oc = ( od * ( 1.0 / 12.0 ) ) - nX ; nY = nV - nX ; of = nT - nX ; n_ = nV + nX ; ob = nT + nX ; nP = abs ( nY ) >= abs ( of ) ; oe = max ( abs ( nY ) , abs ( of ) ) ; if ( nP ) oa = - oa ; og = clamp ( abs ( oc ) * nZ , 0.0 , 1.0 ) ; on . x = om . x ; on . y = om . y ; oo . x = ( ! nO ) ? 0.0 : u_texel_size . x ; oo . y = ( nO ) ? 0.0 : u_texel_size . y ; if ( ! nO ) on . x += oa * 0.5 ; if ( nO ) on . y += oa * 0.5 ; op . x = on . x - oo . x ; op . y = on . y - oo . y ; oq . x = on . x + oo . x ; oq . y = on . y + oo . y ; nW = ( ( - 2.0 ) * og ) + 3.0 ; nU = ky ( texture2D ( u_color , op ) ) ; od = og * og ; nV = ky ( texture2D ( u_color , oq ) ) ; if ( ! nP ) n_ = ob ; nT = oe * 1.0 / 4.0 ; nY = nX - n_ * 0.5 ; of = nW * od ; nP = nY < 0.0 ; nU -= n_ * 0.5 ; nV -= n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 1.5 ; if ( ! nQ ) op . y -= oo . y * 1.5 ; nS = ( ! nQ ) || ( ! nR ) ; if ( ! nR ) oq . x += oo . x * 1.5 ; if ( ! nR ) oq . y += oo . y * 1.5 ; if ( nS ) { if ( ! nQ ) nU = ky ( texture2D ( u_color , op . xy ) ) ; if ( ! nR ) nV = ky ( texture2D ( u_color , oq . xy ) ) ; if ( ! nQ ) nU = nU - n_ * 0.5 ; if ( ! nR ) nV = nV - n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 2.0 ; if ( ! nQ ) op . y -= oo . y * 2.0 ; nS = ( ! nQ ) || ( ! nR ) ; if ( ! nR ) oq . x += oo . x * 2.0 ; if ( ! nR ) oq . y += oo . y * 2.0 ; if ( nS ) { if ( ! nQ ) nU = ky ( texture2D ( u_color , op . xy ) ) ; if ( ! nR ) nV = ky ( texture2D ( u_color , oq . xy ) ) ; if ( ! nQ ) nU = nU - n_ * 0.5 ; if ( ! nR ) nV = nV - n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 2.0 ; if ( ! nQ ) op . y -= oo . y * 2.0 ; nS = ( ! nQ ) || ( ! nR ) ; if ( ! nR ) oq . x += oo . x * 2.0 ; if ( ! nR ) oq . y += oo . y * 2.0 ; if ( nS ) { if ( ! nQ ) nU = ky ( texture2D ( u_color , op . xy ) ) ; if ( ! nR ) nV = ky ( texture2D ( u_color , oq . xy ) ) ; if ( ! nQ ) nU = nU - n_ * 0.5 ; if ( ! nR ) nV = nV - n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 4.0 ; if ( ! nQ ) op . y -= oo . y * 4.0 ; nS = ( ! nQ ) || ( ! nR ) ; if ( ! nR ) oq . x += oo . x * 4.0 ; if ( ! nR ) oq . y += oo . y * 4.0 ; if ( nS ) { if ( ! nQ ) nU = ky ( texture2D ( u_color , op . xy ) ) ; if ( ! nR ) nV = ky ( texture2D ( u_color , oq . xy ) ) ; if ( ! nQ ) nU = nU - n_ * 0.5 ; if ( ! nR ) nV = nV - n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 2.0 ; if ( ! nQ ) op . y -= oo . y * 2.0 ; if ( ! nR ) oq . x += oo . x * 2.0 ; if ( ! nR ) oq . y += oo . y * 2.0 ; } } } } oc = om . x - op . x ; nZ = oq . x - om . x ; if ( ! nO ) oc = om . y - op . y ; if ( ! nO ) nZ = oq . y - om . y ; nS = ( nU < 0.0 ) != nP ; og = ( nZ + oc ) ; nQ = ( nV < 0.0 ) != nP ; ob = 1.0 / og ; nR = oc < nZ ; oe = min ( oc , nZ ) ; nP = nR ? nS : nQ ; nX = of * of ; nW = ( oe * ( - ob ) ) + 0.5 ; od = nX * FXAA_QUALITY_SUBPIX ; nY = nP ? nW : 0.0 ; n_ = max ( nY , od ) ; if ( ! nO ) om . x += n_ * oa ; if ( nO ) om . y += n_ * oa ; return texture2D ( u_color , om ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = nN ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = or ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 kr ; vec2 ks , kt ; ks = vec2 ( 0.0 , 0.0 ) ; kt = u_texel_size ; kr = texture2D ( u_color , a ) ; gl_FragColor = kr * 0.0875447373698 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0858112354248 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0808139781061 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0731235112908 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0635705267419 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0530985673112 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0426125984122 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0328565115809 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * kr , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 kr , ks ; kr = texture2D ( u_main , a ) ; ks = texture2D ( u_bloom , a ) ; kr = kr ; kr += ks ; gl_FragColor = vec4 ( kr . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { float kr ; vec3 ks , kt ; vec4 ku ; ku = texture2D ( u_color , a ) ; ks = ku . rgb ; if ( u_brightness < 0.0 ) ks = ks * ( 1.0 + u_brightness ) ; else ks = ks + ( ( 1.0 - ks ) * u_brightness ) ; ks = ( ks - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; ks *= u_exposure ; kt = vec3 ( 0.299 , 0.587 , 0.114 ) ; kr = dot ( ks , kt ) ; ks = mix ( vec3 ( kr ) , ks , u_saturation ) ; gl_FragColor = vec4 ( ks , ku . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cq ( clamp ( nS ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { float nT , nU ; vec4 nV , nW ; nV = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { nT = nS ( u_depth , a , u_camera_range ) ; nT *= u_view_max_depth ; if ( nT < u_dof_dist ) nU = ( u_dof_dist - nT ) / u_dof_front ; else nU = ( nT - u_dof_dist ) / u_dof_rear ; nU = clamp ( nU , 0.0 , 1.0 ) ; nW = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nV , nW , nU ) ; } else gl_FragColor = nV ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 a ; void main ( ) { float kr ; vec4 ks , kt , ku ; ks = texture2D ( u_src_color , a ) ; kt = texture2D ( u_glow_mask_small , a ) ; ku = texture2D ( u_glow_mask_large , a ) ; gl_FragColor = ks ; if ( ku . a != 0.0 ) { kr = u_glow_mask_large_coeff * ku . a ; kr = clamp ( kr , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , ku . rgb / ku . a , kr ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , kr ) ; } if ( kt . a != 0.0 ) { kr = u_glow_mask_small_coeff * kt . a ; kr = clamp ( kr , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , kt . rgb / kt . a , kr ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , kr ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nT ; varying vec2 nU ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nV ; void main ( ) { vec4 nW ; float nX , nY , nZ , n_ , oa ; vec2 ob , oc , od ; ob = ( nV . xy - a ) ; nX = length ( ob ) ; ob = u_radial_blur_step * ob / nX ; nY = nX / u_radial_blur_step ; ob *= min ( nY , STEPS_PER_PASS ) / STEPS_PER_PASS ; nY = max ( nY , STEPS_PER_PASS ) ; oc = a ; nZ = 0.0 ; for ( float oe = 0.0 ; oe < STEPS_PER_PASS ; oe += 1.0 ) { if ( oe <= nY ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"n_ = nS ( u_input , oc , u_camera_range ) ; nZ += max ( ( 1.0 - pow ( nX , 0.3 ) ) * step ( 0.9 , n_ ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nW = texture2D ( u_input , oc ) ; nZ += cu ( nW ) ;".split(" ")}]}}]},{type:"textline",b:"} oc += ob ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"od = a + nU ; oa = da ( vec2 ( 2.5 * ( od . x ) , 2.5 * ( od . y ) + 1.0 * u_time ) ) . x + 0.75 * da ( vec2 ( 5.0 * ( od . x ) - 0.66 * u_time , 5.0 * ( od . y ) + 0.66 * u_time ) ) . x + 0.5 * dx ( vec2 ( 7.5 * ( od . x ) + 0.33 * u_time , 7.5 * ( od . y ) - 0.33 * u_time ) ) ; oa *= clamp ( 1.2 - sqrt ( 0.2 * nX ) , 0.0 , 1.0 ) * nT ; nZ = max ( oa , nZ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cq ( nZ / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]={type:"group",
a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float nT ; varying vec2 nU ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nV ; void main ( ) { float kr , ks ; vec3 kt ; a = a_bb_vertex + 0.5 ; kt = normalize ( u_sun_direction ) ; nV = u_proj_matrix * u_view_matrix * vec4 ( kt , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { nT = 1.0 ; kt = vec3 ( 0.0 , 1.0 , 0.0 ) ; kt = j ( u_camera_quat , kt ) ; kt = normalize ( kt ) ; kr = dot ( kt , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; ks = atan ( kt . x , kt . z ) ; nU = vec2 ( - ks , acos ( kr ) ) ; } else { nT = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nV . xy = 0.5 * ( nV . xy / nV . w + 1.0 ) ; nV += 99999.0 * step ( nV . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { float kr ; vec3 ks ; vec4 kt ; kt = texture2D ( u_main , a ) ; ks = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; fV ( kt . rgb ) ; kr = cu ( texture2D ( u_god_rays , a ) ) ; ks = kt . rgb + u_god_rays_intensity * vec3 ( kr ) * ks ; fX ( ks ) ; gl_FragColor . rgb = ks ; gl_FragColor . a = kt . a ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { float kr ; vec4 ks ; ks = texture2D ( u_input , a ) ; kr = dot ( ks . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( kr ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float kr , ks ; ks = 0.0 ; for ( float kt = 0.025 ; kt < 1.0 ; kt += 0.05 ) for ( float ku = 0.025 ; ku < 1.0 ; ku += 0.05 ) { kr = max ( texture2D ( u_input , vec2 ( kt , ku ) ) . r , 0.01 ) ; ks += log ( kr ) ; } ks = exp ( ks / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( ks ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nW ; void main ( ) { vec4 nX ; float nY , nZ ; nY = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; nZ = texture2D ( u_luminance , a ) . r ; nX = texture2D ( u_main , a ) ; nZ = nZ / nY ; nY = u_bloom_edge_lum ; gl_FragColor = nX * max ( nZ - nY , 0.0 ) * nW ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nW ; const vec3 kr = vec3 ( 0.0 , 1.0 , 0.0 ) ; void kz ( in vec4 ks , in vec3 kt , out vec3 ku ) { float kv , kw , kx , ky ; kv = ks . w * kt . x + ks . y * kt . z - ks . z * kt . y ; kw = ks . w * kt . y + ks . z * kt . x - ks . x * kt . z ; kx = ks . w * kt . z + ks . x * kt . y - ks . y * kt . x ; ky = - ks . x * kt . x - ks . y * kt . y - ks . z * kt . z ; ku . x = kv * ks . w - ky * ks . x - kw * ks . z + kx * ks . y ; ku . y = kw * ks . w - ky * ks . y - kx * ks . x + kv * ks . z ; ku . z = kx * ks . w - ky * ks . z - kv * ks . y + kw * ks . x ; } void main ( ) { vec3 kA ; a = 2.0 * a_position ; kz ( u_camera_quat , kr , kA ) ; nW = dot ( - kA , u_sun_direction ) * u_bloom_key ; nW *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; float kr = 0.0042 ; void main ( ) { vec4 ks , kt , ku , kv ; ks = texture2D ( u_mb_tex_curr , a ) ; kt = texture2D ( u_mb_tex_accum , a ) ; if ( length ( ks - kt ) > BLUR_DECAY_THRESHOLD ) { ku = ( 1.0 - u_motion_blur_exp ) * ks + u_motion_blur_exp * kt ; ku = ku - kt ; kv = ks - kt ; kv = min ( max ( abs ( ku ) , vec4 ( kr ) ) , abs ( kv ) ) * sign ( ku ) ; gl_FragColor = kt + kv ; } else { gl_FragColor = ks ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 a ; void main ( ) { vec3 kr ; float ks ; vec4 kt , ku , kv ; kt = texture2D ( u_outline_src , a ) ; gl_FragColor = kt ; if ( u_draw_outline != 0.0 ) { ku = texture2D ( u_outline_mask , a ) ; kv = texture2D ( u_outline_mask_blurred , a ) ; ks = kv . a - ku . a ; if ( ks != 0.0 ) { ks = smoothstep ( 0.0 , 1.0 , kv . a ) ; if ( ku . a == 0.0 ) { kr = u_outline_color ; fX ( kr ) ; kv = vec4 ( clamp ( kr , 0.0 , 1.0 ) , ks ) ; gl_FragColor = mix ( kt , kv , ks ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 kr , ks ; vec4 kt ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( kt . r + kt . g + kt . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"kr = vec2 ( 0.0 , 0.0 ) ; ks = u_texel_size ; kt = texture2D ( u_color , a ) ; gl_FragColor = kt * 0.2270270270 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * 0.1945945946 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * 0.1945945946 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * 0.1216216216 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * 0.1216216216 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * 0.0540540541 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * 0.0540540541 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * 0.0162162162 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_GLOW_BLUR || POST_EFFECT == POST_EFFECT_Y_GLOW_BLUR".split(" "),group:{type:"group",a:[{type:"textline",b:"kr = vec2 ( 0.0 , 0.0 ) ; ks = u_texel_size ; kt = texture2D ( u_color , a ) ; gl_FragColor = kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.152507 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.141763 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.141763 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.113861 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.113861 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.079019 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.079019 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.047383 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.047383 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.024549 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.024549 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.01099 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.01099 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.00425 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.00425 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.00142 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"ks = u_texel_size ; kt = texture2D ( u_color , a ) ; gl_FragColor = kt ; if ( kt . a == 0.0 ) { kt = texture2D ( u_color , a + ks ) ; if ( kt . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , kt . a ) ; else { kt = texture2D ( u_color , a - ks ) ; if ( kt . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , kt . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 a ; void main ( ) { a = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nX",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nY ; varying vec4 nZ ; varying vec4 n_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","oa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 og ( vec2 ob , sampler2D oc ) { float od , oe , of ; od = texture2D ( oc , ob ) . r ; oe = texture2D ( oc , nY . xy ) . r ; of = texture2D ( oc , nY . zw ) . r ; return vec3 ( od , oe , of ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 ol ( vec2 oh , sampler2D oi ) { vec2 oj ; vec3 ok ; ok = og ( oh , oi ) ; oj = abs ( ok . xx - ok . yz ) ; oj = step ( SMAA_PREDICATION_THRESHOLD , oj ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * oj ) ; }".split(" ")}]}}]},{type:"textline",b:"void op ( bvec2 om , inout vec2 on , vec2 oo ) { if ( om . x ) on . x = oo . x ; if ( om . y ) on . y = oo . y ; } void op ( bvec4 oq , inout vec4 or , vec4 os ) { op ( oq . xy , or . xy , os . xy ) ; op ( oq . zw , or . zw , os . zw ) ; } vec2 ou ( vec2 ot ) { return sign ( ot ) * floor ( abs ( ot ) + .5 ) ; } vec4 ou ( vec4 ov ) { return sign ( ov ) * floor ( abs ( ov ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oI ( vec2 ow , sampler2D ox".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","oy"]}]}}]},{type:"textline",b:") { vec4 oz ; float oA , oB , oC , oD , oE ; vec3 oF ; vec2 oG , oH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"oG = ol ( ow , oy ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"oG = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"oF = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; oA = dot ( texture2D ( ox , ow ) . rgb , oF ) ; oB = dot ( texture2D ( ox , nY . xy ) . rgb , oF ) ; oC = dot ( texture2D ( ox , nY . zw ) . rgb , oF ) ; oz . xy = abs ( oA - vec2 ( oB , oC ) ) ; oG = step ( oG , oz . xy ) ; if ( dot ( oG , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; oD = dot ( texture2D ( ox , nZ . xy ) . rgb , oF ) ; oE = dot ( texture2D ( ox , nZ . zw ) . rgb , oF ) ; oz . zw = abs ( oA - vec2 ( oD , oE ) ) ; oH = max ( oz . xy , oz . zw ) ; oA = dot ( texture2D ( ox , n_ . xy ) . rgb , oF ) ; oD = dot ( texture2D ( ox , n_ . zw ) . rgb , oF ) ; oz . zw = abs ( vec2 ( oB , oC ) - vec2 ( oA , oD ) ) ; oH = max ( oH . xy , oz . zw ) ; oE = max ( oH . x , oH . y ) ; oG . xy *= step ( oE , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * oz . xy ) ; return oG ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oK ( vec2 oJ ) { oJ . r = oJ . r * abs ( 5.0 * oJ . r - 5.0 * 0.75 ) ; return ou ( oJ ) ; } vec4 oK ( vec4 oL ) { oL . rb = oL . rb * abs ( 5.0 * oL . rb - 5.0 * 0.75 ) ; return ou ( oL ) ; } vec2 oT ( sampler2D oM , vec2 oN , vec2 oO , out vec2 oP ) { vec3 oQ ; vec4 oR ; oR = vec4 ( oN , - 1.0 , 1.0 ) ; oQ = vec3 ( u_texel_size , 1.0 ) ; for ( int oS = 0 ; oS < SMAA_MAX_SEARCH_STEPS_DIAG ; oS ++ ) { if ( oR . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oR . w > 0.9 ) { oR . xyz += oQ * vec3 ( oO , 1.0 ) ; oP = texture2D ( oM , oR . xy , 0.0 ) . rg ; oR . w = dot ( oP , vec2 ( 0.5 , 0.5 ) ) ; } } return oR . zw ; } vec2 pa ( sampler2D oU , vec2 oV , vec2 oW , out vec2 oX ) { vec3 oY ; vec4 oZ ; oZ = vec4 ( oV , - 1.0 , 1.0 ) ; oZ . x += 0.25 * u_texel_size . x ; oY = vec3 ( u_texel_size , 1.0 ) ; for ( int o_ = 0 ; o_ < SMAA_MAX_SEARCH_STEPS_DIAG ; o_ ++ ) { if ( oZ . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oZ . w > 0.9 ) { oZ . xyz = oY * vec3 ( oW , 1.0 ) + oZ . xyz ; oX = texture2D ( oU , oZ . xy , 0.0 ) . rg ; oX = oK ( oX ) ; oZ . w = dot ( oX , vec2 ( 0.5 , 0.5 ) ) ; } } return oZ . zw ; } vec2 pg ( sampler2D pb , vec2 pc , vec2 pd , float pe ) { vec2 pf ; pf = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * pd + pc ; pf = SMAA_AREATEX_PIXEL_SIZE * pf + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pf . x += 0.5 ; pf . y += SMAA_AREATEX_SUBTEX_SIZE * pe ; return texture2D ( pb , pf , 0.0 ) . rg ; } vec2 ps ( sampler2D ph , sampler2D pi , vec2 pj , vec2 pk , vec4 pl ) { vec4 pm , pn , po ; vec2 pp , pq , pr ; pp = vec2 ( 0.0 , 0.0 ) ; if ( pk . r > 0.0 ) { pm . xz = oT ( ph , pj , vec2 ( - 1.0 , 1.0 ) , pq ) ; pm . x += float ( pq . y > 0.9 ) ; } else pm . xz = vec2 ( 0.0 , 0.0 ) ; pm . yw = oT ( ph , pj , vec2 ( 1.0 , - 1.0 ) , pq ) ; if ( pm . x + pm . y > 2.0 ) { pn = vec4 ( - pm . x + 0.25 , pm . x , pm . y , - pm . y - 0.25 ) * u_texel_size . xyxy + pj . xyxy ; po . xy = texture2D ( ph , pn . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; po . zw = texture2D ( ph , pn . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; po . yxwz = oK ( po . xyzw ) ; pr = vec2 ( 2.0 , 2.0 ) * po . xz + po . yw ; op ( bvec2 ( step ( 0.9 , pm . zw ) ) , pr , vec2 ( 0.0 , 0.0 ) ) ; pp += pg ( pi , pm . xy , pr , pl . z ) ; } pm . xz = pa ( ph , pj , vec2 ( - 1 , - 1 ) , pq ) ; if ( texture2D ( ph , pj + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { pm . yw = pa ( ph , pj , vec2 ( 1 , 1 ) , pq ) ; pm . y += float ( pq . y > 0.9 ) ; } else pm . yw = vec2 ( 0.0 , 0.0 ) ; if ( pm . x + pm . y > 2.0 ) { pn = vec4 ( - pm . x , - pm . x , pm . y , pm . y ) * u_texel_size . xyxy + pj . xyxy ; po . x = texture2D ( ph , pn . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; po . y = texture2D ( ph , pn . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; po . zw = texture2D ( ph , pn . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; pr = vec2 ( 2.0 , 2.0 ) * po . xz + po . yw ; op ( bvec2 ( step ( 0.9 , pm . zw ) ) , pr , vec2 ( 0 , 0 ) ) ; pp += pg ( pi , pm . xy , pr , pl . w ) . gr ; } return pp ; }".split(" ")}]}}]},
{type:"textline",b:"float py ( sampler2D pt , vec2 pu , float pv ) { vec2 pw , px ; pw = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; px = SMAA_SEARCHTEX_SIZE * vec2 ( pv , 1.0 ) ; pw += vec2 ( - 1.0 , 1.0 ) ; px += vec2 ( 0.5 , - 0.5 ) ; pw *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; px *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( pt , pw * pu + px , 0.0 ) . r ; } float pG ( sampler2D pz , sampler2D pA , vec2 pB , float pC ) { float pD ; vec2 pE ; pE = vec2 ( 0.0 , 1.0 ) ; for ( int pF = 0 ; pF < SMAA_MAX_SEARCH_STEPS ; pF ++ ) { if ( pB . x > pC && pE . g > 0.8281 && pE . r == 0.0 ) { pE = texture2D ( pz , pB , 0.0 ) . rg ; pB = - vec2 ( 2.0 , 0.0 ) * u_texel_size + pB ; } } pD = - ( 255.0 / 127.0 ) * py ( pA , pE , 0.0 ) + 3.25 ; return u_texel_size . x * pD + pB . x ; } float pO ( sampler2D pH , sampler2D pI , vec2 pJ , float pK ) { float pL ; vec2 pM ; pM = vec2 ( 0.0 , 1.0 ) ; for ( int pN = 0 ; pN < SMAA_MAX_SEARCH_STEPS ; pN ++ ) { if ( pJ . x < pK && pM . g > 0.8281 && pM . r == 0.0 ) { pM = texture2D ( pH , pJ , 0.0 ) . rg ; pJ = vec2 ( 2.0 , 0.0 ) * u_texel_size + pJ ; } } pL = - ( 255.0 / 127.0 ) * py ( pI , pM , 0.5 ) + 3.25 ; return - u_texel_size . x * pL + pJ . x ; } float pW ( sampler2D pP , sampler2D pQ , vec2 pR , float pS ) { float pT ; vec2 pU ; pU = vec2 ( 1.0 , 0.0 ) ; for ( int pV = 0 ; pV < SMAA_MAX_SEARCH_STEPS ; pV ++ ) { if ( pR . y > pS && pU . r > 0.8281 && pU . g == 0.0 ) { pU = texture2D ( pP , pR , 0.0 ) . rg ; pR = - vec2 ( 0.0 , 2.0 ) * u_texel_size + pR ; } } pT = - ( 255.0 / 127.0 ) * py ( pQ , pU . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pT + pR . y ; } float qd ( sampler2D pX , sampler2D pY , vec2 pZ , float p_ ) { float qa ; vec2 qb ; qb = vec2 ( 1.0 , 0.0 ) ; for ( int qc = 0 ; qc < SMAA_MAX_SEARCH_STEPS ; qc ++ ) { if ( pZ . y < p_ && qb . r > 0.8281 && qb . g == 0.0 ) { qb = texture2D ( pX , pZ , 0.0 ) . rg ; pZ = vec2 ( 0.0 , 2.0 ) * u_texel_size + pZ ; } } qa = - ( 255.0 / 127.0 ) * py ( pY , qb . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * qa + pZ . y ; } vec2 qk ( sampler2D qe , vec2 qf , float qg , float qh , float qi ) { vec2 qj ; qj = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * ou ( 4.0 * vec2 ( qg , qh ) ) + qf ; qj = SMAA_AREATEX_PIXEL_SIZE * qj + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; qj . y = SMAA_AREATEX_SUBTEX_SIZE * qi + qj . y ; return texture2D ( qe , qj , 0.0 ) . rg ; } void qr ( sampler2D ql , inout vec2 qm , vec4 qn , vec2 qo ) { vec2 qp , qq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qp = step ( qo . xy , qo . yx ) ; qq = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * qp ; qq /= qp . x + qp . y ; qp = vec2 ( 1.0 , 1.0 ) ; qp . x -= qq . x * texture2D ( ql , qn . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; qp . x -= qq . y * texture2D ( ql , qn . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; qp . y -= qq . x * texture2D ( ql , qn . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; qp . y -= qq . y * texture2D ( ql , qn . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; qm *= clamp ( qp , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void qy ( sampler2D qs , inout vec2 qt , vec4 qu , vec2 qv ) { vec2 qw , qx ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qw = step ( qv . xy , qv . yx ) ; qx = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * qw ; qx /= qw . x + qw . y ; qw = vec2 ( 1.0 , 1.0 ) ; qw . x -= qx . x * texture2D ( qs , qu . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; qw . x -= qx . y * texture2D ( qs , qu . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; qw . y -= qx . x * texture2D ( qs , qu . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; qw . y -= qx . y * texture2D ( qs , qu . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; qt *= clamp ( qw , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qM ( vec2 qz , vec2 qA , sampler2D qB , sampler2D qC , sampler2D qD , vec4 qE ) { float qF , qG ; vec3 qH ; vec2 qI , qJ , qK ; vec4 qL ; qL = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; qI = texture2D ( qB , qz ) . rg ; if ( qI . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",
b:"qL . rg = ps ( qB , qC , qz , qI , qE ) ; if ( qL . r == - qL . g ) {".split(" ")}]}}]},{type:"textline",b:"; qH . x = pG ( qB , qD , nY . xy , n_ . x ) ; qH . y = nZ . y ; qJ . x = qH . x ; qF = texture2D ( qB , qH . xy , 0.0 ) . r ; qH . z = pO ( qB , qD , nY . zw , n_ . y ) ; qJ . y = qH . z ; qJ = abs ( ou ( qJ / u_texel_size . xx - qA . xx ) ) ; qK = sqrt ( qJ ) ; qG = texture2D ( qB , qH . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qL . rg = qk ( qC , qK , qF , qG , qE . y ) ; qH . y = qz . y ; qr ( qB , qL . rg , qH . xyzy , qJ ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qI . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qI . r > 0.0 ) { ; qH . y = pW ( qB , qD , nZ . xy , n_ . z ) ; qH . x = nY . x ; qK . x = qH . y ; qF = texture2D ( qB , qH . xy , 0.0 ) . g ; qH . z = qd ( qB , qD , nZ . zw , n_ . w ) ; qK . y = qH . z ; qK = abs ( ou ( qK / u_texel_size . yy - qA . yy ) ) ; qJ = sqrt ( qK ) ; qG = texture2D ( qB , qH . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qL . ba = qk ( qC , qJ , qF , qG , qE . x ) ; qH . x = qz . x ; qy ( qB , qL . ba , qH . xyxz , qK ) ; } return qL ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qY ( vec2 qN , sampler2D qO , sampler2D qP".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qQ"]}]}}]},{type:"textline",b:") { bool qR ; vec2 qS , qT , qU ; vec4 qV , qW , qX ; qV . x = texture2D ( qP , nX . xy ) . a ; qV . y = texture2D ( qP , nX . zw ) . g ; qV . wz = texture2D ( qP , qN ) . xz ; if ( dot ( qV , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { qW = texture2D ( qO , qN , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"qX = texture2D ( qQ , a ) ; qS = 2.0 * cC ( qX ) - 1.0 ; qW . a = sqrt ( 2.0 * length ( qS ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qW ; } else { qR = max ( qV . x , qV . z ) > max ( qV . y , qV . w ) ; qX = vec4 ( 0.0 , qV . y , 0.0 , qV . w ) ; qS = qV . yw ; op ( bvec4 ( qR , qR , qR , qR ) , qX , vec4 ( qV . x , 0.0 , qV . z , 0.0 ) ) ; op ( bvec2 ( qR , qR ) , qS , qV . xz ) ; qS /= dot ( qS , vec2 ( 1.0 , 1.0 ) ) ; qW = qX * vec4 ( u_texel_size , - u_texel_size ) + qN . xyxy ; qV = qS . x * texture2D ( qO , qW . xy , 0.0 ) ; qV += qS . y * texture2D ( qO , qW . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"qX = texture2D ( qQ , qW . xy ) ; qT = 2.0 * cC ( qX ) - 1.0 ; qU = qS . x * qT ; qX = texture2D ( qQ , qW . zw ) ; qT = 2.0 * cC ( qX ) - 1.0 ; qU += qS . y * qT ; qV . a = sqrt ( 2.0 * length ( qU ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qV",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 rh ( vec2 qZ , sampler2D q_ , sampler2D ra".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","rb"]}]}}]},{type:"textline",b:") { float rc ; vec2 rd ; vec4 re , rf , rg ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"re = texture2D ( rb , a ) ; rd = 2.0 * cC ( re ) - 1.0 ; re = texture2D ( q_ , qZ ) ; rf = texture2D ( ra , qZ - rd ) ; rc = abs ( re . a * re . a - rf . a * rf . a ) / 2.0 ; rc = 0.5 * clamp ( 1.0 - sqrt ( rc ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; rg = mix ( re , rf , rc ) ; rg . a = 1.0 ; return rg ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"re = texture2D ( q_ , qZ ) ; rf = texture2D ( ra , qZ ) ; return mix ( re , rf , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 ri ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"ri = vec4 ( oI ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"ri = qM ( a , oa , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"ri = qY ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"ri = vec4 ( rh ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ri = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","ri",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nX",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nY ; varying vec4 nZ ; varying vec4 n_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","oa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void ks ( vec2 kr ) { nY = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + kr . xyxy ; nZ = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kr . xyxy ; n_ = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + kr . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void kv ( vec2 kt , out vec2 ku ) { ku = kt / u_texel_size ; nY = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + kt . xyxy ; nZ = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + kt . xyxy ; n_ = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nY . xz , nZ . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void kx ( vec2 kw ) { nX = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kw . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["ks","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"kv ( a , oa ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["kx","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},
{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float oc ( in vec2 ob ) { return nS ( u_depth , ob , u_camera_range ) ; } void main ( ) { vec3 od , oe , of ; float og , oh , oi , oj , ok , ol , om ; og = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( og , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"od = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; oh = oc ( a ) ; oi = oh * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float on = 8.0 ; const int oo = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float on = 16.0 ; const int oo = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float on = 24.0 ; const int oo = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float on = 32.0 ; const int oo = 4 ;".split(" ")}]}}]},{type:"textline",b:"oj = u_ssao_radius_increase * 0.001 ; const float op = 1.0 + 2.4 / on ; ok = 0.0 ; for ( int oq = 0 ; oq < oo ; oq ++ ) for ( int or = - 1 ; or <= 1 ; or += 2 ) for ( int os = - 1 ; os <= 1 ; os += 2 ) for ( int ot = - 1 ; ot <= 1 ; ot += 2 ) { oe = reflect ( normalize ( vec3 ( or , os , ot ) ) , od ) * ( oj *= op ) ; of = vec3 ( a , oi ) ; of += vec3 ( oe . xy , oe . z * oi * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"of . z -= 1.4 * ( of . z - oi ) * step ( oi , of . z ) ;".split(" ")}]}}]},{type:"textline",b:"ol = oc ( of . xy ) * ( u_camera_range . y - u_camera_range . x ) ; om = clamp ( ( oi - ol ) / ol , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ok += mix ( 1.0 , om , step ( ol , of . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"ok += mix ( step ( of . z , ol ) , 0.5 , om ) ;".split(" ")}]}}]},{type:"textline",b:"} ok = ok / on ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ok = clamp ( ok * ok + 0.6 * ok , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ok = clamp ( ok * ok + ok , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"oh = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * oh ) ; ok = mix ( 1.0 , ok , oh ) ; gl_FragColor = vec4 ( og , ok , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float oc ( in vec2 ob ) { return nS ( u_depth , ob , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec2 od , oe ; float of , og , oh , oi , oj , ok , ol ; of = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"og = oc ( a ) ; oh = 0.0 ; oi = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"od = vec2 ( - 2.0 ) ; for ( int om = 0 ; om < 4 ; ++ om ) { for ( int on = 0 ; on < 4 ; ++ on ) { oe = ( od + vec2 ( float ( om ) , float ( on ) ) ) * u_texel_size ; oj = texture2D ( u_ssao_mask , a + oe ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"ok = oc ( a + oe ) ; ol = 1.0 - clamp ( abs ( ok - og ) * oi , 0.0 , 1.0 ) ; of += oj * ol ; oh += ol ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["of","+=","oj",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , of / oh , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , of / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { vec2 kr ; vec4 ks , kt ; float ku ; ku = texture2D ( u_depth , a ) . x ; ks = vec4 ( a * 2.0 - 1.0 , 2.0 * ku - 1.0 , 1.0 ) ; kt = u_view_proj_inverse * ks ; kt = kt / kt . w ; kt = u_view_proj_prev * kt ; kt /= kt . w ; kr = ( ks . xy - kt . xy ) / 4.0 + 0.5 ; kr = clamp ( kr , 0.0 , 1.0 ) ; gl_FragColor = cq ( kr ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } vec4 l ( in vec4 k ) { return vec4 ( - k . xyz , k . w ) / dot ( k , k ) ; } vec3 q ( vec4 m , vec4 n , vec4 o ) { vec3 p ; p = o . xyz * m . w ; p = j ( n , p ) ; p += m . xyz * o . w ; return p ; } vec3 w ( vec4 r , vec4 s , vec4 t ) { vec4 u ; vec3 v ; v = t . xyz - r . xyz * t . w ; u = l ( s ) ; v = j ( u , v ) ; v /= r . w ; return v ; } mat4 x ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 z ( float y ) { return mat4 ( c , b , b , b , b , cos ( y ) , sin ( y ) , b , b , - sin ( y ) , cos ( y ) , b , b , b , b , c ) ; } mat4 B ( float A ) { return mat4 ( cos ( A ) , b , - sin ( A ) , b , b , c , b , b , sin ( A ) , b , cos ( A ) , b , b , b , b , c ) ; } mat4 D ( float C ) { return mat4 ( cos ( C ) , sin ( C ) , b , b , - sin ( C ) , cos ( C ) , b , b , b , b , c , b , b , b , b , c ) ; } d F ( in d E ) { return d ( E . a , E . b , normalize ( E . c ) , normalize ( E . d ) , normalize ( E . e ) , E . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 G = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 N ( vec3 H , mat4 I ) { vec3 J , L , M ; J = vec3 ( I [ 0 ] [ 0 ] , I [ 1 ] [ 0 ] , I [ 2 ] [ 0 ] ) ; L = vec3 ( I [ 0 ] [ 1 ] , I [ 1 ] [ 1 ] , I [ 2 ] [ 1 ] ) ; M = vec3 ( I [ 0 ] [ 2 ] , I [ 1 ] [ 2 ] , I [ 2 ] [ 2 ] ) ; L = cross ( M , J ) ; J = normalize ( J ) ; L = normalize ( L ) ; M = normalize ( M ) ; return mat4 ( vec4 ( J , 0.0 ) , vec4 ( L , 0.0 ) , vec4 ( M , 0.0 ) , vec4 ( H , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 T ( vec3 O , vec3 P ) { vec3 Q , R , S ; Q = O - P ; Q . y = 0.0 ; R = cross ( G , Q ) ; S = cross ( Q , R ) ; R = normalize ( R ) ; S = normalize ( S ) ; Q = normalize ( Q ) ; return mat4 ( vec4 ( R , 0.0 ) , vec4 ( S , 0.0 ) , vec4 ( Q , 0.0 ) , vec4 ( P , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 aa ( in vec3 U , float V , float W , float X , vec3 Y ) { float Z , _ ; Z = fract ( length ( Y ) / 0.17 ) ; _ = X + Z / 10.0 ; Z = Z ; if ( X != 0.0 ) Z /= X ; U *= 1.0 + 0.5 * sin ( V ) ; _ = length ( U ) * W * sin ( 2.0 * 3.14 * V * _ + Z ) ; return D ( _ ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ai ( in vec3 ab , in vec3 ac , in mat4 ad ) { vec3 ae ; float af , ag ; mat4 ah ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"ah = N ( ac , ad ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"af = fract ( ( ac . x * 1.43 + ac . y * 0.123 + ac . z * 6.1 ) ) ; af = 2.0 * M_PI * af ; ae = normalize ( vec3 ( ad [ 0 ] [ 2 ] , 0.0 , ad [ 2 ] [ 2 ] ) ) ; ag = acos ( ae [ 2 ] ) ; if ( ae [ 0 ] < 0.0 ) ag = 2.0 * M_PI - ag ; ag = ag - af ; if ( ag < 0.0 ) ag = 2.0 * M_PI + ag ; af = af ; if ( ag <= MAX_BILLBOARD_ANGLE ) af += ag ; else if ( ag <= M_PI - MAX_BILLBOARD_ANGLE ) af += MAX_BILLBOARD_ANGLE * ( 2.0 * ag - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( ag <= M_PI + MAX_BILLBOARD_ANGLE ) af += ag - M_PI ; else if ( ag <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) af += MAX_BILLBOARD_ANGLE * ( 2.0 * ag - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else af += ag - 2.0 * M_PI ; ah = B ( af ) ; ah [ 3 ] = vec4 ( ac , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ah = T ( ab , ac ) ;".split(" ")}]}}]},{type:"textline",b:["return","ah",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ao ( in vec3 aj , in vec3 ak , in mat4 al , mat4 am ) { mat4 an ; an = ai ( aj , ak , al ) ; am [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; an = an * am ; return an ; }".split(" ")}]}}]},{type:"textline",b:"d av ( in vec3 ap , in vec3 aq , in vec3 ar , in vec3 as , in vec3 at , in mat4 au ) { ap = ( au * vec4 ( ap , 1.0 ) ) . xyz ; aq = ( au * vec4 ( aq , 1.0 ) ) . xyz ; ar = ( au * vec4 ( ar , 0.0 ) ) . xyz ; as = ( au * vec4 ( as , 0.0 ) ) . xyz ; at = ( au * vec4 ( at , 0.0 ) ) . xyz ; return F ( d ( ap , aq , ar , as , at , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 ay ( vec2 aw , vec3 ax ) { return ( aw + 0.5 ) * ax . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aF ( in vec4 az , in vec4 aA , in float aB ) { float aC , aD , aE ; aC = az [ 0 ] * aA [ 0 ] + az [ 1 ] * aA [ 1 ] + az [ 2 ] * aA [ 2 ] + az [ 3 ] * aA [ 3 ] ; if ( aC < 0.0 ) { aA *= - 1.0 ; aC = - aC ; } if ( abs ( aC ) >= 1.0 ) return az ; aD = acos ( aC ) ; aC = sqrt ( 1.0 - aC * aC ) ; if ( abs ( aC ) < 0.001 ) return vec4 ( az * 0.5 + aA * 0.5 ) ; aE = sin ( ( 1.0 - aB ) * aD ) / aC ; aD = sin ( aB * aD ) / aC ; return az * aE + aA * aD ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aR ( in vec3 aG , in vec4 aH , in vec4 aI , in vec4 aJ , in vec4 aK , in float aL ) { vec3 aM , aN , aO ; vec4 aP , aQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"aP = aF ( aH , aI , aL ) ; aQ = mix ( aJ , aK , aL ) ; aM = j ( aP , aG ) ; aM = aM * aQ . w + aQ . xyz ; return aM ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"aN = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aG , 1.0 ) ) ; aO = j ( aH , aN ) ; aN = j ( aI , aN ) ; aO = aO * aJ . w + aJ . xyz ; aN = aN * aK . w + aK . xyz ; aM = mix ( aO , aN , aL ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aM , 1.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} vec3 a_ ( in vec3 aS , in vec4 aT , in vec4 aU , in float aV ) { vec4 aW ; vec3 aX , aY , aZ ; aX = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aS , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"aW = aF ( aT , aU , aV ) ; aY = j ( aW , aX ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aY , 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aZ = j ( aT , aX ) ; aX = j ( aU , aX ) ; aY = mix ( aZ , aX , aV ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aY , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aR ( in vec3 ba , in vec4 bb , in vec4 bc ) { vec3 bd ; bd = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( ba , 1.0 ) ) ; bd = j ( bb , bd ) ; bd = bd * bc . w + bc . xyz ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( bd , 1.0 ) ) ; } vec3 a_ ( in vec3 be , in vec4 bf ) { vec3 bg ; bg = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( be , 0.0 ) ) ; bg = j ( bf , bg ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( bg , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void bv ( inout vec3 bh , inout vec3 bi , inout vec3 bj , inout vec3 bk ) { int bl , bm ; vec4 bn ; vec3 bo , bp , bq , br ; float bs , bt ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["bs","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { bo = vec3 ( 0.0 , 0.0 , 0.0 ) ; bp = vec3 ( 0.0 , 0.0 , 0.0 ) ; bq = vec3 ( 0.0 , 0.0 , 0.0 ) ; br = vec3 ( 0.0 , 0.0 , 0.0 ) ; bn = a_influence ; for ( int bu = 0 ; bu < 4 ; bu ++ ) { bl = int ( bn [ bu ] ) ; bt = fract ( bn [ bu ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bo += bt * aR ( bh , u_quatsb [ bl ] , u_quatsa [ bl ] , u_transb [ bl ] , u_transa [ bl ] , bs ) ; bp += bt * a_ ( bi , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ; bq += bt * a_ ( bj , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ; br += bt * a_ ( bk , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bo += bt * aR ( bh , u_quatsb [ bl ] , u_transb [ bl ] ) ; bp += bt * a_ ( bi , u_quatsb [ bl ] ) ; bq += bt * a_ ( bj , u_quatsb [ bl ] ) ; br += bt * a_ ( bk , u_quatsb [ bl ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bh = bo ; bi = bp ; bj = bq ; bk = br ; } if ( ! ( a_influence . y > 0.0 ) ) { bm = int ( a_influence [ 0 ] - 1.0 ) ; if ( bm > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bh = aR ( bh , u_quatsb [ bm ] , u_quatsa [ bm ] , u_transb [ bm ] , u_transa [ bm ] , bs ) ; bi = a_ ( bi , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ; bj = a_ ( bj , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ; bk = a_ ( bk , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bh = aR ( bh , u_quatsb [ bm ] , u_transb [ bm ] ) ; bi = a_ ( bi , u_quatsb [ bm ] ) ; bj = a_ ( bj , u_quatsb [ bm ] ) ; bk = a_ ( bk , u_quatsb [ bm ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bG ( inout vec3 bw , in vec3 bx , in float by , in float bz , in float bA , in vec3 bB , in float bC ) { vec3 bD ; float bE , bF ; bE = length ( bx ) ; bF = bz * ( 1.0 + 0.1 * fract ( bE ) ) ; bF = by * bC * ( 1.0 + sin ( 2.0 * 3.14 * bA * bF + bE ) ) ; bE = ( bw . y - bx . y ) * abs ( bF ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; bD = bw ; bD . xz += bB . xz * bE * sign ( bF ) ; bE = length ( bw - bx ) ; bw = bx + normalize ( bD - bx ) * bE ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bI ( vec4 bH ) { return bH * bH * ( 3.0 - 2.0 * bH ) ; } vec4 bK ( vec4 bJ ) { return abs ( fract ( bJ + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bM ( vec4 bL ) { return bI ( bK ( bL ) ) ; } void cc ( inout vec3 bN , in float bO , in vec3 bP , in vec3 bQ , in vec3 bR , in float bS , in float bT , in float bU , in vec3 bV ) { vec3 bW ; vec4 bX ; vec2 bY , bZ ; float b_ , ca , cb ; b_ = dot ( bR , vec3 ( 1.0 ) ) ; ca = b_ + bV . g ; cb = dot ( bN , vec3 ( bV . g ) ) ; bY = ( bO + vec2 ( cb , ca ) ) ; bX = ( ( fract ( ( bY . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bQ ) * bS ; bX = bM ( bX ) ; bZ = bX . xz + bX . yw ; bZ . y = 0.5 - bZ . y ; bW = bZ . xyx * bV . rbr * vec3 ( bT * bP . x , bU , bT * bP . z ) ; bN += bW ; }".split(" ")}]}}]},
{type:"textline",b:"void cj ( inout vec3 cd , inout vec3 ce , in vec3 cf ) { vec3 cg , ch , ci ; cg = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ch = ce ; ci = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ch = cd ; ci = ce ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( ch , u_time , cf , cg , ci , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bG ( ch , ci , au_wind_bending_amp , au_wind_bending_freq , u_time , cg , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bG ( ch , ci , au_wind_bending_amp , au_wind_bending_freq , u_time , cg , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"cd += ch - ce ; ce = ch ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cd = ch ; ce = ci ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MTEX_BLEND",b:["0"]},{type:"define",name:"MTEX_ADD",b:["1"]},{type:"define",name:"MTEX_SUB",b:["2"]},{type:"define",name:"MTEX_MUL",b:["3"]},{type:"define",name:"MTEX_SCREEN",b:["4"]},{type:"define",name:"MTEX_OVERLAY",
b:["5"]},{type:"define",name:"MTEX_DIFF",b:["6"]},{type:"define",name:"MTEX_DIV",b:["7"]},{type:"define",name:"MTEX_DARK",b:["8"]},{type:"define",name:"MTEX_LIGHT",b:["9"]},{type:"define",name:"MTEX_BLEND_HUE",b:["10"]},{type:"define",name:"MTEX_BLEND_SAT",b:["11"]},{type:"define",name:"MTEX_BLEND_VAL",b:["12"]},{type:"define",name:"MTEX_BLEND_COLOR",b:["13"]},{type:"define",name:"MTEX_SOFT_LIGHT",b:["14"]},{type:"define",name:"MTEX_LIN_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",
name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float ck = 255.0 ; float cl = 0.0 ; float cm = 1.0 ; vec4 cq ( const in float cn ) { vec4 co , cp ; co = vec4 ( ck * ck * ck , ck * ck , ck , cm ) ; cp = vec4 ( cl , cm / ck , cm / ck , cm / ck ) ; co = fract ( cn * co ) ; co -= co . xxyz * cp ; return co ; } float cu ( const in vec4 cr ) { vec4 cs ; float ct ; cs = vec4 ( cm / ( ck * ck * ck ) , cm / ( ck * ck ) , cm / ck , cm ) ; ct = dot ( cr , cs ) ; return ct ; } vec4 cq ( const in vec2 cv ) { vec4 cw ; vec2 cx , cy ; cx = vec2 ( ck , cm ) ; cy = vec2 ( cl , cm / ck ) ; cw = fract ( cv . xxyy * cx . xyxy ) ; cw -= cw . xxzz * cy . xyxy ; if ( cv . r == cm ) cw . rg = vec2 ( cl , cm ) ; if ( cv . g == cm ) cw . ba = vec2 ( cl , cm ) ; return cw ; } vec2 cC ( const in vec4 cz ) { vec2 cA , cB ; cB = vec2 ( cm / ck , cm ) ; cA . r = dot ( cz . rg , cB ) ; cA . g = dot ( cz . ba , cB ) ; return cA ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cK = 0.0 ; float cL = 1.0 ; vec4 cN ( vec4 cM ) { return cM - floor ( cM * ( cL / 289.0 ) ) * 289.0 ; } vec3 cN ( vec3 cO ) { return cO - floor ( cO * ( cL / 289.0 ) ) * 289.0 ; } vec2 cN ( vec2 cP ) { return cP - floor ( cP * ( cL / 289.0 ) ) * 289.0 ; } vec4 cR ( vec4 cQ ) { return cQ - floor ( cQ * ( cL / 7.0 ) ) * 7.0 ; } vec4 cT ( vec4 cS ) { return cN ( ( 34.0 * cS + 5.0 ) * cS ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 da ( vec2 cU ) { vec4 cV , cW , cX , cY ; vec2 cZ , c_ ; cZ = cN ( floor ( cU ) ) ; c_ = fract ( cU ) ; cV = c_ . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; cW = c_ . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; cX = cT ( cZ . x + vec4 ( cK , cL , cK , cL ) ) ; cX = cT ( cX + cZ . y + vec4 ( cK , cK , cL , cL ) ) ; cY = cR ( cX ) * K + K2 ; cX = cR ( floor ( cX * K ) ) * K + K2 ; cV = cV + JITTER * cY ; cY = cW + JITTER * cX ; cW = cV * cV + cY * cY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"cW . xy = min ( cW . xy , cW . zw ) ; cW . x = min ( cW . x , cW . y ) ; return cW . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cW . xy = ( cW . x < cW . y ) ? cW . xy : cW . yx ; cW . xz = ( cW . x < cW . z ) ? cW . xz : cW . zx ; cW . xw = ( cW . x < cW . w ) ? cW . xw : cW . wx ; cW . y = min ( cW . y , cW . z ) ; cW . y = min ( cW . y , cW . w ) ; return sqrt ( cW . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dj ( vec2 db , float dc ) { vec4 dd , de , df , dg ; vec2 dh , di ; dh = cN ( floor ( db ) ) ; di = fract ( db ) ; dd = di . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; de = di . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; df = cT ( dh . x + vec4 ( cK , cL , cK , cL ) ) ; df = cT ( df + dh . y + vec4 ( cK , cK , cL , cL ) ) ; dg = cR ( df ) * K + K2 ; df = cR ( floor ( df * K ) ) * K + K2 ; dd = dd + JITTER * dg ; dg = de + JITTER * df ; de = dd * dd + dg * dg ; dd += dc ; dg += dc ; df = dd * dd + dg * dg ; dd += dc ; dg += dc ; dd = dd * dd + dg * dg ; de . xy = min ( de . xy , de . zw ) ; de . x = min ( de . x , de . y ) ; df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; dd . xy = min ( dd . xy , dd . zw ) ; dd . x = min ( dd . x , dd . y ) ; return mat3 ( de . xx , cK , df . xx , cK , dd . xx , cK ) ; } vec3 dl ( vec3 dk ) { return cN ( ( ( dk * 34.0 ) + cL ) * dk ) ; } float dx ( vec2 dm ) { vec3 dn , dp , dq , dr ; vec4 ds ; vec2 dt , du , dv ; const vec4 dw = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; dt = floor ( dm + dot ( dm , dw . yy ) ) ; du = dm - dt + dot ( dt , dw . xx ) ; dv = ( du . x > du . y ) ? vec2 ( cL , cK ) : vec2 ( cK , cL ) ; ds = du . xyxy + dw . xxzz ; ds . xy -= dv ; dt = cN ( dt ) ; dn = dl ( dl ( dt . y + vec3 ( cK , dv . y , cL ) ) + dt . x + vec3 ( cK , dv . x , cL ) ) ; dp = max ( 0.5 - vec3 ( dot ( du , du ) , dot ( ds . xy , ds . xy ) , dot ( ds . zw , ds . zw ) ) , cK ) ; dp = dp * dp ; dp = dp * dp ; dn = 2.0 * fract ( dn * dw . www ) - cL ; dq = abs ( dn ) - 0.5 ; dr = floor ( dn + 0.5 ) ; dn = dn - dr ; dp *= 1.79284291400159 - 0.85373472095314 * ( dn * dn + dq * dq ) ; dr . x = dn . x * du . x + dq . x * du . y ; dr . yz = dn . yz * ds . xz + dq . yz * ds . yw ; return 130.0 * dot ( dp , dr ) ; } vec2 dB ( vec2 dy ) { float dz , dA ; dz = dot ( dy , vec2 ( 12.9898 , 78.233 ) ) ; dA = dot ( dy , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; dz = fract ( sin ( dz ) * 43758.5453 ) * 2.0 - cL ; dA = fract ( sin ( dA ) * 43758.5453 ) * 2.0 - cL ; return vec2 ( dz , dA ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dD = 0.1 ; const float dE = 0.1 ; const float dF = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dG = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dH = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dI = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool dL ( vec2 dJ , float dK ) { return all ( lessThanEqual ( dJ , vec2 ( 1.0 + dK ) ) ) && all ( greaterThanEqual ( dJ , vec2 ( 0.0 - dK ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float dX ( vec3 dM , sampler2D dN , float dO ) { vec2 dP , dQ ; mat2 dR ; float dS , dT , dU ; dM . z = clamp ( dM . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==",
"SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dS = 0.0 ; dT = dB ( dM . xy ) . x * M_PI ; dU = cos ( dT ) ; dT = sin ( dT ) ; dR = mat2 ( dU , dT , - dT , dU ) ; for ( int dV = 0 ; dV < 4 ; dV ++ ) for ( int dW = 0 ; dW < 4 ; dW ++ ) { dQ . x = dH [ dV ] [ dW ] ; dQ . y = dI [ dV ] [ dW ] ; dQ = dR * dQ ; dP = dM . xy + dQ * dO / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! dL ( dP , dF ) ) dS += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"dS += step ( dM . z , texture2D ( dN , dP ) . r ) ; } dS /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["dS","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dS , 0.0 , 1.0 ) ; } float en ( vec3 dY , sampler2D dZ , vec3 d_ , sampler2D ea , float eb , float ec , float ed ) { vec2 ee , ef ; mat2 eg ; float eh , ei , ej , ek ; dY . z = clamp ( dY . z , 0.0 , 1.0 ) ; d_ . z = clamp ( d_ . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"eh = 0.0 ; ei = 0.0 ; ej = dB ( dY . xy ) . x * M_PI ; ek = cos ( ej ) ; ej = sin ( ej ) ; eg = mat2 ( ek , ej , - ej , ek ) ; for ( int el = 0 ; el < 4 ; el ++ ) for ( int em = 0 ; em < 4 ; em ++ ) { ef . x = dH [ el ] [ em ] ; ef . y = dI [ el ] [ em ] ; ef = eg * ef ; ee = dY . xy + ef * eb / SHADOW_TEX_RES ; eh += step ( dY . z , texture2D ( dZ , ee ) . r ) ; ee = d_ . xy + ef * ec / SHADOW_TEX_RES ; ei += step ( d_ . z , texture2D ( ea , ee ) . r ) ; } eh = mix ( eh , ei , ed ) ; eh /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["eh","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( eh , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float er ( vec2 eo ) { float ep , eq ; ep = min ( eo . x , eo . y ) ; eq = min ( 1.0 - eo . x , 1.0 - eo . y ) ; return min ( ep , eq ) ; } float eu ( float es , float et ) { if ( et >= 0.0 && et <= dE ) es = ( es - 1.0 ) / dE * et + 1.0 ; return es ; } float eF ( vec3 ev , vec3 ew , sampler2D ex , sampler2D ey , float ez , float eA , float eB , float eC ) { float eD , eE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"eE = er ( ev . xy ) ; if ( - eC > eB && eE >= 0.0 && eE <= dD && dL ( ew . xy , 0.0 ) ) { eE = 1.0 - eE / dD ; eD = en ( ev , ex , ew , ey , ez , eA , eE ) ; } else".split(" ")}]}}]},{type:"textline",b:"eD = dX ( ev , ex , ez ) ; return eD ; } float eN ( vec3 eG , sampler2D eH , float eI , float eJ , float eK ) { float eL , eM ; eL = dX ( eG , eH , eI ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eK > eJ ) { eM = er ( eG . xy ) ; eL = eu ( eL , eM ) ; }".split(" ")}]}}]},{type:"textline",b:"return eL ; } float eU ( float eO ) { vec3 eP , eQ , eR , eS ; float eT ; eT = 1.0 ; eP = cE . xyz / cE . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"eQ = cF . xyz / cF . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"eR = cG . xyz / cG . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eS = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( dL ( eP . xy , 0.0 ) ) { eT = eF ( eP , eQ , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , eO ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( dL ( eP . xy , dG ) ) { eT = eN ( eP , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , eO ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eQ . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"eT = eF ( eQ , eR , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , eO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eT = eN ( eQ , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , eO ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eR . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eT = eF ( eR , eS , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , eO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eT = eN ( eR , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , eO ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eS . xy , 0.0 ) ) eT = eN ( eS , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , eO ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","eT",";","}"]}]}}]}]}}]},{type:"textline",b:"float eZ ( inout vec3 eV ) { float eW ; vec3 eX ; vec2 eY ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"eY = texture2DProj ( u_shadow_mask , cI ) . rg ; eX = vec3 ( eY . r ) ; eW = eY . g ; dC = vec4 ( eX , eW ) ; eV *= dC . a ; return dC . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return eU ( cJ . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fd ( vec3 e_ , float fa , vec2 fb ) { vec2 fc ; fc = vec2 ( ( e_ . x - fb . x ) / fa , - ( e_ . z - fb . y ) / fa ) ; return fract ( fc ) ; } vec2 fh ( vec2 fe , float ff , vec2 fg ) { return vec2 ( fe . x * ff , - fe . y * ff ) + fg ; } d fi ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d fE ( vec3 fj , vec3 fk , vec3 fl , vec3 fm , vec3 fn , sampler2D fo , sampler2D fp , vec3 fq , float fr , vec3 fs , vec4 ft , mat4 fu ) { mat4 fv ; vec4 fw ; vec2 fx , fy , fz ; float fA , fB ; vec3 fC ; fC = j ( ft , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; fA = - fC . x ; fB = - fC . z ; fx = vec2 ( fs . x + fr * ( - 1.0 - fA ) / 2.0 , fs . z + fr * ( 1.0 - fB ) / 2.0 ) ; fy = fd ( fn , fr , fx ) ; fA = fr / 2.0 ; fz = abs ( fh ( fy - vec2 ( 0.5 ) , fr , vec2 ( 0.0 ) ) ) ; fB = fA * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fz ) > fB ) return fi ( ) ; fA = fr / fq . z ; fz = ( fy - vec2 ( 0.5 ) ) * fA + vec2 ( 0.5 ) ; fC = fC * ( fr / fq . z - 1.0 ) / 2.0 ; fz . x += fC . x ; fz . y -= fC . z ; fw = texture2D ( fp , fz ) ; fB = fw . r ; if ( fB < u_scale_threshold ) return fi ( ) ; fA = fq . y - fq . x ; fA = fq . y - texture2D ( fo , fz ) . r * fA ; fz = fj . xz - fn . xz ; fn . xz = fh ( fy , fr , fx ) ; fn . y = fA ; fj . xz = fn . xz + fz ; fj . y *= fB ; fj . y += fA ; fC = fw . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fj -= fn ; fv = ai ( fs , fn , fu ) ; d fD = av ( fj , fn , fk , fl , fm , fv ) ; fD . b = fn ; fD . f = fC ; return F ( fD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return F ( d ( fj , fn , fk , fl , fm , fC ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",a:[{type:"if",
c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 fK ( mat4 fF , vec4 fG ) { vec4 fH ; float fI ; vec2 fJ ; fJ = ( fF * u_v_light_matrix [ 3 ] ) . xy ; fI = SHADOW_TEX_RES / 2.0 ; fJ = floor ( fJ * fI + 0.5 ) / fI - fJ ; fH = fF * fG ; fH . xy += fJ ; fH = u_b_light_matrix * fH ; return fH ; } void fO ( vec3 fL ) { vec4 fM ; vec3 fN ; fN = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; fM = u_v_light_matrix * vec4 ( fL + u_normal_offset * fN , 1.0 ) ; cE = fK ( u_p_light_matrix0 , fM ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cF = fK ( u_p_light_matrix1 , fM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cG = fK ( u_p_light_matrix2 , fM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cH = fK ( u_p_light_matrix3 , fM ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void fO ( vec4 fP ) { float fQ , fR , fS ; fQ = fP . x ; fR = fP . y ; fS = fP . w ; cI . x = ( fQ + fS ) / 2.0 ; cI . y = ( fR + fS ) / 2.0 ; cI . z = fS ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void fV ( inout vec3 fU ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"fU = max ( vec3 ( 0.0 ) , fU ) ; fU = pow ( fU , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void fX ( inout vec3 fW ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"fW = max ( vec3 ( 0.0 ) , fW ) ; fW = pow ( fW , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void f_ ( inout vec3 fY , in float fZ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"fY = fY * fZ ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gg ( inout vec3 gc , in float gd , in vec4 ge ) { float gf ; gf = ge . w * gd ; gf = exp ( - gf * gf ) ; gf = clamp ( gf , 0.0 , 1.0 ) ; gc = mix ( ge . rgb , gc , gf ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gm ( in mat4 gh , in vec3 gi ) { vec3 gj , gk , gl ; gj = mix ( gh [ 0 ] . rgb , gh [ 1 ] . rgb , max ( sign ( gi . x ) , 0.0 ) ) ; gk = mix ( gh [ 2 ] . rgb , gh [ 3 ] . rgb , max ( sign ( gi . z ) , 0.0 ) ) ; gl = vec3 ( gh [ 0 ] . a , gh [ 1 ] . a , gh [ 2 ] . a ) ; gj = mix ( gj , gk , abs ( gi . z ) ) ; gj = mix ( gj , gl , abs ( gi . y ) ) ; return gj ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void go ( inout float gn ) { gn -= 0.5 ; gn = 4.0 * ( gn * gn * gn ) + 0.5 ; } void gC ( inout vec3 gp , in float gq , in vec3 gr , in float gs , in vec4 gt , in vec4 gu , in float gv , in float gw ) { vec3 gx , gy ; float gz , gA , gB ; gz = gu . w * gq ; gz = exp ( - gz * gz ) ; gz = clamp ( gz , 0.0 , 1.0 ) ; gA = max ( gr . y , 0.0 ) ; gq = max ( gq - max ( gs / gA , 0.0 ) , 0.0 ) ; gB = gt . w * gq ; gB = 1.0 - gB ; gB = max ( gB , 0.0 ) ; go ( gB ) ; gB += max ( gv - 0.5 , 0.0 ) ; if ( gB < gz ) { gx = vec3 ( 0.0 , 0.02 , 0.05 ) ; gy = gt . rgb ; gs = clamp ( - gs * 0.03 , 0.0 , 0.8 ) ; gy = mix ( gy , gx , min ( gA , 1.0 ) ) ; gy = mix ( gy , vec3 ( 0.0 ) , gs ) * gw ; gp = mix ( gy , gp , gB ) ; } if ( gB >= gz ) { gp = mix ( gu . rgb , gp , gz ) ; } } void gK ( inout vec3 gD , in float gE , in float gF , in vec4 gG , in float gH ) { vec3 gI ; float gJ ; gJ = gG . w * gE ; gJ = 1.0 - gJ ; gJ = clamp ( gJ , 0.0 , 1.0 ) ; go ( gJ ) ; gF = clamp ( - gF * 0.03 , 0.0 , 0.8 ) ; gI = mix ( gG . rgb , vec3 ( 0.0 ) , gF ) * gH ; gD = mix ( gI , gD , gJ ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",
b:"float gL = 0.0 ; float gM = 1.0 ; float gN = 0.5 ; struct gO { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float gW ( vec3 gP , vec3 gQ , vec3 gR , float gS , float gT ) { float gU ; vec3 gV ; gV = normalize ( gP + gQ ) ; gU = ( gM - gS ) * max ( dot ( gR , gV ) , gL ) + gS ; return pow ( gU , gT ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hf ( vec3 gX , vec3 gY , vec3 gZ , float g_ ) { float ha , hb , hc , hd ; vec3 he ; he = normalize ( gX + gY ) ; ha = max ( dot ( gZ , he ) , 0.001 ) ; hb = max ( dot ( gZ , gY ) , 0.01 ) ; hc = max ( dot ( gZ , gX ) , 0.01 ) ; ha = tan ( acos ( ha ) ) ; hd = max ( g_ , 0.001 ) ; return hc * ( gM / ( 4.0 * M_PI * hd * hd ) ) * ( exp ( - ( ha * ha ) / ( hd * hd ) ) / ( sqrt ( hb * hc ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hn ( vec3 hg , vec3 hh , vec3 hi , float hj , float hk ) { float hl ; vec3 hm ; hm = normalize ( hg + hh ) ; hl = acos ( dot ( hm , hi ) ) ; if ( hl < hj ) return gM ; else if ( hl >= hj + hk || hk == gL ) return gL ; else return gM - ( hl - hj ) / hk ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void hC ( float ho , vec3 hp , vec3 hq , vec3 hr , float hs , inout float ht ) { vec3 hu , hv ; float hw , hx , hy , hz , hA , hB ; if ( hs > gL ) { hw = max ( dot ( hp , hr ) , gL ) ; hx = hs * hs ; hy = gM - gN * ( hx / ( hx + 0.33 ) ) ; hu = hq - ho * hp ; hv = hr - hw * hp ; if ( length ( hu ) == gL || length ( hv ) == gL || abs ( ho ) > gM || abs ( hw ) > gM ) ht = ht * hy ; else { hz = acos ( ho ) ; hw = acos ( hw ) ; hu = normalize ( hu ) ; hv = normalize ( hv ) ; hA = max ( hz , hw ) ; hB = min ( hz , hw ) ; hB *= 0.95 ; hz = max ( dot ( hu , hv ) , gL ) ; hw = 0.45 * ( hx / ( hx + 0.09 ) ) ; ht = ht * ( hy + ( hw * hz * sin ( hA ) * tan ( hB ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void hJ ( vec3 hD , vec3 hE , float hF , float hG , out float hH ) { float hI ; if ( hF == gL ) { hH = gM ; } else { hI = gM + abs ( dot ( hE , hD ) ) ; hI = hG + ( gM - hG ) * pow ( hI , hF ) ; hH = clamp ( hI , gL , gM ) ; } }".split(" ")}]}}]},{type:"textline",b:"void hR ( vec3 hK , vec3 hL , vec3 hM , vec2 hN , const float hO , out float hP ) { float hQ ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"hJ ( hK , hL , hN [ 0 ] , hN [ 1 ] , hP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hQ = max ( dot ( hK , hL ) , gL ) ; hP = ( gM - hO ) * hQ + hO ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"hC ( hQ , hK , hL , hM , hN [ 0 ] , hP ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} void hY ( vec3 hS , vec3 hT , vec3 hU , float hV , vec2 hW , out float hX ) {".split(" ")},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"hX = gW ( hS , hT , hU , hV , hW [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"hX = hf ( hS , hT , hU , hW [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"hX = hn ( hS , hT , hU , hW [ 0 ] , hW [ 1 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["hX","=","gL",";"]}]}}]},{type:"textline",b:"} void iv ( vec3 hZ , vec3 h_ , vec3 ia , vec2 ib , vec4 ic , vec3 id , vec3 ie , vec3 ig , inout gO ih , float ii , vec2 ij , vec2 ik , float il ) { float im , io , ip , iq , ir , is , it , iu ; im = gL ; if ( ib . r != gL ) hR ( ia , h_ , hZ , ij , il , im ) ; io = gL ; if ( ib . g != gL ) hY ( h_ , hZ , ia , il , ik , io ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],
group:{type:"group",a:[{type:"textline",b:"if ( dot ( h_ , ia ) * dot ( hZ , ia ) < gL ) { ip = ic . x ; iq = ic . y ; ir = ic . z ; is = ic . w ; it = clamp ( abs ( dot ( h_ , ia ) ) , gL , gM ) ; iu = clamp ( dot ( hZ , - h_ ) , gL , gM ) ; iu = pow ( iu , iq ) ; ih . a += ii * vec4 ( ig * it * pow ( id , vec3 ( ip ) ) , gM ) ; ih . a += ir * mix ( vec4 ( id , gM ) , vec4 ( gM ) , is ) * ii * vec4 ( ig * it * vec3 ( iu ) , gM ) ; } else { ih . b += ig * ie * io ; ih . a += vec4 ( ig * id * im , io ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ih . b += ig * ie * io ; ih . a += vec4 ( ig * id * im , io ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"lamp",name:"POINT",f:[{type:"textline",b:"iY = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iQ = iG [ LAMP_IND ] ; iR = iI [ LAMP_IND ] ; iM = gL ;".split(" ")},{type:"textline",b:"iR = iR ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iR *= iF ; iQ = iQ - iA ;".split(" ")},{type:"textline",b:"iN = length ( iQ ) ; iR *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + iN * iN ) ; iQ = normalize ( iQ ) ; iv ( iC , iQ , iB , iY , iL , iy , iz , iR , jb , iK , iE , iD , iM ) ;".split(" ")}]},
{type:"lamp",name:"SPOT",f:[{type:"textline",b:"iZ = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iS = iG [ LAMP_IND ] ; iT = iI [ LAMP_IND ] ; iU = iH [ LAMP_IND ] ; iN = gL ;".split(" ")},{type:"textline",b:"iT = iT ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iT *= iF ; iS = iS - iA ;".split(" ")},{type:"textline",b:"iO = length ( iS ) ; iT *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + iO * iO ) ; iS = normalize ( iS ) ;".split(" ")},{type:"textline",b:"iO = dot ( iS , iU ) ; iO *= smoothstep ( gL , gM , ( iO - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; iT *= iO ; iv ( iC , iS , iB , iZ , iL , iy , iz , iT , jb , iK , iE , iD , iN ) ;".split(" ")}]},
{type:"lamp",name:"SUN",f:[{type:"textline",b:"i_ = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iU = iI [ LAMP_IND ] ; iV = iH [ LAMP_IND ] ; iO = gL ;".split(" ")},{type:"textline",b:"iU = iU ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iU *= iF ; iv ( iC , iV , iB , i_ , iL , iy , iz , iU , jb , iK , iE , iD , iO ) ;".split(" ")}]},{type:"lamp",name:"HEMI",f:[{type:"textline",b:"ja = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iW = iI [ LAMP_IND ] ; iX = iH [ LAMP_IND ] ; iP = gN ;".split(" ")},
{type:"textline",b:"iW = iW ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iW *= iF ; iv ( iC , iX , iB , ja , iL , iy , iz , iW , jb , iK , iE , iD , iP ) ;".split(" ")}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO jc ( vec3 iw , vec3 ix , vec3 iy , vec3 iz , vec3 iA , vec3 iB , vec3 iC , vec2 iD , vec2 iE , float iF , vec3 iG [ NUM_LIGHTS ] , vec3 iH [ NUM_LIGHTS ] , vec3 iI [ NUM_LIGHTS ] , vec4 iJ [ NUM_LFACTORS ] , float iK , vec4 iL ) { float iM , iN , iO , iP ; vec3 iQ , iR , iS , iT , iU , iV , iW , iX ; vec2 iY , iZ , i_ , ja ; gO jb ; jb . a = vec4 ( iw + iy * ix , gL ) ; jb . b = vec3 ( gL ) ;".split(" ")},
{type:"lamps_main"},{type:"textline",b:["return","jb",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO jh ( vec3 jd , vec3 je , vec3 jf ) { gO jg ; jg . a = vec4 ( jd + jf * je , gL ) ; jg . b = vec3 ( gL ) ; return jg ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},
{type:"textline",b:"void jA ( inout vec3 ji , float jj , float jk , float jl , vec3 jm , vec3 jn , vec3 jo , vec4 jp , vec3 jq , float jr ) { mat3 js ; float jt , ju , jv , jw ; vec2 jx ; vec3 jy ; vec4 jz ; if ( jr > CAUSTICS_VIEW_DISTANCE ) return ; jz = jp ; jy = jq + jm ; jy . xz = 10.0 * sin ( 0.1 * jy . xz ) ; jy = jy + 2.0 * cross ( - jz . xyz , cross ( - jz . xyz , jy ) + jz . w * jy ) ; jx = jy . xz ; jy = jn ; jt = max ( dot ( jm , jy ) , 0.0 ) ; ju = 0.025 ; jx . s += 0.5 * sin ( dot ( jq + jk , vec3 ( 1.0 ) ) ) ; jx . t += 0.7 * ( - sin ( dot ( jq - jk , vec3 ( - 0.7 ) ) ) ) ; jx . st += 0.23 * cos ( 4.0 * jj - CAUST_SPEED . x * jk ) ; jx . st += 3.0 * sin ( jj - 0.3 * CAUST_SPEED . y * jk ) ; jv = CAUST_SCALE * ( 1.0 + max ( 0.1 * jj , 0.0 ) ) ; js = dj ( ( jx / jv ) , ju ) ; jv = ( js * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; ju = ( js * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; jw = ( js * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; jy = CAUST_BRIGHT * vec3 ( jv , ju , jw ) ; jv = jl * jt ; ju = max ( sign ( jj ) , 0.0 ) ; jv = min ( jv + 0.5 * sign ( - jm . y ) * ju , 1.0 ) ; jv *= 1.0 - ju * ( 0.1 * jj ) ; jy *= jv ; jy *= jy ; jw = min ( - jj + 10.0 , 1.0 ) ; ji += max ( ( 2.0 * jo * jy ) * jw , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || REFLECTION_TYPE == REFL_CUBE || REFLECTION_TYPE == REFL_MIRRORMAP".split(" "),group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float jN ( in vec3 jH , vec3 jI , float jJ , float jK ) { float jL ; vec3 jM ; jM = normalize ( jI + jH ) ; jL = 1.0 - dot ( jH , jM ) ; jL = jK + ( 1.0 - jK ) * pow ( jL , jJ ) ; return jL ; } void j_ ( inout vec3 jO , vec3 jP , vec3 jQ , float jR ) { vec2 jS , jT ; float jU , jV , jW ; vec3 jX , jY , jZ ; jX = reflect ( - jP , jQ ) ; jU = u_fresnel_params [ 2 ] ; jV = u_fresnel_params [ 3 ] ; jW = 1.0 ; if ( jU != 0.0 ) jW = jN ( jP , jX , jU , jV ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_CUBE"],group:{type:"group",a:[{type:"textline",b:"jY = textureCube ( u_cube_reflection , jX ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:"jZ = u_refl_plane . xyz * dot ( jQ , u_refl_plane . xyz ) ; jZ = jQ - jZ ; jS = ( u_view_matrix_frag * vec4 ( jZ , 0.0 ) ) . xy ; jT = cI . xy / cI . z ; jT += jS * REFL_BUMP ; jY = texture2D ( u_plane_reflection , jT ) . rgb ;".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:"jY = textureCube ( u_mirrormap , jX ) . xyz ; jR = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"fV ( jY . rgb ) ; jO = mix ( jO , jY , jR * jW ) ; }".split(" ")}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",
b:"float kf ( in float ka , inout vec2 kb , in vec2 kc ) { float kd ; vec4 ke ; ke = texture2D ( u_scene_depth , kb ) ; kd = cu ( ke ) ; if ( kd < jG ) { kb = kc ; return ka ; } else { return kd ; } return ka ; }".split(" ")}]}}]},{type:"textline",b:"vec3 kn ( in vec3 kg , in vec2 kh ) { vec3 ki ; float kj ; vec4 kk ; vec2 kl , km ; kl = kg . xy / kg . z ; km = kl + kh ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"kk = texture2DProj ( u_scene_depth , kg ) ; kj = cu ( kk ) ; kf ( kj , km , kl ) ;".split(" ")}]}}]},
{type:"textline",b:"ki = texture2D ( u_refractmap , km ) . rgb ; fV ( ki ) ; return ki ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 kq ( vec3 ko ) { float kp ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , ko ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",
a:[{type:"textline",b:"kp = 0.5 * ko . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , kp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct kU { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void k_ ( inout float kV , float kW , vec2 kX , vec2 kY ) { float kZ ; kZ = kY . x - kX . x ; kZ = ( kW - kX . x ) / kZ ; kV = mix ( kV , kY . y , clamp ( kZ , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void lf ( inout vec3 la , float lb , vec4 lc , vec4 ld ) { float le ; le = ld . x - lc . x ; le = ( lb - lc . x ) / le ; la = mix ( la , ld . yzw , clamp ( le , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float ll ( float lg , float lh , vec2 li [ SIZE_RAMP_LENGTH ] ) { float lj , lk ; lj = lg / lh ; lk = li [ 0 ] . y ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"k_ ( lk , lj , li [ 0 ] , li [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",
b:"k_ ( lk , lj , li [ 1 ] , li [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"k_ ( lk , lj , li [ 2 ] , li [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","lk",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lr ( float lm , float ln , vec4 lo [ COLOR_RAMP_LENGTH ] ) { vec3 lp ; float lq ; lq = lm / ln ; lp = lo [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"lf ( lp , lq , lo [ 0 ] , lo [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"lf ( lp , lq , lo [ 1 ] , lo [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"lf ( lp , lq , lo [ 2 ] , lo [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",
b:["return","lp",";","}"]}]}}]},{type:"textline",b:"float lz ( float ls , float lt , float lu , float lv ) { float lw , lx , ly ; lw = max ( 0.01 , min ( lt , lu ) ) ; lx = max ( 0.01 , min ( lt , lv ) ) ; ly = lt - lx ; lw = clamp ( ls / lw , 0.0 , 1.0 ) - step ( ly , ls ) * ( ls - ly ) / lx ; return lw ; } kU lF ( ) { vec3 lA , lB ; float lC , lD ; kU lE ; if ( u_p_cyclic == 1 ) { lC = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( lC < 0.0 ) lC += u_p_length ; } if ( u_p_cyclic != 1 ) { lC = u_p_time - a_p_delay ; } if ( lC < 0.0 || lC >= a_p_lifetime ) { lE . a = 0.0001 ; lE . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( lC < 0.0 || lC >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"lA = a_position ; lB = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lA = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; lB = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"lA += u_p_nfactor * lC * lB ; lA += a_p_vels . xyz * lC ; lA . y -= u_p_gravity * lC * lC / 2.0 ; lD = max ( u_p_mass , EPSILON ) ; lA += ( u_p_wind / lD ) * lC * lC / 2.0 ; lE . b = lA ; lE . e = a_p_vels . w * lC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lE . a = ll ( lC , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lE . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lE . d = lr ( lC , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lE . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"lE . c = lz ( lC , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return lE ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float lH = 0.0 ; float lI = 1.0 ; vec3 lJ = vec3 ( lH ) ; vec3 lK = vec3 ( lI ) ; vec3 lP ( vec3 lL ) { float lM , lN ; vec4 lO ; lO = vec4 ( lH , - lI / 3.0 , 2.0 / 3.0 , - lI ) ; lO = mix ( vec4 ( lL . bg , lO . wz ) , vec4 ( lL . gb , lO . xy ) , step ( lL . b , lL . g ) ) ; lO = mix ( vec4 ( lO . xyw , lL . r ) , vec4 ( lL . r , lO . yzx ) , step ( lO . x , lL . r ) ) ; lM = lO . x - min ( lO . w , lO . y ) ; lN = 1.0e-10 ; return vec3 ( abs ( lO . z + ( lO . w - lO . y ) / ( 6.0 * lM + lN ) ) , lM / ( lO . x + lN ) , lO . x ) ; } vec3 lT ( vec3 lQ ) { vec3 lR ; vec4 lS ; lS = vec4 ( lI , 2.0 / 3.0 , lI / 3.0 , 3.0 ) ; lR = abs ( fract ( vec3 ( lQ . r , lQ . r , lQ . r ) + lS . xyz ) * 6.0 - lS . www ) ; return lQ . b * mix ( lS . xxx , clamp ( lR - lS . xxx , lH , lI ) , lQ . g ) ; } vec3 lX ( vec3 lU , vec3 lV , float lW ) { return mix ( lU , lV , lW ) ; } vec3 ma ( vec3 lY , vec3 lZ , float l_ ) { return l_ * lY + lZ ; } vec3 me ( vec3 mb , vec3 mc , float md ) { return mc - md * mb ; } vec3 mj ( vec3 mf , vec3 mg , float mh ) { float mi ; mi = lI - mh ; return ( vec3 ( mi ) + mh * mf ) * mg ; } vec3 mo ( vec3 mk , vec3 ml , float mm ) { vec3 mn ; mn = vec3 ( lI - mm ) ; return lK - ( mn + mm * ( lK - mk ) ) * ( lK - ml ) ; } vec3 mt ( vec3 mp , vec3 mq , float mr ) { vec3 ms ; ms = vec3 ( lI - mr ) ; return mix ( mq * ( ms + 2.0 * mr * mp ) , lK - ( ms + 2.0 * mr * ( lK - mp ) ) * ( lK - mq ) , step ( 0.5 , mq ) ) ; } vec3 mx ( vec3 mu , vec3 mv , float mw ) { return mix ( mv , abs ( mu - mv ) , mw ) ; } vec3 mB ( vec3 my , vec3 mz , float mA ) { return mix ( mz , mz / ( my + step ( my , lJ ) ) , mA ) ; } vec3 mF ( vec3 mC , vec3 mD , float mE ) { return mix ( mD , min ( mC , mD ) , mE ) ; } vec3 mJ ( vec3 mG , vec3 mH , float mI ) { return max ( mI * mG , mH ) ; } vec3 mP ( vec3 mK , vec3 mL , float mM ) { vec3 mN , mO ; mN = lP ( mL ) ; if ( mN . y != lH ) { mO = lP ( mK ) ; mN = lT ( vec3 ( mN . x , mO . yz ) ) ; return mix ( mK , mN , mM ) ; } return mK ; } vec3 mV ( vec3 mQ , vec3 mR , float mS ) { vec3 mT , mU ; mT = lP ( mQ ) ; if ( mT . y != lH ) { mU = lP ( mR ) ; return lT ( vec3 ( mT . x , mix ( mT . y , mU . y , mS ) , mT . z ) ) ; } return mQ ; } vec3 na ( vec3 mW , vec3 mX , float mY ) { vec3 mZ , m_ ; mZ = lP ( mW ) ; m_ = lP ( mX ) ; return lT ( vec3 ( mZ . xy , mix ( mZ . z , m_ . z , mY ) ) ) ; } vec3 ng ( vec3 nb , vec3 nc , float nd ) { vec3 ne , nf ; ne = lP ( nc ) ; if ( ne . y != lH ) { nf = lP ( nb ) ; ne = lT ( vec3 ( ne . xy , nf . z ) ) ; return mix ( nb , ne , nd ) ; } return nb ; } vec3 nl ( vec3 nh , vec3 ni , float nj ) { vec3 nk ; nk = lK - ( lK - ni ) * ( lK - nh ) ; return mix ( nh , ( ( lK - nh ) * ni * nh ) + nh * nk , nj ) ; } vec3 np ( vec3 nm , vec3 nn , float no ) { return nm + no * ( 2.0 * nn - lI ) ; } float nv ( float nq , float nr , float ns , float nt ) { float nu ; nu = lI - nt ; return ( nu + ns * nq ) * nr ; } float nB ( float nw , float nx , float ny , float nz ) { float nA ; nA = lI - nz ; return lI - ( nA + ny * ( lI - nw ) ) * ( lI - nx ) ; } float nH ( float nC , float nD , float nE , float nF ) { float nG ; nG = lI - nF ; return mix ( nD * ( nG + 2.0 * nE * nC ) , lI - ( nG + 2.0 * nE * ( lI - nC ) ) * ( lI - nD ) , step ( 0.5 , nD ) ) ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float nS ( in sampler2D nM , in vec2 nN , in vec2 nO ) { float nP , nQ , nR ; nP = texture2D ( nM , nN ) . r ; nQ = nO . x ; nR = nO . y ; nP = 2.0 * nQ / ( nQ + nR - ( 2.0 * nP - 1.0 ) * ( nR - nQ ) ) ; return nP ; }".split(" ")}]}};b4w.module.animation=function(a,m){var c=m("__animation"),d=m("__constraints");m("__physics");var b=m("__print"),e=m("__util");a.SLOT_0=c.SLOT_0;a.SLOT_1=c.SLOT_1;a.SLOT_2=c.SLOT_2;a.SLOT_3=c.SLOT_3;a.SLOT_4=c.SLOT_4;a.SLOT_5=c.SLOT_5;a.SLOT_6=c.SLOT_6;a.SLOT_7=c.SLOT_7;a.SLOT_ALL=c.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=c.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=c.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=c.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=c.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
c.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=c.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=c.AB_CYCLIC;a.AB_FINISH_RESET=c.AB_FINISH_RESET;a.AB_FINISH_STOP=c.AB_FINISH_STOP;var h=new Float32Array(4);a.is_animated=function(a){return c.is_animated(a)};a.get_actions=function(){b.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],d=c.vq(),e=0;e<d.length;e++)a.push(c.XA(d[e].name));return a};a.get_current_action=function(c,d){b.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(c,d)};a.get_anim_names=function(a){return c.ek(a)?c.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.Wx(a,b)};a.apply=function(a,d,e){if(e>c.SLOT_7)b.error("Can't apply animation to slot "+e+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{e=e||c.SLOT_0;if(c.is_animated(a)){var g=c.get_slot_num_by_anim(a,d);if(-1!=g&&g!=e){b.error('Animation "'+d+'" is already applied to object "'+
a.name+'" (slot "'+g+'").');return}}c.ZB(a,d)?c.apply(a,d,e):b.error('No fcurves in action "'+d+'"')}};a.remove=function(a){c.remove(a)};a.remove_slot_animation=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.remove_slot_animation(a,b))};a.apply_def=function(a){c.apply_def(a)};a.play=function(a,d,e){c.is_animated(a)?(e=e||c.SLOT_0,c.play(a,d,e),c.update_object_animation(a,0,e,!0)):b.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.stop(a,
b))};a.is_play=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_play(a,b)};a.set_current_frame_float=function(c,d,e){b.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(c,d,e)};a.get_current_frame_float=function(c,d){b.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(c,d)};a.set_frame=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_current_frame_float(a,b,d),c.update_object_animation(a,0,d,!0))};
a.get_frame=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_current_frame_float(a,b)};a.set_speed=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_speed(a,b||1,d))};a.get_speed=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return a.C[b]?c.get_speed(a,b):0};a.get_frame_range=function(a,d){b.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(c.is_animated(a)){d=d||c.SLOT_0;var e=a.C[d];if(e)return[e.start,e.start+
e.length]}return null};a.get_anim_start_frame=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.C[b])?c.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.C[b])?c.get_anim_length(a,b):-1};a.cyclic=function(d,e,h){b.error("cyclic() deprecated, use set_behavior() instead");a.set_behavior(d,e?c.AB_CYCLIC:c.AB_FINISH_RESET,h)};a.is_cyclic=function(a,d){b.error("is_cyclic() deprecated, use get_behavior() instead");if(!c.is_animated(a))return!1;
d=d||c.SLOT_0;return c.is_cyclic(a,d)};a.set_behavior=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_behavior(a,b,d))};a.get_behavior=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.get_behavior(a,b)};a.apply_smoothing=function(a,b,d,e){e=e||c.SLOT_0;c.is_animated(a)&&c.apply_smoothing(a,b,d,e)};a.update_object_animation=function(a,b,d,e){c.is_animated(a)&&(d=d||c.SLOT_0,c.update_object_animation(a,b||0,d,e||!1))};a.frame_to_sec=function(a){return c.frame_to_sec(a)};
a.get_bone_translation=function(a,b,c){if(!e.is_armature(a))return null;c||(c=new Float32Array(3));d.$x(a,b,!1,h,null);c[0]=h[0];c[1]=h[1];c[2]=h[2];return c};a.get_first_armature_object=function(a){return e.is_mesh(a)?c.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return c.is_animated(a)&&b?c.get_slot_num_by_anim(a,b):null};a.get_anim_type=function(a,b){return c.is_animated(a)?c.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return c.apply_to_first_empty_slot(a,
b)};a.get_skel_mix_factor=function(a){return a.d.De};a.set_skel_mix_factor=function(a,d,h){e.is_armature(a)?(d=Math.min(Math.max(d,0),1),a.d.De!=d&&c.set_skel_mix_factor(a,d,h||0)):b.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,m){var c=m("__anchors");m("__print");a.attach_move_cb=c.attach_move_cb;a.detach_move_cb=c.detach_move_cb};b4w.module.assets=function(a,m){var c=m("__assets");a.AT_ARRAYBUFFER=c.AT_ARRAYBUFFER;a.AT_JSON=c.AT_JSON;a.AT_TEXT=c.AT_TEXT;a.AT_AUDIOBUFFER=c.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=c.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=c.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,e){c.enqueue(a,b,e)}};b4w.module.camera=function(a,m){function c(a,c){if(b.is_camera(a))return c||(c=new Float32Array(3)),g.copy(a.d.g,c),c;h.error("get_eye(): Wrong object")}function d(a,c){b.is_target_camera(a)?(g.copy(c,a.d.Gb),f.w(a),e.sync_transform(a)):h.error("set_pivot(): Wrong object or camera move style")}var b=m("__camera");m("__config");var e=m("__physics"),h=m("__print"),k=m("__constraints"),f=m("__transform"),n=m("__util"),g=m("vec3"),l=m("vec4");m("quat");var y=m("mat3"),p=m("mat4"),w=new Float32Array(2),
z=new Float32Array(3),E=new Float32Array(3),B=new Float32Array(4),v=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=b.is_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,d){if(!b.is_camera(a))return h.error("set_move_style(): Wrong object"),!1;if(d!=b.MS_STATIC&&
d!=b.MS_EYE_CONTROLS&&d!=b.MS_HOVER_CONTROLS&&d!=b.MS_TARGET_CONTROLS)return h.error("set_move_style(): Wrong camera move style"),!1;a.d.sa=d;a.d.Qb=null;a.d.ad=null;a.d.ub=null;a.d.Qa=!1;b.Gy(a);switch(d){case b.MS_TARGET_CONTROLS:var k=c(a,z),l=n.quat_to_dir(a.d.quat,n.AXIS_MY,E),k=g.scaleAndAdd(k,l,10,l);g.copy(k,a.d.Gb)}f.w(a);e.sync_transform(a);return!0};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(h.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=
function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return h.error("set_velocity_params(): Wrong object or camera move style"),null;var d=a.d;d.xo=n.clamp(c[0],0,Infinity);d.wo=n.clamp(c[1],0,Infinity);d.yo=n.clamp(c[2],0,1)};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return h.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var d=a.d;c[0]=d.xo;c[1]=d.wo;
c[2]=d.yo;return c};a.set_look_at=function(a,c,d,g){var h=a.d;b.wx(c,d,g,h.g,h.quat);f.w(a);e.sync_transform(a)};a.get_eye=c;a.set_pivot=d;a.set_trans_pivot=function(a,c,d){b.is_target_camera(a)?(g.copy(c,a.d.g),g.copy(d,a.d.Gb),f.w(a),e.sync_transform(a)):h.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.is_target_camera(a))return c||(c=new Float32Array(3)),g.copy(a.d.Gb,c),c;h.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(b,
c,d){h.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,d)};a.move_pivot=function(a,c,d){if(b.is_target_camera(a)){var k=a.d;if(k.qt){var l=y.fromMat4(k.U,v),p=g.subtract(k.g,k.Gb,E);z[0]=c;z[1]=0;z[2]=d;g.scale(z,g.len(p),z);g.transformMat3(z,l,z);g.add(k.Gb,z,k.Gb);g.add(k.g,z,k.g);f.w(a);e.sync_transform(a)}}else h.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){h.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){h.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,w)[1]:(h.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){h.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.is_hover_camera(a))if(a.d.Qa){var d=b.get_camera_angles(a,w);(d=-c-d[1])&&b.rotate_hover_camera(a,
0,d);f.w(a);e.sync_transform(a)}else h.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else h.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.is_hover_camera(a))return a.d.ub?(c||(c=new Float32Array(2)),c[0]=a.d.ub.Na,c[1]=a.d.ub.Wa):h.error("get_hover_angle_limits(): camera hasn't angle limits"),c;h.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.is_hover_camera(a)||
b.is_target_camera(a))return a.d.Qa?(c||(c=new Float32Array(2)),c[0]=a.d.Nf,c[1]=a.d.Yd):h.error("get_cam_dist_limits(): camera hasn't distance limits"),c;h.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(b,c){h.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var d=a.d;if(d.Qa){var k=g.subtract(c,d.g,z);g.add(k,d.Rb,d.Rb)}f.set_translation(a,
c);f.w(a);e.sync_transform(a)}else h.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,c){if(b.is_hover_camera(a)){var d=a.d;if(d.Qa&&d.ub){var k=g.subtract(c,d.Rb,z),k=g.add(k,d.g,k);f.set_translation(a,k)}g.copy(c,d.Rb);f.w(a);e.sync_transform(a)}else h.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return h.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));g.copy(a.d.Rb,
c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.d.Qa:(h.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,d,g){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:g|=f.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){h.error("apply_vertical_limits(): wrong vertical limits");return}break;default:h.error("apply_vertical_limits(): wrong object");return}a.d.ad={Na:c,Wa:d};b.Gz(a,g==f.SPACE_LOCAL);
f.w(a);e.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.ad=null};a.apply_horizontal_limits=function(a,c,d,g){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:g|=f.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){h.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:h.error("apply_horizontal_limits(): wrong object");return}a.d.Qb={left:c,right:d};b.Cz(a,g==f.SPACE_LOCAL);f.w(a);e.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.Qb=
null};a.get_horizontal_limits=function(a,c){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)){var d=a.d;c=c||new Float32Array(2);if(d.Qb)return c[0]=d.Qb.left,c[1]=d.Qb.right,c}else h.error("get_horizontal_limits(): wrong object")};a.has_horizontal_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.d.Qb);h.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,d){b.is_hover_camera(a)?c<d?h.error("apply_hover_angle_limits(): wrong hover angle limits"):
(c=n.angle_wrap_periodic(c,-Math.PI,Math.PI),d=n.angle_wrap_periodic(d,-Math.PI,Math.PI),c=n.clamp(c,-Math.PI/2,0),d=n.clamp(d,-Math.PI/2,0),a.d.ub={Na:c,Wa:d},b.Fy(a),f.w(a),e.sync_transform(a)):h.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.is_hover_camera(a)?a.d.ub=null:h.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,d){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>d)h.error("apply_distance_limits(): wrong distance limits");
else{var g=a.d;g.Qa=!0;g.Yd=c;g.Nf=d;f.w(a);e.sync_transform(a)}else h.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.d.Qa=!1:h.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(b,c,d){h.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-d)};a.is_look_up=function(a){n.quat_to_dir(a.d.quat,n.AXIS_MY,z);return 0<=z[1]?!0:!1};
a.rotate_camera=function(c,d,g,k,l){switch(a.get_move_style(c)){case b.MS_STATIC:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,d,g,k,l);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,d,g,k,l);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,d,g,k,l);break;default:h.error("rotate_camera(): Wrong object")}f.w(c);e.sync_transform(c)};a.rotate_target_camera=function(a,c,d,g,k){b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,g,k),f.w(a),e.sync_transform(a)):h.error("rotate_target_camera(): wrong object")};
a.rotate_eye_camera=function(a,c,d,g,k){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,g,k),f.w(a),e.sync_transform(a)):h.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,c,d,g,k){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,g,k),f.w(a),e.sync_transform(a)):h.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){h.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-d)};a.get_camera_angles=function(a,
c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};a.get_angles=function(a,c){h.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.d.G,e=0;e<d.length;e++){var f=d[e];f.type!=b.rb&&f.type!=b.Ab||b.sA(f,c,f.Bd)}};a.get_stereo_distance=function(a){a=a.d.G;for(var c=
0;c<a.length;c++){var d=a[c];if(d.type==b.rb||d.type==b.Ab)return d.Yi}return 0};a.is_underwater=function(a){h.error("is_underwater() deprecated, always returns false");return a.d.it};a.translate_view=function(a,c,d,e){a=a.d.G;for(var f=0;f<a.length;f++){var g=a[f];g.dc||b.ff(g,g.va);var h=z;h[0]=-c;h[1]=-d;h[2]=0;p.translate(g.qa,h,g.qa);p.rotateZ(g.qa,e,g.qa);p.multiply(g.qa,g.fa,g.Fd);b.xp(g);b.Il(g)}};a.get_fov=function(a){return n.Ik(a.d.G[0].qc)};a.set_fov=function(a,c){for(var d=a.d.G,e=0;e<
d.length;e++){var f=d[e];f.qc=n.bx(c);f.dc||b.ff(f,f.va);p.multiply(f.qa,f.fa,f.Fd);b.xp(f);b.Il(f)}};a.correct_up=function(a,b){b||(b=n.AXIS_Y);k.correct_up(a,b)};a.zoom_object=function(a,c){if(b.is_target_camera(a)){f.get_object_center(c,!1,z);d(a,z);f.w(a);var g=f.get_object_size(c),k=b.Vx(a)/2,g=g/Math.sin(k),k=f.tz(a,z);f.move_local(a,0,g-k,0);f.w(a);e.sync_transform(a)}else h.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,d){if(b.is_camera(c)&&a.is_ortho_camera(c)){var e=
c.d;if(b.is_target_camera(c)){var f=g.dist(e.g,e.Gb);e.hh=d/2*e.gh/f}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(f=g.distance(e.g,e.Rb),e.hh=d/2*e.gh/f):c.d.G[0].top=d/2;b.EB(c)}else h.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(c){if(b.is_camera(c)&&a.is_ortho_camera(c))return 2*c.d.G[0].top;h.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.d.G[0].type==b.Ec;h.error("is_ortho_camera(): wrong object")};a.calc_ray=
function(a,c,d,e){e||(e=new Float32Array(3));var f=a.d.G[0];switch(f.type){case b.Mb:case b.Kd:case b.rb:case b.Ab:var k=Math.tan(f.qc*Math.PI/360);B[0]=(2*c/f.width-1)*k*f.va;B[1]=-1;B[2]=(2*d/f.height-1)*k;B[3]=0;l.transformMat4(B,a.d.U,B);e[0]=B[0];e[1]=B[1];e[2]=B[2];g.normalize(e,e);return e;default:return h.error("Non-compatible camera"),e}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,m){var c=m("__config");a.P_LOW=c.P_LOW;a.P_HIGH=c.P_HIGH;a.P_ULTRA=c.P_ULTRA;a.P_CUSTOM=c.P_CUSTOM;a.set=c.set;a.get=c.get;a.reset=c.reset;a.get_std_assets_path=c.get_std_assets_path};b4w.module.controls=function(a,m){var c=m("__controls"),d=m("__print");a.CT_CONTINUOUS=c.CT_CONTINUOUS;a.CT_TRIGGER=c.CT_TRIGGER;a.CT_SHOT=c.CT_SHOT;a.CT_LEVEL=c.CT_LEVEL;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=65;a.KEY_B=66;a.KEY_C=
67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=
190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=c.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=c.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=c.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=c.create_custom_sensor;a.create_keyboard_sensor=c.create_keyboard_sensor;a.create_collision_sensor=c.create_collision_sensor;a.create_collision_impulse_sensor=c.create_collision_impulse_sensor;
a.create_ray_sensor=c.create_ray_sensor;a.create_mouse_click_sensor=c.create_mouse_click_sensor;a.create_mouse_wheel_sensor=c.create_mouse_wheel_sensor;a.create_mouse_move_sensor=c.create_mouse_move_sensor;a.create_touch_move_sensor=c.create_touch_move_sensor;a.create_touch_zoom_sensor=c.create_touch_zoom_sensor;a.create_motion_sensor=c.create_motion_sensor;a.create_vertical_velocity_sensor=c.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=c.create_gyro_angles_sensor;a.create_gyro_delta_sensor=
c.create_gyro_delta_sensor;a.create_timer_sensor=function(a,d){return c.create_timer_sensor(a,d||!1)};a.reset_timer_sensor=c.reset_timer_sensor;a.create_elapsed_sensor=c.create_elapsed_sensor;a.create_timeline_sensor=c.create_timeline_sensor;a.create_selection_sensor=function(a,d){return c.create_selection_sensor(a,d||!1)};a.set_custom_sensor=function(a,d){c.fA(a,d)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=c.get_sensor_value;a.get_sensor_payload=c.get_sensor_payload;a.create_sensor_lock=
function(a,e,h){d.error("create_sensor_lock() deprecated");a.ln=e.slice(0);a.kn=Array(e.length);a.lk=h||c.em};a.remove_sensor_lock=function(a){d.error("remove_sensor_lock() deprecated");a.ln=null;a.kn=null;a.lk=null};a.create_sensor_manifold=function(a,d,h,k,f,m,g){f=f||c.em;c.create_sensor_manifold(a,d,h,k,f,m,void 0===g?null:g)};a.create_kb_sensor_manifold=function(a,d,h,k,f,m){k=c.create_keyboard_sensor(k);c.create_sensor_manifold(a,d,h,[k],c.em,f,void 0===m?null:m)};a.check_sensor_manifolds=function(a){return c.check_sensor_manifold(a,
null)};a.check_sensor_manifold=c.check_sensor_manifold;a.remove_sensor_manifolds=function(a){d.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");c.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=c.remove_sensor_manifold;a.reset=c.reset;a.register_keyboard_events=c.register_keyboard_events;a.register_mouse_events=function(a,d,h){c.register_mouse_events(a,d,!!h)};a.register_wheel_events=c.register_wheel_events;a.register_touch_events=c.register_touch_events;
a.register_device_orientation=c.register_device_orientation;a.unregister_keyboard_events=c.unregister_keyboard_events;a.unregister_mouse_events=c.unregister_mouse_events;a.unregister_wheel_events=c.unregister_wheel_events;a.unregister_touch_events=c.unregister_touch_events;a.unregister_device_orientation=c.unregister_device_orientation};b4w.module.constraints=function(a,m){var c=m("__camera"),d=m("__constraints"),b=m("__physics"),e=m("__print"),h=m("__transform");a.append_stiff=function(a,c,e,g,l){l=l||1;c instanceof Array&&2==c.length?d.bp(a,c[0],c[1],e,g,l):d.cp(a,c,e,g,l);h.w(a);b.sync_transform(a)};a.append_semi_stiff=function(a,c,e,g){d.fv(a,c,e,g);h.w(a);b.sync_transform(a)};a.append_semi_stiff_cam=function(a,f,m,g,l,y,p,w){if(!c.is_eye_camera(a))return e.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented."),
null;d.ev(a,f,m,g,l,y,p,w);h.w(a);b.sync_transform(a)};a.append_semi_soft_cam=function(a,f,m,g){if(!c.is_eye_camera(a))return e.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented."),null;if(!g||0>g)g=.25;d.dv(a,f,m,g);h.w(a);b.sync_transform(a)};a.append_stiff_trans=function(a,c,e){d.gv(a,c,e);h.w(a);b.sync_transform(a)};a.append_copy_trans=function(a,c,e){d.$u(a,c,e);h.w(a);b.sync_transform(a)};a.append_stiff_trans_rot=function(a,c,e,g){d.hv(a,c,e,g);h.w(a);
b.sync_transform(a)};a.append_track=function(a,c){3==c.length?d.kv(a,c):d.jv(a,c);h.w(a);b.sync_transform(a)};a.append_follow=function(a,c,e,g){3==c.length?d.bv(a,c,e,g):d.av(a,c,e,g);h.w(a);b.sync_transform(a)};a.append_stiff_viewport=function(a,c,e){d.append_stiff_viewport(a,c,e);h.w(a);b.sync_transform(a)};a.remove=function(a){a.Sa&&d.remove(a)};a.get_parent=d.get_parent};b4w.module.container=function(a,m){var c=m("__container"),d=m("__print");a.get_canvas=c.get_canvas;a.get_container=c.get_container;a.insert_to_container=function(a,e){2!=arguments.length?d.error("insert_to_container(): two arguments required"):a&&e&&c.insert_to_container(a,e)}};b4w.module.data=function(a,m){var c=m("__data");m("__print");m("__util");a.load=c.load;a.unload=function(a){c.unload(a|0)};a.set_debug_resources_root=c.set_debug_resources_root;a.is_primary_loaded=c.is_primary_loaded;a.load_and_add_new=c.load;a.cleanup=a.unload};b4w.module.debug=function(a,m){m("__batch");m("__config");var c=m("__controls"),d=m("__debug"),b=m("__physics"),e=m("__print"),h=m("__scenegraph"),k=m("__scenes"),f=m("__shaders"),n=m("__sfx"),g=m("__textures"),l=m("__util"),y=m("vec3");a.physics_stats=function(){b.Yw()};a.physics_id=function(a){e.log("O",b.yx(a));for(var c=b.Ux().m.p,d=0;d<c.length;d++){var f=c[d];f.vb.O==a&&e.log("B",f)}};a.visible_objects=function(){for(var a=k.get_active(),b=k.Ia(a,"MESH",k.DATA_ID_ALL),a=k.ia(a,"MAIN_OPAQUE").p,
c=0;c<b.length;c++){var d=b[c],f=d.d;if("DYNAMIC"==f.type)for(var g=0;g<a.length;g++){var h=a[g];if(h.Ta&&h.sd==f){e.log(d.name,d);break}}}};a.object_info=function(a){for(var b=k.get_active(),c=k.Ia(b,"MESH",k.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];if(f.name==a){e.log("Object",f);for(var g=k.Em(b),h=0;h<g.length;h++){for(var l=g[h],m=l.p,n=[],q=0;q<m.length;q++)m[q].sd==f.d&&n.push(m[q]);e.log("Subscene "+l.type,n)}}}};a.objects_stat=function(){var a=k.get_active();console.log("Armatures: "+
k.Ia(a,"ARMATURE",k.DATA_ID_ALL).length);console.log("Cameras: "+k.Ia(a,"CAMERA",k.DATA_ID_ALL).length);console.log("Curves: "+k.Ia(a,"CURVE",k.DATA_ID_ALL).length);console.log("Empties: "+k.Ia(a,"EMPTY",k.DATA_ID_ALL).length);console.log("Lamps: "+k.Ia(a,"LAMP",k.DATA_ID_ALL).length);console.log("Meshes: "+k.Ia(a,"MESH",k.DATA_ID_ALL).length);console.log("Speakers: "+k.Ia(a,"SPEAKER",k.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=k.get_active(),b=[k.ia(b,"MAIN_OPAQUE"),k.ia(b,"MAIN_BLEND")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,e=0;e<d.length;e++){var f=d[e].D;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=k.get_active(),b=[k.ia(b,"MAIN_OPAQUE"),k.ia(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,e=0;e<d.length;e++){var f=d[e].D;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=k.get_active(),a=[k.ia(a,"MAIN_OPAQUE"),k.ia(a,"MAIN_BLEND")];return a[0].p.length+a[1].p.length};a.num_shaders=function(){return l.nd(f.yq())};
a.geometry_stats=function(){for(var a=k.get_active(),b=k.Em(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.p,f=0;f<e.length;f++){var g=e[f].D,h=e[f].sd;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||h.vk||h.uk)&&(a[g.id]=g)}}var e=d=c=b=0,l;for(l in a)g=a[l],g=g.S,g.Oj&&(d++,e+=g.Oj/1048576),b++,c+=g.Wp/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=k.get_active(),c=[k.ia(c,"MAIN_OPAQUE"),
k.ia(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.p,f=0;f<e.length;f++){var g=e[f].D;if(g)for(var g=g.N,h=0;h<g.length;h++){var l=g[h];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var m=l.Ra;-1===a.indexOf(m)&&(a.push(m),l=l.width*l.height*4/1048576/l.Tl,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=k.get_active(),c=k.Em(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.h,h=[f.bb,f.Ic];h.push.apply(h,
e.Cd);for(e=0;e<h.length;e++){var l=h[e];g.Ai(l)&&-1==a.indexOf(l)&&(a.push(l),b+=f.width*f.height*g.sy(l))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=k.get_active();(a=k.ia(a,"MAIN_OPAQUE"))&&k.vr(a.h,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=k.get_active(),b=k.ia(a,"MAIN_OPAQUE"),a=k.bB(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=
[1,0,1]}k.vr(d.h,b,e)}};a.scenegraph_to_dot=function(){for(var a=k.ui(),b=0;b<a.length;b++)e.log("\n"+h.Vw(k.Gm(a[b])))};a.scenes_to_dot=function(){};a.controls_info=c.debug;a.object_distance=function(a,b){return y.dist(a.d.g,b.d.g)};a.msg=d.msg;a.fbmsg=d.fbmsg;a.print_telemetry=d.print_telemetry;a.plot_telemetry=d.plot_telemetry;a.fbres=function(a,b){function c(){d.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,
1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!l.He(a,l.Nu))throw"Wrong VEC3_IDENT";if(!l.He(b,l.Hu))throw"Wrong QUAT4_IDENT";if(!l.He(c,l.AXIS_X))throw"Wrong AXIS_X";if(!l.He(d,l.AXIS_Y))throw"Wrong AXIS_Y";if(!l.He(e,l.AXIS_Z))throw"Wrong AXIS_Z";if(!l.He(f,l.AXIS_MX))throw"Wrong AXIS_MX";if(!l.He(g,l.AXIS_MY))throw"Wrong AXIS_MY";if(!l.He(h,l.AXIS_MZ))throw"Wrong AXIS_MZ";
};a.mute_music=function(){for(var a=n.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==n.Im(c)&&n.mute(c,!0)}};a.check_finite=function(a){d.check_finite(a)};a.set_debug_params=function(a){var b=k.get_active();if(b=k.ia(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&k.yA(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&k.xA(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return e.gy()};a.get_warning_quantity=
function(){return e.vy()};a.clear_errors_warnings=function(){return e.clear_errors_warnings()}};b4w.module.geometry=function(a,m){var c=m("__batch"),d=m("__geometry"),b=m("__print"),e=m("__renderer");a.extract_vertex_array=function(a,e,f){if(!d.vi(a))return b.error("Wrong object:",a.name),null;if(a=c.aa(a,e,"MAIN")||c.aa(a,e,"NODES")){if((e=a.S)&&e.Ub&&e.Ub[f])return d.rx(e,f);b.error("Attribute not found:"+f);return null}b.error("Wrong material:",e);return null};a.extract_index_array=function(a,e){if(!d.vi(a))return b.error("Wrong object:",a.name),null;var f=c.aa(a,e,"MAIN")||c.aa(a,e,"NODES");
if(f){if((f=f.S)&&f.Ub)return f.Te;b.error("Buffer data not found");return null}b.error("Wrong material:",e);return null};a.update_vertex_array=function(a,e,f,m){var g=["MAIN","NODES","DEPTH","COLOR_ID"];if(d.vi(a))for(var l=0;l<g.length;l++){var y=c.aa(a,e,g[l]);y&&(y=y.S)&&y.Ub&&y.Ub[f]&&d.Yk(y,f,0,m)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,k,f,m,g){var l=["MAIN","NODES","DEPTH","COLOR_ID"];if(d.vi(a))if(f instanceof Uint16Array||f instanceof Uint32Array)if(m instanceof
Float32Array)for(var y=0;y<l.length;y++){var p=c.aa(a,k,l[y]);if(p){var w=p.S;if(w){d.vB(w,p.$d,f);var z=0,E;for(E in w.Ub)var B=w.Ub[E],z=z+m.length/3*B.rd;w.$c=new Float32Array(z);var z=w.$c,v=0;for(E in w.Ub)switch(B=w.Ub[E],E){case "a_position":z.set(m,v);B.offset=v;B.length=m.length;v+=B.length;break;case "a_normal":var t;g&&(t=d.wp(f,m,m));var x=d.up(f,m,t);z.set(x,v);B.offset=v;B.length=m.length;v+=B.length;break;case "a_tangent":B.offset=v;B.length=m.length/3*B.rd;for(var x=new Float32Array(B.length),
I=0;I<x.length;I+=4)x[I]=1,x[I+3]=1;z.set(x,v);v+=B.length;break;default:B.offset=v,B.length=m.length/3*B.rd,x=new Float32Array(B.length),z.set(x,v),v+=B.length}d.mt(w);e.ep(p);(p=c.pc(a,p))&&p.S&&(p.S=w)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,c,e){if(!d.check_shape_keys(a))return b.error("Wrong object:",a.name),null;if(!d.Wq(a,c))return b.error("Wrong key name:",c),null;d.qv(a,c,parseFloat(e))};
a.check_shape_keys=function(a){return d.check_shape_keys(a)};a.get_shape_keys_names=function(a){return d.check_shape_keys(a)?d.get_shape_keys_names(a):(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,c){return d.check_shape_keys(a)?d.Wq(a,c)?d.get_shape_key_value(a,c):(b.error("Wrong key name:",c),null):(b.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,m){var c=m("__hud");m("__print");a.draw_mixer_strip=c.draw_mixer_strip;a.plot_array=c.plot_array};b4w.module.lights=function(a,m){function c(a){for(var c=h.get_active(),d=h.Ia(c,"LAMP",h.DATA_ID_ALL),l=0;l<d.length;l++){var m=d[l];if("SUN"==m.ma.type){var y=m;break}}if(!y)return b.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,l=y.d,k.set_rotation_euler(y,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),f.quat_to_dir(l.quat,f.AXIS_Y,a),l=n.length(l.g),n.copy(a,g),n.scale(g,l,g),k.set_translation(y,
g),k.w(y),a=y.ma,a.bq&&(m=y.data.energy,l=c.world.light_settings.environment_energy,d=Math.cos(Math.abs(d)),m*=Math.max(Math.min(3*d,1),0),d=Math.max(d,.1)*l,e.ys(a,m),h.set_environment_colors(c,d,null,null)),h.yg(y,c))}function d(a){if(e.Ym(a))return a.ma.type;b.error("get_light_type(): Wrong object");return!1}var b=m("__print"),e=m("__lights"),h=m("__scenes");m("__batch");var k=m("__transform"),f=m("__util"),n=m("vec3"),g=new Float32Array(3),l,y=60;a.get_lamps=function(a){var b=h.get_active(),b=
h.Ia(b,"LAMP",h.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.ma.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=h.get_active(),a=h.Ia(a,"LAMP",h.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.ma.type){b=d;break}}return b?(b=b.ma.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=
function(a){for(var d=h.get_active(),d=h.Ia(d,"LAMP",h.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("SUN"==f.ma.type){var g=f;break}}if(!g)return b.error("There is no sun on the scene"),null;g=-Math.cos(a/12*Math.PI)*y;d={};d.hor_position=12>a?15*a:15*(a-24);d.vert_position=g;c(d)};a.set_date=function(a){(l=a.getDate())?1582==l&&10==a.lE&&4<a.Uw&&15>a.Uw&&b.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):b.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=
function(a){y=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(e.Ym(a))var c=a.ma;else return b.error("get_light_params(): Wrong object"),!1;if(a=d(a))switch(a){case "SPOT":var f={light_type:a,light_color:c.color,light_energy:c.Ne,light_spot_blend:c.wg,light_spot_size:c.Zc,light_distance:c.distance};break;case "POINT":f={light_type:a,light_color:c.color,light_energy:c.Ne,light_distance:c.distance};break;default:f={light_type:a,light_color:c.color,light_energy:c.Ne}}return f?f:!1};a.get_light_type=
d;a.set_light_params=function(a,c){if(e.Ym(a))var d=a.ma;else return b.error("set_light_params(): Wrong object"),!1;var f=h.get_active();"number"==typeof c.light_energy&&(e.ys(d,c.light_energy),h.yg(a,f));"object"==typeof c.light_color&&(e.mA(d,c.light_color),h.yg(a,f));"number"==typeof c.light_spot_blend&&(e.oA(d,c.light_spot_blend),h.yg(a,f));"number"==typeof c.light_spot_size&&(e.pA(d,c.light_spot_size),h.yg(a,f));"number"==typeof c.light_distance&&(e.nA(d,c.light_distance),h.yg(a,f));h.qB()}};b4w.module.material=function(a,m){function c(a,b){for(var c=a.n,d=0;d<c.length;d++){var e=c[d];if(-1<e.Lc.indexOf(b))return"MAIN"==e.type}return!1}function d(a,b){var c=e.aa(a,b,"MAIN");return Boolean(c&&c.gc[0])}function b(a,b){var c=e.aa(a,b,"MAIN");return Boolean(c&&c.gc[1])}var e=m("__batch"),h=m("__config"),k=m("__print"),f=m("__objects"),n=m("__shaders");m("__util");m("vec4");var g=h.o,l="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.inherit_material=function(a,
b,c,d){if(f.xi(c)&&f.xi(a)){for(var g=["MAIN","DEPTH","COLOR_ID"],h=!1,m=0;m<g.length;m++){var n=g[m],x=e.aa(a,b,n),I=e.aa(c,d,n);if(x&&I){var h=!0,r=e.pc(c,d,n);"MAIN"==n&&(e.zs(I,x),r&&e.zs(r,x));for(n=0;n<I.Kb.length;n++){var q=I.Kb[n];if(-1!==l.indexOf(q)){var C=x.Kb.indexOf(q);-1!==C&&(I.N[n]=x.N[C],r&&(q=r.Kb.indexOf(q),-1!==q&&(r.N[q]=x.N[C])))}}}}h||k.error("Wrong objects for inheriting material!")}else k.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.n;
for(var c=0;c<a.length;c++)for(var d=0;d<a[c].Lc.length;d++)-1==b.indexOf(a[c].Lc[d])&&b.push(a[c].Lc[d]);return b};a.set_diffuse_color=function(a,b,c){var d=e.aa(a,b,"MAIN");d?(d.Ob.set(c),(a=e.pc(a,b,"MAIN"))&&a.Ob.set(c)):k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=e.aa(a,b,"MAIN");if(c){var d=Array(4);d[0]=c.Ob[0];d[1]=c.Ob[1];d[2]=c.Ob[2];d[3]=c.Ob[3];return d}k.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,
b,c){var d=e.aa(a,b,"MAIN");if(d){if(d.Ke=c,a=e.pc(a,b,"MAIN"))a.Ke=c}else k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=e.aa(a,b,"MAIN");if(c)return c.Ke;k.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=e.aa(a,b,"MAIN");d?(d.zd.set(c),(a=e.pc(a,b,"MAIN"))&&a.zd.set(c)):k.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=e.aa(a,b,"MAIN");if(c){var d=Array(3);
d[0]=c.zd[0];d[1]=c.zd[1];d[2]=c.zd[2];return d}k.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,c){d(a,b)||k.error('Property "specular_intensity" is missing!');e.aa(a,b,"MAIN").gc[0]=c;(a=e.pc(a,b,"MAIN"))&&(a.gc[0]=c)};a.get_specular_intensity=function(a,b){d(a,b)||k.error('Property "specular_intensity" is missing!');return e.aa(a,b,"MAIN").gc[0]};a.check_specular_intensity=d;a.set_specular_hardness=function(a,c,d){b(a,c)||k.error('Property "specular_hardness" is missing!');
e.aa(a,c,"MAIN").gc[1]=d;(a=e.pc(a,c,"MAIN"))&&(a.gc[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||k.error('Property "specular_hardness" is missing!');return e.aa(a,c,"MAIN").gc[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=e.aa(a,b,"MAIN");if(d){if(d.ae=c,a=e.pc(a,b,"MAIN"))a.ae=c}else k.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=e.aa(a,b,"MAIN");if(c)return c.ae;k.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=
function(a,b,c){var d=e.aa(a,b,"MAIN");if(d){if(d.Nd=c,a=e.pc(a,b,"MAIN"))a.Nd=c}else k.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=e.aa(a,b,"MAIN");if(c)return c.Nd;k.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=e.aa(a,b,"MAIN");if(d){if(d.Je=c,a=e.pc(a,b,"MAIN"))a.Je=c}else k.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=e.aa(a,b,"MAIN");
if(c)return c.Je;k.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=e.aa(a,b,"MAIN");if(d){if(d.Ce=c,a=e.pc(a,b,"MAIN"))a.Ce=c}else k.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=e.aa(a,b,"MAIN");if(c)return c.Ce;k.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_material_params"),null;if(!c(a,b))return null;var d=
e.aa(a,b,"MAIN");if(!d)return null;var f={};"MAIN"==d.type&&(f.rg=d.rg,f.xD=d.Uc[2],f.yD=5*(1-d.Uc[3]),f.ng=d.ng,f.sE=e.tb(d,"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var d=e.aa(a,b,"MAIN");if(!d||!d.vf)return null;if(!d)return k.error("material not found"),null;var f={};if("MAIN"==d.type){if(g.yh){var h=f.shallow_water_col=Array(3);h[0]=d.shallow_water_col[0];h[1]=
d.shallow_water_col[1];h[2]=d.shallow_water_col[2];h=f.shore_water_col=Array(3);h[0]=d.shore_water_col[0];h[1]=d.shore_water_col[1];h[2]=d.shore_water_col[2];f.shallow_water_col_fac=d.shallow_water_col_fac;f.shore_water_col_fac=d.shore_water_col_fac}f.foam_factor=d.foam_factor;f.norm_uv_velocity=d.Sh;f.absorb_factor=e.tb(d,"ABSORB")[1];f.sss_strength=e.tb(d,"SSS_STRENGTH")[1];f.sss_width=e.tb(d,"SSS_WIDTH")[1];f.dst_noise_scale0=e.tb(d,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=e.tb(d,"DST_NOISE_SCALE_1")[1];
f.dst_noise_freq0=e.tb(d,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=e.tb(d,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=e.tb(d,"DIR_MIN_SHR_FAC")[1];f.dir_freq=e.tb(d,"DIR_FREQ")[1];f.dir_noise_scale=e.tb(d,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=e.tb(d,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=e.tb(d,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=e.tb(d,"DST_MIN_FAC")[1];f.waves_hor_fac=e.tb(d,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,b,d){if(a&&b&&d){if(!c(a,b))return k.error("setting material params is not possible"),
null;var f=e.aa(a,b,"MAIN");if(f){var g=[f];(f=e.pc(a,b,"MAIN"))&&g.push(f);for(a=0;a<g.length;a++)f=g[a],"number"==typeof d.material_reflectivity&&(f.rg=d.material_reflectivity),"number"==typeof d.material_fresnel&&(f.Uc[2]=d.material_fresnel),"number"==typeof d.material_fresnel_factor&&(f.Uc[3]=1-d.material_fresnel_factor/5),"number"==typeof d.material_parallax_scale&&(f.ng=d.material_parallax_scale),"number"==typeof d.material_parallax_steps&&(b=n.u(parseFloat(d.material_parallax_steps)),e.ka(f,
"PARALLAX_STEPS",b),e.zb(f,!0))}else k.error("material not found")}else k.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,d){if(!a||!b||!d)return k.error("missing arguments in set_water_material_params"),null;if(!c(a,b))return k.error("setting water material params is not possible"),null;var f=e.aa(a,b,"MAIN");if(!f)return k.error("material not found"),null;var h=[f];(f=e.pc(a,b,"MAIN"))&&h.push(f);for(a=0;a<h.length;a++)f=h[a],g.yh&&("object"==typeof d.shallow_water_col&&
f.shallow_water_col.set(d.shallow_water_col),"number"==typeof d.shallow_water_col_fac&&(f.shallow_water_col_fac=d.shallow_water_col_fac),"object"==typeof d.shore_water_col&&f.shore_water_col.set(d.shore_water_col),"number"==typeof d.shore_water_col_fac&&(f.shore_water_col_fac=d.shore_water_col_fac)),g.shore_smoothing&&f.Do&&("boolean"==typeof d.shore_smoothing&&(d.shore_smoothing?e.ka(f,"SHORE_SMOOTHING",1):e.ka(f,"SHORE_SMOOTHING",0)),"number"==typeof d.absorb_factor&&(b=n.u(parseFloat(d.absorb_factor)),
e.ka(f,"ABSORB",b))),"number"==typeof d.foam_factor&&g.Xg&&(f.foam_factor=d.foam_factor),"number"==typeof d.norm_uv_velocity&&(f.Sh=d.norm_uv_velocity),g.water_dynamic&&f.water_dynamic&&("boolean"==typeof d.water_dynamic&&(d.water_dynamic?e.ka(f,"DYNAMIC",1):e.ka(f,"DYNAMIC",0)),"number"==typeof d.waves_height&&(b=n.u(parseFloat(d.waves_height)),e.ka(f,"WAVES_HEIGHT",b)),"number"==typeof d.waves_length&&(b=n.u(parseFloat(d.waves_length)),e.ka(f,"WAVES_LENGTH",b)),"number"==typeof d.sss_strength&&
(b=n.u(parseFloat(d.sss_strength)),e.ka(f,"SSS_STRENGTH",b)),"number"==typeof d.sss_width&&(b=n.u(parseFloat(d.sss_width)),e.ka(f,"SSS_WIDTH",b)),"number"==typeof d.dst_noise_scale0&&(b=n.u(parseFloat(d.dst_noise_scale0)),e.ka(f,"DST_NOISE_SCALE_0",b)),"number"==typeof d.dst_noise_scale1&&(b=n.u(parseFloat(d.dst_noise_scale1)),e.ka(f,"DST_NOISE_SCALE_1",b)),"number"==typeof d.dst_noise_freq0&&(b=n.u(parseFloat(d.dst_noise_freq0)),e.ka(f,"DST_NOISE_FREQ_0",b)),"number"==typeof d.dst_noise_freq1&&(b=
n.u(parseFloat(d.dst_noise_freq1)),e.ka(f,"DST_NOISE_FREQ_1",b)),"number"==typeof d.dir_min_shore_fac&&(b=n.u(parseFloat(d.dir_min_shore_fac)),e.ka(f,"DIR_MIN_SHR_FAC",b)),"number"==typeof d.dir_freq&&(b=n.u(parseFloat(d.dir_freq)),e.ka(f,"DIR_FREQ",b)),"number"==typeof d.dir_noise_scale&&(b=n.u(parseFloat(d.dir_noise_scale)),e.ka(f,"DIR_NOISE_SCALE",b)),"number"==typeof d.dir_noise_freq&&(b=n.u(parseFloat(d.dir_noise_freq)),e.ka(f,"DIR_NOISE_FREQ",b)),"number"==typeof d.dir_min_noise_fac&&(b=n.u(parseFloat(d.dir_min_noise_fac)),
e.ka(f,"DIR_MIN_NOISE_FAC",b)),"number"==typeof d.dst_min_fac&&(b=n.u(parseFloat(d.dst_min_fac)),e.ka(f,"DST_MIN_FAC",b)),"number"==typeof d.waves_hor_fac&&(b=n.u(parseFloat(d.waves_hor_fac)),e.ka(f,"WAVES_HOR_FAC",b))),e.zb(f,!0);return!0}};b4w.module.particles=function(a,m){var c=m("__particles"),d=m("__print");a.set_size=function(a,e,h){c.eh(a)?c.set_size(a,e,h):d.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,e,h){c.eh(a)?c.set_normal_factor(a,e,h):d.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,e,h){c.eh(a)?(h=Math.min(h,1),h=Math.max(h,0),c.set_factor(a,e,h)):d.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,m){var c=m("__print"),d=m("__physics"),b=m("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){d.has_physics(a)?d.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){d.has_physics(a)?d.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return d.has_physics(a)};a.has_simulated_physics=function(a){return d.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return d.has_dynamic_physics(a)};a.set_gravity=function(a,b){d.has_physics(a)?d.set_gravity(a,b):c.error("No physics for object "+a.name)};a.set_damping=function(a,b,k){d.has_physics(a)?d.t("set_damping",a.m.O,b,k):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(d.has_physics(a)){var b=a.game;d.t("set_damping",a.m.O,b.damping,b.rotation_damping)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,b,k){d.has_physics(a)?d.set_transform.apply(this,
arguments):c.error("No physics for object "+a.name)};a.sync_transform=function(a){d.has_physics(a)?d.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a){d.has_physics(a)?d.apply_velocity.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){d.has_physics(a)?d.apply_velocity_world.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_force=function(a,b,k,f){d.has_physics(a)?d.apply_force.apply(this,
arguments):c.error("No physics for object "+a.name)};a.apply_torque=function(a,b,k,f){d.has_physics(a)?d.apply_torque.apply(this,arguments):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,h){d.has_physics(a)?(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||c.error("Wrong object"),d.vehicle_throttle(a,b.clamp(h,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,h,k){if(d.has_physics(a)){d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||c.error("Wrong object");
h=b.clamp(h,0,1);var f=a.j.Wg;-1==k||1==k?f=Math.max(-1,Math.min(f+k*h,1)):0==k&&0<=f?(f-=h,f=Math.max(0,f)):0==k&&0>f?(f+=h,f=Math.min(0,f)):c.error("Wrong steering direction");d.vehicle_throttle(a,b.clamp(f,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,h){d.has_physics(a)?(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||c.error("Wrong object"),d.vehicle_steer(a,b.clamp(h,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,h,k){if(d.has_physics(a)){d.is_vehicle_chassis(a)||
d.is_vehicle_hull(a)||c.error("Wrong object");h=b.clamp(h,0,1);var f=a.j.Fh;-1==k||1==k?f=Math.max(-1,Math.min(f+k*h,1)):0==k&&0<=f?(f-=h,f=Math.max(0,f)):0==k&&0>f?(f+=h,f=Math.min(0,f)):c.error("Wrong steering direction");d.vehicle_steer(a,b.clamp(f,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,h){d.has_physics(a)?(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||c.error("Wrong object"),d.vehicle_brake(a,b.clamp(h,0,1))):c.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,h){if(d.has_physics(a)){d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||c.error("Wrong object");h=b.clamp(h,-1,1);var k=a.j.bi;d.vehicle_brake(a,b.clamp(k+k*h,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return d.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return d.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!d.has_physics(a))return c.error("No physics for object "+a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!d.has_physics(a))return c.error("No physics for object "+a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return a.j.Wg;c.error("Wrong object")};a.get_vehicle_steering=function(a){if(!d.has_physics(a))return c.error("No physics for object "+a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return a.j.Fh;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!d.has_physics(a))return c.error("No physics for object "+
a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return a.j.bi;c.error("Wrong object")};a.get_vehicle_speed=function(a){if(!d.has_physics(a))return c.error("No physics for object "+a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return d.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return d.is_character(a)};a.set_character_move_dir=function(a,b,k){d.has_physics(a)?d.set_character_move_dir(a,b,k):c.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,b){d.has_physics(a)?d.set_character_move_type(a,b):c.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,b){d.has_physics(a)?d.set_character_walk_velocity(a,b):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,b){d.has_physics(a)?d.set_character_run_velocity(a,b):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,b){d.has_physics(a)?d.set_character_fly_velocity(a,b):c.error("No physics for object "+
a.name)};a.character_jump=function(a){d.has_physics(a)?d.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,b,k){d.has_physics(a)?d.character_rotation_inc(a,b,k):c.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,b){d.has_physics(a)?d.set_character_rotation_quat(a,b):c.error("No physics for object "+a.name)};a.set_character_rotation=function(a,b,k){d.has_physics(a)?d.set_character_rotation(a,b,k):c.error("No physics for object "+
a.name)};a.set_character_rotation_v=function(a,b){d.has_physics(a)?d.set_character_rotation_v(a,b):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,b){d.has_physics(a)?d.set_character_rotation_h(a,b):c.error("No physics for object "+a.name)};a.append_collision_test=function(a,b,k,f){d.has_physics(a)?d.append_collision_test(a,b,k,f||!1):c.error("No physics for object "+a.name)};a.remove_collision_test=function(a,b){d.has_physics(a)?d.remove_collision_test(a,b):c.error("No physics for object "+
a.name)};a.apply_collision_impulse_test=function(a,b){d.has_physics(a)?d.apply_collision_impulse_test(a,b):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){d.has_physics(a)?d.clear_collision_impulse_test(a):c.error("No physics for object "+a.name)};a.append_ray_test=function(a,b,k,f,m,g){d.has_physics(a)?d.append_ray_test(a,b,k,f,m,g):c.error("No physics for object "+a.name)};a.remove_ray_test=function(a,b,k,f,m){d.has_physics(a)?d.remove_ray_test(a,b,k,f,m):c.error("No physics for object "+
a.name)};a.apply_constraint=function(a,b,k,f,m,g,l,y,p,w){d.has_physics(b)&&d.has_physics(m)?d.apply_constraint(a,b,k,f,m,g,l,y,p,w):c.error("Wrong objects")};a.clear_constraint=function(a){d.has_physics(a)&&d.Ay(a)?d.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,b,k,f,m,g){d.has_physics(a)&&d.has_physics(f)?d.pull_to_constraint_pivot(a,b,k,f,m,g):c.error("Wrong objects")}};b4w.module.scenes=function(a,m){var c=m("__batch"),d=m("__camera"),b=m("__graph"),e=m("__objects"),h=m("__print"),k=m("__physics"),f=m("__scenes"),n=m("__util");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=f.ui();f.set_active(n.keysearch("name",a,b))};a.get_active=function(){return f.ga()?f.get_active().name:""};a.get_scenes=function(){for(var a=f.ui(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(f.ga())return f.Vj(f.get_active());h.error("No active scene");
return!1};a.get_object_by_name=function(a,b){var c=f.od(f.zf,a,b|0);if(c)return c;h.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=f.od(f.fl,a,b,c|0))return a;h.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=f.od(f.gl,a,b|0);if(c)return c;h.error("get object "+a+": not found")};a.get_object_data_id=function(a){return f.get_object_data_id(a)};a.pick_object=f.pick_object;a.outlining_is_enabled=function(a){return a&&a.d&&
a.d.Db};a.set_outline_intensity=function(a,b){a&&a.d&&a.d.Db?a.d.Vc=b:h.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.d&&a.d.Db)return a.d.Vc;h.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.d&&a.d.Db?f.apply_outline_anim(a,b,c,d):h.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.d&&a.d.Db){var b=a.d.Fi;f.apply_outline_anim(a,b.wk,b.xk,b.yk)}else h.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.d&&a.d.Db?f.clear_outline_anim(a):h.error("clear_outline_anim(): wrong object")};a.set_outline_color=f.set_outline_color;a.get_outline_color=function(a){var b=f.get_active();if(b=f.ia(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.$e),a};a.set_glow_intensity=function(b,c){h.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){h.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,e){h.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){h.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){h.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){h.error("set_glow_color() deprecated, use set_outline_color() instead");
a.set_outline_color(b)};a.get_glow_color=function(b){h.error("get_glow_color() deprecated, use get_outline_color() instead");a.get_outline_color(b)};a.get_shadow_params=function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active(),b=f.ia(a,"SHADOW_CAST");if(!b)return null;var c=a.d.wd,d=f.ia(a,"MAIN_OPAQUE"),e=f.ia(a,"DEPTH"),k={};k.csm_resolution=c.csm_resolution;k.self_shadow_polygon_offset=b.self_shadow_polygon_offset;e&&(k.self_shadow_normal_offset=e.self_shadow_normal_offset);
k.enable_csm=c.enable_csm;k.csm_num=c.csm_num;k.csm_first_cascade_border=c.csm_first_cascade_border;k.first_cascade_blur_radius=c.first_cascade_blur_radius;k.csm_last_cascade_border=c.csm_last_cascade_border;k.last_cascade_blur_radius=c.last_cascade_blur_radius;k.fade_last_cascade=c.fade_last_cascade;k.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(k.csm_borders=f.dy(a,d.h),k.blur_radii=new Float32Array(c.csm_num),k.blur_radii.set(d.h.Ek.subarray(0,c.csm_num))):(k.csm_borders=null,
k.blur_radii=null);return k};a.set_shadow_params=function(a){if(!f.ga())return h.error("No active scene"),!1;var e=f.get_active();"number"==typeof a.self_shadow_polygon_offset&&b.T(e.d.nb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var k=f.ia(e,"DEPTH");k&&("number"==typeof a.self_shadow_normal_offset&&(k.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(k.pcf_blur_radius=a.pcf_blur_radius));var m=f.ia(e,
"MAIN_BLEND");m&&("number"==typeof a.self_shadow_normal_offset&&(m.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(m.pcf_blur_radius=a.pcf_blur_radius),m.ja=!0);m=e.d.wd;"number"==typeof a.csm_first_cascade_border&&(m.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(m.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(m.csm_last_cascade_border=a.csm_last_cascade_border);
"number"==typeof a.last_cascade_blur_radius&&(m.last_cascade_blur_radius=a.last_cascade_blur_radius);if(k){for(var n=k.p,z=0;z<n.length;z++){var E=n[z];E.sd.Jb&&(E=E.D,c.ul(E,m),c.zb(E))}k.ja=!0}k=e.camera.d.G;for(z=0;z<k.length;z++)d.qo(k[z],m);f.On(e)};a.get_environment_colors=function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active();return f.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!f.ga())return h.error("No active scene"),!1;var d=f.get_active();
f.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=f.get_active();return f.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=f.get_active();f.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active();return f.get_ssao_params(a)};a.set_ssao_params=function(a){if(!f.ga())return h.error("No active scene"),
!1;var b=f.get_active();f.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!f.ga())return h.error("No active scene"),null;var a=f.get_active(),a=f.ia(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!f.ga())return h.error("No active scene"),null;var b=f.get_active(),b=f.ia(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&
(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.ja=!0};a.get_sky_params=function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active();return f.get_sky_params(a)};a.set_sky_params=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=f.get_active();f.set_sky_params(b,a)};a.get_dof_params=function(){if(!f.ga())return h.error("No active scene"),
!1;var a=f.get_active();return f.ia(a,"DOF")?f.get_dof_params(a):null};a.set_dof_params=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=f.get_active();f.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active();return f.ia(a,"GOD_RAYS")?f.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=f.get_active();f.set_god_rays_params(b,a)};a.get_bloom_params=
function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active();return f.ia(a,"BLOOM")?f.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=f.get_active();f.set_bloom_params(b,a)};a.get_glow_material_params=function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active();return f.ia(a,"GLOW_COMBINE")?f.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(!f.ga())return h.error("No active scene"),
!1;var b=f.get_active();f.set_glow_material_params(b,a)};a.get_wind_params=function(){return f.get_wind_params()};a.set_wind_params=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=f.get_active();f.set_wind_params(b,a)};a.get_water_surface_level=f.get_water_surface_level;a.set_water_params=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=f.get_active();f.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!f.ga())return h.error("No active scene"),!1;var b=
f.get_active();f.get_water_mat_params(b,a)};a.update_scene_materials_params=function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active();f.ot(a)};a.hide_object=function(a){e.xi(a)||n.fk(a)?f.hide_object(a):h.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){e.xi(a)||n.fk(a)?f.show_object(a):h.error("show/hide is only supported for dynamic meshes/empties")};a.is_hidden=function(a){if(e.xi(a)||n.fk(a))return f.is_hidden(a);h.error("show/hide is only supported for dynamic meshes/empties");
return!1};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return f.ga()?f.check_object(a,f.get_active()):(h.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return f.od(f.zf,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return f.od(f.fl,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return f.od(f.gl,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=f.get_active();a||(a="ALL");b||0===b||(b=f.DATA_ID_ALL);return f.Ia(c,a,b)};
a.get_object_name=function(a){return a?a.name:(h.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(h.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.za};a.get_object_children=function(a){return a.Fc.slice(0)};a.get_first_character=function(){for(var a=f.Ia(f.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(k.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return f.get_shore_dist(a,
b)};a.get_cam_water_depth=function(){return f.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.get_meta_tags=function(){if(!f.ga())return h.error("No active scene"),!1;var a=f.get_active();return f.get_meta_tags(a)};a.append_object=function(a){if(!a.d.Wm)return h.error('object "'+a.name+'" has been created not by coping.'),!1;var b=a.name;if(f.od(f.zf,a.name,0))for(var c=1;;){b=a.name+(3>String(c).length?"."+("000"+String(c)).slice(-3):"."+String(c));
if(!f.od(f.zf,b,0)){a.name=b;h.error('object "'+a.name+'" already exists. Name was replaced by "'+b+'".');break}c++}f.append_object(f.get_active(),a,!0)};a.remove_object=function(a){f.remove_object(a)||h.error('object "'+a.name+'" was not copied.')}};b4w.module.sfx=function(a,m){var c=m("__scenes"),d=m("__sfx"),b=m("__print");a.play=function(a,b,c){d.play(a,b,c)};a.play_def=function(a){d.play_def(a)};a.is_play=function(a){return d.is_play(a)};a.speaker_play=function(a,c,k,f){b.error("speaker_play() deprecated, use play() or play_def() instead");d.cyclic(a,c);f&&d.playrate(a,f);d.play(a,0,k)};a.speaker_stop=function(a){b.error("speaker_stop() deprecated, use stop() instead");d.stop(a)};a.stop=function(a){d.stop(a)};a.pause=function(a){d.KA(a)};
a.resume=function(a){d.MA(a)};a.speaker_playback_rate=function(a,c){b.error("speaker_playback_rate() deprecated, use playrate() instead");d.playrate(a,c)};a.playrate=function(a,b){d.playrate(a,b)};a.get_playrate=function(a){return d.get_playrate(a)};a.cyclic=function(a,b){d.cyclic(a,b)};a.is_cyclic=function(a){return d.is_cyclic(a)};a.listener_reset_speed=function(a,b){d.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,c){d.speaker_reset_speed(a,b,c)};a.get_volume=function(a){return a&&
"object"===typeof a?d.get_volume(a):d.ky()};a.set_volume=function(a,b){a&&"object"===typeof a?d.set_volume(a,b):d.qA(b)};a.mute=function(a,b){a&&"object"===typeof a?d.mute(a,b):d.mz(b)};a.is_muted=function(a){return a&&"object"===typeof a?d.is_muted(a):d.Qy()};a.get_speaker_objects=function(){return d.get_speaker_objects().slice(0)};a.get_speakers=function(){b.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=d.check_active_speakers;
a.set_compressor_params=function(a){d.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return d.get_compressor_params(c.get_active())};a.duck=function(a,b,c){a&&"object"===typeof a?d.duck(a,b,c):d.ix(b,c)};a.unduck=function(a){a&&"object"===typeof a?d.unduck(a):d.pB()};a.apply_playlist=d.apply_playlist;a.clear_playlist=d.clear_playlist;a.detect_audio_container=d.detect_audio_container;a.detect_video_container=d.detect_video_container;a.set_positional_params=d.set_positional_params;
a.get_positional_params=d.get_positional_params;a.set_filter_params=d.set_filter_params;a.get_filter_params=d.get_filter_params;a.get_filter_freq_response=d.get_filter_freq_response;a.get_duration=function(a){if(a&&d.ge(a))return d.get_duration(a);b.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.shaders=function(a,m){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function d(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){for(var b=f.ui(),c=0;c<b.length;c++)for(var d=f.Ia(b[c],"MESH",f.DATA_ID_ALL),e=0;e<d.length;e++){var h=d[e];if(h.n)for(var k=0;k<h.n.length;k++){var m=h.n[k];if(m.Xb==a&&m.Lc.length)return m.Lc}}return null}function e(a){a.sort(function(a,b){return b.Am.ALU_OPS-a.Am.ALU_OPS});for(var c=0;c<a.length;c++){var d=a[c],e=d.Am,f=d.dC,k=b(d.Sw),k=k?"\t\t("+k.join(", ")+")":"\t\t(NA)";h.groupCollapsed("FRAG --\x3e",
"ALU",e.ALU_OPS,"TEX",e.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,k);h.groupCollapsed("directives");for(var k=d.gb.Le,m=0;m<k.length;m++){var n=k[m];h.log(n[0],n[1])}h.groupEnd();h.groupCollapsed("vert src");h.log(d.cC);h.groupEnd();h.groupCollapsed("vert stats");for(var v in f)"ALU_OPS"!=v&&"TEX_OPS"!=v&&h.log(v,f[v]);h.groupEnd();h.groupCollapsed("frag src");h.log(d.Gx);h.groupEnd();h.groupCollapsed("frag stats");for(v in e)"ALU_OPS"!=v&&"TEX_OPS"!=v&&h.log(v,e[v]);h.groupEnd();
h.groupEnd()}}m("__config");var h=m("__print"),k=m("__extensions"),f=m("__scenes"),n=m("__shaders");m("__util");a.report_repeatful_compilation=function(){var a=n.Ww(),b=0,c;for(c in a){var d=a[c],e=d.count;1<e&&h.log(e-1,d.AE,d.RD);b+=e-1}h.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var b=n.yq(),f=0,m;for(m in b)a&&-1===m.indexOf(a)||f++;var f="of "+f+" analyzing...",w={};for(m in b)if(!a||-1!==m.indexOf(a)){var z=b[m],E;var B=z.Ao;E=z.qq;var v=k.zq();if(v){B=v.getTranslatedShaderSource(B);
E=v.getTranslatedShaderSource(E);var v=d("/nvidia_vert",B),t=c(v),x=d("/nvidia_frag",E),I=c(x);E={cC:B,NE:v,dC:t,Gx:E,wD:x,Am:I}}else h.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),E=void 0;v=z.gb;B=v.cj+" + "+v.pi;E.Sw=z;E.gb=v;z=w[B]=w[B]||[];z.push(E);h.log(f)}for(B in w)h.group("%c"+B,"color: #800"),z=w[B],e(z),h.groupEnd()}};b4w.module.textures=function(a,m){var c=m("__textures"),d=m("__print");a.get_canvas_texture_context=function(a,e){e||(e=0);var h=c.ay(a,e);if(h)return h;d.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,e){e||(e=0);c.yB(a,e)||d.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,e){e||(e=0);c.play_video(a,e)||d.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,e){e||(e=0);c.pause_video(a,e)||d.error('Texture with name "'+
a+'" not found!')};a.reset_video=function(a,e){e||(e=0);c.reset_video(a,e)||d.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,m){var c=m("__time");a.set_timeout=c.set_timeout;a.clear_timeout=c.clear_timeout;a.get_timeline=c.get_timeline;a.animate=c.animate};b4w.module.transform=function(a,m){var c=m("__print"),d=m("__physics"),b=m("__transform"),e=m("__util"),h=m("__objects"),k=new Float32Array(3),f=new Float32Array(4);a.SPACE_LOCAL=b.SPACE_LOCAL;a.SPACE_WORLD=b.SPACE_WORLD;a.set_translation=function(a,e,f,m){h.ac(a)?(k[0]=e,k[1]=f,k[2]=m,b.set_translation(a,k),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,e){h.ac(a)?(b.set_translation(a,e),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_translation_rel=function(a,f,l,m,p){h.ac(a)?(k[0]=f,k[1]=l,k[2]=m,e.transform_vec3(k,1,p.d.quat,p.d.g,k),b.set_translation(a,k),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,c){c||(c=new Float32Array(3));b.get_translation(a,c);return c};a.set_rotation=function(a,e,k,m,p){h.ac(a)?(f[0]=e,f[1]=k,f[2]=m,f[3]=p,b.set_rotation(a,f),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_rotation_quat=function(){c.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,e){h.ac(a)?(b.set_rotation(a,e),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){c.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,c){c||(c=new Float32Array(4));b.get_rotation(a,c);return c};a.get_rotation_quat=
function(){c.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=function(a,e,f,m){h.ac(a)?(k[0]=e,k[1]=f,k[2]=m,b.set_rotation_euler(a,k),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,e){h.ac(a)?(b.set_rotation_euler(a,e),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,d){h.ac(a)?(b.set_scale(a,d),b.w(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.get_scale=function(a){return b.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;for(var e=0;e<a.Fc.length;e++)if(!h.ac(a.Fc[e])){c.error('Wrong object: "'+a.Fc[e].name+'" is not dynamic.');return}b.set_translation(a,[0,0,0]);b.set_rotation(a,[0,0,0,1]);b.set_scale(a,1);b.w(a);d.sync_transform(a)};a.get_object_size=function(a){return e.is_mesh(a)?b.get_object_size(a):(c.error("Wrong object: "+a.name),0)};
a.get_object_center=function(a,d,f){return e.is_mesh(a)?b.get_object_center(a,d,f):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,e,f,k){h.ac(a)?(b.move_local(a,e,f,k),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return b.get_object_bounding_box(a)};a.get_tsr=function(a,d){d||(d=new Float32Array(8));if(h.ac(a))return b.get_tsr(a,d),d;c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr=function(a,
e){h.ac(a)?(b.set_tsr(a,e),b.w(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.distance=function(a,c){return b.distance(a,c)}};b4w.module.tsr=function(a,m){m("__print");var c=m("__tsr");a.create=c.create;a.copy=c.copy;a.identity=c.identity;a.create_sep=c.create_sep;a.set_sep=c.set_sep;a.set_trans=c.set_trans;a.set_scale=c.set_scale;a.set_transcale=c.set_transcale;a.set_quat=c.set_quat;a.get_trans_view=c.get_trans_view;a.get_scale=c.get_scale;a.get_quat_view=c.get_quat_view;a.invert=c.invert;a.from_mat4=c.from_mat4;a.multiply=c.multiply;a.transform_vec3=c.transform_vec3;a.transform_vec3_inv=c.transform_vec3_inv;a.transform_vectors=
c.transform_vectors;a.transform_dir_vectors=c.transform_dir_vectors;a.transform_dir_vec3=c.transform_dir_vec3;a.transform_tangents=c.transform_tangents;a.translate=c.translate;a.interpolate=c.interpolate};b4w.module.util=function(a,m){var c=m("__print"),d=m("__util"),b=m("vec3");m("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=d.keyfind;a.keysearch=d.keysearch;a.matrix_to_quat=function(a){return d.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));return d.euler_to_quat(a,b)};a.quat_to_euler=
function(a,b){b||(b=new Float32Array(3));return d.quat_to_euler(a,b)};a.sign=d.sign;a.clamp=d.clamp;a.quat_to_dir=d.quat_to_dir;a.ground_project_quat=function(a,b){return d.quat_project(a,d.AXIS_MY,d.AXIS_Y,d.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return d.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,h,k,f,m){return 0!=b.dot(k,f)?(c.error("Wrong in-plane direction"),null):d.quat_project(a,h,k,f,m)};a.hash_code=d.hash_code;a.smooth=d.smooth;a.smooth_v=d.smooth_v;a.is_vector=d.is_vector;
a.correct_cam_quat_up=d.correct_cam_quat_up;a.quat_to_angle_axis=d.quat_to_angle_axis;a.random_from_array=d.random_from_array;a.xz_direction=d.xz_direction;a.line_plane_intersect=d.line_plane_intersect;a.is_mesh=d.is_mesh;a.is_armature=d.is_armature;a.angle_wrap_0_2pi=d.angle_wrap_0_2pi;a.angle_wrap_periodic=d.angle_wrap_periodic;a.smooth_step=d.smooth_step};"object"==typeof module&&module.om&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,m){var c=m("__version");a.version=c.version;a.type=c.type;a.date=c.date};"object"==typeof module&&module.om&&b4w.module.version(exports);b4w.module.objects=function(a,m){var c=m("__objects"),d=m("__print"),b=m("__util"),e=m("__scenes"),h=m("__geometry");a.get_meta_tags=function(a){if(a&&a.b4w_object_tags)return c.get_meta_tags(a)};a.copy=function(a,f,m){return b.is_mesh(a)?a.So?(d.error('object "'+a.name+'" is meta-object.'),!1):c.ac(a)?h.vi(a)||h.check_shape_keys(a)||!m?-1==e.Ia(e.get_active(),"MESH",e.DATA_ID_ALL).indexOf(a)?(d.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,f||"",m):(d.error('object "'+
a.name+'" has not dynamic geometry for deep copying.'),!1):(d.error('object "'+a.name+'" is not dynamic.'),!1):(d.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,e,h){if(!b.is_mesh(a))return d.error('object "'+a.name+'" is not of type "MESH".'),null;e=e.join("%join%");var g=c.ty(a,e);null!=g?a.d.ie[g]=h:d.error('value "'+e+'" was not found in "'+a.name+'" object.')};a.set_nodemat_rgb=function(a,e,h,g,l){if(!b.is_mesh(a))return d.error('object "'+a.name+'" is not of type "MESH".'),
null;e=e.join("%join%");var m=c.ny(a,e);null!=m?(a.d.rc[m]=h,a.d.rc[m+1]=g,a.d.rc[m+2]=l):d.error('rgb "'+e+'" was not found in "'+a.name+'" object.')}};b4w.module.main=function(a,m){function c(){}function d(){}function b(){}function e(){window.performance||(t.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(t.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});P.As(0)}function h(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();t.error("WebGL context lost");g()},!1);C.Xc(b);var c=C.Fq();c&&t.log("%cRENDERER INFO:","color: #00a",
b.getParameter(c.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(c.UNMASKED_RENDERER_WEBGL));G.Xc(b);J.Xc(b);Z.Xc(b);Q.Xc(b);q.Xc(b);r.zA(b.canvas);D.Cs(a.width,a.height,1,k("x"),k("y"));O.init();d=w();y()}function k(a){if("x"==a)var b=u.offsetLeft;else if("y"==a)b=u.offsetTop;else return 0;return f(b,u,a)}function f(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=f(a+d,b,c)}return a}function n(){c=function(){}}function g(){l()||(ea=performance.now()/1E3,O.pause(),
M.pause(),Z.pause(),z.pause())}function l(){return Y<ea}function y(){xa(y);var a=performance.now()/1E3;ha||(ha=a);var b=a-ha;if(!(b<1/R.pd)){for(var c=P.get_timeline(),e=0;e<na.length;e++)na[e](c,b);l()||(Y>ha&&(b-=Y-Math.max(ea,ha)),c+=b,P.As(c),q.update(),L.update(),r.update(),p(c,b),d(b));ha=a}}function p(a,b){r.is_primary_loaded()&&(A.reset(),U.update(b),N.update(a,b),O.update(a,b),b&&E.update(b),r.is_primary_loaded()&&(M.update(a,b),r.is_primary_loaded()&&(c(b,a),r.is_primary_loaded()&&(I.update(a,
b),r.is_primary_loaded()&&(z.update(),D.update(a,b),z.LB(),H&&(H(u.toDataURL()),H=null))))))}function w(){var a=60,c=0,d=R.oq,e=R.Ax;return function(f){a=V.smooth(1/f,a,f,d);f=M.iy();c=(c+1)%e;0==c&&b(Math.round(a),f)}}var z=m("__anchors"),E=m("__animation"),B=m("__compat"),v=m("__config"),t=m("__print"),x=m("__container"),I=m("__controls"),r=m("__data"),q=m("__debug"),C=m("__extensions"),J=m("__geometry"),A=m("__hud"),N=m("__nla"),L=m("__assets"),M=m("__physics"),G=m("__renderer"),D=m("__scenes"),
O=m("__sfx"),Q=m("__shaders"),Z=m("__textures"),P=m("__time"),U=m("__transform"),V=m("__util"),X=m("__version"),ia=v.context,R=v.o,u=null,pa=null,ha=0,ea=0,Y=0,na=[],H=null,W=["webgl","experimental-webgl"],ba=null,xa=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/R.pd)}}();a.init=function(a,b){v.rA();t.vA(R.console_verbose);
var c=X.version()+" "+X.type()+" ("+X.date()+")";t.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;e();u=a;B.nv();for(var c=null,d=0;d<W.length;d++){var f=W[d];try{c=a.getContext(f,ia)}catch(g){}if(c)break}if(!c)return null;ba=c;h(u,c);v.pv();B.lA(c);R.Sm&&(a.style["touch-action"]="none");t.log("%cSET PRECISION:","color: #00a",R.precision);b?(A.init(b),pa=b):(v.o.show_hud_debug_info=!1,v.Yc.qk=!1);x.init(a);return c};a.set_check_gl_errors=function(a){q.set_check_gl_errors(a)};
a.resize=function(a,b,c){!1!==c&&(u.style.width=a+"px",u.style.height=b+"px",pa&&(pa.style.width=a+"px",pa.style.height=b+"px"));pa&&(pa.width=a,pa.height=b,A.Oh());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))R.canvas_resolution_factor=1;c=a*R.canvas_resolution_factor;b*=R.canvas_resolution_factor;R.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);u.width=c;u.height=b;if(c>ba.drawingBufferWidth||
b>ba.drawingBufferHeight){t.warn("Canvas size exceeds platform limits, downscaling");var d=Math.min(ba.drawingBufferWidth/c,ba.drawingBufferHeight/b);c*=d;b*=d;u.width=c;u.height=b}D.Cs(c,b,c/a,k("x"),k("y"));D.ga()&&U.w(D.get_active().camera);p(P.get_timeline(),0);r.CB(u.width,u.height)};a.set_fps_callback=function(a){b=a};a.clear_fps_callback=function(){b=function(){}};a.set_on_before_render_callback=function(a){t.error("set_on_before_render_callback() deprecated, use set_render_callback() instead");
c=a};a.set_render_callback=function(a){c=a};a.clear_on_before_render_callback=function(){t.error("clear_on_before_render_callback() deprecated, use clear_render_callback() instead");n()};a.clear_render_callback=function(){n()};a.global_timeline=function(){return P.get_timeline()};a.redraw=function(){t.error("redraw() deprecated");p(P.get_timeline(),0)};a.pause=g;a.resume=function(){l()&&(Y=performance.now()/1E3,O.resume(),M.resume(),Z.play(!0),z.resume())};a.is_paused=l;a.reset=function(){r.unload(0);
pa=u=null;Y=ea=ha=0;b=function(){};d=function(){};c=function(){};na.length=0;ba=null;P.reset()};a.canvas_data_url=function(a){H=a};a.get_canvas_elem=function(){return u};a.detect_mobile=function(){return B.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<na.length;b++)if(na[b]==a)return;na.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<na.length;b++)if(na[b]==a){na.splice(b,1);break}}};b4w.module.nla=function(a,m){var c=m("__nla"),d=m("__time"),b=m("__print");a.set_frame=function(a){0>a?b.error("Value must be non-negative."):c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.set_frame(a,d.get_timeline())};a.get_frame=function(){return c.get_frame(d.get_timeline())};a.stop=function(){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.WA()};a.play=function(){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.Az()};
a.is_play=function(){return c.is_play()};a.get_frame_start=function(){return c.get_frame_start()};a.get_frame_end=function(){return c.get_frame_end()};a.check_nla=function(){return c.check_nla()};a.check_nla_scripts=function(){return c.check_nla_scripts()}};b4w.module.app=function(a,m){function c(){var a=J.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=J.is_paused(),J.pause()):a||J.resume()},!1)}function d(a,b,c,d){var e=document.createElement("canvas");e.style.position="absolute";e.style.left=0;e.style.top=0;b?(b=document.createElement("canvas"),b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;var f=document.getElementById(a);f||(N.error('Warning: canvas container "'+
a+'" not found, appending to body'),f=document.body);f.appendChild(e);if(!J.init(e,b))return c&&E("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&I.insert_to_container(b,"LAST");return!0}function b(a,b){a?(b&&(document.getElementById(b).style.display="block"),O=document.getElementById(a)):(O=document.createElement("div"),O.innerHTML=0,O.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",
I.insert_to_container(O,"JUST_AFTER_CANVAS"))}function e(a,b){var c=String(a);b&&(c+="/"+String(b));O.innerHTML=c}function h(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function k(){var a=I.get_container();J.resize(a.clientWidth,a.clientHeight,!0)}function f(a,b,c){if(v.has_distance_limits(a))var d=M.get_translation(a,X),e=v.get_hover_cam_pivot(a,ia),d=D.subtract(d,e,X),d=Math.max(D.len(d),1);else d=10;e=M.get_rotation(a,u);b=G.quat_to_dir(e,b,X);
b[1]=0;D.normalize(b,b);D.scale(b,d*c,b);d=M.get_translation(a,ia);D.add(d,b,d);v.hover_cam_set_translation(a,d)}function n(a,b){if(v.has_distance_limits(a)){var c=v.get_hover_angle_limits(a,U);if(0>c[1]-c[0]){var d=v.get_camera_angles(a,V)[1],c=(c[0]-d)/(c[0]-c[1]),d=v.get_cam_dist_limits(a),c=Math.max(c,2/d[0]);v.rotate_hover_camera(a,0,c*b)}}else c=M.get_translation(a,X),d=D.scale(G.AXIS_Y,-b,ia),D.add(c,d,c),v.hover_cam_set_translation(a,c)}function g(a,b,c,d){M.move_local(a,5*b,5*c,5*d)}function l(a,
b,c){var d=M.get_translation(a,X),e=v.get_pivot(a,ia),d=D.dist(d,e),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));M.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function y(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function p(a,b,c,d,e){e?(e=v.get_pivot(a,X),a=v.get_eye(a),a=D.dist(e,a)+d,d=0<b?y(b,-c,a,d):y(-b,c/(1-c),a,d)):d-=2*b*c;return d}function w(a,b){function c(a,b,d,e){if(1==d){var f=t?.003*u[0]:.003*u[1];d=r.get_sensor_value(a,b,0);r.get_sensor_payload(a,b,0)===r.PL_SINGLE_TOUCH_MOVE?
(kb+="X"==e?-d*f:0,wb+="Y"==e?-d*f:0):r.get_sensor_payload(a,b,0)===r.PL_MULTITOUCH_MOVE_PAN&&(a=t?.003*u[1]:7.5E-4*u[0],Za+="X"==e?-d*a:0,eb+="Y"==e?-d*a:0)}}function d(a,b,c,e){if(1==c){c=r.get_sensor_value(a,b,1);v.get_velocity_params(a,u);if(t)f=.003*u[0],g=7.5E-4*u[1];else var f=.003*u[1],g=7.5E-4*u[0];if(1===r.get_sensor_payload(a,b,0))Cb+="X"==e?-c*f:0,wa+="Y"==e?-c*f:0;else if(2===r.get_sensor_payload(a,b,0)||3===r.get_sensor_payload(a,b,0))Ma+="X"==e?-c*g:0,Ob+="Y"==e?-c*g:0}}function e(a){return a[0]&&
(a[1]||a[2])}function h(a,b,c){if(!y||!r.get_sensor_value(a,"CAMERA_COLLISION",1)){if(1==c)switch(c=r.get_sensor_value(a,b,0),v.get_velocity_params(a,u),b){case "FORWARD":q?B[0]=1:t?(b=v.get_camera_angles(a,V)[1],b=Math.abs(b)>=Math.PI/4?G.AXIS_MZ:G.AXIS_MY,f(a,b,.5*u[0]*c)):m?l(a,-u[2],c):g(a,0,-u[0]*c,0);break;case "BACKWARD":q?B[0]=-1:t?(b=v.get_camera_angles(a,V)[1],b=Math.abs(b)>=Math.PI/4?G.AXIS_Z:G.AXIS_Y,f(a,b,.5*u[0]*c)):m?l(a,u[2],c):g(a,0,u[0]*c,0);break;case "UP":t?n(a,30*-u[2]*c):q||
g(a,0,0,-u[0]*c);break;case "DOWN":t?n(a,30*u[2]*c):q||g(a,0,0,u[0]*c);break;case "LEFT":q?B[1]=1:t?f(a,G.AXIS_MX,.5*u[0]*c):g(a,-u[0]*c,0,0);break;case "RIGHT":q?B[1]=-1:t?f(a,G.AXIS_X,.5*u[0]*c):g(a,u[0]*c,0,0);break;case "ROT_LEFT":m?v.rotate_target_camera(a,2*-u[1]*c,0):v.rotate_eye_camera(a,2*u[1]*c,0);break;case "ROT_RIGHT":m?v.rotate_target_camera(a,2*u[1]*c,0):v.rotate_eye_camera(a,2*-u[1]*c,0);break;case "ROT_UP":m?v.rotate_target_camera(a,0,2*-u[1]*c):v.rotate_eye_camera(a,0,2*u[1]*c);break;
case "ROT_DOWN":m?v.rotate_target_camera(a,0,2*u[1]*c):v.rotate_eye_camera(a,0,2*-u[1]*c)}else switch(b){case "FORWARD":case "BACKWARD":q&&(B[0]=0);break;case "LEFT":case "RIGHT":q&&(B[1]=0)}q&&(A.set_character_move_dir(q,B[0],B[1]),a=v.get_camera_angles_char(a,U),A.set_character_rotation(q,a[0],a[1]))}}Q=!0;Z=a;P=b;var k=L.get_active_camera(),m=!1,q=null,t=!1;switch(v.get_move_style(k)){case v.MS_TARGET_CONTROLS:m=!a;break;case v.MS_EYE_CONTROLS:q=L.get_first_character();break;case v.MS_STATIC:return;
case v.MS_HOVER_CONTROLS:t=!0}var u=v.get_velocity_params(k,pa),w=r.create_elapsed_sensor();if(A.has_simulated_physics(k)){var y=r.create_collision_sensor(k,null,!0);r.create_sensor_manifold(k,"CAMERA_COLLISION",r.CT_CONTINUOUS,[w,y],null,function(a,b,c){if(1==c){b=r.get_sensor_payload(a,b,1);c=M.get_translation(a,X);var d=ia;D.sub(c,b,d);D.normalize(d,d);D.scale(d,.01,d);D.add(c,d,c);M.set_translation_v(a,c)}})}if(q){var z=M.get_translation(k),C=M.get_rotation(k),C=G.cam_quat_to_mesh_quat(C);z[1]-=
.5;A.set_transform(q,z,C);x.append_stiff_trans(k,q,[0,.5,0]);var B=new Float32Array(2),E=!0;A.set_character_move_type(q,A.CM_FLY);r.create_kb_sensor_manifold(k,"TOGGLE_CHAR_MOVE_TYPE",r.CT_SHOT,r.KEY_C,function(){E=!E;A.set_character_move_type(q,E?A.CM_FLY:A.CM_WALK)})}if(b)z=C=I=N=O=J=r.create_custom_sensor(0);else var z=r.create_keyboard_sensor(r.KEY_W),C=r.create_keyboard_sensor(r.KEY_S),I=r.create_keyboard_sensor(r.KEY_A),N=r.create_keyboard_sensor(r.KEY_D),O=r.create_keyboard_sensor(r.KEY_R),
J=r.create_keyboard_sensor(r.KEY_F);var Fa=r.create_keyboard_sensor(r.KEY_UP),ta=r.create_keyboard_sensor(r.KEY_DOWN),Ya=r.create_keyboard_sensor(r.KEY_LEFT),Na=r.create_keyboard_sensor(r.KEY_RIGHT);t||(r.create_sensor_manifold(k,"FORWARD",r.CT_CONTINUOUS,[w,z],null,h),r.create_sensor_manifold(k,"BACKWARD",r.CT_CONTINUOUS,[w,C],null,h));m?(r.create_sensor_manifold(k,"ROT_UP",r.CT_CONTINUOUS,[w,Fa,O],e,h),r.create_sensor_manifold(k,"ROT_DOWN",r.CT_CONTINUOUS,[w,ta,J],e,h),r.create_sensor_manifold(k,
"ROT_LEFT",r.CT_CONTINUOUS,[w,Ya,I],e,h),r.create_sensor_manifold(k,"ROT_RIGHT",r.CT_CONTINUOUS,[w,Na,N],e,h)):t?(r.create_sensor_manifold(k,"LEFT",r.CT_CONTINUOUS,[w,Ya,I],e,h),r.create_sensor_manifold(k,"RIGHT",r.CT_CONTINUOUS,[w,Na,N],e,h),r.create_sensor_manifold(k,"FORWARD",r.CT_CONTINUOUS,[w,Fa,z],e,h),r.create_sensor_manifold(k,"BACKWARD",r.CT_CONTINUOUS,[w,ta,C],e,h),r.create_sensor_manifold(k,"UP",r.CT_CONTINUOUS,[w,J],e,h),r.create_sensor_manifold(k,"DOWN",r.CT_CONTINUOUS,[w,O],e,h)):(r.create_sensor_manifold(k,
"UP",r.CT_CONTINUOUS,[w,O],e,h),r.create_sensor_manifold(k,"DOWN",r.CT_CONTINUOUS,[w,J],e,h),r.create_sensor_manifold(k,"LEFT",r.CT_CONTINUOUS,[w,I],e,h),r.create_sensor_manifold(k,"RIGHT",r.CT_CONTINUOUS,[w,N],e,h),r.create_sensor_manifold(k,"ROT_UP",r.CT_CONTINUOUS,[w,Fa],e,h),r.create_sensor_manifold(k,"ROT_DOWN",r.CT_CONTINUOUS,[w,ta],e,h),r.create_sensor_manifold(k,"ROT_LEFT",r.CT_CONTINUOUS,[w,Ya],e,h),r.create_sensor_manifold(k,"ROT_RIGHT",r.CT_CONTINUOUS,[w,Na],e,h));var vb=0,z=r.create_mouse_wheel_sensor(),
Ja=0,C=r.create_touch_zoom_sensor();r.create_sensor_manifold(k,"MOUSE_WHEEL",r.CT_LEVEL,[z],null,function(a,b,c){1==c&&(b=r.get_sensor_value(a,b,0),v.get_velocity_params(a,u),m||t?vb=p(a,b,u[2],vb,m):(u[0]*=1+b*u[2],v.set_velocity_params(a,u)))});r.create_sensor_manifold(k,"TOUCH_ZOOM",r.CT_LEVEL,[C],null,function(a,b,c){1==c&&(c=r.get_sensor_value(a,b,0),v.get_velocity_params(a,u),r.get_sensor_payload(a,b,0)===r.PL_MULTITOUCH_MOVE_ZOOM&&(Ja=p(a,c,.03*u[2],Ja,m)))});r.create_sensor_manifold(k,"ZOOM_INTERPOL",
r.CT_CONTINUOUS,[w],null,function(a,b,c){if(1==c&&(m||t))if(1E-5<Math.abs(vb)||1E-5<Math.abs(Ja)){b=r.get_sensor_value(a,b,0);c=G.smooth(vb,0,b,.1);vb-=c;var d=G.smooth(Ja,0,b,.15);Ja-=d;if(!y||!r.get_sensor_value(a,"CAMERA_COLLISION",1))if(t)n(a,-(c+d));else{b=v.get_pivot(a,X);var e=v.get_eye(a,ia);.001<D.dist(b,e)+c+d?M.move_local(a,0,c+d,0):(c=D.subtract(e,b,ia),d=D.normalize(c,R),D.scale(d,.001,d),D.add(b,d,c),M.set_translation_v(a,c),Ja=vb=0)}}else Ja=vb=0});var Cb=0,wa=0,Ma=0,Ob=0,z=r.create_mouse_move_sensor("X"),
C=r.create_mouse_move_sensor("Y"),I=r.create_mouse_click_sensor();r.create_sensor_manifold(k,"MOUSE_X",r.CT_LEVEL,[I,z],null,d,"X");r.create_sensor_manifold(k,"MOUSE_Y",r.CT_LEVEL,[I,C],null,d,"Y");var kb=0,wb=0,Za=0,eb=0,z=r.create_touch_move_sensor("X"),C=r.create_touch_move_sensor("Y");r.create_sensor_manifold(k,"TOUCH_X",r.CT_LEVEL,[z],null,c,"X");r.create_sensor_manifold(k,"TOUCH_Y",r.CT_LEVEL,[C],null,c,"Y");r.create_sensor_manifold(k,"ROT_TRANS_INTERPOL",r.CT_CONTINUOUS,[w],null,function(a,
b,c){if(1==c&&(1E-5<Math.abs(Cb)||1E-5<Math.abs(wa)||1E-5<Math.abs(kb)||1E-5<Math.abs(wb)||1E-5<Math.abs(Ma)||1E-5<Math.abs(Ob)||1E-5<Math.abs(Za)||1E-5<Math.abs(eb))){var d=r.get_sensor_value(a,b,0),e=G.smooth(Cb,0,d,.08);b=G.smooth(wa,0,d,.08);Cb-=e;wa-=b;var g=G.smooth(kb,0,d,.12);c=G.smooth(wb,0,d,.12);kb-=g;wb-=c;var h=G.smooth(Ma,0,d,.08),k=G.smooth(Ob,0,d,.08);Ma-=h;Ob-=k;var l=G.smooth(Za,0,d,.12),d=G.smooth(eb,0,d,.12);Za-=l;eb-=d;m?(v.rotate_target_camera(a,e+g,b+c),v.move_pivot(a,h+l,k+
d)):t?(e+g&&f(a,G.AXIS_X,.2*(e+g)),b+c&&(e=v.get_camera_angles(a,V)[1],f(a,Math.abs(e)>Math.PI/4?G.AXIS_Z:G.AXIS_Y,.2*(b+c))),v.rotate_hover_camera(a,h+l,0)):(v.rotate_eye_camera(a,.5*(e+g),.5*(b+c)),q&&(a=v.get_camera_angles_char(a,U),A.set_character_rotation(q,a[0],a[1])))}});r.create_kb_sensor_manifold(k,"DEC_STEREO_DIST",r.CT_SHOT,r.KEY_LEFT_SQ_BRACKET,function(a){var b=v.get_stereo_distance(a);v.set_stereo_distance(a,.9*b)});r.create_kb_sensor_manifold(k,"INC_STEREO_DIST",r.CT_SHOT,r.KEY_RIGHT_SQ_BRACKET,
function(a){var b=v.get_stereo_distance(a);v.set_stereo_distance(a,1.1*b)})}function z(){for(var a=L.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)r.remove_sensor_manifold(a,b[c]);v.get_move_style(a)==v.MS_EYE_CONTROLS&&L.get_first_character()&&x.remove(a)}function E(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),
g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);
document.body.appendChild(e)}function B(a,b,c,d){function e(){var g=performance.now()-f;d(a+g*(b-a)/c);g>=c&&J.remove_loop_cb(e)}var f=performance.now();J.append_loop_cb(e)}m("animation");var v=m("camera"),t=m("config"),x=m("constraints"),I=m("container"),r=m("controls"),q=m("data"),C=m("debug"),J=m("main"),A=m("physics"),N=m("print"),L=m("scenes"),M=m("transform"),G=m("util"),D=m("vec3"),O=null,Q=!1,Z=!1,P=!1,U=new Float32Array(2),V=new Float32Array(2),X=new Float32Array(3),ia=new Float32Array(3),
R=new Float32Array(3),u=new Float32Array(4),pa=new Float32Array(3);a.init=function(a){function f(){var a=d(l,G,z,n),g=I.get_canvas();if(a){var q=I.get_container();k();J.set_check_gl_errors(p);D&&(b(u,v),J.set_fps_callback(e));y&&c();m&&J.append_loop_cb(function(){var a=q.clientWidth,b=q.clientHeight;a==g.clientWidth&&b==g.clientHeight||J.resize(a,b,!0)});h(g,!0)}else h(g,!1)}function g(a){a.keyCode==r.KEY_P&&(J.is_paused()?J.resume():J.pause())}function h(){}a=a||{};var l=null,m=!1,p=!1,n=null,u=
null,v=null,w=!0,x=!1,y=!0,z=!0,D=!1,A=!1,C;for(C in a)switch(C){case "canvas_container_id":l=a.canvas_container_id;break;case "callback":h=a.callback;break;case "autoresize":m=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":p=a.gl_debug;break;case "show_hud_debug_info":A=a.show_hud_debug_info;break;case "sfx_mix_mode":x=a.sfx_mix_mode;break;case "show_fps":D=a.show_fps;break;case "fps_wrapper_id":v=a.fps_wrapper_id;break;case "fps_elem_id":u=a.fps_elem_id;break;case "error_purge_elements":n=
a.error_purge_elements;break;case "report_init_failure":z=a.report_init_failure;break;case "pause_invisible":y=a.pause_invisible;break;case "key_pause_enabled":w=a.key_pause_enabled;break;default:t.set(C,a[C])}w&&document.addEventListener("keydown",g,!1);t.set("show_hud_debug_info",A);t.set("sfx_mix_mode",x);var G=A||x||null;"complete"==document.readyState?window.setTimeout(f,0):window.addEventListener("load",f,!1);window.addEventListener("unload",function(){q.cleanup()},!1)};a.resize_to_container=
k;a.set_onclick=function(a,b){var c=h(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=h(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=h(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=w;a.disable_camera_controls=z;a.set_camera_move_style=function(a){Q&&z();var b=L.get_active_camera();v.set_move_style(b,a);Q&&w(Z,P)};a.enable_object_controls=
function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,e){if(1==e)switch(e=r.get_sensor_value(a,b,0),b){case "FORWARD":d?A.vehicle_throttle(a,1):M.move_local(a,0,0,1*e);break;case "BACKWARD":d?A.vehicle_throttle(a,-1):M.move_local(a,0,0,-1*e);break;case "LEFT":d?A.vehicle_steer(a,-1):M.move_local(a,1*e,0,0);break;case "RIGHT":d?A.vehicle_steer(a,1):M.move_local(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&A.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&A.vehicle_steer(a,
0)}}var d=A.is_vehicle_chassis(a)||A.is_vehicle_hull(a),e=r.create_elapsed_sensor(),f=r.create_keyboard_sensor(r.KEY_W),g=r.create_keyboard_sensor(r.KEY_S),h=r.create_keyboard_sensor(r.KEY_A),k=r.create_keyboard_sensor(r.KEY_D),l=r.create_keyboard_sensor(r.KEY_UP),m=r.create_keyboard_sensor(r.KEY_DOWN),p=r.create_keyboard_sensor(r.KEY_LEFT),n=r.create_keyboard_sensor(r.KEY_RIGHT);r.create_sensor_manifold(a,"FORWARD",r.CT_CONTINUOUS,[e,f,l],b,c);r.create_sensor_manifold(a,"BACKWARD",r.CT_CONTINUOUS,
[e,g,m],b,c);r.create_sensor_manifold(a,"LEFT",r.CT_CONTINUOUS,[e,h,p],b,c);r.create_sensor_manifold(a,"RIGHT",r.CT_CONTINUOUS,[e,k,n],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)r.remove_sensor_manifold(a,b[c])};a.enable_controls=function(){var a=I.get_canvas();r.register_keyboard_events(document,!1);r.register_mouse_events(a,!0);r.register_wheel_events(a,!0);r.register_touch_events(a,!0);r.register_device_orientation()};a.disable_controls=
function(){var a=I.get_canvas();r.unregister_keyboard_events(document);r.unregister_mouse_events(a);r.unregister_wheel_events(a);r.unregister_touch_events(a);r.unregister_device_orientation()};a.enable_debug_controls=function(){r.create_kb_sensor_manifold(null,"CAMERA_SHOT",r.CT_SHOT,r.KEY_K,function(){C.make_camera_frustum_shot()});r.create_kb_sensor_manifold(null,"LIGHT_SHOT",r.CT_SHOT,r.KEY_L,function(){C.make_light_frustum_shot()});r.create_kb_sensor_manifold(null,"TELEMETRY",r.CT_SHOT,r.KEY_T,
function(){C.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};
c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=function(){var a=
document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=E;a.get_url_params=function(a){a=!!a;var b=location.href.toString();if(-1==b.indexOf("?"))return null;
for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g,h){function k(e){a.style[b]=f+e+g;if(c>d&&e<=d||c<d&&e>=d)a.style[b]=f+d+g,h()}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var l=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==a.style[b])if(void 0!=a.style["webkit"+l])b="webkit"+l;else if(void 0!=
a.style["ms"+l])b="ms"+l;else if(void 0!=a.style["moz"+l])b="moz"+l;else return;B(c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){0<=e&&a.setAttribute(b,e);if(c>d&&e<=d||c<d&&e>=d)a.setAttribute(b,d),f()}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},B(c,d,e,g))}};b4w.module.camera_anim=function(a,m){function c(a,b,c,d){b=f.angle_wrap_0_2pi(a-b);a=f.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var d=m("camera"),b=m("controls"),e=m("print"),h=m("scenes"),k=m("transform"),f=m("util"),n=m("vec3"),g=m("quat"),l=new Float32Array(2),y=new Float32Array(2),p=new Float32Array(3),w=new Float32Array(3),z=new Float32Array(3),E=new Float32Array(4),B=new Float32Array(2),
v=new Float32Array(2);a.track_to_target=function(a,c,h,m,q,v,y,A){if(!d.is_eye_camera(a))e.error("track_to_target(): wrong object");else if(a&&c){if(f.is_vector(c))var B=c;else B=z,k.get_object_center(c,!1,B);c=h||1;h=m||2;var L=q||1;q=v||1;w[0]=0;w[1]=-1;w[2]=0;var M=k.get_rotation(a);v=f.quat_to_dir(M,w);m=d.get_camera_angles(a,l);var G=k.get_translation(a);n.subtract(B,G,p);n.normalize(p,p);var D=g.rotationTo(v,p,g.create());g.multiply(D,M,E);f.correct_cam_quat_up(E,!1);n.subtract(B,G,w);var O=
n.length(w)*(1-1/h),B=Math.asin(p[1]);h=Math.acos(-p[2]/Math.abs(Math.cos(B)));0<p[0]&&(h=2*Math.PI-h);var Q=h-m[0],Z=B-m[1];z[0]=0;z[1]=0;z[2]=-1;h=k.get_rotation(a);0>f.quat_to_dir(h,z)[1]?(Z=0<v[1]?B-Math.PI+m[1]:B+Math.PI+m[1],Q=0<Q?-Math.PI+Q:Math.PI+Q):Math.abs(Q)>Math.PI&&(Q=0<Q?Q-2*Math.PI:Q+2*Math.PI);var P=0,B=b.create_elapsed_sensor();v=Math.abs(Q/c);c=Math.abs(Z/c);var U=v>c?v:c,V=U+L,X=V+q,ia=X+L,R=Q,u=Z,pa=O,ha=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");y&&y()};b.create_sensor_manifold(a,
"TRACK_TO_TARGET",b.CT_CONTINUOUS,[B],null,function(a,c,e){if(e)if(d.is_eye_camera(a))if(e=b.get_sensor_value(a,c,0),P+=e,P<U){var f=Q/U*e;e*=Z/U;c=P/U;c=6*c*(1-c);f*=c;e*=c;R-=f;u-=e;d.rotate_eye_camera(a,f,e)}else P<V?(R&&(d.rotate_eye_camera(a,R,u),R=0,A&&A()),c=(P-U)/L,e=-O*e/L,pa-=f,k.move_local(a,0,6*e*c*(1-c),0)):P<X?pa&&(k.move_local(a,0,pa,0),pa=0):P<ia?(c=(P-X)/L,e=O*e/L,e=6*e*c*(1-c),k.move_local(a,0,e,0)):(k.set_translation_v(a,G),ha());else ha()})}};a.auto_rotate=function(a,g){function k(e,
g,h){if(1==h)if(h=d.get_move_style(e),h==d.MS_STATIC)m();else if(h!=d.MS_HOVER_CONTROLS&&d.has_horizontal_limits(e)){h=d.get_horizontal_limits(e,v);if(null===n||h[0]!=n[0]||h[1]!=n[1]){n=n||B;n.set(h);w=Math.min(.2,f.angle_wrap_0_2pi(n[1]-n[0])/2);h=n;var x=d.get_camera_angles(p,l)[0];h=c(x,h[0],h[1],y);z=a*Math.min(1,h[0]/.2,h[1]/.2)}g=b.get_sensor_value(e,g,0);h=d.get_camera_angles(e,l)[0];h=c(h,n[0],n[1],y);h[1]>w&&h[0]>w?z=f.sign(z)*a:h[1]<w?z-=Math.pow(a,2)/.4*g:h[0]<w&&(z+=Math.pow(a,2)/.4*
g);d.rotate_camera(e,g*z,0)}else n=null,g=b.get_sensor_value(e,g,0),d.rotate_camera(e,g*a,0)}function m(){b.remove_sensor_manifold(p,"AUTO_ROTATE");b.remove_sensor_manifold(p,"DISABLE_AUTO_ROTATE");g()}g=g||function(){};var p=h.get_active_camera();if(d.get_move_style(p)==d.MS_STATIC)e.error("auto_rotate(): wrong camera type");else{var n=null,w=0,z=0;if(b.check_sensor_manifold(p,"AUTO_ROTATE"))m();else{var E=b.create_mouse_move_sensor("X"),L=b.create_mouse_move_sensor("Y"),M=b.create_mouse_click_sensor(),
G=b.create_touch_move_sensor(),D=b.create_touch_zoom_sensor(),O=b.create_elapsed_sensor();b.create_sensor_manifold(p,"DISABLE_AUTO_ROTATE",b.CT_LEVEL,[E,L,M,G,D],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},m);b.create_sensor_manifold(p,"AUTO_ROTATE",b.CT_CONTINUOUS,[O],function(a){return a[0]},k)}}};a.is_auto_rotate=function(){var a=h.get_active_camera();return b.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=h.get_active_camera();return d.get_move_style(a)==
d.MS_STATIC?!1:!0}};b4w.module.gyroscope=function(a,m){function c(a){var b=d.create_gyro_angles_sensor(),c=!0;d.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",d.CT_CONTINUOUS,[b],null,function(a,b,m){if(0<m){k=d.get_sensor_payload(a,b,0);c&&(h[0]=k[0],h[1]=k[1],h[2]=k[2],c=!1);m=b=0;0==window.orientation&&(b=k[1]-h[1],m=k[0]-h[0],k[1]>n&&k[1]<f&&(m=0));if(180==window.orientation){b=k[1]-h[1];0>k[1]&&(b=-b);m=h[0]-k[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;k[1]>-f&&k[1]<-n&&(m=0)}if(-90==window.orientation){b=k[0]-h[0];if(b>
Math.PI/2||b<-Math.PI/2)b=0;m=h[1]-k[1];if(k[0]>g||k[0]<l)m=0}if(90==window.orientation){b=h[0]-k[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;m=k[1]-h[1];if(k[0]>g||k[0]<l)m=0}e.rotate_camera(a,m,b);h[0]=k[0];h[1]=k[1];h[2]=k[2]}})}var d=m("controls"),b=m("scenes"),e=m("camera"),h=new Float32Array(3),k=new Float32Array(3),f=110*Math.PI/180,n=70*Math.PI/180,g=70*Math.PI/180,l=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=b.get_active_camera();c(a)}};b4w.module.mixer=function(a,m){function c(){B=E.length=0;v=d();t=new Float32Array(v.length);x=new Float32Array(v.length);var a=w.get_speaker_objects();if(a.length){E.push(b());for(var c=0;c<a.length;c++)E.push(h(a[c]));E.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function d(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/
99;return a}function b(){var a=e("MASTER");a.M.push(["VOLUME",w.get_volume(null),0,1,50,!1]);var b=w.get_compressor_params();b&&(a.M.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.M.push(["KNEE",b.knee,0,40,40,!1]),a.M.push(["RATIO",b.ratio,1,20,20,!1]),a.M.push(["ATTACK",b.attack,0,1,1E3,!1]),a.M.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=w.is_muted(null)?1:0;a.Pc=-1;return a}function e(a){return{id:a,M:[],Bf:0,mute:-1,Pc:-1,ta:null}}function h(a){var b=e(p.get_object_name(a));b.mute=w.is_muted(a)?
1:0;b.Pc=0;b.ta=a;return b}function k(a){if(a.ta){a.M.length=0;a.M.push(["VOLUME",w.get_volume(a.ta),0,1,50,!1]);var b=w.get_positional_params(a.ta);b&&(a.M.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.M.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.M.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=w.get_filter_params(a.ta))a.M.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.M.push(["EQ_Q",b.Q,0,10,100,!1]),a.M.push(["EQ_GAIN",b.gain,-70,30,100,!1]);z.clamp(a.Bf,0,a.M.length-1)}}function f(a){for(var b=
0;b<E.length;b++){var c=E[b];if(c!=a&&1==c.Pc)return!0}return!1}function n(a){for(var b=0;b<E.length;b++){var c=E[b];c!=a&&0==c.mute&&0==c.Pc&&w.mute(c.ta,!1)}}function g(){if(0==E.length)return[0,-1];var a=8*Math.floor(B/8),b=a+7,a=z.clamp(a,0,E.length-1),b=z.clamp(b,0,E.length-1);return[a,b]}var l=m("controls");m("debug");var y=m("hud"),p=m("scenes"),w=m("sfx"),z=m("util"),E=[],B=0,v=null,t=null,x=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(l.get_sensor_value(b,
c,2))?-1:1,f=E[B];if(f)switch(d=f.M[f.Bf],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=z.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?w.set_volume(f.ta,d[1]):w.set_volume(null,d[1]);break;case "DIST_REF":e=w.get_positional_params(f.ta);e.dist_ref=d[1];w.set_positional_params(f.ta,e);break;case "ATTENUATION":e=w.get_positional_params(f.ta);e.attenuation=d[1];w.set_positional_params(f.ta,e);break;case "DIST_MAX":e=w.get_positional_params(f.ta);e.dist_max=d[1];w.set_positional_params(f.ta,
e);break;case "EQ_FREQ":e=w.get_filter_params(f.ta);e.freq=d[1];w.set_filter_params(f.ta,e);break;case "EQ_Q":e=w.get_filter_params(f.ta);e.Q=d[1];w.set_filter_params(f.ta,e);break;case "EQ_GAIN":e=w.get_filter_params(f.ta);e.gain=d[1];w.set_filter_params(f.ta,e);break;case "THRESHOLD":f=w.get_compressor_params();f.threshold=d[1];w.set_compressor_params(f);break;case "KNEE":f=w.get_compressor_params();f.knee=d[1];w.set_compressor_params(f);break;case "RATIO":f=w.get_compressor_params();f.ratio=d[1];
w.set_compressor_params(f);break;case "ATTACK":f=w.get_compressor_params();f.attack=d[1];w.set_compressor_params(f);break;case "RELEASE":f=w.get_compressor_params();f.release=d[1];w.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?l.reset_timer_sensor(b,c,6,.35):l.reset_timer_sensor(b,c,6,.05)}else l.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(l.get_sensor_value(a,c,0))?-1:1;if(E.length){1==d&&B<E.length-1?B++:-1==d&&0<B&&B--;d=g();for(var e=d[0];e<=
d[1];e++)k(E[e])}"SWITCH_STRIP"==c?l.reset_timer_sensor(a,c,5,.15+.3):l.reset_timer_sensor(a,c,5,.15)}else l.reset_timer_sensor(a,c,5,10)}c();var d=l.create_keyboard_sensor(l.KEY_LEFT_SQ_BRACKET),e=l.create_keyboard_sensor(l.KEY_RIGHT_SQ_BRACKET),h=l.create_keyboard_sensor(l.KEY_SEMI_COLON),m=l.create_keyboard_sensor(l.KEY_SINGLE_QUOTE),p=l.create_keyboard_sensor(l.KEY_SHIFT),L=l.create_timer_sensor(.15,!0),M=l.create_timer_sensor(.05,!0),d=[d,e,h,m,p,L,M];l.create_sensor_manifold(null,"SWITCH_STRIP",
l.CT_TRIGGER,d,function(a){return(a[0]||a[1])&&!a[4]},b);l.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",l.CT_SHOT,d,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);l.create_sensor_manifold(null,"SWITCH_PARAM",l.CT_SHOT,d,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(l.get_sensor_value(a,b,0))?-1:1,d=E[B];d&&(1==c&&d.Bf<d.M.length-1?d.Bf++:-1==c&&0<d.Bf&&d.Bf--)});l.create_sensor_manifold(null,"INC_DEC",l.CT_TRIGGER,d,function(a){return(a[2]||a[3])&&!a[4]},a);l.create_sensor_manifold(null,
"INC_DEC_HOLD",l.CT_SHOT,d,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);l.create_sensor_manifold(null,"MUTE_SOLO",l.CT_SHOT,d,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(l.get_sensor_value(a,b,2))){var c=E[B];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,w.mute(c.ta,!0),1==c.Pc&&(c.Pc=0,f(c)||n(c))):(c.mute=0,f(c)||w.mute(c.ta,!1)):0==c.mute?(c.mute=1,w.mute(null,!0)):(c.mute=0,w.mute(null,!1)))}else if((c=E[B])&&0<=c.Pc)if(0==c.Pc){c.Pc=1;w.mute(c.ta,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<E.length;d++){var e=E[d];e!=c&&0==e.mute&&0==e.Pc&&w.mute(e.ta,!0)}}else c.Pc=0,f(c)?w.mute(c.ta,!0):n(c)});d=l.create_elapsed_sensor();l.create_sensor_manifold(null,"MIXER_DRAW",l.CT_CONTINUOUS,[d],null,function(){if(E[B])for(var a=g(),b=a[0];b<=a[1];b++){var c=E[b];y.draw_mixer_strip(c.id,b==B,b%8,c.M,c.Bf,c.mute,c.Pc);if(c.ta&&w.get_filter_params(c.ta)){w.get_filter_freq_response(c.ta,v,t,x);for(c=0;c<t.length;c++)t[c]=20*Math.log(t[c])/Math.LN10;y.plot_array("EQ",b%8,t,20,2E4,
-10,10)}}});d=l.create_timer_sensor(1,!0);l.create_sensor_manifold(null,"MIXER_UPDATE",l.CT_TRIGGER,[d],null,function(){for(var a=g(),b=a[0];b<=a[1];b++)k(E[b])})}};b4w.module.npc_ai=function(a,m){function c(a,b){var c=b.destination,d=B;z.get_translation(b.empty,d);var e=v;z.get_translation(b.collider,e);var h=0;b.Th?h=b.Th:b.xe&&(h=b.xe,b.type==C&&(h*=.5),b.type==A&&(h*=a));switch(b.type){case C:if(b.random&&b.cf){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var l=r,d=t,m=b.speed,p=b.rot_speed;z.get_rotation(b.collider,l);f.transformQuat(y.AXIS_Z,l,d);d[1]=0;f.normalize(d,d);l=.5*m/Math.sin(p/2);m=f.dist(c,e);m<2*l&&f.scaleAndAdd(c,
d,2*l-m,c);b.cf=!1}c[1]=e[1];h&&(c[1]+=h);break;case J:case A:b.random&&b.cf&&(b.type==A?(b.speed=Math.random()+.1,l=b.ez-b.kz):l=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=e[1]+(Math.random()*l-.5*l),c[2]=10*Math.random()-5+d[2],b.cf=!1),h&&(c[1]=e[1]+h)}var c=B,d=v,m=t,e=q,w=b.rig,l=b.collider,h=b.destination,E=b.speed,X=b.actions,ia=g.get_current_anim_name(w);if(!g.is_play(w)||!X.wi||-1==X.wi.indexOf(ia)){z.get_translation(l,c);var p=h[0]-c[0],R=h[2]-c[2],p=Math.sqrt(p*p+R*R);
if(p>2*E*a)b.state=20,y.xz_direction(h,c,m),X=b.rig,g.is_animated(X)&&(w=b.speed,E=g.get_frame(X),X=g.get_anim_length(X),w*=X/24*(1-E/X),.9>p/w&&f.scaleAndAdd(h,m,w-p,h)),p=r,w=x,z.get_rotation(b.collider,p),f.transformQuat(y.AXIS_Z,p,d),w[0]=d[0],w[1]=0,w[2]=d[2],f.normalize(w,w),E=f.dot(w,m),X=a/(Math.abs(Math.acos(E))/Math.PI)*b.rot_speed*b.Nn,n.rotationTo(w,m,e),n.rotationTo(y.AXIS_Z,w,p),1<=Math.abs(E)?n.copy(p,e):(n.multiply(e,p,e),n.slerp(p,e,Math.min(X,1),e)),m=a,b.type!=J&&(m=Math.max(m,
1/60),p=I,w=r,n.setAxisAngle(y.AXIS_X,-Math.asin(d[1]),w),n.setAxisAngle(y.AXIS_X,-Math.atan(b.xe/(b.speed*m)),p),n.slerp(w,p,m,p),n.multiply(e,p,e)),z.set_rotation_v(l,e),d=t,l=x,y.quat_to_dir(e,y.AXIS_Z,d),f.scale(d,b.speed*a,l),f.add(l,c,l),l[1]=b.type!=C?(h[1]-c[1])*a*.1+c[1]:h[1],z.set_translation_v(b.collider,l);else if(b.type==C)X.move?ia&&-1!=X.move.indexOf(ia)&&g.is_play(w)?b.state=20:(b.state=10,b.cf=!0):(b.state=10,b.cf=!0);else if(b.type==A||b.type==J)b.cf=!0;if(k(b)&&(c=b.rig,!g.is_play(c))){e=
null;switch(b.state){case 10:e=b.actions;e=e.wi?y.random_from_array(e.wi):null;break;case 20:e=g.get_current_anim_name(b.rig),d=h=b.actions,d.ke&&-1==d.ke.indexOf(e)&&d.move&&-1!=d.move.indexOf(e)&&.33<Math.random()?(h=b.actions,e=h.ke[h.move.indexOf(e)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(e)||!d.ke&&!d.Xe||!d.Xe&&!e||d.ke&&-1!=d.ke.indexOf(e)||d.Xe&&-1!=d.Xe.indexOf(e))?(h=b.actions,h.ke?(d=h.ke.indexOf(e),-1!=d?(e=d+1,e=e<h.move.length?e:0,e=h.move[e]):e=-1!=h.move.indexOf(e)?e:y.random_from_array(h.move)):
e=y.random_from_array(h.move)):(d=b.actions,e=d.Xe&&-1==d.Xe.indexOf(e)&&d.move&&-1==d.move.indexOf(e)?y.random_from_array(h.Xe):null))}e&&(g.apply(c,e),g.set_behavior(c,g.AB_FINISH_RESET),g.set_frame(c,0),g.play(c))}}}function d(a,b,c,d){if(d)if(1==c)switch(d.type){case J:a:{for(c=0;3>c;c++){var e=l.get_sensor_payload(a,b,c);if(e){b=e;break a}}b=void 0}a=100*b;d.xe=a<d.min_height?10:a>d.max_height?-10:0;break;case C:a=l.get_sensor_payload(a,b,0);d.xe=d.fs==a?0:1-100*a;d.fs=a;break;case A:a=l.get_sensor_payload(a,
b,0),"CLOSE_GROUND"==b?(d.xe=100*a-1,d.xe=.1>d.xe?.05:0):"CLOSE_WATER"==b&&(d.Th=100*a,d.Th=d.Th<d.kz?-.02:d.Th>d.ez?.02:0)}else d.xe=0}function b(){for(var a=0;a<E.length;a++){var b=E[a];e(b);h(b);b.rig&&g.get_current_anim_name(b.rig)&&g.play(b.rig)}}function e(a){var b=[0,0,0],c=a.collider;switch(a.type){case J:var e=l.create_ray_sensor(c,b,[0,-100,0],!1,"TERRAIN"),f=l.create_ray_sensor(c,b,[0,-100,0],!1,"STONE"),b=l.create_ray_sensor(c,b,[0,-100,0],!1,"WATER"),e=[e,f,b];l.create_sensor_manifold(c,
"CLOSE_GROUND",l.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},d,a);break;case C:e=l.create_ray_sensor(c,[0,1,0],[0,-99,0],!1,"TERRAIN");e=[e];l.create_sensor_manifold(c,"CLOSE_GROUND",l.CT_CONTINUOUS,e,null,d,a);break;case A:e=l.create_ray_sensor(c,[0,1,0],[0,-99,0],!1,"TERRAIN"),b=l.create_ray_sensor(c,[0,0,0],[0,100,0],!1,"WATER"),e=[e],l.create_sensor_manifold(c,"CLOSE_WATER",l.CT_CONTINUOUS,[b],null,d,a),l.create_sensor_manifold(c,"CLOSE_GROUND",l.CT_CONTINUOUS,e,null,d,a)}}function h(a){function b(c,
d,e){1==e?(z.get_translation(a.empty,a.destination),a.Nn=4):a.Nn=1}var c=a.collider;if(a.type==C){var d=l.create_collision_sensor(c,"CONSTRUCTION",!1);l.create_sensor_manifold(c,"CONSTRUCTION_COLL",l.CT_CONTINUOUS,[d],null,b)}}function k(a){var b=a.rig;if(!g.is_play(b))return!0;b=g.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.wi)return!1;if(-1==c.wi.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||c.Xe&&-1!=c.Xe.indexOf(b)||c.ke&&-1!=c.ke.indexOf(b))return!1;
break;default:return!1}return!0}var f=m("vec3"),n=m("quat"),g=m("animation"),l=m("controls"),y=m("util"),p=m("scenes"),w=m("main"),z=m("transform"),E=[];new Float32Array(9);var B=new Float32Array(3),v=new Float32Array(3),t=new Float32Array(3),x=new Float32Array(3),I=new Float32Array(4),r=new Float32Array(4),q=new Float32Array(4),C=a.NT_WALKING=10,J=a.NT_FLYING=20,A=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);a.start=[];a.ended=[];a.Tj=[];a.xe=null;a.fs=null;a.Th=
null;a.cf=!0;a.Nn=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.Tj[b]=!1;E.push(a)};a.enable_animation=function(){if(E.length){b();var a=l.create_elapsed_sensor();l.create_sensor_manifold(E[0].collider,"ELAPSED",l.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,d){if(1==d)for(a=l.get_sensor_value(a,b,0),b=0;b<E.length;b++){d=E[b];var e=a;if(p.is_visible(d.obj))if(d.random)c(e,d);else{for(var f=w.global_timeline(),g=0;g<d.path.length;g++)if(!d.ended[g]){d.Tj[g]||
(d.Tj[g]=!0,d.destination[0]=d.path[g][0],d.destination[1]=d.path[g][1],d.destination[2]=d.path[g][2],d.start[g]=f+d.delay[g]);if(f<d.start[g])break;c(e,d);d.ended[g]=d.cf;break}a:{for(e=0;e<d.path.length;e++)if(0==d.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<d.path.length;e++)d.Tj[e]=!1,d.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=E.length))for(var a=0;a<E.length;a++){var b=E[a];l.check_sensor_manifolds(b.collider)&&l.remove_sensor_manifold(b.collider);g.is_play(b.rig)&&g.stop(b.rig)}}};b4w.module.mouse=function(a,m){function c(){1==A&&(A=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);w.remove_sensor_manifold(B.get_active_camera(),"SMOOTH_PL")}function d(a){2==A&&(A=0);a.removeEventListener("mousedown",e,!1);a.removeEventListener("mouseup",h,!1);a.removeEventListener("mousemove",b,!1);w.remove_sensor_manifold(B.get_active_camera(),"SMOOTH_DRAG")}function b(a){C()&&(r[0]+=2*(a.clientX-x),r[1]+=
2*(a.clientY-I),x=a.clientX,I=a.clientY);a.preventDefault()}function e(a){x=a.clientX;I=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function h(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function k(a,b){if(.01<Math.abs(r[0])||.01<Math.abs(r[1])){var c=w.get_sensor_value(a,b,0),d=v.smooth(r[0],0,c,.1),e=v.smooth(r[1],0,c,.1),c=B.get_first_character(),f=B.get_active_camera();p.rotate_eye_camera(f,4E-4*-d,4E-4*-e);r[0]-=d;r[1]-=e;c&&
(d=p.get_camera_angles_char(f,q),z.set_character_rotation(c,d[0],d[1]))}}function f(){t.detect_mobile()||t.get_canvas_elem().addEventListener("mousemove",g)}function n(){t.detect_mobile()||(t.get_canvas_elem().removeEventListener("mousemove",g),J&&B.set_outline_intensity(J,0))}function g(a){(a=B.pick_object(l(a),y(a)))?(B.outlining_is_enabled(a)&&B.set_outline_intensity(a,1),B.outlining_is_enabled(J)&&a!=J&&B.set_outline_intensity(J,0)):B.outlining_is_enabled(J)&&B.set_outline_intensity(J,0);J=a}
function l(a){return a.clientX||a.touches&&a.touches[0].pageX||-1}function y(a){return a.clientY||a.touches&&a.touches[0].pageY||-1}var p=m("camera"),w=m("controls"),z=m("physics"),E=m("print"),B=m("scenes"),v=m("util"),t=m("main"),x=0,I=0,r=new Float32Array(2),q=new Float32Array(2),C=null,J=null,A=0;a.request_pointerlock=function(a,b,c,e,f){function g(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){d(a);a.addEventListener("mousemove",
e,!1);var f=B.get_active_camera();if(!w.check_sensor_manifold(f,"SMOOTH_PL")){var h=w.create_elapsed_sensor();w.create_sensor_manifold(f,"SMOOTH_PL",w.CT_CONTINUOUS,[h],null,k)}b()}else a.removeEventListener("mousemove",e,!1),A=0,document.removeEventListener("pointerlockchange",g,!1),document.removeEventListener("webkitpointerlockchange",g,!1),document.removeEventListener("mozpointerlockchange",g,!1),c()}if(1!=A){A=1;b=b||function(){};c=c||function(){};f=f||function(){return!0};e=e||function(a){if(f()){var b=
a.movementY||a.webkitMovementY||a.mozMovementY||0;r[0]+=a.movementX||a.webkitMovementX||a.mozMovementX||0;r[1]+=b}};document.addEventListener("pointerlockchange",g,!1);document.addEventListener("webkitpointerlockchange",g,!1);document.addEventListener("mozpointerlockchange",g,!1);var h=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof h?h.apply(a):E.error("Pointer lock is not available")}};a.exit_pointerlock=c;a.check_pointerlock=function(a){return"function"===
typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b){if(2!=A){A=2;c();C=b||function(){return!0};a.addEventListener("mousedown",e,!1);a.addEventListener("mouseup",h,!1);var d=B.get_active_camera();if(!w.check_sensor_manifold(d,"SMOOTH_DRAG")){var f=w.create_elapsed_sensor();w.create_sensor_manifold(d,"SMOOTH_DRAG",w.CT_CONTINUOUS,[f],null,k)}}};a.exit_mouse_drag=d;a.enable_mouse_hover_outline=f;a.enable_mouse_hover_glow=function(){E.error("enable_mouse_hover_glow() deprecated, use enable_mouse_hover_outline() instead");
f()};a.disable_mouse_hover_outline=n;a.disable_mouse_hover_glow=function(){E.error("disable_mouse_hover_glow() deprecated, use disable_mouse_hover_outline() instead");n()};a.get_coords_x=l;a.get_coords_y=y};b4w.module.preloader=function(a,m){var c=m("app"),d,b,e,h,k,f,n,g,l,y=null;a.create_simple_preloader=function(a){var c=null,g=null,l="#bf9221",m="#000",n;for(n in a)switch(n){case "canvas_container_id":c=a.canvas_container_id;break;case "background_container_id":g=a.background_container_id;break;case "bg_color":m=a.bg_color;break;case "bar_color":l=a.bar_color;break;case "preloader_fadeout":d=a.preloader_fadeout}a=document.createElement("div");n=document.createElement("div");a.id="simple_preloader_container";
var t=document.createElement("div"),x=document.createElement("div"),g=document.getElementById(g);y=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+m+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";n.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";t.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
l+";border-radius: 0px;";x.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+n.appendChild(t);n.appendChild(x);a.appendChild(n);document.body.appendChild(a);b="SIMPLE";e=a;h=t;k=x;f=g};a.create_rotation_preloader=function(a){var c=null,d=null,g="rgba(0,0,0,0)",h="",l="",m="rgba(0,0,0,0)",x;for(x in a)switch(x){case "canvas_container_id":c=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":g=a.frame_bg_color;break;case "bg_color":m=a.bg_color;break;case "frame_class":h=a.frame_class;break;case "anim_elem_class":l=a.anim_elem_class}a=document.createElement("div");x=document.createElement("div");var I=document.createElement("div"),r=document.createElement("div"),d=document.getElementById(d);y=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+m+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
x.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+g+";";I.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";r.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";I.className=l;x.appendChild(I);x.className=h;x.appendChild(r);
a.appendChild(x);y.appendChild(a);b="ROTATION";e=a;n=I;k=r;f=d};a.create_advanced_preloader=function(a){var c=a.preloader_width,c=c/(c-a.img_width),d=document.getElementById(a.preloader_bar_id),m=document.getElementById(a.fill_band_id),n=document.getElementById(a.preloader_caption_id),v=document.getElementById(a.preloader_container_id),t=document.getElementById(a.background_container_id);y=document.getElementById(a.canvas_container_id);b="ADVANCED";h=d;g=m;l=c;k=n;e=v;f=t};a.update_preloader=function(a){k.innerHTML=
a+"%";"SIMPLE"==b&&(h.style.width=a+"%");"ADVANCED"==b&&(h.style.width=a/l+"%",g.style.width=100-a+"%");"ROTATION"==b&&(n.style.transform="rotate("+a+"deg)");100==a&&(d?(c.css_animate(f,"opacity",1,0,1500,null,null,function(){f.parentNode.removeChild(f)}),c.css_animate(e,"opacity",1,0,1E3,null,null,function(){e.parentNode.removeChild(e)})):(e.parentNode.removeChild(e),f&&f.parentNode.removeChild(f)))}};b4w.module.storage=function(a,m){function c(a){e=a;try{h=window.localStorage}catch(c){b.warn("Applying chrome localStorage bug workaround"),h=null}h||(b.warn("localStorage is not available, initializing temporary storage"),h={})}function d(){return h[e]?JSON.parse(h[e]):{}}var b=m("__print"),e="",h=null;a.init=c;a.set=function(a,b){var c=d();c[a]=String(b);h[e]=JSON.stringify(c)};a.cleanup=function(){delete h[e]};a.get=function(a){var b=d();return b[a]?b[a]:""};a.debug=function(){b.log(d())};c("b4w")};b4w.module.screenshooter=function(a,m){var c=m("main");a.shot=function(){c.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style="display: none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
