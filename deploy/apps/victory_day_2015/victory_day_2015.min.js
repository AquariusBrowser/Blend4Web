b4w.register("victory_day_2015_main",function(db,g){function eb(a,c){if(c){k=a;Da.pause();fb();var b=gb.get_std_assets_path();hb.load(b+"victory_day_2015/main_scene.json",ib,jb);Ea();window.addEventListener("resize",Ea)}else console.log("b4w init failure")}function Y(a){if(q){var c=Z.get_coords_x(a);a=Z.get_coords_y(a);Fa(c,a);Ga(c,a)}}function Q(){la&&(la=!1,ma?(q=null,kb()):(C.pop(),C.pop(),d.remove_object(q),q=null,--t))}function kb(){var a=C[C.length-2],c=C[C.length-1],b=m.get_tsr(a,h.create()),
e=m.get_tsr(c,h.create()),D=h.transform_vec3(Ha,e,e);E.animate(0,1,500,function(e){var d=h.interpolate(b,D,J.smooth_step(e),h.create());m.set_tsr(a,d);1==e&&lb(a,c)})}function lb(a,c){var b=m.get_tsr(a,h.create()),e=m.get_tsr(c,h.create());Math.round(Math.random())?p.play_def(Ia):p.play_def(Ja);E.animate(0,1,500,function(d){var z=h.interpolate(b,e,J.smooth_step(d),h.create());m.set_tsr(a,z);1==d&&(k.addEventListener("mousedown",B),k.addEventListener("touchstart",B),S.append_stiff(a,c,u.set(0,0,0,
aa)),K.set_nodemat_value(L,["control_box","Value"],1))})}function B(a){a.preventDefault&&a.preventDefault();var c=Z.get_coords_x(a);a=Z.get_coords_y(a);var b=d.pick_object(c,a);if(b)switch(d.get_object_name(b)){case "rockets_box":if(16!=t){t+=1;q=b=K.copy(Ka,"rocket_"+t);C.push(b);var e="";10>t&&(e="0");na=e=d.get_object_by_dupli_name("bm_13","rail_"+e+t);C.push(e);d.append_object(b);Fa(c,a);Ga(c,a);la=!0}break;case "control_box_button":ba=2,mb()}}function mb(){t&&(k.removeEventListener("mousedown",
B),k.removeEventListener("touchstart",B),p.stop(oa),p.play_def(oa),b.apply(A,"press_button_Action"),b.set_behavior(A,b.AB_FINISH_STOP),b.play(A),b.set_speed(M,-1),b.play(M,function(){b.apply(n,"bm_13_Armature_rotate_-37_Action");b.set_first_frame(n);b.set_behavior(n,b.AB_FINISH_STOP);b.play(n,nb)}))}function nb(){var a=b.apply,c=b.play,f=b.set_behavior;a(l,T);b.set_frame(l,b.get_anim_start_frame(n));f(l,b.AB_FINISH_STOP);c(l,ob);a(L,"hide_control_box_Action");a(A,"hide_control_box_Action");f(L,b.AB_FINISH_STOP);
f(A,b.AB_FINISH_STOP);c(L);c(A);p.stop(U)}function ob(){for(var a=1;a<=t;a++)pb(a)}function pb(a){var c=d.append_object,f=S.append_stiff,e=b.apply,D=K.copy,z=b.play,g=S.remove,V=d.remove_object,y=b.set_behavior,n=d.show_object,r="";10>a&&(r="0");var N=d.get_object_by_name("rocket_"+a),x=d.get_object_by_dupli_name("bm_13","rail_"+r+a);g(N);var q=D(La,"rocket_flash_"+a),v=D(Ma,"rocket_plume_"+a),w=D(ca,"rocket_start_smoke_"+a,!0),F=D(da,"settling_smoke_"+a);E.set_timeout(function(){c(q);c(v);c(w);c(F);
n(w);n(F);e(q,"rocket_flash_Shader_NodetreeAction");e(v,"rocket_plume_start_Shader_NodetreeAction");e(w,"rocket_start_smoke_Shader_NodetreeAction");e(w,"rocket_start_smoke_finalscale",b.SLOT_1);e(F,"settling smoke_Shader_NodetreeAction");y(v,b.AB_FINISH_STOP);y(q,b.AB_FINISH_STOP);y(w,b.AB_FINISH_STOP);y(w,b.AB_FINISH_STOP,b.SLOT_1);y(F,b.AB_FINISH_STOP);y(O,b.AB_FINISH_STOP);y(P,b.AB_FINISH_STOP);f(q,N,pa);f(v,N,pa);f(w,x,rb);g(w);f(F,N,pa);z(q);z(w,function(){V(w)});var D=h.identity(h.create()),
r=h.identity(h.create());m.get_tsr(w,D);m.get_tsr(w,r);E.animate(0,.5,1E3,function(a){r[2]=D[2]-a;m.set_tsr(w,r)});E.set_timeout(function(){z(w,null,b.SLOT_1)},b.frame_to_sec(9));z(F,function(){g(F);V(F)});z(v,function(){e(v,"rocket_plume_loop__Shader_NodetreeAction");y(v,b.AB_CYCLIC);z(v)});E.set_timeout(function(){g(F)},100);p.play_def(qa);var u=m.get_tsr(N,h.identity(h.create())),A=h.create();h.copy(u,A);var qb=h.transform_vec3(Na,u,A);if(ra?0:a==(0>=t?1==t?1:t-1:t-0))ra=!0,e(O,"residual_smoke_Armature_Action"),
e(P,"residual_smoke_Shader_NodetreeAction"),e(G,"rocket_smoke_Shader_NodetreeAction"),e(G,"rocket_smoke_finalscale",b.SLOT_1),b.set_first_frame(O),b.set_first_frame(P),b.set_first_frame(G),b.set_first_frame(G,b.SLOT_1),y(O,b.AB_FINISH_STOP),y(P,b.AB_FINISH_STOP),y(G,b.AB_FINISH_STOP),y(G,b.AB_FINISH_STOP,b.SLOT_1),z(G),z(G,null,b.SLOT_1),E.set_timeout(function(){n(P);z(O);b.play(P,function(){ra=!1;m.set_tsr(l,Oa);var a=m.get_rotation(l,sa),a=R.rotateX(a,Math.PI,Pa);m.set_rotation_v(l,a);a=d.hide_object;
a(ea);a(fa);a(ta);b.apply(W,"9may_atlas_Shader_NodetreeAction");b.set_first_frame(W);b.set_behavior(W,b.AB_FINISH_STOP);p.stop(ga);p.play_def(ga);ha=0;for(a=2;a<=t+1;a++)sb(a)})},500);1==a&&ua.set_light_params(H,{light_energy:20});E.animate(0,1,2E3,function(c){var b=h.interpolate(u,qb,J.smooth_step(c),h.identity(h.create()));m.set_tsr(N,b);m.set_translation(H,b[0],b[1],b[2]+8);1==c&&(g(q),g(v),V(N),V(q),V(v),a==t&&(C=[],p.stop(qa),k.addEventListener("mousedown",B),k.addEventListener("touchstart",
B)))})},250*a)}function Fa(a,c){var b=Qa.calc_ray(l,a,c,tb),e=Ra.get_pline_directional_vec(b,aa),b=m.get_translation(l,Sa),e=u.scale(e,3,va),b=u.add(b,e,Ta);b[2]=J.clamp(b[2],.5,3);m.set_translation_v(q,b)}function Ga(a,b){var f=m.get_translation(q,aa),e=m.get_rotation(q,sa),h=m.get_translation(na,Sa),g=m.get_rotation(na,Pa),d=Qa.project_point(l,h,va),k=a-d[0],d=b-d[1],k=Math.sqrt(k*k+d*d);400>k?ma=!0:(ma=!1,k=400);d=J.quat_to_dir(e,J.AXIS_MZ,va);f=u.subtract(f,h,Ta);u.normalize(f,f);f=R.rotationTo(d,
f,ub);R.multiply(f,e,e);R.normalize(e,e);e=R.slerp(g,e,k/400,vb);m.set_rotation_v(q,e)}function wa(){var a=document.querySelector("#content"),b=document.querySelector("#info_container"),f=document.querySelector("#footer");ia>window.innerHeight+10?(ia-50>=window.innerHeight&&(f.style.backgroundImage="url(icons/scroll_img.png)",a.style.backgroundImage="url(icons/scroll_fade_img.png)"),440>window.innerHeight?(a.style.display="none",f.style.backgroundImage="",a.style.backgroundImage=""):(ia-50>=window.innerHeight&&
(f.style.backgroundImage="url(icons/scroll_img.png)",a.style.backgroundImage="url(icons/scroll_fade_img.png)"),a.style.display="",a.style.height=b.offsetHeight-200-175+"px"),380>window.innerWidth&&(a.style.height=parseInt(a.style.height)+70+"px")):(a.style.height="",f.style.backgroundImage="",a.style.backgroundImage="")}function ib(){var a=I.get_url_params();if(a&&"lang"in a){var c="ru";"ru"==a.lang&&(c="en");var a=document.querySelector("#social_buttons."+c),f=document.querySelector("#info."+c),
c=document.querySelector("#run_button."+c);a.parentNode.removeChild(a);f.parentNode.removeChild(f);c.parentNode.removeChild(c)}X=document.querySelector("#replay");xa=X.querySelector("#replay_circle");x=document.querySelector("#info_container");ja=document.querySelector("#blend4web_logo");ka=document.querySelector("#social_buttons");c=d.get_object_by_dupli_name;a=d.get_object_by_name;l=d.get_active_camera();W=c("9_may_logo","planes");ea=c("firework","firework_1");fa=c("firework","firework_2_1");ta=
c("firework","firework_2_2");Ka=c("rocket","rocket");Ua=a("Empty_camera_position_2");U=c("red_square","noise_spk");oa=c("control_box","button_spk");Ia=c("bm_13","load_spk");Ja=c("bm_13","load_spk_2");n=c("bm_13","bm_13_Armature");ga=c("bg","fireworks_spk");L=c("control_box","control_box");A=c("control_box","control_box_button");qa=c("bm_13","shot_spk");La=c("rocket_plume_flash","rocket_flash");Ma=c("rocket_plume_flash","rocket_plume");ca=c("rocket_start_smoke","rocket_start_smoke");O=c("residual_smoke",
"residual_smoke_Armature");P=d.get_object_children(O)[0];da=c("settling smoke","settling smoke");G=c("rocket_smoke","rocket_smoke");H=a("rocket_Point_1");Va=a("bm_13");M=c("rockets_box","rockets_box_Armature");Wa=ua.get_light_params(H);c=m.get_tsr;a=u.set;c(l,ya);c(ea,za);c(fa,Aa);Aa[3]=1;u.subtract(Aa,za,Ba);c(Ua,Oa);a(0,0,-1.1,Ha);a(0,0,85,Na);c(H,Xa);c=d.get_object_by_name("control_box");f=h.multiply(h.invert(ya,h.create()),m.get_tsr(c),h.create());a=Math.abs(f[2]);f=h.get_quat_view(f);S.append_stiff_viewport(c,
l,{right:0,bottom:0,distance:a,rotation:f});S.append_track(H,Va);Ya();b.apply(l,T);b.set_last_frame(l);window.addEventListener("resize",wa)}function Ya(){T=window.innerWidth>window.innerHeight?"Camera_wide screen_Action":"Camera_narrow_screen_Action";l&&1==ba&&!b.is_play(l)&&b.apply(l,T)}function sb(a){var c=K.copy,f=d.show_object,e=d.append_object,h=d.remove_object,g=b.apply,k=b.play,l=b.SLOT_1,r=m.set_tsr,q=c(ea,"firework_"+a,!0),p=c(fa,"firework_"+a+t+1,!0),n=c(ta,"firework_"+a+t+2,!0);f(q);f(p);
f(n);var c=Math.floor(Math.random()*Za.length),c=Za[c],f=.4*-Math.random()+-.2,u=2*Math.random()+-1,x=.3*-Math.random()+0;K.set_nodemat_rgb(p,["firework_2","RGB"],c[0]/255,c[1]/255,c[2]/255);K.set_nodemat_rgb(n,["firework_2","RGB"],c[0]/255,c[1]/255,c[2]/255);c=$a(za,f,0,u,x,wb);f=$a(c,Ba[0],-.03*a,Ba[2],0,xb);r(q,c);r(p,f);r(n,f);var v=null;t==a-1&&(v=yb);E.set_timeout(function(){e(q);e(p);e(n);g(q,"firework_1_Shader_NodetreeAction");g(p,"firework_2_Action");g(p,"firework_2_Shader_NodetreeAction",
l);g(n,"firework_2_Action");g(n,"firework_2_Shader_NodetreeAction",l);k(q,function(){h(q)});k(n);k(p,function(){h(p)});k(n,function(){h(n);v&&v()},l)},ha);ha+=500*(.5+Math.random())}function yb(){p.stop(ga);b.play(W,zb)}function zb(){xa.addEventListener("click",ab);var a=X.style;a.opacity=0;a.display="block";a=ja.style;a.opacity=0;a.display="block";a=ka.style;a.opacity=0;a.display="block";I.css_animate(X,"opacity",0,1,1E3,"","",function(){I.css_animate(ja,"opacity",0,1,300);I.css_animate(ka,"opacity",
0,1,500)});b.apply(n,"bm_13_Armature_rotate_-20_Action");b.set_behavior(n,b.AB_FINISH_STOP);b.set_first_frame(n)}function ab(){ja.style.display="";ka.style.display="";X.style.display="";K.set_nodemat_value(L,["control_box","Value"],0);b.set_first_frame(l);xa.removeEventListener("click",ab);t=0;m.set_tsr(l,ya);m.set_tsr(H,Xa);ua.set_light_params(H,Wa);b.apply(l,T);b.set_first_frame(L);b.set_first_frame(A);p.play_def(U);ba=1;bb()}function $a(a,b,f,e,g,d){h.identity(d);g=R.setAxisAngle(J.AXIS_MY,g,sa);
b=u.set(b,f,e,aa);h.set_trans(b,d);h.set_quat(g,d);h.multiply(a,d,d);return d}function Ea(){Ab.resize_to_container();Ya()}function jb(a){var b=r.querySelector("#preloader_line_left"),f=r.querySelector("#preloader_line_right"),e=r.querySelector("#percentage");100==a?Bb():(40>=a?b.style.width=2*a+"%":40<a&&60>a?b.style.width="100%":60<a&&(b.style.width="100%",f.style.width=2*(a-50)+"%"),e.innerHTML=a)}function fb(){r=document.querySelector("#preloader_container");var a=r.querySelector("#bg_image_container"),
b=r.querySelector("#bg_fade_container"),f=r.querySelector("#sun_container"),e=r.querySelector("#preloader"),d=I.css_animate;d(b,"opacity",0,.6,300);d(r,"opacity",0,1,300,"","",function(){d(a,"opacity",0,1,300,"","",function(){d(f,"opacity",0,1,300,"","",function(){d(e,"opacity",0,1,300,"","",function(){Da.resume();main_canvas_container.style.visibility="visible"})})})})}function Bb(){Cb();I.css_animate(r,"opacity",1,0,300,"","",function(){r.parentNode.removeChild(r)})}function Cb(){var a=x.querySelector("#close_info_but"),
b=x.querySelector("#run_button"),f=x.querySelector("#info"),e=x.querySelector("#sound_cont");d.hide_object(ca);d.hide_object(da);a.addEventListener("click",cb);b.addEventListener("click",cb);e.addEventListener("click",Db);x.style.display="block";f.style.display="block";b.style.display="block";document.querySelector("#content");ia=x.scrollHeight;wa()}function Db(){var a=x.querySelector("#sound_cont");"active"==a.className?(a.className="",p.mute(null,!0)):(a.className="active",p.mute(null,!1))}function cb(){var a=
document.querySelector("#background_color");window.removeEventListener("resize",wa);d.hide_object(ca);d.hide_object(da);x.parentNode.removeChild(x);a.parentNode.removeChild(a);a=d.get_object_by_dupli_name("red_square","clock_spk");p.stop(a);p.stop(U);p.play_def(a);p.play_def(U);b.set_speed(l,-1);b.set_behavior(l,b.AB_FINISH_STOP);b.play(l,bb)}function bb(){b.apply(M,"opening_rockets_box_Action");b.set_first_frame(M);b.set_behavior(M,b.AB_FINISH_STOP);b.play(M,Eb)}function Eb(){b.apply(n,"bm_13_Armature_rotate_-20_Action");
b.set_first_frame(n);b.set_behavior(n,b.AB_FINISH_STOP);b.play(n,Fb)}function Fb(){k.removeEventListener("mousedown",B);k.removeEventListener("touchstart",B);k.removeEventListener("mousemove",Y);k.removeEventListener("touchmove",Y);k.removeEventListener("mouseup",Q);k.removeEventListener("touchend",Q);document.removeEventListener("mouseout",Q);k.addEventListener("mousedown",B);k.addEventListener("touchstart",B);k.addEventListener("mousemove",Y);k.addEventListener("touchmove",Y);k.addEventListener("mouseup",
Q);k.addEventListener("touchend",Q);document.addEventListener("mouseout",Q);ba=1}var b=g("animation"),I=g("app"),Qa=g("camera"),gb=g("config"),S=g("constraints"),Ab=g("container");g("controls");var hb=g("data"),ua=g("lights"),Da=g("main"),Ra=g("math"),Z=g("mouse"),K=g("objects"),d=g("scenes"),p=g("sfx"),E=g("time"),m=g("transform"),h=g("tsr"),J=g("util"),Gb=g("version"),R=g("quat"),u=g("vec3"),Ca="DEBUG"===Gb.type(),C=[],Za=[[255,255,0],[255,0,148],[0,255,0],[0,0,255],[161,0,255],[255,255,255],[94,
255,255]],ya=new Float32Array(8),Oa=new Float32Array(8),za=new Float32Array(8),Aa=new Float32Array(8),Xa=new Float32Array(8),wb=new Float32Array(8),xb=new Float32Array(8),Ba=new Float32Array(3),Ha=new Float32Array(3),Na=new Float32Array(3),aa=new Float32Array(3),Sa=new Float32Array(3),va=new Float32Array(3),Ta=new Float32Array(3),pa=new Float32Array([0,0,0]),rb=new Float32Array([0,-1,0]);new Float32Array([0,0,-1.2]);var ub=new Float32Array(4),sa=new Float32Array(4),Pa=new Float32Array(4),vb=new Float32Array(4),
tb=Ra.create_pline(),W=null,Va=null,n=null,oa=null,k=null,l=null,Ua=null,L=null,A=null,q=null,na=null,ea=null,fa=null,ta=null,ga=null,H=null,Ia=null,Ja=null,U=null,Ka=null,O=null,P=null,La=null,Ma=null,G=null,ca=null,M=null,da=null,qa=null,ja=null,x=null,X=null,xa=null,ka=null,ia=0,r=null,ma=!1,la=!1,ra=!1,T="",ba=0,ha=0,t=0,Wa=null;db.init=function(){var a=Ca,b=I.get_url_params();b&&"show_fps"in b&&(a=!0);I.init({canvas_container_id:"main_canvas_container",callback:eb,alpha:!1,report_init_failure:!0,
console_verbose:!0,assets_dds_available:!Ca,assets_min50_available:!Ca,show_fps:a})}});b4w.require("victory_day_2015_main").init();
