var qd={},xd;for(xd in window)qd[xd]=!0;var b4w=function(a){var v={};a.module=v;var d={};a.register=function(a,d){if(v[a])throw Error('Module "'+a+'" already registered');v[a]=d};a.require=function(a,p){if(!v[a])throw Error('Module "'+a+'" not found');p=p||"__B4W_DEF_NS";d[p]||(d[p]=function(a){return function(b){var r=v[b];if(!r)throw Error('Module "'+b+'" not found');r.Ii||(r.Ii={});r.Ii[a]||(r.Ii[a]={},r(r.Ii[a],d[a]));return r.Ii[a]}}(p));return d[p](a)};a.module_check=function(a){return v[a]?!0:!1};return a}({});b4w.module.app=function(a,v){function d(){var a=F.Cl();document.addEventListener("visibilitychange",function(){document.hidden?(a=F.Cl(),F.pause()):a||F.od()},!1)}function b(a,b,c,g){var h=document.createElement("canvas");h.style.position="absolute";b?(b=document.createElement("canvas"),b.style.position="absolute",b.style.zIndex="2",b.style.pointerEvents="none"):b=null;if(!F.Qb(h,b))return c&&K("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",
g),null;w=h;c=document.getElementById(a);c||(B.error('Warning: canvas container "'+a+'" not found, appending to body'),c=document.body);c.appendChild(h);b&&c.appendChild(b);return c}function p(a,b){a?(b&&(document.getElementById(b).style.display="block"),g=document.getElementById(a)):(g=document.createElement("div"),g.innerHTML=0,g.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;z-index: 1;",document.body.appendChild(g))}function e(a,
b){var c=String(a);b&&(c+="/"+String(b));g.innerHTML=c}function f(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function r(){F.resize(H.clientWidth,H.clientHeight,!0)}function l(a,b,c){if(A.Xo(a))var g=h.Fd(a,R),d=A.AD(a,U),g=I.subtract(g,d,R),g=Math.max(I.len(g),1);else g=10;d=h.hf(a,aa);b=C.qa(d,b,R);b[1]=0;I.normalize(b,b);I.scale(b,g*c,b);g=h.Fd(a,U);I.add(g,b,g);A.ap(a,g)}function t(a,b){if(A.Xo(a)){var c=A.zD(a,M);if(0>c[1]-c[0]){var g=A.kd(a,
L)[1],c=(c[0]-g)/(c[0]-c[1]),g=A.iD(a),c=Math.max(c,2/g[0]);A.Tg(a,0,c*b)}}else c=h.Fd(a,R),g=I.scale(C.Sa,-b,U),I.add(c,g,c),A.ap(a,c)}function m(a,b,c,g){h.Gc(a,5*b,5*c,5*g)}function x(a,b,c){var g=h.Fd(a,R),d=A.No(a,U),g=I.dist(g,d),d=Math.abs(b);c=Math.pow(d*c,1-Math.pow(d*c,.15));h.Gc(a,0,0>b?.001<g?-g*c:0:c/(1-c)*g,0)}function u(a,b,c,g){for(var h=c*b;0<a;--a)c+=h,g+=h,h=c*b;return g}function y(a,b,c,g,h){h?(h=A.No(a,R),a=A.pu(a),a=I.dist(h,a)+g,g=0<b?u(b,-c,a,g):u(-b,c/(1-c),a,g)):g-=2*b*c;
return g}function K(a,b,c,g){var h=document.createElement("div"),d=document.createElement("div"),w=document.createElement("div");if(g)for(var k=0;k<g.length;k++){var e=document.getElementById(g[k]);e&&e.parentNode.removeChild(e)}h.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";d.style.cssText="color:#fff;font-size:24px;";w.style.cssText="color:#fff;font-size:20px;";d.innerHTML=a;w.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+
c+'">'+c.replace("https://www.","")+"</a>";h.appendChild(d);h.appendChild(w);document.body.appendChild(h)}function G(a,b,c,g){function h(){var w=performance.now()-d;g(a+w*(b-a)/c);w>=c&&F.kF(h)}var d=performance.now();F.ds(h)}v("animation");var A=v("camera"),n=v("config"),q=v("constraints"),c=v("controls"),P=v("data"),O=v("debug"),F=v("main"),k=v("physics"),B=v("print"),J=v("scenes"),h=v("transform"),C=v("util"),I=v("vec3");v("quat");var H=null,w=null,g=null,M=new Float32Array(2),L=new Float32Array(2),
R=new Float32Array(3),U=new Float32Array(3),Z=new Float32Array(3),X=new Float32Array(3),aa=new Float32Array(4);a.Qb=function(a){function g(){var a=b(f,x,I,m);a?(H=a,r(),F.kq(M),E&&(p(l,C),F.LF(e)),V&&d(),q&&F.ds(function(){var a=H.clientWidth,E=H.clientHeight;a==w.clientWidth&&E==w.clientHeight||F.resize(a,E,!0)}),k(w,!0)):k(w,!1)}function h(a){a.keyCode==c.Ry&&(F.Cl()?F.od():F.pause())}function k(){}a=a||{};var f=null,q=!1,M=!1,m=null,l=null,C=null,t=!0,L=!1,V=!0,I=!0,E=!1,N=!1,ha;for(ha in a)switch(ha){case "canvas_container_id":f=
a.canvas_container_id;break;case "callback":k=a.callback;break;case "autoresize":q=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":M=a.gl_debug;break;case "show_hud_debug_info":N=a.show_hud_debug_info;break;case "sfx_mix_mode":L=a.sfx_mix_mode;break;case "show_fps":E=a.show_fps;break;case "fps_wrapper_id":C=a.fps_wrapper_id;break;case "fps_elem_id":l=a.fps_elem_id;break;case "error_purge_elements":m=a.error_purge_elements;break;case "report_init_failure":I=a.report_init_failure;
break;case "pause_invisible":V=a.pause_invisible;break;case "key_pause_enabled":t=a.key_pause_enabled;break;default:n.set(ha,a[ha])}t&&document.addEventListener("keydown",h,!1);n.set("show_hud_debug_info",N);n.set("sfx_mix_mode",L);var x=N||L||null;"complete"==document.readyState?window.setTimeout(g,0):window.addEventListener("load",g,!1);window.addEventListener("unload",function(){P.Y()},!1)};a.UM=r;a.$K=function(){return H};a.vN=function(a,b){var c=f(a);c.addEventListener("mouseup",function(){b(c.value)},
!1)};a.uN=function(a,b){var c=f(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.wN=function(a,b){var c=f(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.tC=function(){function a(E,b,N,g){if(1==N){var h=n?.003*r[0]:.003*r[1];N=c.Pb(E,b,0);c.te(E,b,0)===c.uk?(nb+="X"==g?-N*h:0,Ea+="Y"==g?-N*h:0):c.te(E,b,0)===c.sk&&(E=n?.003*r[1]:7.5E-4*r[0],kb+="X"==g?-N*E:0,Ta+="Y"==g?-N*E:0)}}function b(a,E,N,g){if(1==N){N=c.Pb(a,E,1);A.mj(a,r);if(n)h=
.003*r[0],d=7.5E-4*r[1];else var h=.003*r[1],d=7.5E-4*r[0];if(1===c.te(a,E,0))v+="X"==g?-N*h:0,aa+="Y"==g?-N*h:0;else if(2===c.te(a,E,0)||3===c.te(a,E,0))lb+="X"==g?-N*d:0,ua+="Y"==g?-N*d:0}}function g(a){return a[0]&&(a[1]||a[2])}function d(a,E,b){if(!H||!c.Pb(a,"CAMERA_COLLISION",1)){if(1==b)switch(b=c.Pb(a,E,0),A.mj(a,r),E){case "FORWARD":f?S[0]=1:n?(E=A.kd(a,L)[1],E=Math.abs(E)>=Math.PI/4?C.Sf:C.vc,l(a,E,.5*r[0]*b)):e?x(a,-r[2],b):m(a,0,-r[0]*b,0);break;case "BACKWARD":f?S[0]=-1:n?(E=A.kd(a,L)[1],
E=Math.abs(E)>=Math.PI/4?C.rd:C.Sa,l(a,E,.5*r[0]*b)):e?x(a,r[2],b):m(a,0,r[0]*b,0);break;case "UP":n?t(a,30*-r[2]*b):f||m(a,0,0,-r[0]*b);break;case "DOWN":n?t(a,30*r[2]*b):f||m(a,0,0,r[0]*b);break;case "LEFT":f?S[1]=1:n?l(a,C.Tm,.5*r[0]*b):m(a,-r[0]*b,0,0);break;case "RIGHT":f?S[1]=-1:n?l(a,C.Qe,.5*r[0]*b):m(a,r[0]*b,0,0);break;case "ROT_LEFT":e?A.Ee(a,2*-r[1]*b,0):A.Kc(a,2*r[1]*b,0);break;case "ROT_RIGHT":e?A.Ee(a,2*r[1]*b,0):A.Kc(a,2*-r[1]*b,0);break;case "ROT_UP":e?A.Ee(a,0,2*-r[1]*b):A.Kc(a,0,
2*r[1]*b);break;case "ROT_DOWN":e?A.Ee(a,0,2*r[1]*b):A.Kc(a,0,2*-r[1]*b)}else switch(E){case "FORWARD":case "BACKWARD":f&&(S[0]=0);break;case "LEFT":case "RIGHT":f&&(S[1]=0)}f&&(k.jq(f,S[0],S[1]),a=A.ll(a,M),k.nm(f,a[0],a[1]))}}var w=J.hj(),e=!1,f=null,n=!1;switch(A.gf(w)){case A.ta:e=!0;break;case A.Mb:f=J.tD();break;case A.Uf:return;case A.wb:n=!0}var r=A.mj(w,X),p=c.uh();if(k.Zo(w)){var H=c.Wn(w,null,!0);c.M(w,"CAMERA_COLLISION",c.ca,[p,H],null,function(a,E,b){if(1==b){E=c.te(a,E,1);b=h.Fd(a,R);
var N=U;I.sub(b,E,N);I.normalize(N,N);I.scale(N,.01,N);I.add(b,N,b);h.rq(a,b)}})}if(f){var u=h.Fd(w),V=h.hf(w),V=C.Gn(V);u[1]-=.5;k.om(f,u,V);q.iA(w,f);var S=new Float32Array(2),E=!0;k.mm(f,k.qr);c.vh(w,"TOGGLE_CHAR_MOVE_TYPE",c.td,c.My,function(){E=!E;k.mm(f,E?k.qr:k.vy)})}var u=c.Ua(c.Ar),V=c.Ua(c.yr),N=c.Ua(c.tr),ha=c.Ua(c.ur),oa=c.Ua(c.Sy),B=c.Ua(c.Ny),G=c.Ua(c.zr),K=c.Ua(c.vr),Q=c.Ua(c.wr),F=c.Ua(c.xr);n||(c.M(w,"FORWARD",c.ca,[p,u],null,d),c.M(w,"BACKWARD",c.ca,[p,V],null,d));e?(c.M(w,"ROT_UP",
c.ca,[p,G,oa],g,d),c.M(w,"ROT_DOWN",c.ca,[p,K,B],g,d),c.M(w,"ROT_LEFT",c.ca,[p,Q,N],g,d),c.M(w,"ROT_RIGHT",c.ca,[p,F,ha],g,d)):n?(c.M(w,"LEFT",c.ca,[p,Q,N],g,d),c.M(w,"RIGHT",c.ca,[p,F,ha],g,d),c.M(w,"FORWARD",c.ca,[p,G,u],g,d),c.M(w,"BACKWARD",c.ca,[p,K,V],g,d),c.M(w,"UP",c.ca,[p,B],g,d),c.M(w,"DOWN",c.ca,[p,oa],g,d)):(c.M(w,"UP",c.ca,[p,oa],g,d),c.M(w,"DOWN",c.ca,[p,B],g,d),c.M(w,"LEFT",c.ca,[p,N],g,d),c.M(w,"RIGHT",c.ca,[p,ha],g,d),c.M(w,"ROT_UP",c.ca,[p,G],g,d),c.M(w,"ROT_DOWN",c.ca,[p,K],g,d),
c.M(w,"ROT_LEFT",c.ca,[p,Q],g,d),c.M(w,"ROT_RIGHT",c.ca,[p,F],g,d));var P=0,u=c.Xn(),O=0,V=c.Zk();c.M(w,"MOUSE_WHEEL",c.sd,[u],null,function(a,E,b){1==b&&(E=c.Pb(a,E,0),A.mj(a,r),e||n?P=y(a,E,r[2],P,e):(r[0]*=1+E*r[2],A.ZF(a,r)))});c.M(w,"TOUCH_ZOOM",c.sd,[V],null,function(a,E,b){1==b&&(b=c.Pb(a,E,0),A.mj(a,r),c.te(a,E,0)===c.tk&&(O=y(a,b,.03*r[2],O,e)))});c.M(w,"ZOOM_INTERPOL",c.ca,[p],null,function(a,E,b){if(1==b&&(e||n))if(1E-5<Math.abs(P)||1E-5<Math.abs(O)){E=c.Pb(a,E,0);b=C.Ub(P,0,E,.1);P-=b;
var N=C.Ub(O,0,E,.15);O-=N;if(!H||!c.Pb(a,"CAMERA_COLLISION",1))if(n)t(a,-(b+N));else{E=A.No(a,R);var g=A.pu(a,U);.001<I.dist(E,g)+b+N?h.Gc(a,0,b+N,0):(b=I.subtract(g,E,U),N=I.normalize(b,Z),I.scale(N,.001,N),I.add(E,N,b),h.rq(a,b),O=P=0)}}else O=P=0});var v=0,aa=0,lb=0,ua=0,u=c.wh("X"),V=c.wh("Y"),N=c.Wk();c.M(w,"MOUSE_X",c.sd,[N,u],null,b,"X");c.M(w,"MOUSE_Y",c.sd,[N,V],null,b,"Y");var nb=0,Ea=0,kb=0,Ta=0,u=c.Ri("X"),V=c.Ri("Y");c.M(w,"TOUCH_X",c.sd,[u],null,a,"X");c.M(w,"TOUCH_Y",c.sd,[V],null,
a,"Y");c.M(w,"ROT_TRANS_INTERPOL",c.ca,[p],null,function(a,E,b){if(1==b&&(.001<Math.abs(v)||.001<Math.abs(aa)||.001<Math.abs(nb)||.001<Math.abs(Ea)||.001<Math.abs(lb)||.001<Math.abs(ua)||1E-5<Math.abs(kb)||1E-5<Math.abs(Ta))){var N=c.Pb(a,E,0),g=C.Ub(v,0,N,.08);E=C.Ub(aa,0,N,.08);v-=g;aa-=E;var h=C.Ub(nb,0,N,.12);b=C.Ub(Ea,0,N,.12);nb-=h;Ea-=b;var d=C.Ub(lb,0,N,.08),w=C.Ub(ua,0,N,.08);lb-=d;ua-=w;var ha=C.Ub(kb,0,N,.12),N=C.Ub(Ta,0,N,.12);kb-=ha;Ta-=N;e?(A.Ee(a,g+h,E+b),A.FE(a,d+ha,w+N)):n?(g+h&&
l(a,C.Qe,.2*(g+h)),E+b&&(g=A.kd(a,L)[1],l(a,Math.abs(g)>Math.PI/4?C.rd:C.Sa,.2*(E+b))),A.Tg(a,d+ha,0)):(A.Kc(a,.5*(g+h),.5*(E+b)),f&&(a=A.ll(a,M),k.nm(f,a[0],a[1])))}});c.vh(w,"DEC_STEREO_DIST",c.td,c.Qy,function(a){A.lx(a,.9*A.Lu(a))});c.vh(w,"INC_STEREO_DIST",c.td,c.Ty,function(a){A.lx(a,1.1*A.Lu(a))})};a.sK=function(){for(var a=J.hj(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),
g=0;g<b.length;g++)c.Ce(a,b[g])};a.AK=function(a){function b(a){return a[0]&&(a[1]||a[2])}function g(a,E,b){if(1==b)switch(b=c.Pb(a,E,0),E){case "FORWARD":d?k.Ci(a,1):h.Gc(a,0,0,1*b);break;case "BACKWARD":d?k.Ci(a,-1):h.Gc(a,0,0,-1*b);break;case "LEFT":d?k.Bi(a,-1):h.Gc(a,1*b,0,0);break;case "RIGHT":d?k.Bi(a,1):h.Gc(a,-1*b,0,0)}else switch(E){case "FORWARD":case "BACKWARD":d&&k.Ci(a,0);break;case "LEFT":case "RIGHT":d&&k.Bi(a,0)}}var d=k.mc(a)||k.nc(a),w=c.uh(),f=c.Ua(c.Ar),e=c.Ua(c.yr),n=c.Ua(c.tr),
q=c.Ua(c.ur),M=c.Ua(c.zr),m=c.Ua(c.vr),l=c.Ua(c.wr),r=c.Ua(c.xr);c.M(a,"FORWARD",c.ca,[w,f,M],b,g);c.M(a,"BACKWARD",c.ca,[w,e,m],b,g);c.M(a,"LEFT",c.ca,[w,n,l],b,g);c.M(a,"RIGHT",c.ca,[w,q,r],b,g)};a.uK=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],g=0;g<b.length;g++)c.Ce(a,b[g])};a.uC=function(){c.$p(document,!1);c.aq(w,!0);c.cq(w,!0);c.bq(w,!0);c.im()};a.tK=function(){c.Rq(document);c.Sq(w);c.Uq(w);c.Tq(w);c.$x()};a.zK=function(){c.vh(null,"CAMERA_SHOT",c.td,c.Oy,function(){O.sE()});
c.vh(null,"LIGHT_SHOT",c.td,c.Py,function(){O.vE()});c.vh(null,"TELEMETRY",c.td,c.Uy,function(){O.Sp()})};a.rF=function(a,b){var g=document.body;function c(){document.fullscreenElement===g||document.webkitFullScreenElement===g||document.mozFullScreenElement===g||document.webkitIsFullScreen||document.msFullscreenElement===g?a():(document.removeEventListener("fullscreenchange",c,!1),document.removeEventListener("webkitfullscreenchange",c,!1),document.removeEventListener("mozfullscreenchange",c,!1),
document.removeEventListener("MSFullscreenChange",c,!1),b())}a=a||function(){};b=b||function(){};document.addEventListener("fullscreenchange",c,!1);document.addEventListener("webkitfullscreenchange",c,!1);document.addEventListener("mozfullscreenchange",c,!1);document.addEventListener("MSFullscreenChange",c,!1);g.requestFullScreen=g.requestFullScreen||g.webkitRequestFullScreen||g.mozRequestFullScreen||g.msRequestFullscreen;g.requestFullScreen==g.webkitRequestFullScreen?g.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):
g.requestFullScreen()};a.wC=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.$A=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.SM=K;a.ql=function(a){a=!!a;var b=location.href.toString();if(-1==
b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),g={},c=0;c<b.length;c++){var h=b[c].split("="),d=h[0];1<h.length?(h=h[1],a?d in g?g[d].push(h):g[d]=[h]:g[d]=h):a?d in g||(g[d]=[]):g[d]=""}return g};a.Zb=function(a,b,g,c,h,d,w,k){function f(h){a.style[b]=d+h+w;if(g>c&&h<=c||g<c&&h>=c)a.style[b]=d+c+w,k()}if(a&&b&&isFinite(g)&&isFinite(c)&&isFinite(h)){d=d||"";w=w||"";k=k||function(){};var e=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==a.style[b])if(void 0!=a.style["webkit"+e])b=
"webkit"+e;else if(void 0!=a.style["ms"+e])b="ms"+e;else if(void 0!=a.style["moz"+e])b="moz"+e;else return;G(g,c,h,f)}}};b4w.module.animation=function(a,v){var d=v("__animation"),b=v("__constraints");v("__physics");var p=v("__print"),e=v("__util");a.bb=d.bb;a.Mr=d.Mr;a.Nr=d.Nr;a.Or=d.Or;a.Pr=d.Pr;a.Qr=d.Qr;a.Rr=d.Rr;a.Ym=d.Ym;a.Zm=d.Zm;a.Cr=d.Cr;a.Er=d.Er;a.Hr=d.Hr;a.Gr=d.Gr;a.Fr=d.Fr;a.Dr=d.Dr;a.Pm=d.Pm;a.Qm=d.Qm;a.Rm=d.Rm;var f=new Float32Array(4);a.Na=function(a){return d.Na(a)};a.WK=function(){p.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],b=d.bD(),e=0;e<b.length;e++)a.push(d.yG(b[e].name));
return a};a.dL=function(b,d){p.error("get_current_action() deprecated, use get_current_anim_name() instead");return a.nD(b,d)};a.cu=function(a){return d.yl(a)?d.cu(a):[]};a.nD=function(a,b){if(!d.Na(a))return null;b=b||d.bb;return d.dD(a,b)};a.apply=function(a,b,e){if(e>d.Ym)p.error("Can't apply animation to slot "+e+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{e=e||d.bb;if(d.Na(a)){var f=d.Oo(a,b);if(-1!=f&&f!=e){p.error('Animation "'+b+'" is already applied to object "'+
a.name+'" (slot "'+f+'").');return}}d.tH(a,b)?d.apply(a,b,e):p.error('No fcurves in action "'+b+'"')}};a.remove=function(a){d.remove(a)};a.Jw=function(a,b){d.Na(a)&&(b=b||d.bb,d.Jw(a,b))};a.qn=function(a){d.qn(a)};a.play=function(a,b,e){d.Na(a)?(e=e||d.bb,d.play(a,b,e),d.Hm(a,0,e,!0)):p.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){d.Na(a)&&(b=b||d.bb,d.stop(a,b))};a.rj=function(a,b){if(!d.Na(a))return!1;b=b||d.bb;return d.rj(a,b)};a.lq=function(b,d,e){p.error("set_current_frame_float() deprecated, use set_frame() instead");
a.MF(b,d,e)};a.Io=function(b,d){p.error("get_current_frame_float() deprecated, use get_frame() instead");return a.wD(b,d)};a.MF=function(a,b,e){d.Na(a)&&(e=e||d.bb,d.lq(a,b,e),d.Hm(a,0,e,!0))};a.wD=function(a,b){if(!d.Na(a))return 0;b=b||d.bb;return d.Io(a,b)};a.jx=function(a,b,e){d.Na(a)&&(e=e||d.bb,d.jx(a,b||1,e))};a.Iu=function(a,b){if(!d.Na(a))return 0;b=b||d.bb;return a.C[b]?d.Iu(a,b):0};a.iL=function(a,b){p.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");
if(d.Na(a)){b=b||d.bb;var e=a.C[b];if(e)return[e.start,e.start+e.length]}return null};a.du=function(a,b){return d.Na(a)&&(b=b||d.bb,a.C[b])?d.du(a,b):-1};a.bu=function(a,b){return d.Na(a)&&(b=b||d.bb,a.C[b])?d.bu(a,b):-1};a.Xc=function(b,e,f){p.error("cyclic() deprecated, use set_behavior() instead");a.lm(b,e?d.Pm:d.Qm,f)};a.Nh=function(a,b){p.error("is_cyclic() deprecated, use get_behavior() instead");if(!d.Na(a))return!1;b=b||d.bb;return d.Nh(a,b)};a.lm=function(a,b,e){d.Na(a)&&(e=e||d.bb,d.lm(a,
b,e))};a.gu=function(a,b){if(!d.Na(a))return null;b=b||d.bb;return d.gu(a,b)};a.ls=function(a,b,e,f){f=f||d.bb;d.Na(a)&&d.ls(a,b,e,f)};a.Hm=function(a,b,e,f){d.Na(a)&&(e=e||d.bb,d.Hm(a,b||0,e,f||!1))};a.Tt=function(a){return d.Tt(a)};a.ZK=function(a,d,p){if(!e.we(a))return null;p||(p=new Float32Array(3));b.hD(a,d,!1,f,null);p[0]=f[0];p[1]=f[1];p[2]=f[2];return p};a.ij=function(a){return e.lc(a)?d.ij(a):null};a.Oo=function(a,b){return d.Na(a)&&b?d.Oo(a,b):null};a.eu=function(a,b){return d.Na(a)?d.eu(a,
b):null};a.ms=function(a,b){return d.ms(a,b)};a.CL=function(a){return a.d.Te};a.hx=function(a,b,f){e.we(a)?(b=Math.min(Math.max(b,0),1),a.d.Te!=b&&d.hx(a,b,f||0)):p.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.__animation=function(a,v){function d(a,b){var g=a.C[b];g&&g.xo&&g.bj&&(g.bj=!1,g.xo(a))}function b(a,b,g){g=a.C[g];g.type=30;var c=b.frame_start,h=b.frame_end-c+1;g.start=c;g.length=h;g.Bc=c;g.lh=b.name;for(h=c=0;h<a.data.b4w_vertex_anim.length;h++){var d=a.data.b4w_vertex_anim[h];if(d==b)break;else c+=d.frame_end-d.frame_start+1}g.hy=c}function p(a,b,g){a=a.C[g];a.type=50;a.lh=b.name;g=b.settings;a.start=g.frame_start;a.length=g.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=g.lifetime);
a.Hc=b}function e(a){return a.replace(/_B4W_BAKED$/,"")}function f(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:Y.pa("Wrong animation behavior")}}function r(a){var b=[];a=a.data.materials;for(var g=0;g<a.length;g++){var c=a[g].node_tree;c&&l(c,b)}return b}function l(a,b){if(a.animation_data){var g=a.animation_data.action;g&&Y.Dd(g.fcurves)&&b.push(g)}for(var g=a.nodes,c=0;c<g.length;c++){var h=g[c];h.node_group&&(h=h.node_group.node_tree)&&
l(h,b)}}function t(a){return Y.lc(a)&&a.d.Mm?!0:!1}function m(a){a=a.modifiers;for(var b=0;b<a.length;b++){var g=a[b];if("ARMATURE"==g.type)return g.object}return null}function x(a,b,g){if(-1==b)for(b=0;8>b;b++){var c=a[b];c&&g(c)}else(c=a[b])&&g(c)}function u(a,b,g,c){P(a,b,g,c);d(a,g);a.d.Ue&&(k(a,b),F(a,b))}function y(a,b,g){var h=b.frame_range,d=b.d,w=a.C[g];w.lh=b.name;w.en=h;w.Yr=d.TE;w.Wr=d.EA;w.Ok=d.Ok;w.start=h[0];w.length=h[1]-h[0];w.Bc=h[0];h=Y.Dd(d.Jk);if(Y.we(a)&&h){w.type=10;var e=K(a,
b);e||(e=B(a,b,n(a)),a.fe.push(b,e));w.g=e.g;w.ya=e.ya;var w=a.d,e=w.xm,k=a.C[g],d=k.vq,f;a:{f=w.ux;for(var M=0;M<f.length;M+=2)if(b==f[M]){f=f[M+1];break a}f=null}if(f)k.vq=f;else{for(k=0;k<e.length;k++)f=B(a,b,e[k].Wc),d.push(f);w.ux.push(b,d)}w.Ue&&(b=w.Em,g>b[1]?(w=b[1],b[1]=g,b[0]=w):g>b[0]&&g<b[1]&&(b[0]=g),G(a))}else if(X.ze(a)&&(d.Ya.volume||d.Ya.pitch))w.volume=d.Ya.volume||null,w.pitch=d.Ya.pitch||null,w.type=40;else if("MESH"==a.type&&c(b)){w.type=60;d=K(a,b);if(!d){d=[];k=[];f=[];var M=
[],m=b.d,C=a.d.Hl,V=a.d.Il;for(e in m.Ya){var p=b.name+"%join%"+e;q(e,p,m,k,d,C);q(e,p,m,M,f,V)}d={sH:d,values:k,tF:f,uF:M};a.fe.push(b,d)}w.Pv=d.sH;w.Rv=d.values;w.Ov=d.tF;w.Qv=d.uF}else if(e=d.Ya.tsr){w.type=20;d=K(a,b);if(!d){d=b.d.Uv;k=[];f=[];for(M=0;M<d;M++)k.push(e.subarray(8*M,8*M+4)),f.push(e.subarray(8*M+4,8*M+8));d={g:k,ya:f};a.fe.push(b,d)}w.g=d.g;w.ya=d.ya;R.Yo(a)&&R.iH(a,w.g,w.ya)}else return Z.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;Y.we(a)&&
!h&&A(a,g);return!0}function K(a,b){for(var g=a.fe,c=0;c<g.length;c+=2)if(b==g[c])return g[c+1];return null}function G(a){var b=a.d.Em;if(-1!=b[0]&&-1!=b[1]){var g=a.C;a=g[b[1]].Bc;var c=Math.floor(a),h=a-c,b=g[b[0]];a=b.Bc;c=Math.floor(a);b.Bc=c+h}}function A(a,b){var g=a.d.Em,c=g[1];g[0]=-1;g[1]=-1;if(-1!=b)for(var h=a.C;0<=c;c--){var d=h[c];if(d&&10==d.type)if(c>g[1])g[1]=c;else{c>g[0]&&(g[1]=c);break}}}function n(a){var b=a.data.bones;a=a.pose.bones;for(var g={},c=0;c<b.length;c++){var h=b[c].name;
g[h]={Es:c,Ui:c,Tp:Y.Lo(a,"name",h),jy:-1}}return g}function q(a,b,g,c,h,d){for(var w=0;w<d.length;w+=2)if(b==d[w]){h.push(d[w+1]);c.push(new Float32Array(g.Ya[a]));break}}function c(a){a=a.d;for(var b in a.Ya)if(-1!=b.indexOf("nodes"))return!0;return!1}function P(a,b,g,c){if((g=a.C[g])&&null!=g.type&&(g.play||c)){var h=a.d;c=g.Bc;var d=g.start,w=g.length;c+=g.speed*b*ba.Ma;var e=g.type,k=g.speed;if(0<=k&&c>=d+w||0>k&&c<d)switch(g.bj=!0,g.behavior){case 10:c=0<=k?(c-d)%w+d:d+w-1E-6;break;case 20:c=
0<=k?d:d+w-1E-6;g.play=!1;break;case 30:c=0<=k?d+w-1E-6:d,g.play=!1}g.Bc=c;switch(e){case 10:if(!h.Ue){c=O(g,c,fa);b=c[0];d=c[1];c=c[2];h.Jc=g.ya[b];h.Ic=g.ya[d];h.Rc=g.g[b];h.Qc=g.g[d];h.og=c;h=h.xm;g=g.vq;for(w=0;w<h.length;w++)e=h[w],k=g[w],e.Jc=k.ya[b],e.Ic=k.ya[d],e.Rc=k.g[b],e.Qc=k.g[d],e.og=c;aa.B(a)}break;case 20:e=c=O(g,c,fa);(h=ma)||(h=new Float32Array(4));var d=e[0],w=e[1],e=e[2],k=g.g,f=k[d][1],n=k[d][2],M=k[w][1],q=k[w][2];h[0]=(1-e)*k[d][0]+e*k[w][0];h[1]=(1-e)*f+e*M;h[2]=(1-e)*n+e*
q;d=c;(w=ra)||(w=new Float32Array(4));e=g.ya;ea.slerp(e[d[0]].subarray(0,4),e[d[1]].subarray(0,4),d[2],w);d=w;w=c[2];e=g.g;c=(1-w)*e[c[0]][3]+w*e[c[1]][3];g.Oq&&(w=ca,aa.Fd(a,w),Y.ii(h,w,b,g.Oq,h));g.Yp&&(w=sa,aa.hf(a,w),Y.xx(d,w,b,g.Yp,d));g=g.Ok;g[0]&&aa.Nd(a,h);g[1]&&aa.Ie(a,d);g[2]&&aa.xf(a,c);aa.B(a);U.S(a);break;case 30:(a=fa)||(a=Array(3));d=c-g.start;0>d&&(d=0);d>=g.length&&(d=g.length);b=Math.floor(d);c=b+1;d-=b;10!=g.behavior&&c==g.length&&(c=--b,d=1);g=g.hy;a[0]=b+g;a[1]=c+g;a[2]=d;c=fa;
h.$q=c[0];h.gy=c[2];break;case 40:c=O(g,c,fa);b=c[0];h=c[1];c=c[2];g.volume&&X.sq(a,(1-c)*g.volume[b]+c*g.volume[h]);g.pitch&&X.Hj(a,(1-c)*g.pitch[b]+c*g.pitch[h]);break;case 50:R.VF(g.Hc,c/ba.Ma);break;case 60:c=O(g,c,fa);b=c[0];h=c[1];c=c[2];k=g.Rv;f=g.Pv;d=g.Qv;g=g.Ov;for(w=0;w<f.length;w++)n=k[w],e=f[w],a.d.pf[e]=(1-c)*n[b]+c*n[h];for(w=0;w<g.length;w++)k=d[w],e=g[w],k=la.lerp(k.subarray(3*b,3*b+3),k.subarray(3*h,3*h+3),c,ma),a.d.Gd[e]=k[0],a.d.Gd[e+1]=k[1],a.d.Gd[e+2]=k[2];break;default:Y.pa("Unknown animation type:"+
e)}}}function O(a,b,g){g||(g=Array(3));var c=a.en[0],h=a.en[1]-c;b-=c;0>b&&(b=0);b>=h&&(b=h);b/=a.Yr;h=Math.floor(b);a=a.Wr[h]?b-h:0;g[0]=h;g[1]=h+1;g[2]=a;return g}function F(a,b){var g=a.d,c=g.Te,h=g.Em,d=h[0],h=h[1];if(-1!=h){if(-1!=d){var w=a.C[d];if(w.play||0==b)var e=O(w,w.Bc,fa),k=e[0],f=e[1],e=e[2],n=w.ya[k],M=w.ya[f],k=w.g[k],f=w.g[f];else c=1}else c=1;h=a.C[h];if(h.play||0==b)var e=O(h,h.Bc,fa),q=e[0],m=e[1],e=e[2];else if(-1!=d&&w.play)c=0;else return;d=h.ya[q];w=h.ya[m];q=h.g[q];h=h.g[m];
if(1==c)g.Jc.set(d),g.Ic.set(w),g.Rc.set(q),g.Qc.set(h);else if(0==c)g.Jc.set(n),g.Ic.set(M),g.Rc.set(k),g.Qc.set(f);else{for(m=0;m<n.length;m+=4){for(var C=ra,V=sa,p=0;4>p;p++)C[p]=n[m+p],V[p]=d[m+p];ea.slerp(C,V,c,C);for(p=0;4>p;p++)g.Jc[m+p]=C[p];for(p=0;4>p;p++)C[p]=M[m+p],V[p]=w[m+p];ea.slerp(C,V,c,C);for(p=0;4>p;p++)g.Ic[m+p]=C[p]}Y.As(k,q,c,g.Rc);Y.As(f,h,c,g.Qc)}aa.B(a);c=g.xm;n=g.Lv;for(m=0;m<c.length;m++){M=c[m];k=n[m];for(f=0;f<k.length;f+=2)for(q=k[f],d=k[f+1],w=0;4>w;w++)M.Jc[q+w]=g.Jc[d+
w],M.Ic[q+w]=g.Ic[d+w],M.Rc[q+w]=g.Rc[d+w],M.Qc[q+w]=g.Qc[d+w];M.og=e}}}function k(a,b){var g=a.d,c=g.Te,h=g.kn;if(0!=h){var c=g.jn-c,d=h*b;Y.sign(c)==Y.sign(h)&&Math.abs(d)<Math.abs(c)?g.Te+=d:(g.Te=g.jn,g.kn=0)}}function B(a,b,g){for(var c=a.pose.bones,h=[],d=[],w=b.d.Uv,e=0;e<w;e++){for(var k=0;k<c.length;k++){var f=c[k],n=T.create(),M=b.d.Jk[f.name];M&&T.copy(M.subarray(8*e,8*e+8),n);f.Ur=n;f.zk=!1}k=J(a,g);h.push(k.g);d.push(k.ya)}return{g:h,ya:d}}function J(a,b){var g=[],c=[],h=a.pose.bones,
d=new Float32Array(4),w=new Float32Array(4),e;for(e in b){var k=b[e],f=k.Ui,n=h[k.Tp],k=d,M=w,q=n.Pz,m=q[q.length-1],C=m.dn;m.zk||T.identity(C);for(m=q.length-1;0<=m;m--){var n=q[m],V=n.dn;if(n.zk)C=V;else{var p=n.Vr,L=n.Ur;T.invert(p,qa);T.multiply(L,qa,qa);T.multiply(p,qa,qa);T.multiply(C,qa,V);C=V;n.zk=!0}}n=n.dn;k[0]=n[0];k[1]=n[1];k[2]=n[2];k[3]=n[3];M[0]=n[4];M[1]=n[5];M[2]=n[6];M[3]=n[7];ea.normalize(M,M);for(k=0;4>k;k++)M=4*f+k,g[M]=d[k],c[M]=w[k]}g=new Float32Array(g);c=new Float32Array(c);
return{g:g,ya:c}}function h(a){var b=[0,0,0],g;for(g in a)"location"==g?b[0]=1:"rotation_quaternion"==g?b[1]=1:"scale"==g&&(b[2]=1);return b}function C(a,b,g,c,h,d,w){var e=a+(b-a)/2,k=I(e,c,h,d,w)-g;return.02>Math.abs(k)?e:0<k?C(a,e,g,c,h,d,w):C(e,b,g,c,h,d,w)}function I(a,b,g,c,h){var d=1-a;return b*d*d*d+3*g*d*d*a+3*c*d*a*a+h*a*a*a}function H(a,b){if(!a.C.length)for(var g=0;8>g;g++)a.C.push(null);a.C[b]={type:null,lh:null,en:null,Yr:0,Wr:null,Ok:null,ya:null,g:null,vq:[],play:!1,behavior:20,Bc:0,
start:0,length:0,Oq:0,Yp:0,bj:!1,hy:null,speed:1,volume:null,pitch:null,Rv:[],Pv:[],Qv:[],Ov:[]};a.fe=a.fe||[];-1==V.indexOf(a)&&V.push(a)}function w(a,b){aa.B(a);U.S(a);u(a,0,b,!0)}function g(a,g,c){c=c||0;if(Y.lc(a)){var h=Y.Rb("name",g,a.data.b4w_vertex_anim);if(h)return H(a,c),b(a,h,c),w(a,c),!0;if((h=Y.Rb("name",g,a.particle_systems))&&"EMITTER"==h.settings.type)return H(a,c),p(a,h,c),w(a,c),!0}if(h=Y.Rb("name",g,S)||Y.Rb("name",g+"_B4W_BAKED",S)){H(a,c);if(y(a,h,c))return w(a,c),!0;a.C[c]=null}Z.error('Unsupported object: "'+
a.name+'" or animation name: "'+g+'"');return!1}function M(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var g=a[b],c=g.node_tree;if(g.use_nodes&&c&&c.animation_data)return!0}return!1}var L=v("__config"),R=v("__particles"),U=v("__physics"),Z=v("__print");v("__scenes");var X=v("__sfx"),aa=v("__transform"),T=v("__tsr"),Y=v("__util"),z=v("__reformer");v("mat4");var ea=v("quat");v("vec4");var la=v("vec3"),ba=L.he;a.Cr=10;a.Er=20;a.Hr=30;a.Gr=40;a.Fr=
50;a.Dr=60;a.bb=0;a.Mr=1;a.Nr=2;a.Or=3;a.Pr=4;a.Qr=5;a.Rr=6;a.Ym=7;a.Zm=-1;a.Pm=10;a.Qm=20;a.Rm=30;var fa=Array(3),ma=new Float32Array(3),ca=new Float32Array(3),ra=new Float32Array(4),sa=new Float32Array(4),qa=new Float32Array(8);new Float32Array(16);var V=[],S=[];a.Tt=function(a){return a/ba.Ma};a.update=function(a){for(var b=0;b<V.length;b++){for(var g=V[b],c=0;8>c;c++)P(g,a,c);g.d.Ue&&(k(g,a),F(g,a))}for(b=0;b<V.length;b++)for(g=V[b],c=0;8>c&&g.C.length;c++)d(g,c)};a.bD=function(){return S};a.cu=
function(a){var b=[];if(t(a))for(var g=0;g<a.data.b4w_vertex_anim.length;g++)b.push(a.data.b4w_vertex_anim[g].name);var h,g=[];for(h=0;h<S.length;h++){var d=S[h],w=d.d;Y.Dd(d.d.Jk)?"ARMATURE"==a.type&&g.push(d):w.Ya.volume||w.Ya.pitch?X.ze(a)&&g.push(d):!c(d)&&Y.Dd(d.fcurves)&&g.push(d)}"MESH"==a.type&&(g=g.concat(r(a)));h=g;for(g=0;g<h.length;g++)b.push(e(h[g].name));if(R.Yo(a)&&R.Vo(a))for(g=0;g<a.particle_systems.length;g++)b.push(a.particle_systems[g].name);return b};a.yG=e;a.eu=function(a,b){var g=
a.C[b];return g?g.type:null};a.qn=function(a){var g=0,c,h=[];if((c=a.animation_data)&&c.action&&(c=c.action,Y.Dd(c.fcurves))){var d=Y.Dd(c.d.Jk);"ARMATURE"!=a.type&&d||h.push(c)}X.ze(a)&&a.data.animation_data&&a.data.animation_data.action&&h.push(a.data.animation_data.action);"MESH"==a.type&&(h=h.concat(r(a)));c=h;for(h=0;h<c.length;h++)d=c[h],H(a,g),y(a,d,g)?(w(a,g),a.C[g].behavior=f(a.b4w_anim_behavior),g++):a.C[g]=null;c=a.particle_systems;for(h=0;h<c.length;h++){var d=c[h],e=d.settings;"EMITTER"==
e.type&&(H(a,g),p(a,d,g),w(a,g),a.C[g].behavior=f(a.b4w_anim_behavior),e.b4w_cyclic&&(a.C[g].behavior=10),g++)}t(a)&&(H(a,g),b(a,a.data.b4w_vertex_anim[0],g),w(a,g),a.C[g].behavior=f(a.b4w_anim_behavior))};a.ij=m;a.play=function(a,b,g){x(a.C,g,function(a){a.play=!0;a.xo=b?b:null;a.bj=!1});a.d.Ue&&G(a)};a.stop=function(a,b){x(a.C,b,function(a){a.play=!1;a.xo=null;a.bj=!1})};a.rj=function(a,b){var g=a.C[b];return g?g.play:!1};a.lq=function(a,b,g){var c=a.C;if(-1==g)for(g=0;8>g;g++){var h=c[g];h&&(h.Bc=
b,u(a,0,g,!0))}else if(h=c[g])h.Bc=b,u(a,0,g,!0)};a.Io=function(a,b){var g=a.C[b];return g&&g.Bc?g.Bc:0};a.Nh=function(a,b){var g=a.C[b];return g&&10==g.behavior};a.lm=function(a,b,g){x(a.C,g,function(a){a.behavior=b})};a.gu=function(a,b){var g=a.C[b];return g&&g.behavior};a.ls=function(a,b,g,c){x(a.C,c,function(a){a.Oq=b||0;a.Yp=g||0})};a.Jw=function(a,b){if(-1==b)for(var g=0;8>g;g++)a.C[g]=null;else a.C[b]=null;a.d.Ue&&A(a,b)};a.Hm=u;a.yl=function(a){if("ARMATURE"==a.type||m(a))return!0;var b=a.animation_data;
return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||R.Yo(a)&&R.Vo(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||M(a)?!0:!1};a.Na=function(a){return Boolean(a.C.length)};a.LA=n;a.Gs=J;a.$z=function(a){function b(a,g){for(var c=0;c<g;c++){var E=a.subarray(8*c+4,8*c+8);ea.normalize(E,E)}}function g(a,b){if(-1<a.indexOf("location"))var c=0,E=b;else-1<a.indexOf("rotation_quaternion")?(c=4,E=0==b?3:b-1):-1<a.indexOf("scale")?(c=3,E=0):(c=0,E=b);return c+E}function c(a,
b,g,E,h){if(-1<g.search(w)){a=b;g=g.split('"')[1];var d=e}else 8==h?(g="tsr",d=e):d=1<h?new Float32Array(h):0;if(!a[g]){h=a;b=g;if("object"==typeof d&&d.length)for(var N=d.length,k=new Float32Array(E*N),f=0;f<E;f++)for(var n=0;n<N;n++)k[f*N+n]=d[n];else if("number"==typeof d)for(k=new Float32Array(E),f=0;f<E;f++)k[f]=d;else Y.pa("Wrong storage default value");h[b]=k}return a[g]}a.d={};var d=a.d;d.TE=1/ba.pg;var w=new RegExp(/pose.bones\[\".+\"\]/g),e=T.create(),k=a.fcurves,f={},n={},M=0,q;for(q in k){var m=
k[q],C;for(C in m){var V=m[C],p=V.xc;z.SA(V,a);V=V.num_channels;M||(M=p.length);for(var V=c(f,n,q,M,V),L=V.length/M,t=g(q,C|0),l=0;l<M;l++)V[l*L+t]=p[l]}}for(var r in f)"tsr"==r&&b(f[r],M);for(var I in n)b(n[I],M);d.Ya=f;d.Jk=n;d.EA=a.Oz;d.Uv=M;d.Ok="tsr"in f?h(k):null;S.push(a)};a.fD=function(a,b){return(b-a)*ba.pg+1};a.uA=function(a,b,g,c,h,d){var w,e,k=new Float32Array(2),f=new Float32Array(2),n=new Float32Array(2),M=new Float32Array(2),q=b[1],m=b[2],V=b[a.last_frame_offset+1];a=b[a.last_frame_offset+
2];for(var p=0,L=0,t=null;h<=d;h++)if(h<q)for(var l=0;l<ba.pg;l++)g[p++]=m;else if(h>V)for(l=0;l<ba.pg;l++)g[p++]=a;else{var r=b[L],x=3;0===r&&(x+=2);0===t&&(x+=2);var ca=2===r?0:1;if(b[L+1]==b[L+x+1])t=r,L+=x;else{l=0;h==b[L+1]&&(ca&&(c[p]=1),g[p]=b[L+2],p++,l++);if(h==V)for(;l<ba.pg;l++)g[p++]=a;else for(k[0]=b[L+1],k[1]=b[L+2],0!==r?(f[0]=0,f[1]=0):0===t?(f[0]=b[L+5],f[1]=b[L+6]):(f[0]=b[L+3],f[1]=b[L+4]),0!==r?(n[0]=0,n[1]=0):(n[0]=b[L+x+3],n[1]=b[L+x+4]),M[0]=b[L+x+1],M[1]=b[L+x+2];l<ba.pg;l++){var y=
h+l/ba.pg;switch(r){case 0:w=k;e=f;var H=n,A=M,u=[],J=[],S=void 0,B=void 0,R=void 0,S=void 0;u[0]=w[0]-e[0];u[1]=w[1]-e[1];J[0]=A[0]-H[0];J[1]=A[1]-H[1];R=A[0]-w[0];S=Math.abs(u[0]);B=Math.abs(J[0]);0!=S+B&&S+B>R&&(S=R/(S+B),e[0]=w[0]-S*u[0],e[1]=w[1]-S*u[1],H[0]=A[0]-S*J[0],H[1]=A[1]-S*J[1]);ca&&(c[p]=1);g[p]=I(C(0,1,y,k[0],f[0],n[0],M[0]),k[1],f[1],n[1],M[1]);p++;break;case 1:e=k[0];H=k[1];w=A=(M[1]-H)/(M[0]-e);e=H-A*e;ca&&(c[p]=1);g[p]=w*y+e;p++;break;case 2:ca&&(c[p]=1);g[p]=b[L+2];p++;break;
default:Y.pa("Unknown keyframe intepolation mode: "+r)}}h+1==b[L+x+1]&&(t=r,L+=x)}}};a.KK=function(a){for(var b=0;b<a.length;b++)if(a[b].ZI)return a[b];return!1};a.apply=g;a.pA=function(a,b,g){g=g||0;var c=Y.Rb("uuid",b,S);if(c){H(a,g);if(y(a,c,g)){w(a,g);return}a.C[g]=null}Z.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.tH=function(a,b){var g=Y.Rb("name",b,S)||Y.Rb("name",b+"_B4W_BAKED",S);return g?Y.Dd(g.fcurves)?!0:!1:Y.Rb("name",b,a.particle_systems)?!0:!1};a.Oo=function(a,
b){for(var g=a.C,c=0;c<g.length;c++){var h=g[c];if(h&&e(h.lh)==e(b))return c}return-1};a.dD=function(a,b){var g=a.C[b];return g&&g.lh?e(g.lh):null};a.remove=function(a){a.C.length=0;a=V.indexOf(a);-1!=a&&V.splice(a,1)};a.iF=function(a){for(var b=S.length-1;0<=b;b--)S[b].Qz==a&&S.splice(b,1)};a.ms=function(a,b){if(!a.C.length)return g(a,b,0)?0:-1;for(var c=0;c<a.C.length;c++)if(!a.C[c])return g(a,b,c)?c:-1};a.hx=function(a,b,g){a.d.kn=(b-a.d.Te)/g;a.d.jn=b};a.jx=function(a,b,g){x(a.C,g,function(a){a.speed=
b})};a.Iu=function(a,b){return a.C[b].speed};a.du=function(a,b){return a.C[b].start};a.bu=function(a,b){return a.C[b].length};a.bv=M;a.Y=function(){V.length=0;S.length=0};a.FC=function(a,b){var g=a[b],c=(g[0]||g[1]||g[2]).xc.length,h=ra,d=ma,w=Boolean(g[0]);w||(g[0]={xc:new Float32Array(c),num_channels:8});var e=Boolean(g[1]);e||(g[1]={xc:new Float32Array(c),num_channels:8});var k=Boolean(g[2]);k||(g[2]={xc:new Float32Array(c),num_channels:8});g[3]={xc:new Float32Array(c),num_channels:8};for(var f=
0;f<c;f++)d[0]=w?g[0].xc[f]:0,d[1]=e?g[1].xc[f]:0,d[2]=k?g[2].xc[f]:0,Y.ef(d,h),g[0].xc[f]=h[3],g[1].xc[f]=h[0],g[2].xc[f]=h[1],g[3].xc[f]=h[2];c=b.replace("euler","quaternion");a[c]=g;delete a[b]}};b4w.module.__config=function(a,v){function d(){return b4w.module_check(a.cc.Kk)}function b(){for(var b=a.cc,d=null,e=document.getElementsByTagName("script"),t=0;t<e.length;t++){for(var m=e[t].src,x=0;x<b.xv.length;x++)if(0<=m.indexOf(b.xv[x])){d=m;break}if(null!==d)break}d||(p.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),d=document.location.href);b=d.indexOf("?");0<=b&&(d=d.substring(0,b));return d.substring(0,d.lastIndexOf("/")+1)}var p=v("__print"),
e=v("__util");a.Wf=1;a.Vf=2;a.gh=3;a.Lr=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.tB=e.Ba(a.context);a.q={alpha_sort:!0,alpha_sort_threshold:.1,Dp:"5.03",Hd:1E4,console_verbose:!1,do_not_load_resources:!1,Jm:!1,St:1.5,IC:10,background_color:[0,0,0,0],Fg:.01,resolution_factor:1,canvas_resolution_factor:1,Cm:3,allow_cors:!1,Ao:!1,Bk:!0,show_hud_debug_info:!1,pK:!0,yf:"DEPTH",anaglyph_use:!1,hm:!0,Nj:.5,Kd:!0,Ef:!0,Ah:!0,Jh:!0,oh:!0,Vh:!0,th:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,
qy:!1,cj:!0,Ej:!0,hb:!0,cm:!0,water_dynamic:!0,fi:!0,tm:!0,Id:1024,Ap:512,ld:53,dy:!0,precision:"highp",quality:a.Vf,hn:!0,HE:!1,sx:!1,zt:!1,iy:!1,wg:!1,kv:!1,Mn:!1,Nt:!1,KN:!1,dd:!1,allow_hidpi:!1,gyro_use:!1,Ot:!1,ep:!1,enable_selectable:!0,enable_outlining:!0};a.dC=e.Ba(a.q);a.he={Ma:-1,Ut:!1,pg:1};a.controls={EE:1/120};a.ie={dir:"ASSETS=../../assets/",zE:15,tw:!0,Cp:!1,fo:!1};a.wA=e.Ba(a.ie);a.cc={shaders_dir:"",dG:"include/",Kk:"built_in_data",xv:["b4w.min.js","b4w.full.min.js","src/b4w.js",
"webplayer.min.js"],Nw:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.Db={enabled:!0,Hd:60,ek:"",MA:!1};a.SE=e.Ba(a.Db);a.Uj={rl:1024,$k:384};a.BF=e.Ba(a.Uj);a.pd={hr:!0,Ll:!1,us:!1,Ss:!1,At:!1};a.cG=e.Ba(a.pd);a.Lb={outlining_overview_mode:!1,sf:[1,.4,.05],Jd:1,Rl:.2,Tl:3.8,Ul:1};a.ho={enabled:!1,FG:"MAIN_OPAQUE",EG:0,gG:"COLOR"};a.$B=e.Ba(a.ho);a.tA=function(){var b=a.q,d=a.Db,e=a.Uj;switch(b.quality){case a.gh:b.yf="DEPTH";b.fi=!0;b.Ef=!0;b.Ah=!0;b.Jh=!0;b.oh=!0;b.hm=!0;b.Nj=1;b.Kd=
!0;b.cj=!0;b.Ej=!0;b.hb=!0;b.cm=!0;b.resolution_factor=1.75;e.rl=2048;b.Cm=3;b.Bk=!0;b.Jm=!1;b.ld=53;b.precision="highp";b.water_dynamic=!0;b.tm=!0;b.antialiasing=!0;b.smaa=!0;b.th=!0;b.Vh=!0;b.allow_hidpi=!0;b.enable_outlining=!0;d.Hd=120;break;case a.Vf:b.yf="DEPTH";b.fi=!0;b.Ef=!0;b.Ah=!0;b.Jh=!0;b.oh=!0;b.hm=!0;b.Nj=.5;b.Kd=!0;b.cj=!0;b.Ej=!0;b.hb=!0;b.cm=!0;b.resolution_factor=1;e.rl=1024;b.Cm=3;b.Bk=!0;b.Jm=!1;b.ld=53;b.precision="highp";b.water_dynamic=!0;b.tm=!0;b.antialiasing=!0;b.smaa=!1;
b.th=!0;b.Vh=!0;b.allow_hidpi=!1;b.enable_outlining=!0;d.Hd=60;break;case a.Wf:b.yf="NONE",b.fi=!1,b.Ef=!1,b.Ah=!1,b.Jh=!1,b.oh=!1,b.hm=!1,b.Nj=.5,b.Kd=!1,b.cj=!1,b.Ej=!1,b.hb=!1,b.cm=!1,b.resolution_factor=1,e.rl=512,b.Cm=2,b.Bk=!1,b.Jm=!0,b.ld=53,b.precision="mediump",b.water_dynamic=!1,b.tm=!1,b.antialiasing=!1,b.smaa=!1,b.th=!1,b.Vh=!1,b.allow_hidpi=!1,b.enable_outlining=!1,d.Hd=60}};a.set=function(b,d){switch(b){case "allow_cors":a.q.allow_cors=d;break;case "allow_hidpi":a.q.allow_hidpi=d;break;
case "alpha":a.context.alpha=d;break;case "alpha_sort":a.q.alpha_sort=d;break;case "alpha_sort_threshold":a.q.alpha_sort_threshold=d;break;case "anaglyph_use":a.q.anaglyph_use=d;break;case "animation_framerate":a.he.Ma=d;break;case "antialiasing":a.q.antialiasing=d;break;case "assets_dds_available":a.ie.fo=d;break;case "assets_min50_available":a.ie.Cp=d;break;case "audio":a.pd.hr=d;break;case "background_color":a.q.background_color=d;break;case "built_in_module_name":a.cc.Kk=d;break;case "canvas_resolution_factor":a.q.canvas_resolution_factor=
d;break;case "console_verbose":a.q.console_verbose=d;break;case "context_antialias":a.context.antialias=d;break;case "do_not_load_resources":a.q.do_not_load_resources=d;break;case "gyro_use":a.q.gyro_use=d;break;case "physics_enabled":a.Db.enabled=d;break;case "physics_uranium_path":a.Db.ek=d;break;case "precision":a.q.precision=d;break;case "quality":a.q.quality=d;break;case "resolution_factor":a.q.resolution_factor=d;break;case "sfx_mix_mode":a.pd.Ll=d;break;case "shaders_dir":a.cc.shaders_dir=
d;break;case "show_hud_debug_info":a.q.show_hud_debug_info=d;break;case "smaa":a.q.smaa=d;break;case "smaa_search_texture_path":a.cc.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.cc.smaa_area_texture_path=d;break;case "wireframe_debug":a.q.wireframe_debug=d;break;case "enable_selectable":a.q.enable_selectable=d;break;case "enable_outlining":a.q.enable_outlining=d;break;case "outlining_overview_mode":a.Lb.outlining_overview_mode=d;break;default:p.error("Unknown config property: "+
b)}};a.get=function(b){switch(b){case "allow_cors":return a.q.allow_cors;case "allow_hidpi":return a.q.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.q.alpha_sort;case "alpha_sort_threshold":return a.q.alpha_sort_threshold;case "anaglyph_use":return a.q.anaglyph_use;case "animation_framerate":return a.he.Ma;case "antialiasing":return a.q.antialiasing;case "assets_dds_available":return a.ie.fo;case "assets_min50_available":return a.ie.Cp;case "audio":return a.pd.hr;case "background_color":return a.q.background_color;
case "built_in_module_name":return a.cc.Kk;case "canvas_resolution_factor":return a.q.canvas_resolution_factor;case "console_verbose":return a.q.console_verbose;case "context_antialias":return a.context.antialias;case "do_not_load_resources":return a.q.do_not_load_resources;case "gyro_use":return a.q.gyro_use;case "physics_enabled":return a.Db.enabled;case "physics_uranium_path":return a.Db.ek;case "precision":return a.q.precision;case "quality":return a.q.quality;case "resolution_factor":return a.q.resolution_factor;
case "sfx_mix_mode":return a.pd.Ll;case "shaders_dir":return a.cc.shaders_dir;case "show_hud_debug_info":return a.q.show_hud_debug_info;case "smaa":return a.q.smaa;case "smaa_search_texture_path":return a.cc.smaa_search_texture_path;case "smaa_area_texture_path":return a.cc.smaa_area_texture_path;case "wireframe_debug":return a.q.wireframe_debug;case "enable_selectable":return a.q.enable_selectable;case "enable_outlining":return a.q.enable_outlining;case "outlining_overview_mode":return a.Lb.outlining_overview_mode;
default:p.error("Unknown config property: "+b)}};a.reset=function(){a.context=e.Ba(a.tB);a.q=e.Ba(a.dC);a.ie=e.Ba(a.wA);a.Db=e.Ba(a.SE);a.Uj=e.Ba(a.BF);a.pd=e.Ba(a.cG);a.ho=e.Ba(a.$B)};a.ov=d;a.RF=function(){var e=a.cc,p=a.Db;d()||""!=e.shaders_dir||(e.shaders_dir=b()+"../shaders/");if(d())e.smaa_search_texture_path="smaa_search_texture.png",e.smaa_area_texture_path="smaa_area_texture.png";else if(""==e.smaa_search_texture_path||""==e.smaa_area_texture_path){var l=b()+e.Nw;e.smaa_search_texture_path=
e.smaa_search_texture_path||l+"smaa_search_texture.png";e.smaa_area_texture_path=e.smaa_area_texture_path||l+"smaa_area_texture.png"}p.enabled&&""==p.ek&&(l=b()+e.Nw,p.ek=l+"uranium.js")};a.Ku=function(){return a.ie.dir.replace("ASSETS=","")}};b4w.module.__print=function(a){function v(a,b){var d=[];-1<a[0].indexOf("%c")?d.push(a[0].replace("%c","%c"+b+": ")):d.push(b+": "+a[0]);for(var p=1;p<a.length;p++)d.push(a[p]);return d}var d=!1,b=0,p=0;a.$F=function(a){d=a};a.log=function(){if(d){var a=v(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){b++;var a=v(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){p++;var a=v(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=
v(arguments,"B4W INFO");console.info.apply(console,a)};a.yC=function(){b++;var a=v(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.zC=function(){p++;var a=v(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){d&&console.time.apply(console,arguments)};a.timeEnd=function(){d&&console.timeEnd.apply(console,arguments)};a.group=function(){d&&console.group.apply(console,arguments)};a.groupCollapsed=function(){d&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){d&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.ND=function(){return p};a.rD=function(){return b};a.Vs=function(){b=p=0}};b4w.module.print=b4w.module.__print;b4w.module.__util=function(a,v){function d(a,b,g){for(var c=[],d=g.length,h=0;h<d;h++){var w=g[h];w[a]==b&&c.push(w)}return c}function b(a,g){var c=a instanceof Array?[]:{},d;for(d in a)c[d]=!a[d]||"object"!=typeof a[d]||-1!=g.indexOf(a[d])||a[d]instanceof Float32Array?a[d]:b(a[d],g);return c}function p(a){var b=a[0],g=a[1],c=a[2],d=a[3],h=Math.sqrt(b*b+g*g+c*c),h=1/h;a[0]=b*h;a[1]=g*h;a[2]=c*h;a[3]=d*h}function e(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function f(a,b){var g=b;switch(typeof a){case "number":return r(a,
g);case "string":return l(a,g);case "boolean":return r(a|0,g);case "function":case "undefined":return r(0,g);case "object":if(a){var c=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(c=0;c<a.length;c++)g=r(a[c],g);else if(c)for(c=0;c<a.length;c++)g=f(a[c],g);else for(var d in a)g=f(a[d],g)}else g=r(0,g)}return g}function r(a,b){var g=b;L[0]=a;g=(g<<5)-g+R[0];g&=g;g=(g<<5)-g+R[1];return g&g}function l(a,b){for(var g=b,c=0;c<a.length;c++)g=(g<<5)-g+a.charCodeAt(c),
g&=g;return g}function t(a){return(34*a+1)*a%289}function m(a){return a-Math.floor(a)}function x(a){return u((34*a+5)*a)}function u(a){return a-289*Math.floor(a/289)}function y(a){return a-7*Math.floor(a/7)}function K(a,b,g){a-=b;g-=b;return b+(a-Math.floor(a/g)*g)}function G(a){return K(a,0,2*Math.PI)}function A(a,b){if(a&&b){var g=a instanceof Array,c=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,d=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(g!=b instanceof Array||
c!=d)return!1;if(g){if(a.length!=b.length)return!1;for(g=0;g<a.length;g++)if(!n(a[g],b[g]))return!1}else if(c){if(a.length!=b.length)return!1;for(g=0;g<a.length;g++)if(a[g]!=b[g])return!1}else{for(var h in a)if(!n(a[h],b[h]))return!1;for(h in b)if(!(h in a))return!1}return!0}return!(a||b)}function n(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return A(a,b);default:return!0}}var q=v("__print"),c=v("vec3"),P=v("vec4"),O=v("quat"),
F=v("mat3"),k=v("mat4"),B=0,J={},h=new Float32Array(3),C=new Float32Array(3),I=new Float32Array(4),H=new Float32Array(4),w=new Float32Array(9),g=new Float32Array(16),M=new Float32Array(16),L=new Float64Array(1),R=new Uint32Array(L.buffer),U=new Float32Array([0,0,0]),Z=new Float32Array([0,0,0,1]),X=new Float32Array([0,0,0,1,0,0,0,1]),aa=new Float32Array([1,0,0]),T=new Float32Array([0,1,0]),Y=new Float32Array([0,0,1]),z=new Float32Array([-1,0,0]),ea=new Float32Array([0,-1,0]),la=new Float32Array([0,
0,-1]),ba=Math.floor(44488.07041494893);a.Nz=U;a.Hz=Z;a.WI=X;a.Qe=aa;a.Sa=T;a.rd=Y;a.Tm=z;a.vc=ea;a.Sf=la;a.yv=d;a.HC=function(a,b){var g=a.length,c=new Float32Array(g+b.length);c.set(a);c.set(b,g);return c};a.PG=function(a,b){var g=a.length,c=new Uint32Array(g+b.length);c.set(a);c.set(b,g);return c};a.ZA=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.vA=function(a,b){var g=[],c={},d=b.length,h,w;for(h=0;h<d;h++)c[b[h]]=!0;d=a.length;for(h=0;h<d;h++)w=
a[h],w in c&&g.push(w);return g};a.sign=function(a){return 0<a?1:0>a?-1:0};a.lM=function(a,b,g){for(var c=g.length,d=0;d<c;d++)if(g[d][a]==b)return!0;return!1};a.Rb=function(a,b,g){for(var c=0;c<g.length;c++){var d=g[c];if(d[a]===b)return d}return null};a.kM=function(a,b,g,c,d){for(var h=0;h<d.length;h++){var w=d[h];if(w[a]==b&&w[g]==c)return w}return null};a.Lo=function(a,b,g){for(var c=0;c<a.length;c++)if(a[c][b]==g)return c;return-1};a.oA=function(a,b){for(var g=0;g<a.length;g++)if(a[g]==b)return;
a.push(b)};a.UJ=function(a){for(var b=0;b<a.length-1;b++)for(var g=a[b],c=b+1;c<a.length;c++)if(g==a[c])return!1;return!0};a.HM=function(a,b){for(var g=[],c=0;c<a.length;c++){var d=a[c];d.type==b&&g.push(d)}return g};a.FM=function(a,b){var g=d("name",b,a);1<g.length&&q.error("obj_by_name(): name resolution ambiguity");return g};a.GM=function(a,b){var g=d("name",b,a),c=g.length;1<c&&q.error("obj_by_name(): name resolution ambiguity");if(0>=c)return[];for(var h=[],w=0;w<c;w++){var e=g[w];if("EMPTY"==
e.type&&e.dupli_group)for(var e=e.dupli_group.objects,E=0;E<e.length;E++)h.push(e[E])}return g=g.concat(h)};a.MG=function(a,b,g,c){c||(c=new Float32Array(16));k.identity(c);c[12]=a;c[13]=b;c[14]=g};var fa=1;a.dF=function(){fa=(69069*fa+5)%Math.pow(2,32);return Math.round(fa/65536)%32768/32767};a.wG=function(a){fa=a};a.cd=function(a){var b=a[0]%ba*48271-3399*Math.floor(a[0]/ba);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.wl=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.ef=function(a,
b){var g=Math.cos(a[1]/2),c=Math.cos(a[2]/2),d=Math.cos(a[0]/2),h=Math.sin(a[1]/2),w=Math.sin(a[2]/2),E=Math.sin(a[0]/2);b[0]=h*w*d+g*c*E;b[1]=h*c*d+g*w*E;b[2]=g*w*d-h*c*E;b[3]=g*c*d-h*w*E;return b};a.vC=function(a){var b=F.create(),g=Math.cos(a[0]),c=Math.cos(a[1]),d=Math.cos(a[2]),h=Math.sin(a[0]),w=Math.sin(a[1]);a=Math.sin(a[2]);var E=g*d,N=g*a,e=h*d,k=h*a;b[0]=c*d;b[1]=c*a;b[2]=-w;b[3]=w*e-N;b[4]=w*k+E;b[5]=c*h;b[6]=w*E+k;b[7]=w*N-e;b[8]=c*g;return b};a.Bw=function(a,b){var g=a[0],c=a[1],d=a[2],
h=a[3],w=d*d,E=g*c+d*h;.499999<E?(b[0]=0,b[1]=2*Math.atan2(g,h),b[2]=Math.PI/2):-.499999>E?(b[0]=0,b[1]=-2*Math.atan2(g,h),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*g*h-2*c*d,1-2*g*g-2*w),b[1]=Math.atan2(2*c*h-2*g*d,1-2*c*c-2*w),b[2]=Math.asin(2*g*c+2*d*h));return b};a.qa=function(a,b,g){g||(g=new Float32Array(3));c.transformQuat(b,a,g);return g};a.rK=function(a,b,g){g||(g=new Float32Array(4));a=c.normalize(a,h);var d=c.dot(b,a);a=c.cross(b,a,C);d=Math.acos(d);g[0]=a[0]*Math.sin(d/2);g[1]=a[1]*Math.sin(d/
2);g[2]=a[2]*Math.sin(d/2);g[3]=Math.cos(d/2);return g};a.NG=function(a,b,g,d){d||(d=new Float32Array(4));c.transformQuat(g,b,d);d[3]=-c.dot(a,d)};a.kC=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":h[0]=0;h[1]=-1;h[2]=0;c.transformQuat(h,b,h);C[0]=0;C[1]=0;C[2]=-1;break;case "MESH":h[0]=0;h[1]=0;h[2]=1;c.transformQuat(h,b,h);C[0]=0;C[1]=0;C[2]=1;break;case "EMPTY":h[0]=0,h[1]=1,h[2]=0,c.transformQuat(h,b,h),C[0]=0,C[1]=1,C[2]=0}h[1]=0;c.normalize(h,h);a=c.dot(h,C);return Math.acos(a)*(0<
-h[0]*C[2]?-1:1)};a.As=function(a,b,g,c){if(0!=g){c=c||[];for(var d=0;d<a.length;d++)c[d]=(1-g)*a[d]+g*b[d]}};a.ZN=function(){B++;return B.toString(16)};a.Fm=function(a){J[a]||(J[a]=0);var b=a+J[a];J[a]++;return b};a.hd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.pb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,J:0,fa:null,v:[],G:b,ba:[]}};a.fg=function(a){return JSON.parse(JSON.stringify(a))};
a.dK=function(a,g){var c=[],d;for(d in g){var h=g[d];if(h)for(var w=0;w<h.length;w++)c.push(h[w])}return b(a,c)};a.Ba=function(b){var g=b instanceof Array?[]:{},c;for(c in b)g[c]=b[c]&&"object"==typeof b[c]?b[c]instanceof Float32Array?new Float32Array(b[c]):b[c]instanceof Uint32Array?new Uint32Array(b[c]):b[c]instanceof Uint16Array?new Uint16Array(b[c]):a.Ba(b[c]):b[c];return g};a.Qk=function(a){var b=a instanceof Array?[]:{},g;for(g in a)b[g]=a[g]&&"object"==typeof a[g]?a[g]instanceof Float32Array?
new Float32Array(a[g]):a[g]instanceof Uint32Array?new Uint32Array(a[g]):a[g]instanceof Uint16Array?new Uint16Array(a[g]):a[g]instanceof Array?a[g].slice(0):a[g]:a[g];return b};a.lc=function(a){return"MESH"===a.type?!0:!1};a.zl=function(a){return"EMPTY"===a.type?!0:!1};a.we=function(a){return"ARMATURE"===a.type?!0:!1};a.of=function(a,b){b||(b=new Float32Array(4));F.fromMat4(a,w);var g=w[0],c=w[3],d=w[6],h=w[1],e=w[4],E=w[7],N=w[2],k=w[5],n=w[8],g=Math.sqrt(g*g+c*c+d*d)||1,h=Math.sqrt(h*h+e*e+E*E)||
1,N=Math.sqrt(N*N+k*k+n*n)||1;w[0]/=g;w[3]/=g;w[6]/=g;w[1]/=h;w[4]/=h;w[7]/=h;w[2]/=N;w[5]/=N;w[8]/=N;O.fromMat3(w,b);return b};a.Rh=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.zp=function(a){I[0]=.577350269189626;I[1]=.577350269189626;I[2]=.577350269189626;I[3]=0;P.transformMat4(I,a,I);return P.length(I)};a.Jt=function(a,b){var g=b.left,c=b.right,d=b.top,h=b.bottom,w=b.Wa,E=b.ib;g[0]=a[3]+a[0];g[1]=a[7]+a[4];g[2]=a[11]+a[8];g[3]=a[15]+a[12];c[0]=a[3]-a[0];
c[1]=a[7]-a[4];c[2]=a[11]-a[8];c[3]=a[15]-a[12];d[0]=a[3]-a[1];d[1]=a[7]-a[5];d[2]=a[11]-a[9];d[3]=a[15]-a[13];h[0]=a[3]+a[1];h[1]=a[7]+a[5];h[2]=a[11]+a[9];h[3]=a[15]+a[13];w[0]=a[3]+a[2];w[1]=a[7]+a[6];w[2]=a[11]+a[10];w[3]=a[15]+a[14];E[0]=a[3]-a[2];E[1]=a[7]-a[6];E[2]=a[11]-a[10];E[3]=a[15]-a[14];p(g);p(c);p(d);p(h);p(w);p(E)};a.rG=function(a,b,g){return g<-e(a,b.left)||g<-e(a,b.right)||g<-e(a,b.top)||g<-e(a,b.bottom)||g<-e(a,b.Wa)||g<-e(a,b.ib)?!0:!1};a.sC=function(a,b,g,d,h){w=c.dot(g,b.ib);
k=c.dot(d,b.ib);E=c.dot(h,b.ib);w=Math.sqrt(w*w+k*k+E*E);if(w<-e(a,b.Wa)||w<-e(a,b.ib))return!0;var w=c.dot(g,b.left),k=c.dot(d,b.left),E=c.dot(h,b.left);if(Math.sqrt(w*w+k*k+E*E)<-e(a,b.left))return!0;w=c.dot(g,b.right);k=c.dot(d,b.right);E=c.dot(h,b.right);if(Math.sqrt(w*w+k*k+E*E)<-e(a,b.right))return!0;w=c.dot(g,b.top);k=c.dot(d,b.top);E=c.dot(h,b.top);if(Math.sqrt(w*w+k*k+E*E)<-e(a,b.top))return!0;w=c.dot(g,b.bottom);k=c.dot(d,b.bottom);E=c.dot(h,b.bottom);return Math.sqrt(w*w+k*k+E*E)<-e(a,
b.bottom)?!0:!1};a.tf=function(a,b,g,c){c||(c=0);for(var d=a.length,h=0;h<d;h+=3){var w=a[h],E=a[h+1],N=a[h+2];g[c+h]=b[0]*w+b[4]*E+b[8]*N+b[12];g[c+h+1]=b[1]*w+b[5]*E+b[9]*N+b[13];g[c+h+2]=b[2]*w+b[6]*E+b[10]*N+b[14]}};a.wH=function(a,b,g){for(var c=0,c=0,d=a.length,h=0;h<d;h+=3){var w=a[h],E=a[h+1],N=a[h+2];g[c+h]=b[0]*w+b[4]*E+b[8]*N;g[c+h+1]=b[1]*w+b[5]*E+b[9]*N;g[c+h+2]=b[2]*w+b[6]*E+b[10]*N}};a.JG=function(a,b,g){for(var c=0,c=0,d=a.length,h=0;h<d;h+=4){var w=a[h],E=a[h+1],N=a[h+2];g[c+h]=b[0]*
w+b[4]*E+b[8]*N;g[c+h+1]=b[1]*w+b[5]*E+b[9]*N;g[c+h+2]=b[2]*w+b[6]*E+b[10]*N;g[c+h+3]=a[h+3]}};a.uH=function(a,b,g){g||(g=new Float32Array(3));I[0]=a[0];I[1]=a[1];I[2]=a[2];I[3]=0;P.transformMat4(I,b,I);g[0]=I[0];g[1]=I[1];g[2]=I[2]};a.LK=function(a,b){var g=a.length;if(!g)throw"flatten(): Wrong or empty array";var c=a[0].length;if(!c)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(g*c));for(var d=0;d<g;d++)for(var h=0;h<c;h++)b[d*c+h]=a[d][h];return b};a.vH=function(a){for(var b=
[],g=0;g<a.length;g+=3){var c=new Float32Array([a[g],a[g+1],a[g+2]]);b[g/3]=c}return b};a.Hk=function(b,g,c,d){if(d<c)return c;var h=c+Math.floor((d-c)/2);return b[h]>g?a.Hk(b,g,c,h-1):b[h]<g?a.Hk(b,g,h+1,d):h};a.Ze=function(a,b){for(var g=0;g<a.length;g++)if(a[g]!=b[g])return!1;return!0};a.Rk=function(a,b){for(var g=0;g<a.length;g++)if(1E-7<Math.abs(a[g]-b[g]))return!1;return!0};a.zF=function(a,b,g){g||(g=new Float32Array(16));for(var c=0;12>c;c++)g[c]=a[c]*b;g[12]=a[12];g[13]=a[13];g[14]=a[14];
g[15]=a[15]};a.Pq=function(a,b,c,d){d||(d=new Float32Array(16));b=k.fromRotationTranslation(b,c,g);k.multiply(b,a,d)};a.bk=function(a,b,d,w,e){e||(e=new Float32Array(3));d=k.fromRotationTranslation(d,w,g);1!==b&&(w=k.identity(M),b=c.set(b,b,b,h),k.scale(w,b,w),k.multiply(d,w,d));c.transformMat4(a,d,e);return e};a.Qq=function(a,b,c,d){d||(d=new Float32Array(4));b=k.fromRotationTranslation(b,c,g);P.transformMat4(a,b,d)};a.$L=function(a,b,d,h,w){w||(w=new Float32Array(3));b=k.fromRotationTranslation(d,
h,g);k.invert(b,b);c.transformMat4(a,b,w);return w};a.TN=function(a,b,g){g||(g=new Float32Array(16));k.fromRotationTranslation(b,a,g);a=a[3];for(b=0;12>b;b++)g[b]*=a;return g};a.vM=function(b,g,c){a.Rh(b,g);g[3]=a.zp(b);a.of(b,c)};a.qs=function(a){for(var b=[],g=0;g<a.length;g++)b.push(a[g]);return JSON.stringify(b)};a.vF=function(a,b,g,d){d||(d=new Float32Array(3));c.subtract(b,a,h);c.transformQuat(h,g,h);c.subtract(b,h,d)};a.TC=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),g=
new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),h=new Float32Array(16),w=new Float32Array(16);k.lookAt(a,[-1,0,0],[0,-1,0],b);k.scale(b,[-1,1,1],b);k.scale(b,[-1,1,-1],g);k.lookAt(a,[0,-1,0],[0,0,-1],c);k.scale(c,[1,1,-1],c);k.scale(c,[1,-1,-1],d);k.lookAt(a,[0,0,-1],[0,-1,0],h);k.scale(h,[-1,1,1],h);k.scale(h,[-1,1,-1],w);return[b,g,c,d,h,w]};a.ph=function(a,b){return f(a,b)};a.fv=f;a.TL=l;a.uM=function(a,b,g){var c=b[0],d=b[1];b=b[2];var h,w,E,N,e,k,n,M,f,q,m,p;if(!g||a===g)return a[12]=
a[0]*c+a[4]*d+a[8]*b+a[12],a[13]=a[1]*c+a[5]*d+a[9]*b+a[13],a[14]=a[2]*c+a[6]*d+a[10]*b+a[14],a[15]=a[3]*c+a[7]*d+a[11]*b+a[15],a;h=a[0];w=a[1];E=a[2];N=a[3];e=a[4];k=a[5];n=a[6];M=a[7];f=a[8];q=a[9];m=a[10];p=a[11];g[0]=h;g[1]=w;g[2]=E;g[3]=N;g[4]=e;g[5]=k;g[6]=n;g[7]=M;g[8]=f;g[9]=q;g[10]=m;g[11]=p;g[12]=h*c+e*d+f*b+a[12];g[13]=w*c+k*d+q*b+a[13];g[14]=E*c+n*d+m*b+a[14];g[15]=N*c+M*d+p*b+a[15];return g};a.wE=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=
0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.Aw=function(a,b){b||(b=a);var g=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<g?(b[3]=2*Math.acos(a[3]),g=1/Math.sqrt(g),b[0]=a[0]*g,b[1]=a[1]*g,b[2]=a[2]*g):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.em=function(a){return a*Math.PI/180};a.eC=function(a){return 180*a/Math.PI};a.zq=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],g=Math.floor(a[0]+b),c=
Math.floor(a[1]+b),d=.211324865405187*g+.211324865405187*c,b=a[0]-g+d;a=a[1]-c+d;var h=b>a?1:0,w=1-h,d=b+.211324865405187-h,E=a+.211324865405187-w,N=b+-.577350269189626,e=a+-.577350269189626,g=g%289,c=c%289,k=t(t(c)+g),w=t(t(c+w)+g+h),n=t(t(c+1)+g+1),g=Math.max(.5-(b*b+a*a),0),c=Math.max(.5-(d*d+E*E),0),h=Math.max(.5-(N*N+e*e),0),M=2*m(.024390243902439*k)-1,f=2*m(.024390243902439*w)-1,q=2*m(.024390243902439*n)-1,k=Math.abs(M)-.5,w=Math.abs(f)-.5,n=Math.abs(q)-.5,M=M-Math.floor(M+.5),f=f-Math.floor(f+
.5),q=q-Math.floor(q+.5),g=g*g*g*g*(1.79284291400159-.85373472095314*(M*M+k*k)),c=c*c*c*c*(1.79284291400159-.85373472095314*(f*f+w*w)),h=h*h*h*h*(1.79284291400159-.85373472095314*(q*q+n*n));return 130*(g*(M*b+k*a)+c*(f*d+w*E)+h*(q*N+n*e))};a.Ms=function(a){var b=1/7,g=b/2,c=u(Math.floor(a[0])),d=u(Math.floor(a[1])),h=m(a[0]);a=m(a[1]);var w=h-.5,E=h-1.5,h=a-.5;a-=1.5;var N=x(c),e=x(c+1),k=N,c=e,N=x(N+d),e=x(e+d),k=x(k+d+1),c=x(c+d+1),d=w+.7*(y(N)*b+g),n=E+.7*(y(e)*b+g),w=w+.7*(y(k)*b+g),E=E+.7*(y(c)*
b+g),N=h+.7*(y(Math.floor(N*b))*b+g),h=h+.7*(y(Math.floor(e*b))*b+g),k=a+.7*(y(Math.floor(k*b))*b+g),b=a+.7*(y(Math.floor(c*b))*b+g);return Math.min(d*d+N*N,n*n+h*h,w*w+k*k,E*E+b*b)};a.Xp=function(a,b,g,d,e){e||(e=new Float32Array(4));a=c.transformQuat(b,a,h);b=g[0];var k=g[1];g=g[2];w[0]=k*k+g*g;w[1]=-k*b;w[2]=-g*b;w[3]=-b*k;w[4]=b*b+g*g;w[5]=-g*k;w[6]=-b*g;w[7]=-k*g;w[8]=b*b+k*k;c.transformMat3(a,w,a);c.normalize(a,a);O.rotationTo(d,a,e);return e};a.Gn=function(a,b){b||(b=new Float32Array(4));var g=
I,c=H,g=O.setAxisAngle([0,1,0],Math.PI,O.create()),c=O.setAxisAngle([1,0,0],Math.PI/2,O.create());O.multiply(g,c,g);O.multiply(a,g,b);return b};a.Y=function(){B=0;J={}};a.ua=function(a,b,g){return Math.min(Math.max(a,b),g)};a.Ub=function(a,b,g,c){g=Math.exp(-g/c);return(1-g)*a+g*b};a.ii=function(a,b,g,c,d){d||(d=new Float32Array(a.length));g=Math.exp(-g/c);for(c=0;c<d.length;c++)d[c]=(1-g)*a[c]+g*b[c];return d};a.xx=function(a,b,g,c,d){d||(d=new Float32Array(a.length));O.slerp(a,b,Math.exp(-g/c),
d)};a.aM=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.yg=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.Sn=function(a,b){var g=F.fromQuat(a,w);C[0]=0;C[1]=1;C[2]=0;h[0]=g[3];h[1]=g[4];h[2]=g[5];var d=c.cross(C,h,h);c.normalize(d,d);var e=g[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);C[0]=g[0];C[1]=g[1];C[2]=g[2];c.normalize(C,C);O.rotationTo(C,d,H);O.multiply(H,a,a)};a.fu=function(a,
b,g,c){g=g*b-.5;var d=c*b-.5;c=g-Math.floor(g);var h=d-Math.floor(d);g=Math.floor(g);var d=Math.floor(d),w=b-1,E=a[d*b+g],e=a[d*b+Math.min(g+1,w)],k=a[Math.min(d+1,w)*b+g];a=a[Math.min(d+1,w)*b+Math.min(g+1,w)];return(E*(1-c)+e*c)*(1-h)+(k*(1-c)+a*c)*h};a.Sg=function(a){for(var b=0,g=0;3>g;g++)0<(a&1<<g)&&b++;return b};a.Ow=function(a){for(var b=[0,0,0],g=0;3>g;g++)0<(a&1<<g)&&(b[2-g]=1);return b};a.Tj=function(a,b){var g=0;(1==b||2==b)&&0<(a&4)&&g++;2==b&&0<(a&2)&&g++;return g};a.Yt=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Dd=function(a){var b=0,g;for(g in a)a.hasOwnProperty(g)&&b++;return b};a.Dw=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.sy=function(a,b,g){g||(g=new Float32Array(3));g[0]=a[0]-b[0];g[1]=0;g[2]=a[2]-b[2];c.normalize(g,g)};a.UN=function(a,b,g){var c=a[0],d=a[1];a=a[2];var h=b[0],w=b[1],E=b[2];b=b[3];var e=w*a-E*d,k=E*c-h*a,n=h*d-w*c,M=w*n-E*k,E=E*e-h*n,h=h*k-w*e;g[0]=c+2*e*
b+2*M;g[1]=d+2*k*b+2*E;g[2]=a+2*n*b+2*h;return g};a.pa=function(a){a&&q.error.apply(q,arguments);throw"panic: see above for possible error messages";};a.ge=K;a.wd=G;a.Jo=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Lx=function(a,b){for(var g in a){var c=!0,d=a[g],h=b[g];switch(typeof d){case "number":case "string":case "boolean":c=d==h;break;case "object":c=A(d,h)}if(!c)return!1}return!0};a.cF=function(a,b){var g=a[0],c=a[2],d=a[3];b[0]=a[1];b[1]=c;b[2]=d;b[3]=g};a.Wt=function(a){a+=1;132651<
a&&q.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var g=Math.floor(a/51);return new Float32Array([b/51,g/51,a%51/51])};a.rp=function(a,b,g,c,d){I.set(a);I[3]=b;H.set(c);H[3]=0;a=P.dot(I,H);if(0==a)return null;H.set(g);H[3]=1;a=-P.dot(I,H)/a;d[0]=g[0]+a*c[0];d[1]=g[1]+a*c[1];d[2]=g[2]+a*c[2];return d};a.gK=function(a,b){for(var g=0;g<a.length;g++)b[g]=a[g];return b};a.xF=function(a,b,g){var d=c.dot(a,b);-.9999999>d?(c.cross(aa,a,h),1E-6>c.length(h)&&c.cross(T,a,h),c.normalize(h,
h),O.setAxisAngle(h,Math.PI,g)):(c.cross(a,b,h),g.set(h),g[3]=1+d,O.normalize(g,g));return g};a.Ye=function(a,b,g){if(b==g)return g-a;a=G(a);b=G(b);g=G(g);var c=Math.abs(b-g);if(.001>c||.001>Math.abs(c-2*Math.PI))return 0;b=2*Math.PI-b;g=G(g+b);a=G(a+b);return a>g?(g-=a,a=2*Math.PI-a,-g>a?a:g):0};a.yx=function(a){return a*a*(3-2*a)}};b4w.module.vec3=function(a){var v="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new v(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var d=new v(3);d[0]=a[0];d[1]=a[1];d[2]=a[2];return d};a.fromValues=function(a,d,e){var f=new v(3);f[0]=a;f[1]=d;f[2]=e;return f};a.copy=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];return d};a.set=function(a,d,e,f){f[0]=a;f[1]=d;f[2]=e;return f};a.add=function(a,d,e){e[0]=a[0]+d[0];e[1]=a[1]+d[1];e[2]=a[2]+d[2];return e};
a.subtract=function(a,d,e){e[0]=a[0]-d[0];e[1]=a[1]-d[1];e[2]=a[2]-d[2];return e};a.sub=a.subtract;a.multiply=function(a,d,e){e[0]=a[0]*d[0];e[1]=a[1]*d[1];e[2]=a[2]*d[2];return e};a.mul=a.multiply;a.divide=function(a,d,e){e[0]=a[0]/d[0];e[1]=a[1]/d[1];e[2]=a[2]/d[2];return e};a.div=a.divide;a.min=function(a,d,e){e[0]=Math.min(a[0],d[0]);e[1]=Math.min(a[1],d[1]);e[2]=Math.min(a[2],d[2]);return e};a.max=function(a,d,e){e[0]=Math.max(a[0],d[0]);e[1]=Math.max(a[1],d[1]);e[2]=Math.max(a[2],d[2]);return e};
a.scale=function(a,d,e){e[0]=a[0]*d;e[1]=a[1]*d;e[2]=a[2]*d;return e};a.scaleAndAdd=function(a,d,e,f){f[0]=a[0]+d[0]*e;f[1]=a[1]+d[1]*e;f[2]=a[2]+d[2]*e;return f};a.distance=function(a,d){var e=d[0]-a[0],f=d[1]-a[1],r=d[2]-a[2];return Math.sqrt(e*e+f*f+r*r)};a.dist=a.distance;a.squaredDistance=function(a,d){var e=d[0]-a[0],f=d[1]-a[1],r=d[2]-a[2];return e*e+f*f+r*r};a.sqrDist=a.squaredDistance;a.length=function(a){var d=a[0],e=a[1];a=a[2];return Math.sqrt(d*d+e*e+a*a)};a.len=a.length;a.squaredLength=
function(a){var d=a[0],e=a[1];a=a[2];return d*d+e*e+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,d){d[0]=-a[0];d[1]=-a[1];d[2]=-a[2];return d};a.inverse=function(a,d){d[0]=1/a[0];d[1]=1/a[1];d[2]=1/a[2];return d};a.normalize=function(a,d){var e=a[0],f=a[1],r=a[2],e=e*e+f*f+r*r;0<e&&(e=1/Math.sqrt(e),d[0]=a[0]*e,d[1]=a[1]*e,d[2]=a[2]*e);return d};a.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]};a.cross=function(a,d,e){var f=a[0],r=a[1];a=a[2];var l=d[0],t=d[1];d=d[2];e[0]=r*d-a*t;e[1]=
a*l-f*d;e[2]=f*t-r*l;return e};a.lerp=function(a,d,e,f){var r=a[0],l=a[1];a=a[2];f[0]=r+e*(d[0]-r);f[1]=l+e*(d[1]-l);f[2]=a+e*(d[2]-a);return f};a.random=function(a,p){a=a||1;var e=2*d()*Math.PI,f=2*d()-1,r=Math.sqrt(1-f*f)*a;p[0]=Math.cos(e)*r;p[1]=Math.sin(e)*r;p[2]=f*a;return p};a.transformMat4=function(a,d,e){var f=a[0],r=a[1];a=a[2];var l=d[3]*f+d[7]*r+d[11]*a+d[15],l=l||1;e[0]=(d[0]*f+d[4]*r+d[8]*a+d[12])/l;e[1]=(d[1]*f+d[5]*r+d[9]*a+d[13])/l;e[2]=(d[2]*f+d[6]*r+d[10]*a+d[14])/l;return e};a.transformMat3=
function(a,d,e){var f=a[0],r=a[1];a=a[2];e[0]=f*d[0]+r*d[3]+a*d[6];e[1]=f*d[1]+r*d[4]+a*d[7];e[2]=f*d[2]+r*d[5]+a*d[8];return e};a.transformQuat=function(a,d,e){var f=a[0],r=a[1],l=a[2];a=d[0];var t=d[1],m=d[2];d=d[3];var x=d*f+t*l-m*r,u=d*r+m*f-a*l,y=d*l+a*r-t*f,f=-a*f-t*r-m*l;e[0]=x*d+f*-a+u*-m-y*-t;e[1]=u*d+f*-t+y*-a-x*-m;e[2]=y*d+f*-m+x*-t-u*-a;return e};a.rotateX=function(a,d,e,f){var r=[],l=[];r[0]=a[0]-d[0];r[1]=a[1]-d[1];r[2]=a[2]-d[2];l[0]=r[0];l[1]=r[1]*Math.cos(e)-r[2]*Math.sin(e);l[2]=
r[1]*Math.sin(e)+r[2]*Math.cos(e);f[0]=l[0]+d[0];f[1]=l[1]+d[1];f[2]=l[2]+d[2];return f};a.rotateY=function(a,d,e,f){var r=[],l=[];r[0]=a[0]-d[0];r[1]=a[1]-d[1];r[2]=a[2]-d[2];l[0]=r[2]*Math.sin(e)+r[0]*Math.cos(e);l[1]=r[1];l[2]=r[2]*Math.cos(e)-r[0]*Math.sin(e);f[0]=l[0]+d[0];f[1]=l[1]+d[1];f[2]=l[2]+d[2];return f};a.rotateZ=function(a,d,e,f){var r=[],l=[];r[0]=a[0]-d[0];r[1]=a[1]-d[1];r[2]=a[2]-d[2];l[0]=r[0]*Math.cos(e)-r[1]*Math.sin(e);l[1]=r[0]*Math.sin(e)+r[1]*Math.cos(e);l[2]=r[2];f[0]=l[0]+
d[0];f[1]=l[1]+d[1];f[2]=l[2]+d[2];return f};a.forEach=function(){var b=a.create();return function(a,d,f,r,l,t){d||(d=3);f||(f=0);for(r=r?Math.min(r*d+f,a.length):a.length;f<r;f+=d)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],l(b,t,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2];return a}}();a.aJ=function(b,d){var e=a.fromValues(b[0],b[1],b[2]),f=a.fromValues(d[0],d[1],d[2]);a.normalize(e,e);a.normalize(f,f);e=a.dot(e,f);return 1<e?0:Math.acos(e)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var v="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new v(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var d=new v(4);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];return d};a.fromValues=function(a,d,e,f){var r=new v(4);r[0]=a;r[1]=d;r[2]=e;r[3]=f;return r};a.copy=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];return d};a.set=function(a,d,e,f,r){r[0]=a;r[1]=d;r[2]=e;r[3]=f;return r};a.add=function(a,d,e){e[0]=
a[0]+d[0];e[1]=a[1]+d[1];e[2]=a[2]+d[2];e[3]=a[3]+d[3];return e};a.subtract=function(a,d,e){e[0]=a[0]-d[0];e[1]=a[1]-d[1];e[2]=a[2]-d[2];e[3]=a[3]-d[3];return e};a.sub=a.subtract;a.multiply=function(a,d,e){e[0]=a[0]*d[0];e[1]=a[1]*d[1];e[2]=a[2]*d[2];e[3]=a[3]*d[3];return e};a.mul=a.multiply;a.divide=function(a,d,e){e[0]=a[0]/d[0];e[1]=a[1]/d[1];e[2]=a[2]/d[2];e[3]=a[3]/d[3];return e};a.div=a.divide;a.min=function(a,d,e){e[0]=Math.min(a[0],d[0]);e[1]=Math.min(a[1],d[1]);e[2]=Math.min(a[2],d[2]);e[3]=
Math.min(a[3],d[3]);return e};a.max=function(a,d,e){e[0]=Math.max(a[0],d[0]);e[1]=Math.max(a[1],d[1]);e[2]=Math.max(a[2],d[2]);e[3]=Math.max(a[3],d[3]);return e};a.scale=function(a,d,e){e[0]=a[0]*d;e[1]=a[1]*d;e[2]=a[2]*d;e[3]=a[3]*d;return e};a.scaleAndAdd=function(a,d,e,f){f[0]=a[0]+d[0]*e;f[1]=a[1]+d[1]*e;f[2]=a[2]+d[2]*e;f[3]=a[3]+d[3]*e;return f};a.distance=function(a,d){var e=d[0]-a[0],f=d[1]-a[1],r=d[2]-a[2],l=d[3]-a[3];return Math.sqrt(e*e+f*f+r*r+l*l)};a.dist=a.distance;a.squaredDistance=
function(a,d){var e=d[0]-a[0],f=d[1]-a[1],r=d[2]-a[2],l=d[3]-a[3];return e*e+f*f+r*r+l*l};a.sqrDist=a.squaredDistance;a.length=function(a){var d=a[0],e=a[1],f=a[2];a=a[3];return Math.sqrt(d*d+e*e+f*f+a*a)};a.len=a.length;a.squaredLength=function(a){var d=a[0],e=a[1],f=a[2];a=a[3];return d*d+e*e+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,d){d[0]=-a[0];d[1]=-a[1];d[2]=-a[2];d[3]=-a[3];return d};a.inverse=function(a,d){d[0]=1/a[0];d[1]=1/a[1];d[2]=1/a[2];d[3]=1/a[3];return d};a.normalize=
function(a,d){var e=a[0],f=a[1],r=a[2],l=a[3],e=e*e+f*f+r*r+l*l;0<e&&(e=1/Math.sqrt(e),d[0]=a[0]*e,d[1]=a[1]*e,d[2]=a[2]*e,d[3]=a[3]*e);return d};a.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]+a[3]*d[3]};a.lerp=function(a,d,e,f){var r=a[0],l=a[1],t=a[2];a=a[3];f[0]=r+e*(d[0]-r);f[1]=l+e*(d[1]-l);f[2]=t+e*(d[2]-t);f[3]=a+e*(d[3]-a);return f};a.random=function(b,p){b=b||1;p[0]=d();p[1]=d();p[2]=d();p[3]=d();a.normalize(p,p);a.scale(p,b,p);return p};a.transformMat4=function(a,d,e){var f=a[0],
r=a[1],l=a[2];a=a[3];e[0]=d[0]*f+d[4]*r+d[8]*l+d[12]*a;e[1]=d[1]*f+d[5]*r+d[9]*l+d[13]*a;e[2]=d[2]*f+d[6]*r+d[10]*l+d[14]*a;e[3]=d[3]*f+d[7]*r+d[11]*l+d[15]*a;return e};a.transformQuat=function(a,d,e){var f=a[0],r=a[1],l=a[2],t=d[0],m=d[1],x=d[2];d=d[3];var u=d*f+m*l-x*r,y=d*r+x*f-t*l,K=d*l+t*r-m*f,f=-t*f-m*r-x*l;e[0]=u*d+f*-t+y*-x-K*-m;e[1]=y*d+f*-m+K*-t-u*-x;e[2]=K*d+f*-x+u*-m-y*-t;e[3]=a[3];return e};a.forEach=function(){var b=a.create();return function(a,d,f,r,l,t){d||(d=4);f||(f=0);for(r=r?Math.min(r*
d+f,a.length):a.length;f<r;f+=d)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],b[3]=a[f+3],l(b,t,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2],a[f+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,v){var d=v("vec3"),b=v("vec4"),p=v("mat3"),e="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new e(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=d.create(),e=d.fromValues(1,0,0),l=d.fromValues(0,1,0);return function(t,m,x){var u=d.dot(t,m);if(-.9999999>u)return d.cross(e,t,b),1E-6>d.length(b)&&d.cross(l,t,b),d.normalize(b,b),a.setAxisAngle(b,Math.PI,x),x;if(.9999999<u)return x[0]=0,x[1]=0,x[2]=0,x[3]=1,x;d.cross(t,
m,b);x[0]=b[0];x[1]=b[1];x[2]=b[2];x[3]=1+u;return a.normalize(x,x)}}();a.setAxes=function(){var b=p.create();return function(d,e,t,m){b[0]=e[0];b[3]=e[1];b[6]=e[2];b[1]=t[0];b[4]=t[1];b[7]=t[2];b[2]=-d[0];b[5]=-d[1];b[8]=-d[2];return a.normalize(a.fromMat3(b,m),m)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,d){b*=.5;var e=Math.sin(b);d[0]=e*a[0];d[1]=e*a[1];d[2]=e*a[2];d[3]=Math.cos(b);
return d};a.add=b.add;a.multiply=function(a,b,d){var e=a[0],m=a[1],x=a[2];a=a[3];var u=b[0],y=b[1],p=b[2];b=b[3];d[0]=e*b+a*u+m*p-x*y;d[1]=m*b+a*y+x*u-e*p;d[2]=x*b+a*p+e*y-m*u;d[3]=a*b-e*u-m*y-x*p;return d};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,d){b*=.5;var e=a[0],m=a[1],x=a[2];a=a[3];var u=Math.sin(b);b=Math.cos(b);d[0]=e*b+a*u;d[1]=m*b+x*u;d[2]=x*b-m*u;d[3]=a*b-e*u;return d};a.rotateY=function(a,b,d){b*=.5;var e=a[0],m=a[1],x=a[2];a=a[3];var u=Math.sin(b);b=Math.cos(b);d[0]=e*
b-x*u;d[1]=m*b+a*u;d[2]=x*b+e*u;d[3]=a*b-m*u;return d};a.rotateZ=function(a,b,d){b*=.5;var e=a[0],m=a[1],x=a[2];a=a[3];var u=Math.sin(b);b=Math.cos(b);d[0]=e*b+m*u;d[1]=m*b-e*u;d[2]=x*b+a*u;d[3]=a*b-x*u;return d};a.calculateW=function(a,b){var d=a[0],e=a[1],m=a[2];b[0]=d;b[1]=e;b[2]=m;b[3]=Math.sqrt(Math.abs(1-d*d-e*e-m*m));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,d,e){var m=a[0],x=a[1],u=a[2];a=a[3];var y=b[0],p=b[1],G=b[2];b=b[3];var A,n,q;n=m*y+x*p+u*G+a*b;0>n&&(n=-n,y=-y,p=-p,
G=-G,b=-b);1E-6<1-n?(A=Math.acos(n),q=Math.sin(A),n=Math.sin((1-d)*A)/q,d=Math.sin(d*A)/q):n=1-d;e[0]=n*m+d*y;e[1]=n*x+d*p;e[2]=n*u+d*G;e[3]=n*a+d*b;return e};a.invert=function(a,b){var d=a[0],e=a[1],m=a[2],x=a[3],u=d*d+e*e+m*m+x*x,u=u?1/u:0;b[0]=-d*u;b[1]=-e*u;b[2]=-m*u;b[3]=x*u;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var d=a[0]+a[4]+a[8];if(0<d)d=Math.sqrt(d+1),b[3]=.5*d,d=.5/d,b[0]=(a[5]-a[7])*d,b[1]=(a[6]-a[2])*d,b[2]=(a[1]-a[3])*d;else{var e=0;a[4]>a[0]&&(e=1);a[8]>a[3*e+e]&&(e=2);var m=(e+1)%3,x=(e+2)%3,d=Math.sqrt(a[3*e+e]-a[3*m+m]-a[3*x+x]+1);b[e]=.5*d;d=.5/d;b[3]=(a[3*m+x]-a[3*x+m])*d;b[m]=(a[3*m+e]+a[3*e+m])*d;b[x]=(a[3*x+e]+a[3*e+x])*d}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var v="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new v(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new v(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var p=a[1],e=a[2],f=a[5];b[1]=a[3];b[2]=a[6];b[3]=p;b[5]=a[7];b[6]=e;b[7]=f}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var p=a[0],e=a[1],f=a[2],r=a[3],l=a[4],t=a[5],m=a[6],x=a[7],u=a[8],y=u*l-t*x,K=-u*r+t*m,G=
x*r-l*m,A=p*y+e*K+f*G;if(!A)return null;A=1/A;b[0]=y*A;b[1]=(-u*e+f*x)*A;b[2]=(t*e-f*l)*A;b[3]=K*A;b[4]=(u*p-f*m)*A;b[5]=(-t*p+f*r)*A;b[6]=G*A;b[7]=(-x*p+e*m)*A;b[8]=(l*p-e*r)*A;return b};a.adjoint=function(a,b){var p=a[0],e=a[1],f=a[2],r=a[3],l=a[4],t=a[5],m=a[6],x=a[7],u=a[8];b[0]=l*u-t*x;b[1]=f*x-e*u;b[2]=e*t-f*l;b[3]=t*m-r*u;b[4]=p*u-f*m;b[5]=f*r-p*t;b[6]=r*x-l*m;b[7]=e*m-p*x;b[8]=p*l-e*r;return b};a.determinant=function(a){var b=a[3],p=a[4],e=a[5],f=a[6],r=a[7],l=a[8];return a[0]*(l*p-e*r)+a[1]*
(-l*b+e*f)+a[2]*(r*b-p*f)};a.multiply=function(a,b,p){var e=a[0],f=a[1],r=a[2],l=a[3],t=a[4],m=a[5],x=a[6],u=a[7];a=a[8];var y=b[0],K=b[1],G=b[2],A=b[3],n=b[4],q=b[5],c=b[6],P=b[7];b=b[8];p[0]=y*e+K*l+G*x;p[1]=y*f+K*t+G*u;p[2]=y*r+K*m+G*a;p[3]=A*e+n*l+q*x;p[4]=A*f+n*t+q*u;p[5]=A*r+n*m+q*a;p[6]=c*e+P*l+b*x;p[7]=c*f+P*t+b*u;p[8]=c*r+P*m+b*a;return p};a.mul=a.multiply;a.translate=function(a,b,p){var e=a[0],f=a[1],r=a[2],l=a[3],t=a[4],m=a[5],x=a[6],u=a[7];a=a[8];var y=b[0];b=b[1];p[0]=e;p[1]=f;p[2]=r;
p[3]=l;p[4]=t;p[5]=m;p[6]=y*e+b*l+x;p[7]=y*f+b*t+u;p[8]=y*r+b*m+a;return p};a.rotate=function(a,b,p){var e=a[0],f=a[1],r=a[2],l=a[3],t=a[4],m=a[5],x=a[6],u=a[7];a=a[8];var y=Math.sin(b);b=Math.cos(b);p[0]=b*e+y*l;p[1]=b*f+y*t;p[2]=b*r+y*m;p[3]=b*l-y*e;p[4]=b*t-y*f;p[5]=b*m-y*r;p[6]=x;p[7]=u;p[8]=a;return p};a.scale=function(a,b,p){var e=b[0];b=b[1];p[0]=e*a[0];p[1]=e*a[1];p[2]=e*a[2];p[3]=b*a[3];p[4]=b*a[4];p[5]=b*a[5];p[6]=a[6];p[7]=a[7];p[8]=a[8];return p};a.NC=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.LC=function(a,b){var p=Math.sin(a),e=Math.cos(a);b[0]=e;b[1]=p;b[2]=0;b[3]=-p;b[4]=e;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.MC=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var p=a[0],e=a[1],f=a[2],r=a[3],l=p+p,t=e+e,m=f+f,p=p*l,x=e*l,e=e*t,u=f*l,y=
f*t,f=f*m,l=r*l,t=r*t,r=r*m;b[0]=1-e-f;b[3]=x-r;b[6]=u+t;b[1]=x+r;b[4]=1-p-f;b[7]=y-l;b[2]=u-t;b[5]=y+l;b[8]=1-p-e;return b};a.normalFromMat4=function(a,b){var p=a[0],e=a[1],f=a[2],r=a[3],l=a[4],t=a[5],m=a[6],x=a[7],u=a[8],y=a[9],K=a[10],G=a[11],A=a[12],n=a[13],q=a[14],c=a[15],P=p*t-e*l,O=p*m-f*l,F=p*x-r*l,k=e*m-f*t,B=e*x-r*t,J=f*x-r*m,h=u*n-y*A,C=u*q-K*A,u=u*c-G*A,I=y*q-K*n,y=y*c-G*n,K=K*c-G*q,G=P*K-O*y+F*I+k*u-B*C+J*h;if(!G)return null;G=1/G;b[0]=(t*K-m*y+x*I)*G;b[1]=(m*u-l*K-x*C)*G;b[2]=(l*y-t*
u+x*h)*G;b[3]=(f*y-e*K-r*I)*G;b[4]=(p*K-f*u+r*C)*G;b[5]=(e*u-p*y-r*h)*G;b[6]=(n*J-q*B+c*k)*G;b[7]=(q*F-A*J-c*O)*G;b[8]=(A*B-n*F+c*P)*G;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.KC=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var v="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new v(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new v(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var p=a[1],e=a[2],f=a[3],r=a[6],l=a[7],t=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=p;b[6]=a[9];b[7]=a[13];b[8]=e;b[9]=r;b[11]=a[14];b[12]=f;b[13]=l;
b[14]=t}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var p=a[0],e=a[1],f=a[2],r=a[3],l=a[4],t=a[5],m=a[6],x=a[7],u=a[8],y=a[9],K=a[10],G=a[11],A=a[12],n=a[13],q=a[14],c=a[15],P=p*t-e*l,O=p*m-f*l,F=p*x-r*l,k=e*m-f*t,B=e*x-r*t,J=f*x-r*m,h=u*n-y*A,C=u*q-K*A,I=u*c-G*A,H=y*q-K*n,w=y*c-G*n,g=K*c-G*q,M=P*g-O*w+F*H+k*I-B*C+J*h;if(!M)return null;
M=1/M;b[0]=(t*g-m*w+x*H)*M;b[1]=(f*w-e*g-r*H)*M;b[2]=(n*J-q*B+c*k)*M;b[3]=(K*B-y*J-G*k)*M;b[4]=(m*I-l*g-x*C)*M;b[5]=(p*g-f*I+r*C)*M;b[6]=(q*F-A*J-c*O)*M;b[7]=(u*J-K*F+G*O)*M;b[8]=(l*w-t*I+x*h)*M;b[9]=(e*I-p*w-r*h)*M;b[10]=(A*B-n*F+c*P)*M;b[11]=(y*F-u*B-G*P)*M;b[12]=(t*C-l*H-m*h)*M;b[13]=(p*H-e*C+f*h)*M;b[14]=(n*O-A*k-q*P)*M;b[15]=(u*k-y*O+K*P)*M;return b};a.adjoint=function(a,b){var p=a[0],e=a[1],f=a[2],r=a[3],l=a[4],t=a[5],m=a[6],x=a[7],u=a[8],y=a[9],K=a[10],G=a[11],A=a[12],n=a[13],q=a[14],c=a[15];
b[0]=t*(K*c-G*q)-y*(m*c-x*q)+n*(m*G-x*K);b[1]=-(e*(K*c-G*q)-y*(f*c-r*q)+n*(f*G-r*K));b[2]=e*(m*c-x*q)-t*(f*c-r*q)+n*(f*x-r*m);b[3]=-(e*(m*G-x*K)-t*(f*G-r*K)+y*(f*x-r*m));b[4]=-(l*(K*c-G*q)-u*(m*c-x*q)+A*(m*G-x*K));b[5]=p*(K*c-G*q)-u*(f*c-r*q)+A*(f*G-r*K);b[6]=-(p*(m*c-x*q)-l*(f*c-r*q)+A*(f*x-r*m));b[7]=p*(m*G-x*K)-l*(f*G-r*K)+u*(f*x-r*m);b[8]=l*(y*c-G*n)-u*(t*c-x*n)+A*(t*G-x*y);b[9]=-(p*(y*c-G*n)-u*(e*c-r*n)+A*(e*G-r*y));b[10]=p*(t*c-x*n)-l*(e*c-r*n)+A*(e*x-r*t);b[11]=-(p*(t*G-x*y)-l*(e*G-r*y)+u*
(e*x-r*t));b[12]=-(l*(y*q-K*n)-u*(t*q-m*n)+A*(t*K-m*y));b[13]=p*(y*q-K*n)-u*(e*q-f*n)+A*(e*K-f*y);b[14]=-(p*(t*q-m*n)-l*(e*q-f*n)+A*(e*m-f*t));b[15]=p*(t*K-m*y)-l*(e*K-f*y)+u*(e*m-f*t);return b};a.determinant=function(a){var b=a[0],p=a[1],e=a[2],f=a[3],r=a[4],l=a[5],t=a[6],m=a[7],x=a[8],u=a[9],y=a[10],K=a[11],G=a[12],A=a[13],n=a[14];a=a[15];return(b*l-p*r)*(y*a-K*n)-(b*t-e*r)*(u*a-K*A)+(b*m-f*r)*(u*n-y*A)+(p*t-e*l)*(x*a-K*G)-(p*m-f*l)*(x*n-y*G)+(e*m-f*t)*(x*A-u*G)};a.multiply=function(a,b,p){var e=
a[0],f=a[1],r=a[2],l=a[3],t=a[4],m=a[5],x=a[6],u=a[7],y=a[8],K=a[9],G=a[10],A=a[11],n=a[12],q=a[13],c=a[14];a=a[15];var P=b[0],O=b[1],F=b[2],k=b[3];p[0]=P*e+O*t+F*y+k*n;p[1]=P*f+O*m+F*K+k*q;p[2]=P*r+O*x+F*G+k*c;p[3]=P*l+O*u+F*A+k*a;P=b[4];O=b[5];F=b[6];k=b[7];p[4]=P*e+O*t+F*y+k*n;p[5]=P*f+O*m+F*K+k*q;p[6]=P*r+O*x+F*G+k*c;p[7]=P*l+O*u+F*A+k*a;P=b[8];O=b[9];F=b[10];k=b[11];p[8]=P*e+O*t+F*y+k*n;p[9]=P*f+O*m+F*K+k*q;p[10]=P*r+O*x+F*G+k*c;p[11]=P*l+O*u+F*A+k*a;P=b[12];O=b[13];F=b[14];k=b[15];p[12]=P*e+
O*t+F*y+k*n;p[13]=P*f+O*m+F*K+k*q;p[14]=P*r+O*x+F*G+k*c;p[15]=P*l+O*u+F*A+k*a;return p};a.mul=a.multiply;a.translate=function(a,b,p){var e=b[0],f=b[1];b=b[2];var r,l,t,m,x,u,y,K,G,A,n,q;a===p?(p[12]=a[0]*e+a[4]*f+a[8]*b+a[12],p[13]=a[1]*e+a[5]*f+a[9]*b+a[13],p[14]=a[2]*e+a[6]*f+a[10]*b+a[14],p[15]=a[3]*e+a[7]*f+a[11]*b+a[15]):(r=a[0],l=a[1],t=a[2],m=a[3],x=a[4],u=a[5],y=a[6],K=a[7],G=a[8],A=a[9],n=a[10],q=a[11],p[0]=r,p[1]=l,p[2]=t,p[3]=m,p[4]=x,p[5]=u,p[6]=y,p[7]=K,p[8]=G,p[9]=A,p[10]=n,p[11]=q,
p[12]=r*e+x*f+G*b+a[12],p[13]=l*e+u*f+A*b+a[13],p[14]=t*e+y*f+n*b+a[14],p[15]=m*e+K*f+q*b+a[15]);return p};a.scale=function(a,b,p){var e=b[0],f=b[1];b=b[2];p[0]=a[0]*e;p[1]=a[1]*e;p[2]=a[2]*e;p[3]=a[3]*e;p[4]=a[4]*f;p[5]=a[5]*f;p[6]=a[6]*f;p[7]=a[7]*f;p[8]=a[8]*b;p[9]=a[9]*b;p[10]=a[10]*b;p[11]=a[11]*b;p[12]=a[12];p[13]=a[13];p[14]=a[14];p[15]=a[15];return p};a.rotate=function(a,b,p,e){var f=p[0],r=p[1];p=p[2];var l=Math.sqrt(f*f+r*r+p*p),t,m,x,u,y,K,G,A,n,q,c,P,O,F,k,B,J,h,C,I;if(1E-7>Math.abs(l))return null;
l=1/l;f*=l;r*=l;p*=l;t=Math.sin(b);m=Math.cos(b);x=1-m;b=a[0];l=a[1];u=a[2];y=a[3];K=a[4];G=a[5];A=a[6];n=a[7];q=a[8];c=a[9];P=a[10];O=a[11];F=f*f*x+m;k=r*f*x+p*t;B=p*f*x-r*t;J=f*r*x-p*t;h=r*r*x+m;C=p*r*x+f*t;I=f*p*x+r*t;f=r*p*x-f*t;r=p*p*x+m;e[0]=b*F+K*k+q*B;e[1]=l*F+G*k+c*B;e[2]=u*F+A*k+P*B;e[3]=y*F+n*k+O*B;e[4]=b*J+K*h+q*C;e[5]=l*J+G*h+c*C;e[6]=u*J+A*h+P*C;e[7]=y*J+n*h+O*C;e[8]=b*I+K*f+q*r;e[9]=l*I+G*f+c*r;e[10]=u*I+A*f+P*r;e[11]=y*I+n*f+O*r;a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);
return e};a.rotateX=function(a,b,p){var e=Math.sin(b);b=Math.cos(b);var f=a[4],r=a[5],l=a[6],t=a[7],m=a[8],x=a[9],u=a[10],y=a[11];a!==p&&(p[0]=a[0],p[1]=a[1],p[2]=a[2],p[3]=a[3],p[12]=a[12],p[13]=a[13],p[14]=a[14],p[15]=a[15]);p[4]=f*b+m*e;p[5]=r*b+x*e;p[6]=l*b+u*e;p[7]=t*b+y*e;p[8]=m*b-f*e;p[9]=x*b-r*e;p[10]=u*b-l*e;p[11]=y*b-t*e;return p};a.rotateY=function(a,b,p){var e=Math.sin(b);b=Math.cos(b);var f=a[0],r=a[1],l=a[2],t=a[3],m=a[8],x=a[9],u=a[10],y=a[11];a!==p&&(p[4]=a[4],p[5]=a[5],p[6]=a[6],
p[7]=a[7],p[12]=a[12],p[13]=a[13],p[14]=a[14],p[15]=a[15]);p[0]=f*b-m*e;p[1]=r*b-x*e;p[2]=l*b-u*e;p[3]=t*b-y*e;p[8]=f*e+m*b;p[9]=r*e+x*b;p[10]=l*e+u*b;p[11]=t*e+y*b;return p};a.rotateZ=function(a,b,p){var e=Math.sin(b);b=Math.cos(b);var f=a[0],r=a[1],l=a[2],t=a[3],m=a[4],x=a[5],u=a[6],y=a[7];a!==p&&(p[8]=a[8],p[9]=a[9],p[10]=a[10],p[11]=a[11],p[12]=a[12],p[13]=a[13],p[14]=a[14],p[15]=a[15]);p[0]=f*b+m*e;p[1]=r*b+x*e;p[2]=l*b+u*e;p[3]=t*b+y*e;p[4]=m*b-f*e;p[5]=x*b-r*e;p[6]=u*b-l*e;p[7]=y*b-t*e;return p};
a.NC=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.MC=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.LC=function(a,b,p){var e=b[0],f=b[1];b=b[2];var r=Math.sqrt(e*e+f*f+b*b),l;if(1E-7>Math.abs(r))return null;r=1/r;e*=r;f*=r;b*=r;r=Math.sin(a);a=Math.cos(a);l=1-a;p[0]=e*e*l+a;p[1]=f*e*l+b*
r;p[2]=b*e*l-f*r;p[3]=0;p[4]=e*f*l-b*r;p[5]=f*f*l+a;p[6]=b*f*l+e*r;p[7]=0;p[8]=e*b*l+f*r;p[9]=f*b*l-e*r;p[10]=b*b*l+a;p[11]=0;p[12]=0;p[13]=0;p[14]=0;p[15]=1;return p};a.NK=function(a,b){var p=Math.sin(a),e=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=e;b[6]=p;b[7]=0;b[8]=0;b[9]=-p;b[10]=e;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.OK=function(a,b){var p=Math.sin(a),e=Math.cos(a);b[0]=e;b[1]=0;b[2]=-p;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=p;b[9]=0;b[10]=e;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.PK=function(a,b){var p=Math.sin(a),e=Math.cos(a);b[0]=e;b[1]=p;b[2]=0;b[3]=0;b[4]=-p;b[5]=e;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,p){var e=a[0],f=a[1],r=a[2],l=a[3],t=e+e,m=f+f,x=r+r;a=e*t;var u=e*m,e=e*x,y=f*m,f=f*x,r=r*x,t=l*t,m=l*m,l=l*x;p[0]=1-(y+r);p[1]=u+l;p[2]=e-m;p[3]=0;p[4]=u-l;p[5]=1-(a+r);p[6]=f+t;p[7]=0;p[8]=e+m;p[9]=f-t;p[10]=1-(a+y);p[11]=0;p[12]=b[0];p[13]=b[1];p[14]=b[2];
p[15]=1;return p};a.fromQuat=function(a,b){var p=a[0],e=a[1],f=a[2],r=a[3],l=p+p,t=e+e,m=f+f,p=p*l,x=e*l,e=e*t,u=f*l,y=f*t,f=f*m,l=r*l,t=r*t,r=r*m;b[0]=1-e-f;b[1]=x+r;b[2]=u-t;b[3]=0;b[4]=x-r;b[5]=1-p-f;b[6]=y+l;b[7]=0;b[8]=u+t;b[9]=y-l;b[10]=1-p-e;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,p,e,f,r,l){var t=1/(b-a),m=1/(e-p),x=1/(f-r);l[0]=2*f*t;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=2*f*m;l[6]=0;l[7]=0;l[8]=(b+a)*t;l[9]=(e+p)*m;l[10]=(r+f)*x;l[11]=-1;l[12]=0;l[13]=0;l[14]=
r*f*2*x;l[15]=0;return l};a.perspective=function(a,b,p,e,f){a=1/Math.tan(a/2);var r=1/(p-e);f[0]=a/b;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(e+p)*r;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*e*p*r;f[15]=0;return f};a.KM=function(a,b,p,e){var f=Math.tan(a.$N*Math.PI/180),r=Math.tan(a.vK*Math.PI/180),l=Math.tan(a.nM*Math.PI/180);a=Math.tan(a.VM*Math.PI/180);var t=2/(l+a),m=2/(f+r);e[0]=t;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=m;e[6]=0;e[7]=0;e[8]=-((l-a)*t*.5);e[9]=(f-r)*m*.5;e[10]=p/
(b-p);e[11]=-1;e[12]=0;e[13]=0;e[14]=p*b/(b-p);e[15]=0;return e};a.ortho=function(a,b,p,e,f,r,l){var t=1/(a-b),m=1/(p-e),x=1/(f-r);l[0]=-2*t;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=-2*m;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=2*x;l[11]=0;l[12]=(a+b)*t;l[13]=(e+p)*m;l[14]=(r+f)*x;l[15]=1;return l};a.lookAt=function(d,b,p,e){var f,r,l,t,m,x,u,y,K=d[0],G=d[1];d=d[2];l=p[0];t=p[1];r=p[2];u=b[0];p=b[1];f=b[2];if(1E-7>Math.abs(K-u)&&1E-7>Math.abs(G-p)&&1E-7>Math.abs(d-f))return a.identity(e);b=K-u;p=G-p;u=d-f;y=1/Math.sqrt(b*
b+p*p+u*u);b*=y;p*=y;u*=y;f=t*u-r*p;r=r*b-l*u;l=l*p-t*b;(y=Math.sqrt(f*f+r*r+l*l))?(y=1/y,f*=y,r*=y,l*=y):l=r=f=0;t=p*l-u*r;m=u*f-b*l;x=b*r-p*f;(y=Math.sqrt(t*t+m*m+x*x))?(y=1/y,t*=y,m*=y,x*=y):x=m=t=0;e[0]=f;e[1]=t;e[2]=b;e[3]=0;e[4]=r;e[5]=m;e[6]=p;e[7]=0;e[8]=l;e[9]=x;e[10]=u;e[11]=0;e[12]=-(f*K+r*G+l*d);e[13]=-(t*K+m*G+x*d);e[14]=-(b*K+p*G+u*d);e[15]=1;return e};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.KC=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__particles=function(a,v){function d(){throw"_rand() undefined";}function b(a,b,d,e,q,c,m){var f=a.T.jo,x=a.T.Bd,k=a.T.time;a=a.T.sw;for(var l=b?4:1,J=0;J<f.length;J+=l){var h=f[J];if(h>a&&h<=k)for(h=0;8>h;h++)x[8*J+h]=q[h];for(h=0;8>h;h++)u[h]=x[8*J+h];h=y;h[0]=d[3*J];h[1]=d[3*J+1];h[2]=d[3*J+2];t.bk(h,u,h);c[3*J]=h[0];c[3*J+1]=h[1];c[3*J+2]=h[2];var C=y;C[0]=e[3*J];C[1]=e[3*J+1];C[2]=e[3*J+2];t.ak(C,u,C);m[3*J]=C[0];m[3*J+1]=C[1];m[3*J+2]=C[2];if(b)for(h=1;4>h;h++)c[3*(J+h)]=c[3*J],c[3*
(J+h)+1]=c[3*J+1],c[3*(J+h)+2]=c[3*J+2],m[3*(J+h)]=C[0],m[3*(J+h)+1]=C[1],m[3*(J+h)+2]=C[2]}}function p(a){a?(l.wG(a),d=function(){return l.dF()}):d=function(){return Math.random()}}var e=v("__config"),f=v("__geometry"),r=v("__scenes"),l=v("__util"),t=v("__tsr"),m=v("vec3"),x=e.he,u=new Float32Array(8),y=new Float32Array(3);a.Yo=function(a){return 0<a.particle_systems.length?!0:!1};a.Vo=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.PL=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.TD=function(a){for(var b=0;b<a.particle_systems.length;b++){var d=a.particle_systems[b].settings;if("HAIR"==d.type&&d.b4w_dynamic_grass)return!0}return!1};a.UC=function(a,e,t,n){t.T=t.T||{};var q=f.DC(e),c=t.settings.count,y=t.settings.frame_start/x.Ma,u=t.settings.frame_end/x.Ma,r=t.settings.lifetime/x.Ma,k=t.settings.lifetime_random,B=t.settings.emit_from,J=
t.settings.factor_random,h=t.settings.angular_velocity_mode,C=t.settings.angular_velocity_factor,I=t.settings.b4w_randomize_emission,H=t.settings.b4w_cyclic;p(t.seed);var w=t.T.rH="WORLD"==t.settings.b4w_coordinate_system?!0:!1;t.T.frame=0;if(e=!a.sg){var g;g=[];for(var M=0;M<c;M++)g.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);g=new Float32Array(g);for(var M=[],L=0;L<c;L++)M.push(4*L,4*L+2,4*L+1,4*L,4*L+3,4*L+2);M=new Uint16Array(M)}switch(B){case "VERT":for(var L=q.v[0].a_position,q=q.v[0].a_normal,R=L.length/
3,B=[],U=0;U<c;U++){var v=Math.round((R-1)*d());B.push(v);e&&(B.push(v),B.push(v),B.push(v))}R=[];for(U=0;U<B.length;U++)R.push(L[3*B[U]]),R.push(L[3*B[U]+1]),R.push(L[3*B[U]+2]);L=new Float32Array(R);R=[];for(U=0;U<B.length;U++)R.push(q[3*B[U]]),R.push(q[3*B[U]+1]),R.push(q[3*B[U]+2]);B=new Float32Array(R);break;case "FACE":L=[];B=[];U=[];l.wl(0,U);R=f.Fo(q,c,!1,U);l.wl(0,U);q=f.Fo(q,c,!0,U);for(U=0;U<R.length;U++)L.push(R[U][0],R[U][1],R[U][2]),e&&(L.push(R[U][0],R[U][1],R[U][2]),L.push(R[U][0],
R[U][1],R[U][2]),L.push(R[U][0],R[U][1],R[U][2])),B.push(q[U][0],q[U][1],q[U][2]),e&&(B.push(q[U][0],q[U][1],q[U][2]),B.push(q[U][0],q[U][1],q[U][2]),B.push(q[U][0],q[U][1],q[U][2]));L=new Float32Array(L);B=new Float32Array(B);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}B=[L,B];q=B[0];B=B[1];t.T.Ij=new Float32Array(q);t.T.KE=new Float32Array(B);t.T.WE=new Float32Array(q.length);t.T.LE=new Float32Array(B.length);t.T.time=0;t.T.sw=
-1;L=[];u=(u-y)/c;for(R=0;R<c;R++)U=I?u*R+10*u*(.5-d()):u*R,H||(U+=y),L.push(U),e&&(L.push(U),L.push(U),L.push(U));y=new Float32Array(L);t.T.jo=new Float32Array(y);t.T.wt=new Float32Array(y);t.T.Bd=new Float32Array(8*y.length);for(I=0;I<8*y.length;I++)for(H=0;8>H;H++)t.T.Bd[8*I+H]=n[H];w&&b(t,e,q,B,n,q,B);t=[];n=r*k;for(k=0;k<c;k++)w=n*d(),t.push(r-w),e&&(t.push(r-w),t.push(r-w),t.push(r-w));r=new Float32Array(t);t=[];for(n=0;n<c;n++){k=[d()-.5,d()-.5,d()-.5];m.normalize(k,k);t.push(J*k[0]);t.push(J*
k[1]);t.push(J*k[2]);switch(h){case "NONE":t.push(0);break;case "SPIN":case "VELOCITY":t.push(C);break;case "RAND":t.push(2*C*(d()-.5));break;default:throw"Undefined velocity factor";}if(e)for(k=t.slice(-4),w=0;12>w;w++)t.push(k[w%4])}c=new Float32Array(t);J=l.pb("EMITTER_PARTICLES");h=l.hd();h.a_position=q;h.a_normal=B;J.v[0]=h;e?(a.cf=f.pk,J.fa=M):(a.cf=f.rr,J.fa=new Uint16Array(0));J.J=q.length/3;J.G.a_p_delay=y;J.G.a_p_lifetime=r;J.G.a_p_vels=c;e&&(J.G.a_p_bb_vertex=g);return J};a.YG=function(a){for(var d=
a.n,e=0;e<d.length;e++){var n=d[e],q=d[e].Hc;if(q){var c=n.da;if(!q.T.rH)break;var m=q.T.WE,t=q.T.LE;b(q,!n.sg,q.T.Ij,q.T.KE,a.d.Fb,m,t);f.uE(c);f.Vq(c,"a_position",3,m);f.Vq(c,"a_normal",3,t)}}};a.KF=function(a,b,d){var e=b.settings.lifetime/x.Ma,q=b.settings.normal_factor,c=9.81*b.settings.effector_weights.gravity,m=b.settings.effector_weights.wind,f=b.settings.mass,t=b.settings.b4w_fade_in/x.Ma,k=b.settings.b4w_fade_out/x.Ma,y=b.settings.b4w_cyclic;a.gw=b.settings.frame_end/x.Ma-b.settings.frame_start/
x.Ma;a.cw=y?1:0;a.Np=q;a.fw=c;q=r.OD();a.Vl[0]=q[0]*m;a.Vl[1]=q[1]*m;a.Vl[2]=q[2]*m;a.iw=e;a.hw=f;a.dw=t;a.ew=k;a.sg?(e=d.halo.size,m=d.halo.hardness,30>m?(m=.5,f=.9):40>m?(m=.1,f=1):50>m?(m=0,f=.8):(m=0,f=.5)):(e=b.settings.particle_size,f=m=1);a.Op=e;a.$v=m;a.Zv=f;e=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(e[0]&&e[0].use_map_size&&e[0].texture&&"BLEND"==e[0].texture.type&&e[0].texture.use_color_ramp){e=e[0].texture.color_ramp.elements;m=Math.min(2*e.length,b.length);for(f=0;f<m;f+=2)t=
e[f/2],b[f]=t.position,b[f+1]=(t.color[0]+t.color[1]+t.color[2])/3;a.kw=e.length}a.jw.set(b);b=d.texture_slots;d=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){e=b[0].texture.color_ramp.elements;m=Math.min(4*e.length,d.length);for(f=0;f<m;f+=4)t=e[f/4],d[f]=t.position,d[f+1]=t.color[0],d[f+2]=t.color[1],d[f+3]=t.color[2];a.bw=e.length}a.aw.set(d)};a.VF=function(a,b){a.T.sw=a.T.time;a.T.time=b};a.YE=
function(a){for(var b=a.J,d=a.v[0].a_position,e=a.G.a_texcoord,m=[],c=[],f=0;f<b;f++)c.push(d[3*f]),c.push(d[3*f+1]),m.push(d[3*f+2]);m=new Float32Array(m);c=new Float32Array(c);a.G.a_lf_dist=m;a.G.a_lf_bb_vertex=c;a.G.a_texcoord=e;return a};a.DN=function(a,b,d){a=a.n;for(var e=0;e<a.length;e++){var m=a[e],c=m.Hc;c&&c.name==b&&(m.Op=d)}};a.sN=function(a,b,d){a=a.n;for(var e=0;e<a.length;e++){var m=a[e],c=m.Hc;c&&c.name==b&&(m.Np=d)}};a.fN=function(a,b,d){a=a.n;for(var e=0;e<a.length;e++){var m=a[e],
c=m.Hc;if(c&&c.name==b){var t=c.T.jo;if(1==d)c=t;else if(0==d)for(var x=!m.sg,y=x?4:1,c=c.T.wt,k=0;k<c.length;k+=y)c[k]=1E4,x&&(c[k+1]=c[k],c[k+2]=c[k],c[k+3]=c[k]);else for(var l=1/d,c=c.T.wt,y=(x=!m.sg)?4:1,u=0,k=0;k<c.length;k+=y)k>=u?(c[k]=t[k],u+=l):c[k]=1E4,x&&(c[k+1]=c[k],c[k+2]=c[k],c[k+3]=c[k]);f.Vq(m.da,"a_p_delay",1,c)}}};a.iH=function(a,b,d){a=a.particle_systems;for(var e=0;e<a.length;e++){var m=a[e];if("EMITTER"==m.settings.type)for(var c=m.T.jo,e=0;e<8*c.length;e++)m.T.Bd[8*e]=b[0],
m.T.Bd[8*e+1]=b[1],m.T.Bd[8*e+2]=b[2],m.T.Bd[8*e+3]=b[3],m.T.Bd[8*e+4]=d[0],m.T.Bd[8*e+5]=d[1],m.T.Bd[8*e+6]=d[2],m.T.Bd[8*e+7]=d[3]}}};b4w.module.__geometry=function(a,v){function d(a){return 65536<a.J?B.nu()?!1:!0:!1}function b(a){return 0<a.fa.length?!0:!1}function p(a,g,c){if(!b(a))return a;c||O.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.J*(g||1)+", will use drawArrays","color: #aa0");g=a.fa;c=a.J;var h=a.G,d=a.v,k;for(k in h){var m=h[k],n=K(m,c);h[k]=e(g,m,n)}for(h=0;h<d.length;h++){var q=d[h];for(k in q)m=q[k],n=K(m,c),q[k]=e(g,m,n)}for(h=0;h<a.ba.length;h++){k=a.ba[h].$b;for(var C in k)m=k[C],
n=K(m,c),k[C]=e(g,m,n)}a.J=g.length;a.fa=new Uint16Array(0);return a}function e(a,b,c){if(0==b.length)return new Float32Array(0);for(var h=new Float32Array(a.length*c),d=0;d<a.length;d++)for(var e=a[d],k=0;k<c;k++)h[c*d+k]=b[c*e+k];return h}function f(a,b){var c=a.Me,h=a.ai[b];if(h)return c.subarray(h.offset,h.offset+h.length);throw"extract_array() failed; invalid name: "+b;}function r(b,g){var c,h;switch(g){case a.Gi:case a.qk:c=H.TRIANGLES;h=H.STATIC_DRAW;break;case a.sr:c=H.POINTS;h=H.STATIC_DRAW;
break;case a.pk:c=H.TRIANGLES;h=H.DYNAMIC_DRAW;break;case a.rr:c=H.POINTS;h=H.DYNAMIC_DRAW;break;case a.wy:c=H.LINES;h=H.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=c;b.fk=h}function l(a){a.tg?(a.ve||(a.ve=H.createBuffer()),H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.ve),H.bufferData(H.ELEMENT_ARRAY_BUFFER,a.tg,a.fk),a.al=a.tg.byteLength):a.al=0;a.Lf||(a.Lf=H.createBuffer());H.bindBuffer(H.ARRAY_BUFFER,a.Lf);H.bufferData(H.ARRAY_BUFFER,a.Me,a.fk);a.vt=a.Me.byteLength}function t(a){for(var b=
k.pb("JOIN_"+a.length+"_SUBMESHES"),c=0,h=0;h<a.length;h++)c+=a[h].fa.length;b.fa=new Uint32Array(c);var d=c=0,e=0;if(0<a[0].ba.length)for(var m=0;m<a[0].ba.length;m++){for(h=0;h<a.length;h++)c+=a[h].ba[m].$b.a_position.length,d+=a[h].ba[m].$b.a_normal.length,e+=a[h].ba[m].$b.a_tangent.length;h={a_position:new Float32Array(c),a_normal:new Float32Array(d),a_tangent:new Float32Array(e)};b.ba.push({xl:a[0].ba[m].xl,$b:h})}for(h=c=0;h<a.length;h++)c+=a[h].J;b.J=c;var d=a[0],n;for(n in d.G){for(h=c=0;h<
a.length;h++)c+=a[h].G[n].length;b.G[n]=new Float32Array(c)}for(n in d.v[0]){for(h=c=0;h<a.length;h++)c+=a[h].v[0][n].length;for(h=0;h<d.v.length;h++)b.v[h]=b.v[h]||{},b.v[h][n]=new Float32Array(c)}for(n=d=c=0;n<a.length;n++){for(var e=a[n],q=e.fa,m=e.J,C=e.G,h=0;h<q.length;h++)b.fa[c+h]=q[h]+d;var c=c+q.length,f;for(f in C){var q=C[f],t=d*K(q,m);b.G[f].set(q,t)}for(h=0;h<e.v.length;h++){var C=e.v[h],x=b.v[h];for(f in C)q=C[f],t=d*K(q,m),x[f].set(q,t)}d+=m}if(0<b.ba.length)for(n=0;n<b.ba.length;n++)for(f=
b.ba[n].$b,h=e=d=c=0;h<a.length;h++)m=a[h].ba[n].$b,f.a_position.set(m.a_position,c),f.a_normal.set(m.a_normal,d),f.a_tangent.set(m.a_tangent,e),c+=m.a_position.length,d+=m.a_normal.length,e+=m.a_tangent.length;return b}function m(a,b,c,h,d,e){var m=k.pb("SUBMESH_"+a.name+"_"+b),n=a.submeshes[b],C=n.base_length,f=a.materials[b];m.J=C;var t=!1;if(u(c,"a_texcoord")){var I=null,l=a.materials[b];b=a.submeshes[b];if(l.texture_slots.length)switch(l=l.texture_slots[0],l.texture_coords){case "UV":l=a.uv_textures.indexOf(l.uv_layer);
-1==l||0==l?I=new Float32Array(b.texcoord):1==l&&(I=new Float32Array(b.texcoord2));break;case "ORCO":for(var H=a.b4w_bounding_box,I=new Float32Array(2*b.base_length),l=(H.max_x+H.min_x)/2,J=(H.max_z+H.min_z)/2,r=H.max_x-H.min_x,H=H.max_z-H.min_z,A=0,B=0;B<b.position.length;B+=3)I[A++]=(b.position[B]-l)/r+.5,I[A++]=(J-b.position[B+2])/H+.5}null===I&&(I=new Float32Array(b.texcoord));b=I}else b=new Float32Array(0);var G,I=n.group;if(u(c,"a_influence")&&h){l=new Float32Array(4*C);J=I.length/C;r=new Float32Array(J);
for(H=0;H<J;H++)for(G in r[H]=-1,h)if(A=h[G],A.jy===H){r[H]=A.Ui;break}B=3<J?J:4;h=new Float32Array(B);G=new Uint32Array(B);for(var H=new Float32Array(4),A=new Float32Array(B),B=new Uint32Array(B),K=new Float32Array(4),F=0;F<C;F++)h.set(A),G.set(B),H.set(K),l.set(y(I,J,F,C,r,h,G,H),4*F)}else l=new Float32Array(0);G=l;h=d?k.Ba(d):{};h.a_color={rg:!0};h.a_color.src=u(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,$c:7}]:[];d={a_texcoord:b,a_influence:G};G=n.vertex_colors;b=n.color;I=a.name;
l=[];for(J=0;J<G.length;J++)l.push(G[J].name);for(var V in h)if(J=h[V].src,J.length){for(H=r=0;H<J.length;H++)r+=k.Sg(J[H].$c);d[V]=new Float32Array(r*C);for(H=A=0;H<J.length;H++){var S=J[H].name,B=J[H].$c,K=k.Ow(B),E=l.indexOf(S);-1==E&&k.pa('vertex color "'+S+'" for mesh "'+I+'" not found.');var F=G[E].mask,N=k.Sg(F);(B&F)!==B&&O.error("Wrong color extraction from "+S+" to "+V+".");for(var ha=S=0;ha<E;ha++)S+=k.Sg(G[ha].mask);E=S*C;for(S=0;S<C;S++)for(ha=0;3>ha;ha++)K[ha]&&(d[V][S*r+(A+k.Tj(B,ha))]=
b[E+S*N+k.Tj(F,ha)]);A+=N}}else d[V]=new Float32Array(0);V=a.uv_textures;h=n.texcoord;G=n.texcoord2;b=a.name;if(e)for(var oa in e){I=V.indexOf(oa);-1==I&&k.pa('uv map "'+oa+'" for mesh "'+b+'" not found');if(0==I)var P=new Float32Array(h);else 1==I&&(P=new Float32Array(G));d[e[oa]]=P}m.G=d;m.fa=new Uint32Array(n.indices);e=n.position.length/C/3;P=(oa=u(c,"a_normal")&&n.normal.length?!0:!1)&&u(c,"a_tangent")&&n.tangent.length?!0:!1;V=oa&&f.texture_slots.length&&u(c,"a_tangent")&&"ORCO"==f.texture_slots[0].texture_coords?
!0:!1;0<a.b4w_shape_keys.length&&(t=!0);for(d=0;d<e;d++){f=x(n,c,C,oa,P,V,d);if(t)if(h={},h.name=a.b4w_shape_keys[d].name,m.ba.push(h),0!=d){h.$b=f;h.xl=a.b4w_shape_keys[d].value;continue}else h.$b=x(n,c,C,oa,P,V,d),h.xl=1;m.v.push(f)}if(1<e&&!t){a=m.v[0];var f={},v;for(v in a)f[v]=new Float32Array(a[v]);m.v.push(f)}u(c,"a_polyindex")&&(p(m,1,!0),m.G.a_polyindex=q(m));return m}function x(a,b,c,d,e,m,n){var q={},f=new Float32Array(3*c),t=new Float32Array(d?3*c:0),I=new Float32Array(e||m?4*c:0),x=n*
c*3;f.set(a.position.subarray(x,x+3*c),0);d&&(x=n*c*3,t.set(a.normal.subarray(x,x+3*c),0));if(e)x=n*c*4,I.set(a.tangent.subarray(x,x+4*c),0);else if(m)for(a=I,O.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+mesh.name+'". Please add a UV-map.'),b=0;b<c;b++)d=h,e=C,d[0]=t[3*b],d[1]=t[3*b+1],d[2]=t[3*b+2],J.cross(d,k.rd,e),0==J.length(e)&&J.cross(d,k.Qe,e),J.normalize(e,e),a[4*b]=e[0],a[4*b+1]=e[1],a[4*b+2]=e[2],a[4*b+3]=1;else if(d&&u(b,"a_tangent"))for(I=
new Float32Array(4*c),c=0;c<I.length;c++)I[c]=1;q.a_position=f;q.a_normal=t;q.a_tangent=I;return q}function u(a,b){return-1<a.indexOf(b)?!0:!1}function y(b,g,c,h,d,e,k,m){for(var n=!0,q=0;q<g;q++){var C=b[q*h+c];if(-1!==C){var f=d[q];-1!==f&&(e[q]=C,k[q]=f,n=!1)}}if(n)return m;G(e,k,a.$m,!1);for(q=b=0;4>q;q++)b+=e[q];if(.01>b)return m;for(q=0;4>q;q++)e[q]/=b;if(.01>Math.abs(e[0]-1))m[0]=k[0]+1;else for(q=0;4>q;q++)m[q]=k[q]+e[q];return m}function K(a,b){if(0==b)return 0;var c=a.length,h=c/b;if(h!=
Math.floor(h))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return h}function G(b,g,c,h){for(var d=b.length,e=d,k=!1,m=h?-1:1;1<e||k;){1<e&&(e=Math.floor(e/1.247330950103979));for(var k=!1,n=0;e+n<d;n++)if(c==a.$m?0>m*(b[n]-b[n+e]):b[n]<b[n+e]&&h)k=b[n],b[n]=b[n+e],b[n+e]=k,k=g[n],g[n]=g[n+e],g[n+e]=k,k=!0}}function A(a,b,c){var h=[],d=[];J.subtract(b,a,h);J.subtract(c,a,d);J.normalize(h,h);J.normalize(d,d);return Math.acos(J.dot(h,d))}function n(a,g,c){g||
(g=[]);c=c?a.v[0].a_normal:a.v[0].a_position;if(b(a)){a=a.fa;for(var h=a.length/3,d=0;d<h;d++){var e=new Float32Array(9),k=a[3*d];e[0]=c[3*k];e[1]=c[3*k+1];e[2]=c[3*k+2];k=a[3*d+1];e[3]=c[3*k];e[4]=c[3*k+1];e[5]=c[3*k+2];k=a[3*d+2];e[6]=c[3*k];e[7]=c[3*k+1];e[8]=c[3*k+2];g[d]=e}}else for(d=0;d<c.length;d++)e=new Float32Array(9),e[0]=c[9*d],e[1]=c[9*d+1],e[2]=c[9*d+2],e[3]=c[9*d+3],e[4]=c[9*d+4],e[5]=c[9*d+5],e[6]=c[9*d+6],e[7]=c[9*d+7],e[8]=c[9*d+8],g[d]=e;return g}function q(a){for(var b=new Float32Array(a.J),
c=0;c<a.J;c++)b[c]=c%3;return b}function c(a,b,c){var h=J.dist(a,b);a=J.dist(a,c);b=J.dist(b,c);c=(h+a+b)/2;return c*(c-h)*(c-a)*(c-b)}function P(a,b,c,h,d){c-=b;for(var e=0;e<c;e+=h)e%h==d&&vec3.normalize(a.subarray(e+b-d,e+b+1),a.subarray(e+b-d,e+b+1))}var O=v("__print"),F=v("__tsr"),k=v("__util"),B=v("__extensions"),J=v("vec3"),h=new Float32Array(3),C=new Float32Array(3),I=new Float32Array(3);a.ee=10;a.Tr=20;a.YI=30;a.qk=10;a.sr=20;a.pk=30;a.rr=40;a.wy=50;a.$m=0;a.Iz=1;a.Gi=a.qk;var H=null;a.Lc=
function(a){H=a};a.oK=function(a){var b=_buffers[a];H.deleteBuffer(b.ve);H.deleteBuffer(b.Lf);delete _buffers[a]};a.CG=function(c,g,h,e){d(c)&&p(c);var k=c.fa,m=c.J,n=c.v,q={},C;for(C in c.G)C in e&&!e[C].rg||(q[C]=c.G[C]);e={tg:null,Me:null,bp:0,count:0,ai:{},mode:0,fk:0,al:0,vt:0,Lf:null,ve:null,vl:null,ba:null};if(0<c.ba.length){C=n[0];for(var f=1;f<c.ba.length;f++){for(var t=c.ba[f].$b,I=t.a_position,x=t.a_normal,y=C.a_position,u=C.a_normal,J=I.length,A=c.ba[f].xl,B=0;B<J;B++)y[B]+=A*I[B],u[B]+=
A*x[B];t=t.a_tangent;I=C.a_tangent;x=t.length;for(B=0;B<x;B++)I[B]+=A*t[B]}}if(k.length)if(C=k.length,65536>=m)var f=new Uint16Array(k),G=H.UNSIGNED_SHORT;else f=new Uint32Array(k),G=H.UNSIGNED_INT;else C=m,f=null;var A=0,B=n.length,F;for(F in n[0])t=n[0][F],A+=t.length*B;for(F in q)t=q[F],A+=t.length;F=new Float32Array(A);var A=0,B={},P;for(P in q)if(I=q[P],t=I.length)F.set(I,A),B[P]={AJ:P,Jg:K(I,m),offset:A,frames:1,length:t},A+=t;q=n.length;for(P in n[0])if(I=n[0][P],t=I.length,I=K(I,m),t)for(B[P]=
{Jg:I,offset:A,frames:q,length:t},1<q&&(B[P+"_next"]={Jg:I,offset:A+t,frames:q,length:t}),x=0;x<q;x++)I=n[x][P],F.set(I,A),A+=t;e.count=C;e.tg=f;e.Me=F;e.bp=G;e.ai=B;r(e,h);l(e);g!=a.ee&&b(c)&&(e.vl={CE:new Float32Array(k.length),DE:new Float32Array(k.length),mC:new Float32Array(k.length/3),type:g});e.ba=c.ba;return e};a.gE=d;a.fE=b;a.Gq=p;a.bO=function(a,b,c){r(a,b);a.count=c.length;a.tg=c;a.bp=c instanceof Uint16Array?H.UNSIGNED_SHORT:H.UNSIGNED_INT;return a};a.Vq=function(a,b,c,h){var d=a.Me,e=
a.ai,m=e[b];m?(c&&m.Jg!=c&&k.pa('invalid num_comp for "'+b+'"'),d.set(h,m.offset)):(d=d.length,m=new Float32Array(d+h.length),m.set(a.Me),m.set(h,d),a.Me=m,e[b]={Jg:c,offset:d});l(a)};a.CK=f;a.tM=function(a){a.fk=H.STATIC_DRAW};a.uE=function(a){a.fk=H.DYNAMIC_DRAW};a.ZG=l;a.Ts=function(a){a.ve&&H.deleteBuffer(a.ve);a.Lf&&H.deleteBuffer(a.Lf)};a.dv=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Nx=function(a,b){for(var c=0;c<a.v.length;c++){var h=a.v[c].a_position;F.Dm(h,b,h,0);h=a.v[c].a_normal;
0<h.length&&F.Ux(h,b,h,0);h=a.v[c].a_tangent;0<h.length&&F.Vx(h,b,h,0)}(c=a.G.au_center_pos)&&c.length&&F.Dm(c,b,c,0);return a};a.AG=function(a,b){var c=a.G.au_center_pos;if(c&&c.length){var h=new Float32Array(c);F.Dm(h,b,h,0);for(var d=0;d<a.v.length;d++)for(var e=0;e<h.length;e++)a.v[d].a_position[e]+=h[e]-c[e];c.set(h)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.zG=function(a,b){var c=a.J,h;for(h in b){var d=b[h].length;a.G[h]=new Float32Array(d*c);for(var e=0;e<c;e++)for(var k=
0;k<d;k++)a.G[h][e*d+k]=b[h][k]}};a.BG=t;a.tE=function(a,b,c){if(!a.J)return k.pb("EMPTY");var h=c.length;65536<a.J*h&&!B.nu()&&p(a,h);var d=a.fa,e=a.J,m=a.G;a=a.v;for(var n in b){var q=b[n].length,C=q*e;m[n]=new Float32Array(C);for(var f=0;f<e;f++)for(C=0;C<q;C++)m[n][f*q+C]=b[n][C]}b=k.pb("CLONE_"+h+"_SUBMESHES");b.J=e*h;b.fa=new Uint32Array(d.length*h);for(f=0;f<h;f++)for(q=d.length*f,n=e*f,C=0;C<d.length;C++)b.fa[q+C]=d[C]+n;for(var t in m)for(d=m[t],C=d.length*h,q=K(d,e),b.G[t]=new Float32Array(C),
f=0;f<h;f++)n=e*q*f,b.G[t].set(d,n);for(t in a[0])for(f=0;f<a.length;f++)for(d=a[f][t],C=d.length*h,q=K(d,e),b.v[f]=b.v[f]||{},b.v[f][t]=new Float32Array(C),C=0;C<h;C++)switch(m=c[C],n=e*q*C,t){case "a_position":F.Dm(d,m,b.v[f][t],n);break;case "a_normal":F.Ux(d,m,b.v[f][t],n);break;case "a_tangent":F.Vx(d,m,b.v[f][t],n);break;default:throw"Wrong attribute name: "+t;}return b};a.Lt=m;a.CC=function(a){var b=a.J,c=a.v[0].a_position,h=new Float32Array(12*b),d=new Float32Array(8*b);a=new Uint16Array(4*
a.fa.length);for(var e=0;e<b;e++)h[12*e]=c[3*e],h[12*e+1]=c[3*e+1],h[12*e+2]=c[3*e+2],h[12*e+3]=c[3*e],h[12*e+4]=c[3*e+1],h[12*e+5]=c[3*e+2],h[12*e+6]=c[3*e],h[12*e+7]=c[3*e+1],h[12*e+8]=c[3*e+2],h[12*e+9]=c[3*e],h[12*e+10]=c[3*e+1],h[12*e+11]=c[3*e+2],d[8*e]=-.5,d[8*e+1]=-.5,d[8*e+2]=-.5,d[8*e+3]=.5,d[8*e+4]=.5,d[8*e+5]=.5,d[8*e+6]=.5,d[8*e+7]=-.5,a[6*e]=4*e+2,a[6*e+1]=4*e+1,a[6*e+2]=4*e,a[6*e+3]=4*e+2,a[6*e+4]=4*e,a[6*e+5]=4*e+3;c=k.pb("HALO");c.v=[];c.v[0]={};c.J=4*b;c.v[0].a_position=h;c.G.a_halo_bb_vertex=
d;c.fa=a;return c};a.RD=u;a.DC=function(a){for(var b=["a_position","a_normal"],c=[],h=0;h<a.submeshes.length;h++){var d=m(a,h,b,null,null,null);d.J&&c.push(d)}return 0==c.length?k.pb("EMPTY"):1==c.length?c[0]:t(c)};a.UG=function(a,b,c){for(var h=a.tg,d=f(a,"a_position"),e=a.vl,m=e.CE,n=e.DE,e=e.mC,q=h,C=q.length/3,t=0;t<C;t++){var I=q[3*t],x=q[3*t+1],l=q[3*t+2],y=d[3*I+1],u=d[3*I+2],J=d[3*x+1],A=d[3*x+2],r=d[3*l+1],B=d[3*l+2];m[3*t]=(d[3*I]+d[3*x]+d[3*l])/3;m[3*t+1]=(y+J+r)/3;m[3*t+2]=(u+A+B)/3}k.tf(m,
b,n);b=n.length/3;for(d=0;d<b;d++)m=n[3*d]-c[0],q=n[3*d+1]-c[1],C=n[3*d+2]-c[2],e[d]=m*m+q*q+C*C;c=h;h=e.length;if(!(2>h))for(n=h,d=!1;1<n||d;)for(1<n&&(n=Math.floor(n/1.247330950103979)),d=!1,b=0;n+b<h;b++)0>e[b]-e[b+n]&&(d=e[b],e[b]=e[b+n],e[b+n]=d,d=c,m=b,q=b+n,C=d[3*m],t=d[3*m+1],I=d[3*m+2],d[3*m]=d[3*q],d[3*m+1]=d[3*q+1],d[3*m+2]=d[3*q+2],d[3*q]=C,d[3*q+1]=t,d[3*q+2]=I,d=!0);h=c;H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.ve);H.bufferData(H.ELEMENT_ARRAY_BUFFER,h,H.DYNAMIC_DRAW)};a.zx=G;a.NA=function(a,
b,c){for(var h=b.length/3,d=a.length/3,e=[],k=Array(3),m=Array(3),n=Array(3),q=0;q<d;q++){for(var C=a[3*q],f=a[3*q+1],t=a[3*q+2],I=0;3>I;I++)k[I]=b[3*C+I],m[I]=b[3*f+I],n[I]=b[3*t+I];if(c)var I=A(k,m,n),x=A(m,n,k),l=Math.PI-I-x;else l=x=I=1;var H=e,y;y=k;var u=n,r=[],B=[],V=[];J.subtract(m,y,r);J.subtract(u,y,B);J.cross(r,B,V);J.normalize(V,V);y=V;for(u=0;3>u;u++)r=3*f+u,B=3*t+u,H[3*C+u]=I*y[u],H[r]=x*y[u],H[B]=l*y[u]}if(c)for(var p in c)for(q=c[p],a=0;3>a;a++){b=3*q[0]+a;for(d=1;d<q.length;d++)k=
3*q[d]+a,e[b]+=e[k];for(d=1;d<q.length;d++)k=3*q[d]+a,e[k]=e[b]}for(q=0;q<h;q++){c=q;p=e;a=new Float32Array(3);for(b=0;3>b;b++)d=3*c+b,a[b]=p[d];J.normalize(a,a);for(b=0;3>b;b++)d=3*c+b,p[d]=a[b]}return e};a.OA=function(a,b,c){for(var h={},d=b.length/3,e=0;e<d;e++){var k=String(b[3*e])+String(b[3*e+1])+String(b[3*e+2]);h[k]=[]}d=a.length;for(e=0;e<d;e++)b=a[e],k=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),k in h&&h[k].push(b);return h};a.Fo=function(a,b,d,e){var m=n(a,null,!1);if(d)var q=n(a,
null,!0);var f=m.length,t=new Float32Array(f),x=h,l=C;for(a=0;a<f;a++){var H=m[a];x.set(H.subarray(0,3));l.set(H.subarray(3,6));I.set(H.subarray(6));t[a]=Math.sqrt(c(x,l,I))}x=new Float32Array(f);x[0]=t[0];for(a=1;a<f;a++)x[a]=x[a-1]+t[a];f=x[t.length-1];t=[];for(a=0;a<b;a++){var l=f*k.cd(e),l=k.Hk(x,l,0,x.length-1),H=d?q[l]:m[l],l=a,y=H,u=e,H=void 0,H=new Float32Array(3),J=y[0],r=y[1],A=y[2],B=y[3],p=y[4],G=y[5],K=y[6],F=y[7],V=y[8],y=k.cd(u),u=k.cd(u);1<y+u&&(y=1-y,u=1-u);var S=1-y-u,r=S*r+y*p+
u*F,A=S*A+y*G+u*V;H[0]=S*J+y*B+u*K;H[1]=r;H[2]=A;t[l]=H}return t};a.DK=n;a.Kt=q;a.YN=c;a.FD=function(a,b,c,h){var d=b[0]-a[0],e=c[0]-a[0],k=b[1]-a[1],m=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];h[0]=k*a-b*m;h[1]=e*b-d*a;h[2]=d*m-k*e;return h};a.AF=function(a,b,c){a=a.v[0].a_position;for(var h=0;h<a.length;h+=3)a[h]=(a[h]-c[0])*b[0]+c[0],a[h+1]=(a[h+1]-c[1])*b[1]+c[1],a[h+2]=(a[h+2]-c[2])*b[2]+c[2]};a.oJ=function(a,b,c){var h=a.n;a=a.d.zf;for(var d=1;d<a.length;d++)a[d].name==b&&(a[d].value=c);for(d=0;d<h.length;d++)if(!h[d].ng&&
h[d].Wd&&!h[d].yh){var e=h[d].da.ai;b=h[d].da.Me;H.bindBuffer(H.ARRAY_BUFFER,h[d].da.Lf);if(e.a_position){var k=e.a_position.offset,m=e.a_position.length+k,n=h[d].da.ba[0].$b.a_position;for(c=k;c<m;c++)b[c]=n[c-k];for(n=1;n<h[d].da.ba.length;n++){var q=h[d].da.ba[n].$b.a_position,C=a[n].value;if(C)for(c=k;c<m;c++)b[c]+=C*q[c-k]}H.bufferSubData(H.ARRAY_BUFFER,4*k,b.subarray(k))}if(e.a_normal){k=e.a_normal.offset;m=e.a_normal.length+k;n=h[d].da.ba[0].$b.a_normal;for(c=k;c<m;c++)b[c]=n[c-k];for(n=1;n<
h[d].da.ba.length;n++)if(q=h[d].da.ba[n].$b.a_normal,C=a[n].value)for(c=k;c<m;c++)b[c]+=C*q[c-k];P(b,k,m,3,2);H.bufferSubData(H.ARRAY_BUFFER,4*k,b.subarray(k))}if(e.a_tangent){k=e.a_tangent.offset;e=e.a_tangent.length+k;n=h[d].da.ba[0].$b.a_tangent;for(c=k;c<e;c++)b[c]=n[c-k];for(n=1;n<h[d].da.ba.length;n++)if(m=h[d].da.ba[n].$b.a_tangent,C=a[n].value)for(c=k;c<e;c++)b[c]+=C*m[c-k];P(b,k,e,4,3);H.bufferSubData(H.ARRAY_BUFFER,4*k,b.subarray(k))}}};a.SJ=function(a){return a.d.Wd};a.BL=function(a){var b=
[];if(a.d)for(var c=1;c<a.d.zf.length;c++)b.push(a.d.zf[c].name);return b};a.AL=function(a,b){if(a.d)for(var c=1;c<a.d.zf.length;c++)if(b==a.d.zf[c].name)return a.d.zf[c].value;return 0};a.SL=function(a,b){var c=a.d.zf;if(c)for(var h=1;h<c.length;h++)if(c[h].name==b)return!0;return!1};a.OL=function(a){return a&&a.d&&a.d.Ad?!0:!1}};b4w.module.__tsr=function(a,v){function d(a,b,d,e){e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=b;e[4]=d[0];e[5]=d[1];e[6]=d[2];e[7]=d[3]}function b(a,b,d){var e=b[0],f=b[1],l=b[2],r=b[3],A=b[4],n=b[5],q=b[6];b=b[7];var c=a[0]*r,p=a[1]*r,O=a[2]*r;a=b*c+n*O-q*p;var r=b*p+q*c-A*O,F=b*O+A*p-n*c,c=-A*c-n*p-q*O;d[0]=a*b+c*-A+r*-q-F*-n;d[1]=r*b+c*-n+F*-A-a*-q;d[2]=F*b+c*-q+a*-n-r*-A;d[0]+=e;d[1]+=f;d[2]+=l;return d}var p=v("__util"),e=v("vec3"),f=v("quat");v("mat4");var r=new Float32Array(3),l=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.xh=function(a,b,e,f){f||(f=new Float32Array(8));d(a,b,e,f);return f};a.Wj=d;a.WF=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.xf=function(a,b){b[3]=a};a.XF=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.pq=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Mu=function(a){return a.subarray(0,
3)};a.lj=function(a){return a[3]};a.Bu=function(a){return a.subarray(4)};a.invert=function(a,b){var d=1/a[3];if(!d)return null;var e=a[0],y=a[1],r=a[2];l[0]=a[4];l[1]=a[5];l[2]=a[6];l[3]=a[7];f.invert(l,l);var p=l[0],A=l[1],n=l[2],q=l[3],e=e*d,y=y*d,c=r*d,r=q*e+A*c-n*y,P=q*y+n*e-p*c,O=q*c+p*y-A*e,e=-p*e-A*y-n*c;b[0]=-(r*q+e*-p+P*-n-O*-A);b[1]=-(P*q+e*-A+O*-p-r*-n);b[2]=-(O*q+e*-n+r*-A-P*-p);b[3]=d;b[4]=p;b[5]=A;b[6]=n;b[7]=q;return b};a.Vt=function(a,b){var e=p.Rh(a,r),f=p.zp(a),y=p.of(a,l);d(e,f,
y,b);return b};a.multiply=function(a,d,e){b(d,a,e);e[3]=a[3]*d[3];var f=a[4],l=a[5],r=a[6];a=a[7];var p=d[4],A=d[5],n=d[6];d=d[7];e[4]=f*d+a*p+l*n-r*A;e[5]=l*d+a*A+r*p-f*n;e[6]=r*d+a*n+f*A-l*p;e[7]=a*d-f*p-l*A-r*n;return e};a.bk=b;a.VN=function(a,b,d){var e=b[3],f=a[0]-b[0],l=a[1]-b[1],r=a[2]-b[2];a=b[4];var A=b[5],n=b[6];b=b[7];var q=a*a+A*A+n*n+b*b,q=q?1/q:0;a=-a*q;A=-A*q;n=-n*q;b*=q;var q=b*f+A*r-n*l,c=b*l+n*f-a*r,p=b*r+a*l-A*f,f=-a*f-A*l-n*r;d[0]=q*b+f*-a+c*-n-p*-A;d[1]=c*b+f*-A+p*-a-q*-n;d[2]=
p*b+f*-n+q*-A-c*-a;d[0]/=e;d[1]/=e;d[2]/=e;return d};a.Dm=function(a,b,d,e){e||(e=0);var f=a.length,l=b[0],r=b[1],A=b[2],n=b[3],q=b[4],c=b[5],p=b[6];b=b[7];for(var O=0;O<f;O+=3){var F=a[O]*n,k=a[O+1]*n,B=a[O+2]*n,J=b*F+c*B-p*k,h=b*k+p*F-q*B,C=b*B+q*k-c*F,F=-q*F-c*k-p*B;d[e+O]=J*b+F*-q+h*-p-C*-c;d[e+O+1]=h*b+F*-c+C*-q-J*-p;d[e+O+2]=C*b+F*-p+J*-c-h*-q;d[e+O]+=l;d[e+O+1]+=r;d[e+O+2]+=A}};a.Ux=function(a,b,d,e){e||(e=0);var f=a.length,l=b[3],r=b[4],A=b[5],n=b[6];b=b[7];for(var q=0;q<f;q+=3){var c=a[q]*
l,p=a[q+1]*l,O=a[q+2]*l,F=b*c+A*O-n*p,k=b*p+n*c-r*O,B=b*O+r*p-A*c,c=-r*c-A*p-n*O;d[e+q]=F*b+c*-r+k*-n-B*-A;d[e+q+1]=k*b+c*-A+B*-r-F*-n;d[e+q+2]=B*b+c*-n+F*-A-k*-r}};a.ak=function(a,b,d){var e=b[3],f=b[4],l=b[5],r=b[6];b=b[7];var A=a[0]*e,n=a[1]*e,q=a[2]*e;a=b*A+l*q-r*n;var e=b*n+r*A-f*q,c=b*q+f*n-l*A,A=-f*A-l*n-r*q;d[0]=a*b+A*-f+e*-r-c*-l;d[1]=e*b+A*-l+c*-f-a*-r;d[2]=c*b+A*-r+a*-l-e*-f};a.Vx=function(a,b,d,e){e||(e=0);var f=a.length,l=b[3],r=b[4],A=b[5],n=b[6];b=b[7];for(var q=0;q<f;q+=4){var c=a[q]*
l,p=a[q+1]*l,O=a[q+2]*l,F=b*c+A*O-n*p,k=b*p+n*c-r*O,B=b*O+r*p-A*c,c=-r*c-A*p-n*O;d[e+q]=F*b+c*-r+k*-n-B*-A;d[e+q+1]=k*b+c*-A+B*-r-F*-n;d[e+q+2]=B*b+c*-n+F*-A-k*-r;d[e+q+3]=a[q+3]}};a.translate=function(a,b,d){var e=a[3],f=a[4],l=a[5],r=a[6],A=a[7],n=b[0]*e,q=b[1]*e,c=b[2]*e;b=A*n+l*c-r*q;var e=A*q+r*n-f*c,p=A*c+f*q-l*n,n=-f*n-l*q-r*c;d[0]=a[0]+b*A+n*-f+e*-r-p*-l;d[1]=a[1]+e*A+n*-l+p*-f-b*-r;d[2]=a[2]+p*A+n*-r+b*-l-e*-f;d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];return d};a.ZL=function(a,b,
d,l){l||(l=new Float32Array(8));e.lerp(a.subarray(0,3),b.subarray(0,3),d,l.subarray(0,3));var y=a[3];l[3]=y+d*(b[3]-y);f.slerp(a.subarray(4),b.subarray(4),d,l.subarray(4));return l};a.EK=function(a,b,d,e){e||(e=new Float32Array(8));var l=a.subarray(0,3),r=b.subarray(0,3),p=e.subarray(0,3);p[0]=r[0]*(d+1)-l[0]*d;p[1]=r[1]*(d+1)-l[1]*d;p[2]=r[2]*(d+1)-l[2]*d;e[3]=b[3]*(d+1)-a[3]*d;a=a.subarray(4);b=b.subarray(4);l=e.subarray(4);l[0]=b[0]*(d+1)-a[0]*d;l[1]=b[1]*(d+1)-a[1]*d;l[2]=b[2]*(d+1)-a[2]*d;l[3]=
b[3]*(d+1)-a[3]*d;f.normalize(l,l);return e};a.ZD=function(a,b,d,e,f){f[0]=a[0]+b*d[0];f[1]=a[1]+b*d[1];f[2]=a[2]+b*d[2];f[3]=a[3];d=e[0];var l=e[1];e=e[2];var r=a[4],A=a[5],n=a[6],q=a[7];f[4]=.5*(d*q+l*n-e*A);f[5]=.5*(l*q+e*r-d*n);f[6]=.5*(e*q+d*A-l*r);f[7]=.5*(-d*r-l*A-e*n);f[4]=a[4]+f[4]*b;f[5]=a[5]+f[5]*b;f[6]=a[6]+f[6]*b;f[7]=a[7]+f[7]*b;a=f[4];b=f[5];d=f[6];l=f[7];a=a*a+b*b+d*d+l*l;0<a&&(a=1/Math.sqrt(a),f[4]*=a,f[5]*=a,f[6]*=a,f[7]*=a)}};b4w.module.__extensions=function(a,v){function d(a){if(a in e)return e[a];var d=p.getExtension(a)||null;e[a]=d;b.log("%cGET EXTENSION","color: #"+(d?"0a0":"a00"),a);return d}var b=v("__print"),p=null,e={};a.Lc=function(a){p=a};a.Du=function(){return d("WEBGL_compressed_texture_s3tc")||d("WEBKIT_WEBGL_compressed_texture_s3tc")||d("MOZ_WEBGL_compressed_texture_s3tc")};a.pD=function(){return d("WEBGL_depth_texture")||d("WEBKIT_WEBGL_depth_texture")||d("MOZ_WEBGL_depth_texture")};a.eD=function(){return d("EXT_texture_filter_anisotropic")||
d("WEBKIT_EXT_texture_filter_anisotropic")||d("MOZ_EXT_texture_filter_anisotropic")};a.oD=function(){return d("WEBGL_debug_shaders")};a.Cu=function(){return d("WEBGL_debug_renderer_info")};a.nu=function(){return d("OES_element_index_uint")};a.JD=function(){return d("OES_standard_derivatives")};a.Y=function(){e={}}};b4w.module.__scenes=function(a,v){function d(){Ib||(Ib=b(xa));return Ib}function b(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.vd||!c.vd.length)return c}return null}function p(){if(!Ga)throw"No active scene available";return Ga}function e(a,b,c,g){for(var h=null,d=0;d<b.length;d++){var e=b[d];if((c?e.origin_name:e.name)==a&&e.d.zd==g){h=e;break}}return h}function f(a,b){b||(b="ALL");var c=[];r(a.objects,b,c);return c}function r(a,b,c){for(var g=0;g<a.length;g++){var h=a[g];"ALL"!=b&&b!=h.type||
c.push(h);(h=h.dupli_group)&&r(h.objects,b,c)}}function l(b){if("NONE"==pa.yf||!b.b4w_render_shadows)return!1;var c=!1,g=!1;if(0==ea(b,"LAMP",a.L).length)return!1;b=ea(b,"MESH",a.L);for(var h=0;h<b.length;h++){var d=b[h];d.b4w_shadow_cast&&(c=!0);d.b4w_shadow_receive&&(g=!0);if(c&&g)return!0}return!1}function t(a){if(!a.wa)return!1;a=a.wa.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].cb.type)return!0;return!1}function m(a){if(!pa.fi)return!1;a=la(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&
c.b4w_water_shore_smoothing)return!0}return!1}function x(b){var c=la(b),g=[];b=ea(b,"MESH",a.L);for(var h=0;h<c.length;h++){var d=c[h];if(d.b4w_water){for(var e={},E=0;E<b.length;E++)for(var k=b[E],N=k.data.materials,n=0;n<N.length;n++)N[n]==d&&(e.Of=k.location[1]);if(pa.Vi)for(e.hc=d.b4w_water_fog_color.slice(0),e.hc.push(d.b4w_water_fog_density),d.b4w_water_dynamic?(e.Bh=!0,e.waves_height=d.b4w_waves_height,e.waves_length=d.b4w_waves_length,e.dst_noise_scale0=d.b4w_water_dst_noise_scale0,e.dst_noise_scale1=
d.b4w_water_dst_noise_scale1,e.dst_noise_freq0=d.b4w_water_dst_noise_freq0,e.dst_noise_freq1=d.b4w_water_dst_noise_freq1,e.dir_min_shore_fac=d.b4w_water_dir_min_shore_fac,e.dir_freq=d.b4w_water_dir_freq,e.dir_noise_scale=d.b4w_water_dir_noise_scale,e.dir_noise_freq=d.b4w_water_dir_noise_freq,e.dir_min_noise_fac=d.b4w_water_dir_min_noise_fac,e.dst_min_fac=d.b4w_water_dst_min_fac,e.waves_hor_fac=d.b4w_water_waves_hor_fac):(e.Bh=!1,e.waves_height=0,e.waves_length=0),e.Nk=null,e.In=null,e.Jn=new Float32Array(2),
e.wm=null,d=d.texture_slots,E=0;E<d.length;E++)k=d[E].texture,"VORONOI"==k.type&&(e.Nk=k.noise_scale,e.Jn.set([.3,.7]),e.In=k.noise_intensity),!0===k.b4w_shore_dist_map&&(e.wm=k.image,e.gi=k.image.size[0],e.eG=k.b4w_shore_boundings,e.Th=k.b4w_max_shore_dist);else e.waves_height=0,e.waves_length=0,e.Nk=null,e.In=null,e.Jn=null,e.hc=null,e.Bh=!1;g.push(e)}}if(0<g.length){e=g[0];if(!e.Bh)for(h=0;h<g.length;h++)g[h].Bh&&(e=g[h]);return e}return null}function u(a){function b(a){if(a){a=a.nodes;for(var g=
0;g<a.length;g++){var h=a[g];"GROUP"==h.type&&h.node_group&&b(h.node_group.node_tree);"GROUP"==h.type&&"B4W_REFRACTION"==h.node_tree_name&&(c.Kd=!0)}}}var c={};a=la(a);for(var g=0;g<a.length;g++){var h=a[g];h.b4w_refractive&&(c.Kd=!0);h.node_tree&&b(h.node_tree)}return c}function y(b){if(!pa.hm||!b.b4w_render_reflections)return!1;var c=[];b=ea(b,"MESH",a.L);for(var g=0;g<b.length;g++){var h=b[g];if(h.b4w_reflective){var d;a:{h=h.constraints;for(d=0;d<h.length;d++){var e=h[d];if("LOCKED_TRACK"==e.type&&
"REFLECTION PLANE"==e.name){d=e.target;break a}}d=null}d&&(h=d.location,d=d.d.quat,e=new Float32Array(4),ya.NG(h,d,ya.Sa,e),c.push(e))}}return c}function K(a,b){var c={},g=a.world.b4w_sky_settings;c.Kw=g.render_sky;c.procedural_skydome=g.procedural_skydome&&b;c.use_as_environment_lighting=g.use_as_environment_lighting;c.hi=g.color;c.rayleigh_brightness=g.rayleigh_brightness;c.mie_brightness=g.mie_brightness;c.spot_brightness=g.spot_brightness;c.scatter_strength=g.scatter_strength;c.rayleigh_strength=
g.rayleigh_strength;c.mie_strength=g.mie_strength;c.rayleigh_collection_power=g.rayleigh_collection_power;c.mie_collection_power=g.mie_collection_power;c.mie_distribution=g.mie_distribution;c.ec=g.reflexible;c.Sb=g.reflexible_only;!b&&g.procedural_skydome&&Ha.warn("There is no sun on the scene. Procedural sky won't be rendered");return c}function G(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.WD=a.hemisphere;b.IA=a.blur_depth;b.Bs=a.blur_discard_value;b.influence=
a.influence;b.dist_factor=a.dist_factor;b.yF=a.samples;return b}function A(a){var b={};a=a.world.b4w_bloom_settings;b.blur=a.blur;b.pC=a.edge_lum;b.key=a.key;return b}function n(a){var b={};a=a.world.b4w_motion_blur_settings;b.Jl=a.motion_blur_decay_threshold;b.Kl=a.motion_blur_factor;return b}function q(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function c(a){var b={};a=a.world.b4w_god_rays_settings;
b.$D=a.intensity;b.Sh=a.max_ray_length;b.ri=a.steps_per_pass;return b}function P(a){var b={};a=a.world;b.sf=a.b4w_outline_color;b.Sl=a.b4w_outline_factor;return b}function O(a,b){var c=a.world,g=c.light_settings,h={};h.df=g.environment_energy;h.Zq=g.use_environment_light;h.qo=g.environment_color;h.jf=c.horizon_color.slice(0);h.Rf=c.zenith_color.slice(0);h.pH=c.use_sky_paper;h.oH=c.use_sky_blend;h.qH=c.use_sky_real;h.xq=null;h.ro=null;if(h.Zq&&"SKY_TEXTURE"==h.qo&&!(b.Kw&&b.procedural_skydome&&b.use_as_environment_lighting)){for(var g=
null,d=0;d<c.texture_slots.length;d++)if(c.texture_slots[d].texture.b4w_use_as_environment_lighting){g=c.texture_slots[d];break}g?h.ro=g:(Ha.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),h.Zq=!1)}for(d=0;d<c.texture_slots.length;d++)if(c.texture_slots[d].texture.b4w_use_as_skydome){h.xq=c.texture_slots[d];break}return h}function F(b){if(!pa.hb)return!1;var c=!1,g=!1;b=ea(b,"MESH",a.L);for(var h=0;h<
b.length;h++){for(var d=b[h],e=d.data.materials,E=0;E<e.length;E++)e[E].b4w_terrain&&(c=!0);d=d.particle_systems;for(E=0;E<d.length;E++)e=d[E].settings,"HAIR"==e.type&&e.b4w_dynamic_grass&&(g=!0);if(c&&g)return!0}return!1}function k(b){if(Ia.outlining_overview_mode)return!0;if(pa.enable_selectable)switch(b.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":b=ea(b,"MESH",a.L);for(var c=0;c<b.length;c++)if(b[c].d.Ug)return!0;return!1}else return!1}function B(b){if(Ia.outlining_overview_mode)return!0;
if(pa.enable_outlining)switch(b.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":b=ea(b,"MESH",a.L);for(var c=0;c<b.length;c++)if(b[c].d.Lb)return!0;return!1}else return!1}function J(b){b=ea(b,"MESH",a.L);for(var c=0;c<b.length;c++)for(var g=b[c].data.materials,h=0;h<g.length;h++){var d=g[h],e=d.game_settings.alpha_blend;if(d.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e)return!0}return!1}function h(b){b=ea(b,"EMPTY",a.L);for(var c=0;c<b.length;c++){var g=b[c];if(g.b4w_anchor&&
g.b4w_anchor.detect_visibility)return!0}return!1}function C(a,b,c){var g=ua.Yh(a,b);ua.Le(a,g,function(a,b,g){if(g.Pa){switch(g.N){case "COLOR":case "CUBEMAP":a=b.j.Ib;break;case "DEPTH":a=b.j.Yc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(g.ha){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.Nf)throw"Batch texture can't use renderbuffer";ia.Rs(c.tc,g.ha)&&da.Ck(c,a,g.ha)}}});
for(a=0;a<b.ra.length;a++){var g=b.ra[a],h=b.Ud[a];switch(g.ha){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(h.Nf)throw"Batch texture can't use renderbuffer";ia.Rs(c.tc,g.ha)&&da.Ck(c,h,g.ha)}}}function I(a,b,c,g,h){switch(a.type){case "MAIN_OPAQUE":H(a,b,c,"OPAQUE",g,h);break;case "MAIN_BLEND":H(a,b,c,"BLEND",g,h);break;case "MAIN_XRAY":H(a,b,c,"XRAY",g,h);break;case "MAIN_REFLECT":for(var d=b.d,e=b.n,E=0;E<e.length;E++){var k=e[E];if(("MAIN"==
k.type||"NODES"==k.type||"PARTICLES"==k.type)&&"REFLECT"==k.Vb){if(!h){w(k,a,b,c,"REFLECT",g);var N=k.ub;ia.u(N,"DISABLE_FOG",0);ia.u(N,"WATER_EFFECTS",0);"special_skydome.glslf"==ia.su(N)&&ia.u(N,"REFLECTION_PASS",1);ia.u(N,"SHADOW_SRC","SHADOW_SRC_NONE");ia.u(N,"TEXTURE_NORM",0);M(g,k);da.Wb(k);L(k)}a.p.push({aa:!0,sb:d,o:k})}}break;case "DEPTH":d=b.d;b=b.n;for(e=0;e<b.length;e++)if(E=b[e],"DEPTH"==E.type&&!E.uc&&"DEPTH"==E.Vb){if(!h){var k=E,n=a,N=d,q=c,f=g,m=k.ub;if(wa.VD(q,n,"SHADOW_CAST"))if(k.Tb){if("DEPTH"!=
pa.yf)throw"Wrong shadows type";ia.u(m,"SHADOW_SRC","SHADOW_SRC_DEPTH");ia.u(m,"SHADOW_DST","SHADOW_DST_MASK");da.tn(k,f.d.Od);wa.BD(q,n)}else ia.u(m,"SHADOW_SRC","SHADOW_SRC_NONE"),ia.u(m,"SHADOW_DST","SHADOW_DST_MASK");else ia.u(m,"SHADOW_SRC","SHADOW_SRC_NONE"),ia.u(m,"SHADOW_DST","SHADOW_DST_NONE");k.hb&&(n=wa.La(q,"GRASS_MAP"))&&U(k,n,N);da.Wb(k);L(k)}a.p.push({aa:!0,sb:d,o:E});C(c,a,E);R(E)}break;case "SHADOW_CAST":d=!1;e=b.d;b=b.n;E=wa.La(c,"GRASS_MAP");for(k=0;k<b.length;k++)if(N=b[k],"DEPTH"==
N.type&&"SHADOW_CAST"==N.Vb){d=!0;if(!h){if("DEPTH"!=pa.yf)throw"Wrong shadows type";ia.u(N.ub,"SHADOW_SRC","SHADOW_SRC_NONE");ia.u(N.ub,"SHADOW_DST","SHADOW_DST_DEPTH");N.hb&&E&&U(N,E,e);da.He(N,"SHADOW_TEX_RES",ia.O(g.d.Od.csm_resolution));da.Wb(N);L(N)}a.p.push({aa:!0,sb:e,o:N})}d&&X(a,wa.La(c,"MAIN_OPAQUE"),a.p,g,!0);break;case "COLOR_PICKING":T(a,b,h);break;case "COLOR_PICKING_XRAY":T(a,b,h);break;case "OUTLINE_MASK":c=b.d;g=b.n;for(b=0;b<g.length;b++)d=g[b],"COLOR_ID"==d.type&&"OUTLINE"==d.Vb&&
(h||(da.He(d,"USE_OUTLINE",1),da.Wb(d),L(d)),a.p.push({aa:!0,sb:c,o:d}));break;case "GRASS_MAP":c=b.d;g=b.n;for(b=0;b<g.length;b++)d=g[b],"GRASS_MAP"==d.type&&(h||(da.Wb(d),L(d)),a.p.push({aa:!0,sb:c,o:d}),d=a.j,N=c.fb,e=a.jc[0],E=a.jc[1],k=a.jc[2],0==e&&0==E?(e=N.min_y,E=N.max_y):(e=Math.min(e,N.min_y),E=Math.max(E,N.max_y)),N=1E-4*(E-e),a.jc[0]=e-N,a.jc[1]=E+N,Fa.nq(d,k/2,-E,-e,k/2),Fa.Vg(d));break;case "WIREFRAME":for(g=b.d,b=b.n,d=0;d<b.length;d++)e=b[d],"WIREFRAME"==e.type&&(h||(e.hb&&(E=wa.La(c,
"GRASS_MAP"))&&U(e,E,g),da.Wb(e),L(e)),a.p.push({aa:!0,sb:g,o:e}),C(c,a,e),R(e))}}function H(a,b,c,g,h,d){for(var e=b.d,E=b.n,k=0;k<E.length;k++){var N=E[k];N.uc||N.Sb||"MAIN"!=N.type&&"NODES"!=N.type&&"PARTICLES"!=N.type||!("OPAQUE"==N.Vb&&"OPAQUE"==g||"BLEND"==N.Vb&&"BLEND"==g||"XRAY"==N.Vb&&"XRAY"==g)||(d||(w(N,a,b,c,g,h),M(h,N),da.Wb(N),L(N)),a.p.push({aa:!0,sb:e,o:N}),C(c,a,N),R(N))}a.p.sort(function(a,b){var c;if(a.o&&b.o){c=a.o.Ka;var g=b.o.Ka;(c=c==g?0:c>g?1:-1)||(c=a.o.Lg,g=b.o.Lg,c=c==g?
0:c>g?1:-1)}else c=0;return c})}function w(a,b,c,h,d,e){c=c.d;if("OPAQUE"===d)var E=wa.La(h,"SHADOW_CAST")&&a.Tb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE";else if("BLEND"===d||"XRAY"===d)if(wa.La(h,"SHADOW_CAST")&&a.Tb)switch(pa.yf){case "DEPTH":E="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else E="SHADOW_SRC_NONE";else if("REFLECT"===d)E="SHADOW_SRC_NONE";else throw"Wrong main subscene type";d=a.ub;var k=e.d.Od;ia.u(d,"SHADOW_SRC",E);da.tn(a,k);E=b.Kg;ia.u(d,"NUM_LIGHTS",E);ia.u(d,"NUM_LFACTORS",
0==E%2?E/2:Math.floor(E/2)+1);"special_skydome.glslf"==ia.su(d)&&ia.u(d,"REFLECTION_PASS",0);ia.u(d,"SSAO_ONLY",0);b.ab&&b.qd?ia.u(d,"WATER_EFFECTS",1):ia.u(d,"WATER_EFFECTS",0);b.ab&&b.cg&&c.cg?(ia.u(d,"CAUSTICS",1),ia.u(d,"CAUST_SCALE",b.Ks),ia.u(d,"CAUST_SPEED",ia.O(b.Ls,2)),ia.u(d,"CAUST_BRIGHT",b.Js)):ia.u(d,"CAUSTICS",0);b.ab&&(ia.u(d,"WAVES_HEIGHT",ia.O(b.Pf)),ia.u(d,"WAVES_LENGTH",ia.O(b.fh)),ia.u(d,"WATER_LEVEL",ia.O(b.Of)));a.md&&wa.La(h,"MAIN_REFLECT")&&-1===a.ed.indexOf("u_mirrormap")?
ia.u(d,"REFLECTIVE",1):ia.u(d,"REFLECTIVE",0);(k=wa.La(h,"SKY"))?a.ww?(E=k.j.Ib,da.Ck(a,E,"u_sky")):pa.cm?(a.Ac=k.Ac,ia.u(d,"PROCEDURAL_FOG",1)):ia.u(d,"PROCEDURAL_FOG",0):ia.u(d,"PROCEDURAL_FOG",0);E=e.d.jr;E.Zq&&(ia.u(d,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==E.qo?(E=E.ro?da.gD(E.ro,!1):k.j.Ib,ia.u(d,"SKY_TEXTURE",1),da.Ck(a,E,"u_sky_texture")):"SKY_COLOR"==E.qo&&ia.u(d,"SKY_COLOR",1));a.hb&&(E=wa.La(h,"GRASS_MAP"))&&U(a,E,c);a.Zp?(pa.Vi&&ia.u(d,"USE_REFRACTION_CORRECTION",1),"NODES"==a.type?
(ia.u(d,"REFRACTIVE",1),e.d.Kd?ia.u(d,"USE_REFRACTION",1):ia.u(d,"USE_REFRACTION",0)):e.d.Kd?ia.u(d,"REFRACTIVE",1):ia.u(d,"REFRACTIVE",0)):(ia.u(d,"REFRACTIVE",0),ia.u(d,"USE_REFRACTION",0),ia.u(d,"USE_REFRACTION_CORRECTION",0));a.eh&&(a.oy&&wa.La(h,"DEPTH")?ia.u(d,"SHORE_SMOOTHING",1):ia.u(d,"SHORE_SMOOTHING",0),a.water_dynamic&&b.ab&&b.Pf?ia.u(d,"DYNAMIC",1):ia.u(d,"DYNAMIC",0));"PARTICLES"==a.type&&(ia.u(d,"SIZE_RAMP_LENGTH",a.kw),ia.u(d,"COLOR_RAMP_LENGTH",a.bw));if(!a.ng)for(b=a.X,h=0;h<b.length;h++)if(E=
b[h],"SCENE"==E.source)for(c=0;c<xa.length;c++)for(var k=xa[c],N=xa[c].vd,n=0;n<N.length;n++)N[n].d==E&&ua.m(Ya,k,e,null);if(a.Oh){b=0;for(var w in a.Oh)b++;a.mp=new Float32Array(3*b);a.kp=new Float32Array(3*b);a.jp=new Float32Array(3*b);a.lp=new Float32Array(4*b);ia.u(d,"NUM_LAMP_LIGHTS",b);for(h=0;h<e.wa.LAMP.length;h++)g(a,e.wa.LAMP[h])}}function g(a,b){var c=b.uuid;if(c in a.Oh){c=a.Oh[c];a.mp.set(b.d.g,3*c);a.kp.set(b.cb.direction,3*c);a.jp.set(b.cb.rh,3*c);var g=Cb,h=b.cb;g[0]=-1;g[1]=-1;g[2]=
-1;g[3]=h.Kf?1:0;switch(h.type){case "POINT":g[2]=h.distance;break;case "SPOT":g[2]=h.distance;var d=g[0]=Math.cos(h.Rd/2);g[1]=h.li*(1-d)}a.lp.set(g,4*c)}}function M(b,c){var g=ea(b,"LAMP",a.L);c.ub.qp=[];for(var h=aa(g)||g[0],d=0;d<g.length;d++){var e=g[d].cb;if("SPOT"==e.type||"POINT"==e.type)var E=Math.cos(e.Rd/2);if("SPOT"==e.type)var k=e.li*(1-E);var N=e.index;c.ub.qp.push({type:e.type,index:N,oE:Math.floor(N/2),nE:0==N%2?"rg":"ba",Rd:E,li:k,distance:e.distance,iE:e.Zg||e.Kf,PC:N==h.cb.index})}}
function L(a){var b=a.tc.attributes,c=a.da.ai,g;for(g in b)c[g]||ya.pa('missing data for "'+g+'" attribute');if("MAIN"==a.type||"NODES"==a.type)b=ia.MD(a.tc.ky),10<b&&("MAIN"==a.type&&Ha.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Qh.join(", ")+'"'),"NODES"==a.type&&(g=c=0,a.bh&&(c=ya.Dd(a.bh)),a.nb&&(g=ya.Dd(a.nb)),Ha.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+g+', materials: "'+a.Qh.join(", ")+'"')))}function R(a){8<a.X.length&&Ha.warn("too many textures used - "+
a.X.length+' (max 8), materials "'+a.Qh.join(", ")+'"')}function U(a,b,c){a.jc=b.jc;var g=b.jc[0],h=b.jc[1],d=b.jc[2];c=c.Yb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);d=0==d?c:Math.max(d,c);b.jc[2]=d;b=b.j;Fa.nq(b,d/2,-h,-g,d/2);Fa.Vg(b);g=a.Ro||0;g=0==g?c:Math.max(g,c);a.Ro=g}function Z(a){var b=ca(a,"MAIN_OPAQUE"),c=!0;ua.U(a.d.Cb,function(g,d){"SHADOW_CAST"===d.type&&(X(d,b,d.p,a,c),c=!1)})}function X(b,c,g,d,h){if(0!=g.length){var e=b.j;c=c.j;var E=ea(d,"LAMP",a.L),E=aa(E)||E[0],k=E.d;Fa.ox(e,
k.g,k.quat);Ua.copy(c.ff,e.ff);Oa.copy(c.ma,e.tx);if("SPOT"==E.cb.type||"POINT"==E.cb.type)Fa.Vg(e,e.Aa);else{E=za;Q.$d(E);for(k=0;k<g.length;k++){var N=g[k].sb;0==k?Q.ct(N.fb,E):Q.Ft(E,N.fb)}g=Q.AC(E,fc);ya.tf(g,e.ma,g);if(d.d.Od.enable_csm){d=Ua.copy(c.Si[b.Zn],Aa);E=Oa.invert(c.ma,Ba);ya.tf(d,E,d);ya.tf(d,e.ma,d);b=c.$n[b.Zn];if(h)for(Ka=0,h=2;h<g.length;h+=3)Ka=Math.min(Ka,g[h]);h=za;h.max_x=d[0]+b;h.max_y=d[1]+b;h.max_z=0;h.min_x=d[0]-b;h.min_y=d[1]-b;h.min_z=Ka}else{b=h=za;c=ga;c.set(g);d=rb/
9;g=Oa.identity(Ba);Oa.rotate(g,d,ya.Sf,g);k=E=-1;for(N=0;10>N;N++){var n=Q.DA(c,Pa),w=(n.max_x-n.min_x)*(n.max_y-n.min_y);if(-1==E||w<E)E=w,k=N,Q.ct(n,b);ya.tf(c,g,c)}b=k*d;0<b&&(c=Oa.identity(Ba),Oa.rotate(c,b,ya.Sf,c),Oa.multiply(c,e.ma,e.ma));b=h.max_x-h.min_x;c=h.max_y-h.min_y;b&&c&&(d=Math.abs(b-c)/2,2<b/c?(h.max_y+=d,h.min_y-=d):2<c/b&&(h.max_x+=d,h.min_x-=d));h.max_x+=.005;h.max_y+=.005;h.max_z+=.005;h.min_x-=.005;h.min_y-=.005;h.min_z-=.005}Fa.NF(e,h.min_x,h.max_x,h.min_y,h.max_y,-h.max_z,
-h.min_z);Fa.Vg(e)}ya.Jt(e.Mf,e.Do)}}function aa(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function T(a,b,c){var g=b.d;b=b.n;for(var h=0;h<b.length;h++){var d=b[h];"COLOR_ID"==d.type&&("COLOR_PICKING"==a.type&&"COLOR_ID"==d.Vb||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==d.Vb)&&(c||(da.He(d,"USE_OUTLINE",0),da.Wb(d),L(d)),a.p.push({aa:!0,sb:g,o:d}))}}function Y(a,b){for(var c=ma(b,Va),h=a.cb,d=a.d,e=h.index,E=0;E<c.length;E++){var k=c[E];k.Cg.set(d.g,
3*e);k.Ag.set(h.direction,3*e);k.zg.set(h.rh,3*e);switch(h.type){case "SUN":if(k.Px.set(d.quat),k.Ox=h.rh,"SKY"===k.type){var N=Aa;N[0]=N[1]=N[2]=1;var n=Math.acos(Ua.dot(k.Am,N)),N=Math.acos(Ua.dot(h.direction,N));k.Ml=Math.floor(n/.025)!=Math.floor(N/.025)?!0:!1;Ua.copy(h.direction,k.Am);z(b,k)}else Ua.copy(h.direction,k.Am);case "HEMI":case "POINT":case "SPOT":break;default:Ha.error("unknown light type: "+h.type)}n=Na;n[0]=h.Zg?1:0;n[1]=h.Kf?1:0;k.Bg.set(n,2*e);k.Ia=!0;for(n=0;n<k.p.length;n++)N=
k.p[n].o,N.Oh&&g(N,a)}}function z(a,b){mb.Yi(b);if(b.Ml)for(var c=ma(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),g=0;g<c.length;g++)for(var h=c[g].p,d=0;d<h.length;d++){var e=h[d];e.aa&&(e=e.o,da.UA(e)&&mb.TG(e))}}function ea(b,c,g){if(!b.wa)throw"Access to uninitialized scene";b=b.wa[c];if(g==a.L)return b;c=[];for(var h=0;h<b.length;h++){var d=b[h];d.d.zd==g&&c.push(d)}return c}function la(b){var c=[];b=ea(b,"MESH",a.L);for(var g=0;g<b.length;g++)for(var h=b[g].data,d=0;d<h.materials.length;d++){var e=
h.materials[d];-1==c.indexOf(e)&&c.push(e)}return c}function ba(a,b,c){for(var g=a.d,h=a.camera.d.I,d=0;d<h.length;d++){var e=h[d];Fa.Vg(e,b/c);g.fq&&Fa.Wq(e,g.Od)}g.fq&&(g.Nl=!0,ca(a,"DEPTH").Ia=!0,ca(a,"MAIN_BLEND").Ia=!0);wa.OG(g.Cb,function(g,h,d){if(g.Ai){var e=g.Df*b,E=g.Df*c;if(h)for(h=0;h<d.ra.length;h++)d.ra[h]==g&&gb.resize(g.sa,e,E);else gb.tj(g.sa)&&gb.resize(g.sa,e,E),g=d.j,g.width=e,g.height=E,"DOF"==d.type&&ra(a,{dof_power:d.j.dof_power,dof_on:d.j.dof_on}),fa(d,1/b,1/c)}})}function fa(a,
b,c){a=a.p;for(var g=0;g<a.length;g++){var h=a[g].o;h&&da.Xj(h,b,c)}}function ma(a,b){for(var c=[],g=0;g<b.length;g++){var h=b[g];ua.U(a.d.Cb,function(a,b){b.type==h&&c.push(b)})}return c}function ca(a,b){return wa.La(a.d.Cb,b)}function ra(a,b){var c=ca(a,"DOF");if(!c)return Ha.error("DOF is not enabled on scene. Check camera settings"),0;var g=a.d.Cb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&
(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;for(var h=wa.Ab(g,c,"POSTPROCESSING"),g=wa.Ab(g,h,"POSTPROCESSING"),h=[h,g],g=0;g<h.length;g++){var d=h[g].p[0].o;d&&(da.Wg(d,c.j.dof_power),fa(h[g],1/c.j.width,1/c.j.height))}}c.Ia=!0}function sa(a,b){var c=ca(Ga,"MAIN_OPAQUE");if(!c||!c.ab)return Ha.error("get_water_surface_level() - no water parameters on this scene"),0;var g=c.Pf,h=c.fh,d=c.Of,e=c.ab;if(!g||
!e.Bh)return e.Of;var E=Ua.length(c.ik),k=c.time;E&&(k*=E);var N=Na;N[0]=20/h*(a-.25*k);N[1]=20/h*(b-.25*k);E=ya.Ms(N);N[0]=17/h*(b+.1*k);N[1]=17/h*(a+.1*k);var N=ya.Ms(N),E=E+N-1,n=e.dst_noise_scale0,N=e.dst_noise_scale1,w=e.dst_noise_freq0,q=e.dst_noise_freq1,f=Na;f[0]=n*(a+w*k);f[1]=n*(b+w*k);n=ya.zq(f);f[0]=N*(b-q*k);f[1]=N*(a-q*k);N=ya.zq(f);N*=g*n;if(c.Km)if(q=(a-c.Af[0])/c.Bf[0],f=(c.Af[1]+b)/c.Bf[1],q+=.5,f+=.5,1<q||0>q||1<f||0>f)g=N;else var q=ya.fu(Ga.d.tq,c.gi,q,f),n=e.dir_freq,C=e.dir_noise_scale,
m=e.dir_noise_freq,w=e.dir_min_noise_fac,f=e.dst_min_fac,c=h/c.Th/Math.PI,C=[C/h*(a+m*k),C/h*(b+m*k)],h=Math.sqrt(q),g=g*Math.max(q,e.dir_min_shore_fac)*Math.sin(h/c+n*k)*Math.max(ya.zq(C),w),e=Math.max(h,f),g=g*(1-e)+N*e,E=E*q;else g=N;return d+(g+.05*E)}function qa(a,b){a.qj&&"POSTPROCESSING"==a.type&&b.aa!=a.aa&&(a.aa=b.aa);b.aa||"OUTLINE"!=a.type||(a.no=0)}function V(a,b,c,g){var h=ua.qb(a,b);Fa.km(h.j,c,g);h.un=!0;ua.Jf(a,b,function(b,h,d){d.Pa&&d.N==c&&wa.dB(d)&&S(a,b,d.ha,g)});ua.Le(a,b,function(b,
h,d){d.Pa&&d.N==c&&d.N==d.ha&&V(a,b,c,g)})}function S(a,b,c,g){a=ua.qb(a,b).p;for(b=0;b<a.length;b++)da.qF(a[b].o,g,c)}function E(a){var b=ca(a,"GRASS_MAP");if(b){var c=b.j,g=a.camera.d,h=g.g;a=Aa;a[0]=0;a[1]=-b.jc[2]/2;a[2]=0;Ua.transformQuat(a,g.quat,a);a[0]+=h[0];a[1]=0;a[2]+=h[2];b=Db;b[0]=0;b[1]=0;b[2]=0;b[3]=1;Fa.ox(c,a,b)}}function N(a,b){ua.U(a,function(c,g){if("MOTION_BLUR"==g.type){if(!g.ra[0]||!g.Ud[0])throw"Wrong MOTION_BLUR subscene";var h=g.ra[0],d=g.Ud[0];g.Ud[0]=g.j.Ib;ua.Jf(a,c,function(b,
c,g){g.Pa&&S(a,b,g.ha,d)});V(a,c,h.N,d);S(a,c,h.ha,g.Ud[0]);g.Mv=Math.exp(-b/g.Kl)}})}function ha(b,c){var g=0,h=b.Tz;0==h.Lq&&(h.Lq=c);var d=c-h.Lq;if(h.Hw&&d/h.bd>=h.Hw)a.Pi(b);else{d%=h.bd;if(d<h.Xv)switch(h=d/(h.Xv/5),d=Math.floor(h),d){case 0:g=(h-d)/2;break;case 1:g=(h-d)/2+.5;break;case 2:g=1;break;case 3:g=1-(h-d)/2;break;case 4:g=.5-(h-d)/2}b.d.Jd=g}}function oa(a){ua.U(a.d.Cb,function(a,b){b.Ia=!0})}function ka(a){if("WIND"==a.field.type){a=a.d;ya.qa(a.quat,ya.Sa,va);Ua.normalize(va,va);
Ua.scale(va,a.Bo,va);a=xa;for(var b=0;b<a.length;b++)for(var c=ma(a[b],Jb),g=0;g<c.length;g++)c[g].ik.set(va)}}function Xa(a){var b=p();if(b=ca(b,"OUTLINE"))b.sf.set(a),b.Ia=!0}var da=v("__batch"),Q=v("__boundings"),Fa=v("__camera"),na=v("__config"),ta=v("__constraints"),tb=v("__data"),Da=v("__debug"),lb=v("__geometry"),ua=v("__graph"),nb=v("__hud"),Ea=v("__objects");v("__particles");var kb=v("__physics"),Ta=v("__prerender"),ab=v("__primitives"),Ha=v("__print"),mb=v("__renderer"),wa=v("__scenegraph"),
Qb=v("__sfx"),ia=v("__shaders"),gb=v("__textures"),ya=v("__util"),Ua=v("vec3"),Oa=v("mat4"),pa=na.q,Ia=na.Lb,Kb=na.he,Zb="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Lb=["ARMATURE","EMPTY","MESH","SPEAKER"],Eb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.UI=Eb;var Va="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Ca=["MAIN_OPAQUE",
"SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Jb="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),tc=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],hc=0,Ib=null,Ga=null,xa=[],Ya=null,Za=[],bb=0,$b=0,ob=1,wb=0,xb=0,rb=Math.PI/2;a.Tf=0;a.Vm=1;a.Wm=2;a.L=-1;var Na=new Float32Array(2),Aa=new Float32Array(3);new Float32Array(4);var Cb=new Float32Array(4),Db=new Float32Array(4),Ba=new Float32Array(16),
fc=new Float32Array(24),ga=new Float32Array(24),za=Q.$d(),Pa=Q.$d(),va=new Float32Array(3),Ka=null;a.iq=function(a){Ga=a;Qb.HF(a)};a.$E=function(a,b){var c=a.d,g=wa.NB(c.Cb);if(a==b){ba(a,bb,$b);for(var h=0;h<g.length;h++)a.d.Rg.push(g[h])}else for(h=a.vd[0],ba(a,h.d.Xg,h.d.Xg),h=0;h<g.length;h++)b.d.Rg.push(g[h]);g=ma(a,Jb);for(h=0;h<g.length;h++)g[h].ik.set(va);for(h=0;h<c.Rg.length;h++)"SHADOW_CAST"==c.Rg[h].type&&mb.Yi(c.Rg[h])};a.jj=d;a.wo=b;a.A=p;a.ea=function(){return Ga?!0:!1};a.kl=function(a){return a.camera};
a.jl=function(){return xa};a.GD=function(){if(1==xa.length)return xa;for(var a=[],b=0;b<xa.length;b++){var c=xa[b];if(!c.vd.length){b=ua.Yh(Ya,c);b=ua.Mx(Ya,b,ua.pr);b=ua.Nq(b);ua.U(b,function(b,c){a.push(c)});break}}return a};a.Ed=function(b,c,g,h){for(var d=xa,E=null,k=0;k<d.length;k++){var N=ea(d[k],"ALL",a.L);switch(b){case a.Tf:E=e(c,N,!1,g);break;case a.Vm:E=null;(N=e(c,N,!1,h))&&N.dupli_group&&(E=e(g,N.dupli_group.objects,!0,h));break;case a.Wm:for(var E=null,n=0;n<c.length;n++)if((E=e(c[n],
N,0!=n,g))&&E.dupli_group)N=E.dupli_group.objects;else break}if(E)break}return E};a.lA=function(a,b,c){for(var g in Lb){var h=Lb[g],d=f(a,h),e=b.d.Di,E=!1;for(g=0;g<c.length;g++)if(E=!0,c[g].d&&c[g].d.xg){for(var k=0;k<e.length;k++)e[k]==c[g]&&(E=!1);E&&e.push(c[g])}h in b.wa||(b.wa[h]=[]);for(k=0;k<d.length;k++)ya.we(d[k])&&d[k].proxy||(b.wa.ALL.push(d[k]),b.wa[h].push(d[k]))}};a.eA=function(b,g){b.wa={ALL:[]};for(var d in Zb){var e=Zb[d],E=f(b,e);b.wa[e]=[];for(var N=0;N<E.length;N++)ya.we(E[N])&&
E[N].proxy||(b.wa.ALL.push(E[N]),b.wa[e].push(E[N]))}b.vd=b.vd||[];b.d=b.d||{};e=b.d;E=b.camera.d;d=b.world.b4w_shadow_settings;N=e.Od={};d.csm_resolution>pa.Id?(N.csm_resolution=pa.Id,Ha.error("Shadow map texture has unsupported size. Changed to "+pa.Id+".")):N.csm_resolution=d.csm_resolution;N.self_shadow_polygon_offset=d.self_shadow_polygon_offset;N.self_shadow_normal_offset=d.self_shadow_normal_offset;N.enable_csm=d.b4w_enable_csm;var w=ea(b,"LAMP",a.L);if(w=aa(w)||w[0])N.np=w.cb.type,N.Rd=w.cb.Rd,
N.distance=w.cb.distance,"SPOT"!=N.np&&"POINT"!=N.np||!N.enable_csm||(Ha.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),N.enable_csm=!1);N.enable_csm?(N.csm_num=d.csm_num,N.csm_first_cascade_border=d.csm_first_cascade_border,N.first_cascade_blur_radius=d.first_cascade_blur_radius,N.csm_last_cascade_border=d.csm_last_cascade_border,N.last_cascade_blur_radius=d.last_cascade_blur_radius,N.fade_last_cascade=d.fade_last_cascade,N.blend_between_cascades=d.blend_between_cascades):
(N.csm_num=1,N.csm_first_cascade_border=d.csm_first_cascade_border,N.first_cascade_blur_radius=d.first_cascade_blur_radius,N.csm_last_cascade_border=d.csm_last_cascade_border,N.last_cascade_blur_radius=d.last_cascade_blur_radius,N.fade_last_cascade=!1,N.blend_between_cascades=!1);e.Di=[];for(d=0;d<g.length;d++)g[d].d&&g[d].d.xg&&e.Di.push(g[d]);d=b.world.b4w_fog_color;e.hc=new Float32Array([d[0],d[1],d[2],b.world.b4w_fog_density]);e.ti=t(b);e.ym=K(b,e.ti);e.jr=O(b,e.ym);e.zv=ea(b,"LAMP",a.L).length;
e.ab=x(b);e.xE=u(b);e.Ne=J(b);e.Yz=h(b);e.Tv=0;E.I[0].type!=Fa.gc&&pa.anaglyph_use?(Ha.warn("Anaglyph stereo is disabled for the non-perspective camera"),d=!1):d=pa.anaglyph_use;e.anaglyph_use=d;e.fq=pa.Vi&&l(b);e.MK=b.world.b4w_fog_color;e.fi=m(b);e.gF=y(b);e.HA=A(b);e.BE=n(b);e.RA=q(b);e.PD=c(b);e.PE=P(b);e.Ah=pa.Ah&&(0<E.dof_distance||E.kg);e.hb=F(b);e.Vh=pa.Vh&&b.b4w_enable_motion_blur;e.th=pa.th&&b.b4w_enable_color_correction;e.antialiasing=pa.antialiasing&&b.b4w_enable_antialiasing;e.oh=pa.oh&&
b.b4w_enable_bloom&&e.ti;e.Ef=pa.Ef&&b.b4w_enable_ssao;e.xG=G(b);e.Jh=pa.Jh&&b.b4w_enable_god_rays&&e.ti;e.Kd=pa.Kd&&b.b4w_render_refractions;e.iC=pa.Vi;e.mB=k(b);e.outline=B(b);d=b.vd.sort(function(a,b){return b.d.Xg-a.d.Xg});e.Cb=wa.MB(e,E,d);e.Rg=[];e.Nl=!1;e.Hp=!1;xa.push(b);Ya||(Ya=ua.create());ua.D(Ya,b)};a.Qn=f;a.Ko=function(a){return a.d.Cb};a.QC=function(a){ua.U(a,function(b,c){var g=null;switch(c.type){case "POSTPROCESSING":g=da.lt(c.Jj);break;case "SSAO":g=da.TB(c);break;case "SSAO_BLUR":g=
da.UB(c);da.Xj(g,1/c.j.width,1/c.j.height);break;case "DEPTH_PACK":g=da.DB();break;case "REFRACT":case "COPY":g=da.lt("NONE");break;case "GOD_RAYS":wa.Ab(a,c,"WIREFRAME")||wa.Ab(a,c,"MAIN_BLEND")||wa.Ab(a,c,"GOD_RAYS");g=da.FB(c.lw,c.eh,c.ri);break;case "GOD_RAYS_COMBINE":wa.Ab(a,c,"WIREFRAME")||wa.Ab(a,c,"MAIN_BLEND");wa.Ab(a,c,"GOD_RAYS");g=da.GB();break;case "MOTION_BLUR":g=da.KB(c.Jl);break;case "DOF":g=da.EB();da.Wg(g,c.j.dof_power);for(var h=wa.Ab(a,c,"POSTPROCESSING"),d=wa.Ab(a,h,"POSTPROCESSING"),
e=[h,d],E=0;E<e.length;E++){var k=e[E].p;(h=k[0].o)&&da.Wg(h,c.j.dof_power)}break;case "OUTLINE":e=wa.Ab(a,c,"POSTPROCESSING");E=wa.Ab(a,e,"POSTPROCESSING");h=wa.Ab(a,E,"POSTPROCESSING");d=wa.Ab(a,h,"POSTPROCESSING");g=da.LB();e=[E,e];for(E=0;E<e.length;E++)k=e[E].p,(k=k[0].o)&&da.Wg(k,c.Cs);e=[d,h];for(E=0;E<e.length;E++)k=e[E].p,(k=k[0].o)&&da.Wg(k,c.It*c.Sl);break;case "COMPOSITING":g=da.BB();break;case "ANTIALIASING":g=da.xB();break;case "LANCZOS":g=da.HB(c.mM);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":g=
da.RB(c.type);break;case "ANAGLYPH":g=da.vB();break;case "SKY":g=da.QB();da.Xj(g,1/c.j.width,1/c.j.height);break;case "LUMINANCE":g=da.IB();break;case "AVERAGE_LUMINANCE":g=da.yB();break;case "LUMINANCE_TRUNCED":g=da.JB();break;case "BLOOM_BLUR":g=da.zB(c.Jj);da.Xj(g,1/c.j.width,1/c.j.height);break;case "BLOOM":g=wa.Ab(a,c,"BLOOM_BLUR");e=[wa.Ab(a,g,"BLOOM_BLUR"),g];for(E=0;E<e.length;E++)k=e[E].p,(k=k[0].o)&&da.Wg(k,c.bloom_blur);g=da.AB();break;case "VELOCITY":g=da.XB();break;case "ANCHOR_VISIBILITY":g=
da.wB()}g&&(h={aa:!0,sb:Ea.Xk("NONE"),o:g},L(g),c.p.push(h),C(a,c,g),R(g))})};a.We=function(a,b,c){switch(b.type){case "MESH":var g=a.d.Cb,h=b.d;!wa.La(g,"SHADOW_CAST")&&h.Tb&&(h.Tb=!1);h=ma(a,Eb);c&&(kb.w(b)&&kb.We(b,a),a.wa.ALL.push(b),a.wa[b.type].push(b),b.za&&b.za.dupli_group.objects&&(b.origin_name=b.name,b.za.dupli_group.objects.push(b)));for(var d=0;d<h.length;d++)I(h[d],b,g,a,c);break;case "LAMP":b.cb.index=a.d.Tv++;c=ma(a,Va);for(g=0;g<c.length;g++)c[g].Kg++;Y(b,a)}};a.Iw=function(a){if(!a.d.fp)return!1;
var b=p();tb.ZE(b,a,!1);var c=b.wa.ALL.indexOf(a);-1!=c&&b.wa.ALL.splice(c,1);c=b.wa[a.type].indexOf(a);-1!=c&&b.wa[a.type].splice(c,1);a.za&&a.za.dupli_group.objects&&(c=a.za.dupli_group.objects.indexOf(a),-1!=c&&a.za.dupli_group.objects.splice(c,1));ta.XA(a)&&ta.remove(a);return!0};a.$I=I;a.hq=function(a){a.d.Nl=!0};a.mD=function(a,b){for(var c=a.d.Od,g=new Float32Array(c.csm_num),h=0;h<c.csm_num;h++)g[h]=Fa.YB(c,b,h);return g};a.nj=function(a){a.d.Kh=!0};a.uq=function(a){a.d.Kh=!1};a.hp=function(a){return a.d.Kh};
a.lF=function(a,b,c){b=b.d;a=ma(a,Eb);for(var g=0;g<a.length;g++)for(var h=a[g].p,d=h.length-1;0<=d;d--){var e=h[d];e.sb==b&&(e.o&&c&&lb.Ts(e.o.da),h.splice(d,1))}};a.Qs=function(a,b){return b.wa[a.type]&&-1<b.wa[a.type].indexOf(a)?!0:!1};a.kG=function(a){var b=a.wa.LAMP;if(b.length==a.d.Tv){for(var c=[],g=0;g<b.length;g++)c[b[g].cb.index]=g;for(g=0;g<c.length-1;g++)for(var h=g+1;h<c.length;h++){var d=b[c[g]].cb,e=b[c[h]].cb;if(e.Zg&&e.Kf&&(!d.Zg||!d.Kf)||!d.Zg&&(e.Zg||!d.Kf&&e.Kf))d=c[g],c[g]=c[h],
c[h]=d}for(g=0;g<c.length;g++)b[c[g]].cb.index=g,Y(b[c[g]],a)}};a.$G=Y;a.Y=function(){for(var a=0;a<xa.length;a++){var b=xa[a];ua.U(b.d.Cb,function(a,b){if("SINK"!=b.type){var c=b.j;mb.nF(c.re,c.Ib,c.Yc,c.width,c.height);for(var c=b.p,g=0;g<c.length;g++){var h=c[g].o;h&&da.lB(h)}}});b.d.Cb=[];b.d.Rg=[]}Ga=Ib=null;xa.length=0;Ya=null;Za.length=0;va[0]=0;va[1]=0;va[2]=0};a.Jv=function(a,b,c){a=Fa.BC(a,a.Wa,a.ib,null,!0);var g=ab.VC(a);a=Ea.Xk("DYNAMIC");a.fb=a.Yb={max_x:1E12,min_x:-1E12,max_y:1E12,
min_y:-1E12,max_z:1E12,min_z:-1E12};a.Hb=a.gd=Q.FA();var h=a.Hb.Ea;a.bg=a.ag=Q.Un([h,0,0],[0,h,0],[0,0,h],a.Hb.F);c=da.PB(g,c);b.p.push({aa:!0,sb:a,o:c})};a.Bb=ea;a.xL=function(a){return[a.frame_start,a.frame_end]};a.rx=function(a,b,c,g,h){bb=a;$b=b;ob=c;wb=h;xb=g;Ga&&ba(Ga,a,b)};a.Xj=fa;a.DG=ma;a.la=ca;a.ou=function(a){a=ma(a,Va)[0];var b=a.jf,c=a.Rf,g=[],h=[];g[0]=b[0];g[1]=b[1];g[2]=b[2];h[0]=c[0];h[1]=c[1];h[2]=c[2];return[a.df,g,h]};a.bx=function(a,b,c,g){a=ma(a,Va);for(var h=0;h<a.length;h++){var d=
a[h];isNaN(b)||(d.df=b);c&&d.jf.set(c);g&&d.Rf.set(g);d.Ia=!0}};a.Hu=function(a){if(a=ca(a,"SKY")){var b={};b.color=Array(3);Ua.copy(a.hi,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;
b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.ix=function(a,b){var c=ca(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.hi.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&
(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=
b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.Ia=!0,c.Ml=!0,z(a,c))};a.tu=function(a,b){var c=b||[],g=ma(a,Ca)[0].hc;c[0]=g[0];c[1]=g[1];c[2]=g[2];c[3]=g[3];return c};a.dx=function(a,b){for(var c=ma(a,Ca),g=0;g<c.length;g++){var h=c[g];h.hc.set(b);h.Ia=!0}};a.Ju=function(a){var b=ca(a,"SSAO");a=ca(a,"SSAO_BLUR");if(!b)return null;var c=b.p[0].o,g={};g.ssao_quality=da.Ho(c,"SSAO_QUALITY")[1];g.ssao_hemisphere=b.ssao_hemisphere;g.ssao_blur_depth=
a.ssao_blur_depth;g.Bs=a.ssao_blur_discard_value;g.radius_increase=b.oi;g.influence=b.ni;g.dist_factor=b.mi;g.ssao_only=b.ssao_only;g.ssao_white=da.Ho(c,"SSAO_WHITE")[1];return g};a.kx=function(a,b){var c=ca(a,"SSAO"),g=ca(a,"SSAO_BLUR");if(!c)return Ha.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var h=c.p[0].o;da.He(h,"SSAO_QUALITY",b.ssao_quality);da.Wb(h,!0)}"number"==typeof b.ssao_hemisphere&&(h=c.p[0].o,da.He(h,"SSAO_HEMISPHERE",b.ssao_hemisphere),da.Wb(h,!0));
"number"==typeof b.ssao_blur_depth&&(h=g.p[0].o,da.He(h,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),da.Wb(h,!0));"number"==typeof b.ssao_blur_discard_value&&(g.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.oi&&(c.oi=b.oi);"number"==typeof b.ni&&(c.ni=b.ni);"number"==typeof b.mi&&(c.mi=b.mi);if("number"==typeof b.ssao_only){c=ca(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var d=0;d<c.p.length;d++)h=c.p[d].o,da.He(h,"SSAO_ONLY",b.ssao_only),da.Wb(h,!0)}"number"==typeof b.ssao_white&&
(h=c.p[0].o,da.He(h,"SSAO_WHITE",b.ssao_white),da.Wb(h,!0));c.Ia=!0;g.Ia=!0};a.lu=function(a){a=ca(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;return b};a.ax=ra;a.uu=function(a){var b=ma(a,["GOD_RAYS"]);a=ca(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].Sh;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=da.Ho(b[0].p[0].o,"STEPS_PER_PASS")[1];return c};
a.ex=function(a,b){var c=ma(a,["GOD_RAYS"]),g=ca(a,"GOD_RAYS_COMBINE");if(!c||!g)return Ha.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(g.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var h=b.god_rays_max_ray_length,d=0;d<c.length;d++)c[d].Sh=h,c[d].fm=h/c[d].ri/(d+1),c[d].Ia=!0;if("number"==typeof b.god_rays_steps)for(var e=ia.O(b.god_rays_steps,1),h=c[0].Sh,d=0;d<c.length;d++){c[d].ri=e;c[d].fm=h/e/(d+1);c[d].Ia=
!0;var E=c[d].p[0].o;da.He(E,"STEPS_PER_PASS",e);da.Wb(E,!0)}g.Ia=!0};a.hu=function(a){var b=ca(a,["LUMINANCE_TRUNCED"]);a=ca(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.Tw=function(a,b){var c=ca(a,"LUMINANCE_TRUNCED"),g=ca(a,"BLOOM");if(!c||!g)return Ha.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.Ia=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=
b.bloom_edge_lum,c.Ia=!0);if("number"==typeof b.bloom_blur)for(var h=a.d.Cb,c=wa.Ab(h,g,"BLOOM_BLUR"),h=wa.Ab(h,c,"BLOOM_BLUR"),c=[c,h],h=0;h<c.length;h++){var d=c[h].p[0].o;d&&(da.Wg(d,b.bloom_blur),fa(c[h],1/g.j.width,1/g.j.height))}};a.Tu=function(){var a=va,b=Ua.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.qx=function(b,c){for(var g=ea(b,"ALL",a.L),h=0;h<g.length;h++){var d=g[h];if("EMPTY"===d.type&&d.field&&"WIND"===d.field.type)var e=
d}if(!e)return Ha.error("There is no wind on the scene"),0;g=e.d;"number"==typeof c.wind_dir&&(Aa=[0,c.wind_dir/180*Math.PI,-Math.PI/2],ya.ef(Aa,Db),g.quat.set(Db),ka(e));"number"==typeof c.wind_strength&&(g.Bo=c.wind_strength,ka(e));oa(b)};a.CF=function(a){a.d.Hp=!0};a.Ru=sa;a.Qu=function(a,b){var c=ca(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.Pf,b.waves_length=c.fh,c.qd)){b.water_fog_density=c.qd[3];var g=b.water_fog_color=[];g[0]=c.qd[0];g[1]=c.qd[1];g[2]=c.qd[2]}};a.px=function(a,b){var c=ca(a,
"MAIN_OPAQUE");if(!c||!c.ab)return Ha.error("set_water_params() - no water parameters on this scene"),null;c=c.ab;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==
typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Bh=b.water_dynamic);for(var g=ma(a,tc),h=0;h<g.length;h++){var d=g[h];
"number"==typeof b.water_fog_density&&c.hc&&(d.qd[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.hc&&d.qd.set(b.water_fog_color);"number"==typeof b.waves_height&&(d.Pf=b.waves_height);"number"==typeof b.waves_length&&(d.fh=b.waves_length);d.Ia=!0}};a.Fu=function(a,b){var c=ca(Ga,"MAIN_OPAQUE");if(!c.Km)return 100;var g=c.Th,h=c.Of,d=(a[0]-c.Af[0])/c.Bf[0],e=(c.Af[1]+a[2])/c.Bf[1],d=d+.5,e=e+.5;if(1<d||0>d||1<e||0>e)h=1;else return c=g*ya.fu(Ga.d.tq,c.gi,d,e),h=(h-a[1])*b,h=Math.sqrt(c*
c+h*h)};a.update=function(a,b){for(var c=p().camera.d,g=0;g<xa.length;g++){var h=xa[g],d=h.d.Cb;if(h.d.ab)var e=c.g[1]-sa(c.g[0],c.g[2]);for(var k=h.d.Di,n=0;n<k.length;n++){var w=k[n].d,q=w.Oa,f=w.Eh+w.Ha;if(q){var C=Math.round(q.currentTime*w.ic),m=w.Ha/w.ic;if(C<w.Ha-(pa.wg?5:0)||k[n].d.Yg&&C>f)q.currentTime=m;!w.Yg&&C>f&&q.pause();2<=q.readyState&&!q.paused&&gb.jH(w)}else if(w.di){q=Math.min(w.di.length,w.Eh+w.Ha);if(w.Ge<w.Ha||w.Yg&&w.Ge>=q)w.Ge=w.Ha;!w.Yg&&w.Ge>=q&&(w.ei=!1);q=Math.round(a*
Kb.Ma/w.ic)*w.Sw;q!=hc&&w.ei&&(gb.gH(w),w.Ge++);hc=q}}ua.U(d,function(b,c){-1<Jb.indexOf(c.type)&&(c.time=a);h.d.ab&&(c.Hn=e)})}for(g=0;g<xa.length;g++)if(h=xa[g],n=h.d,c=n.Rg,n.Nl&&(Z(h),n.Nl=!1),n.Hp&&(E(h),n.Hp=!1),c.length){h.b4w_enable_motion_blur&&N(n.Cb,b);if(n.outline){for(var l=0,g=0;g<h.wa.MESH.length;g++)n=h.wa.MESH[g],l+=n.d.Jd,-1!=Za.indexOf(n)&&ha(n,a);ua.U(h.d.Cb,function(a,b){"OUTLINE"===b.type&&(b.no=l)})}d=null;for(n=0;n<c.length;n++)"OUTLINE_MASK"==c[n].type&&(d=n);for(n=0;n<c.length;n++)k=
c[n],Ta.Up(k),null!==d&&qa(k,c[d]),mb.Yi(k)}pa.show_hud_debug_info&&nb.fG(xa,b)};a.Go=function(a){var b=[];ua.U(a.d.Cb,function(a,c){b.push(c)});return b};a.nh=function(a,b,c,g){a.Tz={Lq:0,Xv:b,bd:c,Hw:g};-1==Za.indexOf(a)&&Za.push(a)};a.Pi=function(a){a.d.Jd=0;a=Za.indexOf(a);-1!=a&&Za.splice(a,1)};a.VJ=function(){Za=[]};a.iu=function(){var a=ca(Ga,"MAIN_BLEND"),b=Ga;return a||b.d.ab?a.Hn:null};a.xu=function(a){return a.d.zd};a.cy=oa;a.bG=function(a,b){switch(b){case "WM_NONE":a.aa=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=
0;c<a.p.length;c++)a.p[c].o.wireframe_mode=Da.Sr[b];a.aa=!0}a.Ka="WM_TRANSPARENT_WIREFRAME"==b;a.Ia=!0};a.aG=function(a,b){for(var c=0;c<a.p.length;c++)a.p[c].o.wireframe_edge_color=b,a.Ia=!0};a.$r=function(a,b){for(var c=0;c<b.length;c++)a.wa.ALL.push(b[c]),a.wa.MESH.push(b[c])};a.by=ka;a.bm=function(b,c){var g=d();if(!g)return Ha.error("No active scene"),null;var h=ca(g,"COLOR_PICKING");if(h){b-=xb;c-=wb;b*=ob;c*=ob;Ta.Up(h);mb.Yi(h);var e=ca(g,"COLOR_PICKING_XRAY");e?(Ta.Up(e),mb.Yi(e),h=e.j):
h=h.j;c=h.height-c;for(var E=mb.Fw(h.re,b,c),h=ea(g,"MESH",a.L),e=0;e<h.length;e++){var k=h[e].d,N=k.Tk;if(N&&3>Math.abs(255*N[0]-E[0])&&3>Math.abs(255*N[1]-E[1])&&3>Math.abs(255*N[2]-E[2]))return k.Lb&&k.Wv&&(Ia.outlining_overview_mode?(Xa(Ia.sf),k.Jd=Ia.Jd,a.nh(h[e],Ia.Rl,Ia.Tl,Ia.Ul)):(Xa(g.world.b4w_outline_color),k.Jd=g.world.b4w_outline_factor,g=k.Cj,a.nh(h[e],g.Rl,g.Tl,g.Ul))),h[e]}}else Ha.error("Color picking is not available");return null};a.oq=Xa;a.OD=function(){return va};a.HD=function(b){var c=
[];b=ea(b,"MESH",a.L);for(var g=0;g<b.length;g++){var h=b[g];h.d.Ug&&c.push(h)}return c};a.kj=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.aO=function(){for(var b=Ga,c=ea(b,"MESH",a.L),g=0;g<c.length;g++)for(var h=c[g].n,d=0;d<h.length;d++){var e=h[d];if("MAIN"==e.type||"NODES"==e.type)M(b,e),da.Wb(e)}};a.Ou=function(){return ob}};b4w.module.__batch=function(a,v){function d(a){a={type:a,Vb:"",id:0,mF:0,Zh:"",X:[],ed:[],Qh:[],gg:[],bh:null,nb:{},tc:null,ub:null,ts:[],Hc:null,da:null,Wc:null,Wd:!1,yh:!1,ut:!1,wireframe_mode:0,Mp:0,yj:0,vv:0,wv:0,Uu:0,Ro:0,jc:new Float32Array(3),Ac:new Float32Array(16),Ka:!1,$s:!1,Z:!1,Ne:!1,Fa:!1,ah:!1,Ad:!1,Mc:!1,uc:!1,Tb:!1,ec:!1,Sb:!1,md:!1,hb:!1,ww:!1,cf:Z.Gi,Oe:Z.ee,yi:0,Kq:new Float32Array(2),t:new Float32Array(2),ng:!1,Wp:"",IN:"",Vu:!1,Zu:0,Wu:0,$u:0,av:0,Yu:new Float32Array(3),Xu:new Float32Array(3),
sg:!1,kh:0,Ch:0,Xi:1,gm:0,Cx:0,ji:1,Xl:0,Wi:0,Ki:1,Sv:0,Ep:0,Lg:0,Gw:0,oe:Array(2),ki:new Float32Array(3),Hf:new Float32Array(3),Yj:new Float32Array(3),Zc:new Float32Array(4),qg:new Float32Array(4),Oh:null,mp:null,kp:null,jp:null,lp:null,eh:!1,water_dynamic:!1,oy:!1,my:!1,ny:0,py:0,ly:0,Om:.1,rm:0,vm:0,hl:0,Qt:new Float32Array(2),Pt:new Float32Array(2),zo:new Float32Array(2),qm:new Float32Array(3),um:new Float32Array(3),Ig:null,Zp:!1,gw:0,cw:0,Np:0,fw:0,iw:0,hw:0,dw:0,ew:0,Op:0,$v:0,Zv:0,kw:0,bw:0,
Vl:new Float32Array(3),jw:new Float32Array(8),aw:new Float32Array(16)};a.Zc[3]=1;a.$s=!0;a.Z=!0;a.yi=1;return a}function b(a){switch(a.type){case "MAIN":case "NODES":case "PARTICLES":a.Vb=a.Ka?a.Ne?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.Vb="DEPTH";break;case "COLOR_ID":a.Vb=a.Ne?"COLOR_ID_XRAY":"COLOR_ID"}}function p(a,b){for(var c=[],g=la.La(b,"SHADOW_CAST"),h=la.La(b,"MAIN_REFLECT"),d=la.La(b,"OUTLINE_MASK"),k=la.La(b,"COLOR_PICKING"),n=0;n<a.n.length;n++){var w=a.n[n],q=null;"DEPTH"==w.type&&
g&&w.Mc&&(q=e(w),q.Vb="SHADOW_CAST");"MAIN"!=w.type&&"NODES"!=w.type&&"PARTICLES"!=w.type||!h||w.Ka||!w.ec||(q=e(w),q.Vb="REFLECT");"COLOR_ID"==w.type&&(d&&k?(q=e(w),q.Vb="OUTLINE"):d&&!k&&(w.Vb="OUTLINE"));q&&(q.ng=!0,C(q,a.d.id),c.push(q))}a.n.push.apply(a.n,c)}function e(a){var b=a.da,c=a.Hc;a.da=null;a.Hc=null;var g=T.uB(a);a.da=b;g.da=b;a.Hc=c;g.Hc=c;return g}function f(a,b,c){for(var g=[],h=0;h<a.length;h++){var d=a[h],e=d.d,k=t(d.data.b4w_bounding_box),n=d.data.b4w_bounding_cylinder_radius,
w=d.data.b4w_bounding_sphere_radius,q=d.data.b4w_bounding_sphere_center,f=d.data.b4w_bounding_ellipsoid_axes,C=d.data.b4w_bounding_ellipsoid_center;if(e.ke){var w=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),n=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),m=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),m=Math.sqrt(w*w+n*n+m*m),w=Math.sqrt(w*w+n*n);k.max_x=k.max_y=k.max_z=m;k.min_x=k.min_y=k.min_z=-m;n=w;w=m;q[0]=q[1]=q[2]=0;f[0]=f[1]=f[2]=m;C[0]=C[1]=C[2]=0}e.Yb=k;m=M.Cn(k,e.V);e.fb=m;var m=e,I=
n;m.yn=M.ft(I,k);m.wn=M.dt(n,k);m.xn=M.et(I,k);q=M.Vn(w,q);e.gd=q;q=M.En(q,e.V);e.Hb=q;f=M.Un([f[0],0,0],[0,f[1],0],[0,0,f[2]],C);e.ag=f;f=M.Dn(f,e.Fb);e.bg=f;g=g.concat(l(d,e,b,c))}return g}function r(a,b,c,g){for(var d=[],e=[],k={},n=0;n<a.length;n++){var w=a[n],q=w.d,f=t(w.data.b4w_bounding_box),m=M.Cn(f,q.V),I=M.Vn(w.data.b4w_bounding_sphere_radius,w.data.b4w_bounding_sphere_center),H=M.En(I,q.V),r=w.data.b4w_bounding_ellipsoid_axes,r=M.Un([r[0],0,0],[0,r[1],0],[0,0,r[2]],w.data.b4w_bounding_ellipsoid_center),
V=M.Dn(r,q.Fb);q.Yb=f;q.fb=m;q.gd=I;q.Hb=H;q.ag=r;q.bg=V;f={};f.Mc=q.Mc;f.uc=q.uc;f.Tb=q.Tb;f.Ug=q.Ug;f.Ql=q.Ql;f.Lb=q.Lb;f.Pl=q.Pl;f.Cj=q.Cj;f.ec=q.ec;f.Sb=q.Sb;f.md=q.md;f.cg=q.cg;f.Yd=q.Yd;f.Ae=q.Ae;f.Ob=q.Ob;f.ke=q.ke;f.Mi=q.Mi;f.hb=q.hb;f.zh=q.zh;f.bl=q.bl;f.pf=q.pf;f.Hg=q.Hg;f.Hl=q.Hl;f.Gd=q.Gd;f.Gg=q.Gg;f.Il=q.Il;f.Ad=q.Ad;m=q.Hb.F;f.QD=0==c?[0,0]:[Math.floor(m[0]/c),Math.floor(m[2]/c)];f.nf=q.nf;f.wj=q.wj;f.Fg=q.Fg;q=JSON.stringify(f);k[q]=k[q]||[];k[q].push(w)}for(var y in k){f=JSON.parse(y);
c=k[y];var w=T.Xk("STATIC"),x;for(x in f)w[x]=f[x];w.zd=a[0].d.zd;w.Zd=0;w.Qf=0;w.af=0;w.$e=0;w.Xe=0;w.Kh=!1;for(n=0;n<c.length;n++)q=c[n],0==n?(w.fb=ca.Ba(q.d.fb),w.Hb=ca.Ba(q.d.Hb),w.ag=ca.Ba(q.d.ag),w.bg=ca.Ba(q.d.bg)):(M.Ft(w.fb,q.d.fb),M.xC(w.Hb,q.d.Hb));w.Yb=ca.Ba(w.fb);w.gd=ca.Ba(w.Hb);e.push({fc:w,Be:c})}for(a=0;a<e.length;a++)for(k=e[a].fc,n=e[a].Be,y=0;y<n.length;y++){x=n[y];c=l(x,k,b,g);w=h(x.d)||h(k);q={};k.Yd&&(q.au_center_pos=[w[0],w[1],w[2]],q.au_wind_bending_amp=[x.d.Zd],q.au_wind_bending_freq=
[x.b4w_wind_bending_freq],q.au_detail_bending_amp=[x.b4w_detail_bending_amp],q.au_detail_bending_freq=[x.b4w_detail_bending_freq],q.au_branch_bending_amp=[x.b4w_branch_bending_amp]);for(f=0;f<c.length;f++)H=c[f].fc,m=c[f].Oc,I=c[f].o,H.Bl?H.ke?Z.AG(m,w):Z.Nx(m,w):("COLOR_ID"==I.type&&(H=c[f].fc=x.d,I.Zh=x.uuid,O(I,H),C(I,ca.ph(H,0))),m=Z.Nx(m,w),Z.zG(m,q));d=d.concat(c)}return d}function l(a,b,c,g){for(var h=[],e=m(c,b),n=ca.ph(b,0),q=a.data,w=q.materials,f=0;f<e.length;f++){var l=e[f];if(!a.b4w_do_not_render||
"PHYSICS"==l)for(var I=0;I<w.length;I++){var H=w[I];if(("LENS_FLARES"!=H.name||0!=g)&&!Z.dv(q,I)){var r=d(l);if(x(r,H,!0)){r.cf=b.Wd||b.Ad?Z.pk:Z.Gi;O(r,b);for(var t=r,M=a.particle_systems,V=0;V<M.length;V++){var y=M[V].settings.b4w_vcol_from_name,A=M[V].settings.b4w_vcol_to_name;""!==y&&""!==A&&(t.nb[y]={rg:!1,src:[{name:y,$c:7}]})}"DYNAMIC"==b.type&&(r.Zh=a.uuid);C(r,n);t=Z.Lt(q,I,r.gg,r.Wc,r.nb,r.bh);"LENS_FLARES"==H.name&&(t=Y.YE(t));h.push({o:r,Oc:t,ad:[H.name],fc:b,nd:[a]})}}}}e=a.particle_systems;
if(0<e.length&&h.length){g=!0;for(f=0;f<e.length;f++)if(e[f].settings.use_render_emitter){g=!1;break}f=h[0].o;e=h[0].Oc;q=[];w=a.particle_systems;l=a.data;for(I=0;I<w.length;I++)if(H=w[I],r=H.settings,r.count)if("EMITTER"==r.type){if("DYNAMIC"==b.type){t=d("PARTICLES");M=l.materials;V=H.settings.material-1;V>=M.length&&(R.warn('Wrong material used for rendering particle system "'+H.name+'"'),V=0);M=M[V];"HALO"===H.settings.render_type&&(t.sg=!0);x(t,M);O(t,b);V=t;y=H;switch(y.settings.b4w_billboard_align){case "VIEW":k(V,
"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":k(V,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":k(V,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":k(V,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}k(V,"BILLBOARD",0);ba.u(V.ub,"WORLD_SPACE","WORLD"==y.settings.b4w_coordinate_system?1:0);t.Ad=!0;t.Zh=a.name+"_"+r.uuid;t.Wp=H.name;C(t,n);t.Hc=H;r=Y.UC(t,l,H,a.d.Fb);Y.KF(t,H,M);q.push({o:t,Oc:r,ad:[M.name],fc:b,nd:[a]})}}else if("HAIR"==
r.type){t=ca.wl(H.seed);r.b4w_dynamic_grass&&(b.zh=!0);if(H.transforms.length)var B=H.transforms;else for(var M=Z.Fo(e,r.count,!1,t),B=new Float32Array(4*M.length),p=0;p<M.length;p++)V=.75+.5*ca.cd(t),B[4*p]=M[p][0],B[4*p+1]=M[p][1],B[4*p+2]=M[p][2],B[4*p+3]=V;M=la.La(c,"GRASS_MAP")?!0:!1;if("OBJECT"==r.render_type)V=[m(c,r.dupli_object.d,!0)],H=J(a,b,f,e,[r.dupli_object],V,[B],r,H,M,t,!1),q=q.concat(H);else if("GROUP"==r.render_type){y=r.dupli_group.objects;A=!1;V=[];for(p=0;p<y.length;p++){var u=
m(c,r.dupli_group.objects[p].d,!0);V.push(u)}if(r.use_whole_group){A=B;B=y;p={};for(u=0;u<A.length;u+=4)for(var L=0;L<B.length;L++){var S=ra.create();ra.scale(B[L].d.g,B[L].d.scale,S);var F=ra.clone([A[u],A[u+1],A[u+2]]);ra.add(F,S,F);p[L]||(p[L]=new Float32Array(A.length));p[L][u]=F[0];p[L][u+1]=F[1];p[L][u+2]=F[2];p[L][u+3]=A[u+3]}B=p;A=!0}else if(r.use_group_count){for(var F=y,z=r.dupli_weights,p=t,u={},L=[],S=0;S<F.length;S++)for(var G=F[S],G=G.origin_name||G.name,K=0;K<z.length;K++){var P=z[K];
G==P.name.split(": ")[0]&&L.push(P)}z.length!=L.length&&R.error("dupli weights match failed");for(S=0;S<B.length;S+=4){var v,z=L;v=[0];for(F=0;F<z.length;F++)v[F+1]=v[F]+z[F].count;z=v[v.length-1]*ca.cd(p);for(F=G=0;F<v.length;F++)if(z>=v[F]&&z<v[F+1]){G=F;break}v=G;u[v]=u[v]||[];u[v].push(B[S],B[S+1],B[S+2],B[S+3])}for(v in u)u[v]=new Float32Array(u[v]);B=u}else{p=t;u=y.length;L={};for(S=0;S<B.length;S+=4){var U=Math.floor(u*ca.cd(p));L[U]=L[U]||[];L[U].push(B[S],B[S+1],B[S+2],B[S+3])}for(U in L)L[U]=
new Float32Array(L[U]);B=L}H=J(a,b,f,e,y,V,B,r,H,M,t,A);q=q.concat(H)}"INSTANCE"==r.b4w_wind_bend_inheritance&&(a.d.Zd=0)}else throw"Unknown particle settings type";a=q;h=g?a:h.concat(a)}return h}function t(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function m(a,b,c){var g=["MAIN","NODES"];(b.Ug&&la.La(a,"COLOR_PICKING")||b.Lb&&la.La(a,"OUTLINE_MASK"))&&!c&&g.push("COLOR_ID");la.La(a,"WIREFRAME")&&g.push("WIREFRAME");g.push("PHYSICS");(la.La(a,"DEPTH")||
la.La(a,"SHADOW_CAST"))&&g.push("DEPTH");la.La(a,"GRASS_MAP")&&g.push("GRASS_MAP");if(b.uc||b.Sb)for(a=null,b.uc&&(a=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]),b.Sb&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?ca.vA(a,b):b),b=a,a=0;a<b.length;a++)c=g.indexOf(b[a]),-1!==c&&g.splice(c,1);return g}function x(a,b,g){var h,d;switch(a.type){case "MAIN":if(b.b4w_do_not_render||b.use_nodes)a=!1;else{y(a,b);var e=b.game_settings.alpha_blend;a.Ne=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=
e;a.Lg=b.offset_z;a.Hf.set([1,1,1]);var f=b.texture_slots;sa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Zc);switch(b.name){case "LENS_FLARES":H(a,"special_lens_flares.glslv","special_lens_flares.glslf");F(a,"a_position");F(a,"a_texcoord");var C=g?[1,1,1,0]:null,C=K(f[0],C);w(a,C);break;default:H(a,"main.glslv","main.glslf");var m=G("use_map_color_diffuse",f),I=G("use_map_color_spec",f),l=G("use_map_normal",f),r=G("use_map_mirror",f),t=G("use_stencil",f),e=m[0],I=I[0],l=
l[0],r=r[0],m=m[1],f=t[0]&&G("use_rgb_to_intensity",f)[0];if(e){switch(e.blend_type){case "MIX":k(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":k(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}C="IMAGE"==e.texture.d.source&&g?[a.Zc[0],a.Zc[1],a.Zc[2],1]:"ENVIRONMENT_MAP"==e.texture.d.source&&g?[.8,.8,.8,1]:null;C=K(e,C);w(a,C,"u_colormap0");a.Wi=e.diffuse_color_factor;a.Ki=e.use_map_alpha?e.alpha_factor:0;a.Hf.set(e.scale)}t=e&&e==I;I&&(t||(C=g?[.5,.5,.5,1]:null,C=
K(I,C),w(a,C,"u_specmap0")),a.Cx=I.specular_color_factor);if(l){F(a,"a_normal");F(a,"a_tangent");C=g?[.5,.5,1,1]:null;C=K(l,C);w(a,C,"u_normalmap0");a.Sv=l.normal_factor;var M=l.texture;if(M.b4w_use_map_parallax&&V.Ej){var C=ba.O(M.b4w_parallax_steps),x=ba.O(M.b4w_parallax_lod_dist);k(a,"PARALLAX",1);k(a,"PARALLAX_STEPS",C);k(a,"PARALLAX_LOD_DIST",x);a.Xl=M.b4w_parallax_scale}}r&&(C=g?[0,0,.5,1]:null,C=K(r,C),w(a,C,"u_mirrormap"),a.Ep=r.mirror_factor);if(M=e&&m&&f?1:0)C=g?[.8,.8,.8,1]:null,C=K(m,
C),w(a,C,"u_colormap1"),C=g?[.5,.5,.5,1]:null,C=K(f,C),w(a,C,"u_stencil0");(g=e||I||l)&&a.Hf.set(g.scale);k(a,"TEXTURE_SPEC",void 0==I?0:1);k(a,"TEXTURE_MIRROR",void 0==r?0:1);k(a,"ALPHA_AS_SPEC",t?1:0);k(a,"TEXTURE_STENCIL_ALPHA_MASK",M);F(a,"a_position");F(a,"a_normal");(e||I||l)&&F(a,"a_texcoord");if(b.b4w_water){a.eh=!0;a.oy=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;g=b.texture_slots;H(a,"special_water.glslv","special_water.glslf");F(a,"a_position");F(a,"a_texcoord");F(a,
"a_normal");F(a,"a_tangent");V.qy?(F(a,"a_polyindex"),a.Z=!0,a.wireframe_edge_color=[0,0,0],k(a,"DEBUG_WIREFRAME",1)):k(a,"DEBUG_WIREFRAME",0);t=G("use_map_normal",g);r=G("use_map_mirror",g)[0];t.length&&(M=K(t[0]),w(a,M,"u_normalmap0"),a.Om=b.b4w_water_norm_uv_velocity);k(a,"NUM_NORMALMAPS",t.length);a.Ig=Array(t.length);for(M=0;M<t.length;M++)a.Ig[M]=new Float32Array(2),a.Ig[M].set([t[M].scale[0],t[M].scale[1]]);r?(k(a,"TEXTURE_MIRROR",1),t=K(r),w(a,t,"u_mirrormap"),a.Ep=r.mirror_factor):k(a,"TEXTURE_MIRROR",
0);r=null;for(M=0;M<g.length;M++)if(h=g[M],!0===h.texture.b4w_water_foam){r=h;break}r&&V.cj?(k(a,"FOAM",1),t=K(r),w(a,t,"u_foam"),a.hl=b.b4w_foam_factor,a.Qt.set(r.texture.b4w_foam_uv_freq),a.Pt.set(r.texture.b4w_foam_uv_magnitude),a.zo[0]=r.scale[0],a.zo[1]=r.scale[1]):k(a,"FOAM",0);for(M=0;M<g.length;M++)if(h=g[M],!0===h.texture.b4w_shore_dist_map){d=h;break}d&&V.hn?(d=K(d),w(a,d,"u_shore_dist_map"),k(a,"SHORE_PARAMS",1),d=h.texture.b4w_shore_boundings,k(a,"MAX_SHORE_DIST",ba.O(h.texture.b4w_max_shore_dist)),
k(a,"SHORE_MAP_SIZE_X",ba.O(d[0]-d[1])),k(a,"SHORE_MAP_SIZE_Y",ba.O(d[2]-d[3])),k(a,"SHORE_MAP_CENTER_X",ba.O((d[0]+d[1])/2)),k(a,"SHORE_MAP_CENTER_Y",ba.O((d[2]+d[3])/2))):k(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&V.Vi?(k(a,"GENERATED_MESH",1),a.my=!0,a.ny=b.b4w_water_num_cascads,a.py=b.b4w_water_subdivs,a.ly=b.b4w_water_detailed_dist):k(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){h=ba.O(b.b4w_water_dst_noise_scale0);d=ba.O(b.b4w_water_dst_noise_scale1);g=ba.O(b.b4w_water_dst_noise_freq0);var r=
ba.O(b.b4w_water_dst_noise_freq1),t=ba.O(b.b4w_water_dir_min_shore_fac),M=ba.O(b.b4w_water_dir_freq),C=ba.O(b.b4w_water_dir_noise_scale),x=ba.O(b.b4w_water_dir_noise_freq),B=ba.O(b.b4w_water_dir_min_noise_fac),p=ba.O(b.b4w_water_dst_min_fac),J=ba.O(b.b4w_water_waves_hor_fac);k(a,"DST_NOISE_SCALE_0",h);k(a,"DST_NOISE_SCALE_1",d);k(a,"DST_NOISE_FREQ_0",g);k(a,"DST_NOISE_FREQ_1",r);k(a,"DIR_MIN_SHR_FAC",t);k(a,"DIR_FREQ",M);k(a,"DIR_NOISE_SCALE",C);k(a,"DIR_NOISE_FREQ",x);k(a,"DIR_MIN_NOISE_FAC",B);
k(a,"DST_MIN_FAC",p);k(a,"WAVES_HOR_FAC",J)}n(a,b);q(a,b);a.qm.set(b.b4w_shallow_water_col);a.um.set(b.b4w_shore_water_col);a.rm=b.b4w_shallow_water_col_fac;a.vm=b.b4w_shore_water_col_fac;k(a,"ABSORB",ba.O(b.b4w_water_absorb_factor));k(a,"SSS_STRENGTH",ba.O(b.b4w_water_sss_strength));k(a,"SSS_WIDTH",ba.O(b.b4w_water_sss_width));h=a.ub;d=a.gg;a.ub=h;a.gg=d}"HALO"===b.type&&(h=b.halo,H(a,"halo.glslv","halo.glslf"),k(a,"NUM_RINGS",h.ring_count),k(a,"NUM_LINES",h.line_count),k(a,"NUM_STARS",h.star_tip_count),
k(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.gg=["a_position"],a.Zu=h.size,a.Wu=h.hardness/20,a.Yu.set(h.b4w_halo_rings_color),a.Xu.set(h.b4w_halo_lines_color),a.$u=1/b.b4w_halo_stars_blend_height,a.av=b.b4w_halo_stars_min_height,a.Vu=!0);k(a,"TEXCOORD",0);k(a,"NORMAL_TEXCOORD",0);e&&u(a,e,"TEXTURE_COLOR0_CO");m&&u(a,m,"TEXTURE_COLOR1_CO");f&&u(a,f,"TEXTURE_STENCIL_ALPHA_MASK_CO");I&&u(a,I,"TEXTURE_SPEC_CO");l&&u(a,l,"TEXTURE_NORM_CO");k(a,"SHADELESS",b.use_shadeless?1:0);a.ah=b.use_shadeless}e=b.game_settings.alpha_blend;
k(a,"ALPHA","OPAQUE"===e?0:1);k(a,"ALPHA_CLIP","CLIP"===e?1:0);k(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(k(a,"VERTEX_COLOR",1),F(a,"a_color")):k(a,"VERTEX_COLOR",0);a.kh=b.ambient;a.Xi=b.diffuse_intensity;a.Ch=b.emit;a.Yj.set(b.specular_color);a.ji=b.specular_alpha;n(a,b);q(a,b);b.b4w_wettable?k(a,"WETTABLE",1):k(a,"WETTABLE",0);A(a,b);a.Zp=b.b4w_refractive;a.Gw=b.b4w_refr_bump;a=!0}break;case "NODES":a=c(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||
b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(y(a,b),a.Ka)a=!1;else{H(a,"depth.glslv","depth.glslf");F(a,"a_position");F(a,"a_normal");e=b.game_settings.alpha_blend;k(a,"ALPHA","OPAQUE"===e?0:1);a.Hf.set([1,1,1]);if((b=G("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===e){a.Hf.set(b.scale);k(a,"TEXTURE_COLOR",1);F(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)e=K(b),w(a,e,"u_colormap0");"NONE"==b.texture.d.source&&(e=K(b),w(a,e,"u_colormap0"))}else k(a,
"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.nH=b.b4w_use_ghost,a.zc=b.b4w_collision_id,a.Ys=b.b4w_collision_group,a.Zs=b.b4w_collision_mask,a.ej=b.physics.friction,a.Zi=b.physics.elasticity,a=!0):b.b4w_water?(a.eh=!0,a.xH=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=
b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)a=!1;else{y(a,b);a.Oe=Z.ee;a.Z=!0;a.Ka=!1;e=b.game_settings.alpha_blend;a.Ne=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;H(a,"color_id.glslv","color_id.glslf");
F(a,"a_position");e=b.game_settings.alpha_blend;k(a,"ALPHA","OPAQUE"===e?0:1);a.Hf.set([1,1,1]);if((b=G("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===e){a.Hf.set(b.scale);k(a,"TEXTURE_COLOR",1);F(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)e=K(b),w(a,e,"u_colormap0");"NONE"==b.texture.d.source&&(e=K(b),w(a,e,"u_colormap0"))}else k(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(y(a,b),a.Ka=!1,a.Oe=Z.ee,a.Z=
!0,H(a,"grass_map.glslv","grass_map.glslf"),F(a,"a_position"),e=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.nb.a_grass_size={rg:!0,src:[]},e?(a.nb.a_grass_size.src.push({name:e,$c:4}),k(a,"DYNAMIC_GRASS_SIZE",1)):k(a,"DYNAMIC_GRASS_SIZE",0),a.nb.a_grass_color={rg:!0,src:[]},b?(a.nb.a_grass_color.src.push({name:b,$c:7}),k(a,"DYNAMIC_GRASS_COLOR",1)):k(a,"DYNAMIC_GRASS_COLOR",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||
b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(H(a,"wireframe.glslv","wireframe.glslf"),F(a,"a_position"),F(a,"a_normal"),F(a,"a_polyindex"),a.Z=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{e=b.texture_slots;if(a.sg)H(a,"particles_color.glslv","particles_color.glslf");else if(H(a,"particles_texture.glslv","particles_texture.glslf"),e=G("use_map_color_diffuse",e)[0]){k(a,"TEXTURE_COLOR",1);switch(e.blend_type){case "MIX":k(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":k(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Wi=e.diffuse_color_factor;a.Ki=e.use_map_alpha?e.alpha_factor:0;e=K(e);w(a,e)}sa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Zc);a.kh=b.ambient;a.Xi=b.diffuse_intensity;a.Ch=b.emit;a.Yj.set(b.specular_color);a.ji=b.specular_alpha;F(a,"a_position");F(a,"a_normal");e=b.game_settings.alpha_blend;k(a,"ALPHA","OPAQUE"===e?0:1);k(a,"ALPHA_CLIP","CLIP"===
e?1:0);k(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);n(a,b);q(a,b);y(a,b);e=b.game_settings.alpha_blend;a.Ne=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;a.Lg=b.offset_z;a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function u(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":k(a,c,"TEXTURE_COORDS_UV_ORCO");k(a,"TEXCOORD",1);break;case "NORMAL":k(a,c,"TEXTURE_COORDS_NORMAL");k(a,"NORMAL_TEXCOORD",1);break;default:k(a,c,0)}}function y(a,b){var c=b.game_settings,g=c.alpha_blend;
switch(g){case "ALPHA_SORT":a.Ka=!0;a.Oe=Z.Tr;a.Z=!0;break;case "ALPHA":a.Ka=!0;a.Oe=Z.ee;a.Z=!0;break;case "CLIP":a.Ka=!1;a.Oe=Z.ee;a.Z=!0;break;case "ADD":a.Ka=!0;a.Oe=Z.ee;a.Z=!1;break;case "OPAQUE":a.Ka=!1;a.Oe=Z.ee;a.Z=!0;break;default:throw Error("Unknown alpha blend mode: "+g);}a.Fa=c.use_backface_culling}function K(a,b){var c=a.texture,g=c.d,c=c.image;g&&b&&c&&fa.dk(g,b,c.wc,c.filepath);return g}function G(a,b){for(var c=[],g=b.length,h=0;h<g;h++){var d=b[h];1==d[a]&&d.texture&&d.texture.d&&
c.push(d)}return c}function A(a,b){var c=b.raytrace_transparency;a.qg[0]=c.fresnel;a.qg[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.gm=c.reflect_factor;a.qg[2]=c.fresnel;a.qg[3]=1-c.fresnel_factor/5}function n(a,b){var c,g=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":k(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":k(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":k(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;
g=b.specular_toon_smooth;break;default:R.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.ki[0]=b.specular_intensity;a.ki[1]=c;a.ki[2]=g}function q(a,b){switch(b.diffuse_shader){case "LAMBERT":k(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.oe[0]=0;a.oe[1]=0;break;case "OREN_NAYAR":k(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.oe[0]=b.roughness;a.oe[1]=0;break;case "FRESNEL":k(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.oe[0]=b.diffuse_fresnel;a.oe[1]=
b.diffuse_fresnel_factor;break;default:R.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.oe[0]=0,a.oe[1]=0}}function c(a,b){if(!b.use_nodes||b.b4w_do_not_render)return!1;var c=aa.nB(b.node_tree,b.uuid,!1,b.name);if(!c)return R.error('Failed to create node graph for material "'+b.name+'", disable nodes'),P(a,b),!0;H(a,"nodes.glslv","nodes.glslf");var g=b.game_settings.alpha_blend;k(a,"ALPHA","OPAQUE"===g?0:1);k(a,"ALPHA_CLIP","CLIP"===g?1:0);k(a,"DOUBLE_SIDED_LIGHTING",
b.b4w_double_sided_lighting?1:0);F(a,"a_position");y(a,b);a.Lg=b.offset_z;g=b.game_settings.alpha_blend;a.Ne=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;sa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Zc);a.Ch=b.emit;a.kh=b.ambient;A(a,b);b.b4w_wettable?k(a,"WETTABLE",1):k(a,"WETTABLE",0);a.ub.Jp=aa.oB(c);var h=!1;X.U(c,function(b,c){switch(c.type){case "GEOMETRY_UV":var g=c.data.name,d=c.data.value;a.bh||(a.bh={});a.bh[d]=g;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":g=
c.data.name;a.nb[g]={rg:!0,src:[{name:c.data.value}]};d=0;if("GEOMETRY_VC"==c.type)d=7;else for(var e=0;e<c.Xa.length;e++){var n="RGB".indexOf(c.Xa[e].identifier);-1<n&&(d|=1<<2-n)}a.nb[g].src[0].$c=d;break;case "GEOMETRY_NO":F(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":g=c.data.value;F(a,"a_normal");k(a,"DIFFUSE_SHADER","DIFFUSE_"+g.jC);k(a,"SPECULAR_SHADER","SPECULAR_"+g.qG);k(a,"SHADELESS_MAT",g.ah?1:0);a.ah=g.ah;a.ji=g.ji;h=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":g=
c.data.name;d=c.data.value;!1!==d.d.Ak&&(d.d.Ak="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);w(a,d.d,g);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":k(a,"CALC_TBN_SPACE",1);F(a,"a_normal");F(a,"a_tangent");g=c.data.name;d=c.data.value;d.d.Ak=!1;w(a,d.d,g);break;case "LAMP":c.data&&(a.Oh=c.data);break;case "B4W_REFRACTION":a.Zp=!0}});h||(a.ah=!0);return!0}function P(a,b){H(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;k(a,"ALPHA","OPAQUE"===c?0:1);k(a,"ALPHA_CLIP","CLIP"===c?1:0);k(a,"SHADELESS",
1);F(a,"a_position");F(a,"a_normal");sa.set(1,0,1,1,a.Zc);k(a,"VERTEX_COLOR",0);a.Lg=b.offset_z;y(a,b)}function O(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Bl?k(a,"AU_QUALIFIER","attribute"):k(a,"AU_QUALIFIER","uniform"),k(a,"STATIC_BATCH",0)):(k(a,"AU_QUALIFIER","attribute"),k(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(U.JD()?k(a,"WIREFRAME_QUALITY",1):k(a,"WIREFRAME_QUALITY",0),a.yh?(k(a,"DEBUG_SPHERE",1),a.ut?k(a,"DEBUG_SPHERE_DYNAMIC",1):k(a,"DEBUG_SPHERE_DYNAMIC",0)):k(a,"DEBUG_SPHERE",
0),k(a,"ALPHA",1));b.Wd&&(a.Wd=b.Wd);b.Yd?(""!==b.Ae?(a.nb.a_bending_col_main={rg:!0,src:[{name:b.Ae,$c:4}]},F(a,"a_bending_col_main"),""!==b.Ob.Dv&&""!==b.Ob.Cv&&""!==b.Ob.Yv?(a.nb.a_bending_col_detail={rg:!0,src:[{name:b.Ob.Dv,$c:4},{name:b.Ob.Cv,$c:2},{name:b.Ob.Yv,$c:1}]},F(a,"a_bending_col_detail"),F(a,"a_normal"),k(a,"DETAIL_BEND",1)):k(a,"DETAIL_BEND",0),k(a,"MAIN_BEND_COL",1)):k(a,"MAIN_BEND_COL",0),k(a,"WIND_BEND",1)):k(a,"WIND_BEND",0);b.Gk?k(a,"BEND_CENTER_ONLY",1):k(a,"BEND_CENTER_ONLY",
0);k(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.GA|0);b.ke?k(a,"BILLBOARD",1):k(a,"BILLBOARD",0);b.ke&&b.Bl?k(a,"HAIR_BILLBOARD",1):k(a,"HAIR_BILLBOARD",0);b.Bn?k(a,"BILLBOARD_SPHERICAL",1):k(a,"BILLBOARD_SPHERICAL",0);switch(b.Mi){case "RANDOM":k(a,"BILLBOARD_RANDOM",1);k(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":k(a,"BILLBOARD_RANDOM",0);k(a,"BILLBOARD_JITTERED",1);break;default:k(a,"BILLBOARD_RANDOM",0),k(a,"BILLBOARD_JITTERED",0)}b.hb&&V.hn?k(a,"DYNAMIC_GRASS",1):k(a,"DYNAMIC_GRASS",0);a.hb=
b.hb;a.Ad=b.Ad;a.Mc=b.Mc;a.uc=b.uc;a.Tb=b.Tb&&!a.ah&&!(a.Ka&&V.zt);a.ec=b.ec;a.Sb=b.Sb;a.md=b.md;b.sj?(F(a,"a_influence"),k(a,"SKINNED",1),b.dj?k(a,"FRAMES_BLENDING",1):k(a,"FRAMES_BLENDING",0),k(a,"MAX_BONES",b.ld)):(k(a,"SKINNED",0),k(a,"FRAMES_BLENDING",0));b.Mm?(k(a,"VERTEX_ANIM",1),V.iy?k(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):k(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):k(a,"VERTEX_ANIM",0);if(b.sj&&b.Mm)throw"Skinning and vertex animation are mutually exlusive";b.bl?k(a,"DISABLE_FOG",
1):k(a,"DISABLE_FOG",0);b.Wc&&(a.Wc=b.Wc);if("NODES"==a.type){for(var c=a.ub.Jp,g=b.Hg,h=b.Gg,d=0;d<c.length;d++){var e=c[d];switch(e.id){case "VALUE":var n=e.Yl[0];if(n)for(var q=0;q<g.length;q+=2)if(g[q]==n){e.bf.push(["VALUE_IND",g[q+1]]);break}break;case "RGB":if(n=e.Yl[0])for(q=0;q<h.length;q+=2)if(h[q]==n){e.bf.push(["RGB_IND",h[q+1]]);break}}}k(a,"NUM_VALUES",b.pf.length);k(a,"NUM_RGBS",b.Gd.length)}}}function F(a,b){var c=a.gg;-1==c.indexOf(b)&&c.push(b)}function k(a,b,c){ba.u(a.ub,b,c)}function B(a,
b){if("PHYSICS"==a.type)a.Oc=b;else{var c=a.Oe,g=a.cf;a.Vu&&(b=Z.CC(b));a.my&&(b=z.YC(a.ny,a.py,a.ly));c=Z.CG(b,c,g,a.nb);a.da=c;a.Ad||c.vl||a.Wd||(c.tg=null,c.Me=null);c=b.v.length;a.Mp=b.J*c;a:switch(a.cf){case Z.Gi:case Z.qk:case Z.pk:g=!0;break a;default:g=!1}g?Z.fE(b)?a.yj=b.fa.length/3*c:a.yj=b.J/3*c:a.yj=0}}function J(a,b,c,g,h,e,k,n,q,w,f,m){var I=[],l=n.b4w_dynamic_grass;if(!w&&l)return I;for(var H="INSTANCE"==n.b4w_wind_bend_inheritance,r="INSTANCE"==n.b4w_shadow_inheritance,t="INSTANCE"==
n.b4w_reflection_inheritance,M=[],V=[],y=0;y<h.length;y++){var B=h[y],p=ca.Qk(b);p.ke=n.b4w_hair_billboard;p.Mi=n.b4w_hair_billboard_type;p.Bn="SPHERICAL"==n.b4w_hair_billboard_geometry;p.hb=l;p.Bl=!0;p.pf=B.d.pf;p.Hg=B.d.Hg;p.Gd=B.d.Gd;p.Gg=B.d.Gg;H?(p.Yd=B.d.Yd,p.jk=B.d.jk,p.Qf=B.d.Qf,p.af=B.d.af,p.Ae=B.d.Ae,p.$e=B.d.$e,p.Xe=B.d.Xe,p.Zd=B.d.Zd,p.Ob=B.d.Ob,p.Gk=!1):(p.Yd=a.d.Yd,p.jk=a.d.jk,p.Qf=a.d.Qf,p.af=a.d.af,p.Ae=a.d.Ae,p.$e=a.d.$e,p.Xe=a.d.Xe,p.Zd=a.d.Zd,p.Ob=a.d.Ob,p.Gk=!0);r?(p.Mc=B.d.Mc,
p.uc=B.d.uc,p.Tb=B.d.Tb):(p.Mc=a.d.Mc,p.uc=a.d.uc,p.Tb=a.d.Tb);t?(p.ec=B.d.ec,p.Sb=B.d.Sb,p.md=B.d.md):(p.ec=a.d.ec,p.Sb=a.d.Sb,p.md=a.d.md);M.push(p);var A=k[y];A||(A=new Float32Array);m&&ca.wl(q.seed,f);for(var J=new Float32Array(3),u=new Float32Array([0,0,0,1]),L=[],S=0;S<A.length;S+=4){J[0]=A[S];J[1]=A[S+1];J[2]=A[S+2];var F=A[S+3];if(n.b4w_initial_rand_rotation){switch(n.b4w_rotation_type){case "XYZ":var z=new Float32Array([ca.cd(f),ca.cd(f),ca.cd(f)]);ra.normalize(z,z);break;case "Z":z=new Float32Array([0,
1,0]);break;default:throw"Unsupported random rotation type: "+n.b4w_rotation_type;}qa.setAxisAngle(z,n.b4w_rand_rotation_strength*(2*Math.PI*ca.cd(f)-Math.PI),u)}var G=ma.xh(J,F,u);L.push(G)}V.push(L)}for(var K={},y=0;y<h.length;y++){var P=e[y],p=M[y],v=ca.ph(p,0),L=V[y];if(L.length)for(var U=h[y].data,X=U.materials,S=0;S<X.length;S++)if(!Z.dv(U,S))for(var T=0;T<P.length;T++){var Ca=d(P[T]),Jb=X[S];if(x(Ca,Jb,!0)){Ca.cf=Z.Gi;O(Ca,p);Ca.Zh=n.uuid;"JITTERED"==n.b4w_hair_billboard_type&&(Ca.vv=n.b4w_hair_billboard_jitter_amp,
Ca.wv=n.b4w_hair_billboard_jitter_freq);l&&(Ca.Uu=n.b4w_dynamic_grass_scale_threshold);H||(delete Ca.nb.a_bending_col_main,delete Ca.nb.a_bending_col_detail);C(Ca,v);var aa=Z.Lt(U,S,Ca.gg,Ca.Wc,Ca.nb,Ca.bh),ba=[];if(p.Yd||p.hb||p.ke)ba.au_wind_bending_amp=[p.Zd],ba.au_wind_bending_freq=[p.Qf],ba.au_detail_bending_freq=[p.af],ba.au_detail_bending_amp=[p.$e],ba.au_branch_bending_amp=[p.Xe];var Y=Z.tE(aa,ba,L),Ga=Y,xa=L;Ga.G.au_center_pos=new Float32Array(3*Ga.J);for(var Ya=xa.length,fa=Ga.J/Ya,ea=0;ea<
Ya;ea++)for(var la=xa[ea],ob=3*fa*ea,wb=0;wb<fa;wb++)Ga.G.au_center_pos[ob+3*wb]=la[0],Ga.G.au_center_pos[ob+3*wb+1]=la[1],Ga.G.au_center_pos[ob+3*wb+2]=la[2];Y=Ga;if(p.Gk){var xb=Y,rb=a.d.V;xb.G.a_emitter_center=new Float32Array(3*xb.J);var Na=sa.fromValues(0,0,0,1);sa.transformMat4(Na,rb,Na);for(var Aa=0;Aa<xb.J;Aa++)xb.G.a_emitter_center[3*Aa]=Na[0],xb.G.a_emitter_center[3*Aa+1]=Na[1],xb.G.a_emitter_center[3*Aa+2]=Na[2];Y=xb}var Cb=n.b4w_vcol_from_name,Db=n.b4w_vcol_to_name,Ba=Ca,fc=c,ga=!H,za=
U,Pa=[];if(""!==Cb&&""!==Db){var va,Ka=Db,ub=Ba.nb,vb=[],Wb=void 0;for(Wb in ub)for(var Xb=ub[Wb].src,Ma=0,Rb=0;Rb<Xb.length;Rb++){var Bb=Xb[Rb].$c;Ka==Xb[Rb].name&&vb.push(Wb,Bb,Ma);Ma+=ca.Sg(Bb)}va=vb;if(0<va.length)for(var Yb=0;Yb<va.length;Yb+=3)Pa.push({$i:Cb,fl:7,Zl:va[Yb],$l:va[Yb+1],dl:va[Yb+2]});else Z.RD(Ba.gg,"a_color")&&Db==za.active_vcol_name&&Pa.push({$i:Cb,fl:7,Zl:"a_color",$l:7,dl:0})}ga&&("a_bending_col_main"in fc.nb&&Pa.push({$i:"a_bending_col_main",fl:4,Zl:"a_bending_col_main",
$l:4,dl:0}),"a_bending_col_detail"in fc.nb&&Pa.push({$i:"a_bending_col_detail",fl:7,Zl:"a_bending_col_detail",$l:7,dl:0}));for(var Sb=Y,lc=L,mc=g,Wa=Pa,nc=Ca.nb,oc=!1,fb=0;fb<Wa.length;fb++){var gc=Wa[fb].$i,D=mc.G[gc];if(D&&0<D.length){oc=!0;break}}if(oc){var Mb,pb=a.d.Yb,Qa=mc.v[0].a_position,hb=lc,W=K,Ja=new Float32Array(3),ib=new Float32Array(3),ic=new Uint32Array(hb.length);if(!("verts_indices"in W)){W.me=new Float32Array(3);W.je=new Float32Array(3);W.er=new Uint32Array(Qa.length/3);W.zj=new Uint32Array(Qa.length/
3);W.me[0]=(pb.max_x-pb.min_x)/20;W.me[1]=(pb.max_y-pb.min_y)/20;W.me[2]=(pb.max_z-pb.min_z)/20;W.je[0]=pb.min_x;W.je[1]=pb.min_y;W.je[2]=pb.min_z;for(var cb=0;cb<Qa.length/3;cb++){var Nb=ca.trunc((Qa[3*cb]-W.je[0])/W.me[0]),db=ca.trunc((Qa[3*cb+1]-W.je[1])/W.me[1]),uc=ca.trunc((Qa[3*cb+2]-W.je[2])/W.me[2]),Nb=ca.ua(Nb,0,19),db=ca.ua(db,0,19),uc=ca.ua(uc,0,19);W.er[cb]=cb;W.zj[cb]=uc*Math.pow(20,2)+20*db+Nb}Z.zx(W.zj,W.er,Z.$m,!0);W.dh=new Uint32Array(Math.pow(20,3));for(cb=0;cb<W.zj.length;cb++)W.dh[W.zj[cb]]++;
delete W.zj;for(cb=1;cb<W.dh.length;cb++)W.dh[cb]+=W.dh[cb-1]}for(var ac=0;ac<hb.length;ac++){Ja[0]=hb[ac][0];Ja[1]=hb[ac][1];Ja[2]=hb[ac][2];for(var bc=1E10,Tb=-1,Ec=ca.trunc((Ja[0]-W.je[0])/W.me[0]),vc=ca.trunc((Ja[1]-W.je[1])/W.me[1]),Ra=ca.trunc((Ja[2]-W.je[2])/W.me[2]),Ec=ca.ua(Ec,0,19),vc=ca.ua(vc,0,19),Ra=ca.ua(Ra,0,19),La=Ra*Math.pow(20,2)+20*vc+Ec,od=W.dh[La],Ob=0==La?0:W.dh[La-1];Ob<od;Ob++){var wc=W.er[Ob];ib[0]=Qa[3*wc];ib[1]=Qa[3*wc+1];ib[2]=Qa[3*wc+2];ra.sub(ib,Ja,ib);var pc=ra.sqrLen(ib);
pc<=bc&&(bc=pc,Tb=wc)}if(-1==Tb)for(Ob=0;Ob<Qa.length/3;Ob++)ib[0]=Qa[3*Ob],ib[1]=Qa[3*Ob+1],ib[2]=Qa[3*Ob+2],ra.sub(ib,Ja,ib),pc=ra.sqrLen(ib),pc<=bc&&(bc=pc,Tb=Ob);ic[ac]=Tb}Mb=ic;for(var Fc=Sb.J/lc.length,fb=0;fb<Wa.length;fb++){var Fb=Wa[fb].Zl,cc=Wa[fb].$l,gc=Wa[fb].$i,id=Wa[fb].fl,D=mc.G[gc];switch(Fb){case "a_bending_col_main":var dc=1;break;case "a_bending_col_detail":dc=3;break;case "a_color":dc=3;break;default:for(var Ub=dc=0;Ub<nc[Fb].src.length;Ub++)dc+=ca.Sg(nc[Fb].src[Ub].$c)}if(D&&
0<D.length){var jc=ca.Sg(id),Pb=ca.Sg(cc),Yc=id&cc,Zc=ca.Ow(Yc);Yc!=cc&&R.error("Wrong color extraction from "+gc+" to "+Fb+".");if("a_bending_col_main"==Fb||"a_bending_col_detail"==Fb)Sb.G[Fb]=new Float32Array(Sb.J*Pb);for(Ub=0;Ub<lc.length;Ub++){var kc=Mb[Ub],Gc=kc*jc,Mc=Ub*Fc*dc;if(-1!=kc)for(var yb=0;yb<Fc;yb++)for(var Vb=yb*dc,qb=0;qb<Zc.length;qb++)Zc[qb]&&(Sb.G[Fb][Mc+Vb+(Wa[fb].dl+ca.Tj(cc,qb))]=D[Gc+ca.Tj(id,qb)])}}else Sb.G[Fb]=new Float32Array(0)}}Y=Sb;I.push({o:Ca,Oc:Y,ad:[Jb.name],fc:p,
nd:[a]})}}}return I}function h(a){return ma.xh(a.g,a.scale,a.quat)}function C(a,b){for(var c=null,g=null,h=0;h<a.X.length;h++){var d=a.X[h].le;d&&(c||(c={}),c[h]=d,a.X[h].le=null);if(d=a.X[h].Oa)g||(g={}),g[h]=d,a.X[h].Oa=null}a.id=0;a.mF=b;a.id=ca.ph(a,b);if(c)for(var e in c)a.X[e].le=c[e];if(g)for(e in g)a.X[e].Oa=g[e]}function I(a,b,c,g,h){var e=d("WIREFRAME");H(e,"wireframe.glslv","wireframe.glslf");e.wireframe_mode=0;e.yh=!0;e.Z=!0;e.Zh=c;h&&(e.ut=!0);O(e,b);C(e,ca.ph(b,0));g?(b=z.$t(1,a.F),
Z.AF(b,[a.Yf[0],a.Zf[1],a.$f[2]],a.F)):b=z.$t(a.Ea,a.F);Z.Gq(b,1,!0);b.G.a_polyindex=Z.Kt(b);B(e,b);return e}function H(a,b,c){a.ub={Lm:b,il:c,ig:[],qp:[],Jp:[]};ba.JF(a.ub)}function w(a,b,c){1==a.X.length&&0==a.ed.length&&a.ed.push("default0");c=c||"default"+String(a.X.length);-1==a.ed.indexOf(c)&&(a.X.push(b),a.ed.push(c));a.tc&&ea.rs(a)}function g(a){if(!a.ub)throw"No shaders info for batch "+a.name;a.tc=ba.jD(a.ub);ea.AA(a.tc);ea.xA(a);ea.rs(a)}var M=v("__boundings"),L=v("__config"),R=v("__print"),
U=v("__extensions"),Z=v("__geometry"),X=v("__graph"),aa=v("__nodemat"),T=v("__objects"),Y=v("__particles"),z=v("__primitives");v("__reformer");var ea=v("__renderer"),la=v("__scenegraph"),ba=v("__shaders"),fa=v("__textures"),ma=v("__tsr"),ca=v("__util"),ra=v("vec3"),sa=v("vec4"),qa=v("quat"),V=L.q,S=["MAIN","NODES"];a.WL=d;a.XC=function(a,c,g,h,e,n,q){for(var C=[],m=[],l=[],t=0;t<g.length;t++){var y=g[t];T.Fc(y)?m.push(y):l.push(y)}t=[];t=t.concat(f(m,a,q));m=t=t.concat(r(l,a,c,q));t=[];y=[];l={};
for(c=0;c<m.length;c++){var x=m[c].o,A=m[c].fc,J=null;if(x.id in l){var u=l[x.id],L=y[u].o,G=y[u].fc,P=null,O=null;for(q=0;q<x.X.length;q++){var R=x.X[q].le;R&&(P||(P={}),P[q]=R,x.X[q].le=null);if(R=x.X[q].Oa)O||(O={}),O[q]=R,x.X[q].Oa=null}ca.Lx(x,L)&&ca.Lx(A,G)&&(J=y[u]);if(P)for(q in P)x.X[q].le=P[q];if(O)for(q in O)x.X[q].Oa=O[q];if(!J){do x.id++;while(l[x.id])}}J||(J={o:x,fc:m[c].fc,nd:[],Hq:[],ad:[]},l[x.id]=y.length,y.push(J));J.nd=J.nd.concat(m[c].nd);m[c].Oc&&m[c].Oc.J&&J.Hq.push(m[c].Oc);
J.ad=J.ad.length?J.ad.concat(m[c].ad):m[c].ad;Z.zx(J.ad,J.Hq,Z.Iz,!1)}for(c=0;c<y.length;c++){m=y[c].Hq;if(0==m.length)q=ca.pb(ca.Fm("%empty"));else if(1==m.length)q=m[0];else{l=[];for(q=0;q<m.length;q++)Z.gE(m[q])||l.push(q);if(l.length<m.length)for(q=0;q<l.length;q++)Z.Gq(m[l[q]]);q=Z.BG(m)}t.push({o:y[c].o,fc:y[c].fc,Oc:q,ad:y[c].ad,nd:y[c].nd})}C.push.apply(C,t);for(t=0;t<C.length;t++)C[t].o.Qh=C[t].ad,B(C[t].o,C[t].Oc);for(t=0;t<C.length;t++)if(c=C[t].o,"STATIC"==C[t].fc.type&&"COLOR_ID"!=c.type)y=
T.jv(ca.Fm("%meta"),"MESH",!0),y.d=C[t].fc,y.n=[c],n.push(y);else for(m=[],q=0;q<C[t].nd.length;q++)if(y=C[t].nd[q],-1==m.indexOf(y.name)){for(l=0;l<y.n.length;l++)if(y.n[l]==c)throw"Batch already exist in object";y.n.push(c);m.push(y.name)}if(V.wireframe_debug){for(t=0;t<C.length;t++)if(c=C[t].fc,"DYNAMIC"==c.type&&(y=C[t].nd[0],-1<S.indexOf(C[t].o.type))){m=!1;for(q=0;q<y.n.length;q++)y.n[q].yh&&(m=!0);m||(c=I(c.ag,c,y.name,!0,!0),y.n.push(c))}for(t=0;t<n.length;t++)y=n[t],c=y.d,-1<S.indexOf(y.n[0].type)&&
(c=I(c.gd,c,y.name,!1),y.n.push(c))}e.Kw&&(c=d("MAIN"),H(c,"special_skydome.glslv","special_skydome.glslf"),e.procedural_skydome?(k(c,"USE_SKY_TEXTURE",1),c.ww=!0):(h.xq&&(k(c,"USE_SKY_TEXTURE",1),C=K(h.xq,null),w(c,C,"u_sky")),h.oH&&k(c,"USE_SKY_BLEND",1),h.pH&&k(c,"USE_SKY_PAPER",1),h.qH&&k(c,"USE_SKY_REAL",1)),e.ec&&(c.ec=!0,e.Sb&&(c.Sb=!0)),F(c,"a_position"),c.Lg=99999,h=z.WC(),B(c,h),y=T.jv(ca.Fm("%meta"),"MESH",!0),y.d=T.Xk("DYNAMIC"),y.d.zh=!0,y.d.Yb=M.$d(),y.d.gd=M.kk(),y.d.fb=M.$d(),y.d.Hb=
M.kk(),y.n=[c],n.push(y));for(t=0;t<g.length;t++)for(q=0;q<g[t].n.length;q++)b(g[t].n[q]);for(t=0;t<n.length;t++)for(q=0;q<n[t].n.length;q++)b(n[t].n[q]);for(t=0;t<g.length;t++)p(g[t],a);for(t=0;t<n.length;t++)p(n[t],a)};a.yH=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.CA=t;a.gD=K;a.tn=function(a,b){k(a,"CSM_SECTION0",0);k(a,"CSM_SECTION1",0);k(a,"CSM_SECTION2",0);k(a,"CSM_SECTION3",
0);for(var c=0;c<b.csm_num;c++)k(a,"CSM_SECTION"+String(c),1);k(a,"SHADOW_TEX_RES",ba.O(b.csm_resolution));k(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);k(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.He=k;a.Ho=function(a,b){return ba.qD(a.ub,b)};a.SG=C;a.Ck=w;a.qF=function(a,b,c){c=a.ed.indexOf(c);-1<c&&(a.X[c]=b)};a.PB=function(a,b){var c=d("MAIN");c.Ka=!0;sa.set(b[0],b[1],b[2],.5,c.Zc);c.cf=Z.qk;B(c,a);H(c,"main.glslv","main.glslf");k(c,"SHADELESS",1);g(c);return c};a.Wb=
g;a.UA=function(a){return a.tc.Fj.length?a.tc.Qp.u_cube_fog?!0:!1:!1};a.DB=function(){var a=d("DEPTH_PACK");a.Fa=!0;a.Z=!1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");g(a);return a};a.lt=function(a){var b=d("POSTPROCESSING");H(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":k(b,"POST_EFFECT","POST_EFFECT_NONE");b.t[0]=1;b.t[1]=1;break;case "GRAYSCALE":k(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");
b.t[0]=1;b.t[1]=1;break;case "X_BLUR":k(b,"POST_EFFECT","POST_EFFECT_X_BLUR");b.t[0]=1;b.t[1]=0;break;case "Y_BLUR":k(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.t[0]=0;b.t[1]=1;break;case "X_EXTEND":k(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.t[0]=1;b.t[1]=0;break;case "Y_EXTEND":k(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.t[0]=0;b.t[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.Fa=!0;b.Z=!1;a=z.jb();B(b,a);g(b);return b};a.hK=function(){var a=d("EDGE");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=
1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");g(a);return a};a.TB=function(a){var b=d("SSAO");b.Z=!1;b.Fa=!0;b.t[0]=1;b.t[1]=1;var c=z.jb();B(b,c);H(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");k(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Gx);k(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:fa.$C(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,
160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=K(a,c);w(b,a,"u_ssao_special_tex");g(b);return b};a.UB=function(a){var b=d("SSAO_BLUR");b.Z=!1;b.Fa=!0;b.t[0]=1;b.t[1]=1;var c=z.jb();B(b,c);H(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");k(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);g(b);return b};a.EB=function(){var a=d("DOF");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv",
"postprocessing/dof.glslf");k(a,"DEPTH_RGBA",1);g(a);return a};a.LB=function(){var a=d("OUTLINE");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");g(a);return a};a.FB=function(a,b,c){var h=d("GOD_RAYS");h.Z=!1;h.Fa=!0;h.t[0]=1;h.t[1]=1;var e=z.RC();B(h,e);H(h,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");k(h,"DEPTH_RGBA",a?1:0);k(h,"WATER_EFFECTS",b?1:0);k(h,"STEPS_PER_PASS",ba.O(c,1));g(h);return h};
a.GB=function(){var a=d("GOD_RAYS_COM");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");g(a);return a};a.QB=function(){var a=d("SKY");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.SC();B(a,b);H(a,"procedural_skydome.glslv","procedural_skydome.glslf");k(a,"WATER_EFFECTS",1);g(a);return a};a.xB=function(){var a=d("ANTIALIASING");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;a.yi=1/V.resolution_factor;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv",
"postprocessing/antialiasing.glslf");k(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");g(a);return a};a.RB=function(a){var b=d("SMAA"),c=z.jb();B(b,c);H(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");k(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");k(b,"SMAA_PASS",a);k(b,"SMAA_PREDICATION",0);k(b,"SMAA_REPROJECTION",0);g(b);b.Z=!1;b.Fa=!0;b.t[0]=1;b.t[1]=1;b.yi=1/V.resolution_factor;return b};a.HB=function(a){var b=d("LANCZOS");b.Z=!1;b.Fa=!0;b.yi=1/V.resolution_factor;"LANCZOS_X"==a?(b.t[0]=1,b.t[1]=0):
"LANCZOS_Y"==a&&(b.t[0]=0,b.t[1]=1);a=z.jb();B(b,a);H(b,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");g(b);return b};a.BB=function(){var a=d("COMPOSITING");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");g(a);return a};a.KB=function(a){var b=d("MOTION_BLUR");b.Fa=!0;b.Z=!1;var c=z.jb();B(b,c);H(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");k(b,"BLUR_DECAY_THRESHOLD",
ba.O(a));g(b);return b};a.vB=function(){var a=d("ANAGLYPH");a.Fa=!0;a.Z=!1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");g(a);return a};a.IB=function(){var a=d("LUMINANCE");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");g(a);return a};a.yB=function(){var a=d("LUMINANCE");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");
g(a);return a};a.JB=function(){var a=d("LUMINANCE_X_BLUR");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");g(a);return a};a.zB=function(a){var b=d("POSTPROCESSING");switch(a){case "X_BLUR":b.t[0]=1;b.t[1]=0;break;case "Y_BLUR":b.t[0]=0;b.t[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.Fa=!0;b.Z=!1;a=z.jb();B(b,a);H(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");
g(b);return b};a.AB=function(){var a=d("BLOOM");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");g(a);return a};a.XB=function(){var a=d("VELOCITY");a.Z=!1;a.Fa=!0;a.t[0]=1;a.t[1]=1;var b=z.jb();B(a,b);H(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");g(a);return a};a.wB=function(){var a=d("ANCHOR_VISIBILITY");a.Z=!0;a.Fa=!0;a.t[0]=1;a.t[1]=1;a.cf=Z.sr;H(a,"anchors.glslv","anchors.glslf");var b=
z.Zt(1);B(a,b);k(a,"ANCHOR_NUM",1);g(a);a.Ij=new Float32Array(0);return a};a.RG=function(a,b){var c=b.length/3;if(c!=a.Ij.length/3){var h=z.Zt(c);B(a,h);k(a,"ANCHOR_NUM",c);g(a)}a.Ij=b};a.Xj=function(a,b,c){var g=a.yi;a.Kq[0]=b*a.t[0]*g;a.Kq[1]=c*a.t[1]*g};a.Wg=function(a,b){a.yi=b};a.HK=function(a,b,c){for(var g=0;g<a.n.length;g++)if(a.n[g].type==c&&!a.n[g].ng&&-1!=a.n[g].Qh.indexOf(b))return a.n[g];return null};a.IK=function(a,b,c){for(var g=0;g<a.n.length;g++)if(a.n[g].type==c&&a.n[g].ng&&-1!=
a.n[g].Qh.indexOf(b))return a.n[g];return null};a.qN=function(a,b){a.Zc.set(b.Zc);a.Xi=b.Xi;a.Yj.set(b.Yj);a.ki.set(b.ki);a.Ch=b.Ch;a.kh=b.kh;a.Wi=b.Wi;a.Ki=b.Ki;a.gm=b.gm;a.qg.set(b.qg);a.Xl=b.Xl;a.qm.set(b.qm);a.rm=b.rm;a.um.set(b.um);a.vm=b.vm;a.hl=b.hl;a.Om=b.Om};a.HJ=function(a,b){for(var c=a.n,g=0;g<c.length;g++)if(c[g].type==b)return!0;return!1};a.lB=function(a){for(var b=a.X,c=0;c<b.length;c++)fa.hC(b[c].$a);Z.Ts(a.da)}};b4w.module.__boundings=function(a,v){function d(a,b){for(var d=a[0],e=a[1],n=a[2],q=a[0],c=a[1],f=a[2],m=3;m<a.length;m+=3)var l=a[m],k=a[m+1],t=a[m+2],d=Math.max(d,l),e=Math.max(e,k),n=Math.max(n,t),q=Math.min(q,l),c=Math.min(c,k),f=Math.min(f,t);b.max_x=d;b.max_y=e;b.max_z=n;b.min_x=q;b.min_y=c;b.min_z=f;return b}function b(a,b){b||(b=new Float32Array(24));var d=a.max_x,e=a.max_y,n=a.max_z,q=a.min_x,c=a.min_y,f=a.min_z;b[0]=q;b[1]=c;b[2]=f;b[3]=d;b[4]=c;b[5]=f;b[6]=d;b[7]=e;b[8]=f;b[9]=q;b[10]=
e;b[11]=f;b[12]=q;b[13]=c;b[14]=n;b[15]=d;b[16]=c;b[17]=n;b[18]=d;b[19]=e;b[20]=n;b[21]=q;b[22]=e;b[23]=n;return b}function p(a,b,d){l.add(b,d,a.F);l.scale(a.F,.5,a.F);a.Ea=l.distance(a.F,b);return a}var e=v("__geometry"),f=v("__util"),r=v("__tsr"),l=v("vec3"),t=new Float32Array(24),m=new Float32Array(3),x=new Float32Array(3),u=new Float32Array(3);a.ct=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.BJ=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.$d=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Ft=function(a,b){var d=a.max_y,e=a.max_z,n=a.min_x,q=a.min_y,c=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,d);a.max_z=Math.max(b.max_z,e);a.min_x=Math.min(b.min_x,n);a.min_y=Math.min(b.min_y,q);a.min_z=Math.min(b.min_z,c)};a.DA=d;a.Cn=function(e,m,l){l||(l=a.$d());e=b(e,t);f.tf(e,m,e);return d(e,l)};a.AC=b;a.JN=function(b,d,e){e||
(e=a.$d());var f=d.min_x,n=d.max_x,q=d.min_y,c=d.max_y,m=d.min_z;d=d.max_z;if(f>=b.max_x||n<=b.min_x||q>=b.max_y||c<=b.min_y||m>=b.max_z||d<=b.min_z)return e.min_x=-.1,e.max_x=.1,e.min_y=-.1,e.max_y=.1,e.min_z=-.2,e.max_z=-.1,e;e.min_x=Math.max(b.min_x,f);e.max_x=Math.min(b.max_x,n);e.min_y=Math.max(b.min_y,q);e.max_y=Math.min(b.max_y,c);e.min_z=Math.max(b.min_z,m);e.max_z=Math.min(b.max_z,d);return e};a.QN=function(b,d,e){e||(e=a.$d());var f=b.max_x-b.min_x,n=b.max_y-b.min_y,q=b.max_z-b.min_z;e.min_x=
b.min_x-.5*(d-1)*f;e.max_x=b.max_x+.5*(d-1)*f;e.min_y=b.min_y-.5*(d-1)*n;e.max_y=b.max_y+.5*(d-1)*n;e.min_z=b.min_z-.5*(d-1)*q;e.max_z=b.max_z+.5*(d-1)*q;return e};a.En=function(b,d,e){e||(e=a.kk());l.transformMat4(b.F,d,e.F);e.Ea=b.Ea*f.zp(d);return e};a.Dn=function(a,b,d){d||(d={Yf:new Float32Array(3),Zf:new Float32Array(3),$f:new Float32Array(3),F:new Float32Array([0,0,0])});r.bk(a.F,b,d.F);l.copy(a.Yf,d.Yf);l.copy(a.Zf,d.Zf);l.copy(a.$f,d.$f);r.ak(d.Yf,b,d.Yf);r.ak(d.Zf,b,d.Zf);r.ak(d.$f,b,d.$f);
return d};a.Vn=function(a,b){return{Ea:a,F:new Float32Array(b)}};a.kk=function(){return{F:new Float32Array([0,0,0]),Ea:0}};a.Un=function(a,b,d,e){return{Yf:new Float32Array(a),Zf:new Float32Array(b),$f:new Float32Array(d),F:new Float32Array([e[0],e[1],e[2]])}};a.FA=function(){return{F:new Float32Array([0,0,0]),Ea:1E12}};a.xC=function(a,b){var d=l.subtract(b.F,a.F,l.create());0==l.length(d)&&l.set(1,0,0,d);var e=l.normalize(d,l.create()),d=l.scale(e,a.Ea,l.create());l.add(d,a.F,d);var n=l.scale(e,
-a.Ea,l.create());l.add(n,a.F,n);var q=l.scale(e,b.Ea,l.create());l.add(q,b.F,q);var c=l.scale(e,-b.Ea,l.create());l.add(c,b.F,c);d=[d,n,q,c];e=l.normalize(e,l.create());n=d[0];q=d[0];for(c=1;c<d.length;c++){var f=l.dot(d[c],e);f<l.dot(n,e)&&(n=d[c]);f>l.dot(q,e)&&(q=d[c])}e=[n,q];d=e[0];e=e[1];a.F=l.scale(l.add(d,e,l.create()),.5,l.create());a.Ea=l.length(l.subtract(e,d,l.create()))/2};a.dt=function(a,b){var d=b.max_y,e=b.min_y,n=Math.max(0,d-e-2*a);return{Ea:a,height:n,F:new Float32Array([0,(d+
e)/2,0])}};a.ft=function(a,b){var d=b.max_y,e=b.min_y,n=Math.max(0,d-e);return{Ea:a,height:n,F:new Float32Array([0,(d+e)/2,0])}};a.et=function(a,b){var d=b.max_y,e=b.min_y,n=Math.max(0,d-e);return{Ea:a,height:n,F:new Float32Array([0,(d+e)/2,0])}};a.IJ=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.eF=function(a){for(var b=0,d=0,e=0,n=0,q=0,c=0,f=0,m=0,l=0;l<a.submeshes.length;l++){var k=a.submeshes[l];if(k.position.length){b=
n=k.position[0];d=q=k.position[1];e=c=k.position[2];break}}for(l=0;l<a.submeshes.length;l++)for(var k=a.submeshes[l],k=k.position,t=0;t<k.length/3;t++)var r=k[3*t],h=k[3*t+1],C=k[3*t+2],b=Math.max(r,b),d=Math.max(h,d),e=Math.max(C,e),n=Math.min(r,n),q=Math.min(h,q),c=Math.min(C,c),f=Math.max(Math.sqrt(r*r+h*h+C*C),f),m=Math.max(Math.sqrt(r*r+C*C),m);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=n;a.b4w_bounding_box.max_y=d;a.b4w_bounding_box.min_y=q;a.b4w_bounding_box.max_z=e;a.b4w_bounding_box.min_z=
c;a.b4w_bounding_sphere_radius=f;a.b4w_bounding_cylinder_radius=m};a.xD=function(b){var d=b.subarray(0,3),f=b.subarray(6,9),t=b.subarray(12,15),n=b.subarray(18,21);b=l.subtract(f,d,m);l.normalize(b,b);var q=e.FD(d,f,t,x),q=l.cross(q,b,q);l.normalize(q,q);var c=l.create(),r=l.create();l.subtract(f,d,u);r[0]=l.dot(u,b);r[1]=l.dot(u,q);f=l.create();l.subtract(t,d,u);f[0]=l.dot(u,b);f[1]=l.dot(u,q);t=l.create();l.subtract(n,d,u);t[0]=l.dot(u,b);t[1]=l.dot(u,q);n=a.kk();t=[c,r,f,t];c=p(n,t[0],t[1]);for(n=
2;n<t.length;n++)if(l.distance(c.F,t[n])>c.Ea){for(var O=c,c=t,r=t[n],f=n-1,O=p(O,r,c[0]),F=1;F<=f;F++)if(l.distance(O.F,c[F])>O.Ea){for(var k=O,O=c,B=r,J=c[F],h=F-1,k=p(k,B,J),C=0;C<=h;C++)if(l.distance(k.F,O[C])>k.Ea){var I=B,H=J,w=O[C],g=l.subtract(H,w,u),g=l.squaredLength(g),M=l.subtract(I,w,u),L=l.squaredLength(M),M=l.subtract(I,H,u),R=l.squaredLength(M),M=g*(L+R-g),v=L*(R+g-L),g=R*(g+L-R),L=M+v+g;l.copy(I,k.F);l.scale(k.F,M/L,k.F);l.scaleAndAdd(k.F,H,v/L,k.F);l.scaleAndAdd(k.F,w,g/L,k.F);k.Ea=
l.distance(k.F,I)}O=k}c=O}n=c;b=l.scale(b,n.F[0],u);l.scaleAndAdd(b,q,n.F[1],b);l.add(b,d,n.F);return n}};b4w.module.__graph=function(a){function v(a,b,c){c||(c=null);if(d(a,b))throw"Graph already has node with given ID";a.Ja.push(b,c)}function d(a,b){for(var c=a.Ja,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,c,e){e||(e=null);if(d(a,b)&&d(a,c))a.oa.push(b,c,e);else throw"Wrong node IDs";}function p(a,b){if(!d(a,b))throw"Node not found";for(var c=a.Ja,e=0;e<c.length;e+=2)c[e]==b&&(c.splice(e,2),e-=2)}function e(a){a=a.Ja;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function f(a,b){for(var c=a.Ja,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function r(a){var b=[],c={};l(a,c);for(var d=a.Ja,e=0;e<d.length;e+=2)0==q(a,d[e])&&t(a,d[e],c,b);return{Ja:b,oa:a.oa.slice(0)}}function l(a,b){for(var c=a.Ja,d=0;d<c.length;d+=2)b[c[d]]=!1}function t(a,b,d,e){if(!d[b]){d[b]=!0;for(var k=0;k<n(a,b);k++)t(a,c(a,b,k),d,e);e.unshift(b,A(a,b))}}function m(a,b,d,e){if(!d[b]){d[b]=!0;if(10==e||30==e)for(var k=0;k<n(a,b);k++){var g=c(a,b,k);m(a,g,d,e)}if(20==e||30==e)for(k=
0;k<q(a,b);k++)g=P(a,b,k),m(a,g,d,e)}}function x(a){var b=a.Ja;a=a.oa;for(var c=[],d=[],e=[],g=0;g<b.length;g++)e[b[2*g]]=g,c.push(g,b[2*g+1]);for(g=0;g<a.length;g+=3)d.push(e[a[g]],e[a[g+1]],a[g+2]);return{Ja:c,oa:d}}function u(a,b,d){if(d.yd==d.qf){for(var e=0,k=0;e<d.qf;e++)-1!=d.ne[e]&&(a[k]=e,b[k]=d.ne[e],k++);return!0}if(d.qf>d.Xh||d.Ff>d.Gf||d.vi>d.xi||d.ui>d.wi)return!1;for(var k=e=-1,g=!1;!g&&y(d,J,e,k);)if(e=J[0],k=J[1],K(d,e,k)){var f;f=d;g={};g.fj=f.fj;g.gj=f.gj;g.Ip=f.Ip;g.el=f.el;g.qf=
f.qf;g.Xh=f.Xh;g.rf=f.rf;g.yd=g.Ol=f.yd;g.ui=f.ui;g.vi=f.vi;g.Ff=f.Ff;g.wi=f.wi;g.xi=f.xi;g.Gf=f.Gf;g.Ji=-1;g.ne=f.ne;g.hg=f.hg;g.ug=f.ug;g.vg=f.vg;g.Mg=f.Mg;g.Ng=f.Ng;g.sm=f.sm;f.sm[0]+=1;var g=f=g,m=e,l=k,t=g.fj,r=g.gj,p=g.qf,x=g.Xh,B=g.ne,A=g.hg,F=g.ug,O=g.vg,v=g.Mg,ba=g.Ng;G(m<p);G(l<x);G(g.yd<p);G(g.yd<x);p=++g.yd;g.Ji=m;F[m]||(F[m]=p,g.ui++,v[m]&&g.Ff++);v[m]||(v[m]=p,g.vi++,F[m]&&g.Ff++);O[l]||(O[l]=p,g.wi++,ba[l]&&g.Gf++);ba[l]||(ba[l]=p,g.xi++,O[l]&&g.Gf++);B[m]=l;A[l]=m;for(B=0;B<q(t,m);B++)A=
P(t,m,B),F[A]||(F[A]=p,g.ui++,v[A]&&g.Ff++);for(B=0;B<n(t,m);B++)A=c(t,m,B),v[A]||(v[A]=p,g.vi++,F[A]&&g.Ff++);for(B=0;B<q(r,l);B++)A=P(r,l,B),O[A]||(O[A]=p,g.wi++,ba[A]&&g.Gf++);for(B=0;B<n(r,l);B++)A=c(r,l,B),ba[A]||(ba[A]=p,g.xi++,O[A]&&g.Gf++);g=u(a,b,f);G(1>=f.yd-f.Ol);G(-1!=f.Ji);A=f.fj;m=f.gj;l=f.yd;t=f.Ji;r=f.ne;F=f.hg;p=f.ug;O=f.vg;x=f.Mg;v=f.Ng;if(f.Ol<l){p[t]==l&&(p[t]=0);for(ba=0;ba<q(A,t);ba++)B=P(A,t,ba),p[B]==l&&(p[B]=0);x[t]==l&&(x[t]=0);for(ba=0;ba<n(A,t);ba++)B=c(A,t,ba),x[B]==l&&
(x[B]=0);A=r[t];O[A]==l&&(O[A]=0);for(ba=0;ba<q(m,A);ba++)B=P(m,A,ba),O[B]==l&&(O[B]=0);v[A]==l&&(v[A]=0);for(ba=0;ba<n(m,A);ba++)B=c(m,A,ba),v[B]==l&&(v[B]=0);r[t]=-1;F[A]=-1;f.yd=f.Ol;f.Ji=-1}}return g}function y(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.Ff,g=a.Gf,k=a.vi,n=a.xi,q=a.ui,f=a.wi,m=a.yd,l=a.qf,t=a.Xh,r=a.ne,p=a.hg,x=a.ug,B=a.vg,J=a.Mg,u=a.Ng;if(e>m&&g>m)for(;c<l&&(-1!=r[c]||0==J[c]||0==x[c]);)c++,d=0;else if(k>m&&n>m)for(;c<l&&(-1!=r[c]||0==J[c]);)c++,d=0;else if(q>m&&f>m)for(;c<l&&
(-1!=r[c]||0==x[c]);)c++,d=0;else if(0==c&&0!=a.rf){for(x=0;x<l&&-1!=r[c=a.rf[x]];)x++;x==l&&(c=l)}else for(;c<l&&-1!=r[c];)c++,d=0;if(e>m&&g>m)for(;d<t&&(-1!=p[d]||0==u[d]||0==B[d]);)d++;else if(k>m&&n>m)for(;d<t&&(-1!=p[d]||0==u[d]);)d++;else if(q>m&&f>m)for(;d<t&&(-1!=p[d]||0==B[d]);)d++;else for(;d<t&&-1!=p[d];)d++;return c<l&&d<t?(b[0]=c,b[1]=d,!0):!1}function K(a,b,d){var e=a.fj,k=a.gj,g=a.Xh,f=a.ne,m=a.hg,l=a.ug,t=a.vg,r=a.Mg,p=a.Ng;G(b<a.qf);G(d<g);G(-1==f[b]);G(-1==m[d]);if(!(0,a.Ip)(A(e,
b),A(k,d)))return!1;for(var x=g=0,B=0,J=0,u=0,y=0,v=0;v<n(e,b);v++){var K=c(e,b,v);if(-1!=f[K]){var fa=f[K];if(!O(k,d,fa)||!F(a.el,e,b,K,k,d,fa))return!1}else l[K]&&B++,r[K]&&g++,l[K]||r[K]||u++}for(v=0;v<q(e,b);v++)if(K=P(e,b,v),-1!=f[K]){if(fa=f[K],!O(k,fa,d)||!F(a.el,e,K,b,k,fa,d))return!1}else l[K]&&B++,r[K]&&g++,l[K]||r[K]||u++;for(v=0;v<n(k,d);v++)if(fa=c(k,d,v),-1!=m[fa]){if(K=m[fa],!O(e,b,K))return!1}else t[fa]&&J++,p[fa]&&x++,t[fa]||p[fa]||y++;for(v=0;v<q(k,d);v++)if(fa=P(k,d,v),-1!=m[fa]){if(K=
m[fa],!O(e,K,b))return!1}else t[fa]&&J++,p[fa]&&x++,t[fa]||p[fa]||y++;return B<=J&&g<=x&&u<=y}function G(a){if(!a)throw"Assertion failed";}function A(a,b){for(var c=a.Ja,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function n(a,b){for(var c=a.oa,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function q(a,b){for(var c=a.oa,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function c(a,b,c){a=a.oa;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function P(a,b,
c){a=a.oa;for(var d=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function O(a,b,c){a=a.oa;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function F(a,b,c,d,e,g,n){for(var q=k(b,c,d),f=k(e,g,n),m=0;m<q;m++){for(var l=!1,t=0;t<f;t++)if(a(B(b,c,d,m),B(e,g,n,t))){l=!0;break}if(!l)return!1}return!0}function k(a,b,c){var d=0;a=a.oa;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function B(a,b,c,d){a=a.oa;for(var e=0,g=0;g<a.length;g+=3)if(a[g]==
b&&a[g+1]==c){if(e==d)return a[g+2];e++}return null}var J=[-1,-1];a.Br=-1;a.RH=10;a.pr=20;a.XI=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{Ja:b,oa:c}};a.jK=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{Ja:c,oa:d}};a.nn=v;a.RL=d;a.Ve=
b;a.Qj=p;a.ci=function(a,b,c,d){if(!O(a,b,c))throw"Edge not found";a=a.oa;for(var e=0,g=0;g<a.length;g+=3)if(a[g]==b&&a[g+1]==c){if(-1==d)a.splice(g,3);else{if(d==e){a.splice(g,3);break}e++}g-=3}};a.D=function(a,b){if(-1==f(a,b)){var c=e(a);v(a,c,b);return c}throw"Non-unique attribute";};a.pF=function(a,b,c,d,e){a=a.oa;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&a[g+2]==d&&(a[g+2]=e)};a.Xt=e;a.Yh=f;a.m=function(a,c,d,e){c=f(a,c);d=f(a,d);if(-1!=c&&-1!=d)b(a,c,d,e);else throw"Attributes not found";
};a.U=function(a,b){for(var c=a.Ja,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.If=function(a,b){for(var c=a.oa,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Le=function(a,b,c){for(var d=a.oa,e=0;e<d.length;e+=3)if(d[e+1]==b){var g=d[e];if(c(g,A(a,g),d[e+2]))break}};a.Jf=function(a,b,c){for(var d=a.oa,e=0;e<d.length;e+=3)if(d[e]==b){var g=d[e+1];if(c(g,A(a,g),d[e+2]))break}};a.Nq=r;a.LG=function(a){a=r(a).Ja;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.bM=function(){};a.Mx=function(a,
b,c){if(!d(a,b))throw"No such node";var e={};l(a,e);m(a,b,e,c);b=[];for(var k in e)e[k]&&(k=Number(k),b.push(k,A(a,k)));a={Ja:b,oa:a.oa.slice(0)};e=a.oa;for(k=0;k<e.length;k+=3)b=e[k+1],d(a,e[k])&&d(a,b)||(e.splice(k,3),k-=3);return a};a.ID=function(a){for(var b=[],c=a.Ja,d=0;d<c.length;d+=2){var e=c[d];q(a,e)||b.push(e)}return b};a.Gu=function(a){for(var b=[],c=a.Ja,d=0;d<c.length;d+=2){var e=c[d];n(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.fj=x(a);e.gj=x(b);e.Ip=c||function(a,
b){return a==b};e.el=d||function(a,b){return a==b};d=a.Ja.length/2;var g=b.Ja.length/2;e.qf=d;e.Xh=g;e.rf=0;e.yd=e.Ol=0;e.Ff=e.ui=e.vi=0;e.Gf=e.wi=e.xi=0;e.Ji=-1;e.ne=Array(d);e.hg=Array(g);e.ug=Array(d);e.vg=Array(g);e.Mg=Array(d);e.Ng=Array(g);e.sm=[1];for(c=0;c<d;c++)e.ne[c]=-1,e.ug[c]=0,e.Mg[c]=0;for(c=0;c<g;c++)e.hg[c]=-1,e.vg[c]=0,e.Ng[c]=0;g=Array(d);d=Array(d);if(u(g,d,e)){for(c=0;c<g.length;c++)g[c]=a.Ja[2*g[c]],d[c]=b.Ja[2*d[c]];return[g,d]}return null};a.qb=A;a.$h=n;a.iv=q;a.Hh=c;a.nl=
P;a.fL=k;a.Gh=B;a.replace=function(a,b,c){for(var d=a.oa,k=e(a),g=0;g<b.length;g++){var n=b[g];p(a,n);for(var q=0;q<d.length;q+=3)d[q]==n&&(d[q]=k),d[q+1]==n&&(d[q+1]=k),d[q]==d[q+1]&&(d.splice(q,3),q-=3)}v(a,k,c)};a.fF=function(a,b,c,d,e){if(!O(a,b,c))throw"Edge not found";a=a.oa;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&(a[g]=d,a[g+1]=e)};a.lK=function(a,b){var c=a.Ja,d=a.oa,e;e="digraph debug {\n    node [shape=box];\n";for(var g=0;g<c.length;g+=2){var k=c[g],n=c[g+1],n=b?b(k,n):String(k);
e+="    ";e+=String(k)+' [label="'+n.replace(/\"/g,'\\"')+'"];\n'}for(g=0;g<d.length;g+=3)c=d[g],k=d[g+1],e+="    ",e+=String(c)+" -> "+String(k)+";\n";return e+="}"}};b4w.module.__nodemat=function(a,v){function d(a,c,d,h){if(c in ca)return ca[c];for(var k=T.create(),n=a.nodes,q=a.links,m=a.animation_data,w=0;w<n.length;w++)if(!A(k,n[w],0,m,h))return ca[c]=null;if(d&&-1==K(a,k,"GROUP_OUTPUT","group"))return null;w=g(k);if(!M(k,q,w))return null;if(d)return k;for(w=0;w<q.length;w++)for(d=q[w],h=f(d.from_node,k),n=f(d.to_node,k),m=0;m<h.length;m++)for(var l=0;l<n.length;l++){for(var C=h[m],p=n[l],B=T.qb(k,C),J=T.qb(k,p),I=k,u=J,J=[],H=d.from_socket.identifier,L=d.to_socket.identifier,
F=B.Xa,B=0;B<F.length;B++)if(F[B].identifier==H){J.push(B);break}u=u.K;for(B=0;B<u.length;B++)if(u[B].identifier==L){J.push(B);break}2==J.length&&T.Ve(I,C,p,J)}e(k);a=K(a,k,"OUTPUT","material");if(-1==a)return ca[c]=null;r(k);k=T.Mx(k,a,T.pr);b(k);t(k);x(k);y(k);return ca[c]=k}function b(a){T.U(a,function(b,c){for(var g=c.K,d=c.Xa,e=0;e<g.length;e++)p(a,g[e],b,e,1);for(e=0;e<d.length;e++)p(a,d[e],b,e,0)})}function p(a,b,c,g,d){if(b.bc){var e=!0;T.If(a,function(a,b,h){if(!d&&a==c&&h[0]==g||d&&b==c&&
h[1]==g)e=!1});e&&(b.bc=!1)}}function e(a){var b=[];T.U(a,function(c,g){switch(g.type){case "B4W_TRANSLUCENCY":T.If(a,function(a,d,e){a==c&&"Translucency"==g.Xa[e[0]].name&&b.push(a,d,[e[0]+1,e[1]+1])})}});for(var c=0;c<b.length;c+=3)T.Ve(a,b[c],b[c+1],b[c+2])}function f(a,b){var c=[];T.U(b,function(b,g){g.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function r(a){var b=[];T.U(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=
2){var g=b[c],d=b[c+1];if("B4W_PARALLAX"==d.type){var e=l(a,g);if(-1!=e){var h=T.nl(a,e,0);T.ci(a,e,g,-1);-1!=h&&T.ci(a,h,e,-1);g=T.qb(a,e);d.data=g.data;d.Ya[0]=g.Ya[0];T.Qj(a,e)}d.K.splice(1,1)}else if("REROUTE"==d.type){for(var d=T.nl(a,g,0),k=T.$h(a,g),e=[],h=[],n=[],q=0;q<k;q++){var f=T.Hh(a,g,q),m=h.indexOf(f);-1!=m?n[m]+=1:(h.push(f),n.push(1),e.push(g,f))}if(-1!=d)for(k=T.Gh(a,d,g,0)[0],q=0;q<h.length;q++)for(f=0;f<n[q];f++)m=T.Gh(a,g,h[q],f)[1],T.Ve(a,d,h[q],[k,m]);for(q=0;q<e.length;q+=
2)T.ci(a,e[q],e[q+1],-1)}}}function l(a,b){for(var c=a.oa,g=0;g<c.length;g+=3)if(c[g+1]==b&&1==c[g+2][1])return c[g];return-1}function t(a){var b=[];T.U(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],g=0;g<b.length;g+=2){for(var d=b[g],e=b[g+1],h=!0,k=0;k<c.length;k++){var n=c[k];if(u(e,n.yc)){h=[];k=T.$h(a,d);for(m=0;m<k;m++){var q=T.Hh(a,d,m),f=T.Gh(a,d,q,0);h.push(d,
q,f);T.Ve(a,n.id,q,f)}for(var m=0;m<h.length;m+=3)T.ci(a,h[m],h[m+1],0);T.Qj(a,d);h=!1;break}}h&&(n={id:d,yc:e},c.push(n))}}function m(a){for(var b={},c=0;c<a.Ja.length;c+=2){var g=a.Ja[c];b[g]=[]}for(c=0;c<a.oa.length;c+=3){var d=a.oa[c],e=a.oa[c+1];b[e].push(d);b[e].push(b[d])}for(g in b)b[g]=JSON.stringify(b[g]).match(/\d+/g)||[],b[g]=b[g].map(function(a){return parseInt(a)});return b}function x(a){var b=[];T.U(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=
m(a),g=[],d=0;d<b.length;d+=2){for(var e=b[d],h=b[d+1],k=!0,n=0;n<g.length;n++){var q=g[n];if(!(3<=q.Uh.length||!u(h,q.yc)||-1<c[e].indexOf(q.id)||-1<c[q.id].indexOf(e))){for(var f=!1,w=0;w<q.Uh.length;w++){var l=q.Uh[w].id;if(-1<c[e].indexOf(l)||-1<c[l].indexOf(e)){f=!0;break}}if(!f){for(var n=[],l=T.iv(a,e),C={},w=0;w<l;w++)f=T.nl(a,e,w),f in C||(C[f]=0),k=T.Gh(a,f,e,C[f]++),n.push(f,e,k);for(var l=[],C=T.$h(a,e),t={},w=0;w<C;w++)f=T.Hh(a,e,w),f in t||(t[f]=0),k=T.Gh(a,e,f,t[f]++),l.push(e,f,k);
k=n.concat(l);for(w=0;w<k.length;w+=3)T.ci(a,k[w],k[w+1],0);T.Qj(a,e);w={id:e,yc:h,qC:n,rC:l};q.Uh.push(w);k=!1;break}}}k&&(q={id:e,yc:h,Uh:[]},g.push(q))}for(d=0;d<g.length;d++){q=g[d];c=q.Uh.length;for(n=0;n<c;n++){h=q.Uh[n];w=h.yc;e=h.qC;h=h.rC;q.yc.K[n+1].bc=w.K[0].bc;q.yc.K[n+1].Va=w.K[0].Va;q.yc.Xa[2*(n+1)].bc=w.Xa[0].bc;q.yc.Xa[2*(n+1)].Va=w.Xa[0].Va;q.yc.Xa[2*(n+1)+1].bc=w.Xa[1].bc;q.yc.Xa[2*(n+1)+1].Va=w.Xa[1].Va;for(w=0;w<e.length;w+=3)f=e[w],k=e[w+2],k[1]+=n+1,T.Ve(a,f,q.id,k);for(w=0;w<
h.length;w+=3)f=h[w+1],k=h[w+2],k[0]+=2*(n+1),T.Ve(a,q.id,f,k);q.yc.bf.push(["USE_uv"+(n+2),1])}T.Qj(a,q.id);T.nn(a,q.id,q.yc)}}}function u(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function y(a){var b=[];T.U(a,function(a,c){"GEOMETRY_VC"==c.type&&
b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var g=b[c],d=b[c+1],e=!1,h=[],k=[],q=[[],[],[]],n=T.$h(a,g),f=0;f<n;f++){var m=T.Hh(a,g,f);if("SEPRGB"!=T.qb(a,m).type){e=!1;break}h.push(g,m);for(var w={},l=T.$h(a,m),e=0;e<l;e++){var C=T.Hh(a,m,e);C in w||(w[C]=0);var t=T.Gh(a,m,C,w[C]++);h.push(m,C);q[t[0]].push(g,C,t)}k.push(m);e=!0}if(e){for(f=g=n=0;f<q.length;f++)q[f].length&&(n++,g|=1<<2-f);if(n){d.type+=n;d.Xa=[];for(f=0;f<q.length;f++)if(q[f].length)for(d.Xa.push({Va:0,identifier:"RGB"[f],bc:!0,
name:"RGB"[f]}),e=0;e<q[f].length;e+=3)q[f][e+2][0]=z.Tj(g,f);for(f=0;f<h.length;f+=2)T.ci(a,h[f],h[f+1],0);for(f=0;f<k.length;f++)T.Qj(a,k[f]);for(f=0;f<q.length;f++)for(e=0;e<q[f].length;e+=3)T.Ve(a,q[f][e],q[f][e+1],q[f][e+2])}}}}function K(a,b,c,g){a=a.nodes;for(var d=null,e=0;e<a.length;e++){var h=a[e];h.type==c&&(d=h)}return d?f(d,b)[0]:(aa.error('No "'+c+'" node in node '+g),-1)}function G(a,b,c,g){return{name:a,type:b,inputs:c,outputs:g}}function A(a,b,c,g,d){var e=b.name,f=b.type,m=[],w=
[],l=[],t=[],r=null,p=[];switch(f){case "CAMERA":w=[];l=I(b);break;case "COMBRGB":case "COMBHSV":w=C(b);l=I(b);break;case "GEOMETRY":a:{for(var f=b.outputs,x=0;x<f.length;x++)if(f[x].is_linked){f=!0;break a}f=!1}if(!f)return!0;f=O(b,c);if(!f)return aa.error("Geometry output is not supported"),!1;switch(f){case "GEOMETRY_UV":if(!b.uv_layer)return aa.error('Missing uv layer in node "',b.name,'"'),!1;r=P("param_GEOMETRY_UV_a");x=P("param_GEOMETRY_UV_v");m.push(H(r));m.push(H(x));l.push(B(b,"UV"));t.push(H(x));
r={name:r,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return aa.error("Missing vertex color layer in node ",b.name),!1;r=P("param_GEOMETRY_VC_a");x=P("param_GEOMETRY_VC_v");m.push(H(r));m.push(H(x));l.push(B(b,"Vertex Color"));t.push(H(x));r={name:r,value:b.color_layer};break;case "GEOMETRY_NO":l.push(B(b,"Normal"));break;case "GEOMETRY_FB":l.push(B(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(B(b,"View"));break;case "GEOMETRY_GL":l.push(B(b,"Global"))}break;case "GROUP":x=b.node_tree_name;
switch(x){case "B4W_LINEAR_TO_SRGB":if(!n(b,[1],[1])){r=q(b,d);break}f="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!n(b,[1],[1])){r=q(b,d);break}f="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!n(b,[1],[1])){r=q(b,d);break}f="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!n(b,[1,1],[1])){r=q(b,d);break}f="B4W_REFLECT";break;case "B4W_REFRACTION":if(!n(b,[1,0],[1])){r=q(b,d);break}f="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!n(b,[1,1,0,0,0],[1])){r=q(b,
d);break}var f="B4W_PARALLAX",J=P("temp_texture");t.push(H(J));break;case "B4W_CLAMP":if(!n(b,[1],[1])){r=q(b,d);break}f="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!n(b,[0,0,0,0,0],[0])){r=q(b,d);break}f="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!n(b,[],[0])){r=q(b,d);break}f="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!n(b,[0,0,0],[0])){r=q(b,d);break}f="B4W_SMOOTHSTEP";break;default:r=q(b,d)}w=C(b);l=I(b);"B4W_TRANSLUCENCY"==x&&(x=h("TranslucencyParams","TranslucencyParams",[0,0,0,0]),x.bc=l[0].bc,
l.push(x));break;case "LAMP":r=b.lamp;if(!r)return aa.error("There is no lamp in node: "+b.name),!1;l.push(B(b,"Color"));l.push(B(b,"Light Vector"));l.push(B(b,"Distance"));l.push(B(b,"Visibility Factor"));r.uuid in ra?p.push(["LAMP_INDEX",String(ra[r.uuid])]):(ra[r.uuid]=sa,p.push(["LAMP_INDEX",String(sa++)]));r=ra;break;case "NORMAL":w=C(b);l=I(b);x=B(b,"Normal");t.push(H(P("param_NORMAL_Normal"),x.Va,3));break;case "MAPPING":x=b.vector_type;f="MAPPING";w.push(k(b,"Vector"));l.push(B(b,"Vector"));
var J=b.rotation,M=b.scale,u=b.translation,y=ba.create(),L=z.vC(J),v=new Float32Array([M[0],0,0,0,M[1],0,0,0,M[2]]);ba.multiply(L,v,y);y=z.wE(y,fa.create());switch(x){case "POINT":y[12]=u[0];y[13]=u[1];y[14]=u[2];break;case "TEXTURE":y[12]=u[0];y[13]=u[1];y[14]=u[2];y=fa.invert(y,y);break;case "NORMAL":fa.invert(y,y),fa.transpose(y,y)}switch(x){case "NORMAL":p.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":p.push(["MAPPING_TRS_MATRIX",Y.O(y,16)]);break;case "POINT":0!==la.length(J)?p.push(["MAPPING_TRS_MATRIX",
Y.O(y,16)]):(0!==la.length(M)&&p.push(["MAPPING_SCALE",Y.O(M,3)]),0!==la.length(u)&&p.push(["MAPPING_TRANSLATION",Y.O(u,3)]));break;case "VECTOR":0!==la.length(J)?p.push(["MAPPING_TRS_MATRIX",Y.O(y,16)]):0!==la.length(M)&&p.push(["MAPPING_SCALE",Y.O(M,3)])}b.use_min&&p.push(["MAPPING_MIN_CLIP",Y.O(b.min,3)]);b.use_max&&p.push(["MAPPING_MAX_CLIP",Y.O(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":r=k(b,"Color");r.Va.splice(3);w.push(r);(r=k(b,"Alpha"))?w.push(r):w.push(h("Alpha","Alpha",1));
r=k(b,"Spec");r.Va.splice(3);w.push(r);x=k(b,"Normal");x.Va.splice(3);w.push(x);l.push(B(b,"Color"));l.push(B(b,"Alpha"));l.push(B(b,"Normal"));"MATERIAL_EXT"==f&&((r=k(b,"Emit"))?w.push(r):w.push(h("Emit","Emit",0)),r=k(b,"Translucency"),r.Va=0,r.name="Translucency",r.identifier="Translucency",r?w.push(r):w.push(h(r.name,r.identifier,r.Va)),r=k(b,"Translucency"),r.Va=[0,0,0,0],r.name="TranslucencyParams",r.identifier="TranslucencyParams",r?w.push(r):w.push(h(r.name,r.identifier,r.Va)),r=k(b,"Reflectivity"),
J=k(b,"Ray Mirror"),r?J="Reflectivity":J?(r=J,J="Ray Mirror"):J="Reflectivity",r?w.push(r):w.push(h(J,J,0)),(r=k(b,"SpecTra"))?w.push(r):w.push(h("SpecTra","SpecTra",0)),l.push(B(b,"Diffuse")),l.push(B(b,"Spec")));J=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":r=b.specular_hardness;break;case "WARDISO":r=b.specular_slope;break;case "TOON":r=b.specular_toon_size;J=b.specular_toon_smooth;break;default:aa.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+
'")'),r=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":u=M=0;break;case "OREN_NAYAR":M=b.roughness;u=0;break;case "FRESNEL":M=b.diffuse_fresnel;u=b.diffuse_fresnel_factor;break;default:aa.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),u=M=0}t.push(H(P("param_MATERIAL_diffuse"),[M,u],2));t.push(H(P("param_MATERIAL_spec"),[b.specular_intensity,r,J],3));r={name:b.name,value:{qG:b.specular_shader,jC:b.diffuse_shader,ah:b.use_shadeless,ji:b.specular_alpha}};
x.bc&&p.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&p.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&p.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";break;case "DIVIDE":f="MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f="MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";
break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f="MATH_GREATER_THAN";break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";break;default:return aa.error("Unsupported MATH operation: "+b.operation),!1}p.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);
w=C(b);l=I(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f="MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f=
"MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return aa.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}p.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);w=C(b);l=I(b);break;case "OUTPUT":w=C(b);l=[];break;case "RGB":x=d+"%join%"+b.name;x={name:"-1",value:x};
t.push(x);l.push(B(b,"Color"));break;case "SEPRGB":case "SEPHSV":w=C(b);l=I(b);break;case "TEXTURE":f=F(b);if("TEXTURE_EMPTY"==f)l.push(B(b,"Color")),l.push(B(b,"Normal")),l.push(B(b,"Value"));else if("TEXTURE_ENVIRONMENT"==f)w.push(k(b,"Vector")),l.push(B(b,"Color")),l.push(B(b,"Value"));else{if("TEXTURE_NORMAL"==f&&"ENVIRONMENT_MAP"==b.texture.type)return aa.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;for(M=0;4>M;++M)M?(r=h("Vector"+M,"Vector"+M,[0,0,0]),"TEXTURE_COLOR"==f&&(x=
h("Color"+M,"Color"+M,[0,0,0]),J=h("Value"+M,"Value"+M,0)),"TEXTURE_NORMAL"==f&&(x=h("Normal"+M,"Normal"+M,[0,0,0]),J=h("Value"+M,"Value"+M,0))):(r=k(b,"Vector"),"TEXTURE_COLOR"==f&&(x=B(b,"Color"),J=B(b,"Value")),"TEXTURE_NORMAL"==f&&(x=B(b,"Normal"),J=B(b,"Value"))),w.push(r),l.push(x),l.push(J)}J=P("param_TEXTURE_texture");t.push(H(J));r={name:J,value:b.texture};break;case "VALUE":f="VALUE";x=d+"%join%"+b.name;x={name:"-1",value:x};t.push(x);l.push(B(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":f=
"VECT_MATH_ADD";break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return aa.error("Unsupported VECT_MATH operation: "+b.operation),!1}w=C(b);l=I(b);break;default:w=C(b),l=I(b)}e={name:e,type:f,hk:m,K:w,Xa:l,Ya:t,data:r,bf:p};T.nn(a,T.Xt(a),e);if(e="GEOMETRY"==b.type)a:{e=b.outputs;for(w=m=0;w<e.length;w++)if(e[w].is_linked&&
m++>c){e=!0;break a}e=!1}return e&&!A(a,b,++c,g,d)?!1:!0}function n(a,b,c){for(var g=a.inputs,d=a.outputs,e=a.node_tree_name,h=0;h<b.length;h++){var k=g[h],f=b[h];if(!k||k.default_value instanceof Array!=f)return aa.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),!1}for(h=0;h<c.length;h++)if(b=d[h],g=c[h],!b||b.default_value instanceof Array!=g)return aa.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),
!1;return!0}function q(a,b){var g=a.node_group.node_tree,e={},h;for(h in g)if("links"==h||"nodes"==h){e[h]=[];for(var k=0;k<g[h].length;k++){e[h][k]={};for(var f in g[h][k])if("links"==h){e[h][k][f]={};for(var q in g[h][k][f])e[h][k][f][q]=c(g[h][k][f][q])}else e[h][k][f]=c(g[h][k][f])}}else e[h]=c(g[h]);g=a.node_tree_name;if("B4W_REPLACE"==g||"B4W_LEVELS_OF_QUALITY"==g)h=G("Group input","GROUP_INPUT",[],a.inputs),k=G("Group output","GROUP_OUTPUT",a.outputs,[]),f=null,f="B4W_REPLACE"==g||"B4W_LEVELS_OF_QUALITY"==
g&&(qa.quality==ea.Wf||qa.Ao)?{from_node:h,from_socket:h.outputs[1],to_node:k,to_socket:k.inputs[0]}:{from_node:h,from_socket:h.outputs[0],to_node:k,to_socket:k.inputs[0]},e.nodes=[h,k],e.links=[f];g=a.name;h=e.nodes;k=e.links;for(f=0;f<h.length;f++)h[f].name=w(h[f].type,g,h[f].name);for(f=0;f<k.length;f++)k[f].from_node.name=w(k[f].from_node.type,g,k[f].from_node.name),k[f].to_node.name=w(k[f].to_node.type,g,k[f].to_node.name);return{IE:d(e,a.node_group.uuid,!0,b),JE:e.links}}function c(a){var b=
typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?z.Qk(a):a}function P(a){ma[a]||(ma[a]=0);var b=a+ma[a],b=b.replace(/ /g,"_").replace(/\//g,"_");ma[a]++;return b}function O(a,b){for(var c=a.outputs,g=0,d=0;d<c.length;d++){var e=c[d];if(e.is_linked&&!(g++<b))switch(e.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}
function F(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,g=!1,d=!1,e=0;e<b.length;e++){var h=b[e];if(h.is_linked)switch(h.identifier){case "Color":c=!0;break;case "Normal":g=!0;break;case "Value":d=!0;break;default:throw"Unknown texture output";}}if(c)return g&&aa.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(g)return"TEXTURE_NORMAL";if(d)return"ENVIRONMENT_MAP"==a.texture.type?
"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function k(a,b){for(var c=a.inputs,g=0;g<c.length;g++){var d=c[g];if(d.identifier==b)return J(d)}return null}function B(a,b){for(var c=a.outputs,g=0;g<c.length;g++){var d=c[g];if(d.identifier==b)return J(d)}return null}function J(a){var b=a.name,c=a.identifier,g=a.is_linked;a=a.default_value;a=z.yg(a)?a.slice(0):a;return{name:b,identifier:c,bc:g,Va:a}}function h(a,b,c){return{name:a,identifier:b,bc:!1,Va:c}}function C(a){for(var b=[],c=0;c<a.inputs.length;c++){var g=
J(a.inputs[c]);g.Va.length&&g.Va.splice(3);b.push(g)}return b}function I(a){for(var b=[],c=0;c<a.outputs.length;c++){var g=J(a.outputs[c]);b.push(g)}return b}function H(a,b,c){b=null===b||void 0===b?null:Y.O(b,c);return{name:a,value:b}}function w(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function g(a){var b=[];T.U(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function M(a,b,c){for(var g=0;g<c.length;g++){var d=c[g].data.IE,e=c[g].data.JE;if(!d)return!1;
T.U(d,function(b,c){T.nn(a,T.Xt(a),c)});for(d=0;d<e.length;d++)b.push(e[d]);X(c[g],b,a)}return!0}function L(a,b,c,g,d,e){switch(a.type){case "GROUP":a.name==b&&g.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||d.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||e.push(c)}}function R(a,b,c){for(var g=[],d=0;d<c.length;d++){for(var e=c[d],h=null,k=0;k<b.length;k++)if(e.from_socket.identifier==b[k].to_socket.identifier){h=b[k];break}h?(e.from_node=h.from_node,e.from_socket=h.from_socket):
g.push(e)}for(d=0;d<b.length;d++)a.splice(a.indexOf(b[d]),1);return g}function U(a,b){if(b.length)for(var c=b[0].from_node.name,g=0;g<a.length;g++)a[g].from_node.name==c&&b.push(a[g])}function Z(a,b,c,g){for(var d=0;d<g.length;d++){for(var e=g[d],h,k=0;k<c.K.length;k++)if(e.from_socket.identifier==c.K[k].identifier){h=c.K[k].Va;break}for(var k=e,q=b,n=h,m=f(k.to_node,q),w=0;w<m.length;w++)for(var l=T.qb(q,m[w]),C=0;C<l.K.length;C++)if(l.K[C].identifier==k.to_socket.identifier){l.K[C].Va=n;break}e=
a.indexOf(e);-1!=e&&a.splice(e,1)}}function X(a,b,c){for(var g=a.name,d=[],e=[],h=[],k=[],f=0;f<b.length;f++){var q=b[f];L(q.from_node,g,q,d,h,k);L(q.to_node,g,q,e,h,k)}e=R(b,e,h);d=R(b,k,d);U(b,e);Z(b,c,a,e);if(d.length){var n;T.U(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(g+"*GO*")||(n=b)});Z(b,c,n,d)}}var aa=v("__print"),T=v("__graph"),Y=v("__shaders"),z=v("__util"),ea=v("__config"),la=v("vec3");v("vec4");var ba=v("mat3"),fa=v("mat4"),ma={},ca={},ra={},sa=0;new Float32Array(4);var qa=
ea.q;a.nB=d;a.oB=function(a){var b=[],c={};ma={};var g=T.Nq(a);T.U(g,function(a,g){var d;d=[];for(var e=[],h=[],k=[],f=[],q=[],n=0;n<g.K.length;n++){var m=g.K[n];if(m.bc)d.push(null),e.push(null);else{d.push(P("in_"+g.type+"_"+m.identifier));var w=Y.O(m.Va,0);qa.sx&&(0<=g.type.indexOf("MIX_RGB_")&&("Color1"==m.identifier||"Color2"==m.identifier||"Fac"==m.identifier)||0<=g.type.indexOf("MATH_")&&("Value"==m.identifier||"Value_001"==m.identifier)||0<=g.type.indexOf("VECT_MATH_")&&"Vector_001"==m.identifier)&&
(m=w,m=m.replace(/(,)/g,"$1 "),m=m.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),m=m.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),w=m=m.replace(/\s+/g,""));e.push(w)}}for(n=0;n<g.Xa.length;n++)m=g.Xa[n],m.bc?h.push(null):h.push(P("out_"+g.type+"_"+m.identifier));for(n=0;n<g.Ya.length;n++)m=g.Ya[n],k.push(m.name),f.push(m.value);for(n=0;n<g.hk.length;n++)q.push(g.hk[n].name);d={id:g.type,K:d,dp:e,Xa:h,Ya:k,Yl:f,hk:q,bf:JSON.parse(JSON.stringify(g.bf))};
b.push(d);c[a]=d});T.If(g,function(a,b,d){var e=T.qb(g,a);T.qb(g,b);var h=e.Xa[d[0]];a=c[a].Xa;b=c[b].K;e=a[d[0]]||P("out_"+e.type+"_"+h.identifier);a[d[0]]=e;b[d[1]]=e});return b};a.Y=function(){for(var a in ca)delete ca[a];for(var b in ra)delete ra[b];sa=0}};b4w.module.__shaders=function(a,v){function d(a,c,d){var e=a.ig;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.ig,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function p(a,b){var c=a+b;if(P[c])return P[c];if(n){var d=n[b];if(!d)return null}else{d=G.KD(a+b);if(!d)return null;d=q.pw.parse(d)}return P[c]=d}function e(a,b,c){function d(b){b=b.a;for(var c=0;c<b.length;c++){var r=b[c];switch(r.type){case "condition":a:for(var r=
r.a,B=0;B<r.length;B++){var J=r[B];switch(J.type){case "if":case "elif":var L=J.c;try{var O=e(L)}catch(K){throw"Failed to process #"+J.type+" expression: "+L.join(" ");}if(O){d(J.group);break a}break;case "else":d(J.group);break a;case "ifdef":J.name in l&&d(J.group);break;case "ifndef":J.name in l||d(J.group)}}break;case "include":r=p(A.shaders_dir,A.dG+r.file);d(r);break;case "var":case "export":case "import":break;case "define":B=r.name;l[B]=r.b;r.Ya&&(x[B]=r.Ya);break;case "error":throw"Shader error: #error "+
r.b.join(" ");case "line":break;case "pragma":g.push("#pragma "+r.name+" "+r.b.join(" "));break;case "undef":r=r.name;delete l[r];delete x[r];break;case "warning":u.warn("Shader warning: #warning "+r.b.join(" "));break;case "extension":g.push("#extension "+f(r.b,l,x,!1));break;case "#":break;case "node":y[r.name]=r;break;case "nodes_global":r=n;for(B=0;B<r.length;B++)if(J=r[B],L=y[J.id])for(var qa=0,V=0;V<L.k.length;V++){var S=L.k[V];"node_param"==S.type&&(S=S.qualifier.join(" ")+" ","vert"==a?S+=
J.hk[qa]:"frag"==a&&(S+=J.Ya[qa],null!==J.Yl[qa]&&(S+=" = "+J.Yl[qa])),S+=";",g.push(S),qa++)}break;case "nodes_main":r=n;for(B=0;B<r.length;B++)if(J=r[B],L=y[J.id]){qa={};V={};for(S=0;S<J.bf.length;S++)V[J.bf[S][0]]=[J.bf[S][1]];z=P=G=0;for(var S=J,E=L.k,N=qa,ha=V,oa=0;oa<E.length;oa++){var ka=E[oa];switch(ka.type){case "node_in":var aa=S.K[G];if(null!==S.dp[G]){if(("MATERIAL"==S.id&&3===G||"MATERIAL_EXT"==S.id&&3===G||"TEXTURE_COLOR"==S.id||"TEXTURE_NORMAL"==S.id)&&ka.e){N[ka.name]=S.dp[G];G++;
continue}var da=ka.qualifier.join(" ")+" ",da=da+aa,da=da+(" = "+S.dp[G]),da=da+";";g.push(da)}N[ka.name]=aa;G++;break;case "node_out":aa=S.Xa[P];if(!ka.e||-1<v.indexOf(aa))da=ka.qualifier.join(" ")+" ",da+=aa,da+=";",g.push(da),N[ka.name]=aa;-1<v.indexOf(aa)&&(ha["USE_OUT_"+ka.name]=[1]);P++;break;case "node_param":"vert"==a?aa=S.hk[z]:"frag"==a&&(aa=S.Ya[z]),N[ka.name]=aa,z++}}g.push("{");q(J,L.f,qa,V);g.push("}")}break;case "lamp":F[r.name]=r;break;case "lamps_main":r=m;for(B=0;B<r.length;B++)if(J=
r[B],J.iE){g.push("{");L=F[J.type].f;for(qa=0;qa<L.length;qa++){V=L[qa];S=[];for(E=0;E<V.b.length;E++){N=V.b[E];switch(N){case "LAMP_IND":N=J.index;break;case "LAMP_LIGHT_FACT_IND":N=J.oE;break;case "LAMP_FAC_CHANNELS":N=J.nE;break;case "LAMP_SPOT_SIZE":N=t(J.Rd);break;case "LAMP_SPOT_BLEND":N=t(J.li||.01);break;case "LAMP_LIGHT_DIST":N=t(J.distance);break;case "LAMP_SHADOW_MAP_IND":N=J.PC?1:0}S.push(N)}g.push(S.join(" "))}g.push("}")}break;case "textline":g.push(f(r.b,l,x,!1));break;default:throw"Unknown element type: "+
r.type;}}}function e(a,b){var c=f(a,l,x,!0,b);return K.pw.parse(c)}function q(a,b,c,d){for(var h=0;h<b.length;h++){var k=b[h];switch(k.type){case "node_condition":a:for(var n=a,k=k.a,m=c,w=d,r=0;r<k.length;r++){var t=k[r];switch(t.type){case "node_if":case "node_elif":var p=t.c;try{var B=e(p,w)}catch(J){throw"Failed to process #"+t.type+" expression: "+p.join(" ");}if(B){q(n,t.f,m,w);break a}break;case "node_else":q(n,t.f,m,w);break a;case "node_ifdef":(t.name in l||t.name in w)&&q(n,t.f,m,w);break;
case "node_ifndef":t.name in l||t.name in w||q(n,t.f,m,w)}}break;case "textline":n=[];for(m=0;m<k.b.length;m++)w=k.b[m],w in c?n.push(c[w]):n.push(w);g.push(f(n,l,x,!0,d))}}}var n=c.Jp,m=c.qp;c=c.ig||[];for(var g=[],l={},r=0;r<c.length;r++)l[c[r][0]]=[c[r][1]];for(r=0;r<n.length;r++)l["USE_NODE_"+n[r].id]=[1];var x={},y={},F={},v=[];for(r in n)for(var O in n[r].K)v.push(n[r].K[O]);d(b);var G=0,P=0,z=0;return g.join("\n")}function f(a,b,c,d,e){var f=[];r(a,b,c,d,f,e);return f.join(" ")}function r(a,
b,c,d,e,f){for(var n=0;n<a.length;n++){var q=a[n];q in b||f&&q in f?(q=f&&f[q]||b[q],0==q.length&&d?e.push(0):r(q,b,c,d,e,f)):e.push(q)}}function l(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);y.bB(d,b,c);return d}function t(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return m(a);case 2:return"vec2("+m(a[0])+","+m(a[1])+")";case 3:return"vec3("+m(a[0])+","+m(a[1])+","+m(a[2])+")";case 4:return"vec4("+m(a[0])+","+m(a[1])+","+m(a[2])+","+m(a[3])+")";case 9:return"mat3("+
m(a[0])+","+m(a[1])+","+m(a[2])+","+m(a[3])+","+m(a[4])+","+m(a[5])+","+m(a[6])+","+m(a[7])+","+m(a[8])+")";case 16:return"mat4("+m(a[0])+","+m(a[1])+","+m(a[2])+","+m(a[3])+","+m(a[4])+","+m(a[5])+","+m(a[6])+","+m(a[7])+","+m(a[8])+","+m(a[9])+","+m(a[10])+","+m(a[11])+","+m(a[12])+","+m(a[13])+","+m(a[14])+","+m(a[15])+")";default:throw"Wrong glsl value dimension";}}function m(a){return a%1?String(a):String(a)+".0"}var x=v("__config"),u=v("__print"),y=v("__debug"),K=v("__gpp_eval"),G=v("__assets");
v("__util");var A=x.cc;if(b4w.module_check("shader_texts"))var n=v("shader_texts"),q=null;else n=null,q=v("__gpp_parser");var c={},P={},O=[],F=null;a.Lc=function(a){F=a};a.u=d;a.qD=b;a.cM=function(a,b){for(var c=a.ig,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.JF=function(a){a.ig=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_SKY_BLEND USE_SKY_PAPER USE_SKY_REAL USE_SKY_TEXTURE WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var e=b[c],f;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_SKY_BLEND":case "USE_SKY_PAPER":case "USE_SKY_REAL":case "USE_SKY_TEXTURE":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "SHADOW_TEX_RES":f=t(2048);break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f="POST_EFFECT_NONE";break;case "SHADOW_SRC":f="SHADOW_SRC_NONE";break;case "SHADOW_DST":f=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":f="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":f=x.q.precision;break;case "EPSILON":f="highp"==x.q.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":f="u_va_frame_factor";break;default:u.error("Unknown directive ("+a.Lm+", "+a.il+"): "+e)}d(a,e,f)}};a.KL=function(a){return a.Lm};a.su=function(a){return a.il};a.VL=function(a,c){for(var e=
c.ig,h=0;h<e.length;h++){var f=e[h][0],n=e[h][1];b(a,f)&&d(a,f,n)}};a.jD=function(a){var b=JSON.stringify(a),d=c[b];if(d)return d;var h=a.il,d=p(A.shaders_dir,a.Lm),h=p(A.shaders_dir,h);if(!d||!h)return null;var f=e("vert",d,a),n=e("frag",h,a),d=F,q=l(d,b,f,d.VERTEX_SHADER),m=l(d,b,n,d.FRAGMENT_SHADER),h=d.createProgram();d.attachShader(h,q);d.attachShader(h,m);d.linkProgram(h);d.validateProgram(h);d.getProgramParameter(h,d.VALIDATE_STATUS)==d.QH&&u.error("shader program is not valid",b);y.cB(h,b,
q,m,f,n);a={ky:q,OC:m,Kj:h,attributes:{},ck:{},Fj:[],Qp:{},Wx:[],ub:a};n=d.getProgramParameter(h,d.ACTIVE_ATTRIBUTES);for(f=0;f<n;f++)q=d.getActiveAttrib(h,f).name,a.attributes[q]=d.getAttribLocation(h,q);n=d.getProgramParameter(h,d.ACTIVE_UNIFORMS);for(f=0;f<n;f++)q=d.getActiveUniform(h,f).name.split("[0]").join(""),a.ck[q]=d.getUniformLocation(h,q);return c[b]=d=a};a.mK=function(){return O};a.kD=function(){return c};a.Y=function(){for(var a in c){var b=c[a];F.deleteProgram(b.Kj);F.deleteShader(b.ky);
F.deleteShader(b.OC);delete c[a]}for(var d in P)delete P[d];for(var e in O)delete O[e]};a.nK=function(a){var b=a.ig;u.log("Shader: "+a.Lm+" "+a.il+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)u.log("  "+b[a][0],b[a][1])};a.O=t;a.Rs=function(a,b){return b in a.ck?!0:!1};a.MD=function(a){return(F.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__debug=function(a,v){function d(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&r.pa("Structure assertion failed: incompatible types");for(var c in a)c in b||r.pa("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||r.pa("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&r.pa("Structure assertion failed: incompatible types for key "+c)}var p=
v("__extensions"),e=v("__print"),f=v("__textures"),r=v("__util"),l=null,t={},m=!1,x={},u=[],y=-1,K=null,G=!1;a.Sr={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Lc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(t[a[d]]=d)}l=a};a.aB=function(a){if(m){var b=l.getError();b!=l.NO_ERROR&&(b in t?r.pa("GL Error: "+b+", gl."+t[b]+" ("+
a+")"):r.pa("Unknown GL error: "+b+" ("+a+")"))}};a.VA=function(){if(m)switch(l.checkFramebufferStatus(l.FRAMEBUFFER)){case l.FRAMEBUFFER_COMPLETE:break;case l.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case l.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case l.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case l.FRAMEBUFFER_UNSUPPORTED:e.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:e.error("FRAMEBUFFER CHECK FAILED")}};a.YA=function(){if(-1!=y)return y;l.bindFramebuffer(l.FRAMEBUFFER,l.createFramebuffer());var a=f.Yk("DEBUG",f.Hi);f.resize(a,1,1);l.framebufferTexture2D(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,a.Xb,a.$a,0);l.checkFramebufferStatus(l.FRAMEBUFFER)!=l.FRAMEBUFFER_COMPLETE?(y=!0,e.warn("depth-only issue was found")):y=!1;l.bindFramebuffer(l.FRAMEBUFFER,null);return y};
a.bB=function(a,b,c){if(m&&!l.getShaderParameter(a,l.COMPILE_STATUS))throw c=d(c),e.error("shader compilation failed:\n"+c+"\n"+l.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.cB=function(a,b,c,f,r,t){if(m&&!l.getProgramParameter(a,l.LINK_STATUS)){var k=p.oD();k&&(r=k.getTranslatedShaderSource(c),t=k.getTranslatedShaderSource(f));r=d(r);t=d(t);e.error("shader linking failed:\n"+r+"\n\n\n"+t+"\n"+l.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";
}};a.kq=function(a){m=a};a.BK=function(a){x[a]=a in x?x[a]+1:1};a.update=function(){for(var a in x)e.log(a,x[a]),x[a]=0};a.gl=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(r.yg(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}u.push(a)};a.Nv=function(){for(var a=1,b=0;b<u.length;b++){var c=u[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],r.yg(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);
u.push(c)};var A=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.vw=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),f=0;f<u.length;f++){var m=u[f];a=m[0];if(!(a<d)){var k=String(m[1]);c[k]||(c[k]=A[b++%A.length]);a=["%c"+(a/1E3).toFixed(6),c[k],k];for(k=2;k<m.length;k++)a.push(m[k]);e.log.apply(this,a)}}u.splice(0)};a.Sp=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),d=0;d<u.length;d++){var f=u[d];a=f[0];
if(!(a<c))for(var m=2;m<f.length;m++){var k=String(f[1]);3<f.length&&(k+="_"+String(m-2));b[k]||(b[k]=k+"\n");b[k]+=String(a)+" "+f[m]+"\n"}}a="";for(k in b)a+=b[k]+"\n\n";e.log(a);u.splice(0)};a.JJ=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&
b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.Ps=function(a){if(r.yg(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.tJ=function(a,b){typeof a!=b&&r.pa("Type assertion failed: value type is not a {"+b+"}:",a)};a.rJ=b;a.sJ=function(a){G?b(a,K):G=!0;K=a}};b4w.module.__textures=function(a,v){function d(){return{name:"",type:0,source:"",width:0,height:0,Rn:1,Ak:!0,Xg:1024,Dt:!1,le:null,Oa:null,di:null,Sw:1,Ge:0,ei:!1,Nm:!1,xg:!1,W:0,Ha:0,Eh:0,mH:!1,Yg:!1,Fp:0,ic:0,Xb:0,$a:null,Nf:null}}function b(b,c,e){var f=b.type,m=new Uint8Array([204,204,204,255]),w=d();switch(f){case "DATA_TEX2D":case "IMAGE":var g=k.createTexture(),l=k.TEXTURE_2D;k.bindTexture(l,g);k.texImage2D(l,0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,m);b.image&&"MOVIE"==b.image.source&&(w.xg=
!0,w.W=b.frame_start,w.Ha=b.frame_offset,w.Eh=b.frame_duration,w.mH=b.use_auto_refresh,w.Yg=b.use_cyclic,w.Fp=b.movie_length,0!=w.Ha&&K.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":g=k.createTexture();l=k.TEXTURE_2D;k.bindTexture(l,g);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(e=n.Rb("name",b.b4w_source_id,e)))w.Xg=b.b4w_source_size,e.vd=e.vd||[],e.vd.push(b),
k.texImage2D(l,0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,m);else return null;break;case "ENVIRONMENT_MAP":g=k.createTexture();l=k.TEXTURE_CUBE_MAP;k.bindTexture(l,g);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var r=0;6>r;r++)q.ep?k.texImage2D(k["TEXTURE_CUBE_MAP_"+e[r]],0,k.RGB,1,1,0,k.RGB,k.UNSIGNED_BYTE,m):k.texImage2D(k["TEXTURE_CUBE_MAP_"+e[r]],0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,m);break;case "VORONOI":case "BLEND":return null;default:return K.error('texture "'+
b.name+'" has unsupported type "'+f+'"'),null}("NONE"!=f||b.b4w_enable_canvas_mipmapping&&"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=f?q.ep?k.texParameteri(l,k.TEXTURE_MIN_FILTER,k.LINEAR):k.texParameteri(l,k.TEXTURE_MIN_FILTER,B[q.Cm]):k.texParameteri(l,k.TEXTURE_MIN_FILTER,k.LINEAR);k.texParameteri(l,k.TEXTURE_MAG_FILTER,k.LINEAR);m=l;e=b.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=c);"OFF"!==e&&q.Bk&&(c=A.eD())&&(e=parseFloat(e.split("x")[0]),k.texParameterf(m,c.TEXTURE_MAX_ANISOTROPY_EXT,e));
"REPEAT"!=b.extension||b.b4w_shore_dist_map?(k.texParameteri(l,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(l,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE)):(k.texParameteri(l,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(l,k.TEXTURE_WRAP_T,k.REPEAT));w.type=a.ih;w.width=1;w.height=1;w.$a=g;w.Xb=l;"CANVAS"==b.b4w_source_type&&"NONE"==f?(f=b.b4w_source_id,g=b.b4w_source_size,w.Dt=b.b4w_enable_canvas_mipmapping,w.name=f,w.source="CANVAS",l=document.createElement("canvas"),l.setAttribute("id",f),l.width=g,l.height=
g,w.le=l.getContext("2d"),O[f]=w,p(w)):"SCENE"==b.b4w_source_type&&"NONE"==f?(w.name=b.b4w_source_id,w.source="SCENE"):(w.name=b.name,w.source=f,k.generateMipmap(l),k.bindTexture(l,null));return b.d=w}function p(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Xb;k.bindTexture(b,a.$a);var c=l(a),d=t(a),e=a.le.canvas;k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!0);k.texImage2D(b,0,c,c,d,e);k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1);a.Dt&&k.generateMipmap(b);k.bindTexture(b,null);a.width=e.width;a.height=
e.height}function e(a){var b=a.Xb;k.bindTexture(b,a.$a);k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!0);k.texImage2D(b,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,a.di[a.Ge]);k.bindTexture(b,null)}function f(a){k.texParameteri(a,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(a,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texParameteri(a,k.TEXTURE_MAG_FILTER,k.LINEAR);k.texParameteri(a,k.TEXTURE_MIN_FILTER,k.LINEAR)}function r(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}
function l(b){switch(b.type){case a.ih:b=k.RGBA;break;case a.bn:b=k.RGB;break;case a.wk:b=k.RGBA;break;case a.xk:b=k.RGB;break;case a.Hi:b=k.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function t(b){switch(b.type){case a.ih:b=k.UNSIGNED_BYTE;break;case a.bn:b=k.UNSIGNED_BYTE;break;case a.wk:b=k.FLOAT;break;case a.xk:b=k.FLOAT;break;case a.Hi:b=k.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function m(a){return a in F?(q.dd?F[a].ei=!0:F[a].Oa.play(),!0):null}
function x(a){return a in F?(a=F[a],q.dd?(a.Ge=a.Ha,e(a),a.Ge++):a.Oa.currentTime=a.Ha/a.ic,!0):null}function u(a){return a in F?(q.dd?F[a].ei=!1:F[a].Oa.pause(),!0):null}var y=v("__config"),K=v("__print"),G=v("__dds"),A=v("__extensions"),n=v("__util"),q=y.q,c=y.he,P=y.pd;a.ce=0;a.H=0;a.Mz=0;a.Kz=0;a.Lz=0;a.Jz=0;a.ih=10;a.bn=20;a.wk=30;a.xk=40;a.Hi=50;a.hh=60;var O={},F={},k=null,B;a.Lc=function(b){B=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];
a.ce=b.NEAREST;a.H=b.LINEAR;a.Mz=b.NEAREST_MIPMAP_NEAREST;a.Kz=b.LINEAR_MIPMAP_NEAREST;a.Lz=b.NEAREST_MIPMAP_LINEAR;a.Jz=b.LINEAR_MIPMAP_LINEAR;k=b};a.aL=function(a){return a in O?O[a].le:null};a.cO=function(a){return a in O?(p(O[a]),!0):!1};a.Yk=function(b,c){var e=d();e.name=b;e.type=c;e.source="NONE";if(c==a.hh)e.Nf=k.createRenderbuffer();else{var f=k.TEXTURE_2D,q=k.createTexture();k.bindTexture(f,q);k.texParameteri(f,k.TEXTURE_MAG_FILTER,k.LINEAR);k.texParameteri(f,k.TEXTURE_MIN_FILTER,k.LINEAR);
k.texParameteri(f,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(f,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.bindTexture(f,null);e.Xb=f;e.$a=q}return e};a.CB=function(b){var c=k.createTexture(),e=k.TEXTURE_CUBE_MAP;k.bindTexture(e,c);k.texParameteri(e,k.TEXTURE_MAG_FILTER,k.LINEAR);k.texParameteri(e,k.TEXTURE_MIN_FILTER,k.LINEAR);k.texParameteri(e,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(e,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
q=0;6>q;q++)k.texImage2D(k[f[q]],0,k.RGBA,b,b,0,k.RGBA,k.UNSIGNED_BYTE,null);k.bindTexture(e,null);e=d();e.name="CUBEMAP";e.type=a.ih;e.source="NONE";e.width=3*b;e.height=2*b;e.Rn=1;e.$a=c;e.Xb=k.TEXTURE_CUBE_MAP;return e};a.mq=function(b,c,d){if(b.type!=a.hh){var e=b.Xb;k.bindTexture(e,b.$a);c&&k.texParameteri(e,k.TEXTURE_MIN_FILTER,c);d&&k.texParameteri(e,k.TEXTURE_MAG_FILTER,d);k.bindTexture(e,null)}};a.hL=function(b){if(b.type==a.hh)return{min:a.ce,rE:a.ce};var c=b.Xb;k.bindTexture(c,b.$a);b=
k.getTexParameter(c,k.TEXTURE_MIN_FILTER);var d=k.getTexParameter(c,k.TEXTURE_MAG_FILTER);k.bindTexture(c,null);return{min:b,rE:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.hh)k.bindRenderbuffer(k.RENDERBUFFER,b.Nf),k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_COMPONENT16,c,d),k.bindRenderbuffer(k.RENDERBUFFER,null);else{var e=b.Xb;k.bindTexture(e,b.$a);var f=l(b),n=t(b);k.texImage2D(e,0,f,c,d,0,f,n,null);k.bindTexture(e,null)}c>q.Id||d>q.Id?
K.error('Slink texture "'+b.name+'" has unsupported size'):(b.width=c,b.height=d)}};a.VB=b;a.jH=function(a){var b=a.Xb;k.bindTexture(b,a.$a);k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Oa.length?k.texImage2D(b,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,a.Oa):k.texImage2D(b,0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,a.Oa);k.bindTexture(b,null)};a.gH=e;a.dk=function(a,b,d,e){var n=a.source,m=a.Xb;k.bindTexture(m,a.$a);if(4==b.length){var g=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==n)if(g)k.texImage2D(m,
0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(d){d=G.Su(b);if(d.width>q.Id||d.height>q.Id){K.error("texture has unsupported size",e);return}G.lH(k,A.Du(),b,!0);r(d.width,d.height)&&(a.xs||K.warn("using NPOT texture",e),f(m));a.width=d.width;a.height=d.height;a.Rn=G.lD(b)}else{k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>q.Id||b.height>q.Id){K.error("texture has unsupported size",e);return}a.xg?q.dd?b&&(F[a.name]=a,a.di=b,a.ic=a.Fp/b.length,a.Eh=Math.round(a.Eh/a.ic),
a.Ha=Math.round(a.Ha/a.ic),a.W=Math.round(a.W/a.ic),a.Ge=a.Ha,k.texImage2D(m,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,a.di[0])):(a.Oa=b,a.Oa.loop=a.Yg,b&&(F[a.name]=a),a.ic=c.Ma,b.duration&&(a.ic=a.Fp/b.duration),P.At||(b.playbackRate=c.Ma/a.ic,P.Ss&&2<b.playbackRate&&(b.playbackRate=2)),k.texImage2D(m,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,a.Oa)):k.texImage2D(m,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,b);q.dd&&a.xg?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);r(b.width,b.height)?(a.xs||(a.xg?
K.warn("using NPOT video texture",e):K.warn("using NPOT texture",e)),f(m)):a.xg||k.generateMipmap(m)}else if("ENVIRONMENT_MAP"==n)if(d=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],g){for(g=0;6>g;g++)n=d[g],k.texImage2D(k["TEXTURE_CUBE_MAP_"+n[0]],0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1);var l=b.width/3;if(l>q.Ap||l>q.Ap){K.error("cubemap has unsupported size",e);
return}for(g=0;6>g;g++){var n=d[g],t=document.createElement("canvas");t.width=l;t.height=l;var x=t.getContext("2d");"POSITIVE_Y"==n[0]||"NEGATIVE_Y"==n[0]?(x.translate(0,l),x.scale(1,-1)):(x.translate(l,0),x.scale(-1,1));x.drawImage(b,n[1]*l,n[2]*l,l,l,0,0,l,l);k.texImage2D(k["TEXTURE_CUBE_MAP_"+n[0]],0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,t)}a.width=3*l;a.height=2*l;r(b.width/3,b.height/2)?(K.warn("using NPOT cube map texture",e),f(m)):k.generateMipmap(m)}else"DATA_TEX2D"==n&&(k.texImage2D(m,0,k.RGBA,b.width,
b.height,0,k.RGBA,k.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);k.bindTexture(m,null)};a.hC=function(a){k.deleteTexture(a)};a.tj=function(a){return a&&a.name&&(a.$a||a.Nf)?!0:!1};a.rv=function(a){return a&&a.name&&a.Nf?!0:!1};a.dM=function(b){return b.type==a.wk||b.type==a.xk?!0:!1};a.LD=function(b){var c=0;switch(b.type){case a.ih:case a.bn:c=4;break;case a.wk:case a.xk:c=16;break;case a.Hi:c=3;break;case a.hh:c=2}return c};a.$C=function(a){var c=null,c={name:"special_ssao_texture",
type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,a);c.image={filepath:null};return c};a.Y=function(){if(!q.dd)for(var a in F)F[a].Oa.pause(),F[a].Oa.src="",F[a].Oa.load();O={};F={}};a.VE=m;a.sF=x;a.RE=u;a.pause=function(){for(var a in F)q.dd&&!F[a].ei||!q.dd&&F[a].Oa.paused||(u(a),F[a].Nm=!0)};a.reset=function(){for(var a in F)x(a),F[a].Nm=!1};a.play=function(a){for(var b in F)if(!a||F[b].Nm)m(b),F[b].Nm=!1}};b4w.module.__dds=function(a,v){function d(a,b,d,e){var f=new Uint16Array(4),m=new Uint16Array(d*e),n=0,q=0,c=0,l=q=n=0,r=0,t=0,k=0,p=d/4;e/=4;for(var J=0;J<e;J++)for(var h=0;h<p;h++)c=b+4*(J*p+h),f[0]=a[c],f[1]=a[c+1],n=f[0]&31,q=f[0]&2016,l=f[0]&63488,r=f[1]&31,t=f[1]&2016,k=f[1]&63488,f[2]=5*n+3*r>>3|5*q+3*t>>3&2016|5*l+3*k>>3&63488,f[3]=5*r+3*n>>3|5*t+3*q>>3&2016|5*k+3*l>>3&63488,n=a[c+2],q=4*J*d+4*h,m[q]=f[n&3],m[q+1]=f[n>>2&3],m[q+2]=f[n>>4&3],m[q+3]=f[n>>6&3],q+=d,m[q]=f[n>>8&3],m[q+1]=f[n>>
10&3],m[q+2]=f[n>>12&3],m[q+3]=f[n>>14],n=a[c+3],q+=d,m[q]=f[n&3],m[q+1]=f[n>>2&3],m[q+2]=f[n>>4&3],m[q+3]=f[n>>6&3],q+=d,m[q]=f[n>>8&3],m[q+1]=f[n>>10&3],m[q+2]=f[n>>12&3],m[q+3]=f[n>>14];return m}function b(a,b,e,p){var v=new Int32Array(e,0,31),A,n,q,c,P,O;if(542327876!=v[0])return r.error("Invalid magic number in DDS header"),0;if(!v[20]&4)return r.error("Unsupported format, must contain a FourCC code"),0;A=v[21];switch(A){case l:n=8;q=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case t:n=16;q=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case m:n=16;q=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return r.error("Unsupported FourCC code:",f(A)),null}O=1;v[2]&131072&&!1!==p&&(O=Math.max(1,v[7]));c=v[4];P=v[3];v=v[1]+4;if(b)for(A=0;A<O;++A)p=Math.max(4,c)/4*Math.max(4,P)/4*n,b=new Uint8Array(e,v,p),a.compressedTexImage2D(a.TEXTURE_2D,A,q,c,P,0,b),v+=p,c=Math.max(.5*c,1),P=Math.max(.5*P,1);else if(A==l)Math.max(4,c),Math.max(4,P),b=new Uint16Array(e),e=d(b,v/2,c,P),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,c,P,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,e),p&&a.generateMipmap(a.TEXTURE_2D);else return r.error("No manual decoder for",f(A),"and no native support"),0;return O}function p(a,d,e,f,m,l){var n=new XMLHttpRequest;n.open("GET",e,!0);n.responseType="arraybuffer";n.onload=function(){if(200==n.status){a.bindTexture(a.TEXTURE_2D,f);var e=b(a,d,n.response,m);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<e?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}l&&
l(f)};n.send(null);return f}function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var r=v("__print"),l=e("DXT1"),t=e("DXT3"),m=e("DXT5");a.xK=d;a.lH=b;a.Su=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.lD=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case l:b=6;break;case t:case m:b=4;break;default:r.error("Unsupported FourCC code:",f(a))}return b};
a.rM=p;a.qM=function(a,b,d,e){var f=a.createTexture();p(a,b,d,f,!0,e);return f}};b4w.module.__gpp_eval=function(a){a.pw=function(){function a(d,b,p,e,f,r){this.message=d;this.offset=e;this.vj=f;this.sh=r;this.name="SyntaxError"}(function(a,b){function p(){this.constructor=a}p.prototype=b.prototype;a.prototype=new p})(a,Error);return{SyntaxError:a,parse:function(d){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function p(a){if(Mb!==a){Mb>a&&(Mb=0,pb={vj:1,sh:1,Vj:!1});var b=pb,c,g;for(c=
Mb;c<a;c++)g=d.charAt(c),"\n"===g?(b.Vj||b.vj++,b.sh=1,b.Vj=!1):"\r"===g||"\u2028"===g||"\u2029"===g?(b.vj++,b.sh=1,b.Vj=!0):(b.sh++,b.Vj=!1);Mb=a}return pb}function e(a){D<Qa||(D>Qa&&(Qa=D,hb=[]),hb.push(a))}function f(){var a,b,c;a=D;b=X();b!==z?(b=r(),b!==z?(c=X(),c!==z?(W++,10===d.charCodeAt(D)?(c=lc,D++):(c=z,0===W&&e(mc)),c===z&&(d.substr(D,2)===Wa?(c=Wa,D+=2):(c=z,0===W&&e(nc)),c===z&&(13===d.charCodeAt(D)?(c=oc,D++):(c=z,0===W&&e(fb)))),W--,c===z&&0===W&&e(Sb),c===z&&(c=null),c!==z?a=b:(D=
a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z);return a}function r(){var a,b,c,g,h,f,k,q;a=D;b=l();if(b!==z){c=[];g=D;h=X();h!==z?(44===d.charCodeAt(D)?(f=ba,D++):(f=z,0===W&&e(fa)),f!==z?(k=X(),k!==z?(q=l(),q!==z?g=h=[h,f,k,q]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,h=X(),h!==z?(44===d.charCodeAt(D)?(f=ba,D++):(f=z,0===W&&e(fa)),f!==z?(k=X(),k!==z?(q=l(),q!==z?g=h=[h,f,k,q]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);c!==z?a=b=0==c.length?b:c[c.length-1]:(D=a,a=z)}else D=a,a=
z;return a}function l(){var a,b,c,g;a=D;b=t();b!==z?(c=X(),c!==z?(63===d.charCodeAt(D)?(c=ma,D++):(c=z,0===W&&e(ca)),c!==z?(c=X(),c!==z?(c=r(),c!==z?(g=X(),g!==z?(58===d.charCodeAt(D)?(g=ra,D++):(g=z,0===W&&e(sa)),g!==z?(g=X(),g!==z?(g=r(),g!==z?a=b?c:g:(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z);a===z&&(a=t());return a}function t(){var a,b,c,g,d,e,h,f;a=D;b=m();if(b!==z){c=[];g=D;d=X();d!==z?(e=Z(),e!==z?(h=X(),h!==z?(f=m(),f!==z?g=d=[d,e,h,f]:
(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,d=X(),d!==z?(e=Z(),e!==z?(h=X(),h!==z?(f=m(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else D=a,a=z}else D=a,a=z;return a}function m(){var a,b,c,g,d,e,h,f;a=D;b=x();if(b!==z){c=[];g=D;d=X();d!==z?(e=U(),e!==z?(h=X(),h!==z?(f=x(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,d=X(),d!==z?(e=U(),e!==z?(h=X(),h!==z?(f=x(),
f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else D=a,a=z}else D=a,a=z;return a}function x(){var a,b,c,g,d,e,h,f;a=D;b=u();if(b!==z){c=[];g=D;d=X();d!==z?(e=R(),e!==z?(h=X(),h!==z?(f=u(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,d=X(),d!==z?(e=R(),e!==z?(h=X(),h!==z?(f=u(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else D=
a,a=z}else D=a,a=z;return a}function u(){var a,b,c,g,d,e,h,f;a=D;b=y();if(b!==z){c=[];g=D;d=X();d!==z?(e=L(),e!==z?(h=X(),h!==z?(f=y(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,d=X(),d!==z?(e=L(),e!==z?(h=X(),h!==z?(f=y(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else D=a,a=z}else D=a,a=z;return a}function y(){var a,b,c,g,d,e,h,f;a=D;b=K();if(b!==z){c=[];g=D;d=X();d!==z?(e=M(),e!==z?
(h=X(),h!==z?(f=K(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,d=X(),d!==z?(e=M(),e!==z?(h=X(),h!==z?(f=K(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else D=a,a=z}else D=a,a=z;return a}function K(){var a,b,c,d,e,h,f,k;a=D;b=G();if(b!==z){c=[];d=D;e=X();e!==z?(h=g(),h!==z?(f=X(),f!==z?(k=G(),k!==z?d=e=[e,h,f,k]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)c.push(d),d=D,e=X(),
e!==z?(h=g(),h!==z?(f=X(),f!==z?(k=G(),k!==z?d=e=[e,h,f,k]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else D=a,a=z}else D=a,a=z;return a}function G(){var a,b,c,g,d,e,h,f;a=D;b=A();if(b!==z){c=[];g=D;d=X();d!==z?(e=w(),e!==z?(h=X(),h!==z?(f=A(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,d=X(),d!==z?(e=w(),e!==z?(h=X(),h!==z?(f=A(),f!==z?g=d=[d,e,h,f]:
(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else D=a,a=z}else D=a,a=z;return a}function A(){var a,b,c,g,d,e,h,f;a=D;b=n();if(b!==z){c=[];g=D;d=X();d!==z?(e=H(),e!==z?(h=X(),h!==z?(f=n(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,d=X(),d!==z?(e=H(),e!==z?(h=X(),h!==z?(f=n(),f!==z?g=d=[d,e,h,f]:(D=g,
g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else D=a,a=z}else D=a,a=z;return a}function n(){var a,b,c,g,d,e,h,f;a=D;b=q();if(b!==z){c=[];g=D;d=X();d!==z?(e=I(),e!==z?(h=X(),h!==z?(f=q(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);for(;g!==z;)c.push(g),g=D,d=X(),d!==z?(e=I(),e!==z?(h=X(),h!==z?(f=q(),f!==z?g=d=[d,e,h,f]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(c!==z)for(a=b,b=0;b<
c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else D=a,a=z}else D=a,a=z;return a}function q(){var a,b,g,d,e,h,f,k;a=D;b=c();if(b!==z){g=[];d=D;e=X();e!==z?(h=C(),h!==z?(f=X(),f!==z?(k=c(),k!==z?d=e=[e,h,f,k]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)g.push(d),d=D,e=X(),e!==z?(h=C(),h!==z?(f=X(),f!==z?(k=c(),k!==z?d=e=[e,h,f,k]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);if(g!==z)for(a=b,b=0;b<g.length;b++)switch(g[b][1]){case "*":a*=g[b][3];break;case "/":a=
Math.floor(a/g[b][3]);break;case "%":a%=g[b][3]}else D=a,a=z}else D=a,a=z;return a}function c(){var a,g,h;a=D;d.substr(D,7)===qa?(g=qa,D+=7):(g=z,0===W&&e(V));g!==z?(h=X(),h!==z?(h=O(),h!==z?a=h:(D=a,a=z)):(D=a,a=z)):(D=a,a=z);if(a===z){a=D;g=P();if(g!==z)if(h=X(),h!==z)if(d.substr(D,2)===mb?(h=mb,D+=2):(h=z,0===W&&e(wa)),h===z&&(d.substr(D,2)===Qb?(h=Qb,D+=2):(h=z,0===W&&e(ia))),h!==z){a:{a=g;switch(h){case "++":g=++a;break a;case "--":g=--a;break a}g=void 0}a=g}else D=a,a=z;else D=a,a=z;else D=
a,a=z;a===z&&(a=P());a===z&&(a=D,d.substr(D,2)===mb?(g=mb,D+=2):(g=z,0===W&&e(wa)),g===z&&(d.substr(D,2)===Qb?(g=Qb,D+=2):(g=z,0===W&&e(ia)),g===z&&(43===d.charCodeAt(D)?(g=gb,D++):(g=z,0===W&&e(ya)),g===z&&(45===d.charCodeAt(D)?(g=Ua,D++):(g=z,0===W&&e(Oa)),g===z&&(126===d.charCodeAt(D)?(g=pa,D++):(g=z,0===W&&e(Ia)),g===z&&(33===d.charCodeAt(D)?(g=Kb,D++):(g=z,0===W&&e(Zb))))))),g!==z?(h=X(),h!==z?(h=c(),h!==z?a=g=b(g,h):(D=a,a=z)):(D=a,a=z)):(D=a,a=z))}return a}function P(){var a,b,c;W++;var g;
a=D;48===d.charCodeAt(D)?(b=ka,D++):(b=z,0===W&&e(Xa));if(b!==z)if(ta.test(d.charAt(D))?(b=d.charAt(D),D++):(b=z,0===W&&e(tb)),b!==z){b=D;c=[];g=k();if(g!==z)for(;g!==z;)c.push(g),g=k();else c=z;b=c!==z?d.substring(b,D):c;b!==z?a=b=parseInt("0x"+b):(D=a,a=z)}else D=a,a=z;else D=a,a=z;if(a===z){a=D;48===d.charCodeAt(D)?(b=ka,D++):(b=z,0===W&&e(Xa));if(b===z)if(b=D,Fa.test(d.charAt(D))?(c=d.charAt(D),D++):(c=z,0===W&&e(na)),c!==z){var h;g=[];h=F();if(h!==z)for(;h!==z;)g.push(h),h=F();else g=z;g===z&&
(g=null);g!==z?b=c=[c,g]:(D=b,b=z)}else D=b,b=z;a=b!==z?d.substring(a,D):b;a!==z&&(a=parseInt(a))}W--;a===z&&0===W&&e(oa);a===z&&(b=B(),b!==z&&(b=0),a=b,a===z&&(a=D,40===d.charCodeAt(D)?(b=S,D++):(b=z,0===W&&e(E)),b!==z?(b=X(),b!==z?(b=r(),b!==z?(c=X(),c!==z?(41===d.charCodeAt(D)?(c=N,D++):(c=z,0===W&&e(ha)),c!==z?a=b:(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)));return a}function O(){var a,b,c,g,h;b=B();b!==z&&(b=0);a=b;if(a===z){b=[];g=c=D;W++;40===d.charCodeAt(D)?(h=S,D++):(h=z,0===W&&
e(E));h===z&&(41===d.charCodeAt(D)?(h=N,D++):(h=z,0===W&&e(ha)));W--;h===z?g=void 0:(D=g,g=z);g!==z?(h=T(),h!==z?c=g=[g,h]:(D=c,c=z)):(D=c,c=z);if(c!==z)for(;c!==z;)b.push(c),g=c=D,W++,40===d.charCodeAt(D)?(h=S,D++):(h=z,0===W&&e(E)),h===z&&(41===d.charCodeAt(D)?(h=N,D++):(h=z,0===W&&e(ha))),W--,h===z?g=void 0:(D=g,g=z),g!==z?(h=T(),h!==z?c=g=[g,h]:(D=c,c=z)):(D=c,c=z);else b=z;b!==z&&(b=1);a=b;a===z&&(a=D,40===d.charCodeAt(D)?(b=S,D++):(b=z,0===W&&e(E)),b!==z?(c=X(),c!==z?(g=O(),g!==z?(h=X(),h!==
z?(41===d.charCodeAt(D)?(b=N,D++):(b=z,0===W&&e(ha)),b!==z?a=g:(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z))}return a}function F(){var a;da.test(d.charAt(D))?(a=d.charAt(D),D++):(a=z,0===W&&e(Q));return a}function k(){var a;Da.test(d.charAt(D))?(a=d.charAt(D),D++):(a=z,0===W&&e(lb));return a}function B(){var a,b;W++;b=a=D;W++;var c,g,f,k;c=D;d.substr(D,7)===qa?(g=qa,D+=7):(g=z,0===W&&e(V));g!==z?(f=D,W++,k=h(),W--,k===z?f=void 0:(D=f,f=z),f!==z?c=g=[g,f]:(D=c,c=z)):(D=c,c=z);W--;c===z?b=
void 0:(D=b,b=z);if(b!==z){W++;b=D;c=J();if(c!==z){g=[];for(f=h();f!==z;)g.push(f),f=h();g!==z?b=c+=g.join(""):(D=b,b=z)}else D=b,b=z;W--;b===z&&0===W&&e(ua);b!==z?a=b:(D=a,a=z)}else D=a,a=z;W--;a===z&&0===W&&e(ua);return a}function J(){var a;ab.test(d.charAt(D))?(a=d.charAt(D),D++):(a=z,0===W&&e(Ha));a===z&&(36===d.charCodeAt(D)?(a=nb,D++):(a=z,0===W&&e(Ea)),a===z&&(95===d.charCodeAt(D)?(a=kb,D++):(a=z,0===W&&e(Ta))));return a}function h(){var a;a=J();a===z&&(a=F());return a}function C(){var a,b,
c,g;a=D;42===d.charCodeAt(D)?(b=Lb,D++):(b=z,0===W&&e(Eb));b===z&&(47===d.charCodeAt(D)?(b=Va,D++):(b=z,0===W&&e(Ca)),b===z&&(37===d.charCodeAt(D)?(b=Jb,D++):(b=z,0===W&&e(tc))));b!==z?(c=D,W++,61===d.charCodeAt(D)?(g=hc,D++):(g=z,0===W&&e(Ib)),W--,g===z?c=void 0:(D=c,c=z),c!==z?a=b:(D=a,a=z)):(D=a,a=z);return a}function I(){var a,b,c;a=D;43===d.charCodeAt(D)?(b=gb,D++):(b=z,0===W&&e(ya));b!==z?(b=D,W++,43===d.charCodeAt(D)?(c=gb,D++):(c=z,0===W&&e(ya)),c===z&&(61===d.charCodeAt(D)?(c=hc,D++):(c=
z,0===W&&e(Ib))),W--,c===z?b=void 0:(D=b,b=z),b!==z?a="+":(D=a,a=z)):(D=a,a=z);a===z&&(a=D,45===d.charCodeAt(D)?(b=Ua,D++):(b=z,0===W&&e(Oa)),b!==z?(b=D,W++,45===d.charCodeAt(D)?(c=Ua,D++):(c=z,0===W&&e(Oa)),c===z&&(61===d.charCodeAt(D)?(c=hc,D++):(c=z,0===W&&e(Ib))),W--,c===z?b=void 0:(D=b,b=z),b!==z?a="-":(D=a,a=z)):(D=a,a=z));return a}function H(){var a;d.substr(D,2)===Ga?(a=Ga,D+=2):(a=z,0===W&&e(xa));a===z&&(d.substr(D,2)===Ya?(a=Ya,D+=2):(a=z,0===W&&e(Za)));return a}function w(){var a;d.substr(D,
2)===bb?(a=bb,D+=2):(a=z,0===W&&e($b));a===z&&(d.substr(D,2)===ob?(a=ob,D+=2):(a=z,0===W&&e(wb)),a===z&&(60===d.charCodeAt(D)?(a=xb,D++):(a=z,0===W&&e(rb)),a===z&&(62===d.charCodeAt(D)?(a=Na,D++):(a=z,0===W&&e(Aa)))));return a}function g(){var a;d.substr(D,2)===Cb?(a=Cb,D+=2):(a=z,0===W&&e(Db));a===z&&(d.substr(D,2)===Ba?(a=Ba,D+=2):(a=z,0===W&&e(fc)));return a}function M(){var a,b,c;a=D;38===d.charCodeAt(D)?(b=ga,D++):(b=z,0===W&&e(za));b!==z?(b=D,W++,38===d.charCodeAt(D)?(c=ga,D++):(c=z,0===W&&
e(za)),W--,c===z?b=void 0:(D=b,b=z),b!==z?a="&":(D=a,a=z)):(D=a,a=z);return a}function L(){var a,b,c;a=D;94===d.charCodeAt(D)?(b=Pa,D++):(b=z,0===W&&e(va));b!==z?(b=D,W++,94===d.charCodeAt(D)?(c=Pa,D++):(c=z,0===W&&e(va)),W--,c===z?b=void 0:(D=b,b=z),b!==z?a="^":(D=a,a=z)):(D=a,a=z);return a}function R(){var a,b,c;a=D;124===d.charCodeAt(D)?(b=Ka,D++):(b=z,0===W&&e(ub));b!==z?(b=D,W++,124===d.charCodeAt(D)?(c=Ka,D++):(c=z,0===W&&e(ub)),W--,c===z?b=void 0:(D=b,b=z),b!==z?a="|":(D=a,a=z)):(D=a,a=z);
return a}function U(){var a;d.substr(D,2)===vb?(a=vb,D+=2):(a=z,0===W&&e(Wb));a!==z&&(a="&&");return a}function Z(){var a;d.substr(D,2)===Xb?(a=Xb,D+=2):(a=z,0===W&&e(Ma));a!==z&&(a="||");return a}function X(){var a,b;a=[];for(b=aa();b!==z;)a.push(b),b=aa();return a}function aa(){var a;W++;Bb.test(d.charAt(D))?(a=d.charAt(D),D++):(a=z,0===W&&e(Yb));W--;a===z&&0===W&&e(Rb);return a}function T(){var a;d.length>D?(a=d.charAt(D),D++):(a=z,0===W&&e(gc));return a}var Y=1<arguments.length?arguments[1]:{},
z={},ea={start:f},la=f,ba=",",fa={type:"literal",value:",",description:'","'},ma="?",ca={type:"literal",value:"?",description:'"?"'},ra=":",sa={type:"literal",value:":",description:'":"'},qa="defined",V={type:"literal",value:"defined",description:'"defined"'},S="(",E={type:"literal",value:"(",description:'"("'},N=")",ha={type:"literal",value:")",description:'")"'},oa={type:"other",description:"number"},ka="0",Xa={type:"literal",value:"0",description:'"0"'},da=/^[0-9]/,Q={type:"class",value:"[0-9]",
description:"[0-9]"},Fa=/^[1-9]/,na={type:"class",value:"[1-9]",description:"[1-9]"},ta=/^[xX]/,tb={type:"class",value:"[xX]",description:"[xX]"},Da=/^[0-9a-fA-F]/,lb={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},ua={type:"other",description:"identifier"},nb="$",Ea={type:"literal",value:"$",description:'"$"'},kb="_",Ta={type:"literal",value:"_",description:'"_"'},ab=/^[a-zA-Z]/,Ha={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},mb="++",wa={type:"literal",value:"++",description:'"++"'},
Qb="--",ia={type:"literal",value:"--",description:'"--"'},gb="+",ya={type:"literal",value:"+",description:'"+"'},Ua="-",Oa={type:"literal",value:"-",description:'"-"'},pa="~",Ia={type:"literal",value:"~",description:'"~"'},Kb="!",Zb={type:"literal",value:"!",description:'"!"'},Lb="*",Eb={type:"literal",value:"*",description:'"*"'},Va="/",Ca={type:"literal",value:"/",description:'"/"'},Jb="%",tc={type:"literal",value:"%",description:'"%"'},hc="=",Ib={type:"literal",value:"=",description:'"="'},Ga=
"<<",xa={type:"literal",value:"<<",description:'"<<"'},Ya=">>",Za={type:"literal",value:">>",description:'">>"'},bb="<=",$b={type:"literal",value:"<=",description:'"<="'},ob=">=",wb={type:"literal",value:">=",description:'">="'},xb="<",rb={type:"literal",value:"<",description:'"<"'},Na=">",Aa={type:"literal",value:">",description:'">"'},Cb="==",Db={type:"literal",value:"==",description:'"=="'},Ba="!=",fc={type:"literal",value:"!=",description:'"!="'},ga="&",za={type:"literal",value:"&",description:'"&"'},
Pa="^",va={type:"literal",value:"^",description:'"^"'},Ka="|",ub={type:"literal",value:"|",description:'"|"'},vb="&&",Wb={type:"literal",value:"&&",description:'"&&"'},Xb="||",Ma={type:"literal",value:"||",description:'"||"'},Rb={type:"other",description:"whitespace"},Bb=/^[\t\x0B\f ]/,Yb={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},Sb={type:"other",description:"end of line"},lc="\n",mc={type:"literal",value:"\n",description:'"\\n"'},Wa="\r\n",nc={type:"literal",value:"\r\n",description:'"\\r\\n"'},
oc="\r",fb={type:"literal",value:"\r",description:'"\\r"'},gc={type:"any",description:"any character"},D=0,Mb=0,pb={vj:1,sh:1,Vj:!1},Qa=0,hb=[],W=0,Ja;if("startRule"in Y){if(!(Y.Hx in ea))throw Error("Can't start parsing from rule \""+Y.Hx+'".');la=ea[Y.Hx]}Ja=la();if(Ja!==z&&D===d.length)return Ja;Ja!==z&&D<d.length&&e({type:"end",description:"end of input"});throw function(b,c,g){function e(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<
a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,
function(a){return"\\u"+b(a)})}var g=Array(a.length),d;for(d=0;d<a.length;d++)g[d]=a[d].description;g=1<a.length?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0];d=b?'"'+c(b)+'"':"end of input";return"Expected "+g+" but "+d+" found."}var f=p(g),k=g<d.length?d.charAt(g):null;null!==c&&e(c);return new a(null!==b?b:h(c,k),0,0,g,f.vj,f.sh)}(null,hb,Qa);}}}()};b4w.module.__assets=function(a,v){function d(){return G.ov()?v(G.cc.Kk).data:null}function b(){var a={yk:null,Uz:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.yk=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=d();b&&a.yk in b&&(a.status=200,b[a.yk]&&(a.response=a.Uz(b[a.yk])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function p(b){for(var c=0,d=0;d<b.length;d++){var k=b[d];20===k.state&&c++;if(c>=O.zE)break;if(10===k.state)switch(k.state=20,c++,k.type){case a.lk:e(k,"arraybuffer");break;case a.or:e(k,"json");break;case a.uy:e(k,"text");break;case a.mr:f(k);break;case a.mk:r(k);break;case a.nr:l(k);break;case a.ok:t(k);break;
case a.nk:m(k);break;default:q.pa("Wrong asset type: "+k.type)}}}function e(a,c){var e=d(),f=e&&a.r in e?new b:new XMLHttpRequest;f.open("GET",a.r,!0);"text"==c?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==c?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=c;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==c&&"string"==typeof b)try{b=JSON.parse(b)}catch(g){a.ob(null,a.uri,
a.type,a.r,a.tb);A.error(g+" (parsing JSON "+a.r+")");return}a.ob(b,a.uri,a.type,a.r,a.tb)}else a.ob(null,a.uri,a.type,a.r,a.tb),A.error("empty responce when trying to get "+a.r)}else a.ob(null,a.uri,a.type,a.r,a.tb),A.error(f.status+" when trying to get "+a.r);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.xw(b.loaded/b.total)},!1);f.send(null)}function f(a){var c=d(),e=c&&a.r in c?new b:new XMLHttpRequest;e.open("GET",a.r,!0);e.responseType="arraybuffer";e.onreadystatechange=
function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?n.bC(b,function(b){a.ob(b,a.uri,a.type,a.r,a.tb);a.state=30},function(){a.ob(null,a.uri,a.type,a.r,a.tb);A.error("failed to decode "+a.r);a.state=30}):(a.ob(null,a.uri,a.type,a.r,a.tb),A.error("empty responce when trying to get "+a.r),a.state=30)}else a.ob(null,a.uri,a.type,a.r,a.tb),A.error(e.status+" when trying to get "+a.r),a.state=30};e.send(null)}function r(a){var b=document.createElement("img");F.allow_cors&&
(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.ob(b,a.uri,a.type,a.r,a.tb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.ob(null,a.uri,a.type,a.r,a.tb),A.error("could not load image: "+a.r),a.state=30)},!1);var c=d();if(c&&a.r in c)if(c[a.r]){var e=u(a.r);b.src="data:"+e+";base64,"+c[a.r]}else P.ip()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.r}function l(a){var b=document.createElement("audio");
F.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.ob(b,a.uri,a.type,a.r,a.tb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.ob(null,a.uri,a.type,a.r,a.tb),A.error("could not load sound: "+a.r),a.state=30)},!1);var c=d();if(c&&a.r in c)if(c[a.r]){var e=y(a.r);b.src="data:"+e+";base64,"+c[a.r];40!=a.state&&(a.ob(b,a.uri,a.type,a.r,a.tb),a.state=30)}else P.ip()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",
!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.r,F.wg&&b.load();setTimeout(function(){b.jG=1},5E3)}function t(a){function b(){40!=a.state&&(a.ob(null,a.uri,a.type,a.r),A.error("could not load video: "+a.r,a.tb),a.state=30)}var c=document.createElement("video");c.muted=!0;if(F.allow_cors||F.wg)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.ob(c,a.uri,a.type,a.r,a.tb),a.state=30)},!1);c.addEventListener("error",
b,!1);var e=d();if(e&&a.r in e)if(e[a.r]){var f=K(a.r);c.src="data:"+f+";base64,"+e[a.r];40!=a.state&&(a.ob(c,a.uri,a.type,a.r,a.tb),a.state=30)}else P.ip()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),c.dispatchEvent(e);else c.src=a.r,F.wg&&c.load();setTimeout(function(){c.jG=1},1E4)}function m(a){function c(b){a.ob(b,a.uri,a.type,a.r,a.tb)}var e=d(),f=e&&a.r in e?new b:new XMLHttpRequest;f.open("GET",a.r,!0);f.responseType="arraybuffer";
f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;b?x(b,c):(a.ob(null,a.uri,a.type,a.r,a.tb),A.error("empty responce when trying to get "+a.r))}else a.ob(null,a.uri,a.type,a.r,a.tb),A.error(f.status+" when trying to get "+a.r);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.xw(b.loaded/b.total)},!1);f.send(null)}function x(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],g={images:[],ic:c[4]},f=20,
k=0;k<e;k++){var q=c[f/4],n=document.createElement("img");n.src=window.URL.createObjectURL(new Blob([d.subarray(f+4,f+4+q)],{type:"image/jpg"}));g.images.push(n);f+=q+8-q%4}n.onload=function(){b(g)}}function u(a){var b="image";switch(q.Jo(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function y(a){var b="audio";switch(q.Jo(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+=
"/webm"}return b}function K(a){var b="video";switch(q.Jo(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var G=v("__config"),A=v("__print"),n=v("__sfx"),q=v("__util"),c=v("__version"),P=v("__compat"),O=G.ie,F=G.q;a.lk=10;a.or=20;a.uy=30;a.mr=40;a.mk=50;a.nr=60;a.ok=70;a.nk=80;var k=[],B=0,J={};a.Zj=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.KD=function(a){if(J[a])return J[a];var b=
O.tw?a+c.timestamp():a,d=new XMLHttpRequest;d.overrideMimeType("text/plain");d.open("GET",b,!1);d.send(null);if(200==d.status||0==d.status){b=d.responseText;if(b.length)return J[a]=b;q.pa("Error XHR: responce is empty, GET "+a)}else q.pa("Error XHR: "+d.status+", GET "+a)};a.Y=function(){for(var a=0;a<k.length;a++)k[a].state=40;k=[];B=0;J={}};a.Cc=function(a,b,e,f){for(var q=0;q<a.length;q++){var g=a[q],g={uri:g[0],type:g[1],r:g[2],tb:g[3],state:10,ob:b||function(){},mw:e||function(){},xw:f||function(){},
nw:B};if(O.tw){var n=d();n&&g.r in n||(g.r+=c.timestamp())}k.push(g)}p(k);B++};a.update=function(){p(k);for(var a=k,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.nw===a[b].nw?30!==e.state&&(c=!1):(c&&(a[d-1].mw(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].mw(),a.splice(b))}}};b4w.module.__sfx=function(a,v){function d(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;A.warn("deprecated WebAudio implementation");return null}A.warn("WebAudio is not supported");return null}function b(a,b,c){var d=a.h;if("NONE"!=d.behavior){c||(c=0);var e=d.loop,k=d.pitch;if(d.src&&(e||0<=c)){d.vn=Math.floor(5E4*Math.random());var q=h.currentTime+b;d.Nc=q;d.state=20;p(a);"POSITIONAL"==d.behavior||"BACKGROUND_SOUND"==d.behavior?(b=h.createBufferSource(),
b.buffer=d.src,b.playbackRate.value=k,e?(d.vb&&d.vb.disconnect(),b.loop=!0,b.start(q),d.duration=0):(e=b.buffer?b.buffer.duration:0,c>e?(e=q+c+d.qe,b.loop=!0,b.start(q),b.stop(e),d.duration=c):(b.loop=!1,b.start(q),d.duration=e)),b.connect(d.pc),d.vb=b,f(d),r(d)):"BACKGROUND_MUSIC"==d.behavior&&(n.Pk(d.zn),n.Pk(d.An),c=function(){var b=a.h,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.vb=b.vb||h.createMediaElementSource(c),b.vb.connect(b.pc),20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==
b?c():d.zn=n.nx(c,1E3*b),d.duration=e?0:K(a));l(d,q)}}}function p(a){var b=a.h;if(!b.pc){var c=a.d.g;a=a.d.quat;if(P.Ll){var d=h.createBiquadFilter();d.type="peaking"}else d=null;var e=h.createGain();switch(b.behavior){case "POSITIONAL":var f=h.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);b.op.set(c);c=O;q.qa(a,q.vc,c);f.setOrientation(c[0],c[1],
c[2]);b.direction.set(c);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.qB;f.coneOuterAngle=b.rB;f.coneOuterGain=b.sB;var k=h.createGain();k.gain.value=y(b);d?(f.connect(d),d.connect(k)):f.connect(k);k.connect(e);b.pc=f;if(b.Fi){var n=h.createGain();e.connect(n);n.connect(h?C.h.pc:null)}else n=null,e.connect(h?C.h.pc:null);break;case "BACKGROUND_SOUND":f=null;k=h.createGain();k.gain.value=y(b);d?(b.pc=d,d.connect(k)):b.pc=k;k.connect(e);b.Fi?(n=
h.createGain(),e.connect(n),n.connect(h?C.h.pc:null)):(n=null,e.connect(h?C.h.pc:null));break;case "BACKGROUND_MUSIC":n=f=null,k=h.createGain(),k.gain.value=y(b),d?(b.pc=d,d.connect(k)):b.pc=k,k.connect(e),e.connect(h?C.h.pc:null)}b.Dj=f;b.Cd=d;b.Fh=k;b.mg=e;b.Cw=n}}function e(a){var c=a.h,d=c.duration,c=c.fC+c.gC*Math.random();b(a,c,d)}function f(a){a.Fi&&a.Cw.gain.cancelScheduledValues(a.Nc);a.Gj&&a.vb.playbackRate.cancelScheduledValues(a.Nc);a.gk=a.Nc}function r(a){if(a.Fi||a.Gj){var b=a.Cw,c=
a.vb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Nc;H[0]=a.vn;for(var h=0;5>h;){var f=a.pitch+a.Gj*q.cd(H);if(e>=a.gk){if(a.Fi){var k=1-q.ua(a.Fi,0,1)*Math.random();b.gain.setValueAtTime(k,e)}a.Gj&&c.playbackRate.setValueAtTime(f,e);h++}e+=d/f}a.gk=e-.001}}}function l(a,b){if(a.vo||a.qe){var c=a.mg;c.gain.cancelScheduledValues(b);a.vo?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.vo)):c.gain.setValueAtTime(1,b);a.qe&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,
b+a.duration+a.qe))}}function t(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.h;if(20==b.state||40==b.state){var c=b.mg,d=h.currentTime;b.qe&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.qe));"BACKGROUND_MUSIC"==b.behavior?b.src&&(n.Pk(b.zn),n.Pk(b.An),b.An=n.nx(function(){var b=a.h.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.qe)):(c=b.vb,b.duration<c.buffer.duration?b.qe&&20==b.state?c.stop(d+b.qe):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),
b.Nc=0,b.Pp=0,b.Fn=0);b.state=30}}function m(a){a=a.h;if(20==a.state){var b=h.currentTime;a.Pp=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Nc){H[0]=a.vn;for(var d=a.vb.buffer.duration,e=a.Nc;e<b;)c=a.pitch+a.Gj*q.cd(H),e+=d/c;c*=d/c-(e-b)}else c=0;a.Fn=c;a.vb.stop(0);a.vb.disconnect();f(a)}a.state=40}}function x(a){var b=a.h;if(40==b.state){var c=h.currentTime;b.Nc+=c-b.Pp;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=a.h;var d=h.createBufferSource();d.loop=a.vb.loop;
d.buffer=a.vb.buffer;d.playbackRate.value=a.vb.playbackRate.value;a.Dj?d.connect(a.Dj):d.connect(a.Fh);a.vb=d;b.gk=c;b.vb.start(b.Nc,b.Fn);r(b)}l(b,b.Nc);b.state=20}}function u(a){return!a.h||20!=a.h.state&&40!=a.h.state&&30!=a.h.state?!1:!0}function y(a){return a.muted?0:a.volume}function K(a){a=a.h;return(a=a.src)?a.duration:0}var G=v("__config"),A=v("__print"),n=v("__time"),q=v("__util"),c=v("vec3"),P=G.pd;a.lr=10;a.Sm=20;a.kr=30;var O=new Float32Array(3),F=new Float32Array(3),k=new Float32Array(3),
B=[],J=[],h=null,C=null,I=[],H=[1],w=null;a.Qb=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(B.push("ogg"),B.push("ogv")),""!=a.canPlayType("audio/mpeg")&&B.push("mp3"),""!=a.canPlayType("audio/mp4")&&(B.push("mp4"),B.push("m4v")),""!=a.canPlayType("audio/webm")&&B.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&J.push("ogv"),""!=b.canPlayType("video/mp4")&&J.push("m4v"),""!=b.canPlayType("video/webm")&&
J.push("webm"));(h=P.hr?d():null)&&A.log("%cINIT WEBAUDIO: "+h.sampleRate+"Hz","color: #00a")};a.ss=function(a){var b={Dg:new Float32Array(3),Gv:new Float32Array(3),Ph:new Float32Array(3)};a.h=b;if(h){var c=h.createGain(),d=h.createGain();b.Fh=c;b.mg=d;c.connect(d);d.connect(h.destination);if(a.b4w_enable_dynamic_compressor){var d=h.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=
e.release;d.connect(c);b.Qi=d;b.pc=d}else b.Qi=null,b.pc=c;c=h.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.lg=0}};a.HF=function(a){C=a};a.ko=function(a){a||(a="ogg");return-1<B.indexOf(a)?a:"ogg"==a&&-1<B.indexOf("mp4")?"mp4":"mp3"==a&&-1<B.indexOf("ogg")?"ogg":"mp4"==a&&-1<B.indexOf("ogg")?"ogg":"ogv"==a&&-1<B.indexOf("m4v")?"m4v":"webm"==a&&-1<B.indexOf("m4v")?"m4v":"m4v"==a&&-1<B.indexOf("webm")?"webm":""};a.lo=function(a){a||(a=
"webm");return-1<J.indexOf(a)?a:"ogv"==a&&-1<J.indexOf("m4v")?"m4v":"webm"==a&&-1<J.indexOf("m4v")?"m4v":"m4v"==a&&-1<J.indexOf("webm")?"webm":""};a.We=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.h={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.h.behavior=h?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.h,d;h?(window.MediaElementAudioSourceNode?d=!0:(A.warn("MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):
d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.h.behavior="NONE");a.h.lC=b.b4w_disable_doppler;a.h.muted=b.muted;a.h.volume=b.volume;a.h.pitch=b.pitch;a.h.attenuation=b.attenuation;a.h.dist_ref=b.distance_reference;a.h.dist_max=b.distance_max||1E4;a.h.qB=b.cone_angle_inner;a.h.rB=b.cone_angle_outer;a.h.sB=b.cone_volume_outer;a.h.Xc=b.b4w_cyclic_play;a.h.loop=b.b4w_loop;a.h.fC=b.b4w_delay;a.h.gC=b.b4w_delay_random;a.h.Fi=b.b4w_volume_random;a.h.Gj=b.b4w_pitch_random;
a.h.vo=b.b4w_fade_in;a.h.qe=b.b4w_fade_out;a.h.Nc=0;a.h.Pp=0;a.h.Fn=0;a.h.duration=0;a.h.gk=0;a.h.vn=1;a.h.src=null;a.h.state=10;a.h.op=new Float32Array(3);a.h.direction=new Float32Array(3);a.h.Aq=new Float32Array(3);a.h.zn=-1;a.h.An=-1;a.h.lg=0;I.push(a)};a.Ax=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.h.behavior){case "POSITIONAL":return a.Sm;case "BACKGROUND_SOUND":return a.Sm;case "BACKGROUND_MUSIC":return a.kr;case "NONE":return a.lr;default:throw"Wrong speaker behavior";
}};a.hH=function(a,b){var c=a.h;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.UE=function(){var a=h.createBufferSource();a.buffer=h.createBuffer(1,22050,22050);a.connect(h.destination);a.start(0)};a.bC=function(a,b,c){h?h.decodeAudioData(a,b,c):c()};a.nG=function(a){t(a);delete a.h;I.splice(I.indexOf(a),1)};a.Y=function(){for(var a=0;a<I.length;a++){var b=I[a].h;"BACKGROUND_MUSIC"==b.behavior?
(b=b.src)&&b.pause():b.vb&&b.vb.disconnect()}C&&C.h&&(a=C.h,a.Dg[0]=0,a.Dg[1]=0,a.Dg[2]=0,a.Ph[0]=0,a.Ph[1]=0,a.Ph[2]=0);C=null;I.splice(0);w=null};a.update=function(a){if(h&&0!=I.length){for(var b=0;b<I.length;b++){var c=I[b],d=c.h,f=h.currentTime;h&&!d.loop&&d.Xc&&20==d.state&&d.duration&&d.Nc+d.duration<f&&e(c);20==d.state&&3>d.gk-f&&r(d)}w&&w.Je.length&&(-1==w.Pa||a>w.Zr+w.Ct[w.Pa])&&(b=w,-1<b.Pa&&t(b.Je[b.Pa]),-1==b.Pa&&b.random?c=Math.round(Math.random()*(b.Je.length-1)):b.random?(c=1+Math.round(Math.random()*
(b.Je.length-2)),c=(b.Pa+c)%b.Je.length):c=(b.Pa+1)%b.Je.length,e(b.Je[c]),b.Pa=c,b.Zr=a)}};a.play=b;a.Rp=e;a.stop=t;a.rj=function(a){return 20==a.h.state};a.mG=m;a.oG=x;a.Hj=function(a,b){var c=a.h;c.pitch=b;!u(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.vb.playbackRate.value=b,f(c),r(c))};a.zu=function(a){return a.h.pitch};a.Xc=function(a,b){a.h.Xc=Boolean(b)};a.Nh=function(a){return a.h.Xc};a.pE=function(a,b,d,e){if(h&&a.h){var f=O;f[0]=0;f[1]=-1;f[2]=0;c.transformQuat(f,d,
f);F[0]=0;F[1]=0;F[2]=-1;c.transformQuat(F,d,F);d=h.listener;d.setPosition(b[0],b[1],b[2]);d.setOrientation(f[0],f[1],f[2],F[0],F[1],F[2]);a.h.Gv.set(f);e&&(k[0]=(b[0]-a.h.Dg[0])/e,k[1]=(b[1]-a.h.Dg[1])/e,k[2]=(b[2]-a.h.Dg[2])/e,q.ii(k,a.h.Ph,e,.3,k),d.setVelocity(k[0],k[1],k[2]),a.h.Ph.set(k));a.h.Dg.set(b)}};a.Hv=function(a,b){if(h&&C.h){var d=O;b?d.set(b):d.set(C.h.Gv);c.scale(d,a,d);h.listener.setVelocity(d[0],d[1],d[2]);C.h.Ph.set(d)}};a.pG=function(a,b){var c=a.h;if(u(a)&&"POSITIONAL"==c.behavior){var d=
a.d.g,e=c.Dj;e.setPosition(d[0],d[1],d[2]);var h=O;q.qa(a.d.quat,q.vc,h);e.setOrientation(h[0],h[1],h[2]);h=c.op;!c.lC&&b&&(F[0]=(d[0]-h[0])/b,F[1]=(d[1]-h[1])/b,F[2]=(d[2]-h[2])/b,q.ii(F,c.Aq,b,.3,F),e.setVelocity(F[0],F[1],F[2]),c.Aq.set(F));h.set(d)}};a.Bx=function(a,b,d){var e=a.h;if(u(a)&&"POSITIONAL"==e.behavior){var h=O;d?h.set(d):h.set(e.direction);c.scale(h,b,h);e.Dj.setVelocity(h[0],h[1],h[2]);e.Aq.set(h);e.op.set(a.d.g)}};a.ze=function(a){return a.h?!0:!1};a.Po=function(a){return a.h.behavior};
a.Kn=function(){for(var a=0;a<I.length;a++)if(u(I[a]))return!0;return!1};a.PF=function(a){var b=C.h;b&&(b.volume=a,h&&(b.Fh.gain.value=y(b)))};a.CD=function(){var a=C.h;return a?a.volume:0};a.sq=function(a,b){var c=a.h;c.volume=b;u(a)&&(c.Fh.gain.value=y(c))};a.Pu=function(a){return a.h.volume};a.xj=function(a,b){a.h.muted=Boolean(b);u(a)&&(a.h.Fh.gain.value=y(a.h))};a.pv=function(a){return a.h.muted};a.GE=function(a){var b=C.h;b&&(b.muted=Boolean(a),h&&(b.Fh.gain.value=y(b)))};a.hE=function(){var a=
C.h;return a?a.muted:!1};a.pl=function(){return I};a.pause=function(){for(var a=0;a<I.length;a++)m(I[a])};a.od=function(){for(var a=0;a<I.length;a++)x(I[a])};a.Zw=function(a,b){if(a.h&&a.h.Qi){var c=a.h.Qi;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.ku=function(a){if(!a.h||!a.h.Qi)return null;a=a.h.Qi;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};
a.Bt=function(a,b,c){if(u(a)){a=a.h;var d=a.mg,e=h.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.lg=c}};a.Zx=function(a){if(u(a)){a=a.h;var b=a.mg,c=h.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.lg);a.lg=0}};a.nC=function(a,b){if(h){var c=C.h,d=c.mg,e=h.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.lg=b}};a.QG=function(){if(h){var a=C.h,b=a.mg,c=h.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.lg);a.lg=0}};a.ks=function(a,b,c){w={Pa:-1,Zr:0,random:c,Je:[],Ct:[]};for(c=0;c<a.length;c++){var d=a[c],e=K(d);0==e?A.warn("Ignoring speaker with zero duration: "+d.name):(t(d),d.h.Xc=!1,w.Je.push(d),w.Ct.push(e+b))}};a.mu=K;a.Ws=function(){if(w)for(var a=w.Je,b=0;b<a.length;b++)t(a[b]);w=null};a.Au=function(a){return(a=a.h)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.gx=function(a,b){var c=a.h;if(c&&
"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Dj;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.cx=function(a,b){var c=a.h;c&&c.Cd&&(c.Cd.frequency.value=b.freq,c.Cd.Q.value=b.Q,c.Cd.gain.value=b.gain)};a.ru=function(a){return(a=a.h)&&a.Cd?{freq:a.Cd.frequency.value,Q:a.Cd.Q.value,gain:a.Cd.gain.value}:null};a.qu=function(a,b,c,d){a=a.h;if(!a||!a.Cd)return null;a.Cd.getFrequencyResponse(b,c,d)}};b4w.module.__time=function(a,v){v("__util");var d=0,b=0,p=[],e=0,f=[];a.mx=function(a){d=a;b=performance.now();for(a=0;a<p.length;a++){var e=p[a];d>e.so&&(p.splice(a,1),a--,e.callback())}for(a=0;a<f.length;a++){var e=f[a],t=1-(e.so-d)/e.duration,t=Math.min(t,1);e.callback(e.N+t*(e.ha-e.N));1==t&&(f.splice(a,1),a--)}};a.Ih=function(){return d};a.nx=function(a,f){var t;e++;t=e;p.push({id:t,callback:a,so:d+(performance.now()-b+f)/1E3});return t};a.Pk=function(a){for(var b=0;b<p.length;b++)if(p[b].id==
a){p.splice(b,1);break}};a.bs=function(a,b,e){f.push({callback:e,N:a,ha:b,so:d+.2,duration:.2});e(a)};a.reset=function(){b=d=0;e=p.length=0}};"object"==typeof module&&module.uo&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function v(){return"29.04.2015 10:05:49"}a.version=function(){return"15.04"};a.type=function(){return"RELEASE"};a.eo=v;a.timestamp=function(){var a=v(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.uo&&b4w.module.__version(exports);b4w.module.__compat=function(a,v){function d(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function p(){return!window.ActiveXObject&&"ActiveXObject"in window}var e=v("__config"),f=v("__extensions"),r=v("__print"),
l=v("__util");a.OF=function(a){var m=e.he,x=e.q,u=e.context,y=e.Uj,v=e.pd;x.Id=a.getParameter(a.MAX_TEXTURE_SIZE);x.Ap=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var G=Boolean(f.pD());d("Firefox")&&e.ov()&&(r.warn("Firefox detected for single HTML version, disable video textures."),x.Nt=!0);d("Firefox/28.0")&&(d("Linux")||d("Macintosh"))&&(r.warn("Firefox 28 detected, applying depth hack"),G=!1);d("iPad")||d("iPhone")?(r.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
u.alpha||(x.background_color[3]=1),x.iy=!0,x.smaa=!1,x.Ef=!1,x.precision="highp",x.kv=!0):d("Mac OS X")&&d("Safari")&&!d("Chrome")&&(r.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),v.us=!0,v.Ss=!0);d("Windows")&&(d("Chrome/40")||d("Firefox/33")||d("Firefox/34")||d("Firefox/35")||d("Firefox/36"))&&(r.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),x.Mn=!0);b()&&(r.warn("Mobile detected, applying various hacks for video textures."),
x.wg=!0,d("iPad")||d("iPhone")||(r.warn("Mobile (not iOS) detected, disable playback rate for video textures."),v.At=!0));(d("Firefox/35.0")||d("Firefox/36.0"))&&d("Windows")&&(r.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),x.Ot=!0);if(d("iPhone")||p())r.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),x.dd=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(r.warn("Not enough varyings, disable shadows on blend objects"),x.zt=!0);if(u=f.Cu())d("Macintosh")&&
-1<a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(r.warn("OS X / Intel HD 3000 detected, applying depth hack"),G=!1),d("Windows")&&d("Chrome")&&-1<a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("Intel")&&(r.warn("Chrome / Windows / Intel GPU detected, applying cubemap mipamp/rgb hack"),x.ep=!0),-1<a.getParameter(u.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(r.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),
G=!1,m.Ut=!0),-1<a.getParameter(u.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(r.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),x.precision="highp",x.yf="NONE"),-1<a.getParameter(u.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(r.warn("ARM Mali-T760 detected, disable SSAO."),x.Ef=!1),-1<a.getParameter(u.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<
a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(r.warn("Qualcomm Adreno detected, applying shader constants hack."),x.sx=!0,-1<a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(r.warn('Qualcomm Adreno305 detected, set "highp" precision.'),x.precision="highp"),-1<a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(r.warn('Qualcomm Adreno330 detected, set "highp" precision.'),x.precision="highp")),-1<a.getParameter(u.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(u.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(r.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),x.Ao=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(r.warn("Vertex textures are not allowed. Disabling vertex textures"),x.hn=!1);x.allow_hidpi&&1<window.devicePixelRatio&&(r.log("%cENABLE HIDPI MODE","color: #00a"),x.resolution_factor=1,x.smaa=!1);G||(x.cj=!1,x.Ej=!1,x.hb=!1,x.water_dynamic=!1,x.fi=!1,x.tm=!1,x.smaa=!1);x.dy=Boolean(f.Du());x.Vi=G;m=l.ua(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),
128,Infinity);x.ld=l.trunc((m-50)/4);x.wM=l.trunc((m-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(x.precision="mediump");p()&&(r.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),y.$k=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(r.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),x.Ao=!0)};a.yt=b;a.qA=function(){d("Firefox/35.0")&&d("Windows")&&(r.warn("Windows/Firefox 35 detected, forcing context's alpha"),
e.context.alpha=!0)};a.ip=p};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a ; a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"textline",b:"void main ( ) { float b ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",
a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { mat4 ck ; vec3 cl , cm , cn , co ; cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"cm = vec3 ( 0.0 ) ; cn = vec3 ( 0.0 ) ; co = vec3 ( 0.0 ) ; bv ( cl , cm , cn , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["cm","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"cn = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"ck = ao ( u_camera_eye , cn , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ck = ai ( u_camera_eye , cn , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"co = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ; ck = ck * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , co ) ;".split(" ")}]}}]},{type:"textline",b:"d cp = av ( cl - cm , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ck ) ; cp . b = cn ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d cp = av ( cl , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["co","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"co = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cj ( cp . a , cp . b , co ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cp . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:"void main ( ) { float e_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:"e_ = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"e_ = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( e_ < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cq ( cD ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( eU ( cJ . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { float fT ; vec2 fU ; vec4 fV , fW ; mat4 fX , fY ; vec3 fZ , f_ , ga , gb ; fZ = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"fZ = mix ( fZ , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"f_ = vec3 ( 0.0 ) ; ga = vec3 ( 0.0 ) ; gb = vec3 ( 0.0 ) ; bv ( fZ , f_ , ga , gb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["f_","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"f_ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"d gc = fE ( fZ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , f_ , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"ga = ( u_model_matrix * vec4 ( f_ , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:["fX","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fX","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"fY = ao ( u_camera_eye , ga , fX , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"fY = ai ( u_camera_eye , ga , fX ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"gb = ( u_model_matrix * vec4 ( f_ , 1.0 ) ) . xyz ; fY = fY * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gb ) ;".split(" ")}]}}]},{type:"textline",b:"d gc = av ( fZ - f_ , f_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , fY ) ; gc . b = ga ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gc = av ( fZ , f_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["gb","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cj ( gc . a , gc . b , gb ) ;".split(" ")}]}}]},{type:"textline",b:"fV = u_view_matrix * vec4 ( gc . a , 1.0 ) ; fW = u_proj_matrix * fV ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"fW . xy += u_subpixel_jitter * fW . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( gc . a ) ; cJ = fV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],
group:{type:"group",a:[{type:"textline",b:"cD = - fV . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"fU = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; fT = SHADOW_TEX_RES / 2.0 ; fU = floor ( fU * fT + 0.5 ) / fT - fU ; fW . xy += fU ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","fW",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","fT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","fT",";"]}]}}]}]}}]},
{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fT , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = vec4 ( 1.0 , fT ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","fT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","fT",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 fU ; mat4 fV ; vec3 fW ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fW = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; fV = ai ( u_camera_eye , fW , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"fV = fV * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d fX = av ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , fV ) ; fX . b = fW ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d fX = av ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"fU = u_proj_matrix * u_view_matrix * vec4 ( fX . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"fT = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fT","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["fT","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","fU",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 ga ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gc = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gc = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float ge ( float gd ) { return gd - floor ( gd * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gn ( inout float gf , in float gg [ gc ] , in float gh ) { float gi , gj , gk , gl ; for ( int gm = 0 ; gm < NUM_RINGS ; gm ++ ) { gi = 40.0 * gg [ gm ] ; gj = 300.0 * ( ge ( gi ) - 0.005 ) ; gk = gi ; gl = abs ( gk * ( u_halo_size * gj - gh ) ) ; gf += 1.0 - min ( gl , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gw ( inout float go , in float gp [ gc ] , in float gq ) { float gr , gs , gt , gu ; for ( int gv = 0 ; gv < NUM_LINES ; gv ++ ) { gr = gp [ gv ] ; gs = gr ; gt = 1000.0 * ( ge ( gr ) - 0.005 ) ; gu = 20.0 * abs ( gs * a . x + gt * a . y ) ; go += 1.0 - min ( gu , 1.0 ) ; } go *= gq ; }".split(" ")}]}}]},{type:"textline",b:"void gD ( inout float gx , in vec2 gy ) { float gz , gA , gB , gC ; gA = atan ( gy . y , gy . x ) ; gA *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; gB = cos ( gA ) ; gC = sin ( gA ) ; gA = ( gB * gy . x + gC * gy . y ) * ( gB * gy . y - gC * gy . x ) ; gz = abs ( gA ) ; if ( gz < 1.0 ) { gz = ( 0.01 * u_halo_size ) / ( gz ) ; gx *= sqrt ( min ( gz , 1.0 ) ) ; } } void main ( ) { vec3 gE ; float gF , gG , gH , gI ; gF = ( a . x * a . x + a . y * a . y ) ; gG = sqrt ( gF ) ; gF = max ( 1.0 - gF , 0.0 ) ; gF = pow ( gF , u_halo_hardness ) ; gH = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float gJ [ gc ] ; for ( int gK = 0 ; gK < gc ; gK ++ ) { gJ [ gK ] = fract ( gb / ( float ( gK ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"gI = 0.0 ; gn ( gI , gJ , gG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"gG = 0.0 ; gw ( gG , gJ , gF ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"gD ( gF , a ) ;".split(" ")}]}}]},{type:"textline",b:"gF *= gH ; gE = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"gI *= gF ; gE += u_halo_rings_color * gI ; gF += gI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"gG *= gH ; gE += u_halo_lines_color * gG ; gF += gG ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"gF *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gI = u_halo_stars_blend * ( ga . y - u_halo_stars_height ) ; gF *= clamp ( gI , 0.0 , 1.0 ) ; gF *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"fX ( gE ) ; f_ ( gE , gF ) ; gl_FragColor = vec4 ( gE , gF ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gb ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ga",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 gc , gd ; mat4 ge , gf ; vec3 gg ; gg = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gb = fract ( gg . x + gg . y + gg . z ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ge = N ( gg , u_view_matrix ) ; gf = u_view_matrix ; gf [ 3 ] [ 0 ] = 0.0 ; gf [ 3 ] [ 1 ] = 0.0 ; gf [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ge = N ( gg , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"gc = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; gc = ge * gc ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",
b:"gd = u_proj_matrix * gf * gc ; gd . z = 0.99999 * gd . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["ga","=","gc",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gd = u_proj_matrix * u_view_matrix * gc ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gd",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gc ; gc = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gc , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform",
"float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ; varying vec3 jD ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jF",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec4 kq , kr , ks , kt ; mat3 ku ; vec3 kv , kw , kx , ky , kz , kA , kB , kC ; vec2 kD , kE , kF , kG ; float kH , kI , kJ , kK , kL ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kH = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["kD","=","a",";"]}]}}]},{type:"textline",b:["kv","=","jD",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) kv = kv ; else kv = - kv ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],
group:{type:"group",a:[{type:"textline",b:"kw = cross ( kv , jE . xyz ) * jE . w ; ku = mat3 ( jE . xyz , kw , kv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"kI = length ( cJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kE = normalize ( u_view_matrix_frag * vec4 ( jD , 0.0 ) ) . st ; kE = kE * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( kI < PARALLAX_LOD_DIST ) { kJ = clamp ( 0.5 * ( PARALLAX_LOD_DIST - kI ) , 0.0 , 1.0 ) ; kJ = u_parallax_scale * kJ ; kw = normalize ( jB * ku ) ; kK = 1.0 / PARALLAX_STEPS ; kF = kw . xy * kJ / ( PARALLAX_STEPS * kw . z ) ; kJ = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:["kG","=",
"kE",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kG","=","kD",";"]}]}}]},{type:"textline",b:"kL = texture2D ( u_normalmap0 , kG ) . a ; for ( float kM = 1.0 ; kM <= PARALLAX_STEPS ; kM ++ ) { if ( kL < kJ ) { kJ -= kK ; kG -= kF ; kL = texture2D ( u_normalmap0 , kG ) . a ; } } kF = kG + kF ; kK = texture2D ( u_normalmap0 , kF ) . a - ( kJ + kK ) ; kL = kL - kJ ; kJ = kL / ( kL - kK ) ; kG = kJ * kF + ( 1.0 - kJ ) * kG ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kD += kG - kE ;".split(" ")}]}}]},{type:"textline",b:["kE","=","kG",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kE += kG - kD ;".split(" ")}]}}]},{type:"textline",b:["kD","=","kG",";"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],
group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kq = texture2D ( u_normalmap0 , kE ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kq = texture2D ( u_normalmap0 , kD ) ;".split(" ")}]}}]},{type:"textline",b:"kw = kq . rgb - 0.5 ; kw = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , kw , u_normal_factor ) ; kw = ku * kw ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["kw","=","kv",";"]}]}}]},{type:"textline",b:"kw = normalize ( kw ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kE = normalize ( u_view_matrix_frag * vec4 ( kw , 0.0 ) ) . st ; kE = kE * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"kv = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kx = jF ; fV ( kx ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kq = vec4 ( kx , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kq","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["kL","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kr = texture2D ( u_colormap0 , kE ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"kr = texture2D ( u_colormap0 , kD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"fV ( kr . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_colormap1 , kE ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_colormap1 , kD ) ;".split(" ")}]}}]},{type:"textline",b:"fV ( ks . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_stencil0 , kE ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_stencil0 , kD ) ;".split(" ")}]}}]},{type:"textline",b:"kr = mix ( kr , ks , kt . r ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"kq . rgb = mix ( kq . rgb , kr . rgb , u_diffuse_color_factor ) ; kK = u_alpha_factor * kr . a ; kK += ( 1.0 - step ( 0.0 , kK ) ) ; kq . a = mix ( kK , 1.0 , u_diffuse_color . a ) ; kL = kr . a ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"kq . rgb *= mix ( vec3 ( 1.0 ) , kr . rgb , u_diffuse_color_factor ) ; kq . a = kr . a ; kL = kr . a ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"kx = u_diffuse_intensity * kq . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["ky","=","kx",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kJ = 0.5 * kw . y + 0.5 ; kz = u_environment_energy * kp ( kJ , kw ) ; kz = u_ambient * kz ; kK = eZ ( kx ) ; kA = u_emit * kq . rgb ; kB = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"kC = vec3 ( kL ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kC = texture2D ( u_specmap0 , kE ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kC = texture2D ( u_specmap0 , kD ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"fV ( kC . rgb ) ; kB = mix ( kB , kC , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",
b:"kJ = u_specular_params [ 0 ] ; kF = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; kC = kJ * kB ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"gO kN = jh ( kA , kz , kx ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO kN = jc ( kA , kz , kx , kC , jC , kw , kv , kF , u_diffuse_params , kK , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"ky = kN . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["kL","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kL","=","0.0",";"]}]}}]},{type:"textline",b:"jZ ( ky , kv , kw , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , kL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"ky += kN . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"ky = max ( ky - sqrt ( 0.01 * - min ( kH , 0.0 ) ) , 0.5 * ky ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"jA ( ky , kH , u_time , kK , kw , u_sun_direction , u_sun_intensity , u_sun_quaternion , jC , kI ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"kJ = kq . a ; if ( kJ <= 0.5 ) discard ; kJ = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kJ = kq . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kJ += kN . a . a * kC . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["kJ","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ky = mix ( km ( cI , kw . xz * u_refr_bump ) , ky , kJ ) ; kJ = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"kL = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"kB = gm ( u_cube_fog , kv ) ; ks = vec4 ( kB , u_fog_color_density . a ) ; fV ( ks . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ks = u_fog_color_density ; ks . rgb *= kL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"gC ( ky , kI , kv , u_cam_water_depth , u_underwater_fog_color_density , ks , kH , kL ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( ky , kI , ks ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"ky = vec3 ( dC . a ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","ky",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( ky , kJ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ky , kJ ) ; }".split(" ")}]};
a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ; varying vec3 jD ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jF",";"]}]}}]},{type:"condition",a:[{type:"if",
c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec4 kq , kr ; float ks , kt , ku ; mat4 kv ; vec3 kw , kx , ky , kz , kA , kB , kC ; kw = a_position ; kx = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"ky = vec3 ( a_tangent ) ; kz = a_tangent [ 3 ] * cross ( kx , ky ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kA = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; kB = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; kA = kA - u_camera_eye ; kz = cross ( kA , kB ) ; ky = cross ( kB , kz ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ky = vec3 ( 0.0 ) ; kz = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kw = mix ( kw , a_position_next , u_va_frame_factor ) ; kx = mix ( kx , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"kA = vec3 ( a_tangent ) ; kB = a_tangent_next [ 3 ] * cross ( a_normal_next , kA ) ; ky = mix ( ky , kA , u_va_frame_factor ) ; kz = mix ( kz , kB , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bv ( kw , ky , kz , kx ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["kA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d kD = fE ( kw , ky , kz , kx , kA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"kB = ( u_model_matrix * vec4 ( kA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"kv = ao ( u_camera_eye , kB , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kv = ai ( u_camera_eye , kB , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"kC = ( u_model_matrix * vec4 ( kA , 1.0 ) ) . xyz ; kv = kv * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kC ) ;".split(" ")}]}}]},{type:"textline",b:"d kD = av ( kw - kA , kA , ky , kz , kx , kv ) ; kD . b = kB ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d kD = av ( kw , kA , ky , kz , kx , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"ks = ( dot ( cross ( kD . e , kD . c ) , kD . d ) < 0.0 ) ? - 1.0 : 1.0 ; jE = vec4 ( kD . c , ks ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( kD . a , kD . b , kx ) ;".split(" ")}]}}]},{type:"textline",b:"jC = kD . a ; jD = kD . e ; jB = u_camera_eye - kD . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"jF = kD . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["jF","=","a_color",";"]}]}}]},{type:"textline",b:"kq = u_view_matrix * vec4 ( kD . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["cJ","=","kq",";"]}]}}]},{type:"textline",b:"kr = u_proj_matrix * kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"kr . xy += u_subpixel_jitter * kr . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["fO","(","kr",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( kD . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"ks = kr . x ; kt = kr . y ; ku = kr . w ; cI . x = ( ks + ku ) / 2.0 ; cI . y = ( kt + ku ) / 2.0 ; cI . z = ku ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jG = - kq . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","kr",";","}"]}]};a["nodes.glslf"]={type:"group",
a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3",
"(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",
file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 jC ; varying vec4 cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION",
"&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 kq = vec3 ( ZERO_VALUE_NODES ) ; vec3 kr = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 kv ( in vec3 ks , in float kt ) { vec3 ku ; ku = kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"ku = km ( cI , ks . xz * kt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ku = texture2D ( u_refractmap , cI . xy / cI . z ) . rgb ; fV ( ku ) ;".split(" ")}]}}]},{type:"textline",b:["return","ku",
";","}"]}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kA ( vec3 kw ) { float kx , ky ; vec4 kz ; kz = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; kz = mix ( vec4 ( kw . bg , kz . wz ) , vec4 ( kw . gb , kz . xy ) , step ( kw . b , kw . g ) ) ; kz = mix ( vec4 ( kz . xyw , kw . r ) , vec4 ( kw . r , kz . yzx ) , step ( kz . x , kw . r ) ) ; kx = kz . x - min ( kz . w , kz . y ) ; ky = 1.0e-10 ; return vec3 ( abs ( kz . z + ( kz . w - kz . y ) / ( 6.0 * kx + ky ) ) , kx / ( kz . x + ky ) , kz . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kE ( vec3 kB ) { vec3 kC ; vec4 kD ; kD = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; kC = abs ( fract ( vec3 ( kB . r , kB . r , kB . r ) + kD . xyz ) * 6.0 - kD . www ) ; return kB . b * mix ( kD . xxx , clamp ( kC - kD . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , kB . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 kG ( vec2 kF ) { return vec3 ( kF * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","||","USE_NODE_TEXTURE_NORMAL","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec2 kI ( vec3 kH ) { return vec2 ( kH . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",k:[{type:"node_out",name:"lI",qualifier:["vec3"],e:!0},{type:"node_out",name:"lJ",qualifier:["float"],e:!0},{type:"node_out",name:"lK",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lI"],f:[{type:"textline",b:"lI = normalize ( kV . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lJ"],f:[{type:"textline",b:"lJ = abs ( kV . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lK"],
f:[{type:"textline",b:"lK = length ( kV . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"lL",qualifier:["float"],e:!1},{type:"node_in",name:"lM",qualifier:["float"],e:!1},{type:"node_in",name:"lN",qualifier:["float"],e:!1},{type:"node_out",name:"lO",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lO = vec3 ( lL , lM , lN ) ;".split(" ")}]},{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"lP",qualifier:["float"],e:!1},{type:"node_in",name:"lQ",qualifier:["float"],
e:!1},{type:"node_in",name:"lR",qualifier:["float"],e:!1},{type:"node_out",name:"lS",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lS = kE ( vec3 ( lP , lQ , lR ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"lT",qualifier:["vec3"],e:!1},{type:"node_param",name:"kJ",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"lT = kG ( kJ ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"lU",qualifier:["vec3"],e:!1},{type:"node_param",name:"kK",
qualifier:["varying","vec3"]}],f:[{type:"textline",b:["lU","=","kK",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"lV",qualifier:["float"],e:!1},{type:"node_param",name:"kL",qualifier:["varying","float"]}],f:[{type:"textline",b:["lV","=","kL",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"lW",qualifier:["float"],e:!1},{type:"node_out",name:"lX",qualifier:["float"],e:!1},{type:"node_param",name:"kM",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"lW = kM [ 0 ] ; lX = kM [ 1 ] ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"lY",qualifier:["float"],e:!1},{type:"node_out",name:"lZ",qualifier:["float"],e:!1},{type:"node_out",name:"l_",qualifier:["float"],e:!1},{type:"node_param",name:"kN",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"lY = kN [ 0 ] ; lZ = kN [ 1 ] ; l_ = kN [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",k:[{type:"node_out",name:"ma",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["ma","=","lo",";"]}]},{type:"node",name:"GEOMETRY_FB",
k:[{type:"node_out",name:"mb",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mb = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mc",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mc","=","ln",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"md",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"md = vec3 ( lp . r , - lp . b , lp . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",
name:"me",qualifier:["float"],e:!1},{type:"node_in",name:"mf",qualifier:["float"],e:!1},{type:"node_in",name:"mg",qualifier:["float"],e:!1},{type:"node_in",name:"mh",qualifier:["float"],e:!1},{type:"node_in",name:"mi",qualifier:["vec3"],e:!1},{type:"node_out",name:"mj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lt = kA ( mi ) ; lt [ 0 ] += ( me - 0.5 ) ; if ( lt [ 0 ] > UNITY_VALUE_NODES ) lt [ 0 ] -= UNITY_VALUE_NODES ; else if ( lt [ 0 ] < ZERO_VALUE_NODES ) lt [ 0 ] += UNITY_VALUE_NODES ; lt *= vec3 ( UNITY_VALUE_NODES , mf , mg ) ; lt = mix ( kr , mix ( kq , lt , step ( kq , lt ) ) , step ( lt , kr ) ) ; mj = mix ( mi , kE ( lt ) , mh ) ;".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"mk",qualifier:["float"],e:!1},{type:"node_in",name:"ml",qualifier:["vec3"],e:!1},{type:"node_out",name:"mm",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mm = mix ( ml , kr - ml , mk ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"mn",qualifier:["vec3"],e:!0},{type:"node_out",name:"mo",qualifier:["vec3"],e:!1},{type:"node_out",name:"mp",qualifier:["float"],e:!1},{type:"node_out",name:"mq",qualifier:["float"],e:!0}],f:[{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_mn"],f:[{type:"textline",b:"mn = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"kW = u_lamp_light_factors [ LAMP_INDEX ] ; lu = u_lamp_light_directions [ LAMP_INDEX ] ; lv = u_lamp_light_positions [ LAMP_INDEX ] ; ld = kW . z ; if ( ld != - UNITY_VALUE_NODES ) { mo = lv - jC ; mp = length ( mo ) ; mo = normalize ( mo ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mq"],f:[{type:"textline",b:"mq = ld / ( ld + mp * mp ) ; ld = kW . x ; le = kW . y ; if ( ld > - UNITY_VALUE_NODES ) { lf = dot ( mo , lu ) ; lf *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( lf - ld ) / le ) ; mq *= lf ; }".split(" ")}]}]},
{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mo"],f:[{type:"textline",b:["mo","=","lu",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mp"],f:[{type:"textline",b:"mp = length ( lv - jC ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mq"],f:[{type:"textline",b:["mq","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",k:[{type:"node_in",name:"mr",qualifier:["vec3"],e:!1},{type:"node_out",
name:"ms",qualifier:["vec3"],e:!0},{type:"node_out",name:"mt",qualifier:["float"],e:!0},{type:"node_param",name:"kO",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ms"],f:[{type:"textline",b:["ms","=","kO",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mt"],f:[{type:"textline",b:"mt = - dot ( mr , kO ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",k:[{type:"node_in",name:"mu",qualifier:["vec3"],e:!1},{type:"node_out",name:"mv",qualifier:["vec3"],
e:!1}],f:[{type:"textline",b:"mv = - ( u_view_matrix_frag * vec4 ( mu , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"mw",qualifier:["vec3"],e:!1},{type:"node_out",name:"mx",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mx","=","mw",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"mx = ( MAPPING_TRS_MATRIX * vec4 ( mx , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",
name:"MAPPING_SCALE",f:[{type:"textline",b:"mx = mx * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"mx = mx + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"mx = max ( mx , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",b:"mx = min ( mx , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"mx = normalize ( mx ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"my",qualifier:["float"],e:!1},{type:"node_in",name:"mz",qualifier:["float"],e:!1},{type:"node_out",name:"mA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mA = my + mz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mA = clamp ( mA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"mB",qualifier:["float"],e:!1},{type:"node_in",name:"mC",qualifier:["float"],e:!1},{type:"node_out",name:"mD",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mD = mB - mC ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mD = clamp ( mD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",k:[{type:"node_in",name:"mE",qualifier:["float"],e:!1},{type:"node_in",
name:"mF",qualifier:["float"],e:!1},{type:"node_out",name:"mG",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mG = mE * mF ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mG = clamp ( mG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_in",name:"mI",qualifier:["float"],e:!1},{type:"node_out",name:"mJ",qualifier:["float"],e:!1}],f:[{type:"textline",
b:"mJ = ( mI != ZERO_VALUE_NODES ) ? mH / mI : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mJ = clamp ( mJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"mK",qualifier:["float"],e:!1},{type:"node_in",name:"mL",qualifier:["float"],e:!1},{type:"node_out",name:"mM",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mM = sin ( mK ) ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mM = clamp ( mM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mL",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"mN",qualifier:["float"],e:!1},{type:"node_in",name:"mO",qualifier:["float"],e:!1},{type:"node_out",name:"mP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mP = cos ( mN ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"mP = clamp ( mP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mO",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"mQ",qualifier:["float"],e:!1},{type:"node_in",name:"mR",qualifier:["float"],e:!1},{type:"node_out",name:"mS",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mS = tan ( mQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mS = clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mR",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"mT",qualifier:["float"],e:!1},{type:"node_in",name:"mU",qualifier:["float"],e:!1},{type:"node_out",name:"mV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mV = ( mT <= UNITY_VALUE_NODES && mT >= - UNITY_VALUE_NODES ) ? asin ( mT ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mV = clamp ( mV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mU",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"mW",qualifier:["float"],e:!1},{type:"node_in",name:"mX",qualifier:["float"],e:!1},{type:"node_out",name:"mY",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mY = ( mW <= UNITY_VALUE_NODES && mW >= - UNITY_VALUE_NODES ) ? acos ( mW ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mY = clamp ( mY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mX",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_in",name:"m_",qualifier:["float"],e:!1},{type:"node_out",name:"na",qualifier:["float"],e:!1}],f:[{type:"textline",b:"na = atan ( mZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"na = clamp ( na , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["m_",";"]}]},{type:"node",name:"MATH_POWER",
k:[{type:"node_in",name:"nb",qualifier:["float"],e:!1},{type:"node_in",name:"nc",qualifier:["float"],e:!1},{type:"node_out",name:"nd",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( nb < ZERO_VALUE_NODES || nb == ZERO_VALUE_NODES && nc == ZERO_VALUE_NODES ) nd = ZERO_VALUE_NODES ; else nd = pow ( nb , nc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nd = clamp ( nd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_LOGARITHM",k:[{type:"node_in",name:"ne",qualifier:["float"],e:!1},{type:"node_in",name:"nf",qualifier:["float"],e:!1},{type:"node_out",name:"ng",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ng = ( ne > ZERO_VALUE_NODES && nf > ZERO_VALUE_NODES ) ? log2 ( ne ) / log2 ( nf ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ng = clamp ( ng , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MINIMUM",k:[{type:"node_in",name:"nh",qualifier:["float"],e:!1},{type:"node_in",name:"ni",qualifier:["float"],e:!1},{type:"node_out",name:"nj",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nj = min ( nh , ni ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nj = clamp ( nj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"nk",qualifier:["float"],e:!1},{type:"node_in",
name:"nl",qualifier:["float"],e:!1},{type:"node_out",name:"nm",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nm = max ( nk , nl ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nm = clamp ( nm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"nn",qualifier:["float"],e:!1},{type:"node_in",name:"no",qualifier:["float"],e:!1},{type:"node_out",name:"np",qualifier:["float"],e:!1}],
f:[{type:"textline",b:"np = floor ( nn + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"np = clamp ( np , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["no",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"nq",qualifier:["float"],e:!1},{type:"node_in",name:"nr",qualifier:["float"],e:!1},{type:"node_out",name:"ns",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ns = ( nq < nr ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ns = clamp ( ns , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"nt",qualifier:["float"],e:!1},{type:"node_in",name:"nu",qualifier:["float"],e:!1},{type:"node_out",name:"nv",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nv = ( nt > nu ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nv = clamp ( nv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"nw",qualifier:["float"],e:!1},{type:"node_in",name:"nx",qualifier:["float"],e:!1},{type:"node_out",name:"ny",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ny = abs ( nx ) > 0.000001 ? mod ( nw , nx ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ny = clamp ( ny , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"nz",qualifier:["float"],e:!1},{type:"node_in",name:"nA",qualifier:["float"],e:!1},{type:"node_out",name:"nB",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nB = abs ( nz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nB = clamp ( nB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nA",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"nC",
qualifier:["float"],e:!1},{type:"node_in",name:"nD",qualifier:["vec3"],e:!1},{type:"node_in",name:"nE",qualifier:["vec3"],e:!1},{type:"node_out",name:"nF",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( nC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nF = mix ( nD , nE , ld ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nF = clamp ( nF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",
k:[{type:"node_in",name:"nG",qualifier:["float"],e:!1},{type:"node_in",name:"nH",qualifier:["vec3"],e:!1},{type:"node_in",name:"nI",qualifier:["vec3"],e:!1},{type:"node_out",name:"nJ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nJ = mix ( nH , nH + nI , le ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nJ = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"nK",qualifier:["float"],e:!1},{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_in",name:"nM",qualifier:["vec3"],e:!1},{type:"node_out",name:"nN",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( nK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nN = mix ( nL , nL * nM , lf ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nN = clamp ( nN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"nO",qualifier:["float"],e:!1},{type:"node_in",name:"nP",qualifier:["vec3"],e:!1},{type:"node_in",name:"nQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"nR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( nO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nR = mix ( nP , nP - nQ , ld ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nR = clamp ( nR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"nS",qualifier:["float"],e:!1},{type:"node_in",name:"nT",qualifier:["vec3"],e:!1},{type:"node_in",name:"nU",qualifier:["vec3"],e:!1},{type:"node_out",name:"nV",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lf = UNITY_VALUE_NODES - le ; nV = kr - ( vec3 ( lf ) + le * ( kr - nU ) ) * ( kr - nT ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",
b:"nV = clamp ( nV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"nW",qualifier:["float"],e:!1},{type:"node_in",name:"nX",qualifier:["vec3"],e:!1},{type:"node_in",name:"nY",qualifier:["vec3"],e:!1},{type:"node_out",name:"nZ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( nW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lf = UNITY_VALUE_NODES - ld ; nY += step ( nY , kq ) ; nZ = lf * nX + ld * nX / nY ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nZ = clamp ( nZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"n_",qualifier:["float"],e:!1},{type:"node_in",name:"oa",qualifier:["vec3"],e:!1},{type:"node_in",name:"ob",qualifier:["vec3"],e:!1},{type:"node_out",name:"oc",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( n_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oc = mix ( oa , abs ( oa - ob ) , le ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oc = clamp ( oc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"od",qualifier:["float"],e:!1},{type:"node_in",name:"oe",qualifier:["vec3"],e:!1},{type:"node_in",name:"of",qualifier:["vec3"],e:!1},{type:"node_out",name:"og",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( od , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; og = min ( oe . rgb , of . rgb * lf ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"og = clamp ( og , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"oh",qualifier:["float"],e:!1},{type:"node_in",name:"oi",qualifier:["vec3"],e:!1},{type:"node_in",name:"oj",qualifier:["vec3"],e:!1},{type:"node_out",name:"ok",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( oh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ok = max ( oi . rgb , oj . rgb * ld ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ok = clamp ( ok , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"ol",qualifier:["float"],e:!1},{type:"node_in",name:"om",qualifier:["vec3"],e:!1},{type:"node_in",name:"on",qualifier:["vec3"],e:!1},{type:"node_out",name:"oo",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( ol , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lu = vec3 ( UNITY_VALUE_NODES - le ) ; oo = mix ( om * ( lu + 2.0 * le * on ) , kr - ( lu + 2.0 * le * ( kr - on ) ) * ( kr - om ) , step ( 0.5 , om ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oo = clamp ( oo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"op",qualifier:["float"],e:!1},{type:"node_in",name:"oq",qualifier:["vec3"],e:!1},{type:"node_in",name:"or",qualifier:["vec3"],e:!1},{type:"node_out",name:"os",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( op , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lv = kr - lf * or ; lu = clamp ( oq / lv , 0.0 , 1.0 ) ; os = mix ( mix ( lu , kr , step ( lv , kq ) ) , oq , step ( oq , kq ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"os = clamp ( os , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"ot",qualifier:["float"],e:!1},{type:"node_in",name:"ou",qualifier:["vec3"],e:!1},{type:"node_in",name:"ov",qualifier:["vec3"],e:!1},{type:"node_out",name:"ow",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( ot , 0.0 , 1.0 ) ; lu = vec3 ( 1.0 - ld ) ; lv = lu + ld * ov ; lu = clamp ( kr - ( kr - ou ) / lv , 0.0 , 1.0 ) ; ow = mix ( lu , kq , step ( lv , kq ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ow = clamp ( ow , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"ox",qualifier:["float"],e:!1},{type:"node_in",name:"oy",qualifier:["vec3"],e:!1},{type:"node_in",name:"oz",qualifier:["vec3"],e:!1},{type:"node_out",name:"oA",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( ox , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oA = oy ; lv = kA ( oz ) ; if ( lv . y != ZERO_VALUE_NODES ) { lu = kA ( oA ) ; lu . x = lv . x ; lw = kE ( lu ) ; oA = mix ( oA , lw , le ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oA = clamp ( oA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"oB",qualifier:["float"],e:!1},{type:"node_in",name:"oC",qualifier:["vec3"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_out",name:"oE",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( oB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ld = UNITY_VALUE_NODES - lf ; oE = oC ; lv = kA ( oE ) ; if ( lv . y != ZERO_VALUE_NODES ) { lw = kA ( oD ) ; lv . y = ld * lv . y + lf * lw . y ; oE = kE ( lv ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oE = clamp ( oE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"oF",qualifier:["float"],e:!1},{type:"node_in",name:"oG",qualifier:["vec3"],e:!1},{type:"node_in",name:"oH",qualifier:["vec3"],e:!1},{type:"node_out",name:"oI",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( oF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ld = UNITY_VALUE_NODES - le ; lw = kA ( oG ) ; lx = kA ( oH ) ; lw . z = ld * lw . z + le * lx . z ; oI = kE ( lw ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oI = clamp ( oI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"oJ",qualifier:["float"],e:!1},{type:"node_in",name:"oK",qualifier:["vec3"],e:!1},{type:"node_in",name:"oL",qualifier:["vec3"],e:!1},{type:"node_out",name:"oM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( oJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oM = oK ; ly = kA ( oL ) ; if ( ly . y != ZERO_VALUE_NODES ) { lx = kA ( oM ) ; lx . x = ly . x ; lx . y = ly . y ; lz = kE ( lx ) ; oM = mix ( oM , lz , lf ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oM = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"oN",qualifier:["float"],e:!1},{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_in",name:"oP",qualifier:["vec3"],e:!1},{type:"node_out",name:"oQ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ld = clamp ( oN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; le = UNITY_VALUE_NODES - ld ; ly = oP + oO - oP * oO ; oQ = oO * ( vec3 ( le ) + vec3 ( ld ) * ( ( kr - oO ) * oP + ly ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oQ = clamp ( oQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"oR",qualifier:["float"],e:!1},{type:"node_in",name:"oS",qualifier:["vec3"],e:!1},{type:"node_in",name:"oT",qualifier:["vec3"],e:!1},{type:"node_out",name:"oU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( oR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oU = oS + lf * ( 2.0 * oT - kr ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oU = clamp ( oU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"oV",qualifier:["vec3"],e:!1},{type:"node_in",name:"oW",qualifier:["float"],e:!1}],f:[{type:"textline",b:"lq = oV ; lc = oW ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"oX",qualifier:["vec3"],e:!1},{type:"node_in",name:"oY",qualifier:["float"],e:!1},{type:"node_in",
name:"oZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"o_",qualifier:["vec3"],e:!0},{type:"node_out",name:"pa",qualifier:["vec3"],e:!0},{type:"node_out",name:"pb",qualifier:["float"],e:!0},{type:"node_out",name:"pc",qualifier:["vec3"],e:!0},{type:"node_param",name:"kP",qualifier:["const","vec2"]},{type:"node_param",name:"kQ",qualifier:["const","vec3"]}],f:[{type:"textline",b:"lz = clamp ( oX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ly = kQ [ 0 ] * clamp ( oZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"lA = normalize ( o_ ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lA","=","lo",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"lB = kZ * lz ; le = 0.5 * lA . y + 0.5 ; lC = la * u_environment_energy * kp ( le , lA ) ; ld = eZ ( lz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"kT = vec2 ( kP [ 0 ] , kP [ 1 ] ) ; kU = vec2 ( kQ [ 1 ] , kQ [ 2 ] ) ; lH = jc ( lB , lC , lz , ly , lp , lA , ln , kU , kT , ld , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"lH = jh ( lB , lC , lz ) ;".split(" ")}]}]},{type:"textline",b:["lb","=","ld",";"]}]},{type:"node_else",f:[{type:"textline",b:"lH . a = vec4 ( lz , ZERO_VALUE_NODES ) ; lH . b = kq ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pa"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"pa = lH . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["pa","=","kq",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pa += lH . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pb"],f:[{type:"textline",b:"pb = clamp ( oY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pb += lH . a . a * ly . r * k_ ; pb = clamp ( pb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pc"],f:[{type:"textline",b:["pc","=","lA",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"lr = lH . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lr","=","kq",";"]}]}]},{type:"textline",b:["ls","=","lA",";"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"pd",qualifier:["vec3"],e:!1},{type:"node_in",name:"pe",qualifier:["float"],e:!1},{type:"node_in",name:"pf",qualifier:["vec3"],e:!1},{type:"node_in",name:"pg",
qualifier:["vec3"],e:!0},{type:"node_in",name:"ph",qualifier:["float"],e:!1},{type:"node_in",name:"pi",qualifier:["float"],e:!1},{type:"node_in",name:"pj",qualifier:["vec4"],e:!1},{type:"node_in",name:"pk",qualifier:["float"],e:!1},{type:"node_in",name:"pl",qualifier:["float"],e:!1},{type:"node_out",name:"pm",qualifier:["vec3"],e:!0},{type:"node_out",name:"pn",qualifier:["float"],e:!0},{type:"node_out",name:"po",qualifier:["vec3"],e:!0},{type:"node_out",name:"pp",qualifier:["vec3"],e:!0},{type:"node_out",
name:"pq",qualifier:["vec3"],e:!0},{type:"node_param",name:"kR",qualifier:["const","vec2"]},{type:"node_param",name:"kS",qualifier:["const","vec3"]}],f:[{type:"textline",b:"ly = clamp ( pd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lD = kS [ 0 ] * clamp ( pf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"lE = normalize ( pg ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lE","=","lo",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"lf = eZ ( ly ) ; lF = ph * ly ; lg = 0.5 * lE . y + 0.5 ; lG = la * u_environment_energy * kp ( lg , lE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"kU = vec2 ( kR [ 0 ] , kR [ 1 ] ) ; kT = vec2 ( kS [ 1 ] , kS [ 2 ] ) ; lH = jc ( lF , lG , ly , lD , lp , lE , ln , kT , kU , lf , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , pi , pj ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"lH = jh ( lF , lG , ly ) ;".split(" ")}]}]},{type:"textline",b:["lb","=","lf",";"]}]},{type:"node_else",f:[{type:"textline",b:"lH . a = vec4 ( ly , ZERO_VALUE_NODES ) ; lH . b = kq ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pm"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"pm = lH . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["pm","=","kq",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],f:[{type:"textline",b:"jZ ( pm , ln , lE , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , pk ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pm += lH . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pn"],f:[{type:"textline",b:"pn = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"pn += lH . a . a * lD . r * pl ; pn = clamp ( pn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_po"],f:[{type:"textline",b:["po","=","lE",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pp"],f:[{type:"textline",b:"pp = lH . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pq"],f:[{type:"textline",b:"pq = lH . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"lr = lH . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lr","=","kq",";"]}]}]},{type:"textline",b:["ls","=","lE",";"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"pr",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pr = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"ps",qualifier:["vec3"],e:!1},{type:"node_out",name:"pt",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pt = ps . r * 0.35 + ps . g * 0.45 + ps . b * 0.2 ;".split(" ")}]},
{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"pu",qualifier:["vec3"],e:!1},{type:"node_out",name:"pv",qualifier:["float"],e:!0},{type:"node_out",name:"pw",qualifier:["float"],e:!0},{type:"node_out",name:"px",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pv"],f:[{type:"textline",b:"pv = pu . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pw"],f:[{type:"textline",b:"pw = pu . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_px"],f:[{type:"textline",b:"px = pu . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"py",qualifier:["vec3"],e:!1},{type:"node_out",name:"pz",qualifier:["float"],e:!0},{type:"node_out",name:"pA",qualifier:["float"],e:!0},{type:"node_out",name:"pB",qualifier:["float"],e:!0}],f:[{type:"textline",b:"lD = kA ( py ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pz"],f:[{type:"textline",b:"pz = lD . r ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_pA"],f:[{type:"textline",b:"pA = lD . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pB"],f:[{type:"textline",b:"pB = lD . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"pC",qualifier:["float"],e:!1},{type:"node_in",name:"pD",qualifier:["float"],e:!1},{type:"node_in",name:"pE",qualifier:["float"],e:!1},{type:"node_out",name:"pF",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pF = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( pC - pE ) * pD ) ) ) ;".split(" ")}]},
{type:"node",name:"GAMMA",k:[{type:"node_in",name:"pG",qualifier:["vec3"],e:!1},{type:"node_in",name:"pH",qualifier:["float"],e:!1},{type:"node_out",name:"pI",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pI = max ( kq , pG ) ; pI = pow ( pI , vec3 ( pH ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"pJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"pK",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pK = max ( kq , pJ ) ; pK = pow ( pK , vec3 ( 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"pL",qualifier:["vec3"],e:!1},{type:"node_out",name:"pM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pM = max ( kq , pL ) ; pM = pow ( pM , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",k:[{type:"node_out",name:"pN",qualifier:["vec3"],e:!1},{type:"node_out",name:"pO",qualifier:["vec3"],e:!1},{type:"node_out",name:"pP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pP = pN [ 0 ] = pN [ 1 ] = pN [ 2 ] = pO [ 0 ] = pO [ 1 ] = pO [ 2 ] = 0.0 ;".split(" ")}]},
{type:"node",name:"TEXTURE_ENVIRONMENT",k:[{type:"node_in",name:"pQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"pR",qualifier:["vec3"],e:!0},{type:"node_out",name:"pS",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"kW = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , pQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pR"],f:[{type:"textline",b:"pR = kW . xyz ; fV ( pR ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pS"],f:[{type:"textline",b:"pS = kW . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"pT",qualifier:["vec3"],e:!0},{type:"node_in",name:"pU",qualifier:["vec3"],e:!0},{type:"node_in",name:"pV",qualifier:["vec3"],e:!0},{type:"node_in",name:"pW",qualifier:["vec3"],e:!0},{type:"node_out",name:"pX",qualifier:["vec3"],e:!0},{type:"node_out",name:"pY",qualifier:["float"],e:!0},{type:"node_out",name:"pZ",qualifier:["vec3"],
e:!0},{type:"node_out",name:"p_",qualifier:["float"],e:!0},{type:"node_out",name:"qa",qualifier:["vec3"],e:!0},{type:"node_out",name:"qb",qualifier:["float"],e:!0},{type:"node_out",name:"qc",qualifier:["vec3"],e:!0},{type:"node_out",name:"qd",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_COLOR_var_texture , kI ( pT ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pX"],f:[{type:"textline",b:"pX = kW . xyz ; fV ( pX ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pY"],f:[{type:"textline",b:"pY = kW . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_COLOR_var_texture , kI ( pU ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pZ"],f:[{type:"textline",b:"pZ = kW . xyz ; fV ( pZ ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_p_"],f:[{type:"textline",b:"p_ = kW . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_COLOR_var_texture , kI ( pV ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qa"],f:[{type:"textline",b:"qa = kW . xyz ; fV ( qa ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qb"],f:[{type:"textline",b:"qb = kW . w ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_uv4"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_COLOR_var_texture , kI ( pW ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qc"],f:[{type:"textline",b:"qc = kW . xyz ; fV ( qc ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qd"],f:[{type:"textline",b:"qd = kW . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"qe",qualifier:["vec3"],e:!0},{type:"node_in",name:"qf",qualifier:["vec3"],
e:!0},{type:"node_in",name:"qg",qualifier:["vec3"],e:!0},{type:"node_in",name:"qh",qualifier:["vec3"],e:!0},{type:"node_out",name:"qi",qualifier:["vec3"],e:!0},{type:"node_out",name:"qj",qualifier:["float"],e:!0},{type:"node_out",name:"qk",qualifier:["vec3"],e:!0},{type:"node_out",name:"ql",qualifier:["float"],e:!0},{type:"node_out",name:"qm",qualifier:["vec3"],e:!0},{type:"node_out",name:"qn",qualifier:["float"],e:!0},{type:"node_out",name:"qo",qualifier:["vec3"],e:!0},{type:"node_out",name:"qp",
qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_NORMAL_var_texture , kI ( qe ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qi"],f:[{type:"textline",b:"qi = normalize ( kX * ( kW . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qj"],f:[{type:"textline",b:"qj = kW . w ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_uv2"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_NORMAL_var_texture , kI ( qf ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qk"],f:[{type:"textline",b:"qk = normalize ( kX * ( kW . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ql"],f:[{type:"textline",b:"ql = kW . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_NORMAL_var_texture , kI ( qg ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qm"],f:[{type:"textline",b:"qm = normalize ( kX * ( kW . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qn"],f:[{type:"textline",b:"qn = kW . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],f:[{type:"textline",b:"kW = texture2D ( node_TEXTURE_NORMAL_var_texture , kI ( qh ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qo"],f:[{type:"textline",b:"qo = normalize ( kX * ( kW . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qp"],f:[{type:"textline",b:"qp = kW . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",k:[{type:"node_out",name:"qq",qualifier:["float"],e:!1}],f:[{type:"textline",b:"qq = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_in",name:"qs",qualifier:["vec3"],e:!1},{type:"node_out",name:"qt",qualifier:["vec3"],e:!1},{type:"node_out",name:"qu",qualifier:["float"],
e:!0}],f:[{type:"textline",b:"qt = qr + qs ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qu"],f:[{type:"textline",b:"qu = ( abs ( qt [ 0 ] ) + abs ( qt [ 1 ] ) + abs ( qt [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"qv",qualifier:["vec3"],e:!1},{type:"node_in",name:"qw",qualifier:["vec3"],e:!1},{type:"node_out",name:"qx",qualifier:["vec3"],e:!1},{type:"node_out",name:"qy",qualifier:["float"],e:!0}],f:[{type:"textline",
b:"qx = qv - qw ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qy"],f:[{type:"textline",b:"qy = ( abs ( qx [ 0 ] ) + abs ( qx [ 1 ] ) + abs ( qx [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"qz",qualifier:["vec3"],e:!1},{type:"node_in",name:"qA",qualifier:["vec3"],e:!1},{type:"node_out",name:"qB",qualifier:["vec3"],e:!1},{type:"node_out",name:"qC",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qB = qz + qA ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qC"],f:[{type:"textline",b:"qC = length ( qB ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qB"],f:[{type:"textline",b:"qB = normalize ( qB ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"qD",qualifier:["vec3"],e:!1},{type:"node_in",name:"qE",qualifier:["vec3"],e:!1},{type:"node_out",name:"qF",qualifier:["vec3"],e:!1},{type:"node_out",name:"qG",qualifier:["float"],e:!0}],f:[{type:"textline",
b:["qF","=","kq",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qG"],f:[{type:"textline",b:"qG = dot ( qD , qE ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"qH",qualifier:["vec3"],e:!1},{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_out",name:"qJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"qK",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qJ = cross ( qH , qI ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_qK"],f:[{type:"textline",b:"qK = length ( qJ ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"qL",qualifier:["vec3"],e:!1},{type:"node_in",name:"qM",qualifier:["vec3"],e:!1},{type:"node_out",name:"qN",qualifier:["vec3"],e:!1},{type:"node_out",name:"qO",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qN = normalize ( qL ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qO"],f:[{type:"textline",b:"qO = length ( qL ) ;".split(" ")}]}]},
{type:"textline",b:["qM",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"qP",qualifier:["vec3"],e:!1},{type:"node_in",name:"qQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"qR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"qR = reflect ( - qP , qQ ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"qS",qualifier:["vec3"],e:!1},{type:"node_in",name:"qT",qualifier:["float"],e:!1},{type:"node_in",name:"qU",qualifier:["const","float"],e:!1},{type:"node_in",
name:"qV",qualifier:["const","float"],e:!1},{type:"node_out",name:"qW",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"lh = length ( kV ) ; if ( lh < qV ) { kT = kI ( qS ) ; li = clamp ( 0.5 * ( qV - lh ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; li = qT * li ; lD = normalize ( ln * kX ) ; lj = UNITY_VALUE_NODES / qU ; kU = lD . xy * li / ( qU * lD . z ) ; lk = UNITY_VALUE_NODES ; ll = texture2D ( node_B4W_PARALLAX_var_texture , kT ) . a ; for ( float qX = 1.0 ; qX <= qU ; qX ++ ) { if ( ll < lk ) { lk -= lj ; kT -= kU ; ll = texture2D ( node_B4W_PARALLAX_var_texture , kT ) . a ; } } kU = kT + kU ; lj = texture2D ( node_B4W_PARALLAX_var_texture , kU ) . a - ( lk + lj ) ; lk = ll - lk ; lk = lk / ( lk - lj ) ; kT = lk * kU + ( UNITY_VALUE_NODES - lk ) * kT ; qW = kG ( kT ) ; } else qW = qS ;".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"qY",qualifier:["vec3"],e:!1},{type:"node_out",name:"qZ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"qZ = clamp ( qY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"q_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ra",qualifier:["float"],e:!1},{type:"node_out",name:"rb",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rb = kv ( q_ , ra ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"rc",qualifier:["float"],e:!1},{type:"node_in",name:"rd",qualifier:["float"],e:!1},{type:"node_in",name:"re",qualifier:["float"],e:!1},{type:"node_in",name:"rf",qualifier:["float"],e:!1},{type:"node_in",name:"rg",qualifier:["float"],e:!1},{type:"node_out",name:"rh",qualifier:["float"],e:!0},{type:"node_out",name:"ri",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rh"],f:[{type:"textline",b:["rh","=","rc",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ri"],f:[{type:"textline",b:"ri = vec4 ( rd , re , rf , rg ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"rj",qualifier:["float"],e:!1}],f:[{type:"textline",b:["rj","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"rk",qualifier:["float"],e:!1},{type:"node_in",name:"rl",qualifier:["float"],e:!1},{type:"node_in",name:"rm",qualifier:["float"],e:!1},{type:"node_out",name:"rn",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"rn = smoothstep ( rl , rm , rk ) ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec2 kT , kU ; vec4 kV , kW ; mat3 kX ; float kY , kZ , k_ , la , lb , lc , ld , le , lf , lg , lh , li , lj , lk , ll ; vec3 lm , ln , lo , lp , lq , lr , ls , lt , lu , lv , lw , lx , ly , lz , lA , lB , lC , lD , lE , lF , lG ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["lm","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kY = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["ln","=","jD",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",
b:"if ( gl_FrontFacing ) ln = ln ; else ln = - ln ;".split(" ")}]}}]},{type:"textline",b:"lo = normalize ( ln ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"lp = cross ( ln , jE . xyz ) * jE . w ; kX = mat3 ( jE . xyz , lp , ln ) ; kX = kX ;".split(" ")}]}}]},{type:"textline",b:"lp = u_camera_eye_frag - jC ; ln = normalize ( lp ) ; lp = jC ; kV = cJ ; kZ = u_emit ; k_ = u_specular_alpha ; la = u_ambient ; gO lH ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"lD = lq ; lj = lc ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lD = max ( lD - sqrt ( 0.01 * - min ( kY , ZERO_VALUE_NODES ) ) , 0.5 * lD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"jA ( lD , kY , u_time , lb , ls , u_sun_direction , lm , u_sun_quaternion , jC , length ( cJ ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"lk = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"lq = gm ( u_cube_fog , ln ) ; kW = vec4 ( lq , u_fog_color_density . a ) ; fV ( kW . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kW = u_fog_color_density ; kW . rgb *= lk ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"gC ( lD , length ( cJ ) , ln , u_cam_water_depth , u_underwater_fog_color_density , kW , kY , lk ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( lD , length ( cJ ) , kW ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"if ( lj < 0.5 ) discard ; lj = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"kU = texture2DProj ( u_shadow_mask , cI ) . rg ; lc = kU . g ; lD = vec3 ( lc ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","lD",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( lD , lj ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lD , lj ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",
c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 jC ; varying vec4 cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"kJ",qualifier:["varying",
"vec2"]}],f:[{type:"textline",b:["kJ","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"kO",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["kO","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"kP",
qualifier:["varying","float"]}],f:[{type:"textline",b:["kP","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"kQ",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["kQ","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute",
"vec3"]},{type:"node_param",name:"kR",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["kR","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec4 kS ; float kT , kU , kV ; mat4 kW ; vec3 kX , kY , kZ , k_ , la , lb , lc ; kX = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kY = a_normal ; kZ = vec3 ( a_tangent ) ; k_ = a_tangent [ 3 ] * cross ( kY , kZ ) ;".split(" ")}]}},
{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:"kY = a_normal ; kZ = vec3 ( 0.0 ) ; k_ = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kY = vec3 ( 0.0 ) ; kZ = vec3 ( 0.0 ) ; k_ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kX = mix ( kX , a_position_next , u_va_frame_factor ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:"kY = mix ( kY , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"la = vec3 ( a_tangent ) ; lb = a_tangent_next [ 3 ] * cross ( a_normal_next , la ) ; kZ = mix ( kZ , la , u_va_frame_factor ) ; k_ = mix ( k_ , lb , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bv ( kX , kZ , k_ , kY ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["la","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"la = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"lb = ( u_model_matrix * vec4 ( la , 1.0 ) ) . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"kW = ao ( u_camera_eye , lb , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kW = ai ( u_camera_eye , lb , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"lc = ( u_model_matrix * vec4 ( la , 1.0 ) ) . xyz ; kW = kW * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lc ) ;".split(" ")}]}}]},
{type:"textline",b:"d ld = av ( kX - la , la , kZ , k_ , kY , kW ) ; ld . b = lb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d ld = av ( kX , la , kZ , k_ , kY , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( ld . a , ld . b , kY ) ;".split(" ")}]}}]},{type:"textline",b:"jC = ld . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"jD = ld . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kT = ( dot ( cross ( ld . e , ld . c ) , ld . d ) < 0.0 ) ? - 1.0 : 1.0 ; jE = vec4 ( ld . c , kT ) ;".split(" ")}]}}]},{type:"textline",b:"cJ = u_view_matrix * vec4 ( ld . a , 1.0 ) ; kS = u_proj_matrix * cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"kS . xy += u_subpixel_jitter * kS . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["fO","(","kS",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( ld . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_B4W_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"kT = kS . x ; kU = kS . y ; kV = kS . w ; cI . x = ( kT + kV ) / 2.0 ; cI . y = ( kU + kV ) / 2.0 ; cI . z = kV ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jG = - cJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","kS",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float kS ; varying vec3 jF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cJ",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 kT ; float kU ; kU = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; kU = smoothstep ( u_p_alpha_start , u_p_alpha_end , kU ) ; kU = u_diffuse_color . a * kS * ( 1.0 - clamp ( kU , 0.0 , 1.0 ) ) ; kT = jF * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gg ( kT , length ( cJ ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","kT",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kT , kU ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kT , kU ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float kS ; varying vec3 jF ; varying vec3 cJ ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float lF ; vec4 lG ; kT lH ; lH = lE ( ) ; lG = u_view_matrix * vec4 ( lH . b , 1.0 ) ; gl_Position = u_proj_matrix * lG ; kS = lH . c ; jF = lH . d ; cJ = lG . xyz ; lF = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = lH . a * lF ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",
a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float kS ; varying vec3 jF ; varying vec2 a ; varying vec3 jB ; varying vec3 jC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec2 kq ; float kr ; vec3 ks , kt , ku , kv , kw , kx ; vec4 ky , kz ; ky = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"kz = texture2D ( u_sampler , a ) ; fV ( kz . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"ky . rgb = mix ( ky . rgb , kz . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"ky . rgb *= mix ( vec3 ( 1.0 ) , kz . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"ky . a = kz . a ;".split(" ")}]}}]},{type:"textline",b:"ky . rgb *= jF ; ks = u_diffuse_intensity * ky . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kt = u_emit * ky . rgb ; ku = vec3 ( 0.0 , 1.0 , 0.0 ) ; kr = 0.5 ; kv = u_environment_energy * kp ( kr , ku ) ; kv = u_ambient * kv ; kr = u_specular_params [ 0 ] ; kq = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; kw = kr * u_specular_color ; kx = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO kA = jc ( kt , kv , ks , kw , jC , ku , kx , kq , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gO kA = jh ( kt , kv , ks ) ;".split(" ")}]}}]},{type:"textline",b:"kw = kA . a . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kw","=","ks",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gg ( kw , length ( cJ ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"kr = ky . a * kS ; fX ( kw ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kw , kr ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kw , kr ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",
name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float kS ; varying vec3 jF ; varying vec2 a ; varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float ks ( vec2 kq , vec2 kr ) { return ( atan ( kr . y , kr . x ) - atan ( kq . y , kq . x ) ) ; } void main ( ) { vec4 kt , ku , kv ; mat4 kw ; float kx ; kT ky ; ky = lE ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { kx = ky . e ; kw = N ( ky . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { kx = ky . e ; kw = x ( ) ; kw [ 3 ] = vec4 ( ky . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { kx = ky . e ; kw = B ( radians ( 90.0 ) ) ; kw [ 3 ] = vec4 ( ky . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { kx = ks ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + ky . e ; kw = z ( radians ( - 90.0 ) ) ; kw [ 3 ] = vec4 ( ky . b , 1.0 ) ; } kt = vec4 ( a_p_bb_vertex * 2.0 * ky . a * u_p_size , 0.0 , 1.0 ) ; kt = kw * D ( kx ) * kt ; ku = u_view_matrix * kt ; kv = u_proj_matrix * ku ; gl_Position = kv ; kS = ky . c ; jF = ky . d ; a = a_p_bb_vertex + 0.5 ; jC = kt . xyz ; jB = u_camera_eye - kt . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cJ","=","ku",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 lF ; const float lG = 0.99 ; const float lH = 1.8 ; const int lI = 8 ; float lO ( vec3 lJ , vec3 lK ) { float lL , lM , lN ; lL = dot ( lK , lK ) ; lM = 2.0 * dot ( lK , lJ ) ; lN = dot ( lJ , lJ ) - 1.0 ; lL = lM * lM - 4.0 * lL * lN ; lL = sqrt ( lL ) ; lM = ( - lM - lL ) / 2.0 ; lL = lN / lM ; return lL ; } float lV ( float lP , float lQ ) { float lR , lS , lT , lU ; lR = 3.0 * ( 1.0 - lQ * lQ ) ; lS = 2.0 * ( 2.0 + lQ * lQ ) ; lT = 1.0 + lP * lP ; lU = pow ( 1.0 + lQ * lQ - 2.0 * lQ * lP , 1.5 ) ; lU = max ( lU , 0.00001 ) ; return ( lR / lS ) * ( lT / lU ) ; } float ma ( vec3 lW , vec3 lX , float lY ) { vec3 lZ ; float l_ ; l_ = dot ( lX , - lW ) ; if ( l_ < 0.0 ) { return 1.0 ; } lZ = lW + l_ * lX ; if ( length ( lZ ) < lY ) { return 0.0 ; } else if ( length ( lZ ) >= lY ) { lZ = normalize ( lZ ) * lY - lW ; l_ = acos ( dot ( normalize ( lZ ) , lX ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( l_ * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 me ( float mb , vec3 mc , float md ) { return mc - mc * pow ( u_sky_color , vec3 ( md / mb ) ) ; } void main ( ) { float mf , mg , mh , mi , mj , mk , ml , mm , mn ; vec3 mo , mp , mq , mr , ms , mt , mu ; mo = normalize ( lF ) ; mp = u_sun_direction ; mf = dot ( mo , mp ) ; mg = lV ( mf , - 0.01 ) * u_rayleigh_brightness * mp . y ; mh = lV ( mf - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - mp . y ) ; mf = smoothstep ( 0.0 , 100.0 , lV ( mf , 0.9995 ) ) * u_spot_brightness ; mq = vec3 ( 0.0 , lG , 0.0 ) ; mi = lO ( mq , mo ) ; mj = mi / float ( lI ) ; mk = ma ( mq , mo , lG - 0.3 ) ; mr = vec3 ( 0.0 , 0.0 , 0.0 ) ; ms = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int mv = 0 ; mv < lI ; mv ++ ) { ml = mj * float ( mv ) ; mt = mq + mo * ml ; mm = ma ( mt , mp , lG - 0.2 ) ; mn = lO ( mt , mp ) ; mu = me ( mn , vec3 ( lH ) , u_scatter_strength ) * mm ; mr += me ( sqrt ( ml ) , u_sky_color * mu , u_rayleigh_strength ) ; ms += me ( ml , mu , u_mie_strength ) ; } mr = mr * mk * pow ( mi , u_rayleigh_collection_power ) / float ( lI ) ; ms = ( ms * mk * pow ( mi , u_mie_collection_power ) ) / float ( lI ) ; ms = vec3 ( mf * ms + mh * ms + mg * mr ) ; fX ( ms ) ; gl_FragColor = vec4 ( ms , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 lF ; void main ( ) { vec4 kq , kr ; kq = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; kr = u_cube_view_matrix * kq ; lF = kr . xyz ; gl_Position = kq ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 kq ; kq = texture2D ( u_sampler , a ) ; fX ( kq . rgb ) ; f_ ( kq . rgb , kq . a ) ; gl_FragColor = kq ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { vec2 kq ; float kr ; vec4 ks ; vec3 kt ; a = a_texcoord ; kt = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; ks = u_proj_matrix * u_view_matrix * vec4 ( kt , 0.0 ) ; ks . x /= ks . w ; ks . y /= ks . w ; ks += 99999.0 * step ( ks . z , 0.0 ) ; ks += 100.0 * ( step ( 1.0 , abs ( ks . x ) ) + step ( 1.0 , abs ( ks . y ) ) ) ; ks . x = - a_lf_dist * ks . x ; ks . y = - a_lf_dist * ks . y ; kr = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; kq = vec2 ( a_lf_bb_vertex . x / kr , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float ku = 1.9 ; kq *= ( 1.0 + ku * length ( ks . xy ) ) ; } gl_Position = vec4 ( ks . xy + kq , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["USE_SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}},{type:"elif",c:["USE_SKY_BLEND"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_zenith_color",";"]}]}}]},{type:"textline",b:["uniform",
"vec3","u_horizon_color",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","lF",";"]},{type:"condition",a:[{type:"if",c:["USE_SKY_BLEND","&&","USE_SKY_PAPER"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},
{type:"textline",b:"void main ( ) { vec4 kq ; float kr , ks ; vec3 kt , ku , kv , kw ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS || ! USE_SKY_PAPER && USE_SKY_BLEND".split(" "),group:{type:"group",a:[{type:"textline",b:"ku = normalize ( lF ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"kt = textureCube ( u_sky , lF ) . rgb ;".split(" ")}]}},{type:"elif",c:["USE_SKY_BLEND"],
group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["USE_SKY_PAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_SKY_REAL"],group:{type:"group",a:[{type:"textline",b:"kr = abs ( a . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kr = ( a . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ks = acos ( ku . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_SKY_REAL"],
group:{type:"group",a:[{type:"textline",b:"kr = abs ( ks * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kr = 1.0 - ks * INV_PI ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kv = u_horizon_color ; kw = u_zenith_color ; fX ( kv ) ; fX ( kw ) ; kt = mix ( kv , kw , kr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kt = u_horizon_color ; fX ( kt ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),
group:{type:"group",a:[{type:"textline",b:"fV ( kt . rgb ) ; ks = u_camera_eye_frag . y - WATER_LEVEL ; ks = min ( - ks * 0.03 , 0.8 ) ; kr = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; kv = vec3 ( 0.0 ) ; kq = u_underwater_fog_color_density ; kq . rgb = mix ( kq . rgb , kv , min ( - ku . y + ks , 1.0 ) ) * kr ; kr = clamp ( sign ( ku . y - 0.05 * ks ) , 0.0 , 1.0 ) ; kt = mix ( kq . rgb , kt , kr ) ; fX ( kt . rgb ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kt , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 lF ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_SKY_BLEND","&&","USE_SKY_PAPER"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 kq , kr ; kq = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; kr = u_sky_vp_inverse * kq ; lF = kr . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_SKY_BLEND",
"&&","USE_SKY_PAPER"],group:{type:"group",a:[{type:"textline",b:"a = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","kq",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",
file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform samplerCube u_sky_texture ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_zenith_color",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",
b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform",
"vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float kq = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:"( NUM_NORMALMAPS > 0 || FOAM ) && ! GENERATED_MESH".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jE ; varying vec3 lG ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"include",file:"environment.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING","&&","USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},
{type:"textline",b:"vec3 lV ( in vec2 lK , in vec3 lL , in vec3 lM , in vec3 lN , out float lO ) { float lP , lQ , lR ; vec2 lS ; vec3 lT , lU ; lT = reflect ( - lM , lL ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"lS = lK . xy + lL . xz * REFL_BUMP / jG ; lO = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"lU = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lU = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"lP = dot ( lM , lL ) ; lO *= max ( 1.0 - 1.0 / lP , 1.0 ) ; } else { lU = texture2D ( u_reflectmap , lS ) . rgb ; fV ( lU ) ; }".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"lO = u_mirror_factor ; lU = lN * textureCube ( u_mirrormap , lT ) . rgb ; fV ( lU ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"lO = u_reflect_factor ; lU = lN * vec3 ( 0.3 , 0.5 , 1.0 ) ; fV ( lU ) ;".split(" ")}]}}]},{type:"textline",b:"lT = normalize ( lT + lM ) ; lP = 1.0 - dot ( lM , lT ) ; lQ = u_fresnel_params [ 3 ] ; lR = u_fresnel_params [ 2 ] ; lQ = lQ + ( 1.0 - lQ ) * pow ( lP , lR ) ; lO = min ( lO * lQ , 1.0 ) ; return lU ; } void main ( ) { vec4 lW ; vec2 lX , lY , lZ ; float l_ , ma , mb , mc , md , me ; vec3 mf , mg , mh , mi , mj , mk , ml ; mat3 mm ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mm = mat3 ( jE , lG , jD ) ;".split(" ")}]}}]},{type:"textline",b:"mf = normalize ( jD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mm = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mf = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"l_ = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0","||","FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"lX = vec2 ( lH . x , - lH . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"lX = vec2 ( jC . x , - jC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["lX","=","a",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mg = vec3 ( 0.0 ) ; mh = texture2D ( u_normalmap0 , lX * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; mg += mh ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"mi = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["mi","+=","mh",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"mh = texture2D ( u_normalmap0 , lX * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; mg += mh ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["mi","+=","mh",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"mh = texture2D ( u_normalmap0 , lX * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; mg += mh ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["mi","+=","mh",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"mh = texture2D ( u_normalmap0 , lX * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; mg += mh ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",
a:[{type:"textline",b:["mi","+=","mh",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"mh = mm * mi ; if ( ! g ( mh , vec3 ( 0.0 ) ) ) mh = normalize ( mh ) ; mi = mix ( mf , mh , 0.2 ) ; mi = normalize ( mi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"mf = mix ( mf , normalize ( mm * mg ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mf = mix ( mf , normalize ( mm * mg ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"mf = normalize ( mf ) ;".split(" ")}]}}]},{type:"textline",b:"mh = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lY = cI . xy / cI . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:"ma = jG * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"mb = u_diffuse_color . a ; lW = texture2DProj ( u_scene_depth , cI ) ; mc = cu ( lW ) ; md = max ( mc - jG , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lZ = lY + mf . xz * u_refr_bump / jG ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",
a:[{type:"textline",b:"me = ke ( mc , lZ , lY ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lZ = lY ; me = mc ;".split(" ")}]}}]},{type:"textline",b:"mc = max ( me - jG , 0.0 ) ; me = u_view_max_depth / ABSORB * mc ; if ( u_cam_water_depth < 0.0 ) mc = 0.0 ; else mc = min ( mb * me , 1.0 ) ; me = u_view_max_depth / ABSORB * md ; mb = min ( 15.0 * mb * u_view_max_depth * md , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"me = u_view_max_depth / ABSORB * md ; if ( u_cam_water_depth > 0.0 ) mb = min ( mb * me , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mb *= min ( 5.0 * ma , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mb = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"mc = 1.0 - mb ; lZ = lY + mf . xz * REFR_BUMP / jG ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"mg = texture2D ( u_refractmap , lZ ) . rgb ; fV ( mg ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"me = pow ( min ( lI . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; mj = mix ( u_shallow_water_col , u_diffuse_color . rgb , me ) ; me = pow ( min ( lI . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; mj = mix ( u_shore_water_col , mj , me ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mj = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"me = max ( 1.0 - u_view_max_depth * md , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"me = 1.0 - mb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"md = max ( l_ / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"mk = normalize ( vec3 ( lI . r , 0.0 , lI . g ) ) ; mk = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , mk , 0.8 ) ) ; l_ = 1.25 * max ( dot ( mi , mk ) - 0.2 , 0.0 ) ; l_ += max ( dot ( mi , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; me += l_ * ( 1.0 - lI . b ) ; md *= ( 1.0 - 0.95 * pow ( lI . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"me += md ; me = min ( u_foam_factor * me , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"lW = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + lX * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"l_ = u_specular_params [ 0 ] ; lZ = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; mk = l_ * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"mi = u_environment_energy * kp ( 0.0 , mf ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mi = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"mi = u_ambient * mi ; mi = mi + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"ml = lV ( lY , mf , mh , mi , md ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ml = lV ( vec2 ( 0.0 ) , mf , mh , mi , md ) ;".split(" ")}]}}]},{type:"textline",b:"mj = u_diffuse_intensity * mj ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO mn = jc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , mj , mk , jC , mf , mh , lZ , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO mn = jh ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , mj ) ;".split(" ")}]}}]},{type:"textline",b:"mj = mn . a . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"l_ = max ( dot ( u_sun_direction , - jD ) + SSS_WIDTH , 0.0 ) * max ( dot ( - mh , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; l_ = clamp ( SSS_STRENGTH * l_ , 0.0 , 1.0 ) ; mj = mix ( mj , u_shallow_water_col , l_ ) ; mj = mix ( mj , u_shore_water_col , l_ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"mj = mix ( mg , mj , mc ) ;".split(" ")}]}}]},
{type:"textline",b:"mj = mix ( mj , ml , md ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"l_ = mix ( lW . g , lW . r , max ( 4.0 * ( me - 0.75 ) , 0.0 ) ) ; l_ = mix ( lW . b , l_ , max ( 2.0 * me - 1.0 , 0.0 ) ) ; l_ = mix ( 0.0 , l_ , me ) ; mj = mix ( mj , mi , l_ ) ;".split(" ")}]}}]},{type:"textline",b:"mj += mn . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"mk = gm ( u_cube_fog , mh ) ; lW = vec4 ( mk , u_fog_color_density . a ) ; fV ( lW . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["lW","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { gK ( mj , ma , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gg ( mj , ma , lW ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( mj , ma , lW ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["fX","(","mj",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"mb = max ( mb , mn . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["mb","+=","l_",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"f_ ( mj , mb ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"mf = fwidth ( lJ ) ; mg = smoothstep ( vec3 ( 0.0 ) , mf * kq , lJ ) ; mc = min ( min ( mg . x , mg . y ) , mg . z ) ; mc = clamp ( mc , 0.0 , 1.0 ) ; mj = mix ( u_wireframe_edge_color , mj , mc ) ; mb = mix ( 1.0 , mb , mc ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( mj , mb ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:"! GENERATED_MESH && ( NUM_NORMALMAPS > 0 || FOAM )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jE ; varying vec3 lG ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3",
"lI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lJ",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 kv ( in vec2 kq ) { float kr ; vec4 ks ; vec2 kt ; kt = 0.5 + vec2 ( ( kq . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( kq . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; ks = texture2D ( u_shore_dist_map , kt ) ; const vec2 ku = vec2 ( 1.0 / 255.0 , 1.0 ) ; kr = dot ( ks . ba , ku ) ; kt = normalize ( ks . rg * 2.0 - 1.0 ) ; return vec3 ( kt , kr ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],
group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void kH ( inout vec3 kw , in float kx , in vec3 ky ) { vec2 kz , kA , kB ; float kC , kD , kE , kF , kG ; kC = dx ( DST_NOISE_SCALE_0 * ( kw . xz + DST_NOISE_FREQ_0 * kx ) ) * dx ( DST_NOISE_SCALE_1 * ( kw . zx - DST_NOISE_FREQ_1 * kx ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"kD = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; kE = ky . b ; kF = sqrt ( kE ) ; kD = max ( kE , DIR_MIN_SHR_FAC ) * sin ( kF / kD + DIR_FREQ * kx ) ; kG = max ( dx ( DIR_NOISE_SCALE * ( kw . xz + DIR_NOISE_FREQ * kx ) ) , DIR_MIN_NOISE_FAC ) ; kD *= kG ; kG = WAVES_HEIGHT * mix ( kD , kC , max ( kF , DST_MIN_FAC ) ) ; kz = ky . rg ; kF = WAVES_HOR_FAC * kD * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - kE ) , 0.0 ) ; kz = kF * kz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kG = WAVES_HEIGHT * kC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"kA = 2.0 * ( kw . xz - 0.1 * kx ) ; kB = 1.3 * ( kw . zx + 0.03 * kx ) ; kD = da ( 0.5 * kA ) . x + da ( 0.5 * kB ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"kw . xz += kz ; kD *= kE ;".split(" ")}]}}]},{type:"textline",b:"kG += SMALL_WAVES_FAC * kD ;".split(" ")}]}}]},
{type:"textline",b:"kw . y += kG ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 kI , lK ; vec2 lL ; float lM , lN , lO ; vec3 lP , lQ , lR , lS ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) lJ = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) lJ = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) lJ = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["lP","=",
"a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"lM = abs ( lP . y ) ; lL = u_camera_eye . xz - mod ( u_camera_eye . xz , lM ) ; lP . y = WATER_LEVEL ; lP . xz += lL ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",">","0","||","FOAM"],group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d lT = av ( lP , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"lH = lT . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lI = kv ( lT . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"lN = length ( u_wind ) ; lO = u_time ; lO *= lN ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",
a:[{type:"textline",b:["lN","=","lM",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["lN","=","0.1",";"]}]}}]},{type:"textline",b:"lP = lT . a + vec3 ( lN , 0.0 , 0.0 ) ; lQ = lT . a + vec3 ( 0.0 , 0.0 , lN ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lR = kv ( lP . xz ) ; lS = kv ( lQ . xz ) ; kH ( lP , lO , lR ) ; kH ( lQ , lO , lS ) ; kH ( lT . a , lO , lI ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"kH ( lP , lO , vec3 ( 0.0 ) ) ; kH ( lQ , lO , vec3 ( 0.0 ) ) ; kH ( lT . a , lO , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { lT . a . y = WATER_LEVEL - 1.0 ; lP . y = lT . a . y ; lQ . y = lT . a . y ; }".split(" ")}]}}]},{type:"textline",b:"lR = normalize ( lP - lT . a ) ; lS = normalize ( lQ - lT . a ) ; jD = normalize ( cross ( lS , lR ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"jE = lS ; lG = cross ( jD , jE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lM = dot ( jD , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; lN = clamp ( 0.8 - lM , 0.0 , 1.0 ) ; jD = mix ( jD , vec3 ( 0.0 , 1.0 , 0.0 ) , lN ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"jC = lT . a ; jB = u_camera_eye - lT . a ; kI = u_view_matrix * vec4 ( lT . a , 1.0 ) ; lK = u_proj_matrix * kI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lO = lK . x ; lM = lK . y ; lN = lK . w ; cI . x = ( lO + lN ) / 2.0 ; cI . y = ( lM + lN ) / 2.0 ; cI . z = lN ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"jG = - kI . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position",
"=","lK",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",
b:"varying vec3 lJ ; const float kq = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 kr = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 kr = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 ks = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 kt = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 ku = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float kv , kw ; vec3 kx , ky ; kx = vec3 ( 0.0 ) ; kv = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"ky = sign ( lJ - vec3 ( 0.02 * kq ) ) ; if ( ky . x < 0.0 || ky . y < 0.0 || ky . z < 0.0 ) { kx = kr ; kv = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"ky = sign ( lJ - vec3 ( 0.02 * kq ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( ky . x < 0.0 || ky . y < 0.0 || ky . z < 0.0 ) kx = u_wireframe_edge_color ; else kx = ku ; kv = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( ky . x < 0.0 || ky . y < 0.0 || ky . z < 0.0 ) kv = 1.0 ; else kv = 0.0 ; kx = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( ky . x < 0.0 || ky . y < 0.0 || ky . z < 0.0 ) kx = u_wireframe_edge_color ; else if ( gl_FrontFacing ) kx = ks ; else kx = kt ; kv = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"ky = fwidth ( lJ ) ; ky = smoothstep ( vec3 ( 0.0 ) , ky * kq , lJ ) ; kw = min ( min ( ky . x , ky . y ) , ky . z ) ; kw = clamp ( kw , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { kx = vec3 ( mix ( u_wireframe_edge_color , ku , kw ) ) ; kv = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { kx = u_wireframe_edge_color ; kv = mix ( 1.0 , 0.0 , kw ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) kx = mix ( u_wireframe_edge_color , ks , kw ) ; else kx = mix ( u_wireframe_edge_color , kt , kw ) ; kv = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["fX","(","kx",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"f_ ( kx , kv ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kx , kv ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["varying","vec3","lJ",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 kq ; mat4 kr ; vec3 ks , kt , ku , kv , kw ; if ( a_polyindex == 0.0 ) lJ = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) lJ = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) lJ = vec3 ( 0.0 , 0.0 , 1.0 ) ; ks = a_position ; kt = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d kx = av ( ks , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ks = mix ( ks , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"ku = vec3 ( 0.0 ) ; kv = vec3 ( 0.0 ) ; bv ( ks , ku , kv , kt ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["ku","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ku = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d kx = fE ( ks , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ku , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"kv = ( u_model_matrix * vec4 ( ku , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"kr = ao ( u_camera_eye , kv , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kr = ai ( u_camera_eye , kv , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"kw = ( u_model_matrix * vec4 ( ku , 1.0 ) ) . xyz ; kr = kr * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kw ) ;".split(" ")}]}}]},{type:"textline",b:"d kx = av ( ks - ku , ku , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , kr ) ; kx . b = kv ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d kx = av ( ks , ku , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( kx . a , kx . b , kt ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kq = u_view_matrix * vec4 ( kx . a , 1.0 ) ; gl_Position = u_proj_matrix * kq ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 kq , kr ; kq = texture2D ( u_sampler_left , a ) ; kr = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( kq [ 0 ] , kr [ 1 ] , kr [ 2 ] , kq [ 3 ] + kr [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 kt ( float kq , float kr ) { vec2 ks ; ks = a + vec2 ( kq , kr ) * u_texel_size ; return texture2D ( u_color , ks ) ; } float kx ( vec4 ku ) { float kv ; vec3 kw ; kw = vec3 ( 0.299 , 0.587 , 0.114 ) ; kv = dot ( ku . rgb , kw ) ; return kv ; } vec4 lL ( ) { vec2 ky ; float kz , kA , kB , kC , kD , kE ; vec4 kF , kG , kH , kI , lK ; kF = kt ( - 1.0 , - 1.0 ) ; kG = kt ( 1.0 , - 1.0 ) ; kH = kt ( - 1.0 , 1.0 ) ; kI = kt ( 1.0 , 1.0 ) ; lK = kt ( 0.0 , 0.0 ) ; kz = kx ( kF ) ; kA = kx ( kG ) ; kB = kx ( kH ) ; kC = kx ( kI ) ; kD = kx ( lK ) ; kE = min ( kD , min ( min ( kz , kA ) , min ( kB , kC ) ) ) ; kD = max ( kD , max ( max ( kz , kA ) , max ( kB , kC ) ) ) ; ky . x = - ( ( kz + kA ) - ( kB + kC ) ) ; ky . y = ( ( kz + kB ) - ( kA + kC ) ) ; kz = max ( ( kz + kA + kB + kC ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; kA = 1.0 / ( min ( abs ( ky . x ) , abs ( ky . y ) ) + kz ) ; ky = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , ky * kA ) ) * u_texel_size ; kF = 0.5 * ( texture2D ( u_color , a + ky * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + ky * ( 2.0 / 3.0 - 0.5 ) ) ) ; kG = kF * 0.5 + 0.25 * ( texture2D ( u_color , a + ky * - 0.5 ) + texture2D ( u_color , a + ky * 0.5 ) ) ; kB = kx ( kG ) ; if ( ( kB < kE ) || ( kB > kD ) ) return kF ; else return kG ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 mp ( ) { bool lM , lN , lO , lP , lQ ; float lR , lS , lT , lU , lV , lW , lX , lY , lZ , l_ , ma , mb , mc , md , me ; vec4 mf , mg , mh , mi , mj ; vec2 mk , ml , mm , mn , mo ; mk . x = a . x ; mk . y = a . y ; mf = texture2D ( u_color , mk ) ; mg = kt ( 0.0 , 1.0 ) ; mh = kt ( 1.0 , 0.0 ) ; mi = kt ( 0.0 , - 1.0 ) ; mj = kt ( - 1.0 , 0.0 ) ; lR = kx ( mg ) ; lS = kx ( mh ) ; lT = kx ( mi ) ; lU = kx ( mj ) ; lV = kx ( mf ) ; lW = max ( lR , lV ) ; lX = min ( lR , lV ) ; lW = max ( lS , lW ) ; lX = min ( lS , lX ) ; lY = max ( lT , lU ) ; lZ = min ( lT , lU ) ; lY = max ( lY , lW ) ; lW = min ( lZ , lX ) ; lZ = lY * FXAA_QUALITY_EDGE_THRESHOLD ; lX = lY - lW ; lY = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , lZ ) ; lM = lX < lY ; if ( lM ) return mf ; mg = kt ( - 1.0 , - 1.0 ) ; mh = kt ( 1.0 , 1.0 ) ; mi = kt ( 1.0 , - 1.0 ) ; mj = kt ( - 1.0 , 1.0 ) ; lW = kx ( mg ) ; lZ = kx ( mh ) ; lY = kx ( mi ) ; l_ = kx ( mj ) ; ma = lT + lR ; mb = lU + lS ; lX = 1.0 / lX ; mc = ma + mb ; ma = ( - 2.0 * lV ) + ma ; mb = ( - 2.0 * lV ) + mb ; md = lY + lZ ; lY = lW + lY ; me = ( - 2.0 * lS ) + md ; lY = ( - 2.0 * lT ) + lY ; lW = lW + l_ ; l_ = l_ + lZ ; lZ = ( abs ( ma ) * 2.0 ) + abs ( me ) ; ma = ( abs ( mb ) * 2.0 ) + abs ( lY ) ; me = ( - 2.0 * lU ) + lW ; mb = ( - 2.0 * lR ) + l_ ; lY = abs ( me ) + lZ ; l_ = abs ( mb ) + ma ; me = lW + md ; lZ = u_texel_size . x ; lM = lY >= l_ ; mb = mc * 2.0 + me ; if ( ! lM ) lT = lU ; if ( ! lM ) lR = lS ; if ( lM ) lZ = u_texel_size . y ; ma = ( mb * ( 1.0 / 12.0 ) ) - lV ; lW = lT - lV ; md = lR - lV ; lY = lT + lV ; l_ = lR + lV ; lN = abs ( lW ) >= abs ( md ) ; mc = max ( abs ( lW ) , abs ( md ) ) ; if ( lN ) lZ = - lZ ; me = clamp ( abs ( ma ) * lX , 0.0 , 1.0 ) ; ml . x = mk . x ; ml . y = mk . y ; mm . x = ( ! lM ) ? 0.0 : u_texel_size . x ; mm . y = ( lM ) ? 0.0 : u_texel_size . y ; if ( ! lM ) ml . x += lZ * 0.5 ; if ( lM ) ml . y += lZ * 0.5 ; mn . x = ml . x - mm . x ; mn . y = ml . y - mm . y ; mo . x = ml . x + mm . x ; mo . y = ml . y + mm . y ; lU = ( ( - 2.0 ) * me ) + 3.0 ; lS = kx ( texture2D ( u_color , mn ) ) ; mb = me * me ; lT = kx ( texture2D ( u_color , mo ) ) ; if ( ! lN ) lY = l_ ; lR = mc * 1.0 / 4.0 ; lW = lV - lY * 0.5 ; md = lU * mb ; lN = lW < 0.0 ; lS -= lY * 0.5 ; lT -= lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 1.5 ; if ( ! lO ) mn . y -= mm . y * 1.5 ; lQ = ( ! lO ) || ( ! lP ) ; if ( ! lP ) mo . x += mm . x * 1.5 ; if ( ! lP ) mo . y += mm . y * 1.5 ; if ( lQ ) { if ( ! lO ) lS = kx ( texture2D ( u_color , mn . xy ) ) ; if ( ! lP ) lT = kx ( texture2D ( u_color , mo . xy ) ) ; if ( ! lO ) lS = lS - lY * 0.5 ; if ( ! lP ) lT = lT - lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 2.0 ; if ( ! lO ) mn . y -= mm . y * 2.0 ; lQ = ( ! lO ) || ( ! lP ) ; if ( ! lP ) mo . x += mm . x * 2.0 ; if ( ! lP ) mo . y += mm . y * 2.0 ; if ( lQ ) { if ( ! lO ) lS = kx ( texture2D ( u_color , mn . xy ) ) ; if ( ! lP ) lT = kx ( texture2D ( u_color , mo . xy ) ) ; if ( ! lO ) lS = lS - lY * 0.5 ; if ( ! lP ) lT = lT - lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 2.0 ; if ( ! lO ) mn . y -= mm . y * 2.0 ; lQ = ( ! lO ) || ( ! lP ) ; if ( ! lP ) mo . x += mm . x * 2.0 ; if ( ! lP ) mo . y += mm . y * 2.0 ; if ( lQ ) { if ( ! lO ) lS = kx ( texture2D ( u_color , mn . xy ) ) ; if ( ! lP ) lT = kx ( texture2D ( u_color , mo . xy ) ) ; if ( ! lO ) lS = lS - lY * 0.5 ; if ( ! lP ) lT = lT - lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 4.0 ; if ( ! lO ) mn . y -= mm . y * 4.0 ; lQ = ( ! lO ) || ( ! lP ) ; if ( ! lP ) mo . x += mm . x * 4.0 ; if ( ! lP ) mo . y += mm . y * 4.0 ; if ( lQ ) { if ( ! lO ) lS = kx ( texture2D ( u_color , mn . xy ) ) ; if ( ! lP ) lT = kx ( texture2D ( u_color , mo . xy ) ) ; if ( ! lO ) lS = lS - lY * 0.5 ; if ( ! lP ) lT = lT - lY * 0.5 ; lO = abs ( lS ) >= lR ; lP = abs ( lT ) >= lR ; if ( ! lO ) mn . x -= mm . x * 2.0 ; if ( ! lO ) mn . y -= mm . y * 2.0 ; if ( ! lP ) mo . x += mm . x * 2.0 ; if ( ! lP ) mo . y += mm . y * 2.0 ; } } } } ma = mk . x - mn . x ; lX = mo . x - mk . x ; if ( ! lM ) ma = mk . y - mn . y ; if ( ! lM ) lX = mo . y - mk . y ; lQ = ( lS < 0.0 ) != lN ; me = ( lX + ma ) ; lO = ( lT < 0.0 ) != lN ; l_ = 1.0 / me ; lP = ma < lX ; mc = min ( ma , lX ) ; lN = lP ? lQ : lO ; lV = md * md ; lU = ( mc * ( - l_ ) ) + 0.5 ; mb = lV * FXAA_QUALITY_SUBPIX ; lW = lN ? lU : 0.0 ; lY = max ( lW , mb ) ; if ( ! lM ) mk . x += lY * lZ ; if ( lM ) mk . y += lY * lZ ; return texture2D ( u_color , mk ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = lL ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = mp ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 kq ; vec2 kr , ks ; kr = vec2 ( 0.0 , 0.0 ) ; ks = u_texel_size ; kq = texture2D ( u_color , a ) ; gl_FragColor = kq * 0.0875447373698 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0858112354248 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0808139781061 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0731235112908 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0635705267419 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0530985673112 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0426125984122 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0328565115809 ; kr += ks ; gl_FragColor += texture2D ( u_color , a + kr ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - kr ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * kq , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 kq , kr ; kq = texture2D ( u_main , a ) ; kr = texture2D ( u_bloom , a ) ; kq = kq ; kq += kr ; gl_FragColor = vec4 ( kq . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { float kq ; vec3 kr , ks ; vec4 kt ; kt = texture2D ( u_color , a ) ; kr = kt . rgb ; if ( u_brightness < 0.0 ) kr = kr * ( 1.0 + u_brightness ) ; else kr = kr + ( ( 1.0 - kr ) * u_brightness ) ; kr = ( kr - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; kr *= u_exposure ; ks = vec3 ( 0.299 , 0.587 , 0.114 ) ; kq = dot ( kr , ks ) ; kr = mix ( vec3 ( kq ) , kr , u_saturation ) ; gl_FragColor = vec4 ( kr , kt . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cq ( clamp ( lQ ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { float lR , lS ; vec4 lT , lU ; lT = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { lR = lQ ( u_depth , a , u_camera_range ) ; lR *= u_view_max_depth ; if ( lR < u_dof_dist ) lS = ( u_dof_dist - lR ) / u_dof_front ; else lS = ( lR - u_dof_dist ) / u_dof_rear ; lS = clamp ( lS , 0.0 , 1.0 ) ; lU = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( lT , lU , lS ) ; } else gl_FragColor = lT ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float kv ( float kq , float kr , float ks ) { vec4 kt ; vec2 ku ; ku = a + vec2 ( kq , kr ) * u_texel_size ; kt = texture2D ( u_sampler , ku ) * ks ; return cu ( kt ) ; } void main ( ) { float kw ; kw = ( kv ( - 1.0 , - 1.0 , - 1.0 ) + kv ( 0.0 , - 1.0 , - 1.0 ) + kv ( 1.0 , - 1.0 , - 1.0 ) + kv ( - 1.0 , 0.0 , - 1.0 ) + kv ( 0.0 , 0.0 , 8.0 ) + kv ( 1.0 , 0.0 , - 1.0 ) + kv ( - 1.0 , 1.0 , - 1.0 ) + kv ( 0.0 , 1.0 , - 1.0 ) + kv ( 1.0 , 1.0 , - 1.0 ) ) ; kw *= 1000.0 ; gl_FragColor = vec4 ( kw , kw , kw , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float lR ; varying vec2 lS ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 lT ; void main ( ) { vec4 lU ; float lV , lW , lX , lY , lZ ; vec2 l_ , ma , mb ; l_ = ( lT . xy - a ) ; lV = length ( l_ ) ; l_ = u_radial_blur_step * l_ / lV ; lW = lV / u_radial_blur_step ; l_ *= min ( lW , STEPS_PER_PASS ) / STEPS_PER_PASS ; lW = max ( lW , STEPS_PER_PASS ) ; ma = a ; lX = 0.0 ; for ( float mc = 0.0 ; mc < STEPS_PER_PASS ; mc += 1.0 ) { if ( mc <= lW ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"lY = lQ ( u_input , ma , u_camera_range ) ; lX += max ( ( 1.0 - pow ( lV , 0.3 ) ) * step ( 0.9 , lY ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lU = texture2D ( u_input , ma ) ; lX += cu ( lU ) ;".split(" ")}]}}]},{type:"textline",b:"} ma += l_ ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"mb = a + lS ; lZ = da ( vec2 ( 2.5 * ( mb . x ) , 2.5 * ( mb . y ) + 1.0 * u_time ) ) . x + 0.75 * da ( vec2 ( 5.0 * ( mb . x ) - 0.66 * u_time , 5.0 * ( mb . y ) + 0.66 * u_time ) ) . x + 0.5 * dx ( vec2 ( 7.5 * ( mb . x ) + 0.33 * u_time , 7.5 * ( mb . y ) - 0.33 * u_time ) ) ; lZ *= clamp ( 1.2 - sqrt ( 0.2 * lV ) , 0.0 , 1.0 ) * lR ; lX = max ( lZ , lX ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cq ( lX / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]={type:"group",
a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float lR ; varying vec2 lS ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 lT ; void main ( ) { float kq , kr ; vec3 ks ; a = a_bb_vertex + 0.5 ; ks = normalize ( u_sun_direction ) ; lT = u_proj_matrix * u_view_matrix * vec4 ( ks , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { lR = 1.0 ; ks = vec3 ( 0.0 , 1.0 , 0.0 ) ; ks = j ( u_camera_quat , ks ) ; ks = normalize ( ks ) ; kq = dot ( ks , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; kr = atan ( ks . x , ks . z ) ; lS = vec2 ( - kr , acos ( kq ) ) ; } else { lR = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"lT . xy = 0.5 * ( lT . xy / lT . w + 1.0 ) ; lT += 99999.0 * step ( lT . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { float kq ; vec3 kr ; vec4 ks ; ks = texture2D ( u_main , a ) ; kr = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; fV ( ks . rgb ) ; kq = cu ( texture2D ( u_god_rays , a ) ) ; kr = ks . rgb + u_god_rays_intensity * vec3 ( kq ) * kr ; fX ( kr ) ; gl_FragColor . rgb = kr ; gl_FragColor . a = ks . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 kq ; kq = texture2D ( u_color , a ) * 0.38026 ; kq += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; kq += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; kq += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; kq += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; kq += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; kq += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; kq += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; kq += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = kq ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { float kq ; vec4 kr ; kr = texture2D ( u_input , a ) ; kq = dot ( kr . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( kq ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float kq , kr ; kr = 0.0 ; for ( float ks = 0.025 ; ks < 1.0 ; ks += 0.05 ) for ( float kt = 0.025 ; kt < 1.0 ; kt += 0.05 ) { kq = max ( texture2D ( u_input , vec2 ( ks , kt ) ) . r , 0.01 ) ; kr += log ( kq ) ; } kr = exp ( kr / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( kr ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float lU ; void main ( ) { vec4 lV ; float lW , lX ; lW = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; lX = texture2D ( u_luminance , a ) . r ; lV = texture2D ( u_main , a ) ; lX = lX / lW ; lW = u_bloom_edge_lum ; gl_FragColor = lV * max ( lX - lW , 0.0 ) * lU ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float lU ; const vec3 kq = vec3 ( 0.0 , 1.0 , 0.0 ) ; void ky ( in vec4 kr , in vec3 ks , out vec3 kt ) { float ku , kv , kw , kx ; ku = kr . w * ks . x + kr . y * ks . z - kr . z * ks . y ; kv = kr . w * ks . y + kr . z * ks . x - kr . x * ks . z ; kw = kr . w * ks . z + kr . x * ks . y - kr . y * ks . x ; kx = - kr . x * ks . x - kr . y * ks . y - kr . z * ks . z ; kt . x = ku * kr . w - kx * kr . x - kv * kr . z + kw * kr . y ; kt . y = kv * kr . w - kx * kr . y - kw * kr . x + ku * kr . z ; kt . z = kw * kr . w - kx * kr . z - ku * kr . y + kv * kr . x ; } void main ( ) { vec3 kz ; a = 2.0 * a_position ; ky ( u_camera_quat , kq , kz ) ; lU = dot ( - kz , u_sun_direction ) * u_bloom_key ; lU *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 kq , kr ; kq = texture2D ( u_mb_tex_curr , a ) ; kr = texture2D ( u_mb_tex_accum , a ) ; if ( length ( kq - kr ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * kq + u_motion_blur_exp * kr ; } else { gl_FragColor = kq ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 a ; void main ( ) { vec3 kq ; float kr ; vec4 ks , kt , ku ; ks = texture2D ( u_outline_src , a ) ; gl_FragColor = ks ; if ( u_draw_outline != 0.0 ) { kt = texture2D ( u_outline_mask , a ) ; ku = texture2D ( u_outline_mask_blurred , a ) ; kr = ku . a - kt . a ; if ( kr != 0.0 ) { kr = smoothstep ( 0.0 , 1.0 , ku . a ) ; if ( kt . a == 0.0 ) { kq = u_outline_color ; fX ( kq ) ; ku = vec4 ( clamp ( kq , 0.0 , 1.0 ) , kr ) ; gl_FragColor = mix ( ks , ku , kr ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 kq , kr ; vec4 ks ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( ks . r + ks . g + ks . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"kq = vec2 ( 0.0 , 0.0 ) ; kr = u_texel_size ; ks = texture2D ( u_color , a ) ; gl_FragColor = ks * 0.2270270270 ; kq += kr ; ks = texture2D ( u_color , a + kq ) ; gl_FragColor += ks * 0.1945945946 ; ks = texture2D ( u_color , a - kq ) ; gl_FragColor += ks * 0.1945945946 ; kq += kr ; ks = texture2D ( u_color , a + kq ) ; gl_FragColor += ks * 0.1216216216 ; ks = texture2D ( u_color , a - kq ) ; gl_FragColor += ks * 0.1216216216 ; kq += kr ; ks = texture2D ( u_color , a + kq ) ; gl_FragColor += ks * 0.0540540541 ; ks = texture2D ( u_color , a - kq ) ; gl_FragColor += ks * 0.0540540541 ; kq += kr ; ks = texture2D ( u_color , a + kq ) ; gl_FragColor += ks * 0.0162162162 ; ks = texture2D ( u_color , a - kq ) ; gl_FragColor += ks * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"kr = u_texel_size ; ks = texture2D ( u_color , a ) ; gl_FragColor = ks ; if ( ks . a == 0.0 ) { ks = texture2D ( u_color , a + kr ) ; if ( ks . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , ks . a ) ; else { ks = texture2D ( u_color , a - kr ) ; if ( ks . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , ks . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 a ; void main ( ) { a = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","lV",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 lW ; varying vec4 lX ; varying vec4 lY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","lZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 me ( vec2 l_ , sampler2D ma ) { float mb , mc , md ; mb = texture2D ( ma , l_ ) . r ; mc = texture2D ( ma , lW . xy ) . r ; md = texture2D ( ma , lW . zw ) . r ; return vec3 ( mb , mc , md ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mj ( vec2 mf , sampler2D mg ) { vec2 mh ; vec3 mi ; mi = me ( mf , mg ) ; mh = abs ( mi . xx - mi . yz ) ; mh = step ( SMAA_PREDICATION_THRESHOLD , mh ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * mh ) ; }".split(" ")}]}}]},{type:"textline",b:"void mn ( bvec2 mk , inout vec2 ml , vec2 mm ) { if ( mk . x ) ml . x = mm . x ; if ( mk . y ) ml . y = mm . y ; } void mn ( bvec4 mo , inout vec4 mp , vec4 mq ) { mn ( mo . xy , mp . xy , mq . xy ) ; mn ( mo . zw , mp . zw , mq . zw ) ; } vec2 ms ( vec2 mr ) { return sign ( mr ) * floor ( abs ( mr ) + .5 ) ; } vec4 ms ( vec4 mt ) { return sign ( mt ) * floor ( abs ( mt ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mG ( vec2 mu , sampler2D mv".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","mw"]}]}}]},{type:"textline",b:") { vec4 mx ; float my , mz , mA , mB , mC ; vec3 mD ; vec2 mE , mF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"mE = mj ( mu , mw ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mE = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"mD = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; my = dot ( texture2D ( mv , mu ) . rgb , mD ) ; mz = dot ( texture2D ( mv , lW . xy ) . rgb , mD ) ; mA = dot ( texture2D ( mv , lW . zw ) . rgb , mD ) ; mx . xy = abs ( my - vec2 ( mz , mA ) ) ; mE = step ( mE , mx . xy ) ; if ( dot ( mE , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; mB = dot ( texture2D ( mv , lX . xy ) . rgb , mD ) ; mC = dot ( texture2D ( mv , lX . zw ) . rgb , mD ) ; mx . zw = abs ( my - vec2 ( mB , mC ) ) ; mF = max ( mx . xy , mx . zw ) ; my = dot ( texture2D ( mv , lY . xy ) . rgb , mD ) ; mB = dot ( texture2D ( mv , lY . zw ) . rgb , mD ) ; mx . zw = abs ( vec2 ( mz , mA ) - vec2 ( my , mB ) ) ; mF = max ( mF . xy , mx . zw ) ; mC = max ( mF . x , mF . y ) ; mE . xy *= step ( mC , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * mx . xy ) ; return mE ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mI ( vec2 mH ) { mH . r = mH . r * abs ( 5.0 * mH . r - 5.0 * 0.75 ) ; return ms ( mH ) ; } vec4 mI ( vec4 mJ ) { mJ . rb = mJ . rb * abs ( 5.0 * mJ . rb - 5.0 * 0.75 ) ; return ms ( mJ ) ; } vec2 mR ( sampler2D mK , vec2 mL , vec2 mM , out vec2 mN ) { vec3 mO ; vec4 mP ; mP = vec4 ( mL , - 1.0 , 1.0 ) ; mO = vec3 ( u_texel_size , 1.0 ) ; for ( int mQ = 0 ; mQ < SMAA_MAX_SEARCH_STEPS_DIAG ; mQ ++ ) { if ( mP . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && mP . w > 0.9 ) { mP . xyz += mO * vec3 ( mM , 1.0 ) ; mN = texture2D ( mK , mP . xy , 0.0 ) . rg ; mP . w = dot ( mN , vec2 ( 0.5 , 0.5 ) ) ; } } return mP . zw ; } vec2 mZ ( sampler2D mS , vec2 mT , vec2 mU , out vec2 mV ) { vec3 mW ; vec4 mX ; mX = vec4 ( mT , - 1.0 , 1.0 ) ; mX . x += 0.25 * u_texel_size . x ; mW = vec3 ( u_texel_size , 1.0 ) ; for ( int mY = 0 ; mY < SMAA_MAX_SEARCH_STEPS_DIAG ; mY ++ ) { if ( mX . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && mX . w > 0.9 ) { mX . xyz = mW * vec3 ( mU , 1.0 ) + mX . xyz ; mV = texture2D ( mS , mX . xy , 0.0 ) . rg ; mV = mI ( mV ) ; mX . w = dot ( mV , vec2 ( 0.5 , 0.5 ) ) ; } } return mX . zw ; } vec2 ne ( sampler2D m_ , vec2 na , vec2 nb , float nc ) { vec2 nd ; nd = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * nb + na ; nd = SMAA_AREATEX_PIXEL_SIZE * nd + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; nd . x += 0.5 ; nd . y += SMAA_AREATEX_SUBTEX_SIZE * nc ; return texture2D ( m_ , nd , 0.0 ) . rg ; } vec2 nq ( sampler2D nf , sampler2D ng , vec2 nh , vec2 ni , vec4 nj ) { vec4 nk , nl , nm ; vec2 nn , no , np ; nn = vec2 ( 0.0 , 0.0 ) ; if ( ni . r > 0.0 ) { nk . xz = mR ( nf , nh , vec2 ( - 1.0 , 1.0 ) , no ) ; nk . x += float ( no . y > 0.9 ) ; } else nk . xz = vec2 ( 0.0 , 0.0 ) ; nk . yw = mR ( nf , nh , vec2 ( 1.0 , - 1.0 ) , no ) ; if ( nk . x + nk . y > 2.0 ) { nl = vec4 ( - nk . x + 0.25 , nk . x , nk . y , - nk . y - 0.25 ) * u_texel_size . xyxy + nh . xyxy ; nm . xy = texture2D ( nf , nl . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; nm . zw = texture2D ( nf , nl . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; nm . yxwz = mI ( nm . xyzw ) ; np = vec2 ( 2.0 , 2.0 ) * nm . xz + nm . yw ; mn ( bvec2 ( step ( 0.9 , nk . zw ) ) , np , vec2 ( 0.0 , 0.0 ) ) ; nn += ne ( ng , nk . xy , np , nj . z ) ; } nk . xz = mZ ( nf , nh , vec2 ( - 1 , - 1 ) , no ) ; if ( texture2D ( nf , nh + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { nk . yw = mZ ( nf , nh , vec2 ( 1 , 1 ) , no ) ; nk . y += float ( no . y > 0.9 ) ; } else nk . yw = vec2 ( 0.0 , 0.0 ) ; if ( nk . x + nk . y > 2.0 ) { nl = vec4 ( - nk . x , - nk . x , nk . y , nk . y ) * u_texel_size . xyxy + nh . xyxy ; nm . x = texture2D ( nf , nl . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; nm . y = texture2D ( nf , nl . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; nm . zw = texture2D ( nf , nl . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; np = vec2 ( 2.0 , 2.0 ) * nm . xz + nm . yw ; mn ( bvec2 ( step ( 0.9 , nk . zw ) ) , np , vec2 ( 0 , 0 ) ) ; nn += ne ( ng , nk . xy , np , nj . w ) . gr ; } return nn ; }".split(" ")}]}}]},
{type:"textline",b:"float nw ( sampler2D nr , vec2 ns , float nt ) { vec2 nu , nv ; nu = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; nv = SMAA_SEARCHTEX_SIZE * vec2 ( nt , 1.0 ) ; nu += vec2 ( - 1.0 , 1.0 ) ; nv += vec2 ( 0.5 , - 0.5 ) ; nu *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; nv *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( nr , nu * ns + nv , 0.0 ) . r ; } float nE ( sampler2D nx , sampler2D ny , vec2 nz , float nA ) { float nB ; vec2 nC ; nC = vec2 ( 0.0 , 1.0 ) ; for ( int nD = 0 ; nD < SMAA_MAX_SEARCH_STEPS ; nD ++ ) { if ( nz . x > nA && nC . g > 0.8281 && nC . r == 0.0 ) { nC = texture2D ( nx , nz , 0.0 ) . rg ; nz = - vec2 ( 2.0 , 0.0 ) * u_texel_size + nz ; } } nB = - ( 255.0 / 127.0 ) * nw ( ny , nC , 0.0 ) + 3.25 ; return u_texel_size . x * nB + nz . x ; } float nM ( sampler2D nF , sampler2D nG , vec2 nH , float nI ) { float nJ ; vec2 nK ; nK = vec2 ( 0.0 , 1.0 ) ; for ( int nL = 0 ; nL < SMAA_MAX_SEARCH_STEPS ; nL ++ ) { if ( nH . x < nI && nK . g > 0.8281 && nK . r == 0.0 ) { nK = texture2D ( nF , nH , 0.0 ) . rg ; nH = vec2 ( 2.0 , 0.0 ) * u_texel_size + nH ; } } nJ = - ( 255.0 / 127.0 ) * nw ( nG , nK , 0.5 ) + 3.25 ; return - u_texel_size . x * nJ + nH . x ; } float nU ( sampler2D nN , sampler2D nO , vec2 nP , float nQ ) { float nR ; vec2 nS ; nS = vec2 ( 1.0 , 0.0 ) ; for ( int nT = 0 ; nT < SMAA_MAX_SEARCH_STEPS ; nT ++ ) { if ( nP . y > nQ && nS . r > 0.8281 && nS . g == 0.0 ) { nS = texture2D ( nN , nP , 0.0 ) . rg ; nP = - vec2 ( 0.0 , 2.0 ) * u_texel_size + nP ; } } nR = - ( 255.0 / 127.0 ) * nw ( nO , nS . gr , 0.0 ) + 3.25 ; return u_texel_size . y * nR + nP . y ; } float ob ( sampler2D nV , sampler2D nW , vec2 nX , float nY ) { float nZ ; vec2 n_ ; n_ = vec2 ( 1.0 , 0.0 ) ; for ( int oa = 0 ; oa < SMAA_MAX_SEARCH_STEPS ; oa ++ ) { if ( nX . y < nY && n_ . r > 0.8281 && n_ . g == 0.0 ) { n_ = texture2D ( nV , nX , 0.0 ) . rg ; nX = vec2 ( 0.0 , 2.0 ) * u_texel_size + nX ; } } nZ = - ( 255.0 / 127.0 ) * nw ( nW , n_ . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * nZ + nX . y ; } vec2 oi ( sampler2D oc , vec2 od , float oe , float of , float og ) { vec2 oh ; oh = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * ms ( 4.0 * vec2 ( oe , of ) ) + od ; oh = SMAA_AREATEX_PIXEL_SIZE * oh + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; oh . y = SMAA_AREATEX_SUBTEX_SIZE * og + oh . y ; return texture2D ( oc , oh , 0.0 ) . rg ; } void op ( sampler2D oj , inout vec2 ok , vec4 ol , vec2 om ) { vec2 on , oo ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"on = step ( om . xy , om . yx ) ; oo = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * on ; oo /= on . x + on . y ; on = vec2 ( 1.0 , 1.0 ) ; on . x -= oo . x * texture2D ( oj , ol . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; on . x -= oo . y * texture2D ( oj , ol . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; on . y -= oo . x * texture2D ( oj , ol . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; on . y -= oo . y * texture2D ( oj , ol . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; ok *= clamp ( on , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void ow ( sampler2D oq , inout vec2 or , vec4 os , vec2 ot ) { vec2 ou , ov ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"ou = step ( ot . xy , ot . yx ) ; ov = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * ou ; ov /= ou . x + ou . y ; ou = vec2 ( 1.0 , 1.0 ) ; ou . x -= ov . x * texture2D ( oq , os . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; ou . x -= ov . y * texture2D ( oq , os . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; ou . y -= ov . x * texture2D ( oq , os . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; ou . y -= ov . y * texture2D ( oq , os . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; or *= clamp ( ou , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 oK ( vec2 ox , vec2 oy , sampler2D oz , sampler2D oA , sampler2D oB , vec4 oC ) { float oD , oE ; vec3 oF ; vec2 oG , oH , oI ; vec4 oJ ; oJ = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; oG = texture2D ( oz , ox ) . rg ; if ( oG . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",
b:"oJ . rg = nq ( oz , oA , ox , oG , oC ) ; if ( oJ . r == - oJ . g ) {".split(" ")}]}}]},{type:"textline",b:"; oF . x = nE ( oz , oB , lW . xy , lY . x ) ; oF . y = lX . y ; oH . x = oF . x ; oD = texture2D ( oz , oF . xy , 0.0 ) . r ; oF . z = nM ( oz , oB , lW . zw , lY . y ) ; oH . y = oF . z ; oH = abs ( ms ( oH / u_texel_size . xx - oy . xx ) ) ; oI = sqrt ( oH ) ; oE = texture2D ( oz , oF . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; oJ . rg = oi ( oA , oI , oD , oE , oC . y ) ; oF . y = ox . y ; op ( oz , oJ . rg , oF . xyzy , oH ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else oG . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( oG . r > 0.0 ) { ; oF . y = nU ( oz , oB , lX . xy , lY . z ) ; oF . x = lW . x ; oI . x = oF . y ; oD = texture2D ( oz , oF . xy , 0.0 ) . g ; oF . z = ob ( oz , oB , lX . zw , lY . w ) ; oI . y = oF . z ; oI = abs ( ms ( oI / u_texel_size . yy - oy . yy ) ) ; oH = sqrt ( oI ) ; oE = texture2D ( oz , oF . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; oJ . ba = oi ( oA , oH , oD , oE , oC . x ) ; oF . x = ox . x ; ow ( oz , oJ . ba , oF . xyxz , oI ) ; } return oJ ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 oW ( vec2 oL , sampler2D oM , sampler2D oN".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","oO"]}]}}]},{type:"textline",b:") { bool oP ; vec2 oQ , oR , oS ; vec4 oT , oU , oV ; oT . x = texture2D ( oN , lV . xy ) . a ; oT . y = texture2D ( oN , lV . zw ) . g ; oT . wz = texture2D ( oN , oL ) . xz ; if ( dot ( oT , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { oU = texture2D ( oM , oL , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"oV = texture2D ( oO , a ) ; oQ = 2.0 * cC ( oV ) - 1.0 ; oU . a = sqrt ( 2.0 * length ( oQ ) ) ;".split(" ")}]}}]},{type:"textline",b:"return oU ; } else { oP = max ( oT . x , oT . z ) > max ( oT . y , oT . w ) ; oV = vec4 ( 0.0 , oT . y , 0.0 , oT . w ) ; oQ = oT . yw ; mn ( bvec4 ( oP , oP , oP , oP ) , oV , vec4 ( oT . x , 0.0 , oT . z , 0.0 ) ) ; mn ( bvec2 ( oP , oP ) , oQ , oT . xz ) ; oQ /= dot ( oQ , vec2 ( 1.0 , 1.0 ) ) ; oU = oV * vec4 ( u_texel_size , - u_texel_size ) + oL . xyxy ; oT = oQ . x * texture2D ( oM , oU . xy , 0.0 ) ; oT += oQ . y * texture2D ( oM , oU . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"oV = texture2D ( oO , oU . xy ) ; oR = 2.0 * cC ( oV ) - 1.0 ; oS = oQ . x * oR ; oV = texture2D ( oO , oU . zw ) ; oR = 2.0 * cC ( oV ) - 1.0 ; oS += oQ . y * oR ; oT . a = sqrt ( 2.0 * length ( oS ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","oT",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 pf ( vec2 oX , sampler2D oY , sampler2D oZ".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","o_"]}]}}]},{type:"textline",b:") { float pa ; vec2 pb ; vec4 pc , pd , pe ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"pc = texture2D ( o_ , a ) ; pb = 2.0 * cC ( pc ) - 1.0 ; pc = texture2D ( oY , oX ) ; pd = texture2D ( oZ , oX - pb ) ; pa = abs ( pc . a * pc . a - pd . a * pd . a ) / 2.0 ; pa = 0.5 * clamp ( 1.0 - sqrt ( pa ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; pe = mix ( pc , pd , pa ) ; pe . a = 1.0 ; return pe ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"pc = texture2D ( oY , oX ) ; pd = texture2D ( oZ , oX ) ; return mix ( pc , pd , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 pg ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"pg = vec4 ( mG ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"pg = oK ( a , lZ , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"pg = oW ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"pg = vec4 ( pf ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"pg = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","pg",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","lV",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 lW ; varying vec4 lX ; varying vec4 lY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","lZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void kr ( vec2 kq ) { lW = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + kq . xyxy ; lX = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kq . xyxy ; lY = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + kq . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void ku ( vec2 ks , out vec2 kt ) { kt = ks / u_texel_size ; lW = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + ks . xyxy ; lX = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + ks . xyxy ; lY = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( lW . xz , lX . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void kw ( vec2 kv ) { lV = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kv . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["kr","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"ku ( a , lZ ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["kw","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},
{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float ma ( in vec2 l_ ) { return lQ ( u_depth , l_ , u_camera_range ) ; } void main ( ) { vec3 mb , mc , md ; float me , mf , mg , mh , mi , mj , mk ; me = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( me , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"mb = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; mf = ma ( a ) ; mg = mf * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float ml = 8.0 ; const int mm = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float ml = 16.0 ; const int mm = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float ml = 24.0 ; const int mm = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float ml = 32.0 ; const int mm = 4 ;".split(" ")}]}}]},{type:"textline",b:"mh = u_ssao_radius_increase * 0.001 ; const float mn = 1.0 + 2.4 / ml ; mi = 0.0 ; for ( int mo = 0 ; mo < mm ; mo ++ ) for ( int mp = - 1 ; mp <= 1 ; mp += 2 ) for ( int mq = - 1 ; mq <= 1 ; mq += 2 ) for ( int mr = - 1 ; mr <= 1 ; mr += 2 ) { mc = reflect ( normalize ( vec3 ( mp , mq , mr ) ) , mb ) * ( mh *= mn ) ; md = vec3 ( a , mg ) ; md += vec3 ( mc . xy , mc . z * mg * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"md . z -= 1.4 * ( md . z - mg ) * step ( mg , md . z ) ;".split(" ")}]}}]},{type:"textline",b:"mj = ma ( md . xy ) * ( u_camera_range . y - u_camera_range . x ) ; mk = clamp ( ( mg - mj ) / mj , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"mi += mix ( 1.0 , mk , step ( mj , md . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"mi += mix ( step ( md . z , mj ) , 0.5 , mk ) ;".split(" ")}]}}]},{type:"textline",b:"} mi = mi / ml ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"mi = clamp ( mi * mi + 0.6 * mi , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mi = clamp ( mi * mi + mi , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"mf = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * mf ) ; mi = mix ( 1.0 , mi , mf ) ; gl_FragColor = vec4 ( me , mi , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float ma ( in vec2 l_ ) { return lQ ( u_depth , l_ , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec2 mb , mc ; float md , me , mf , mg , mh , mi , mj ; md = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"me = ma ( a ) ; mf = 0.0 ; mg = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"mb = vec2 ( - 2.0 ) ; for ( int mk = 0 ; mk < 4 ; ++ mk ) { for ( int ml = 0 ; ml < 4 ; ++ ml ) { mc = ( mb + vec2 ( float ( mk ) , float ( ml ) ) ) * u_texel_size ; mh = texture2D ( u_ssao_mask , a + mc ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mi = ma ( a + mc ) ; mj = 1.0 - clamp ( abs ( mi - me ) * mg , 0.0 , 1.0 ) ; md += mh * mj ; mf += mj ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["md","+=","mh",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , md / mf , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , md / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { vec2 kq ; vec4 kr , ks ; float kt ; kt = texture2D ( u_depth , a ) . x ; kr = vec4 ( a * 2.0 - 1.0 , 2.0 * kt - 1.0 , 1.0 ) ; ks = u_view_proj_inverse * kr ; ks = ks / ks . w ; ks = u_view_proj_prev * ks ; ks /= ks . w ; kq = ( kr . xy - ks . xy ) / 4.0 + 0.5 ; kq = clamp ( kq , 0.0 , 1.0 ) ; gl_FragColor = cq ( kq ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } vec4 l ( in vec4 k ) { return vec4 ( - k . xyz , k . w ) / dot ( k , k ) ; } vec3 q ( vec4 m , vec4 n , vec4 o ) { vec3 p ; p = o . xyz * m . w ; p = j ( n , p ) ; p += m . xyz * o . w ; return p ; } vec3 w ( vec4 r , vec4 s , vec4 t ) { vec4 u ; vec3 v ; v = t . xyz - r . xyz * t . w ; u = l ( s ) ; v = j ( u , v ) ; v /= r . w ; return v ; } mat4 x ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 z ( float y ) { return mat4 ( c , b , b , b , b , cos ( y ) , sin ( y ) , b , b , - sin ( y ) , cos ( y ) , b , b , b , b , c ) ; } mat4 B ( float A ) { return mat4 ( cos ( A ) , b , - sin ( A ) , b , b , c , b , b , sin ( A ) , b , cos ( A ) , b , b , b , b , c ) ; } mat4 D ( float C ) { return mat4 ( cos ( C ) , sin ( C ) , b , b , - sin ( C ) , cos ( C ) , b , b , b , b , c , b , b , b , b , c ) ; } d F ( in d E ) { return d ( E . a , E . b , normalize ( E . c ) , normalize ( E . d ) , normalize ( E . e ) , E . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 G = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 N ( vec3 H , mat4 I ) { vec3 J , L , M ; J = vec3 ( I [ 0 ] [ 0 ] , I [ 1 ] [ 0 ] , I [ 2 ] [ 0 ] ) ; L = vec3 ( I [ 0 ] [ 1 ] , I [ 1 ] [ 1 ] , I [ 2 ] [ 1 ] ) ; M = vec3 ( I [ 0 ] [ 2 ] , I [ 1 ] [ 2 ] , I [ 2 ] [ 2 ] ) ; L = cross ( M , J ) ; return mat4 ( vec4 ( J , 0.0 ) , vec4 ( L , 0.0 ) , vec4 ( M , 0.0 ) , vec4 ( H , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 T ( vec3 O , vec3 P ) { vec3 Q , R , S ; Q = O - P ; Q . y = 0.0 ; Q = normalize ( Q ) ; R = normalize ( cross ( G , Q ) ) ; S = normalize ( cross ( Q , R ) ) ; return mat4 ( vec4 ( R , 0.0 ) , vec4 ( S , 0.0 ) , vec4 ( Q , 0.0 ) , vec4 ( P , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 aa ( in vec3 U , float V , float W , float X , vec3 Y ) { float Z , _ ; Z = fract ( length ( Y ) / 0.17 ) ; _ = X + Z / 10.0 ; Z = Z ; if ( X != 0.0 ) Z /= X ; U *= 1.0 + 0.5 * sin ( V ) ; _ = length ( U ) * W * sin ( 2.0 * 3.14 * V * _ + Z ) ; return D ( _ ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ai ( in vec3 ab , in vec3 ac , in mat4 ad ) { vec3 ae ; float af , ag ; mat4 ah ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"ah = N ( ac , ad ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"af = fract ( ( ac . x * 1.43 + ac . y * 0.123 + ac . z * 6.1 ) ) ; af = 2.0 * M_PI * af ; ae = normalize ( vec3 ( ad [ 0 ] [ 2 ] , 0.0 , ad [ 2 ] [ 2 ] ) ) ; ag = acos ( ae [ 2 ] ) ; if ( ae [ 0 ] < 0.0 ) ag = 2.0 * M_PI - ag ; ag = ag - af ; if ( ag < 0.0 ) ag = 2.0 * M_PI + ag ; af = af ; if ( ag <= MAX_BILLBOARD_ANGLE ) af += ag ; else if ( ag <= M_PI - MAX_BILLBOARD_ANGLE ) af += MAX_BILLBOARD_ANGLE * ( 2.0 * ag - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( ag <= M_PI + MAX_BILLBOARD_ANGLE ) af += ag - M_PI ; else if ( ag <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) af += MAX_BILLBOARD_ANGLE * ( 2.0 * ag - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else af += ag - 2.0 * M_PI ; ah = B ( af ) ; ah [ 3 ] = vec4 ( ac , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ah = T ( ab , ac ) ;".split(" ")}]}}]},{type:"textline",b:["return","ah",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ao ( in vec3 aj , in vec3 ak , in mat4 al , mat4 am ) { mat4 an ; an = ai ( aj , ak , al ) ; am [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; an = an * am ; return an ; }".split(" ")}]}}]},{type:"textline",b:"d av ( in vec3 ap , in vec3 aq , in vec3 ar , in vec3 as , in vec3 at , in mat4 au ) { ap = ( au * vec4 ( ap , 1.0 ) ) . xyz ; aq = ( au * vec4 ( aq , 1.0 ) ) . xyz ; ar = ( au * vec4 ( ar , 0.0 ) ) . xyz ; as = ( au * vec4 ( as , 0.0 ) ) . xyz ; at = ( au * vec4 ( at , 0.0 ) ) . xyz ; return F ( d ( ap , aq , ar , as , at , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 ay ( vec2 aw , vec3 ax ) { return ( aw + 0.5 ) * ax . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aF ( in vec4 az , in vec4 aA , in float aB ) { float aC , aD , aE ; aC = az [ 0 ] * aA [ 0 ] + az [ 1 ] * aA [ 1 ] + az [ 2 ] * aA [ 2 ] + az [ 3 ] * aA [ 3 ] ; if ( aC < 0.0 ) { aA *= - 1.0 ; aC = - aC ; } if ( abs ( aC ) >= 1.0 ) return az ; aD = acos ( aC ) ; aC = sqrt ( 1.0 - aC * aC ) ; if ( abs ( aC ) < 0.001 ) return vec4 ( az * 0.5 + aA * 0.5 ) ; aE = sin ( ( 1.0 - aB ) * aD ) / aC ; aD = sin ( aB * aD ) / aC ; return az * aE + aA * aD ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aR ( in vec3 aG , in vec4 aH , in vec4 aI , in vec4 aJ , in vec4 aK , in float aL ) { vec3 aM , aN , aO ; vec4 aP , aQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"aP = aF ( aH , aI , aL ) ; aQ = mix ( aJ , aK , aL ) ; aM = j ( aP , aG ) ; aM = aM * aQ . w + aQ . xyz ; return aM ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"aN = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aG , 1.0 ) ) ; aO = j ( aH , aN ) ; aN = j ( aI , aN ) ; aO = aO * aJ . w + aJ . xyz ; aN = aN * aK . w + aK . xyz ; aM = mix ( aO , aN , aL ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aM , 1.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} vec3 a_ ( in vec3 aS , in vec4 aT , in vec4 aU , in float aV ) { vec4 aW ; vec3 aX , aY , aZ ; aX = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aS , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"aW = aF ( aT , aU , aV ) ; aY = j ( aW , aX ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aY , 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aZ = j ( aT , aX ) ; aX = j ( aU , aX ) ; aY = mix ( aZ , aX , aV ) ; return q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aY , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aR ( in vec3 ba , in vec4 bb , in vec4 bc ) { vec3 bd ; bd = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( ba , 1.0 ) ) ; bd = j ( bb , bd ) ; bd = bd * bc . w + bc . xyz ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( bd , 1.0 ) ) ; } vec3 a_ ( in vec3 be , in vec4 bf ) { vec3 bg ; bg = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( be , 0.0 ) ) ; bg = j ( bf , bg ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( bg , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void bv ( inout vec3 bh , inout vec3 bi , inout vec3 bj , inout vec3 bk ) { int bl , bm ; vec4 bn ; vec3 bo , bp , bq , br ; float bs , bt ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["bs","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { bo = vec3 ( 0.0 , 0.0 , 0.0 ) ; bp = vec3 ( 0.0 , 0.0 , 0.0 ) ; bq = vec3 ( 0.0 , 0.0 , 0.0 ) ; br = vec3 ( 0.0 , 0.0 , 0.0 ) ; bn = a_influence ; for ( int bu = 0 ; bu < 4 ; bu ++ ) { bl = int ( bn [ bu ] ) ; bt = fract ( bn [ bu ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bo += bt * aR ( bh , u_quatsb [ bl ] , u_quatsa [ bl ] , u_transb [ bl ] , u_transa [ bl ] , bs ) ; bp += bt * a_ ( bi , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ; bq += bt * a_ ( bj , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ; br += bt * a_ ( bk , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bo += bt * aR ( bh , u_quatsb [ bl ] , u_transb [ bl ] ) ; bp += bt * a_ ( bi , u_quatsb [ bl ] ) ; bq += bt * a_ ( bj , u_quatsb [ bl ] ) ; br += bt * a_ ( bk , u_quatsb [ bl ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bh = bo ; bi = bp ; bj = bq ; bk = br ; } if ( ! ( a_influence . y > 0.0 ) ) { bm = int ( a_influence [ 0 ] - 1.0 ) ; if ( bm > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bh = aR ( bh , u_quatsb [ bm ] , u_quatsa [ bm ] , u_transb [ bm ] , u_transa [ bm ] , bs ) ; bi = a_ ( bi , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ; bj = a_ ( bj , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ; bk = a_ ( bk , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bh = aR ( bh , u_quatsb [ bm ] , u_transb [ bm ] ) ; bi = a_ ( bi , u_quatsb [ bm ] ) ; bj = a_ ( bj , u_quatsb [ bm ] ) ; bk = a_ ( bk , u_quatsb [ bm ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bG ( inout vec3 bw , in vec3 bx , in float by , in float bz , in float bA , in vec3 bB , in float bC ) { vec3 bD ; float bE , bF ; bE = length ( bx ) ; bF = bz * ( 1.0 + 0.1 * fract ( bE ) ) ; bF = by * bC * ( 1.0 + sin ( 2.0 * 3.14 * bA * bF + bE ) ) ; bE = ( bw . y - bx . y ) * abs ( bF ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; bD = bw ; bD . xz += bB . xz * bE * sign ( bF ) ; bE = length ( bw - bx ) ; bw = bx + normalize ( bD - bx ) * bE ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bI ( vec4 bH ) { return bH * bH * ( 3.0 - 2.0 * bH ) ; } vec4 bK ( vec4 bJ ) { return abs ( fract ( bJ + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bM ( vec4 bL ) { return bI ( bK ( bL ) ) ; } void cc ( inout vec3 bN , in float bO , in vec3 bP , in vec3 bQ , in vec3 bR , in float bS , in float bT , in float bU , in vec3 bV ) { vec3 bW ; vec4 bX ; vec2 bY , bZ ; float b_ , ca , cb ; b_ = dot ( bR , vec3 ( 1.0 ) ) ; ca = b_ + bV . g ; cb = dot ( bN , vec3 ( bV . g ) ) ; bY = ( bO + vec2 ( cb , ca ) ) ; bX = ( ( fract ( ( bY . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bQ ) * bS ; bX = bM ( bX ) ; bZ = bX . xz + bX . yw ; bZ . y = 0.5 - bZ . y ; bW = bZ . xyx * bV . rbr * vec3 ( bT * bP . x , bU , bT * bP . z ) ; bN += bW ; }".split(" ")}]}}]},
{type:"textline",b:"void cj ( inout vec3 cd , inout vec3 ce , in vec3 cf ) { vec3 cg , ch , ci ; cg = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ch = ce ; ci = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ch = cd ; ci = ce ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( ch , u_time , cf , cg , ci , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bG ( ch , ci , au_wind_bending_amp , au_wind_bending_freq , u_time , cg , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bG ( ch , ci , au_wind_bending_amp , au_wind_bending_freq , u_time , cg , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"cd += ch - ce ; ce = ch ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cd = ch ; ce = ci ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float ck = 255.0 ; float cl = 0.0 ; float cm = 1.0 ; vec4 cq ( const in float cn ) { vec4 co , cp ; co = vec4 ( ck * ck * ck , ck * ck , ck , cm ) ; cp = vec4 ( cl , cm / ck , cm / ck , cm / ck ) ; co = fract ( cn * co ) ; co -= co . xxyz * cp ; return co ; } float cu ( const in vec4 cr ) { vec4 cs ; float ct ; cs = vec4 ( cm / ( ck * ck * ck ) , cm / ( ck * ck ) , cm / ck , cm ) ; ct = dot ( cr , cs ) ; return ct ; } vec4 cq ( const in vec2 cv ) { vec4 cw ; vec2 cx , cy ; cx = vec2 ( ck , cm ) ; cy = vec2 ( cl , cm / ck ) ; cw = fract ( cv . xxyy * cx . xyxy ) ; cw -= cw . xxzz * cy . xyxy ; if ( cv . r == cm ) cw . rg = vec2 ( cl , cm ) ; if ( cv . g == cm ) cw . ba = vec2 ( cl , cm ) ; return cw ; } vec2 cC ( const in vec4 cz ) { vec2 cA , cB ; cB = vec2 ( cm / ck , cm ) ; cA . r = dot ( cz . rg , cB ) ; cA . g = dot ( cz . ba , cB ) ; return cA ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cK = 0.0 ; float cL = 1.0 ; vec4 cN ( vec4 cM ) { return cM - floor ( cM * ( cL / 289.0 ) ) * 289.0 ; } vec3 cN ( vec3 cO ) { return cO - floor ( cO * ( cL / 289.0 ) ) * 289.0 ; } vec2 cN ( vec2 cP ) { return cP - floor ( cP * ( cL / 289.0 ) ) * 289.0 ; } vec4 cR ( vec4 cQ ) { return cQ - floor ( cQ * ( cL / 7.0 ) ) * 7.0 ; } vec4 cT ( vec4 cS ) { return cN ( ( 34.0 * cS + 5.0 ) * cS ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 da ( vec2 cU ) { vec4 cV , cW , cX , cY ; vec2 cZ , c_ ; cZ = cN ( floor ( cU ) ) ; c_ = fract ( cU ) ; cV = c_ . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; cW = c_ . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; cX = cT ( cZ . x + vec4 ( cK , cL , cK , cL ) ) ; cX = cT ( cX + cZ . y + vec4 ( cK , cK , cL , cL ) ) ; cY = cR ( cX ) * K + K2 ; cX = cR ( floor ( cX * K ) ) * K + K2 ; cV = cV + JITTER * cY ; cY = cW + JITTER * cX ; cW = cV * cV + cY * cY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"cW . xy = min ( cW . xy , cW . zw ) ; cW . x = min ( cW . x , cW . y ) ; return cW . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cW . xy = ( cW . x < cW . y ) ? cW . xy : cW . yx ; cW . xz = ( cW . x < cW . z ) ? cW . xz : cW . zx ; cW . xw = ( cW . x < cW . w ) ? cW . xw : cW . wx ; cW . y = min ( cW . y , cW . z ) ; cW . y = min ( cW . y , cW . w ) ; return sqrt ( cW . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dj ( vec2 db , float dc ) { vec4 dd , de , df , dg ; vec2 dh , di ; dh = cN ( floor ( db ) ) ; di = fract ( db ) ; dd = di . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; de = di . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; df = cT ( dh . x + vec4 ( cK , cL , cK , cL ) ) ; df = cT ( df + dh . y + vec4 ( cK , cK , cL , cL ) ) ; dg = cR ( df ) * K + K2 ; df = cR ( floor ( df * K ) ) * K + K2 ; dd = dd + JITTER * dg ; dg = de + JITTER * df ; de = dd * dd + dg * dg ; dd += dc ; dg += dc ; df = dd * dd + dg * dg ; dd += dc ; dg += dc ; dd = dd * dd + dg * dg ; de . xy = min ( de . xy , de . zw ) ; de . x = min ( de . x , de . y ) ; df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; dd . xy = min ( dd . xy , dd . zw ) ; dd . x = min ( dd . x , dd . y ) ; return mat3 ( de . xx , cK , df . xx , cK , dd . xx , cK ) ; } vec3 dl ( vec3 dk ) { return cN ( ( ( dk * 34.0 ) + cL ) * dk ) ; } float dx ( vec2 dm ) { vec3 dn , dp , dq , dr ; vec4 ds ; vec2 dt , du , dv ; const vec4 dw = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; dt = floor ( dm + dot ( dm , dw . yy ) ) ; du = dm - dt + dot ( dt , dw . xx ) ; dv = ( du . x > du . y ) ? vec2 ( cL , cK ) : vec2 ( cK , cL ) ; ds = du . xyxy + dw . xxzz ; ds . xy -= dv ; dt = cN ( dt ) ; dn = dl ( dl ( dt . y + vec3 ( cK , dv . y , cL ) ) + dt . x + vec3 ( cK , dv . x , cL ) ) ; dp = max ( 0.5 - vec3 ( dot ( du , du ) , dot ( ds . xy , ds . xy ) , dot ( ds . zw , ds . zw ) ) , cK ) ; dp = dp * dp ; dp = dp * dp ; dn = 2.0 * fract ( dn * dw . www ) - cL ; dq = abs ( dn ) - 0.5 ; dr = floor ( dn + 0.5 ) ; dn = dn - dr ; dp *= 1.79284291400159 - 0.85373472095314 * ( dn * dn + dq * dq ) ; dr . x = dn . x * du . x + dq . x * du . y ; dr . yz = dn . yz * ds . xz + dq . yz * ds . yw ; return 130.0 * dot ( dp , dr ) ; } vec2 dB ( vec2 dy ) { float dz , dA ; dz = dot ( dy , vec2 ( 12.9898 , 78.233 ) ) ; dA = dot ( dy , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; dz = fract ( sin ( dz ) * 43758.5453 ) * 2.0 - cL ; dA = fract ( sin ( dA ) * 43758.5453 ) * 2.0 - cL ; return vec2 ( dz , dA ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dD = 0.1 ; const float dE = 0.1 ; const float dF = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dG = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dH = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dI = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool dL ( vec2 dJ , float dK ) { return all ( lessThanEqual ( dJ , vec2 ( 1.0 + dK ) ) ) && all ( greaterThanEqual ( dJ , vec2 ( 0.0 - dK ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float dX ( vec3 dM , sampler2D dN , float dO ) { vec2 dP , dQ ; mat2 dR ; float dS , dT , dU ; dM . z = clamp ( dM . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==",
"SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dS = 0.0 ; dT = dB ( dM . xy ) . x * M_PI ; dU = cos ( dT ) ; dT = sin ( dT ) ; dR = mat2 ( dU , dT , - dT , dU ) ; for ( int dV = 0 ; dV < 4 ; dV ++ ) for ( int dW = 0 ; dW < 4 ; dW ++ ) { dQ . x = dH [ dV ] [ dW ] ; dQ . y = dI [ dV ] [ dW ] ; dQ = dR * dQ ; dP = dM . xy + dQ * dO / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! dL ( dP , dF ) ) dS += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"dS += step ( dM . z , texture2D ( dN , dP ) . r ) ; } dS /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["dS","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dS , 0.0 , 1.0 ) ; } float en ( vec3 dY , sampler2D dZ , vec3 d_ , sampler2D ea , float eb , float ec , float ed ) { vec2 ee , ef ; mat2 eg ; float eh , ei , ej , ek ; dY . z = clamp ( dY . z , 0.0 , 1.0 ) ; d_ . z = clamp ( d_ . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"eh = 0.0 ; ei = 0.0 ; ej = dB ( dY . xy ) . x * M_PI ; ek = cos ( ej ) ; ej = sin ( ej ) ; eg = mat2 ( ek , ej , - ej , ek ) ; for ( int el = 0 ; el < 4 ; el ++ ) for ( int em = 0 ; em < 4 ; em ++ ) { ef . x = dH [ el ] [ em ] ; ef . y = dI [ el ] [ em ] ; ef = eg * ef ; ee = dY . xy + ef * eb / SHADOW_TEX_RES ; eh += step ( dY . z , texture2D ( dZ , ee ) . r ) ; ee = d_ . xy + ef * ec / SHADOW_TEX_RES ; ei += step ( d_ . z , texture2D ( ea , ee ) . r ) ; } eh = mix ( eh , ei , ed ) ; eh /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["eh","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( eh , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float er ( vec2 eo ) { float ep , eq ; ep = min ( eo . x , eo . y ) ; eq = min ( 1.0 - eo . x , 1.0 - eo . y ) ; return min ( ep , eq ) ; } float eu ( float es , float et ) { if ( et >= 0.0 && et <= dE ) es = ( es - 1.0 ) / dE * et + 1.0 ; return es ; } float eF ( vec3 ev , vec3 ew , sampler2D ex , sampler2D ey , float ez , float eA , float eB , float eC ) { float eD , eE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"eE = er ( ev . xy ) ; if ( - eC > eB && eE >= 0.0 && eE <= dD && dL ( ew . xy , 0.0 ) ) { eE = 1.0 - eE / dD ; eD = en ( ev , ex , ew , ey , ez , eA , eE ) ; } else".split(" ")}]}}]},{type:"textline",b:"eD = dX ( ev , ex , ez ) ; return eD ; } float eN ( vec3 eG , sampler2D eH , float eI , float eJ , float eK ) { float eL , eM ; eL = dX ( eG , eH , eI ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eK > eJ ) { eM = er ( eG . xy ) ; eL = eu ( eL , eM ) ; }".split(" ")}]}}]},{type:"textline",b:"return eL ; } float eU ( float eO ) { vec3 eP , eQ , eR , eS ; float eT ; eT = 1.0 ; eP = cE . xyz / cE . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"eQ = cF . xyz / cF . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"eR = cG . xyz / cG . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eS = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( dL ( eP . xy , 0.0 ) ) { eT = eF ( eP , eQ , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , eO ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( dL ( eP . xy , dG ) ) { eT = eN ( eP , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , eO ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eQ . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"eT = eF ( eQ , eR , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , eO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eT = eN ( eQ , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , eO ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eR . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eT = eF ( eR , eS , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , eO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eT = eN ( eR , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , eO ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eS . xy , 0.0 ) ) eT = eN ( eS , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , eO ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","eT",";","}"]}]}}]}]}}]},{type:"textline",b:"float eZ ( inout vec3 eV ) { float eW ; vec3 eX ; vec2 eY ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"eY = texture2DProj ( u_shadow_mask , cI ) . rg ; eX = vec3 ( eY . r ) ; eW = eY . g ; dC = vec4 ( eX , eW ) ; eV *= dC . a ; return dC . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return eU ( cJ . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fd ( vec3 e_ , float fa , vec2 fb ) { vec2 fc ; fc = vec2 ( ( e_ . x - fb . x ) / fa , - ( e_ . z - fb . y ) / fa ) ; return fract ( fc ) ; } vec2 fh ( vec2 fe , float ff , vec2 fg ) { return vec2 ( fe . x * ff , - fe . y * ff ) + fg ; } d fi ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d fE ( vec3 fj , vec3 fk , vec3 fl , vec3 fm , vec3 fn , sampler2D fo , sampler2D fp , vec3 fq , float fr , vec3 fs , vec4 ft , mat4 fu ) { mat4 fv ; vec4 fw ; vec2 fx , fy , fz ; float fA , fB ; vec3 fC ; fC = j ( ft , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; fA = - fC . x ; fB = - fC . z ; fx = vec2 ( fs . x + fr * ( - 1.0 - fA ) / 2.0 , fs . z + fr * ( 1.0 - fB ) / 2.0 ) ; fy = fd ( fn , fr , fx ) ; fA = fr / 2.0 ; fz = abs ( fh ( fy - vec2 ( 0.5 ) , fr , vec2 ( 0.0 ) ) ) ; fB = fA * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fz ) > fB ) return fi ( ) ; fA = fr / fq . z ; fz = ( fy - vec2 ( 0.5 ) ) * fA + vec2 ( 0.5 ) ; fC = fC * ( fr / fq . z - 1.0 ) / 2.0 ; fz . x += fC . x ; fz . y -= fC . z ; fw = texture2D ( fp , fz ) ; fB = fw . r ; if ( fB < u_scale_threshold ) return fi ( ) ; fA = fq . y - fq . x ; fA = fq . y - texture2D ( fo , fz ) . r * fA ; fz = fj . xz - fn . xz ; fn . xz = fh ( fy , fr , fx ) ; fn . y = fA ; fj . xz = fn . xz + fz ; fj . y *= fB ; fj . y += fA ; fC = fw . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fj -= fn ; fv = ai ( fs , fn , fu ) ; d fD = av ( fj , fn , fk , fl , fm , fv ) ; fD . b = fn ; fD . f = fC ; return F ( fD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return F ( d ( fj , fn , fk , fl , fm , fC ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",a:[{type:"if",
c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 fK ( mat4 fF , vec4 fG ) { vec4 fH ; float fI ; vec2 fJ ; fJ = ( fF * u_v_light_matrix [ 3 ] ) . xy ; fI = SHADOW_TEX_RES / 2.0 ; fJ = floor ( fJ * fI + 0.5 ) / fI - fJ ; fH = fF * fG ; fH . xy += fJ ; fH = u_b_light_matrix * fH ; return fH ; } void fO ( vec3 fL ) { vec4 fM ; vec3 fN ; fN = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; fM = u_v_light_matrix * vec4 ( fL + u_normal_offset * fN , 1.0 ) ; cE = fK ( u_p_light_matrix0 , fM ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cF = fK ( u_p_light_matrix1 , fM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cG = fK ( u_p_light_matrix2 , fM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cH = fK ( u_p_light_matrix3 , fM ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void fO ( vec4 fP ) { float fQ , fR , fS ; fQ = fP . x ; fR = fP . y ; fS = fP . w ; cI . x = ( fQ + fS ) / 2.0 ; cI . y = ( fR + fS ) / 2.0 ; cI . z = fS ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void fV ( inout vec3 fU ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"fU = max ( vec3 ( 0.0 ) , fU ) ; fU = pow ( fU , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void fX ( inout vec3 fW ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"fW = max ( vec3 ( 0.0 ) , fW ) ; fW = pow ( fW , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void f_ ( inout vec3 fY , in float fZ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"fY = fY * fZ ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gg ( inout vec3 gc , in float gd , in vec4 ge ) { float gf ; gf = ge . w * gd ; gf = exp ( - gf * gf ) ; gf = clamp ( gf , 0.0 , 1.0 ) ; gc = mix ( ge . rgb , gc , gf ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gm ( in mat4 gh , in vec3 gi ) { vec3 gj , gk , gl ; gj = mix ( gh [ 0 ] . rgb , gh [ 1 ] . rgb , max ( sign ( gi . x ) , 0.0 ) ) ; gk = mix ( gh [ 2 ] . rgb , gh [ 3 ] . rgb , max ( sign ( gi . z ) , 0.0 ) ) ; gl = vec3 ( gh [ 0 ] . a , gh [ 1 ] . a , gh [ 2 ] . a ) ; gj = mix ( gj , gk , abs ( gi . z ) ) ; gj = mix ( gj , gl , abs ( gi . y ) ) ; return gj ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void go ( inout float gn ) { gn -= 0.5 ; gn = 4.0 * ( gn * gn * gn ) + 0.5 ; } void gC ( inout vec3 gp , in float gq , in vec3 gr , in float gs , in vec4 gt , in vec4 gu , in float gv , in float gw ) { vec3 gx , gy ; float gz , gA , gB ; gz = gu . w * gq ; gz = exp ( - gz * gz ) ; gz = clamp ( gz , 0.0 , 1.0 ) ; gA = max ( gr . y , 0.0 ) ; gq = max ( gq - max ( gs / gA , 0.0 ) , 0.0 ) ; gB = gt . w * gq ; gB = 1.0 - gB ; gB = max ( gB , 0.0 ) ; go ( gB ) ; gB += max ( gv - 0.5 , 0.0 ) ; if ( gB < gz ) { gx = vec3 ( 0.0 , 0.02 , 0.05 ) ; gy = gt . rgb ; gs = clamp ( - gs * 0.03 , 0.0 , 0.8 ) ; gy = mix ( gy , gx , min ( gA , 1.0 ) ) ; gy = mix ( gy , vec3 ( 0.0 ) , gs ) * gw ; gp = mix ( gy , gp , gB ) ; } if ( gB >= gz ) { gp = mix ( gu . rgb , gp , gz ) ; } } void gK ( inout vec3 gD , in float gE , in float gF , in vec4 gG , in float gH ) { vec3 gI ; float gJ ; gJ = gG . w * gE ; gJ = 1.0 - gJ ; gJ = clamp ( gJ , 0.0 , 1.0 ) ; go ( gJ ) ; gF = clamp ( - gF * 0.03 , 0.0 , 0.8 ) ; gI = mix ( gG . rgb , vec3 ( 0.0 ) , gF ) * gH ; gD = mix ( gI , gD , gJ ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",
b:"float gL = 0.0 ; float gM = 1.0 ; float gN = 0.5 ; struct gO { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float gW ( vec3 gP , vec3 gQ , vec3 gR , float gS , float gT ) { float gU ; vec3 gV ; gV = normalize ( gP + gQ ) ; gU = ( gM - gS ) * max ( dot ( gR , gV ) , gL ) + gS ; return pow ( gU , gT ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hf ( vec3 gX , vec3 gY , vec3 gZ , float g_ ) { float ha , hb , hc , hd ; vec3 he ; he = normalize ( gX + gY ) ; ha = max ( dot ( gZ , he ) , 0.001 ) ; hb = max ( dot ( gZ , gY ) , 0.01 ) ; hc = max ( dot ( gZ , gX ) , 0.01 ) ; ha = tan ( acos ( ha ) ) ; hd = max ( g_ , 0.001 ) ; return hc * ( gM / ( 4.0 * M_PI * hd * hd ) ) * ( exp ( - ( ha * ha ) / ( hd * hd ) ) / ( sqrt ( hb * hc ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hn ( vec3 hg , vec3 hh , vec3 hi , float hj , float hk ) { float hl ; vec3 hm ; hm = normalize ( hg + hh ) ; hl = acos ( dot ( hm , hi ) ) ; if ( hl < hj ) return gM ; else if ( hl >= hj + hk || hk == gL ) return gL ; else return gM - ( hl - hj ) / hk ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void hC ( float ho , vec3 hp , vec3 hq , vec3 hr , float hs , inout float ht ) { vec3 hu , hv ; float hw , hx , hy , hz , hA , hB ; if ( hs > gL ) { hw = max ( dot ( hp , hr ) , gL ) ; hx = hs * hs ; hy = gM - gN * ( hx / ( hx + 0.33 ) ) ; hu = hq - ho * hp ; hv = hr - hw * hp ; if ( length ( hu ) == gL || length ( hv ) == gL || abs ( ho ) > gM || abs ( hw ) > gM ) ht = ht * hy ; else { hz = acos ( ho ) ; hw = acos ( hw ) ; hu = normalize ( hu ) ; hv = normalize ( hv ) ; hA = max ( hz , hw ) ; hB = min ( hz , hw ) ; hB *= 0.95 ; hz = max ( dot ( hu , hv ) , gL ) ; hw = 0.45 * ( hx / ( hx + 0.09 ) ) ; ht = ht * ( hy + ( hw * hz * sin ( hA ) * tan ( hB ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void hJ ( vec3 hD , vec3 hE , float hF , float hG , out float hH ) { float hI ; if ( hF == gL ) { hH = gM ; } else { hI = gM + abs ( dot ( hE , hD ) ) ; hI = hG + ( gM - hG ) * pow ( hI , hF ) ; hH = clamp ( hI , gL , gM ) ; } }".split(" ")}]}}]},{type:"textline",b:"void hR ( vec3 hK , vec3 hL , vec3 hM , vec2 hN , const float hO , out float hP ) { float hQ ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"hJ ( hK , hL , hN [ 0 ] , hN [ 1 ] , hP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hQ = max ( dot ( hK , hL ) , gL ) ; hP = ( gM - hO ) * hQ + hO ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"hC ( hQ , hK , hL , hM , hN [ 0 ] , hP ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} void hY ( vec3 hS , vec3 hT , vec3 hU , float hV , vec2 hW , out float hX ) {".split(" ")},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"hX = gW ( hS , hT , hU , hV , hW [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"hX = hf ( hS , hT , hU , hW [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"hX = hn ( hS , hT , hU , hW [ 0 ] , hW [ 1 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["hX","=","gL",";"]}]}}]},{type:"textline",b:"} void iv ( vec3 hZ , vec3 h_ , vec3 ia , vec2 ib , vec4 ic , vec3 id , vec3 ie , vec3 ig , inout gO ih , float ii , vec2 ij , vec2 ik , float il ) { float im , io , ip , iq , ir , is , it , iu ; im = gL ; if ( ib . r != gL ) hR ( ia , h_ , hZ , ij , il , im ) ; io = gL ; if ( ib . g != gL ) hY ( h_ , hZ , ia , il , ik , io ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],
group:{type:"group",a:[{type:"textline",b:"if ( dot ( h_ , ia ) * dot ( hZ , ia ) < gL ) { ip = ic . x ; iq = ic . y ; ir = ic . z ; is = ic . w ; it = clamp ( abs ( dot ( h_ , ia ) ) , gL , gM ) ; iu = clamp ( dot ( hZ , - h_ ) , gL , gM ) ; iu = pow ( iu , iq ) ; ih . a += ii * vec4 ( ig * it * pow ( id , vec3 ( ip ) ) , gM ) ; ih . a += ir * mix ( vec4 ( id , gM ) , vec4 ( gM ) , is ) * ii * vec4 ( ig * it * vec3 ( iu ) , gM ) ; } else { ih . b += ig * ie * io ; ih . a += vec4 ( ig * id * im , io ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ih . b += ig * ie * io ; ih . a += vec4 ( ig * id * im , io ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"lamp",name:"POINT",f:[{type:"textline",b:"iY = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iQ = iG [ LAMP_IND ] ; iR = iI [ LAMP_IND ] ; iM = gL ;".split(" ")},{type:"textline",b:"iR = iR ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iR *= iF ; iQ = iQ - iA ;".split(" ")},{type:"textline",b:"iN = length ( iQ ) ; iR *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + iN * iN ) ; iQ = normalize ( iQ ) ; iv ( iC , iQ , iB , iY , iL , iy , iz , iR , jb , iK , iE , iD , iM ) ;".split(" ")}]},
{type:"lamp",name:"SPOT",f:[{type:"textline",b:"iZ = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iS = iG [ LAMP_IND ] ; iT = iI [ LAMP_IND ] ; iU = iH [ LAMP_IND ] ; iN = gL ;".split(" ")},{type:"textline",b:"iT = iT ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iT *= iF ; iS = iS - iA ;".split(" ")},{type:"textline",b:"iO = length ( iS ) ; iT *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + iO * iO ) ; iS = normalize ( iS ) ;".split(" ")},{type:"textline",b:"iO = dot ( iS , iU ) ; iO *= smoothstep ( gL , gM , ( iO - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; iT *= iO ; iv ( iC , iS , iB , iZ , iL , iy , iz , iT , jb , iK , iE , iD , iN ) ;".split(" ")}]},
{type:"lamp",name:"SUN",f:[{type:"textline",b:"i_ = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iU = iI [ LAMP_IND ] ; iV = iH [ LAMP_IND ] ; iO = gL ;".split(" ")},{type:"textline",b:"iU = iU ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iU *= iF ; iv ( iC , iV , iB , i_ , iL , iy , iz , iU , jb , iK , iE , iD , iO ) ;".split(" ")}]},{type:"lamp",name:"HEMI",f:[{type:"textline",b:"ja = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iW = iI [ LAMP_IND ] ; iX = iH [ LAMP_IND ] ; iP = gN ;".split(" ")},
{type:"textline",b:"iW = iW ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iW *= iF ; iv ( iC , iX , iB , ja , iL , iy , iz , iW , jb , iK , iE , iD , iP ) ;".split(" ")}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO jc ( vec3 iw , vec3 ix , vec3 iy , vec3 iz , vec3 iA , vec3 iB , vec3 iC , vec2 iD , vec2 iE , float iF , vec3 iG [ NUM_LIGHTS ] , vec3 iH [ NUM_LIGHTS ] , vec3 iI [ NUM_LIGHTS ] , vec4 iJ [ NUM_LFACTORS ] , float iK , vec4 iL ) { float iM , iN , iO , iP ; vec3 iQ , iR , iS , iT , iU , iV , iW , iX ; vec2 iY , iZ , i_ , ja ; gO jb ; jb . a = vec4 ( iw + iy * ix , gL ) ; jb . b = vec3 ( gL ) ;".split(" ")},
{type:"lamps_main"},{type:"textline",b:["return","jb",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO jh ( vec3 jd , vec3 je , vec3 jf ) { gO jg ; jg . a = vec4 ( jd + jf * je , gL ) ; jg . b = vec3 ( gL ) ; return jg ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},
{type:"textline",b:"void jA ( inout vec3 ji , float jj , float jk , float jl , vec3 jm , vec3 jn , vec3 jo , vec4 jp , vec3 jq , float jr ) { mat3 js ; float jt , ju , jv , jw ; vec2 jx ; vec3 jy ; vec4 jz ; if ( jr > CAUSTICS_VIEW_DISTANCE ) return ; jz = jp ; jy = jq + jm ; jy . xz = 10.0 * sin ( 0.1 * jy . xz ) ; jy = jy + 2.0 * cross ( - jz . xyz , cross ( - jz . xyz , jy ) + jz . w * jy ) ; jx = jy . xz ; jy = jn ; jt = max ( dot ( jm , jy ) , 0.0 ) ; ju = 0.025 ; jx . s += 0.5 * sin ( dot ( jq + jk , vec3 ( 1.0 ) ) ) ; jx . t += 0.7 * ( - sin ( dot ( jq - jk , vec3 ( - 0.7 ) ) ) ) ; jx . st += 0.23 * cos ( 4.0 * jj - CAUST_SPEED . x * jk ) ; jx . st += 3.0 * sin ( jj - 0.3 * CAUST_SPEED . y * jk ) ; jv = CAUST_SCALE * ( 1.0 + max ( 0.1 * jj , 0.0 ) ) ; js = dj ( ( jx / jv ) , ju ) ; jv = ( js * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; ju = ( js * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; jw = ( js * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; jy = CAUST_BRIGHT * vec3 ( jv , ju , jw ) ; jv = jl * jt ; ju = max ( sign ( jj ) , 0.0 ) ; jv = min ( jv + 0.5 * sign ( - jm . y ) * ju , 1.0 ) ; jv *= 1.0 - ju * ( 0.1 * jj ) ; jy *= jv ; jy *= jy ; jw = min ( - jj + 10.0 , 1.0 ) ; ji += max ( ( 2.0 * jo * jy ) * jw , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float jN ( in vec3 jH , in vec3 jI , in float jJ , in float jK ) { float jL ; vec3 jM ; jM = normalize ( jI + jH ) ; jL = 1.0 - dot ( jH , jM ) ; jL = jK + ( 1.0 - jK ) * pow ( jL , jJ ) ; return jL ; } void jZ ( inout vec3 jO , in vec3 jP , in vec3 jQ , in float jR , in float jS , in float jT ) { vec2 jU , jV ; float jW ; vec3 jX , jY ; jX = reflect ( - jP , jQ ) ; jW = 1.0 ; if ( jR != 0.0 ) jW = jN ( jP , jX , jR , jS ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"jY = u_refl_plane . xyz * dot ( jQ , u_refl_plane . xyz ) ; jY = jQ - jY ; jU = ( u_view_matrix_frag * vec4 ( jY , 0.0 ) ) . xy ; jV = cI . xy / cI . z ; jV += jU * REFL_BUMP ; jY = texture2D ( u_reflectmap , jV ) . rgb ; fV ( jY . rgb ) ; jO = mix ( jO , jY , jT * jW ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"jY = textureCube ( u_mirrormap , jX ) . xyz ; fV ( jY . rgb ) ; jO = mix ( jO , jY , u_mirror_factor * jW ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float ke ( in float j_ , inout vec2 ka , in vec2 kb ) { float kc ; vec4 kd ; kd = texture2D ( u_scene_depth , ka ) ; kc = cu ( kd ) ; if ( kc < jG ) { ka = kb ; return j_ ; } else { return kc ; } return j_ ; }".split(" ")}]}}]},{type:"textline",
b:"vec3 km ( in vec3 kf , in vec2 kg ) { vec3 kh ; float ki ; vec4 kj ; vec2 kk , kl ; kk = kf . xy / kf . z ; kl = kk + kg ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"kj = texture2DProj ( u_scene_depth , kf ) ; ki = cu ( kj ) ; ke ( ki , kl , kk ) ;".split(" ")}]}}]},{type:"textline",b:"kh = texture2D ( u_refractmap , kl ) . rgb ; fV ( kh ) ; return kh ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",
a:[{type:"textline",b:"vec3 kp ( float kn , vec3 ko ) {".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , ko ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , kn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct kT { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void kZ ( inout float kU , float kV , vec2 kW , vec2 kX ) { float kY ; kY = kX . x - kW . x ; kY = ( kV - kW . x ) / kY ; kU = mix ( kU , kX . y , clamp ( kY , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void le ( inout vec3 k_ , float la , vec4 lb , vec4 lc ) { float ld ; ld = lc . x - lb . x ; ld = ( la - lb . x ) / ld ; k_ = mix ( k_ , lc . yzw , clamp ( ld , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float lk ( float lf , float lg , vec2 lh [ SIZE_RAMP_LENGTH ] ) { float li , lj ; li = lf / lg ; lj = lh [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"kZ ( lj , li , lh [ 0 ] , lh [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"kZ ( lj , li , lh [ 1 ] , lh [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"kZ ( lj , li , lh [ 2 ] , lh [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",
b:["return","lj",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lq ( float ll , float lm , vec4 ln [ COLOR_RAMP_LENGTH ] ) { vec3 lo ; float lp ; lp = ll / lm ; lo = ln [ 0 ] . yzw ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"le ( lo , lp , ln [ 0 ] , ln [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],
group:{type:"group",a:[{type:"textline",b:"le ( lo , lp , ln [ 1 ] , ln [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"le ( lo , lp , ln [ 2 ] , ln [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","lo",";","}"]}]}}]},{type:"textline",b:"float ly ( float lr , float ls , float lt , float lu ) { float lv , lw , lx ; lv = max ( 0.01 , min ( ls , lt ) ) ; lw = max ( 0.01 , min ( ls , lu ) ) ; lx = ls - lw ; lv = clamp ( lr / lv , 0.0 , 1.0 ) - step ( lx , lr ) * ( lr - lx ) / lw ; return lv ; } kT lE ( ) { vec3 lz , lA ; float lB , lC ; kT lD ; if ( u_p_cyclic == 1 ) { lB = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( lB < 0.0 ) lB += u_p_length ; } if ( u_p_cyclic != 1 ) { lB = u_p_time - a_p_delay ; } if ( lB < 0.0 || lB >= a_p_lifetime ) { lD . a = 0.0001 ; lD . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( lB < 0.0 || lB >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"lz = a_position ; lA = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lz = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; lA = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"lz += u_p_nfactor * lB * lA ; lz += a_p_vels . xyz * lB ; lz . y -= u_p_gravity * lB * lB / 2.0 ; lC = max ( u_p_mass , EPSILON ) ; lz += ( u_p_wind / lC ) * lB * lB / 2.0 ; lD . b = lz ; lD . e = a_p_vels . w * lB ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lD . a = lk ( lB , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lD . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lD . d = lq ( lB , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lD . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"lD . c = ly ( lB , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return lD ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float lQ ( in sampler2D lK , in vec2 lL , in vec2 lM ) { float lN , lO , lP ; lN = texture2D ( lK , lL ) . r ; lO = lM . x ; lP = lM . y ; lN = 2.0 * lO / ( lO + lP - ( 2.0 * lN - 1.0 ) * ( lP - lO ) ) ; return lN ; }".split(" ")}]}};b4w.module.__objects=function(a,v){function d(a){a={type:a,zd:0,QD:[0,0],g:new Float32Array(3),quat:new Float32Array(4),Fb:new Float32Array(8),V:new Float32Array(16),lv:new Float32Array(16),dc:new Float32Array(3),Ec:new Float32Array(3),Lh:0,Mh:0,fp:!1,Tk:null,Jd:0,Bm:!1,ey:!1,ia:0,cr:1,br:1,dr:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,kg:null,Yx:!1,pe:0,jg:0,mb:!1,kc:null,Xd:null,ac:null,oo:!0,I:null,Cj:null,ej:0,Zi:0,Bo:0,wj:0,Fg:0,qw:"",Im:!1,Mc:!1,Tb:!1,uc:!1,ec:!1,Sb:!1,md:!1,cg:!1,
Yd:!1,bl:!1,Ad:!1,hb:!1,zh:!1,Kh:!1,Fl:!1,Ug:!1,Ql:!1,Lb:!1,Pl:!1,Wv:!1,Bl:!1,Dl:!1,Co:!1,jk:0,Zd:0,Qf:0,af:0,$e:0,Xe:0,Ae:"",Ob:null,Gk:!1,ke:!1,Mi:"",Bn:!1,og:0,time:0,$q:0,gy:0,ld:0,dj:!1,Mm:!1,Wd:!1,zf:[],sj:!1,Ue:!1,Te:1,kn:0,jn:1,Em:new Int8Array([-1,-1]),xm:[],Lv:[],ux:[],Jc:null,Ic:null,Rc:null,Qc:null,Wc:null,rw:null,sn:null,rn:null,pf:null,Hg:null,Hl:null,Gd:null,Gg:null,Il:null,Yb:null,yn:null,wn:null,xn:null,fb:null,gd:null,Hb:null,ag:null,bg:null,scale:1,nf:1E4};J.identity(a.quat);k.identity(a.Fb);
C.identity(a.V);C.identity(a.lv);return a}function b(a){var b=a.parent;if(b&&b.jh)return!0;switch(a.type){case "MESH":var d=m.yl(a),e=a.b4w_do_not_batch,h=a.b4w_collision,f=a.b4w_vehicle,k=a.b4w_floating,b=a.b4w_character,q=a.b4w_billboard,n=P.TD(a),l=c.ev(a),w=0<a.data.b4w_shape_keys.length,r=a.b4w_dynamic_geometry;if(!(d=d||e||h||f||w||k))a:{a=a.data;for(d=0;d<a.materials.length;d++)if("LENS_FLARES"===a.materials[d].name){d=!0;break a}d=!1}return d||n||b||q||l||r;case "EMPTY":return b=m.yl(a),q=
c.ev(a),a=a.b4w_do_not_batch,b||q||a;default:return!0}}function p(a,b,c,d,h,f,k,q,n){for(var m=0;m<a.nodes.length;m++){var l=a.nodes[m];if("VALUE"==l.type){var w=b+l.name;d.push(l.outputs[0].default_value);h.push(w,h.length/2)}else"RGB"==l.type?(w=b+l.name,l=l.outputs[0].default_value.slice(0,3),k.push(l[0],l[1],l[2]),q.push(w,q.length/2)):"GROUP"==l.type&&(w=l.node_group.node_tree,p(w,b+l.name+"%join%",w.animation_data,d,h,f,k,q,n))}if(c)for((a=c.action)&&e(a,b,f,h,n,q),c=c.nla_tracks,d=0;d<c.length;d++)for(k=
c[d].strips,m=0;m<c[d].strips.length;m++)a=k[m].action,e(a,b,f,h,n,q)}function e(a,b,c,d,e,h){var k=a.d.Ya,q;for(q in k){var n=b+q.match(/"(.*?)"/)[1],k=f(d,n);null!=k?(n=a.name+"%join%"+q,c.push(n,k)):(k=f(h,n),null!=k&&(n=a.name+"%join%"+q,e.push(n,k)))}}function f(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function r(a,b,c){return{name:a,type:b,modifiers:[],particle_systems:[],constraints:[],data:null,parent:null,b4w_vehicle_settings:null,b4w_floating_settings:null,b4w_character_settings:null,
b4w_vehicle:!1,b4w_character:!1,b4w_floating:!1,n:[],Rz:c,Tc:[],Se:[],fe:[],fd:null,Ta:null,Uc:null,i:null,C:[],l:null,h:null,cb:null}}function l(a){return a instanceof Array?a.slice():a}function t(a){if("object"!=typeof a||null===a)return a;var b=a instanceof Array?[]:{},c=null,d=null,e=null;a.X&&(c=a.X,a.X=null);a.ed&&(d=a.ed,a.ed=null);a.ba&&(e=a.ba,a.ba=null);for(var h in a)b[h]=a[h]&&"object"==typeof a[h]?a[h]instanceof Float32Array?new Float32Array(a[h]):a[h]instanceof Uint32Array?new Uint32Array(a[h]):
a[h]instanceof Uint16Array?new Uint16Array(a[h]):a[h]instanceof WebGLUniformLocation?a[h]:a[h]instanceof WebGLProgram?a[h]:a[h]instanceof WebGLShader?a[h]:a[h]instanceof WebGLBuffer?null:t(a[h]):a[h];c&&(b.X=c,a.X=c);d&&(b.ed=d,a.ed=d);e&&(b.ba=e,a.ba=e);return b}var m=v("__animation"),x=v("__batch"),u=v("__boundings"),y=v("__camera"),K=v("__config"),G=v("__constraints"),A=v("__curve"),n=v("__geometry"),q=v("__lights"),c=v("__nla"),P=v("__particles"),O=v("__scenes"),F=v("__transform"),k=v("__tsr"),
B=v("__util"),J=v("quat"),h=v("vec3"),C=v("mat4"),I=K.Lb,H=0,w=new Float32Array(4);a.Xk=d;a.Yq=function(a,c){var e=b(a);a.jh=e;a.d=d("MESH"===a.type?e?"DYNAMIC":"STATIC":a.type);a.Rz=!1;a.Ta=null;a.Tc=[];a.C=[];a.l=null;a.h=null;a.cb=null;a.za||(a.za=null);var e=a.d,f=a.location,n=a.scale[0];B.cF(a.rotation_quaternion,w);F.Nd(a,f);F.Ie(a,w);F.xf(a,n);switch(a.type){case "ARMATURE":f=a.pose.bones;for(n=0;n<f.length;n++){var l=f[n],r=l.bone,t=new Float32Array(r.matrix_local),v=new Float32Array(16);
C.invert(t,v);var P=new Float32Array(l.matrix_basis),z=new Float32Array(3);h.subtract(r.tail_local,r.head_local,z);B.uH(z,v,z);l.Wz=z;l.Pz=[l].concat(l.parent_recursive);l.Vr=k.Vt(t,k.create());l.Ur=k.Vt(P,k.create());l.dn=k.create();l.zk=!1}f=m.LA(a);e.Wc=f;f=m.Gs(a,f);a.b4w_animation_mixing?(e.Jc=new Float32Array(f.ya),e.Ic=new Float32Array(f.ya),e.Rc=new Float32Array(f.g),e.Qc=new Float32Array(f.g)):(e.Jc=f.ya,e.Ic=f.ya,e.Rc=f.g,e.Qc=f.g);e.rw=f;e.og=0;e.Ue=a.b4w_animation_mixing;break;case "MESH":e.Ug=
I.outlining_overview_mode||a.b4w_selectable;e.Ql=a.b4w_selectable;e.Lb=I.outlining_overview_mode||a.b4w_outlining;e.Pl=a.b4w_outlining;e.Wv=I.outlining_overview_mode||a.b4w_outline_on_select;e.ke=a.b4w_billboard;e.GA=a.b4w_pres_glob_orientation;e.Mi="BASIC";e.Bn="SPHERICAL"==a.b4w_billboard_geometry;e.Cj={Rl:a.b4w_outline_settings.outline_duration,Tl:a.b4w_outline_settings.outline_period,Ul:a.b4w_outline_settings.outline_relapses};e.Ug&&(a.d.Tk=B.Wt(H),H++);if("MESH"!=a.type)throw"Wrong object type: "+
a.name;a.d.Mm=a.data.b4w_vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;n=a.d;if(a.data.b4w_shape_keys.length)for(n.Wd=!0,f=0;f<a.data.b4w_shape_keys.length;f++)l={},l.value=a.data.b4w_shape_keys[f].value,l.name=a.data.b4w_shape_keys[f].name,n.zf.push(l);else n.Wd=!1;if(n=m.ij(a)){f=a.d;l=a.data.vertex_groups;if(l.length){r=n.data.bones;t=n.pose.bones;v=0;P={};for(z=0;z<r.length;z++){var K=r[z].name,la=B.Rb("name",K,l);if(la){var ba=B.Lo(t,"name",K);P[K]={Es:z,Ui:v++,
Tp:ba,jy:la.index}}}f.Wc=P;f.ld=v;f.sj=!0}f=a.d.Wc;f=m.Gs(n,f);n.b4w_animation_mixing?(e.Jc=new Float32Array(f.ya),e.Ic=new Float32Array(f.ya),e.Rc=new Float32Array(f.g),e.Qc=new Float32Array(f.g)):(e.Jc=f.ya,e.Ic=f.ya,e.Rc=f.g,e.Qc=f.g);e.sn=new Float32Array(4);e.rn=J.create();e.rw=f;e.og=0}n=a.d;f=a.data.materials;l=[];r=[];t=[];v=[];P=[];z=[];for(K=0;K<f.length;K++)la=f[K],(ba=la.node_tree)&&p(ba,la.name+"%join%",ba.animation_data,l,r,t,v,P,z);n.pf=l;n.Hg=r;n.Hl=t;n.Gd=v;n.Gg=P;n.Il=z;a.n=[];e.Mc=
a.b4w_shadow_cast;e.Tb=a.b4w_shadow_receive;e.uc=a.b4w_shadow_cast_only&&e.Mc;e.ec=a.b4w_reflexible;e.Sb=a.b4w_reflexible_only&&e.ec;e.md=a.b4w_reflective;e.cg=a.b4w_caustics;e.Yd=a.b4w_wind_bending;e.jk=a.b4w_wind_bending_angle;n=x.yH(a.b4w_wind_bending_angle,x.CA(a.data.b4w_bounding_box),a.scale[0]);e.Zd=n;e.Qf=a.b4w_wind_bending_freq;e.af=a.b4w_detail_bending_freq;e.$e=a.b4w_detail_bending_amp;e.Xe=a.b4w_branch_bending_amp;e.Kh=!1;e.Ae=a.b4w_main_bend_stiffness_col;n=a.b4w_detail_bend_colors;e.Ob=
{};e.Ob.Dv=n.leaves_stiffness_col;e.Ob.Cv=n.leaves_phase_col;e.Ob.Yv=n.overall_stiffness_col;e.zh=a.b4w_do_not_cull;e.bl=a.b4w_disable_fogging;e.Ad=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";n=a.data.materials[0];e.ej=n.physics.friction;e.Zi=n.physics.elasticity;e.wj=0;e.nf=1E4;e.Fg=a.b4w_lod_transition;e.Fl=!0;break;case "CAMERA":y.QA(a);y.yA(a);break;case "LAMP":q.mE(a);break;case "CURVE":if(n=A.SB(a))a.Vz=n;break;case "EMPTY":e.Yb=u.$d(),n=u.kk(),e.gd=n}if(!c&&(a.parent&&"OBJECT"==
a.parent_type?(f=e.g,l=e.quat,n=e.scale,G.fs(a,a.parent,f,l,n)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(f=e.g,l=e.quat,n=e.scale,G.es(a,a.parent,a.parent_bone,f,l,n)):a.za&&a.za.b4w_group_relative?(n=k.xh(e.g,e.scale,e.quat),G.aA(a,a.za,n)):a.za&&!a.za.b4w_group_relative&&(F.B(a),k.multiply(a.za.d.Fb,a.d.Fb,a.d.Fb),F.Nd(a,k.Mu(a.d.Fb)),F.xf(a,k.lj(a.d.Fb)),F.Ie(a,k.Bu(a.d.Fb))),n=a.dupli_group))for(f=n.objects,n=0;n<f.length;n++)f[n].za=a;a.field&&(e.Bo=a.field.strength,O.by(a));
e.Im=a.game.use_collision_compound;e.qw=a.game.physics_type;F.B(a)};a.cH=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||F.B(c);c.b4w_use_default_animation&&m.yl(c)&&(m.qn(c),c.C.length&&m.play(c,null,m.Zm))}};a.Fc=function(a){return a.jh?!0:!1};a.gp=function(a){return"MESH"==a.type&&a.jh?!0:!1};a.kj=function(a){a=a.b4w_object_tags;return{title:a?a.title:"",description:a?a.description:"",FJ:a?a.category:""}};a.Y=function(){H=0};a.jv=r;a.copy=function(a,
b,c){b=r(b,a.type,!1);var d=[];if(c){for(var e=0;e<a.n.length;e++)a.n[e].ng||(b.n.push(t(a.n[e])),d.push(a.n[e].da));for(e=0;e<a.n.length;e++)if(a.n[e].ng){var h=t(a.n[e]);b.n.push(h);for(var f=0;f<d.length;f++)d[f]==a.n[e].da&&(h.da=b.n[f].da)}}else b.n=l(a.n);b.d=t(a.d);a.jh&&(b.jh=a.jh);a.za&&(b.za=a.za);a.fe&&(b.fe=l(a.fe));!a.l||a.b4w_vehicle||a.b4w_character||a.b4w_floating||(b.l=t(a.l));b.game=t(a.game);b.b4w_collision_id=a.b4w_collision_id;b.b4w_correct_bounding_offset=a.b4w_correct_bounding_offset;
b.b4w_collision=a.b4w_collision;b.data=a.data;b.particle_systems=c?t(a.particle_systems):l(a.particle_systems);if(c)for(e=0;e<b.n.length;e++){b.n[e].da&&n.ZG(b.n[e].da);if("PARTICLES"==b.n[e].type&&b.n[e].Wp)for(f=0;f<b.JM.length;f++)if(b.particle_systems[f].name==b.n[e].Wp){b.n[e].Hc=b.particle_systems[f];break}b.n[e].Zh=b.uuid;x.SG(b.n[e],B.ph(b.d,0))}b.uuid=B.Yt();b.d.fp=!0;b.d.Tk=B.Wt(H);H++;return b};a.uB=t;a.FL=function(a,b){for(var c=a.d.Hg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};
a.vL=function(a,b){for(var c=a.d.Gg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}};b4w.module.__camera=function(a,v){function d(b){switch(b){case "STATIC":return a.Uf;case "TARGET":return a.ta;case "EYE":return a.Mb;case "HOVER":return a.wb;default:throw"Unknown move style";}}function b(b){var c={type:b,name:"",Df:1,width:0,height:0,re:null,Ib:null,Yc:null,Aa:0,Dc:0,Wa:0,ib:0,left:0,right:0,top:0,bottom:0,ff:new Float32Array(3),Mt:new Float32Array(3),quat:new Float32Array(4),ma:new Float32Array(16),CJ:new Float32Array(16),va:new Float32Array(16),Ei:new Float32Array(16),bF:new Float32Array(16),
Pd:new Float32Array(16),tx:new Float32Array(16),Mf:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,kg:null,dof_on:0,Do:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Wa:new Float32Array([0,0,0,0]),ib:new Float32Array([0,0,0,0])},$j:0,Td:0,rc:null,Si:null,$n:null,qt:new Float32Array(4),am:new Float32Array(4)};if(b==a.xb)return c;switch(b){case a.gc:r(c,40,.1,1E3);break;case a.Sc:r(c,2.5,.1,
1E3);break;case a.de:break;case a.Re:break;case a.Xf:break;case a.yb:case a.Gb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function p(b,c,d){if(b.type!=a.yb&&b.type!=a.Gb)throw"set_stereo_params(): wrong camera type";b.$j=c;b.Td=d;P(b,b.Aa);if(M.ea())for(c=M.A(),b=c.d.Od,c=M.kl(c).d.I,d=0;d<c.length;d++)h(c[d],b)}function e(a,b){return f(a.d.quat,b)}function f(a,b){var c=L.qa(a,L.Sa,z),d=L.qa(a,L.rd,ea),e=-Math.asin(c[1]/R.length(c)),
c=Math.abs(e)>Math.PI/4?R.scale(d,-L.sign(e),la):R.scale(c,-L.sign(d[1]),la),g=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=L.sign(e)*Math.PI-e);d=g;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function r(b,c,d,e,h){switch(b.type){case a.gc:case a.yb:case a.Gb:b.Dc=c;b.Aa=1;break;case a.Sc:b.top=c;b.Aa=1;break;case a.de:delete b.Dc;b.Dc=c;b.Aa=h/c;break;case a.Re:b.top=c;b.Aa=h/c;break;default:g.error("set_frustum(): Unsupported camera type: "+b.type)}b.Wa=d;b.ib=e}function l(b,
c){var d=c.d.g,e=c.d.quat,g=sa;aa.rotateX(c.d.V,-Math.PI/2,g);aa.invert(g,b.ma);if(b.rc){var g=b.rc[0],h=b.rc[1],f=b.rc[2],k=b.rc[3],n=sa;n[0]=1-2*g*g;n[1]=-2*g*h;n[2]=-2*g*f;n[3]=0;n[4]=-2*g*h;n[5]=1-2*h*h;n[6]=-2*h*f;n[7]=0;n[8]=-2*g*f;n[9]=-2*h*f;n[10]=1-2*f*f;n[11]=0;n[12]=-2*g*k;n[13]=-2*h*k;n[14]=-2*f*k;n[15]=1;aa.multiply(b.ma,n,b.ma);P(b,b.Aa,!0);g=ma;h=sa;aa.invert(b.ma,h);aa.transpose(h,h);U.transformMat4(b.rc,h,g);h=ca;h[0]=(L.sign(g[0])+b.va[8])/b.va[0];h[1]=(L.sign(g[1])+b.va[9])/b.va[5];
h[2]=-1;h[3]=(1+b.va[10])/b.va[14];U.scale(g,2/(g[0]*h[0]+g[1]*h[1]+g[2]*h[2]+g[3]*h[3]),g);b.va[2]=g[0];b.va[6]=g[1];b.va[10]=g[2]+1;b.va[14]=g[3]}b.type==a.yb?b.ma[12]+=b.Td/2:b.type==a.Gb&&(b.ma[12]-=b.Td/2);aa.multiply(b.va,b.ma,b.Mf);F(b);O(b);R.copy(b.ff,b.Mt);R.copy(d,b.ff);Z.copy(e,b.quat)}function t(b,c,d,e){aa.lookAt(c,d,e,b.ma);b.type==a.yb?b.ma[12]+=b.Td/2:b.type==a.Gb&&(b.ma[12]-=b.Td/2);aa.multiply(b.va,b.ma,b.Mf);F(b);O(b);R.copy(c,b.ff)}function m(a){var b=a.d.I;if(!b)throw"Wrong object";
for(var c=a.d,d=0;d<b.length;d++){var e=b[d];l(e,a);L.Jt(e.Mf,e.Do);if(e.kg)if(e.dof_on){var g=R.dist(c.g,e.kg.location);e.dof_distance=g}else e.dof_distance=0}}function x(b){b=b.d;if(b.ia==a.ta){var c=L.qa(b.quat,L.rd,z);b.Bm=0<c[1]}}function u(b,c){var d=b.d,g=d.kc;!g||d.ia!=a.Mb&&d.ia!=a.ta||(c&&(d=e(b,T),g.left+=d[0],g.right+=d[0]),g.left=L.wd(g.left),g.right=L.wd(g.right))}function y(b,c){var d=b.d,g=d.Xd;!g||d.ia!=a.Mb&&d.ia!=a.ta||(c&&(d=e(b,T),g.Za+=d[1],g.Qa+=d[1]),g.Za=L.ge(g.Za,-Math.PI,
Math.PI),g.Qa=L.ge(g.Qa,-Math.PI,Math.PI))}function K(b){var c=b.d;if(B(b)&&c.I[0].type===a.Sc){if(c.ia===a.ta)var d=R.dist(c.g,c.dc),c=d/c.Lh*c.Mh;else c.mb&&c.ia===a.wb?(d=R.distance(c.g,c.Ec),c=d/c.Lh*c.Mh):c=b.d.I[0].top;for(var e in b.d.I)d=b.d.I[e],d.top=c,P(d,d.Aa);m(b)}}function G(a,b,c,d,g){var h=a.d,f=b,k=c;if(d||g)a=e(a,Y),d&&(f=b-a[0]),g&&(k=c-a[1]);if(f||k)b=Z.identity(ba),f&&(f=Z.setAxisAngle(L.Sa,f,fa),Z.multiply(b,f,b)),k&&(f=L.qa(h.quat,L.Qe,z),k=Z.setAxisAngle(f,k,fa),Z.normalize(k,
k),Z.multiply(b,k,b)),Z.multiply(b,h.quat,h.quat)}function A(a,b,c,d,g){var h=a.d,f=b,k=c;if(d||g){var n=e(a,Y);d&&(f=b-n[0]);g&&(k=c-n[1])}q(a,a.d.dc,f,k);a=e(a,Y);a=L.ge(a[1],-Math.PI,Math.PI);h.Bm=Math.abs(a)>Math.PI/2}function n(a,b,d,g,h){var f=a.d,k=b,n=d;if(g||h){var m=e(a,Y);g&&(k=b-m[0]);h&&(n=d-m[1])}f.oo||(k=0);q(a,f.Ec,k,n);n&&c(a)}function q(a,b,c,d){var e=a.d;if(c||d){var g=Z.identity(ba);c&&(c=Z.setAxisAngle(L.Sa,c,fa),Z.multiply(g,c,g));a=J(a);d&&(!a||a&&e.mb)&&(a=L.qa(e.quat,L.Qe,
z),d=Z.setAxisAngle(a,d,fa),Z.normalize(d,d),Z.multiply(g,d,g));L.vF(e.g,b,g,e.g);Z.multiply(g,e.quat,e.quat)}}function c(a){var b=a.d;if(b.mb){var c=e(a,T)[1];a=a.d;a.ac.Qa-a.ac.Za?(c=(a.ac.Qa-c)/(a.ac.Qa-a.ac.Za),c=Math.max(c,0)):c=0;c=c*(a.jg-a.pe)+a.pe;a=L.qa(b.quat,L.vc,z);R.normalize(a,a);R.scale(a,c,a);R.subtract(b.Ec,a,b.g)}}function P(b,c,d){switch(b.type){case a.gc:if(!c)throw"No aspect ratio";b.Aa=c;case a.de:aa.perspective(L.em(b.Dc),b.Aa,b.Wa,b.ib,b.va);break;case a.Sc:if(!c)throw"No aspect ratio";
b.Aa=c;case a.Re:c=b.top*b.Aa;aa.ortho(-c,c,-b.top,b.top,b.Wa,b.ib,b.va);break;case a.Xf:aa.ortho(b.left,b.right,b.bottom,b.top,b.Wa,b.ib,b.va);break;case a.yb:case a.Gb:if(!c)throw"No aspect ratio";b.Aa=c;var e=Math.tan(b.Dc*Math.PI/360);c=b.Wa*e;var g=b.Aa*b.$j*e;b.type==a.yb?(e=g-b.Td/2,g+=b.Td/2):(e=g+b.Td/2,g-=b.Td/2);e=-(b.Wa/b.$j*e);g*=b.Wa/b.$j;aa.frustum(e,g,-c,c,b.Wa,b.ib,b.va);b.left=e;b.right=g;break;case a.xb:return;default:throw"Wrong camera type: "+b.type;}d||(aa.multiply(b.va,b.ma,
b.Mf),F(b),O(b))}function O(a){aa.copy(a.ma,a.Pd);a.Pd[12]=0;a.Pd[13]=0;a.Pd[14]=0;a.Pd[15]=1;aa.multiply(a.va,a.Pd,a.Pd);aa.invert(a.Pd,a.Pd)}function F(a){aa.copy(a.ma,a.Ei);aa.multiply(a.va,a.Ei,a.Ei);aa.invert(a.Ei,a.Ei)}function k(b,c,d,e,g){e||(e=new Float32Array(24));c||(c=b.Wa);d||(d=b.ib);var h,f,k,n,q,m,l,w;switch(b.type){case a.xb:throw"Extraction from NONE camera is not possible";case a.gc:case a.de:h=c*Math.tan(b.Dc*Math.PI/360);n=-h;f=h*b.Aa;k=-f;q=d/c*h;w=-q;m=q*b.Aa;l=-m;break;case a.Sc:case a.Re:k=
b.top*b.Aa;h=q=b.top;f=m=k;n=w=-b.top;k=l=-k;break;case a.Xf:h=q=b.top;f=m=b.right;n=w=b.bottom;k=l=b.left;break;case a.yb:case a.Gb:q=c/b.Wa;h=c*Math.tan(b.Dc*Math.PI/360);n=-h;f=b.right*q;k=b.left*q;l=d/c;q=h*l;w=-q;m=f*l;l*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=n;e[2]=-c;e[3]=f;e[4]=n;e[5]=-c;e[6]=f;e[7]=h;e[8]=-c;e[9]=k;e[10]=h;e[11]=-c;e[12]=l;e[13]=w;e[14]=-d;e[15]=l;e[16]=q;e[17]=-d;e[18]=m;e[19]=q;e[20]=-d;e[21]=m;e[22]=w;e[23]=-d;g&&(c=sa,aa.invert(b.ma,c),L.tf(e,
c,e,0));return e}function B(a){return"CAMERA"===a.type?!0:!1}function J(b){return B(b)&&b.d&&b.d.ia==a.wb?!0:!1}function h(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.Si){var d=b.csm_num;a.Si=Array(d);for(var e=0;e<d;e++)a.Si[e]=new Float32Array(3);a.$n=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Wa:C(b,a,d-1),g=C(b,a,d),e=k(a,e,g,qa),e=H.xD(e);a.Si[d].set(e.F);a.$n[d]=e.Ea;a.qt[d]=R.length(e.F);a.am[d]=I(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.am[0]=b.first_cascade_blur_radius}
function C(a,b,c){var d=a.csm_num,e=L.ua(a.csm_first_cascade_border,b.Wa,b.ib);a=L.ua(a.csm_last_cascade_border,b.Wa,b.ib);return L.ua(I(e,a,d,c),b.Wa,b.ib)}function I(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var H=v("__boundings");v("__config");var w=v("__constraints"),g=v("__print"),M=v("__scenes"),L=v("__util"),R=v("vec3"),U=v("vec4"),Z=v("quat"),X=v("mat3"),aa=v("mat4");a.xb=10;a.gc=20;a.Sc=30;a.de=40;a.Re=50;a.Xf=60;a.yb=70;a.Gb=80;
a.Uf=0;a.Xm=1;a.ta=2;a.Mb=3;a.wb=4;var T=new Float32Array(2),Y=new Float32Array(2),z=new Float32Array(3),ea=new Float32Array(3),la=new Float32Array(3),ba=new Float32Array(4),fa=new Float32Array(4),ma=new Float32Array(4),ca=new Float32Array(4),ra=new Float32Array(16),sa=new Float32Array(16),qa=new Float32Array(24);a.QA=function(h){var f=h.d,k=h.data;switch(k.type){case "PERSP":var q=b(a.gc);if(k.angle_y)var m=k.angle_y/Math.PI*180;r(q,m,k.clip_start,k.clip_end);break;case "ORTHO":q=b(a.Sc),r(q,k.ortho_scale/
2,k.clip_start,k.clip_end)}q.name=h.name;f.Yx=!1;f.ia=d(k.b4w_move_style);f.dof_distance=h.data.dof_distance;f.kg=h.data.dof_object;f.dof_front=h.data.b4w_dof_front;f.dof_rear=h.data.b4w_dof_rear;f.dof_power=h.data.b4w_dof_power;f.oo=h.data.b4w_enable_hover_hor_rotation;f.I=[q];if(f.ia==a.ta||f.ia==a.Mb||f.ia==a.wb)f.cr=h.data.b4w_trans_velocity,f.br=h.data.b4w_rot_velocity,f.dr=h.data.b4w_zoom_velocity;f.ia==a.ta&&(f.dc.set(k.b4w_target),k=L.qa(f.quat,L.rd,z),f.Bm=0<k[1]);k=h.d;m=k.ia;if(m===a.ta||
m===a.Mb||m===a.wb){var l=h.data,w=null,t=null,p=null;m===a.ta||m===a.Mb?(l.b4w_use_panning&&(k.ey=l.b4w_use_panning),l.b4w_use_horizontal_clamping&&(w={left:l.b4w_rotation_left_limit,right:l.b4w_rotation_right_limit}),l.b4w_use_vertical_clamping&&(t={Qa:l.b4w_rotation_down_limit,Za:l.b4w_rotation_up_limit}),m===a.ta&&(k.mb=l.b4w_use_distance_limits&&l.b4w_distance_min<=l.b4w_distance_max,k.mb&&(k.pe=l.b4w_distance_min,k.jg=l.b4w_distance_max))):m===a.wb&&(l.b4w_use_horizontal_clamping&&l.b4w_horizontal_translation_min<=
l.b4w_horizontal_translation_max&&(w={left:l.b4w_horizontal_translation_min,right:l.b4w_horizontal_translation_max}),l.b4w_use_vertical_clamping&&l.b4w_vertical_translation_min<=l.b4w_vertical_translation_max&&(t={Qa:l.b4w_vertical_translation_min,Za:l.b4w_vertical_translation_max}),k.mb=l.b4w_use_distance_limits&&l.b4w_hover_angle_min<=l.b4w_hover_angle_max&&l.b4w_distance_min<=l.b4w_distance_max,k.mb&&(p={Qa:l.b4w_hover_angle_min,Za:l.b4w_hover_angle_max},k.pe=l.b4w_distance_min,k.jg=l.b4w_distance_max));
var x=w;x&&m==a.Mb&&(x.left*=-1,x.right*=-1);if(x=t)switch(m){case a.ta:x.Qa*=-1;x.Za*=-1;break;case a.wb:var B=-x.Qa;x.Qa=-x.Za;x.Za=B}(x=p)&&m==a.wb&&(x.Qa*=-1,x.Za*=-1);k.kc=w;k.Xd=t;k.ac=p;u(h,"LOCAL"==l.b4w_horizontal_clamping_type);y(h,"LOCAL"==l.b4w_vertical_clamping_type)}if(f.ia===a.wb)if(f=h.d,f.mb){k=h.d;m=L.qa(k.quat,L.vc,z);l=ma;l.set(L.Sa);l[3]=0;m=L.rp(l,0,k.g,m,k.Ec);if(!m||100<R.len(m))k.Ec[0]=k.g[0],k.Ec[1]=0,k.Ec[2]=k.g[2];k=e(h,T);f=L.Ye(k[1],f.ac.Za,f.ac.Qa);0<k[1]&&g.warn("Active hover camera has wrong orientation");
f?n(h,0,f):c(h)}else f.oo=!1;if(q.type==a.Sc)switch(h=h.d,h.ia){case a.ta:h.Lh=R.dist(h.g,h.dc);h.Mh=h.I[0].top;break;case a.wb:h.mb&&(h.Lh=R.dist(h.g,h.Ec),h.Mh=h.I[0].top)}};a.zb=b;a.GJ=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.Ib);case "DEPTH":return Boolean(a.Yc);case "SCREEN":return!Boolean(a.Ib)&&!Boolean(a.Yc);default:throw"Wrong attachment type: "+b;}};a.km=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.Ib=c;break;case "DEPTH":a.Yc=c;break;case "SCREEN":a.Ib=
null;a.Yc=null;break;default:throw"Wrong attachment type: "+b;}};a.YK=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.Ib;case "DEPTH":return a.Yc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Kv=function(b,c){if(b.type!=a.gc||c!=a.yb&&c!=a.Gb)throw"make_stereo(): wrong camera type";b.type=c;p(b,6,.065)};a.UF=p;a.kd=e;a.ju=f;a.ll=function(a,b){e(a,b);b[0]=L.wd(b[0]+Math.PI);b[1]*=-1;return b};a.au=function(a,b){var c=a.d,d=L.qa(c.quat,L.vc,z),e=Math.asin(d[1]/
R.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?L.qa(c.quat,L.Sf,ea):L.qa(c.quat,L.rd,ea)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.nq=r;a.NF=function(b,c,d,e,h,f,k){switch(b.type){case a.Xf:b.left=c;b.right=d;b.bottom=e;b.top=h;b.Wa=f;b.ib=k;break;default:g.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.gf=function(a){return a.d.ia};a.GN=l;a.HN=t;a.ox=function(a,b,c){var d=z;d[0]=0;d[1]=-1;
d[2]=0;R.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=ea;e[0]=0;e[1]=0;e[2]=-1;R.transformQuat(e,c,e);t(a,b,d,e)};a.EC=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];aa.lookAt(a,b,c,sa);aa.invert(sa,sa);aa.rotateX(sa,Math.PI/2,sa);X.fromMat4(sa,ra);Z.fromMat3(ra,e)};a.WG=m;a.VG=function(b){var c=b.d,d=b.d;if(d.ia===a.ta||d.ia===a.Mb){if(d.kc){var g=d.kc.left,h=d.kc.right,f=e(b,T);(f=d.ia==a.ta?L.Ye(f[0],g,h):L.Ye(f[0],h,g))&&(d.ia==a.ta?A(b,f,0):G(b,f,0))}d.Xd&&(g=d.Xd.Qa,h=d.Xd.Za,
f=e(b,T),(f=d.ia==a.ta?L.Ye(f[1],h,g):L.Ye(f[1],g,h))&&(d.ia==a.ta?A(b,0,f):G(b,0,f)));d.ia===a.ta&&d.mb&&(f=b.d,g=R.subtract(f.g,f.dc,z),h=R.length(g),h>f.jg?(R.scale(g,f.jg/h,g),R.add(f.dc,g,f.g)):h<f.pe&&(h=L.qa(f.quat,L.vc,ea),R.scale(h,100*f.pe,h),R.add(g,h,g),R.scale(g,-f.pe/R.length(g),g),R.add(f.dc,g,f.g)))}d.ia===a.wb&&(d=b.d,f=d.mb?d.Ec:d.g,d.kc&&(g=L.ua(f[0],d.kc.left,d.kc.right)-f[0],f[0]+=g,d.mb&&(d.g[0]+=g)),d.Xd&&(g=L.ua(f[2],d.Xd.Qa,d.Xd.Za)-f[2],f[2]+=g,d.mb&&(d.g[2]+=g)),d=b.d,d.mb&&
(f=e(b,T)[1],f=L.Ye(f,d.ac.Za,d.ac.Qa),L.qa(d.quat,L.vc,z),f&&n(b,0,f)));K(b);switch(c.ia){case a.ta:w.wF(c.g,c.quat,c.dc);w.Vk(b,L.Sa);break;case a.Mb:b.Ta||w.Vk(b,L.Sa)}x(b)};a.Xq=x;a.XE=u;a.aF=y;a.dH=K;a.Kc=G;a.Ee=A;a.Tg=n;a.XD=c;a.eM=function(b){switch(b.type){case a.gc:case a.Sc:case a.yb:case a.Gb:return!0;default:return!1}};a.cD=function(b){b=b.d.I[0];switch(b.type){case a.gc:case a.de:case a.yb:case a.Gb:return Math.PI*b.Dc/180;default:return g.error("get_min_fov(): Unsupported camera type: "+
b.type),0}};a.Vg=P;a.Hs=O;a.Is=F;a.BC=k;a.yA=function(a){a=a.d;var b=H.$d();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Yb=b;var c=H.Vn(1,[0,0,0]);a.gd=c;a.wn=H.dt(1,b);a.yn=H.ft(1,b);a.xn=H.et(1,b)};a.mf=B;a.Kb=function(b){return B(b)&&b.d&&b.d.ia==a.ta?!0:!1};a.xe=function(b){return B(b)&&b.d&&b.d.ia==a.Mb?!0:!1};a.rb=J;a.Wq=h;a.YB=C;a.Vp=function(b,c,d){b=b.d.I[0];switch(b.type){case a.gc:case a.de:case a.Sc:case a.Re:case a.yb:case a.Gb:var e=ma;e.set(c);e[3]=1;U.transformMat4(e,
b.Mf,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return g.error("Non-compatible camera"),d}};a.sD=function(a){return a.d.I[0]};a.ml=function(b,c){switch(b.type){case a.gc:case a.de:case a.yb:case a.Gb:var d=Math.tan(L.em(b.Dc)/2);switch(c){case "LEFT":return-d*b.Aa;case "RIGHT":return d*b.Aa;case "TOP":return d;case "BOTTOM":return-d}break;case a.Sc:case a.Re:switch(c){case "LEFT":return-b.top*b.Aa;case "RIGHT":return b.top*
b.Aa;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.Xf:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:L.pa("Unknown camera type")}};a.jE=function(b){switch(b.type){case a.Sc:case a.Re:case a.Xf:return!0;default:return!1}};a.uD=function(b,c){switch(b.type){case a.gc:case a.de:case a.yb:case a.Gb:var d=L.em(b.Dc);return c?d*b.Aa:d;default:return 0}}};b4w.module.__constraints=function(a,v){function d(a){var b={};b.type=a;return b}function b(a,b){a.Ta&&a.Ta.R&&e(a.Ta.R,a);b.R&&p(b.R,a);a.Ta=b}function p(a,b){if(-1==a.Tc.indexOf(b))a.Tc.push(b);else throw"Descendant object override is forbidden";}function e(a,b){var c=a.Tc.indexOf(b);if(-1!=c)a.Tc.splice(c,1);else throw"No descendant object";}function f(a,b,c){switch(b.type){case 1:var d=a.d.quat,e=b.R.d.V;c=b.R.d.quat;b.sc?(K.copy(b.sc,d),K.multiply(c,d,d)):K.copy(c,d);y.transformMat4(b.offset,
e,a.d.g);a.d.scale=b.jm*b.R.d.scale;break;case 9:var f=a.d.g,d=a.d.quat,e=b.R.d.V;c=b.R.d.quat;K.multiply(K.invert(b.Pg,b.Pg),d,d);K.multiply(c,d,d);y.transformMat4(b.offset,e,f);K.copy(c,b.Pg);break;case 10:f=a.d.g;d=a.d.quat;e=b.R.d.V;c=b.R.d.quat;K.multiply(K.invert(b.Pg,b.Pg),d,d);K.multiply(c,d,d);y.transformMat4(b.offset,e,f);K.copy(c,b.Pg);f=a.d.quat;d=K.multiply(b.R.d.quat,b.sc,F);d=u.ju(d,A);f=u.ju(f,n);u.Kc(a,x.Ye(f[0],d[0]+b.jB,d[0]+b.iB),x.Ye(f[1],d[1]+b.hB,d[1]+b.kB));break;case 12:var f=
a.d.g,d=a.d.quat,e=b.R.d.V,k=b.R.d.g,p=b.iG,J=q,v=F;y.transformMat4(b.offset,e,J);x.ii(J,f,c,p,f);e=q;y.sub(k,f,e);y.normalize(e,e);var P=d,f=h,k=f.subarray(0,3),J=f.subarray(3,6),Y=f.subarray(6,9);y.copy(e,J);y.negate(J,J);y.normalize(J,J);Boolean(.999999<Math.abs(y.dot(e,x.Sa)))?(e=G.fromQuat(K.normalize(P,v),C),y.copy(e.subarray(0,3),k)):y.cross(x.Sa,J,k);y.normalize(k,k);y.cross(k,J,Y);y.normalize(Y,Y);K.fromMat3(f,v);K.normalize(v,v);x.xx(v,d,c,.16*p,d);break;case 2:d=a.d.quat;f=O;c=F;t(b.R,
b.KA,!0,f,c);b.sc?(K.copy(b.sc,d),K.multiply(c,d,d)):K.copy(c,d);a.d.scale=b.jm*f[3];x.bk(b.offset,f[3],c,f,a.d.g);break;case 3:f=a.d.g;d=a.d.quat;c=b.R.d.g;r(f,d,c);break;case 4:f=a.d.g;d=a.d.quat;c=b.target;r(f,d,c);break;case 5:f=a.d.g;d=a.d.quat;c=b.R.d.g;r(f,d,c);d=y.dist(f,c);if(d=d>b.Aj?d-b.Aj:d<b.Bj?d-b.Bj:0)y.sub(c,f,q),y.normalize(q,q),y.scale(q,d,q),y.add(f,q,f);break;case 6:f=a.d.g;d=a.d.quat;c=b.target;r(f,d,c);d=y.dist(f,c);if(d=d>b.Aj?d-b.Aj:d<b.Bj?d-b.Bj:0)y.sub(c,f,q),y.normalize(q,
q),y.scale(q,d,q),y.add(f,q,f);break;case 7:e=b.R.d.V;y.transformMat4(b.offset,e,a.d.g);break;case 8:k=b.R.d.g;f=a.d.g;y.add(k,b.offset,f);break;case 13:d=a.d.quat;e=b.R.d.V;c=b.R.d.quat;b.sc?(K.copy(b.sc,d),K.multiply(c,d,d)):K.copy(c,d);y.transformMat4(b.offset,e,a.d.g);break;case 11:f=b.R.d;c=m.xh(f.g,f.scale,f.quat,B);m.multiply(c,b.Xx,c);f=a.d.g;f[0]=c[0];f[1]=c[1];f[2]=c[2];a.d.scale=c[3];d=a.d.quat;d[0]=c[4];d[1]=c[5];d[2]=c[6];d[3]=c[7];break;case 14:c=b.R,d=u.sD(c),f=a.d.g,p=u.ml(d,"TOP"),
v=u.ml(d,"BOTTOM"),e=p-v,b.Ev?(k=u.ml(d,"LEFT"),f[0]=k+e*b.pp):(k=u.ml(d,"RIGHT"),f[0]=k-e*b.pp),f[2]=b.Tx?-(p-e*b.Mq):-(v+e*b.Mq),u.jE(d)?f[1]=-b.distance:(f[1]=-1,y.normalize(f,f),y.scale(f,b.distance/Math.abs(f[1]),f)),m.ak(f,c.d.Fb,f),y.add(c.d.g,f,f),d=a.d.quat,b.sc?(K.copy(b.sc,d),K.multiply(c.d.quat,d,d)):K.copy(c.d.quat,d)}"CAMERA"==a.d.type&&(f=x.Sa,10==b.type&&(c=b.R.d.quat,f=y.transformQuat(f,c,I)),u.Xq(a),l(a,f))}function r(a,b,d){var e=q;x.qa(b,x.vc,e);y.normalize(e,e);var h=c;y.subtract(d,
a,h);y.normalize(h,h);a=x.xF(e,h,O);K.multiply(a,b,b);K.normalize(b,b)}function l(a,b){var d=a.d,e=d.quat,h=x.qa(d.quat,x.Sa,q);y.normalize(h,h);if(.999999<Math.abs(y.dot(b,h)))h=K.identity(F);else{var f=y.cross(b,h,c);y.normalize(f,f);if(d.ia==u.ta)d.Bm&&y.negate(f,f);else{var k=x.qa(d.quat,x.rd,P);0<y.dot(k,b)&&y.negate(f,f)}d=x.qa(d.quat,x.Qe,P);y.normalize(d,d);var k=x.ua(y.dot(d,f),-1,1),n=Math.acos(k),h=-.999999>=k?K.setAxisAngle(h,n,F):K.rotationTo(d,f,F);K.normalize(h,h)}K.multiply(h,e,e);
u.Xq(a)}function t(a,b,c,d,e){var h=a.d,f=h.og,n=h.Wc[b];b=n.Ui;a=a.pose.bones[n.Tp];var n=a.Vr,q=O,l=h.Rc,r=h.Qc,t=h.Jc,p=h.Ic,x=l[4*b+1],C=l[4*b+2],u=l[4*b+3],y=r[4*b+1],A=r[4*b+2],I=r[4*b+3];q[0]=(1-f)*l[4*b]+f*r[4*b];q[1]=(1-f)*x+f*y;q[2]=(1-f)*C+f*A;q[3]=(1-f)*u+f*I;l=F;r=k;l[0]=t[4*b];l[1]=t[4*b+1];l[2]=t[4*b+2];l[3]=t[4*b+3];r[0]=p[4*b];r[1]=p[4*b+1];r[2]=p[4*b+2];r[3]=p[4*b+3];K.slerp(l,r,f,l);f=B;m.XF(q,f);m.pq(l,f);c?(c=J,m.translate(n,a.Wz,c),m.multiply(f,c,f)):m.multiply(f,n,f);m.multiply(h.Fb,
f,f);d[0]=f[0];d[1]=f[1];d[2]=f[2];d[3]=f[3];e&&(e[0]=f[4],e[1]=f[5],e[2]=f[6],e[3]=f[7])}var m=v("__tsr"),x=v("__util"),u=v("__camera"),y=v("vec3");v("vec4");var K=v("quat"),G=v("mat3");v("mat4");a.KH=1;a.JH=2;a.OH=3;a.PH=4;a.EH=5;a.FH=6;a.LH=7;a.DH=8;a.IH=9;a.HH=10;a.ae=11;a.GH=12;a.MH=13;a.NH=14;var A=new Float32Array(2),n=new Float32Array(2),q=new Float32Array(3),c=new Float32Array(3),P=new Float32Array(3),O=new Float32Array(4),F=new Float32Array(4),k=new Float32Array(4),B=new Float32Array(16),
J=new Float32Array(16),h=new Float32Array(9),C=new Float32Array(9),B=new Float32Array(8),I=new Float32Array(3);a.fs=function(a,c,e,h,k){var n=d(1);n.R=c;n.offset=new Float32Array(e);n.sc=h?new Float32Array(h):null;n.jm=k;b(a,n);f(a,n,0)};a.es=function(a,c,e,h,k,n){var q=d(2);q.R=c;q.KA=e;q.offset=new Float32Array(h);q.sc=k?new Float32Array(k):null;q.jm=n;b(a,q);f(a,q,0)};a.hA=function(a,c,e,h){var k=d(9),n=a.d.quat,q=c.d.quat;k.R=c;k.offset=new Float32Array(e);k.Pg=new Float32Array(q);h&&(K.copy(h,
n),K.multiply(q,n,n));b(a,k);f(a,k,0)};a.gA=function(a,c,e,h,k,n,q,m){var l=d(10),r=a.d.quat,t=c.d.quat;l.R=c;l.offset=new Float32Array(e);l.Pg=new Float32Array(t);l.iB=x.wd(k);l.jB=x.wd(n);l.kB=x.ge(q,-Math.PI,Math.PI);l.hB=x.ge(m,-Math.PI,Math.PI);h?(l.sc=new Float32Array(h),K.copy(h,r),K.multiply(t,r,r)):l.sc=K.create();b(a,l);f(a,l,0)};a.fA=function(a,c,e,h){var k=d(12);k.R=c;k.offset=new Float32Array(e);k.iG=h;b(a,k);f(a,k,0)};a.kA=function(a,c,e,h){var k=d(13);k.R=c;k.offset=new Float32Array(e);
k.jm=1;k.sc=h?new Float32Array(h):null;b(a,k);f(a,k,0)};a.wJ=p;a.PM=e;a.mA=function(a,c){var e=d(3);e.R=c;b(a,e);f(a,e,0)};a.nA=function(a,c){var e=d(4);e.target=new Float32Array(c);b(a,e);f(a,e,0)};a.cA=function(a,c,e,h){var k=d(5);k.R=c;k.Bj=e;k.Aj=h;b(a,k);f(a,k,0)};a.dA=function(a,c,e,h){var k=d(6);k.target=new Float32Array(c);k.Bj=e;k.Aj=h;b(a,k);f(a,k,0)};a.jA=function(a,c){var e=d(7);e.R=c;e.offset=new Float32Array([0,.5,0]);b(a,e);f(a,e,0)};a.bA=function(a,c,e){var h=d(8);h.R=c;h.offset=new Float32Array(e);
b(a,h);f(a,h,0)};a.aA=function(a,c,e){var h=d(11);h.R=c;h.Xx=new Float32Array(e);b(a,h);f(a,h,0)};a.gs=function(a,c,e){var h=d(14);h.R=c;if("left"in e)h.Ev=!0,h.pp=e.left;else if("right"in e)h.Ev=!1,h.pp=e.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}if("top"in e)h.Tx=!0,h.Mq=e.top;else if("bottom"in e)h.Tx=!1,h.Mq=e.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in e?(h.distance=e.distance,h.sc="rotation"in e?new Float32Array(e.rotation):
null,b(a,h),f(a,h,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.XG=function(a,b){a.Ta&&f(a,a.Ta,b)};a.wF=r;a.Vk=l;a.XA=function(a){return a.Ta?!0:!1};a.remove=function(a){a.Ta.R&&e(a.Ta.R,a);a.Ta=null};a.ue=function(a){return a.Ta?a.Ta.type:null};a.yu=function(a){return a.Ta&&a.Ta.R?a.Ta.R:null};a.se=function(a){return a.Ta&&11==a.Ta.type?a.Ta.Xx:null};a.hD=t};b4w.module.__curve=function(a,v){function d(a,b,d,e,m){var p=e.length;m||(m=new Float32Array(p));for(var u=p+a,y=new Float32Array(u),v=1;v<=u-1;v++)y[v-1]=b>=d[v-1]&&b<d[v+1-1]?1:0;for(var G=2;G<=a;G++)for(v=1;v<=u-G;v++)y[v-1]=(0!=y[v-1]?(b-d[v-1])*y[v-1]/(d[v+G-1-1]-d[v-1]):0)+(0!=y[v+1-1]?(d[v+G-1]-b)*y[v+1-1]/(d[v+G-1]-d[v+1-1]):0);b==d[u-1]&&(y[p-1]=1);a=0;for(v=1;v<=p;v++)a+=y[v-1]*e[v-1];for(v=1;v<=p;v++)m[v-1]=0!=a?y[v-1]*e[v-1]/a:0;return m}function b(a){a=a.El;return a[a.length-1]}function p(a){a=
a.st;return a[a.length-1]}var e=v("__util");a.SB=function(a){var b={},e=a.data;a=e.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var t=a.order_u;b.rf=t;a=a.points;var m=a.length/5,p=[],u=m+t,m=m+2;p[0]=0;for(var y=2;y<=u;y++)p[y-1]=y>t&&y<m?p[y-2]+1:p[y-2];b.El=p;if("2D"==e.dimensions)b.lf=!1;else if("3D"==e.dimensions)b.lf=!0;else throw"Wrong curve dimensions";t=[];p=[];for(e=0;e<a.length;e+=5)t.push(a[e]),t.push(a[e+1]),t.push(a[e+2]),b.lf&&t.push(a[e+3]),p.push(a[e+4]);b.Tn=
t;b.ir=p;a=[];for(var e=b.Tn,t=b.lf?4:3,p=b.ir,u=b.El,m=b.rf,y=e.length/t,v=y+m,G=0,A=u[v-1]/999,n=0;1E3>n;n++){5E-6>u[v-1]-G&&(G=u[v-1]);for(var q=d(m,G,u,p),c=0;c<t;c++)for(var P=a[t*n+c]=0;P<y;P++)a[t*n+c]+=q[P]*e[t*P+c];G+=A}t=b.lf?4:3;p=new Float32Array(1E3);p[0]=0;for(e=1;1E3>e;e+=1)u=a[(e-1)*t],m=a[(e-1)*t+1],y=a[(e-1)*t+2],v=a[e*t],G=a[e*t+1],A=a[e*t+2],p[e]=p[e-1]+Math.sqrt((v-u)*(v-u)+(G-m)*(G-m)+(A-y)*(A-y));b.st=p;return b};a.vG=function(a,e,l){l||(l=[]);var t=e,m=Math.max(t,0);e=m=Math.min(t,
b(a));var t=a.Tn,m=a.lf?4:3,p=a.ir,u=a.El,y=a.rf;a=t.length/m;var v=a+y;5E-6>u[v-1]-e&&(e=u[v-1]);v=new Float32Array(a);d(y,e,u,p,v);for(e=0;e<m;e++)for(p=l[e]=0;p<a;p++)l[e]+=v[p]*t[m*p+e]};a.sG=function(a,b,d){d||(d=[]);var e=a.Tn,m=a.lf?4:3,p=a.ir,u=a.El,y=a.rf;a=e.length/m;var v=a+y;5E-6>u[v-1]-b&&(b=u[v-1]);var v=new Float32Array(a),G=b;b=v;var A=p.length;b||(b=new Float32Array(A));var n=new Float32Array(A),q=new Float32Array(A),c=n,P=q;c||(c=new Float32Array(A));P||(P=new Float32Array(A));for(var O=
A+y,F=new Float32Array(O),k=new Float32Array(O),B=1;B<=O-1;B++)F[B-1]=G>=u[B-1]&&G<u[B+1-1]?1:0;G==u[O-1]&&(F[A-1]=1);for(var J=2;J<=y;J++)for(B=1;B<=O-J;B++){var h=0!=F[B-1]?F[B-1]/(u[B+J-1-1]-u[B-1]):0,C=0!=F[B+1-1]?-F[B+1-1]/(u[B+J-1]-u[B+1-1]):0,I=0!=k[B-1]?(G-u[B-1])*k[B-1]/(u[B+J-1-1]-u[B-1]):0,H=0!=k[B+1-1]?(u[B+J-1]-G)*k[B+1-1]/(u[B+J-1]-u[B+1-1]):0;F[B-1]=(0!=F[B-1]?(G-u[B-1])*F[B-1]/(u[B+J-1-1]-u[B-1]):0)+(0!=F[B+1-1]?(u[B+J-1]-G)*F[B+1-1]/(u[B+J-1]-u[B+1-1]):0);k[B-1]=h+C+I+H}for(B=1;B<=
A;B++)c[B-1]=F[B-1],P[B-1]=k[B-1];u=0;for(y=1;y<=A;y++)u+=n[y-1]*p[y-1];G=0;for(y=1;y<=A;y++)G+=q[y-1]*p[y-1];for(y=1;y<=A;y++)b[y-1]=0!=u?q[y-1]*p[y-1]/u+n[y-1]*p[y-1]*G/(u*u):0;for(p=0;p<m;p++)for(u=d[p]=0;u<a;u++)d[p]+=v[u]*e[m*u+p]};a.ON=b;a.uG=p;a.tG=function(a,d){if(0>=d)return 0;var l=b(a);if(d>=p(a))return l;var t=a.st,m=e.Hk(t,d,0,t.length-1);return l*(m+(d-t[m])/(t[m+1]-t[m]))/1E3}};b4w.module.__lights=function(a,v){function d(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),rh:new Float32Array(3),Rd:0,li:0,ZC:!1,oC:!1,Zg:!0,Kf:!0,aj:1,distance:25,FK:"INVERSE_SQUARE"}}function b(a){a.rh[0]=a.color[0]*a.aj;a.rh[1]=a.color[1]*a.aj;a.rh[2]=a.color[2]*a.aj}var p=v("__util"),e=v("vec3");a.XL=d;a.mE=function(a){var r=a.data,l=d(r.type);l.name=a.name;l.Zg=r.use_diffuse;l.Kf=r.use_specular;var t=p.qa(a.d.quat,p.Sa,[]);e.normalize(t,t);l.direction[0]=
t[0];l.direction[1]=t[1];l.direction[2]=t[2];l.color[0]=r.color[0];l.color[1]=r.color[1];l.color[2]=r.color[2];l.aj=r.energy;b(l);l.distance=r.distance;if("POINT"===l.type||"SPOT"===l.type)l.distance=r.distance;"SPOT"===l.type?(l.li=r.spot_blend,l.Rd=r.spot_size):"POINT"===l.type&&(l.Rd=Math.PI/2);l.ZC=r.b4w_generate_shadows;l.oC=r.b4w_dynamic_intensity;a.cb=l};a.kN=function(a,d){a.color[0]=d[0];a.color[1]=d[1];a.color[2]=d[2];b(a)};a.nN=function(a,b){a.li=b};a.lN=function(a,b){a.distance=b};a.oN=
function(a,b){a.Rd=b};a.mN=function(a,d){a.aj=d;b(a)};a.gM=function(a){return"LAMP"===a.type?!0:!1};a.aH=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.cb;b&&p.qa(a.d.quat,p.Sa,b.direction)}};b4w.module.__nla=function(a,v){function d(){return{type:"CLIP",W:0,ka:0,Fe:!1,paused:!1,Li:"",ln:"",Vc:0,Xr:0,Xz:0,Ht:0,Gt:0,si:!1}}function b(a,b){for(var c=a.b4w_nla_script,d=b.vf,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",W:f.frame_range[0],ka:f.frame_range[1],kf:!1});break;case "SELECT":case "SELECT_PLAY":var n=G.Ed(G.Tf,f.object,0),q=G.HD(a),g=q.indexOf(n);if(-1==g){K.error("NLA script error: non-selectable object");return}for(var f={type:f.type,wx:"SELECT"==
f.type?f.target_slot:e+1,hG:e+1,wf:-1,EF:q.length,DF:g,W:f.frame_range[0],ka:f.frame_range[1],kf:!1},g=[],m=0;m<q.length;m++)g.push(u.Yn(q[m],!0));u.M(n,"NLA_SELECT_"+e,u.td,g,u.cC,function(a,c,d,e){if(!(b.Jb>=b.vf.length)&&(d=b.vf[b.Jb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.kf)){for(d=0;d<e.EF;d++)if(u.Pb(a,c,d)&&d==e.DF){e.wf=1;return}e.wf=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",yq:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",yq:f.target_slot,pB:f.condition,
Oj:f.register1,Pj:f.register2,Kp:f.number1,Lp:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",hF:f.registerd,ME:f.number1});break;case "MATH":d.push({type:"MATH",OE:f.operation,Oj:f.register1,Pj:f.register2,Kp:f.number1,Lp:f.number2,bi:f.registerd});break;case "SHOW":case "HIDE":n=G.Ed(G.Tf,f.object,0);d.push({type:f.type,oc:n});break;case "REDIRECT":d.push({type:"REDIRECT",url:f.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",QE:f.param_name,bi:f.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}
function p(a,b,d,h){if(a.vf.length){if(a.Jb>=a.vf.length)if(a.Xc)a.Jb=0;else{a.Ha-=c.Ma*d;return}var q=f(a,b,h,!1),m=a.vf[a.Jb];switch(m.type){case "PLAY":m.kf?q>=m.ka&&(m.kf=!1,a.Jb++,p(a,b,d,h)):(a.Ha+=m.W-q,m.kf=!0,e(a,m));break;case "SELECT":case "SELECT_PLAY":-1<m.wf?"SELECT"==m.type||"SELECT_PLAY"==m.type&&0==m.wf?(a.Jb=m.wf?m.wx:m.hG,m.wf=-1,p(a,b,d,h)):m.kf?q>=m.ka&&(m.kf=!1,a.Jb=m.wx,m.wf=-1,p(a,b,d,h)):(a.Ha+=m.W-q,m.kf=!0,e(a,m)):a.Ha-=c.Ma*d;break;case "JUMP":a.Jb=m.yq;p(a,b,d,h);break;
case "CONDJUMP":var q=-1==m.Oj?m.Kp:a.Ld[m.Oj],l=-1==m.Pj?m.Lp:a.Ld[m.Pj],t=!1;switch(m.pB){case "EQUAL":q==l&&(t=!0);break;case "NOTEQUAL":q!=l&&(t=!0);break;case "LESS":q<l&&(t=!0);break;case "GREATER":q>l&&(t=!0);break;case "LEQUAL":q<=l&&(t=!0);break;case "GEQUAL":q>=l&&(t=!0)}t?a.Jb=m.yq:a.Jb++;p(a,b,d,h);break;case "REGSTORE":a.Ld[m.hF]=m.ME;a.Jb++;p(a,b,d,h);break;case "MATH":q=-1==m.Oj?m.Kp:a.Ld[m.Oj];l=-1==m.Pj?m.Lp:a.Ld[m.Pj];switch(m.OE){case "ADD":a.Ld[m.bi]=q+l;break;case "MUL":a.Ld[m.bi]=
q*l;break;case "SUB":a.Ld[m.bi]=q-l;break;case "DIV":0==l&&n.pa("Division by zero in NLA script"),a.Ld[m.bi]=q/l}a.Jb++;p(a,b,d,h);break;case "SHOW":G.uq(m.oc);a.Jb++;p(a,b,d,h);break;case "HIDE":G.nj(m.oc);a.Jb++;p(a,b,d,h);break;case "REDIRECT":window.location.href=m.url;a.vf.length=0;break;case "PAGEPARAM":a:{q=location.href.toString();if(-1!=q.indexOf("?"))for(q=q.split("?")[1].split("&"),l=0;l<q.length;l++)if(t=q[l].split("="),1<t.length&&t[0]==m.QE){q=Number(t[1]);break a}q=0}a.Ld[m.bi]=q;a.Jb++;
p(a,b,d,h);break;case "NOOP":a.Jb++,p(a,b,d,h)}}}function e(a,b){for(var c=a.vf,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.wf=-1)}}function f(a,b,d,e){b=(b-d)*c.Ma+a.Ha-a.W;a.Xc&&e&&(b%=a.ka-a.W+1);return b+=a.W}function r(a,b){b?q.RE(a.name):(q.sF(a.name),q.VE(a.name))}function l(a,b){for(var c=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var n=0;n<f.length;n++){var q=f[n],m=d();m.type=q.type;m.W=q.frame_start;m.ka=q.frame_end;m.Vc=b;m.Xr=q.action_frame_start;m.Xz=q.action_frame_end;q.action&&
(m.Li=q.action.name,m.ln=q.action.uuid);c.push(m)}}return c}function t(a){return A.ze(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var m=v("__animation"),x=v("__camera"),u=v("__controls"),y=v("__config");v("__loader");v("__particles");var K=v("__print"),G=v("__scenes"),A=v("__sfx"),n=v("__util"),q=v("__textures"),c=y.he,P=y.q,O=[],F=-1;a.eH=function(a,c){var e={W:a.frame_start,ka:a.frame_end,Ha:0,uj:-1,Xc:c,Be:[],X:[],vf:[],Jb:0,Ld:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};
b(a,e);for(var h=G.Bb(a,"ALL",G.L),f=0;f<h.length;f++){var q=h[f],r=0,p=[],g=q.animation_data;g&&g.nla_tracks.length&&(g=g.nla_tracks,n.we(q)||x.mf(q)||n.lc(q)||n.zl(q)||A.ze(q))&&(g=l(g,r),g.length&&(p=p.concat(g),r++));t(q)&&(g=q.data.animation_data.nla_tracks,g=l(g,r),g.length&&(p=p.concat(g),r++));if(m.bv(q))for(var u=q.data.materials,y=0;y<u.length;y++){var F=u[y].node_tree,g=F.animation_data;F&&g&&(g=g.nla_tracks,g=l(g,r),g.length&&(p=p.concat(g),r++))}for(y=0;y<q.particle_systems.length;y++)g=
q.particle_systems[y],u=g.settings,"EMITTER"==u.type&&u.b4w_allow_nla&&(u=d(),u.type="CLIP",u.W=e.W,u.ka=e.ka+1,u.Li=g.name,u.Vc=r,p.push(u),r++);g=r+1;if(n.lc(q)&&q.data)for(y=0;y<q.data.b4w_vertex_anim.length;y++)F=q.data.b4w_vertex_anim[y],F.allow_nla&&(r=g,u=d(),u.type="CLIP",u.W=e.W,u.ka=e.ka+1,u.Li=F.name,u.Vc=r,p.push(u));p.length&&(q.cn=p,e.Be.push(q))}h=a.d.Di;for(y=0;y<h.length;y++)if(f=h[y].d,f.Oa||f.di)u=d(),u.type="VIDEO",q=1,P.dd&&(q=f.ic),u.W=Math.min(f.W*q,e.ka),u.ka=f.Yg?e.ka:Math.min((f.Eh+
f.W+f.Ha)*q,e.ka),u.Li=h[y].name,f.Sz=u,e.X.push(f);y=e.W;h=e.ka;for(f=0;f<e.Be.length;f++)for(q=e.Be[f],r=q.cn,p=0;p<r.length;p++)u=r[p],g=q.name+" ["+u.W+":"+u.ka+"]",u.W=Math.max(y,u.W),u.ka=Math.min(h+1,u.ka),u.W>u.ka&&(K.warn("NLA: out of scene range: "+g),r.splice(p,1),p--);for(y=0;y<e.Be.length;y++)for(h=e.Be[y].cn,f=0;f<h.length;f++){q=h[f];r=e.W;p=e.ka+1;for(u=0;u<h.length;u++)g=h[u],q.Vc==g.Vc&&(g.ka<=q.W&&(r=q.W),g.W>=q.ka&&(p=Math.min(p,g.W)));q.Ht=r;q.Gt=p}O.push(e)};a.start=function(){F=
0};a.update=function(a,b){if(!(0>F)){0==F&&(F=a);for(var d=0;d<O.length;d++){var e=O[d];p(e,a,b,F);for(var q=f(e,a,F,!0),n=0;n<e.Be.length;n++){for(var l=e.Be[n],t=l.cn,g=0;g<t.length;g++){var x=t[g];"SOUND"==x.type&&q<e.uj-1E-6&&(x.Fe=!1)}for(g=0;g<t.length;g++)switch(x=t[g],x.type){case "CLIP":if(x.Ht<=q&&q<x.Gt&&!x.Fe){var u=l,y=x;""!=y.ln?m.pA(u,y.ln,y.Vc):m.apply(u,y.Li,y.Vc);m.lm(u,m.Rm,y.Vc);for(u=0;u<t.length;u++)t[u]!=x&&t[u].Vc==x.Vc&&(t[u].Fe=!1);x.Fe=!0}if(x.Fe){var u=l,y=q-x.W+x.Xr,v=
m.Io(u,x.Vc);1E-6<Math.abs(y-v)&&m.lq(u,y,x.Vc)}break;case "SOUND":(q<e.uj-1E-6||e.uj<x.W)&&x.W<=q&&q<x.ka&&!x.Fe&&(A.play(l,(x.W-q)/c.Ma,(x.ka-x.W)/c.Ma),x.Fe=!0),e.uj<x.ka&&x.ka<=q&&x.Fe&&(x.Fe=!1)}}for(n=0;n<e.X.length;n++)x=e.X[n].Sz,x.W<=Math.round(q)&&Math.round(q)<x.ka&&!x.si&&(r(e.X[n],x.si),x.si=!0),x.ka<=Math.round(q)&&x.si&&(r(e.X[n],x.si),x.si=!1);e.uj=q}}};a.Y=function(){O.length=0;F=-1};a.ev=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||t(a)||m.bv(a)?!0:!1}};b4w.module.__controls=function(a,v){function d(a){return{type:a,value:0,ga:null,wp:null,vp:null,Gl:null,jd:!1,key:0,zc:"",Pn:null,Gp:!1,On:function(){},Nn:null,Xs:function(){},Qd:null,Dq:new Float32Array(3),po:new Float32Array(3),up:!1,Ew:function(){},axis:"",Pc:0,zi:new Float32Array(3),dm:new Float32Array(4),threshold:0,zw:new Float32Array(4),Ek:0,Dk:0,Qw:0,Fk:0,bd:0,repeat:!1,vs:!1,ul:0,tl:0,sl:0,Uo:0,To:0,So:0}}function b(a,b){var c;if(a.Gl){c=a.wp;for(var d=a.vp,e=0;e<c.length;e++)d[e]=c[e].value;
c=a.Gl(d)}else c=!1;c||(a.value=Number(b))}function p(a){a=C.indexOf(a);-1<a?C.splice(a,1):q.error("Wrong object")}function e(a,b){for(var c=0,d=0;d<b.length;d++)for(var e=b[d].Se,g=0;g<e.length;g++)for(var h=e[g].Md,f=0;f<h.length;f++)h[f]===a&&c++;return c}function f(a,b){switch(a.type){case 80:c.dq(a.Pn,a.zc,a.On);a.jd=!0;break;case 90:c.Ln(a.Nn);a.jd=!0;break;case 100:c.eq(a.Qd,a.zc,a.Dq,a.po,a.up);a.jd=!0;break;case 130:a.jd=!0}var d=b.indexOf(a);-1<d&&b.splice(d,1)}function r(a){for(var c=0;c<
I.length;c++){var d=I[c];20==d.type&&a.keyCode==d.key&&b(d,1)}fa&&a.preventDefault();qa&&qa(a)}function l(a){for(var c=0;c<I.length;c++){var d=I[c];20==d.type&&0==a.keyCode&&16==d.key&&b(d,0);20==d.type&&a.keyCode==d.key&&b(d,0)}fa&&a.preventDefault();qa&&qa(a)}function t(a){var c=!1,d=null;g=a.clientX;M=a.clientY;for(var e=0;e<I.length;e++){var h=I[e];50==h.type&&(b(h,1),h.ga=a.which);160==h.type&&(c||(d=P.bm(a.clientX,a.clientY),c=!0),h.value=d==h.Qd?1:0)}ma&&a.preventDefault();V&&V(a)}function m(a){for(var c=
0;c<I.length;c++){var d=I[c];50==d.type&&b(d,0);160==d.type&&d.vs&&(d.value=0)}ma&&!sa&&a.preventDefault();V&&V(a)}function x(a){var c=a.clientX,d=a.clientY;g=c;M=d;for(var e=c-L,h=d-R,f=Math.sqrt(e*e+h*h),k=0;k<I.length;k++){var q=I[k];if(40===q.type)switch(q.axis){case "X":b(q,e);q.ga=c;break;case "Y":b(q,h);q.ga=d;break;case "XY":b(q,f),q.ga[0]=c,q.ga[1]=d}}ma&&!sa&&a.preventDefault();V&&V(a)}function u(a){var c=a.wheelDelta||-40*a.detail,c=c*J.EE;w+=c;for(c=0;c<I.length;c++){var d=I[c];30===d.type&&
b(d,w)}ca&&a.preventDefault();S&&S(a)}function y(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.pageX,c=c.pageY,d=!1,e=null,g=0;g<I.length;g++){var h=I[g];160==h.type&&(d||(e=P.bm(b,c),d=!0),h.value=e==h.Qd)}X[0]=b;X[1]=-1;aa[0]=c;aa[1]=-1}else 1<b.length&&(z=ea=A(b),X[0]=b[0].pageX,X[1]=b[1].pageX,aa[0]=b[0].pageY,aa[1]=b[1].pageY);U.set(X);Z.set(aa);E&&E(a)}function K(c){var d=c.targetTouches;if(0!==d.length){if(1===d.length){U[0]=d[0].pageX;U[1]=-1;Z[0]=d[0].pageY;Z[1]=-1;var d=U[0]-
X[0],e=Z[0]-aa[0],g=Math.sqrt(d*d+e*e);if(-1!=X[1]&&-1!=aa[1]){var h=U[0]-X[1],f=Z[0]-aa[1],k=Math.sqrt(h*h+f*f);k<g&&(d=h,e=f,g=k)}for(k=0;k<I.length;k++){var q=I[k];if(60===q.type)switch(q.ga=a.uk,q.axis){case "X":b(q,d);break;case "Y":b(q,e);break;case "XY":b(q,g)}}}else if(1<d.length){U[0]=d[0].pageX;U[1]=d[1].pageX;Z[0]=d[0].pageY;Z[1]=d[1].pageY;z=A(d);g=z-ea;h=T;h[0]=(U[0]+U[1])/2;h[1]=(Z[0]+Z[1])/2;f=Y;f[0]=(X[0]+X[1])/2;f[1]=(aa[0]+aa[1])/2;var n,d=h[0],e=h[1],k=f[0],q=f[1];n=Math.sqrt((d-
k)*(d-k)+(e-q)*(e-q));for(k=0;k<I.length;k++)if(q=I[k],70===q.type&&Math.abs(n)<Math.abs(g)&&(q.ga=a.tk,b(q,g)),60===q.type&&Math.abs(n)>Math.abs(g))switch(q.ga=a.sk,q.axis){case "X":d=h[0]-f[0];b(q,d);break;case "Y":e=h[1]-f[1];b(q,e);break;case "XY":b(q,n)}}ra&&c.preventDefault();E&&E(c)}}function G(a){for(var c=0;c<I.length;c++){var d=I[c];if(170==d.type||180==d.type)d.tl=a.beta,d.ul=a.gamma,d.sl=a.alpha,d.value||(d.Uo=a.gamma,d.To=a.beta,d.So=a.alpha,b(d,1))}}function A(a){var b=a[0],c=a[1];a=
b.pageX;var b=b.pageY,d=c.pageX,c=c.pageY;return Math.sqrt((a-d)*(a-d)+(b-c)*(b-c))}var n=v("__config"),q=v("__print"),c=v("__physics"),P=v("__scenes"),O=v("__time"),F=v("__util"),k=v("vec3"),B=v("quat"),J=n.controls,h=n.q,C=[],I=[],H={},w=0,g=0,M=0,L=0,R=0,U=new Float32Array(2),Z=new Float32Array(2),X=new Float32Array(2),aa=new Float32Array(2),T=new Float32Array(2),Y=new Float32Array(2),z=0,ea=0,la=!1,ba=0,fa=!1,ma=!1,ca=!1,ra=!1,sa=!1,qa=null,V=null,S=null,E=null;a.ca=10;a.Um=20;a.td=30;a.sd=40;
a.uk=0;a.tk=1;a.sk=2;a.update=function(c,d){for(var e=0;e<I.length;e++){var h=I[e],f=c,q=d;if(q)switch(h.type){case 110:var n=h.Qd,m=n.d.g,n=n.d.quat,l=k.dist(h.zi,m),t=h.zw;B.invert(h.dm,t);B.multiply(n,t,t);B.normalize(t,t);t=Math.abs(2*Math.acos(t[3]));l/=q;h.Ek=F.Ub(l,h.Ek,q,.3);h.ga[0]=l;l=t/q;h.Dk=F.Ub(l,h.Dk,q,.3);h.ga[1]=l;h.Ek>=h.threshold||h.Dk>=h.Qw?b(h,1):b(h,0);k.copy(m,h.zi);B.copy(n,h.dm);h.Pc=f;break;case 120:n=h.Qd;m=n.d.g;n=Math.abs(m[1]-h.zi[1])/q;h.Fk=F.Ub(n,h.Fk,q,.3);h.ga=n;
h.Fk>=h.threshold?b(h,1):b(h,0);k.copy(m,h.zi);h.Pc=f;break;case 130:!h.jd&&0<=h.bd&&f-h.Pc>=h.bd&&(b(h,1),h.repeat?h.Pc=f:h.bd=-h.bd);break;case 140:h.Pc||(h.Pc=f);b(h,f-h.Pc);h.Pc=f;break;case 150:b(h,f);break;case 170:h.ga[0]=Math.PI*(h.ul-h.Uo)/180;h.ga[1]=Math.PI*(h.tl-h.To)/180;h.ga[2]=Math.PI*(h.sl-h.So)/180;h.Uo=h.ul;h.To=h.tl;h.So=h.sl;break;case 180:h.ga[0]=Math.PI*h.ul/180,h.ga[1]=Math.PI*h.tl/180,h.ga[2]=Math.PI*h.sl/180}}for(e=0;e<C.length;e++)for(q=C[e],h=q.Se,f=0;f<h.length;f++)if(m=
h[f],m.ay!=ba){m.ay=ba;for(var n=m,l=n.Md,t=n.GF,r=0;r<l.length;r++)t[r]=l[r].value;var n=n.qE(t),l=m,t=l.Bv,p=r=void 0;switch(l.type){case a.ca:n?p=r=1:1==t?p=r=-1:r=0;break;case a.Um:n&&-1==t?p=r=1:n||1!=t?r=0:p=r=-1;break;case a.td:n&&-1==t?p=r=1:n||1!=t?r=0:(r=0,p=-1);break;case a.sd:r=l.Av!=n?1:0;break;default:F.pa("Wrong sensor manifold type: "+l.type)}p&&(l.Bv=p);if(l=r)if(t=q==H?null:q,la=!1,m.callback(t,m.id,l,m.PA),m.Av=n,la){e=-1;break}}for(e=0;e<C.length;e++)for(q=C[e],h=q.Se,f=0;f<h.length;f++)for(m=
h[f],q=m.Md,m=0;m<q.length;m++)switch(n=q[m],n.type){case 30:b(n,0);break;case 40:b(n,0);break;case 60:b(n,0);break;case 70:b(n,0);break;case 130:b(n,0)}w=0;L=g;R=M;X.set(U);aa.set(Z);ea=z;ba++};a.ht=function(a){var c=d(10);b(c,a);return c};a.Ua=function(a){var b=d(20);b.key=a;return b};a.Wn=function(a,c,e){if(!a||!a.l)return q.error("Wrong collision object"),null;var g=d(80);g.Pn=a;g.zc=c||"ANY";g.Gp=e||!1;g.On=function(a,c){b(g,a);a&&c&&e&&(g.ga=g.ga||new Float32Array(3),g.ga[0]=c[0],g.ga[1]=c[1],
g.ga[2]=c[2])};g.jd=!0;return g};a.gt=function(a){if(!a||!a.l)return q.error("Wrong collision impulse object"),null;var c=d(90);c.Nn=a;c.Xs=function(a){b(c,a)};c.jd=!0;return c};a.mt=function(a,c,e,g,h){if(!a)return q.error("Wrong collision object"),null;var f=d(100);f.Qd=a;f.Dq=c;f.po=e;f.up=g;f.zc=h||"ANY";f.Ew=function(a,c){b(f,a);a&&(f.ga=c)};f.jd=!0;return f};a.Wk=function(){return d(50)};a.Xn=function(){return d(30)};a.wh=function(a){var b=d(40);b.axis=a||"XY";b.ga="XY"==b.axis?new Float32Array(2):
0;return b};a.Ri=function(a){var b=d(60);b.axis=a||"XY";b.ga=0;return b};a.Zk=function(){var a=d(70);a.ga=0;return a};a.kt=function(a,b,c){if(!a)return q.error("Wrong collision object"),null;var e=d(110);e.Qd=a;var g=a.d.g;a=a.d.quat;e.zw=new Float32Array(4);e.zi=new Float32Array(g);e.dm=new Float32Array(a);e.Ek=0;e.Dk=0;e.threshold=b;e.Qw=c;e.Pc=0;e.ga=new Float32Array([0,0]);return e};a.pt=function(a,b){if(!a)return q.error("Wrong collision object"),null;var c=d(120);c.Qd=a;var e=a.d.quat;c.zi=
new Float32Array(a.d.g);c.dm=new Float32Array(e);c.Fk=0;c.threshold=b;c.Pc=0;c.ga=0;return c};a.ot=function(a,b){var c=d(130);c.bd=a;c.repeat=b;c.jd=!0;return c};a.Mw=function(a,b,c,d){a=a||H;a=a.fd;if(!a||!a[b])return q.error("reset_timer_sensor(): wrong object"),null;b=a[b].Md[c];if(!b)return q.error("reset_timer_sensor(): sensor not found"),null;b.Pc=O.Ih();b.bd=d};a.uh=function(){var a=d(140);a.Pc=0;return a};a.jt=function(){var a=d(170);a.ga=new Float32Array(3);return a};a.it=function(){var a=
d(180);a.ga=new Float32Array(3);return a};a.nt=function(){return d(150)};a.Yn=function(a,b){var c=d(160);c.Qd=a;c.vs=b;return c};a.FF=b;a.Pb=function(a,b,c){a=a||H;a=a.fd;if(!a||!a[b])return q.error("get_sensor_value(): wrong object"),null;b=a[b].Md[c];return b?b.value:(q.error("get_sensor_value(): sensor not found"),null)};a.te=function(a,b,c){a=a||H;a=a.fd;if(!a||!a[b])return q.error("get_sensor_payload(): wrong object"),null;b=a[b].Md[c];return b?b.ga:(q.error("get_sensor_payload(): sensor not found"),
null)};a.Y=function(){C=[];I=[];H={}};a.qh=function(a,b){a=a||H;if(!a.fd)return!1;if(b&&a.fd[b])return!0;if(!b)for(var c in a.fd)return!0;return!1};a.Ce=function(a,b){a=a||H;var c=a.fd;if(c){var d=a.Se;if(b){var g=c[b];if(g){for(var h=g.Md,k=0;k<h.length;k++)1===e(h[k],C)&&f(h[k],I);delete c[b];g=d.indexOf(g);-1<g?d.splice(g,1):F.pa("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||p(a)}}else{for(b in c){g=c[b];h=g.Md;for(k=0;k<h.length;k++)1===e(h[k],C)&&f(h[k],I);delete c[b];g=
d.indexOf(g);-1<g?d.splice(g,1):F.pa("Incorrect manifolds array")}p(a);la=!0}}};a.M=function(a,b,d,g,h,k,q){a=a||H;a.fd=a.fd||{};a.Se=a.Se||[];var n=a.fd,m=a.Se,l=n[b];if(l){g=l.Md;for(var t=0;t<g.length;t++)1===e(g[t],C)&&f(g[t],I);l=m.indexOf(l);-1<l?m.splice(l,1):F.pa("Incorrect manifolds array")}d={id:b,type:d,Md:g.slice(0),qE:h,GF:Array(g.length),callback:k,PA:q,Bv:-1,Av:0,ay:-1};n[b]=d;m.push(d);-1==C.indexOf(a)&&C.push(a);a=d.Md;for(b=0;b<a.length;b++){n=a[b];if(n.jd){switch(n.type){case 80:c.mn(n.Pn,
n.zc,n.On,n.Gp);break;case 90:c.pn(n.Nn,n.Xs);break;case 100:c.on(n.Qd,n.zc,n.Dq,n.po,n.up,n.Ew);break;case 130:n.Pc=O.Ih(),0>n.bd&&(n.bd=-n.bd)}n.jd=!1}-1==I.indexOf(n)&&I.push(n)}la=!0};a.io=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.cC=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<C.length;a++){var b=C[a],c=b.fd,b=b.Se,d;for(d in c)delete c[d];b.splice(0,b.length)}for(a=0;a<I.length;a++)f(I[a],
I),a--;C.splice(0,C.length)};a.debug=function(){q.log(String(C.length)+" objects with manifolds",C);q.log(String(I.length)+" sensors",I);for(var a=[],b=[],c=0;c<I.length;c++){var d=I[c];80==d.type&&a.push(d);100==d.type&&b.push(d)}q.log(String(a.length)+" collision sensors",a);q.log(String(b.length)+" ray sensors",b)};a.$p=function(a,b){a.addEventListener("keydown",r,!1);a.addEventListener("keyup",l,!1);fa=b};a.aq=function(a,b,c){if(c)var d=window;else d=a,d.addEventListener("mouseout",m,!1);a.addEventListener("mousedown",
t,!1);d.addEventListener("mousemove",x,!1);d.addEventListener("mouseup",m,!1);ma=b;sa=c};a.cq=function(a,b){a.addEventListener("mousewheel",u,!1);a.addEventListener("DOMMouseScroll",u,!1);ca=b};a.bq=function(a,b){a.addEventListener("touchstart",y,!1);a.addEventListener("touchmove",K,!1);document.addEventListener("touchstart",function(){});ra=b};a.im=function(){window.DeviceOrientationEvent&&h.gyro_use&&window.addEventListener("deviceorientation",G,!1)};a.Rq=function(a){a.removeEventListener("keydown",
r,!1);a.removeEventListener("keyup",l,!1)};a.Sq=function(a){a.removeEventListener("mousedown",t,!1);a.removeEventListener("mousemove",x,!1);a.removeEventListener("mouseout",m,!1);a.removeEventListener("mouseup",m,!1)};a.Uq=function(a){a.removeEventListener("mousewheel",u,!1);a.removeEventListener("DOMMouseScroll",u,!1)};a.Tq=function(a){a.removeEventListener("touchstart",y,!1);a.removeEventListener("touchmove",K,!1);document.removeEventListener("touchstart",function(){})};a.$x=function(){window.DeviceOrientationEvent&&
h.gyro_use&&window.removeEventListener("deviceorientation",G,!1)};a.uJ=function(a){qa=a};a.vJ=function(a){V=a};a.yJ=function(a){S=a};a.xJ=function(a){E=a}};b4w.module.__physics=function(a,v){function d(a,b){for(var c=a.Tc,e=0;e<c.length;e++)c[e].d.Im&&b.push(c[e]),d(c[e],b)}function b(a,b){if(X)switch(a){case B.Fy:X.l.ry=!0;B.s(B.qz,Date.now()-performance.now(),L.Hd,L.MA?R.St:0);break;case B.Gy:F.log(b);break;case B.By:F.error(b);break;case B.Cy:k.gl.apply(this,b.slice(1));break;case B.Ky:var c=p(b.body_id);if(c){var d=b.trans,e=b.quat,g=b.linvel,f=b.angvel,c=c.l;c.ao=b.time;C.Wj(d,1,e,c.bo);w.copy(g,c.Fv);w.copy(f,c.as)}break;case B.Iy:(d=p(b.chassis_hull_body_id))&&
C.Wj(b.trans,1,b.quat,d.i.Lj[b.prop_ind]);break;case B.Dy:if(c=p(b[1]))d=b[4],c=c.Uc.Ik[b[2]],h.Nd(c,b[3]),h.Ie(c,d),h.B(c);break;case B.Ly:if(c=p(b[1]))c.i.speed=b[2];break;case B.yy:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,g=b.coll_point,d=parseInt(d),f=X.l.p,q=0;q<f.length;q++)for(var n=f[q].Db,m=0;m<n.xd.length;m++){for(var l=n.xd[m],t=l.Wl,r=!1,x=0;x<t.length;x++){var u=t[x];if(u[0]===d&&u[1]===c){l.ow[x]=e;r=!0;break}}if(r){t=l.ow;for(x=r=0;x<t.length;x++)r=r||t[x];l.callback(r,g)}}break;
case B.zy:if(c=p(b[1]))c=c.l,c.Sk&&c.Sk(b[2]);break;case B.Jy:if(c=p(b.body_id))for(c=c.l,e=b.from,g=b.to,f=b.local,q=b.body_id_b_hit,n=b.cur_result,m=0;m<c.uf.length;m++)if(t=c.uf[m],I.Rk(t.N,e)&&I.Rk(t.ha,g)&&t.local==f){for(d in t.De)t.De[d]=1;-1!=q&&(t.De[q]=n);for(var l=t.zc,x=t.callback,t=t.De,r=!1,u=1,y=0;y<X.l.p.length;y++){var A=X.l.p[y].Db;if(("ANY"==l||A.id==l)&&A.P in t&&1!==t[A.P]){r=!0;u=t[A.P];break}}x(r,u)}break;case B.Hy:console.log("Physics message ping: ",performance.now()-b[1]);
break;case B.Ey:U=b[1];break;case B.Ay:console.log(b[1]);break;default:F.error("Wrong message: "+a)}}function p(a){return T[a]||null}function e(){Y.body++;return Y.body}function f(a){return{P:a,yp:0,Al:!1,Cf:!0,jM:!1,oj:!1,dE:!1,Uk:null,id:"",eK:{},xd:[],Sk:null,uf:[],ao:0,bo:new Float32Array([0,0,0,1,0,0,0,1]),Fv:new Float32Array(3),as:new Float32Array(3),Mk:new Float32Array(3),Lk:new Float32Array(4)}}function r(a,b){switch(a){case "BOX":var c=b.Yb;break;case "CYLINDER":c=b.yn;break;case "CONE":c=
b.xn;break;case "SPHERE":c=b.gd;break;case "CAPSULE":c=b.wn}return c}function l(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.F&&(b.center=a.F);"number"===typeof a.Ea&&(b.radius=a.Ea);"number"===typeof a.height&&(b.height=a.height);
return b}function t(a,b,c,d){var e=a.d.g,g=b.d.V,h=new Float32Array(16);M.invert(g,h);g=new Float32Array(3);w.transformMat4(e,h,g);switch(b.i.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Yb;B.s(B.Wy,c,g,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:B.s(B.Vy,c,g,a.RN)}}function m(a){return a.l&&a.l.Uk?!0:!1}function x(a,b,c,d,e,g,h,f,k,q){var n;Y.bt++;n=Y.bt.toString(16);B.s(B.cz,n,a,f,b.l.P,c,d,e.l.P,g,h,k,q);b.l.Uk=n}function u(a){var b=a.l;if(b&&(0===b.yp||!0===
b.Al||!1===b.Cf||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.l.Mk[0]||a.d.g[1]!=a.l.Mk[1]||a.d.g[2]!=a.l.Mk[2]||a.d.quat[0]!=a.l.Lk[0]||a.d.quat[1]!=a.l.Lk[1]||a.d.quat[2]!=a.l.Lk[2])){a.l.Mk.set(a.d.g);a.l.Lk.set(a.d.quat);var b=a.l,c=B.vu(B.rk);c.body_id=a.l.P;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=ea,g.identity(ea)):c.quat=a.d.quat;B.s(B.rk,c)}a=a.Tc;for(b=0;b<a.length;b++)u(a[b])}function y(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;w.transformQuat(e,a,
e)}function K(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.l.p.length;e++){var g=b.l.p[e];if("ANY"==a||g.Db.id==a)g=g.Db.P,c&&-1==c.indexOf(g)&&c.push(g),d&&(d[g]=0)}}function G(a,b){B.s(B.be,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],g=I.qs(e.N)+I.qs(e.ha)+String(e.local);c[g]=c[g]||{N:e.N,ha:e.ha,local:e.local,Ds:[]};var h=c[g].Ds,f;for(f in e.De)-1==h.indexOf(f)&&h.push(f)}for(g in c)d=c[g].N,e=c[g].ha,f=c[g].local,h=c[g].Ds,B.s(B.Jr,a,d,e,f,h)}else B.s(B.Jr,
a,null,null,!1,null)}function A(a,b){if(b.qi){var c=a.l.P,d=b.Dh*b.Rt,e=b.Ni*b.Fs,g=-b.pi*b.Eq*2*Math.PI/b.Ix;b.mv&&(g*=-1);switch(b.type){case 10:B.s(B.be,c);B.s(B.Gz,c,d,e,g);break;case 20:B.s(B.be,c),B.s(B.Fz,c,d,e,g)}}}function n(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function q(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function c(a){return a.b4w_character?!0:!1}function P(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?
!0:!1}var O=v("__config");v("__constraints");var F=v("__print"),k=v("__debug"),B=v("__ipc");v("__renderer");var J=v("__scenes"),h=v("__transform"),C=v("__tsr"),I=v("__util"),H=v("__version"),w=v("vec3"),g=v("quat"),M=v("mat4"),L=O.Db,R=O.q,U=0,Z=null,X=null,aa=[],T={},Y={body:0,bt:0,shape:0},z=new Float32Array(3),ea=new Float32Array(4),la=new Float32Array(4),ba=new Float32Array(16),fa=new Float32Array(8),ma=new Float32Array(8);a.YD=function(a){if(X)F.warn("Multiple physics scenes are currently not supported");
else{a.l={ry:!1,p:[]};var c=L.ek+H.timestamp();F.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+L.Hd);Z=new Worker(c);B.Qb(Z,b);X=a}};a.eB=function(a){return a.l?a.l.ry:!0};a.Y=function(){if(X){Z.terminate();X=Z=null;aa.length=0;T={};for(var a in Y)Y[a]=0}};a.We=function(a,b){var h=a.d;if(!h)throw"No object render: "+a.name;if(a.parent&&h.Im)return null;var k=[];h.Im&&d(a,k);if(n(a)||q(a)||c(a)||P(a)||a.b4w_collision){var p,u=a,y=h.qw,C=u.d,v=u.game,z=e();if("CAMERA"==u.type)var O=v.use_collision_bounds?
v.collision_bounds_type:"BOX",G=r(O,C),H=C.ej,K=C.Zi,H=.5,K=0;else"EMPTY"==u.type?(O="EMPTY",G=null,K=H=0):(O=v.use_collision_bounds?v.collision_bounds_type:"BOX",G=r(O,C),H=C.ej,K=C.Zi);var L=C.g,R=C.quat,U=v.use_ghost,Z=v.use_sleep,Y=v.mass,fa=v.velocity_min,ua=v.velocity_max,nb=v.damping,Ea=v.rotation_damping,kb=v.collision_group,Ta=v.collision_mask,ab=C.gd.Ea,Ha=l(G),mb=u.b4w_correct_bounding_offset,ea;var Qb=O;if(k.length){var ia=[],ma={};ma.quat=new Float32Array([0,0,0,1]);ma.trans=new Float32Array(3);
ma.worker_bounding=Ha;ma.bounding_type=Qb;ia.push(ma);M.invert(C.V,ba);g.invert(C.quat,la);for(var ya=0;ya<k.length;ya++){var Ua={},Oa=k[ya],pa=Oa.game.collision_bounds_type,Ia=new Float32Array(4),Kb=new Float32Array(3);w.transformMat4(Oa.d.g,ba,Kb);g.multiply(la,Oa.d.quat,Ia);Ua.trans=Kb;Ua.quat=Ia;Ua.bounding_type=pa;Ua.worker_bounding=l(r(pa,Oa.d));ia.push(Ua)}ea=ia}else ea=[];B.s(B.Zy,z,L,R,y,U,Z,Y,fa,ua,nb,Ea,kb,Ta,O,Ha,ab,H,K,ea,mb);aa.push(u);T[z]=u;var Zb=f(z);Zb.type=y;Zb.yp=Y;Zb.Al=U;p=
Zb;a.l=p;var Lb={o:null,Db:p};b.l.p.push(Lb)}else for(var Eb=a.n||[],Va=0;Va<Eb.length;Va++){var Ca=Eb[Va],Jb;if(Jb="PHYSICS"==Ca.type){var tc;a:{for(var hc=b.l.p,Ib=0;Ib<hc.length;Ib++){var Ga=hc[Ib].o;if(Ga&&Ga.id==Ca.id){tc=!0;break a}}tc=!1}Jb=!tc}if(Jb)if(Ca.Oc.J)if(Ca.eh&&b.d.ab){var xa=Ca,Ya=X,Za=J.la(Ya,"MAIN_OPAQUE");B.s(B.gz,Za.Of);if(Za.ab&&xa.xH){var bb={};bb.dst_noise_scale0=xa.dst_noise_scale0;bb.dst_noise_scale1=xa.dst_noise_scale1;bb.dst_noise_freq0=xa.dst_noise_freq0;bb.dst_noise_freq1=
xa.dst_noise_freq1;bb.dir_min_shore_fac=xa.dir_min_shore_fac;bb.dir_freq=xa.dir_freq;bb.dir_noise_scale=xa.dir_noise_scale;bb.dir_noise_freq=xa.dir_noise_freq;bb.dir_min_noise_fac=xa.dir_min_noise_fac;bb.dst_min_fac=xa.dst_min_fac;bb.waves_hor_fac=xa.waves_hor_fac;var $b=Za.Pf,ob=Za.fh;Za.Km?B.s(B.Ir,bb,Za.Bf[0],Za.Bf[1],Za.Af[0],Za.Af[1],Za.Th,$b,ob,Za.gi,Ya.d.tq):B.s(B.Ir,bb,0,0,0,0,0,$b,ob,0,null)}}else{var wb;if(Ca.nH){var xb=a,rb=Ca,Na=e(),Aa=rb.Oc;B.s(B.ez,Na,Aa.v[0].a_position,Aa.fa||null,
xb.d.g,rb.Ys,rb.Zs);var Cb=f(Na);Cb.Al=!0;wb=Cb}else{var Db=a,Ba=Ca,fc=e(),ga=Ba.Oc;B.s(B.fz,fc,ga.v[0].a_position,ga.fa||null,Db.d.g,Ba.ej,Ba.Zi,Ba.Ys,Ba.Zs);wb=f(fc)}p=wb;p.id=Ca.zc;Lb={o:Ca,Db:p};b.l.p.push(Lb)}else F.error("Object "+a.name+" has collision material with no assigned vertices")}if(n(a)||q(a)){var za=a,Pa=za.l.P;n(za)?(za.i.type=10,B.s(B.$y,Pa,za.i.GG,za.i.IG,za.i.HG,za.i.zH,za.i.AE)):q(za)&&(za.i.type=20,B.s(B.Yy,Pa,za.i.yo,za.i.fr,za.i.gr));if(za.i.Qg){var va=za.i.Qg;switch(za.i.type){case 10:t(va[1],
za,Pa,!0);t(va[0],za,Pa,!0);t(va[3],za,Pa,!1);t(va[2],za,Pa,!1);break;case 20:for(var Ka=0;Ka<va.length;Ka++)t(va[Ka],za,Pa,!1)}}za.l.id=za.b4w_vehicle_settings.name;A(a,a.i)}else if(c(a)){var ub=a.d,vb=a.l,Wb=ub.Yb.max_y-ub.Yb.min_y,Xb=vb.P,Ma=a.b4w_character_settings,Rb=Ma.walk_speed,Bb=Ma.run_speed,Yb=Ma.step_height,Sb=Ma.jump_strength,lc=Ma.waterline,mc=I.kC(a);B.s(B.az,Xb,mc,Wb,Rb,Bb,Yb,Sb,lc);vb.oj=!0}else if(P(a)){var Wa=a,nc=Wa.l.P;B.s(B.dz,nc,Wa.Uc.yo,Wa.Uc.fr,Wa.Uc.gr);if(Wa.Uc.Ik)for(var oc=
Wa.Uc.Ik,fb=0;fb<oc.length;fb++){var gc=oc[fb],D=gc.d.g,Mb=Wa.d.V,pb=new Float32Array(16);M.invert(Mb,pb);var Qa=new Float32Array(3);w.transformMat4(D,pb,Qa);B.s(B.Xy,nc,Qa,gc.JA)}Wa.l.dE=!0}else a.b4w_collision&&(p.id=a.b4w_collision_id);for(Va=0;Va<aa.length;Va++)if(a=aa[Va],a.l){var hb=a;if(!m(hb))for(var W=0;W<hb.constraints.length;W++){var Ja=hb.constraints[W],ib=Ja.target,ic=Ja.pivot_type;if("RIGID_BODY_JOINT"==Ja.type&&ib.l){var cb=new Float32Array([Ja.pivot_x,Ja.pivot_y,Ja.pivot_z]),Nb,db=
new Float32Array([Ja.axis_x,Ja.axis_y,Ja.axis_z]);Nb=I.ef(db,new Float32Array(4));var uc=M.fromRotationTranslation(Nb,cb,new Float32Array(16)),ac=M.multiply(hb.d.V,uc,new Float32Array(16)),bc=M.invert(ib.d.V,new Float32Array(16)),Tb=M.multiply(bc,ac,bc),Ec=I.Rh(Tb),vc=I.of(Tb),Ra=Ja,La={};La.use_limit_x=Ra.use_limit_x;La.use_limit_y=Ra.use_limit_y;La.use_limit_z=Ra.use_limit_z;La.use_angular_limit_x=Ra.use_angular_limit_x;La.use_angular_limit_y=Ra.use_angular_limit_y;La.use_angular_limit_z=Ra.use_angular_limit_z;
La.limit_max_x=Ra.limit_max_x;La.limit_min_x=Ra.limit_min_x;La.limit_max_y=Ra.limit_max_y;La.limit_min_y=Ra.limit_min_y;La.limit_max_z=Ra.limit_max_z;La.limit_min_z=Ra.limit_min_z;La.limit_angle_max_x=Ra.limit_angle_max_x;La.limit_angle_min_x=Ra.limit_angle_min_x;La.limit_angle_max_y=Ra.limit_angle_max_y;La.limit_angle_min_y=Ra.limit_angle_min_y;La.limit_angle_max_z=Ra.limit_angle_max_z;La.limit_angle_min_z=Ra.limit_angle_min_z;x(ic,hb,cb,Nb,ib,Ec,vc,La,null,null)}}}};a.GC=p;a.update=function(){for(var a=
0;a<aa.length;a++){var b=aa[a],c=b.l;if(c.Cf&&c.ao){var d=performance.now()/1E3-c.ao,d=Math.min(d,10/L.Hd),d=d-1/L.Hd;R.HE&&(d=0);var e=fa;C.ZD(c.bo,d,c.Fv,c.as,fa);h.YF(b,e);h.B(b);u(b);if(b.i)for(var c=b,d=c.i.Qg,e=c.d.Fb,f=fa,k=0;k<d.length;k++){var q=d[k];C.multiply(e,c.i.Lj[k],f);h.pm(q,f);h.B(q)}b.i&&b.i.qi&&(c=b.i,d=c.qi)&&(e=b.i.Jx,q=ba,f=b.d.g,k=b.d.quat,I.Pq(b.i.Kx,k,f,q),I.Rh(q,d.d.g),I.of(q,d.d.quat),q=ea,I.Qq(e,k,f,q),e=la,g.setAxisAngle(q,-c.pi*c.Eq*2*Math.PI,e),g.multiply(e,d.d.quat,
d.d.quat),h.B(d));b.i&&b.i.Bq&&(c=b.i,d=c.Bq)&&(f=b.i.Ex,e=ba,k=b.d.g,q=b.d.quat,I.Pq(b.i.Fx,q,k,e),I.Rh(e,d.d.g),I.of(e,d.d.quat),e=ea,I.Qq(f,q,k,e),f=la,k=Math.abs(c.speed)*c.Dx,k>c.Bp&&(k=c.Bp),g.setAxisAngle(e,-k,f),g.multiply(f,d.d.quat,d.d.quat),h.B(d));b.i&&b.i.Iq&&(c=b.i,d=c.Iq)&&(e=b.i.Qx,q=ba,f=b.d.g,k=b.d.quat,I.Pq(b.i.Rx,k,f,q),I.Rh(q,d.d.g),I.of(q,d.d.quat),b=ea,I.Qq(e,k,f,b),e=la,g.setAxisAngle(b,-Math.abs(c.Dh)*c.xt,e),g.multiply(e,d.d.quat,d.d.quat),h.B(d))}}if(a=X)a=J.la(a,"MAIN_OPAQUE"),
a.ab&&0<a.ab.waves_height&&(b=w.length(a.ik),B.s(B.Ez,a.time*b))};a.aD=function(){return X};a.pause=function(){X&&B.s(B.rz)};a.od=function(){X&&B.s(B.uz)};a.Et=function(a){a=a.l;if(!a)throw"No object physics";if(!a.Cf){var b=a.P;a.Cf=!0;B.s(B.pz,b)}};a.cl=function(a){a=a.l;if(!a)throw"No object physics";if(a.Cf){var b=a.P;a.Cf=!1;B.s(B.oz,b)}};a.w=function(a){return a.l?!0:!1};a.cv=function(a){return(a=a.l)&&a.Cf&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.yp&&0==a.Al?!0:!1};a.Zo=function(a){return(a=
a.l)&&a.Cf?!0:!1};a.fx=function(a,b){B.s(B.Dz,a.l.P,b)};a.SD=m;a.hs=x;a.Us=function(a){a=a.l;B.s(B.tz,a.Uk);a.Uk=null};a.yw=function(b,c,d,e,g,f){c=C.xh(c,1,d,fa);g=C.xh(g,1,f,ma);C.invert(c,c);C.multiply(g,c,c);h.Qo(e,g);C.multiply(g,c,c);h.pm(b,c);h.B(b);a.om(b,b.d.g,b.d.quat)};a.om=function(a,b,c){C.Wj(a.d.g,1,a.d.quat,a.l.bo);var d=B.vu(B.rk);d.body_id=a.l.P;d.trans=b;d.quat=c;B.s(B.rk,d)};a.S=u;a.os=function(a,b,c,d){y(a,b,c,d,z);a=a.l.P;B.s(B.be,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);
var e=Math.abs(z[0]),g=Math.abs(z[1]),h=Math.abs(z[2]);z[0]=e?z[0]/e*Math.max(e,b):0;z[1]=g?z[1]/g*Math.max(g,c):0;z[2]=h?z[2]/h*Math.max(h,d):0;B.s(B.Kr,a,z[0],z[1],z[2])};a.ps=function(a,b,c,d){a=a.l.P;B.s(B.be,a);B.s(B.Kr,a,b,c,d)};a.js=function(a,b,c,d){y(a,b,c,d,z);a=a.l.P;B.s(B.be,a);B.s(B.hz,a,z[0],z[1],z[2])};a.ns=function(a,b,c,d){y(a,b,c,d,z);a=a.l.P;B.s(B.be,a);B.s(B.jz,a,z[0],z[1],z[2])};a.jq=function(a,b,c){a=a.l.P;B.s(B.be,a);B.s(B.xz,a,b,c)};a.mm=function(a,b){B.s(B.yz,a.l.P,b)};a.Yw=
function(a,b){B.s(B.Cz,a.l.P,b)};a.Xw=function(a,b){B.s(B.Az,a.l.P,b)};a.Uw=function(a,b){B.s(B.vz,a.l.P,b)};a.Ns=function(a){B.s(B.kz,a.l.P)};a.Os=function(a,b,c){B.s(B.lz,a.l.P,b,c)};a.nm=function(a,b,c){B.s(B.zz,a.l.P,b,c)};a.Vw=function(a,b){B.s(B.wz,a.l.P,b)};a.Ww=function(a,b){B.s(B.Bz,a.l.P,b)};a.TJ=function(){return!1};a.PJ=function(){return!1};a.KJ=function(){F.error("check_collision() deprecated");return!1};a.LJ=function(){F.error("check_collision_any() deprecated");return!1};a.QJ=function(){F.error("check_ray_hit() deprecated");
return!1};a.dO=function(){F.error("update_object_coords() deprecated")};a.mn=function(a,b,c,d){var e=a.l,g=e.P;b=b||"ANY";for(var h=0;h<e.xd.length;h++){var f=e.xd[h];if(f.zc==b&&f.callback==c)return}h=[];a=a.l.P;f=[];K(b,X,f,null);for(var k=0;k<f.length;k++){var q=f[k];a<q?h.push([a,q]):a>q&&h.push([q,a])}f={zc:b,callback:c,Wl:h,ow:new Uint8Array(h.length),Gp:d||!1};e.xd.push(f);B.s(B.be,g);B.s(B.bz,h,d)};a.dq=function(a,b,c){a=a.l;b=b||"ANY";for(var d=0;d<a.xd.length;d++){var e=a.xd[d];if(e.zc==
b&&e.callback==c){a.xd.splice(d,1);d--;for(var e=e.Wl,g=X.l.p,h=0;h<g.length;h++)for(var f=g[h].Db,k=0;k<f.xd.length;k++)for(var q=f.xd[k],n=0;n<q.Wl.length;n++)for(var m=q.Wl[n],l=0;l<e.length;l++){var t=e[l];m[0]===t[0]&&m[1]===t[1]&&(e.splice(l,1),l--)}e.length&&B.s(B.sz,e)}}};a.pn=function(a,b){var c=a.l;c?(B.s(B.iz,c.P),c.Sk=b):F.error("Object "+a.name+" has no physics")};a.Ln=function(a){var b=a.l;b?(B.s(B.mz,b.P),b.Sk=null):F.error("Object "+a.name+" has no physics")};a.on=function(a,b,c,d,
e,g){var h=a.l;if(h){a=h.P;b=b||"ANY";c={N:new Float32Array(c),ha:new Float32Array(d),local:e,callback:g,zc:b,De:{}};K(b,X,null,c.De);delete c.De[a];for(var f in c.De)c.De[f]=1;h.uf.push(c);G(a,h.uf)}else F.error("Object "+a.name+" has no physics")};a.eq=function(a,b,c,d,e){if(b=a.l){a=b.P;for(var g=0;g<b.uf.length;g++){var h=b.uf[g];I.Rk(h.N,c)&&I.Rk(h.ha,d)&&h.local==e&&(b.uf.splice(g,1),g--)}G(a,b.uf)}else F.error("Object "+a.name+" has no physics")};a.Ci=function(a,b){var c=a.i;c.Dh=b;A(a,c)};
a.Bi=function(a,b){var c=a.i;c.pi=b;A(a,c)};a.ar=function(a,b){var c=a.i;c.Ni=b;A(a,c)};a.mc=n;a.nc=q;a.cE=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.bE=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.eE=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.tv=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==
a.b4w_vehicle_settings.part?!0:!1};a.sv=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.uv=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Nu=function(a){return a.i.speed};a.AH=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.oj=c;a.fM=P;a.vD=function(){return U};a.aC=function(){B.s(B.nz)};a.jF=function(a){var b=aa.indexOf(a);
-1!=b?(aa.splice(b,1),a.l&&delete T[a.l.P]):F.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__ipc=function(a){a.Fy=0;var v=a.yy=1;a.zy=2;a.By=3;a.Cy=4;a.Dy=5;a.Gy=6;var d=a.Iy=7,b=a.Jy=8,p=a.Ky=9;a.Ly=10;a.Hy=11;a.Ey=12;a.Ay=13;a.qz=100;a.be=101;a.Vy=102;a.Wy=103;a.Xy=104;a.Zy=105;a.Yy=106;a.$y=107;a.az=108;a.bz=109;a.cz=110;a.dz=111;a.ez=112;a.fz=113;a.gz=114;a.hz=115;a.iz=116;a.jz=117;a.kz=118;a.lz=119;a.mz=120;a.oz=121;a.pz=122;a.rz=123;a.Jr=124;a.sz=125;a.tz=126;a.uz=127;a.vz=128;a.wz=129;a.xz=130;a.yz=131;a.zz=132;a.Az=133;a.Bz=134;a.Cz=135;a.Dz=136;a.Kr=137;var e=a.rk=138;
a.Ez=139;a.Ir=140;a.Fz=141;a.Gz=142;a.VI=143;a.nz=144;var f=null,r={msg_id:p,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),qc:new Float32Array(16)};r.qc[0]=p;var l={msg_id:d,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),qc:new Float32Array(10)};l.qc[0]=d;var t={msg_id:b,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0,qc:new Float32Array(11)};
t.qc[0]=b;var m={msg_id:v,body_id_a:0,body_id_b:0,result:0,coll_point:new Float32Array(3),qc:new Float32Array(7)};m.qc[0]=v;var x={msg_id:e,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),qc:new Float32Array(9)};x.qc[0]=e;a.Qb=function(a,y){a.addEventListener("message",function(a){a=a.data;var f=a[0]|0;switch(f){case p:var u=r;u.body_id=a[1];u.time=a[2];u.trans[0]=a[3];u.trans[1]=a[4];u.trans[2]=a[5];u.quat[0]=a[6];u.quat[1]=a[7];u.quat[2]=a[8];u.quat[3]=a[9];u.linvel[0]=a[10];u.linvel[1]=
a[11];u.linvel[2]=a[12];u.angvel[0]=a[13];u.angvel[1]=a[14];u.angvel[2]=a[15];break;case d:u=l;u.chassis_hull_body_id=a[1];u.prop_ind=a[2];u.trans[0]=a[3];u.trans[1]=a[4];u.trans[2]=a[5];u.quat[0]=a[6];u.quat[1]=a[7];u.quat[2]=a[8];u.quat[3]=a[9];break;case b:u=t;u.body_id=a[1];u.from[0]=a[2];u.from[1]=a[3];u.from[2]=a[4];u.to[0]=a[5];u.to[1]=a[6];u.to[2]=a[7];u.local=a[8];u.body_id_b_hit=a[9];u.cur_result=a[10];break;case v:u=m;u.body_id_a=a[1];u.body_id_b=a[2];u.result=a[3];u.coll_point[0]=a[4];
u.coll_point[1]=a[5];u.coll_point[2]=a[6];break;case e:u=x;u.body_id=a[1];u.trans[0]=a[2];u.trans[1]=a[3];u.trans[2]=a[4];u.quat[0]=a[5];u.quat[1]=a[6];u.quat[2]=a[7];u.quat[3]=a[8];break;default:u=a}y(f,u)},!1);f=a};a.Y=function(){f=null};a.s=function(){if(f){switch(arguments[0]|0){case p:var a=r,y=a.qc;y[1]=a.body_id;y[2]=a.time;y[3]=a.trans[0];y[4]=a.trans[1];y[5]=a.trans[2];y[6]=a.quat[0];y[7]=a.quat[1];y[8]=a.quat[2];y[9]=a.quat[3];y[10]=a.linvel[0];y[11]=a.linvel[1];y[12]=a.linvel[2];y[13]=
a.angvel[0];y[14]=a.angvel[1];y[15]=a.angvel[2];break;case d:a=l;y=a.qc;y[1]=a.chassis_hull_body_id;y[2]=a.prop_ind;y[3]=a.trans[0];y[4]=a.trans[1];y[5]=a.trans[2];y[6]=a.quat[0];y[7]=a.quat[1];y[8]=a.quat[2];y[9]=a.quat[3];break;case b:a=t;y=a.qc;y[1]=a.body_id;y[2]=a.from[0];y[3]=a.from[1];y[4]=a.from[2];y[5]=a.to[0];y[6]=a.to[1];y[7]=a.to[2];y[8]=a.local;y[9]=a.body_id_b_hit;y[10]=a.cur_result;break;case v:a=m;y=a.qc;y[1]=a.body_id_a;y[2]=a.body_id_b;y[3]=a.result;y[4]=a.coll_point[0];y[5]=a.coll_point[1];
y[6]=a.coll_point[2];break;case e:a=x;y=a.qc;y[1]=a.body_id;y[2]=a.trans[0];y[3]=a.trans[1];y[4]=a.trans[2];y[5]=a.quat[0];y[6]=a.quat[1];y[7]=a.quat[2];y[8]=a.quat[3];break;default:for(y=[],a=0;a<arguments.length;a++)y.push(arguments[a])}f.postMessage(y)}};a.vu=function(a){switch(a){case p:return r;case d:return l;case b:return t;case v:return m;case e:return x;default:return null}}};b4w.module.__renderer=function(a,v){function d(a){if(a){var b=(a.ja?A.COLOR_BUFFER_BIT:0)|(a.na?A.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=x;break;case "DEPTH":a=u;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=y;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=K;break;default:a=m.background_color}}else b=A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT,a=m.background_color;A.colorMask(!0,!0,!0,!0);A.depthMask(!0);
A.clearColor(a[0],a[1],a[2],a[3]);A.clear(b)}function b(a,b,d){A.bindBuffer(A.ARRAY_BUFFER,a.Lf);for(var e=0;e<b.length;e++){var f=b[e];A.enableVertexAttribArray(f.Eg);A.vertexAttribPointer(f.Eg,f.Jg,A.FLOAT,!1,0,f.BA+f.JC*d)}a.ve?(A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,a.ve),A.drawElements(a.mode,a.count,a.bp,0)):A.drawArrays(a.mode,0,a.count);for(e=0;e<b.length;e++)f=b[e],A.disableVertexAttribArray(f.Eg)}function p(a){switch(a){case 0:return A.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return A.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return A.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return A.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return A.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return A.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function e(a){var b=a.ck,d=[],e=[],f={},k;for(k in b){var n=!1;switch(k){case "u_proj_matrix":var m=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.va)},n=!0;break;case "u_view_matrix":case "u_view_matrix_frag":m=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.ma)};n=!0;break;case "u_shadow_cast_billboard_view_matrix":m=function(a,
b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.tx)};n=!0;break;case "u_view_proj_prev":m=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.bF)};n=!0;break;case "u_view_proj_inverse":m=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Ei)};n=!0;break;case "u_sky_vp_inverse":m=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Pd)};n=!0;break;case "u_camera_eye":case "u_camera_eye_frag":m=function(a,b,c,d,e,g){a.uniform3fv(b,g.ff)};n=!0;break;case "u_camera_eye_last":m=function(a,b,c,d,e,g){a.uniform3fv(b,g.Mt)};n=
!0;break;case "u_camera_quat":m=function(a,b,c,d,e,g){a.uniform4fv(b,g.quat)};n=!0;break;case "u_view_max_depth":m=function(a,b,c,d,e,g){a.uniform1f(b,g.ib)};n=!0;break;case "u_camera_range":m=function(a,b,c,d,e,g){a.uniform2f(b,g.Wa,g.ib)};break;case "u_csm_center_dists":m=function(a,b,c,d,e,g){a.uniform4fv(b,g.qt)};break;case "u_cam_water_depth":m=function(a,b,c){a.uniform1f(b,c.Hn)};n=!0;break;case "u_waves_height":m=function(a,b,c){a.uniform1f(b,c.Pf)};break;case "u_waves_length":m=function(a,
b,c){a.uniform1f(b,c.fh)};break;case "u_fog_color_density":m=function(a,b,c){a.uniform4fv(b,c.hc)};break;case "u_underwater_fog_color_density":m=function(a,b,c){a.uniform4fv(b,c.qd)};break;case "u_bloom_key":m=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":m=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":m=function(a,b,c){a.uniform1f(b,c.time)};n=!0;break;case "u_wind":m=function(a,b,c){a.uniform3fv(b,c.ik)};break;case "u_horizon_color":m=function(a,
b,c){a.uniform3fv(b,c.jf)};break;case "u_zenith_color":m=function(a,b,c){a.uniform3fv(b,c.Rf)};break;case "u_environment_energy":m=function(a,b,c){a.uniform1f(b,c.df)};break;case "u_sky_color":m=function(a,b,c){a.uniform3fv(b,c.hi)};break;case "u_rayleigh_brightness":m=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":m=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":m=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":m=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":m=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":m=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":m=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":m=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":m=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":m=function(a,b,c){a.uniform3fv(b,c.Cg)};break;case "u_light_directions":m=function(a,b,c){a.uniform3fv(b,c.Ag)};break;case "u_light_color_intensities":m=function(a,b,c){a.uniform3fv(b,c.zg)};break;case "u_light_factors":m=function(a,b,c){a.uniform4fv(b,c.Bg)};break;case "u_sun_quaternion":m=function(a,b,c){a.uniform4fv(b,c.Px)};break;case "u_sun_intensity":m=function(a,b,c){a.uniform3fv(b,c.Ox)};break;case "u_sun_direction":m=function(a,b,c){a.uniform3fv(b,c.Am)};break;case "u_height":m=
function(a,b,c,d,e,g){a.uniform1f(b,g.height)};n=!0;break;case "u_model_matrix":m=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.V)};n=!0;break;case "u_transb":m=function(a,b,c,d){a.uniform4fv(b,d.Rc)};n=!0;break;case "u_transa":m=function(a,b,c,d){a.uniform4fv(b,d.Qc)};n=!0;break;case "u_arm_rel_trans":m=function(a,b,c,d){a.uniform4fv(b,d.sn)};n=!0;break;case "u_arm_rel_quat":m=function(a,b,c,d){a.uniform4fv(b,d.rn)};n=!0;break;case "u_quat":m=function(a,b,c,d){a.uniform4fv(b,d.quat)};n=!0;break;case "u_quatsb":m=
function(a,b,c,d){a.uniform4fv(b,d.Jc)};n=!0;break;case "u_quatsa":m=function(a,b,c,d){a.uniform4fv(b,d.Ic)};n=!0;break;case "u_frame_factor":m=function(a,b,c,d){a.uniform1f(b,d.og)};n=!0;break;case "au_center_pos":m=function(){};n=!0;break;case "au_wind_bending_amp":m=function(a,b,c,d){a.uniform1f(b,d.Zd)};n=!0;break;case "au_wind_bending_freq":m=function(a,b,c,d){a.uniform1f(b,d.Qf)};n=!0;break;case "au_detail_bending_freq":m=function(a,b,c,d){a.uniform1f(b,d.af)};n=!0;break;case "au_detail_bending_amp":m=
function(a,b,c,d){a.uniform1f(b,d.$e)};n=!0;break;case "au_branch_bending_amp":m=function(a,b,c,d){a.uniform1f(b,d.Xe)};n=!0;break;case "u_node_values":m=function(a,b,c,d){a.uniform1fv(b,d.pf)};n=!0;break;case "u_node_rgbs":m=function(a,b,c,d){a.uniform3fv(b,d.Gd)};n=!0;break;case "u_diffuse_color":m=function(a,b,c,d,e){a.uniform4fv(b,e.Zc)};n=!0;break;case "u_diffuse_intensity":m=function(a,b,c,d,e){a.uniform1f(b,e.Xi)};n=!0;break;case "u_diffuse_params":m=function(a,b,c,d,e){a.uniform2fv(b,e.oe)};
n=!0;break;case "u_emit":m=function(a,b,c,d,e){a.uniform1f(b,e.Ch)};n=!0;break;case "u_ambient":m=function(a,b,c,d,e){a.uniform1f(b,e.kh)};n=!0;break;case "u_specular_color":m=function(a,b,c,d,e){a.uniform3fv(b,e.Yj)};n=!0;break;case "u_specular_alpha":m=function(a,b,c,d,e){a.uniform1f(b,e.ji)};n=!0;break;case "u_specular_params":m=function(a,b,c,d,e){a.uniform3fv(b,e.ki)};n=!0;break;case "u_reflect_factor":m=function(a,b,c,d,e){a.uniform1f(b,e.gm)};n=!0;break;case "u_mirror_factor":m=function(a,
b,c,d,e){a.uniform1f(b,e.Ep)};n=!0;break;case "u_grass_map_dim":m=function(a,b,c,d,e){a.uniform3fv(b,e.jc)};n=!0;break;case "u_grass_size":m=function(a,b,c,d,e){a.uniform1f(b,e.Ro)};n=!0;break;case "u_scale_threshold":m=function(a,b,c,d,e){a.uniform1f(b,e.Uu)};n=!0;break;case "u_cube_fog":m=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Ac)};break;case "u_jitter_amp":m=function(a,b,c,d,e){a.uniform1f(b,e.vv)};n=!0;break;case "u_jitter_freq":m=function(a,b,c,d,e){a.uniform1f(b,e.wv)};n=!0;break;case "u_wireframe_mode":m=
function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":m=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":m=function(a,b,c){a.uniform2fv(b,c.kE)};n=!0;break;case "u_subsample_indices":m=function(a,b,c){a.uniform4fv(b,c.lE)};n=!0;break;case "u_refr_bump":m=function(a,b,c,d,e){a.uniform1f(b,e.Gw)};n=!0;break;case "u_lamp_light_positions":m=function(a,b,c,d,e){a.uniform3fv(b,e.mp)};break;case "u_lamp_light_directions":m=function(a,
b,c,d,e){a.uniform3fv(b,e.kp)};break;case "u_lamp_light_color_intensities":m=function(a,b,c,d,e){a.uniform3fv(b,e.jp)};break;case "u_lamp_light_factors":m=function(a,b,c,d,e){a.uniform4fv(b,e.lp)};break;case "u_halo_size":m=function(a,b,c,d,e){a.uniform1f(b,e.Zu)};n=!0;break;case "u_halo_hardness":m=function(a,b,c,d,e){a.uniform1f(b,e.Wu)};n=!0;break;case "u_halo_rings_color":m=function(a,b,c,d,e){a.uniform3fv(b,e.Yu)};n=!0;break;case "u_halo_lines_color":m=function(a,b,c,d,e){a.uniform3fv(b,e.Xu)};
n=!0;break;case "u_halo_stars_blend":m=function(a,b,c,d,e){a.uniform1f(b,e.$u)};n=!0;break;case "u_halo_stars_height":m=function(a,b,c,d,e){a.uniform1f(b,e.av)};n=!0;break;case "u_fresnel_params":m=function(a,b,c,d,e){a.uniform4fv(b,e.qg)};n=!0;break;case "u_texture_scale":m=function(a,b,c,d,e){a.uniform3fv(b,e.Hf)};n=!0;break;case "u_parallax_scale":m=function(a,b,c,d,e){a.uniform1f(b,e.Xl)};n=!0;break;case "u_color_id":m=function(a,b,c,d){a.uniform3fv(b,d.Tk)};n=!0;break;case "u_line_points":m=
function(a,b,c,d,e){a.uniform3fv(b,e.oM)};n=!0;break;case "u_diffuse_color_factor":m=function(a,b,c,d,e){a.uniform1f(b,e.Wi)};n=!0;break;case "u_alpha_factor":m=function(a,b,c,d,e){a.uniform1f(b,e.Ki)};n=!0;break;case "u_specular_color_factor":m=function(a,b,c,d,e){a.uniform1f(b,e.Cx)};n=!0;break;case "u_normal_factor":m=function(a,b,c,d,e){a.uniform1f(b,e.Sv)};n=!0;break;case "u_normalmap0_scale":m=function(a,b,c,d,e){a.uniform2fv(b,e.Ig[0])};n=!0;break;case "u_normalmap1_scale":m=function(a,b,c,
d,e){a.uniform2fv(b,e.Ig[1])};n=!0;break;case "u_normalmap2_scale":m=function(a,b,c,d,e){a.uniform2fv(b,e.Ig[2])};n=!0;break;case "u_normalmap3_scale":m=function(a,b,c,d,e){a.uniform2fv(b,e.Ig[3])};n=!0;break;case "u_foam_factor":m=function(a,b,c,d,e){a.uniform1f(b,e.hl)};n=!0;break;case "u_foam_uv_freq":m=function(a,b,c,d,e){a.uniform2fv(b,e.Qt)};n=!0;break;case "u_foam_mag":m=function(a,b,c,d,e){a.uniform2fv(b,e.Pt)};n=!0;break;case "u_foam_scale":m=function(a,b,c,d,e){a.uniform2fv(b,e.zo)};n=!0;
break;case "u_water_norm_uv_velocity":m=function(a,b,c,d,e){a.uniform1f(b,e.Om)};n=!0;break;case "u_shallow_water_col":m=function(a,b,c,d,e){a.uniform3fv(b,e.qm)};n=!0;break;case "u_shore_water_col":m=function(a,b,c,d,e){a.uniform3fv(b,e.um)};n=!0;break;case "u_water_shallow_col_fac":m=function(a,b,c,d,e){a.uniform1f(b,e.rm)};n=!0;break;case "u_water_shore_col_fac":m=function(a,b,c,d,e){a.uniform1f(b,e.vm)};n=!0;break;case "u_p_length":m=function(a,b,c,d,e){a.uniform1f(b,e.gw)};n=!0;break;case "u_p_cyclic":m=
function(a,b,c,d,e){a.uniform1i(b,e.cw)};n=!0;break;case "u_p_max_lifetime":m=function(a,b,c,d,e){a.uniform1f(b,e.iw)};n=!0;break;case "u_p_fade_in":m=function(a,b,c,d,e){a.uniform1f(b,e.dw)};n=!0;break;case "u_p_fade_out":m=function(a,b,c,d,e){a.uniform1f(b,e.ew)};n=!0;break;case "u_p_size":m=function(a,b,c,d,e){a.uniform1f(b,e.Op)};n=!0;break;case "u_p_alpha_start":m=function(a,b,c,d,e){a.uniform1f(b,e.$v)};n=!0;break;case "u_p_alpha_end":m=function(a,b,c,d,e){a.uniform1f(b,e.Zv)};n=!0;break;case "u_p_nfactor":m=
function(a,b,c,d,e){a.uniform1f(b,e.Np)};n=!0;break;case "u_p_gravity":m=function(a,b,c,d,e){a.uniform1f(b,e.fw)};n=!0;break;case "u_p_mass":m=function(a,b,c,d,e){a.uniform1f(b,e.hw)};n=!0;break;case "u_p_size_ramp":m=function(a,b,c,d,e){a.uniform2fv(b,e.jw)};n=!0;break;case "u_p_color_ramp":m=function(a,b,c,d,e){a.uniform4fv(b,e.aw)};n=!0;break;case "u_p_wind":m=function(a,b,c,d,e){a.uniform3fv(b,e.Vl)};n=!0;break;case "u_texel_size":m=function(a,b,c,d,e){a.uniform2fv(b,e.Kq)};n=!0;break;case "u_p_time":m=
function(a,b,c,d,e){a.uniform1f(b,e.Hc.T.time)};n=!0;break;case "u_position":m=function(a,b,c,d,e){a.uniform3fv(b,e.Ij)};n=!0;break;case "u_va_frame_factor":m=function(a,b,c,d){a.uniform1f(b,d.gy)};n=!0;break;case "u_normal_offset":m=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":m=function(a,b,c,d,e,g){a.uniform4fv(b,g.am)};break;case "u_v_light_matrix":m=function(a,b,c){a.uniformMatrix4fv(b,!1,c.fy)};n=!0;break;case "u_b_light_matrix":m=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.ys)};break;case "u_p_light_matrix0":m=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Og[0])};n=!0;break;case "u_p_light_matrix1":m=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Og[1])};n=!0;break;case "u_p_light_matrix2":m=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Og[2])};n=!0;break;case "u_p_light_matrix3":m=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Og[3])};n=!0;break;case "u_motion_blur_exp":m=function(a,b,c){a.uniform1f(b,c.Mv)};n=!0;break;case "u_refl_plane":m=function(a,b,c){a.uniform4fv(b,c.rc)};
break;case "u_radial_blur_step":m=function(a,b,c){a.uniform1f(b,c.fm)};break;case "u_god_rays_intensity":m=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":m=function(a,b,c){a.uniform1f(b,c.oi)};break;case "u_ssao_blur_discard_value":m=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};n=!0;break;case "u_ssao_influence":m=function(a,b,c){a.uniform1f(b,c.ni)};break;case "u_ssao_dist_factor":m=function(a,b,c){a.uniform1f(b,c.mi)};break;case "u_dof_dist":m=
function(a,b,c,d,e,g){a.uniform1f(b,g.dof_distance)};n=!0;break;case "u_dof_front":m=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_front)};n=!0;break;case "u_dof_rear":m=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_rear)};n=!0;break;case "u_outline_intensity":m=function(a,b,c,d){a.uniform1f(b,d.Jd)};n=!0;break;case "u_outline_color":m=function(a,b,c){a.uniform3fv(b,c.sf)};break;case "u_draw_outline":m=function(a,b,c){a.uniform1f(b,c.no)};n=!0;break;case "u_brightness":m=function(a,b,c){a.uniform1f(b,c.brightness)};
break;case "u_contrast":m=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":m=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":m=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:m=null}m&&(m={name:k,Eo:m,Eg:b[k]},n?d.push(m):(e.push(m),f[k]=m))}a.Wx=d;a.Fj=e;a.Qp=f}var f=v("__config"),r=v("__debug"),l=v("__textures"),t=v("__util"),m=f.q,x=[1,1,1,1],u=[1,1,1,1],y=[0,0,0,1],K=[0,0,0,0],G=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);
new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var A=null,n=new Uint8Array(4);a.Lc=function(a){var b=m.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);A=a};a.Yi=function(a){if(a.aa){var c=a.j;A.bindFramebuffer(A.FRAMEBUFFER,c.re);if(a.un){var f=c.Ib;A.framebufferTexture2D(A.FRAMEBUFFER,
A.COLOR_ATTACHMENT0,f.Xb,f.$a,0)}A.viewport(0,0,c.width,c.height);d(a);a.Ka?A.enable(A.BLEND):A.disable(A.BLEND);a.Nb?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST);if(a.Ia){for(var c=a.j,f=a.p,l=0;l<f.length;l++){var t=f[l],k=t.o,x=k.tc;A.useProgram(x.Kj);t=t.sb;x.Fj.length||e(x);for(var x=x.Fj,u=x.length;u--;){var h=x[u];h.Eo(A,h.Eg,a,t,k,c)}}a.Ia=!1}switch(a.type){case "SHADOW_CAST":A.enable(A.POLYGON_OFFSET_FILL);A.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);A.cullFace(A.BACK);
break;case "MAIN_REFLECT":A.disable(A.POLYGON_OFFSET_FILL);A.cullFace(A.FRONT);break;default:A.disable(A.POLYGON_OFFSET_FILL),A.cullFace(A.BACK)}c=a.j;f=a.p;for(l=0;l<f.length;l++)if(x=f[l],x.aa){var k=a,t=c,h=x.sb,y=x.o,u=y.tc;A.useProgram(u.Kj);for(var x=y.da,v=y.ts,K=u.Wx,w=K.length;w--;){var g=K[w];g.Eo(A,g.Eg,k,h,y,t)}t=y.$s;A.colorMask(t,t,t,t);A.depthMask(y.Z);y.Fa?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE);t=y.X;for(y=0;y<t.length;y++)K=t[y],A.activeTexture(A.TEXTURE0+y),A.bindTexture(K.Xb,
K.$a);if("SKY"==k.type){t=k;u=u.ck;y=t.j.Ib.$a;K=t.rt;for(w=0;6>w;w++)if(g=p(w),m.Mn?(A.bindTexture(A.TEXTURE_CUBE_MAP,y),A.texImage2D(g,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,G)):(A.uniformMatrix4fv(u.u_cube_view_matrix,!1,K[w]),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,g,y,0),b(x,v,h.$q)),t.Ml&&3!=w){var g=t,M=w,L=n;m.Mn?L.set(G):(A.readPixels(191,191,1,1,A.RGBA,A.UNSIGNED_BYTE,L),255!=L[0]&&255!=L[1]&&255!=L[2]||A.readPixels(191,220,1,1,A.RGBA,A.UNSIGNED_BYTE,L));var R=L[0],U=L[1],
L=L[2],R=R/255,U=U/255,L=L/255;2===M?(g.Ac[3]=R,g.Ac[7]=U,g.Ac[11]=L):2>M?(g.Ac[4*M]=R,g.Ac[4*M+1]=U,g.Ac[4*M+2]=L):(g.Ac[4*(M-2)]=R,g.Ac[4*(M-2)+1]=U,g.Ac[4*(M-2)+2]=L)}k.Ti+=6}else b(x,v,h.$q),k.Ti++}r.aB("draw subscene: "+a.type);A.bindFramebuffer(A.FRAMEBUFFER,null)}};a.clear=function(a){A.bindFramebuffer(A.FRAMEBUFFER,a.j.re);d(a)};a.xA=function(a){var b=a.ts;b.length=0;var d=a.da;a=a.tc;d&&a||t.pa("Incomplete batch");d=d.ai;a=a.attributes;for(var e in a){var f=d[e];b.push({Eg:a[e],BA:4*f.offset,
JC:1<f.frames?4*f.length:0,Jg:f.Jg})}};a.AA=e;a.rs=function(a){var b=a.tc,d=a.X;a=a.ed;A.useProgram(b.Kj);for(var e=0;e<d.length;e++)A.uniform1i(b.ck[a[e]],e)};a.Fw=function(a,b,d,e,f,k){e||(e=1);f||(f=1);k||(k=new Uint8Array(4*e*f));k.length!=4*e*f&&t.pa("read_pixels(): Wrong storage");A.bindFramebuffer(A.FRAMEBUFFER,a);A.readPixels(b,d,e,f,A.RGBA,A.UNSIGNED_BYTE,k);A.bindFramebuffer(A.FRAMEBUFFER,null);return k};a.TG=function(a){var b=a.tc;A.useProgram(b.Kj);b.Fj.length||e(b);b=b.Qp.u_cube_fog;
b.Eo(A,b.Eg,null,null,a,null)};a.oF=function(a,b){var d=A.createFramebuffer();A.bindFramebuffer(A.FRAMEBUFFER,d);if(a){var e=a,f=e.$a,e=e.Xb==A.TEXTURE_CUBE_MAP?A.TEXTURE_CUBE_MAP_NEGATIVE_Z:e.Xb;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,e,f,0)}l.rv(b)?A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,b.Nf):l.tj(b)&&(e=b,f=e.$a,e=e.Xb,A.framebufferTexture2D(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,e,f,0));r.VA();A.bindFramebuffer(A.FRAMEBUFFER,null);return d};a.nF=function(a,
b,d,e,f){null==a?(A.bindFramebuffer(A.FRAMEBUFFER,a),A.viewport(0,0,e,f),A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT)):(l.tj(b)&&A.deleteTexture(b.$a),l.rv(d)?A.deleteRenderbuffer(d.Nf):l.tj(d)&&A.deleteTexture(d.$a),A.deleteFramebuffer(a))};a.UL=function(){};a.Y=function(){}};b4w.module.__transform=function(a,v){function d(a,b){var c=a.d;c.g[0]=b[0];c.g[1]=b[1];c.g[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function b(a){var c=a.d;"CAMERA"==a.type&&e.Xq(a);f.XG(a,F);"CAMERA"==a.type&&e.VG(a);var d=c.g,h=c.scale,q=c.quat;x.Wj(d,h,q,c.Fb);var y=c.V;n.identity(y);n.fromQuat(q,y);"CAMERA"!=a.type&&u.zF(y,h,y);y[12]=d[0];y[13]=d[1];y[14]=d[2];n.invert(y,c.lv);a.C.length&&l.Vo(a)&&l.YG(a);c.Yb&&c.fb&&(p.Cn(c.Yb,y,c.fb),p.En(c.gd,y,c.Hb),
p.Dn(c.ag,c.Fb,c.bg),c.Mc&&t.hq(t.A()));switch(a.type){case "SPEAKER":m.pG(a,F);break;case "CAMERA":e.WG(a);t.ea()&&t.kl(t.A())==a&&m.pE(t.A(),d,q,F);break;case "LAMP":r.aH(a);t.ea()&&t.$G(a,t.A());break;case "EMPTY":a.field&&t.by(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!t.ea()||(d=t.A(),t.hq(d),t.CF(d));if("MESH"==a.type){h=a.modifiers;q=null;for(d=0;d<h.length;d++)y=h[d],"ARMATURE"==y.type&&(q=y.object);q&&(x.invert(q.d.Fb,O),x.multiply(O,c.Fb,O),K.set(O[0],O[1],O[2],O[3],c.sn),G.set(O[4],O[5],O[6],
O[7],c.rn))}a=a.Tc;for(d=0;d<a.length;d++)b(a[d]);c.Co=!0}var p=v("__boundings"),e=v("__camera"),f=v("__constraints"),r=v("__lights"),l=v("__particles"),t=v("__scenes"),m=v("__sfx"),x=v("__tsr"),u=v("__util"),y=v("vec3"),K=v("vec4"),G=v("quat"),A=v("mat3"),n=v("mat4"),q=new Float32Array(3),c=new Float32Array(4),P=new Float32Array(9),O=new Float32Array(8),F=0;a.an=0;a.vk=1;a.update=function(a){F=a};a.Nd=function(a,b){f.ue(a)==f.ae?x.WF(b,f.se(a)):a.d.g.set(b)};a.Fd=function(a,b){f.ue(a)==f.ae?y.copy(x.Mu(f.se(a)),
b):y.copy(a.d.g,b)};a.Ie=function(a,b){f.ue(a)==f.ae?x.pq(b,f.se(a)):a.d.quat.set(b)};a.hf=function(a,b){f.ue(a)==f.ae?G.copy(x.Bu(f.se(a)),b):G.copy(a.d.quat,b)};a.qq=function(a,b){if(f.ue(a)==f.ae){var d=u.ef(b,c);x.pq(d,f.se(a))}else u.ef(b,a.d.quat)};a.xf=function(a,b){f.ue(a)==f.ae?x.xf(b,f.se(a)):a.d.scale=b};a.lj=function(a){return f.ue(a)==f.ae?x.lj(f.se(a)):a.d.scale};a.Qo=function(a,b){if(f.ue(a)==f.ae)x.copy(f.se(a),b);else{var c=a.d;x.Wj(c.g,c.scale,c.quat,b)}};a.pm=function(a,b){f.ue(a)==
f.ae?x.copy(b,f.se(a)):d(a,b)};a.YF=d;a.Mo=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.ol=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,y.copy(b.Hb.F,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,y.transformMat4(c,b.V,c));return c};a.Gc=function(a,b,c,d){a=a.d;q[0]=b;q[1]=c;q[2]=d;b=A.fromMat4(a.V,P);
y.transformMat3(q,b,q);y.add(a.g,q,a.g)};a.B=b;a.distance=function(a,b){return y.dist(a.d.g,b.d.g)};a.NE=function(a,b){return y.dist(a.d.g,b)};a.wu=function(a){return{max_x:a.d.fb.max_x,min_x:a.d.fb.min_x,max_y:a.d.fb.max_y,min_y:a.d.fb.min_y,max_z:a.d.fb.max_z,min_z:a.d.fb.min_z}}};b4w.module.__loader=function(a,v){function d(d,e,c,f){var m=A,l=y.create(),k;for(k in e){var t=b(e[k]);(f&&t.kb||!d&&t.Eb)&&u(t);y.D(l,t)}for(k in e)for(t=e[k],t.name=k,d=0;d<t.K.length;d++)y.m(l,e[t.K[d]],t,null);e=b({name:"out",Ra:a.xy,gb:function(a,b,c,d,e){0===b.id&&(m.uw=!0);3!=b.status&&(b.status=2);b.Iv(b.id,!0);e(b,c);K.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},lb:5});var r=[];if(c)for(c=y.Gu(l),d=0;d<c.length;d++)r.push(y.qb(l,c[d]));else y.U(l,function(a,b){b.eb||r.push(b)});
y.D(l,e);for(d=0;d<r.length;d++)e.K.push(r[d].name),y.m(l,r[d],e,null);return l}function b(a){a.eb=a.eb||!1;a.Ra||0===a.Ra||(a.Ra=a.ud);a.K=a.K||[];a.pj=a.pj||!1;a.wq=a.wq||!1;a.lb=a.lb||0;a.kb=a.kb||!1;a.Eb=a.Eb||!1;a.status=0;a.sM=0;a.tp=0;a.eg=a.eg||null;return a}function p(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];y.qb(a.Sd,f).pj&&(y.Jf(a.Sd,f,function(d){var e=!0;y.Le(a.Sd,d,function(a,b){if(!b.pj)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=
d.length-1;0<=e;e--)b.splice(d[e],1);return c}function e(a){function b(c,d){var e=y.qb(a.Sd,c),f=y.qb(a.Sd,d),m=f.Ra-e.Ra;0==m&&(m=e.eb-f.eb);return m}var c=[],d=a.Ke,e=!1;do{var f=p(a,d);c.push.apply(c,d);0<f.length&&(e=!0);d=f}while(0<f.length);e&&c.sort(b);a.Ke=c;return a.Ke.length}function f(a,b,c){if(b.wq)return b.pj=!0,l(a,b),!1;if(!b.gb&&!b.dg&&!b.Oi)return l(a,b),!1;if(0==b.status&&(b.status++,b.gb))return b.gb(c,a,b,b.eg,l,t),!0;if(1==b.status){if(b.dg)return b.dg(c,a,b,b.eg,l,t),!0;b.status++}return 2==
b.status&&(b.status++,b.Oi)?(b.Oi(c,a,b,b.eg,l,t),!0):!1}function r(a){if(0==a.zm)return 100;var b=0;y.U(a.Sd,function(c,d){a.do_not_load_resources&&d.kb||(b+=d.tp*d.lb)});return G.trunc(100*b/a.zm)}function l(a,b){b.pj=!0;b.status=3;m(a,b,1)}function t(a,b,c){1>c?m(a,b,c):b.status++}function m(a,b,c){var d=A;if(b.gb||b.dg||b.Oi)if(b.tp=c,b=r(a),a.tt!=b||1==c)a.Cq(b,performance.now()-a.Sx),a.tt=b,d.xp=!0}function x(a,b){var c=null;y.U(a.Sd,function(a,d){if(d.name==b)return c=d,1});return c}function u(a){a.wq=
!0;a.tp=1}var y=v("__graph"),K=v("__print"),G=v("__util");a.ud=0;a.Pe=1;a.xy=2;var A=null;a.Eu=function(){return A};a.OB=function(){var a={Vd:[],co:0,fn:0,uw:!1,xp:!1};return A=a};a.WB=function(a,b,c,e,f,m,k,l){var t=A,h={id:t.Vd.length,status:0,r:b,zs:"",Iv:c||function(){},sp:l||!1,jO:m,Sx:0,tt:0,zm:0,gq:!1,Cq:e||function(){},at:f||function(){},Sd:null,Ke:null,$o:!1,Wo:!1,cp:!1};a=d(0===h.id,a,m,k);h.Sd=a;b=[];c=y.ID(a);for(e=0;e<c.length;e++)b.push(c[e]);h.Ke=b;y.U(a,function(a,b){!(b.gb||b.dg||
b.Oi)||h.do_not_load_resources&&b.kb||(h.zm+=b.lb)});t.Vd.push(h);t.fn++;return h.id};a.fH=function(b){var d=A;if(d&&0!=A.fn)if(d.xp)d.xp=!1;else{var c=performance.now();do{var m=d.Vd[d.co],l=b[m.id];if(3!=m.status)if(0==m.status&&(m.status=1,m.Sx=performance.now(),m.Cq(0,0)),e(m)){var t=m,k=t.Ke.length;do{var r=y.qb(t.Sd,t.Ke[0]),p=f(t,r,l);r.Ra==a.Pe&&(t.gq=!0);r=t.Ke.shift();t.Ke.push(r);k--}while(!p&&0!=k)}else m.at(l,m),m.status=3,d.fn--,t=m,t.Cq=null,t.at=null,t.Sd=null,t.Ke=null;d.uw&&(d.co=
(d.co+1)%d.Vd.length);if(m.gq){m.gq=!1;break}}while(16>performance.now()-c)}};a.PN=t;a.vx=function(a,b){var c=x(a,b);null!==c&&u(c)};a.KG=function(a){return a&&3==a.status};a.ye=function(a){var b=A;if(!b)return!1;a|=0;return b.Vd[a]&&(3==b.Vd[a].status||2==b.Vd[a].status)};a.Y=function(){A=null}};b4w.module.__primitives=function(a,v){function d(a,b,d,e){for(var f=[],l=[],p=[],A=[],n=2*d/(a-1),q=2*e/(b-1),c=0;c<a;c++)for(var v=-d+c*n,O=0;O<b;O++)if(l.push(v,0,-e+O*q),p.push(0,1,0),A.push(c/(a-1),O/(b-1)),c&&O){var F=c*b+O,k=F-1,B=(c-1)*b+O,J=B-1;f.push(F,k,B);f.push(k,J,B)}a=r.hd();a.a_position=new Float32Array(l);a.a_normal=new Float32Array(p);p=r.pb("GRID_PLANE");p.v[0]=a;p.G.a_texcoord=new Float32Array(A);p.fa=new Uint32Array(f);p.J=l.length/3;return p}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var d=[],f=[],l=0;l<b;l+=4){var p=a[l+1],v=a[l+2],A=a[l+3];e(a[l],f);e(p,f);e(v,f);e(A,f);d.push(l,l+1,l+2);d.push(l,l+2,l+3)}a=r.hd();a.a_position=new Float32Array(f);b=r.pb("FROM_QUADS");b.v[0]=a;b.fa=new Uint32Array(d);b.J=f.length/3;return b}function p(a,b){var d=3*b;return[a[d],a[d+1],a[d+2]]}function e(a,b){b.push(a[0],a[1],a[2])}var f=v("__geometry"),r=v("__util"),l=v("__config").q;a.TK=function(a){for(var b=r.pb("LINE"),d=[],e=0;e<2*a;e++)d.push(e);e=r.hd();e.a_point=
new Float32Array(d);b.v[0]=e;b.fa=new Uint32Array(d);b.J=2*a;return b};a.UK=function(a,b){var e=d(2,2,a,b);e.name="PLANE";return e};a.SK=d;a.YC=function(a,b,d){function e(a,b){return 1==a%2&&(0==b||b==A-1)||1==b%2&&(0==a||a==G-1)?!0:!1}var p=d/=Math.pow(2,a-1),v=d,G=b+1,A=b+1;b=[];d=[];for(var n=0,q=0,c=-1,P=[],O=0;O<a;O++){for(var F=2*p/(G-1),k=2*v/(A-1),B=[],J=[],h=0,C=0;C<G;C++){for(var I=-p+C*F,H=[],w=0;w<A;w++){var g=-v+w*k;if(I>-n&&I<n&&g>-q&&g<q)H.push(-1),h++;else{for(var M=null,L=0;L<P.length;L+=
3)if(I==P[L]&&g==P[L+1]){M=P[L+2];break}L=null!==M?M:c+1;e(C,w)?(H.push(-2),h++):(null==M&&(0==w||w==A-1||0==C||C==G-1?(M=O==a-1?F:2*F,B.push(I,g,L)):M=F,d.push(I,M,g),c++),H.push(L));if(C&&w)if(1==C)if(e(C-1,w)){if(1<w){var g=L-1,M=J[C-1][w+1],R=M-1;b.push(L,g,R)}else M=J[C-1][w+1],R=M-1;b.push(L,R,M)}else e(C,w)||(g=L-1,M=J[C-1][w],b.push(L,g,M));else if(C==G-1){if(!e(C,w))if(w==A-1)g=L-1,M=J[C-1][w-1],R=J[C-2][w],b.push(L,g,M),b.push(L,M,R);else{var g=L-1,M=J[C-1][w],R=M-1,U=M+1;b.push(L,g,R);
b.push(L,R,M);b.push(L,M,U);2==w&&(U=J[C-2][w-2],b.push(g,U,R))}}else 1==w?e(C,w-1)?(g=J[C-1][w],M=J[C-1][w-1],b.push(L,M,g)):(g=H[w-1],M=J[C-1][w],R=J[C-2][w-1],b.push(L,g,M),b.push(g,R,M)):w==A-1?e(C,w)||(g=H[w-1],M=J[C-1][w-1],R=J[C-2][w],b.push(L,g,M),b.push(L,M,R)):-1!=J[C-1][w]&&-1!=J[C-1][w-1]&&-1!=H[w-1]?(g=H[w-1],M=J[C-1][w],R=J[C-1][w-1],b.push(L,g,M),b.push(g,R,M),w==A-2&&e(C,w+1)&&(U=J[C-1][w+1],b.push(L,M,U))):w==A-2&&e(C,w+1)&&(M=J[C-1][w],U=J[C-1][w+1],b.push(L,M,U))}}J.push(H)}P=B;
n=p;q=v;p*=2;v*=2}2E4>n&&(a=-(2*n)/(G-1),d.push(-2E4,a,-2E4),d.push(-2E4,a,2E4),d.push(-n,a,-q),d.push(-n,a,q),d.push(2E4,a,-2E4),d.push(2E4,a,2E4),d.push(n,a,-q),d.push(n,a,q),L=c+1,b.push(L+3,L+2,L+1,L+2,L+0,L+1,L+6,L+4,L+2,L+4,L+0,L+2,L+5,L+7,L+1,L+7,L+3,L+1,L+5,L+4,L+7,L+7,L+4,L+6));a=r.hd();a.a_position=new Float32Array(d);p=r.pb("multigrid_plane");p.v[0]=a;p.fa=new Uint32Array(b);p.J=d.length/3;l.qy&&(f.Gq(p,1,!0),a.a_polyindex=f.Kt(p));return p};a.RK=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var d=[],f=[],l=0;l<b;l+=3){var p=a[l+1],v=a[l+2];e(a[l],f);e(p,f);e(v,f);d.push(l,l+1,l+2)}a=r.hd();a.a_position=new Float32Array(f);b=r.pb("FROM_TRIANGLES");b.v[0]=a;b.fa=new Uint32Array(d);b.J=f.length/3;return b};a.QK=b;a.VC=function(a){a=r.vH(a);var d=[];d.push(a[0],a[1],a[2],a[3]);d.push(a[0],a[3],a[5],a[4]);d.push(a[3],a[2],a[6],a[5]);d.push(a[1],a[7],a[6],a[2]);d.push(a[0],a[4],a[7],a[1]);d.push(a[4],a[5],a[6],a[7]);a=b(d);a.name="FRUSTUM";return a};a.jb=function(){var a=r.pb("FULLSCREEN_TRI"),
b=r.hd();b.a_position=new Float32Array([0,0,1,0,0,1]);a.v[0]=b;a.fa=new Uint32Array([0,1,2]);a.J=3;return a};a.WC=function(){var a=r.pb("FULLSCREEN_QUAD"),b=r.hd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.v[0]=b;a.fa=new Uint32Array([0,2,1,1,2,3]);a.J=4;return a};a.RC=function(){var a=r.pb("BILLBOARD"),b=r.hd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.v[0]=b;a.fa=new Uint32Array([0,2,1,0,3,2]);a.J=4;return a};a.SC=function(){var a=r.pb("CUBEMAP_BOARD"),b=r.hd();
b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.v[0]=b;a.fa=new Uint32Array([0,2,1,0,3,2]);a.J=4;return a};a.$t=function(a,b){var d=r.pb("UV_SPHERE"),l,y,v=[],G=[],A=[];for(y=0;8>=y;y++)for(l=0;16>=l;l++){var n=l/16,q=y/8;G.push(-a*Math.cos(2*n*Math.PI)*Math.sin(q*Math.PI)+b[0],a*Math.cos(q*Math.PI)+b[1],a*Math.sin(2*n*Math.PI)*Math.sin(q*Math.PI)+b[2])}for(y=n=0;8>y;y++)for(l=0;16>l;l++){var q=p(G,17*y+l+1),c=p(G,17*y+l),P=p(G,17*(y+1)+l),O=p(G,17*(y+1)+l+1);Math.abs(q[1])==a+b[1]?(e(q,v),
e(P,v),e(O,v),A.push(n,n+1,n+2),n+=3):Math.abs(P[1])==a+b[1]?(e(q,v),e(c,v),e(P,v),A.push(n,n+1,n+2),n+=3):(e(q,v),e(c,v),e(P,v),e(O,v),A.push(n,n+1,n+2),A.push(n,n+2,n+3),n+=4)}l={};l.a_position=v;G=f.OA(A,G,v);l.a_normal=f.NA(A,v,G);l.a_tangent=[];d.G.a_influence=[];d.G.a_color=[];d.G.a_texcoord=[];d.v[0]=l;d.fa=A;d.J=v.length/3;return d};a.Zt=function(a){var b=r.pb("INDEX"),d=r.hd();d.a_index=new Float32Array(a);for(var e=0;e<a;e++)d.a_index[e]=e;b.v[0]=d;b.fa=new Uint16Array(0);b.J=a;return b}};b4w.module.__reformer=function(a,v){function d(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a,b,d){d=d+">>"+a;d in K||(K[d]={Fq:[],Lw:"undefined",type:a});K[d].Fq.push(b.name)}function p(a,b){param_id in K||(K[param_id]={Fq:[],Lw:"deprecated",type:a});K[param_id].Fq.push(b.name)}function e(a,b){b||(b=a.name+"_COPY");var d=a.materials,e=a.submeshes;a.materials=null;a.submeshes=null;var c=t.fg(a);a.materials=d;a.submeshes=e;c.name=b;c.materials=a.materials.slice(0);c.submeshes=[];for(d=0;d<e.length;d++){var f=t.Qk(e[d]);c.submeshes.push(f)}return c}var f=
v("__boundings"),r=v("__curve"),l=v("__print"),t=v("__util"),m=v("vec3"),x=v("vec4"),u=v("quat"),y=v("mat4"),K={};a.WA=function(a){K={};var e=a.worlds;if(0==e.length){l.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var f={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};
e.push(f)}for(var e=a.worlds,m=0;m<e.length;m++){var f=e[m],c=f.b4w_shadow_settings;"csm_resolution"in c||(b("world",f,"b4w_shadow_settings.csm_resolution"),c.csm_resolution=2048);"self_shadow_polygon_offset"in c||(b("world",f,"b4w_shadow_settings.self_shadow_polygon_offset"),c.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in c||(b("world",f,"b4w_shadow_settings.self_shadow_normal_offset"),c.self_shadow_normal_offset=.01);"b4w_enable_csm"in c||(b("world",f,"b4w_shadow_settings.b4w_enable_csm"),
c.b4w_enable_csm=!1);"csm_num"in c||(b("world",f,"b4w_shadow_settings.csm_num"),c.csm_num=1);"csm_first_cascade_border"in c||(b("world",f,"b4w_shadow_settings.csm_first_cascade_border"),c.csm_first_cascade_border=10);"first_cascade_blur_radius"in c||(b("world",f,"b4w_shadow_settings.first_cascade_blur_radius"),c.first_cascade_blur_radius=3);"csm_last_cascade_border"in c||(b("world",f,"b4w_shadow_settings.csm_last_cascade_border"),c.csm_last_cascade_border=100);"last_cascade_blur_radius"in c||(b("world",
f,"b4w_shadow_settings.last_cascade_blur_radius"),c.last_cascade_blur_radius=1.5);"fade_last_cascade"in c||(b("world",f,"b4w_shadow_settings.fade_last_cascade"),c.fade_last_cascade=!0);"blend_between_cascades"in c||(b("world",f,"b4w_shadow_settings.blend_between_cascades"),c.blend_between_cascades=!0);c=f.b4w_ssao_settings;"dist_factor"in c||(b("world",f,"b4w_ssao_settings.dist_factor"),c.dist_factor=0,c.samples=16);"hemisphere"in c||(b("world",f,"b4w_ssao_settings.hemisphere"),c.hemisphere=!1);"blur_depth"in
c||(b("world",f,"b4w_ssao_settings.blur_depth"),c.blur_depth=!1);"blur_discard_value"in c||(b("world",f,"b4w_ssao_settings.blur_discard_value"),c.blur_discard_value=1);"use_sky_blend"in f||(b("world",f,"use_sky_blend"),f.use_sky_blend=!1);"use_sky_paper"in f||(b("world",f,"use_sky_paper"),f.use_sky_paper=!1);"use_sky_real"in f||(b("world",f,"use_sky_real"),f.use_sky_real=!1);"b4w_outline_color"in f||(f.b4w_outline_color="b4w_glow_color"in f?f.b4w_glow_color:[1,1,1],b("world",f,"b4w_outline_color"));
"b4w_outline_factor"in f||(f.b4w_outline_factor="b4w_glow_factor"in f?f.b4w_glow_factor:1,b("world",f,"b4w_outline_factor"));"b4w_fog_density"in f||(b("world",f,"b4w_fog_density"),f.b4w_fog_density=0);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,
mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"render_sky"in f.b4w_sky_settings||(b("world",f,"render_sky"),f.b4w_sky_settings.render_sky=!1);"b4w_bloom_settings"in f?("blur"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.blur"),f.b4w_bloom_settings.blur=4),"edge_lum"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.edge_lum"),f.b4w_bloom_settings.edge_lum=1)):(b("world",f,"b4w_bloom_settings"),f.b4w_bloom_settings={key:.2,blur:4});
"b4w_motion_blur_settings"in f?("motion_blur_factor"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_factor"),f.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_decay_threshold"),f.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",f,"b4w_motion_blur_settings"),f.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in f||(b("world",f,"b4w_color_correction_settings"),f.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in f.b4w_god_rays_settings||(b("world",f,"b4w_god_rays_settings.steps_per_pass"),f.b4w_god_rays_settings.steps_per_pass=10)}e=a.scenes;for(m=0;m<e.length;m++)f=e[m],"b4w_use_nla"in f||(f.b4w_use_nla=!1,b("scene",f,"b4w_use_nla")),"fps"in f||(f.fps=24,b("scene",f,"fps")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,b("scene",
f,"b4w_nla_cyclic")),"b4w_nla_script"in f||(f.b4w_nla_script=[],b("scene",f,"b4w_nla_script")),"b4w_detect_collisions"in f&&(p("scene",f),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,b("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,b("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=!1,b("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=!0,b("scene",f,"b4w_enable_antialiasing")),"b4w_tags"in f||(f.b4w_tags={title:"",description:""},b("scene",f,"b4w_tags")),"b4w_enable_object_selection"in
f||(f.b4w_enable_object_selection="AUTO",b("scene",f,"b4w_enable_object_selection")),"b4w_enable_outlining"in f||(f.b4w_enable_outlining="AUTO",b("scene",f,"b4w_enable_outlining"));f=a.meshes;for(m=0;m<f.length;m++){c=f[m];c.b4w_bounding_box||(b("mesh",c,"b4w_bounding_box"),c.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});c.uv_textures||(b("mesh",c,"uv_textures"),c.uv_textures=[]);c.b4w_bounding_sphere_center||(c.b4w_bounding_sphere_center=[0,0,0]);c.b4w_bounding_cylinder_center||
(c.b4w_bounding_cylinder_center=[0,0,0]);c.b4w_bounding_ellipsoid_center||(c.b4w_bounding_ellipsoid_center=[0,0,0]);c.b4w_bounding_ellipsoid_axes||(e=c.b4w_bounding_box,c.b4w_bounding_ellipsoid_axes=[(e.max_x-e.min_x)/2,(e.max_y-e.min_y)/2,(e.max_z-e.min_z)/2]);"b4w_shape_keys"in c||(c.b4w_shape_keys=[],b("mesh",c,"b4w_shape_keys"));for(var e=c,r=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],x=null,u=0;u<r.length;u++)e[r[u]]&&(x?
(e[r[u]]=!1,l.warn('WARNING property "'+r[u]+'" of object "'+e.name+'" has been set to "false". Foreground property "'+x+'" already exists.')):x=r[u]);for(e=0;e<c.b4w_vertex_anim.length;e++)r=c.b4w_vertex_anim[e],"allow_nla"in r||(b('mesh["b4w_vertex_anim"]',c,"allow_nla"),r.allow_nla=!0)}e=a.cameras;for(m=0;m<e.length;m++)f=e[m],f.type||(f.type="PERSP",b("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,p("camera",f)),"b4w_trans_velocity"in f||(f.b4w_trans_velocity=1,b("camera",
f,"b4w_trans_velocity")),"b4w_rot_velocity"in f||(f.b4w_rot_velocity=1,b("camera",f,"b4w_rot_velocity")),"b4w_zoom_velocity"in f||(f.b4w_zoom_velocity=.1,b("camera",f,"b4w_zoom_velocity")),"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,b("camera",f,"b4w_use_distance_limits")),"b4w_distance_min"in f||(f.b4w_distance_min=1,b("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,b("camera",f,"b4w_distance_max")),"b4w_horizontal_translation_min"in f||(f.b4w_horizontal_translation_min=
-100,b("camera",f,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in f||(f.b4w_horizontal_translation_max=100,b("camera",f,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in f||(f.b4w_vertical_translation_min=-100,b("camera",f,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in f||(f.b4w_vertical_translation_max=100,b("camera",f,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in f||(f.b4w_use_horizontal_clamping=!1,b("camera",f,"b4w_use_horizontal_clamping")),
"b4w_rotation_left_limit"in f||(f.b4w_rotation_left_limit=-Math.PI,b("camera",f,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in f||(f.b4w_rotation_right_limit=Math.PI,b("camera",f,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in f||(f.b4w_horizontal_clamping_type="LOCAL",b("camera",f,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,b("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=
-Math.PI/2,b("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in f||(f.b4w_rotation_up_limit=Math.PI/2,b("camera",f,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in f||(f.b4w_vertical_clamping_type="LOCAL",b("camera",f,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in f||(f.b4w_hover_angle_min=Math.PI/6,b("camera",f,"b4w_hover_angle_min")),"b4w_hover_angle_max"in f||(f.b4w_hover_angle_max=Math.PI/6,b("camera",f,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in f||
(f.b4w_enable_hover_hor_rotation=!0,b("camera",f,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in f||(f.b4w_use_panning=!0,b("camera",f,"b4w_use_panning"));e=a.lamps;for(m=0;m<e.length;m++)f=e[m],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,b("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=!1,b("lamp",f,"b4w_dynamic_intensity")),"use_diffuse"in f||(f.use_diffuse=!0,b("lamp",f,"use_diffuse")),"use_specular"in f||(f.use_specular=!0,b("lamp",f,"use_specular"));
e=a.speakers;for(m=0;m<e.length;m++)f=e[m],"b4w_behavior"in f||(f.b4w_behavior=f.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in f||(f.b4w_disable_doppler=!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=!1),"b4w_loop_count"in f||(f.b4w_loop_count=
0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in f||(f.b4w_playlist_id="");e=a.textures;for(m=0;m<e.length;m++)f=e[m],"b4w_anisotropic_filtering"in f||(f.b4w_anisotropic_filtering="OFF",b("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,b("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=[1,1],b("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=[1,1],b("texture",f,"b4w_foam_uv_magnitude")),
"b4w_parallax_steps"in f||(f.b4w_parallax_steps=5,b("material",f,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in f||(f.b4w_parallax_lod_dist=10,b("material",f,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,b("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=100,b("texture",f,"b4w_max_shore_dist")),
"b4w_disable_compression"in f||(f.b4w_disable_compression=!1,b("texture",f,"b4w_disable_compression")),"b4w_source_type"in f||(f.b4w_source_type="",b("texture",f,"b4w_source_type")),"b4w_source_id"in f||(f.b4w_source_id="",b("texture",f,"b4w_source_id")),"b4w_source_size"in f||(f.b4w_source_size=1024,b("texture",f,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in f||(f.b4w_enable_canvas_mipmapping=!0,b("texture",f,"b4w_enable_canvas_mipmapping"));f=a.materials;for(m=0;m<f.length;m++){c=f[m];"b4w_node_mat_type"in
c&&p("material",c);"b4w_skydome"in c&&p("material",c);"b4w_procedural_skydome"in c&&p("material",c);c.b4w_water&&("b4w_water_shore_smoothing"in c||(c.b4w_water_shore_smoothing=!1,b("material",c,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in c||(c.b4w_water_dynamic=!1,b("material",c,"b4w_water_dynamic")),"b4w_waves_height"in c||(c.b4w_waves_height=1,b("material",c,"b4w_waves_height")),"b4w_waves_length"in c||(c.b4w_waves_length=1,b("material",c,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in
c||(c.b4w_water_dst_noise_scale0=.05,b("material",c,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in c||(c.b4w_water_dst_noise_scale1=.03,b("material",c,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in c||(c.b4w_water_dst_noise_freq0=1.3,b("material",c,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in c||(c.b4w_water_dst_noise_freq1=1,b("material",c,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in c||(c.b4w_water_dir_min_shore_fac=.4,b("material",c,
"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in c||(c.b4w_water_dir_freq=.5,b("material",c,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in c||(c.b4w_water_dir_noise_scale=.05,b("material",c,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in c||(c.b4w_water_dir_noise_freq=.07,b("material",c,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in c||(c.b4w_water_dir_min_noise_fac=.5,b("material",c,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in c||(c.b4w_water_dst_min_fac=
.2,b("material",c,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in c||(c.b4w_water_waves_hor_fac=5,b("material",c,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in c||(c.b4w_water_absorb_factor=6,b("material",c,"b4w_water_absorb_factor")),"b4w_water_fog_color"in c||(c.b4w_water_fog_color=new Float32Array(3),c.b4w_water_fog_color=[.5,.7,.7],b("material",c,"b4w_water_fog_color")),"b4w_foam_factor"in c||(c.b4w_foam_factor=5,b("material",c,"b4w_foam_factor")),"b4w_generated_mesh"in c||(c.b4w_generated_mesh=
!1,b("material",c,"b4w_generated_mesh")),"b4w_water_num_cascads"in c||(c.b4w_water_num_cascads=5,b("material",c,"b4w_water_num_cascads")),"b4w_water_subdivs"in c||(c.b4w_water_subdivs=64,b("material",c,"b4w_water_subdivs")),"b4w_water_detailed_dist"in c||(c.b4w_water_detailed_dist=1E3,b("material",c,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in c||(c.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in c||(c.b4w_dynamic_grass_color="");"diffuse_intensity"in c||(c.diffuse_intensity=1,b("material",
c,"diffuse_intensity"));"b4w_use_ghost"in c||(c.b4w_use_ghost=!1);"b4w_collision_group"in c||(c.b4w_collision_group=128,b("material",c,"b4w_collision_group"));"b4w_collision_mask"in c||(c.b4w_collision_mask=127,b("material",c,"b4w_collision_mask"));"b4w_do_not_render"in c||(c.b4w_do_not_render=!1,b("material",c,"b4w_do_not_render"));"HALO"!=c.type||"b4w_halo_sky_stars"in c||(c.b4w_halo_sky_stars=!1,b("material",c,"b4w_halo_sky_stars"));"HALO"!=c.type||"b4w_halo_stars_blend_height"in c||(c.b4w_halo_stars_blend_height=
10,b("material",c,"b4w_halo_stars_blend_height"));"HALO"!=c.type||"b4w_halo_stars_min_height"in c||(c.b4w_halo_stars_min_height=0,b("material",c,"b4w_halo_stars_min_height"));"specular_shader"in c||(c.specular_shader="COOKTORR",b("material",c,"specular_shader"));"diffuse_shader"in c||(c.diffuse_shader="LAMBERT",b("material",c,"diffuse_shader"));"roughness"in c||(c.roughness=.5,b("material",c,"roughness"));"diffuse_fresnel"in c||(c.diffuse_fresnel=.1,b("material",c,"diffuse_fresnel"));"diffuse_fresnel_factor"in
c||(c.diffuse_fresnel_factor=.5,b("material",c,"diffuse_fresnel_factor"));"specular_slope"in c||(c.specular_slope=.2,b("material",c,"specular_slope"));"specular_toon_size"in c||(c.specular_toon_size=.5,b("material",c,"specular_toon_size"));"specular_toon_smooth"in c||(c.specular_toon_smooth=.1,b("material",c,"specular_toon_smooth"));"specular_alpha"in c||(c.specular_alpha=1,b("material",c,"specular_alpha"));"b4w_wettable"in c||(c.b4w_wettable=!1,b("material",c,"b4w_wettable"));"b4w_refractive"in c||
(c.b4w_refractive=!1,b("material",c,"b4w_refractive"));"b4w_refr_bump"in c||(c.b4w_refr_bump=0,b("material",c,"b4w_refr_bump"));"b4w_shallow_water_col"in c||(c.b4w_shallow_water_col=[0,.8,.3],b("material",c,"b4w_shallow_water_col"));"b4w_shore_water_col"in c||(c.b4w_shore_water_col=[0,.9,.2],b("material",c,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in c||(c.b4w_shallow_water_col_fac=1,b("material",c,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in c||(c.b4w_shore_water_col_fac=.5,
b("material",c,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in c||(c.b4w_water_sss_strength=5.9,b("material",c,"b4w_water_sss_strength"));"b4w_water_sss_width"in c||(c.b4w_water_sss_width=.45,b("material",c,"b4w_water_sss_width"));"b4w_render_above_all"in c||(c.b4w_render_above_all=!1,b("material",c,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in c||(c.b4w_water_norm_uv_velocity=.05,b("material",c,"b4w_water_norm_uv_velocity"));r=c.texture_slots;for(e=0;e<r.length;e++)x=r[e],"blend_type"in
x||(x.blend_type="MIX",b("texture_slot",x,"blend_type"));if(c.node_tree)for(c=c.node_tree.nodes,e=0;e<c.length;e++)d(c[e])}f=a.node_groups;for(m=0;m<f.length;m++)for(c=f[m].node_tree.nodes,e=0;e<c.length;e++)d(c[e]);f=a.objects;for(m=0;m<f.length;m++){c=f[m];switch(c.type){case "MESH":"b4w_dynamic_geometry"in c||(c.b4w_dynamic_geometry=!1);"b4w_reflexible"in c||(c.b4w_reflexible=!1);"b4w_reflexible_only"in c||(c.b4w_reflexible_only=!1);"b4w_reflective"in c||(c.b4w_reflective=!1);"b4w_wind_bending"in
c||(c.b4w_wind_bending=!1,b("object",c,"b4w_wind_bending"));"b4w_wind_bending_angle"in c||(c.b4w_wind_bending_angle=10,c.b4w_wind_bending_freq=.25,b("object",c,"wind bending params"));"b4w_detail_bending_amp"in c||(c.b4w_detail_bending_amp=.1,c.b4w_branch_bending_amp=.3,b("object",c,"detail bending params"));"b4w_detail_bending_freq"in c||(c.b4w_detail_bending_freq=1,b("object",c,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in c||(c.b4w_main_bend_stiffness_col="",b("object",c,"b4w_main_bend_stiffness_col"));
"b4w_detail_bend_colors"in c||(c.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",c,"b4w_detail_bend_colors"));"b4w_caustics"in c||(c.b4w_caustics=!1);"vertex_groups"in c&&c.vertex_groups.length&&c.data&&0==c.data.vertex_groups.length&&(c.data.vertex_groups=c.vertex_groups,delete c.vertex_groups,b("object",c,"vertex_groups"));"b4w_vertex_anim"in c&&c.b4w_vertex_anim.length&&c.data&&0==c.data.b4w_vertex_anim.length&&(c.data.b4w_vertex_anim=c.b4w_vertex_anim,
delete c.b4w_vertex_anim,b("object",c,"b4w_vertex_anim"));"b4w_do_not_render"in c||(c.b4w_do_not_render=!1);"use_ghost"in c.game||(c.game.use_ghost=!1);"use_sleep"in c.game||(c.game.use_sleep=!1);"velocity_min"in c.game||(c.game.velocity_min=0);"velocity_max"in c.game||(c.game.velocity_max=0);"collision_group"in c.game||(c.game.collision_group=1);"collision_mask"in c.game||(c.game.collision_mask=255);"b4w_vehicle_settings"in c?c.b4w_vehicle_settings&&("steering_ratio"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.steering_ratio=
10),"steering_max"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.steering_max=1),"inverse_control"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.inverse_control=!1),"force_max"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.force_max=1500),"brake_max"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.brake_max=100),"speed_ratio"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.max_speed_angle=Math.PI),
"delta_tach_angle"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in c.b4w_vehicle_settings||
(c.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.floating_factor=3),"floating_factor"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.water_rot_damp=.9)):(c.b4w_vehicle_settings=
null,b("object",c,"b4w_vehicle_settings"));"b4w_floating_settings"in c?c.b4w_floating_settings&&("floating_factor"in c.b4w_floating_settings||(c.b4w_floating_settings.floating_factor=3),"water_lin_damp"in c.b4w_floating_settings||(c.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in c.b4w_floating_settings||(c.b4w_floating_settings.water_rot_damp=.8)):(c.b4w_floating_settings=null,b("object",c,"b4w_floating_settings"));"b4w_character_settings"in c?c.b4w_character_settings&&("walk_speed"in
c.b4w_character_settings||(c.b4w_character_settings.walk_speed=4),"run_speed"in c.b4w_character_settings||(c.b4w_character_settings.run_speed=8),"step_height"in c.b4w_character_settings||(c.b4w_character_settings.step_height=.25),"jump_strength"in c.b4w_character_settings||(c.b4w_character_settings.jump_strength=5),"waterline"in c.b4w_character_settings||(c.b4w_character_settings.waterline=0)):(c.b4w_character_settings=null,b("object",c,"b4w_character_settings"));"b4w_selectable"in c||(c.b4w_selectable=
!1,b("object",c,"b4w_selectable"));"b4w_outlining"in c||(c.b4w_outlining=!1,b("object",c,"b4w_outlining"));"b4w_outline_on_select"in c||(c.b4w_outline_on_select=!1,b("object",c,"b4w_outline_on_select"));"b4w_billboard"in c||(c.b4w_billboard=!1,b("object",c,"b4w_billboard"));"b4w_billboard_geometry"in c||(c.b4w_billboard_geometry="SPHERICAL",b("object",c,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in c||(c.b4w_pres_glob_orientation=!1,b("object",c,"b4w_pres_glob_orientation"));"b4w_outline_settings"in
c||("b4w_glow_settings"in c?c.b4w_outline_settings=c.b4w_glow_settings:(c.b4w_outline_settings={},c.b4w_outline_settings.outline_duration=1,c.b4w_outline_settings.outline_period=1,c.b4w_outline_settings.outline_relapses=0),b("object",c,"b4w_outline_settings"));"b4w_lod_transition"in c||(c.b4w_lod_transition=.01,b("object",c,"b4w_lod_transition"));"lod_levels"in c||(c.lod_levels=[],b("object",c,"lod_levels"));"b4w_animation_mixing"in c||(c.b4w_animation_mixing=!1,b("object",c,"b4w_animation_mixing"));
break;case "EMPTY":"b4w_group_relative"in c||(c.b4w_group_relative=!1,b("object",c,"b4w_group_relative")),"b4w_anchor"in c||(c.b4w_anchor=null,b("object",c,"b4w_anchor")),!c.b4w_anchor||"max_width"in c.b4w_anchor||(c.b4w_anchor.max_width=250)}"b4w_anim_behavior"in c||(c.b4w_anim_behavior=c.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",c,"b4w_anim_behavior"));if(!("rotation_quaternion"in c)){e=[0,0,0,1];t.ef(c.rotation_euler,e);var r=e,x=e[0],u=e[1],k=e[2];r[0]=e[3];r[1]=x;r[2]=u;r[3]=k;c.rotation_quaternion=
e;b("object",c,"rotation_quaternion")}"webgl_do_not_batch"in c&&(c.b4w_do_not_batch=c.webgl_do_not_batch)&&p("object",c);"b4w_shadow_cast_only"in c||(c.b4w_shadow_cast_only=!1,b("object",c,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in c||(c.b4w_correct_bounding_offset="AUTO",b("object",c,"b4w_correct_bounding_offset"));r=c.particle_systems;for(e=0;e<r.length;e++)x=r[e],u=x.settings,"use_whole_group"in u||(u.use_whole_group=!1,b("object",u,"use_whole_group")),x.transforms||(x.transforms=
new Float32Array,b("particle_system",x,"transforms")),"b4w_billboard_align"in u||(u.b4w_billboard_align="VIEW",b("particle_settings",u,"b4w_billboard_align")),"b4w_dynamic_grass"in u||(u.b4w_dynamic_grass=!1,b("object",u,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in u||(u.b4w_dynamic_grass_scale_threshold=.01,b("object",u,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in u||(u.b4w_initial_rand_rotation=!1,b("particle_settings",u,"b4w_initial_rand_rotation")),"b4w_rotation_type"in
u||(u.b4w_rotation_type="Z",b("particle_settings",u,"b4w_rotation_type")),"b4w_rand_rotation_strength"in u||(u.b4w_rand_rotation_strength=1,b("particle_settings",u,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in u||(u.b4w_hair_billboard=!1,b("particle_settings",u,"b4w_hair_billboard")),"b4w_hair_billboard_type"in u||(u.b4w_hair_billboard_type="BASIC",b("particle_settings",u,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in u||(u.b4w_hair_billboard_jitter_amp=0,b("particle_settings",
u,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in u||(u.b4w_hair_billboard_jitter_freq=0,b("particle_settings",u,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in u||(u.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",u,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in u||(u.b4w_wind_bend_inheritance="PARENT",b("particle_settings",u,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in u||(u.b4w_shadow_inheritance="PARENT",b("particle_settings",
u,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in u||(u.b4w_reflection_inheritance="PARENT",b("particle_settings",u,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in u||(u.b4w_vcol_from_name="",b("particle_settings",u,"b4w_vcol_from_name")),"b4w_vcol_to_name"in u||(u.b4w_vcol_to_name="",b("particle_settings",u,"b4w_vcol_to_name")),"b4w_coordinate_system"in u||(u.b4w_coordinate_system="LOCAL",b("particle_settings",u,"b4w_coordinate_system")),"b4w_allow_nla"in u||(u.b4w_allow_nla=!0,b("particle_settings",
u,"b4w_allow_nla"));"constraints"in c||(c.constraints=[],b("object",c,"constraints"));r=c.modifiers;for(e=0;e<r.length;e++){a:{x=r[e];switch(x.type){case "ARRAY":if(!("fit_type"in x)){l.error("WARNING Incomplete modifier "+String(x.type)+' for "'+c.name+'", reexport "'+a.b4w_filepath_blend+'" scene');x=!1;break a}}x=!0}x||(r.splice(e,1),e--)}"animation_data"in c||(c.animation_data={action:null,nla_tracks:[]},b("object",c,"animation_data"));if(c.animation_data)for(("action"in c.animation_data)||(c.animation_data.action=
null,l.warn("no action in animation data "+c.name)),("nla_tracks"in c.animation_data)||(c.animation_data.nla_tracks=[],l.warn("no NLA in animation data "+c.name)),r=c.animation_data.nla_tracks,e=0;e<r.length;e++)for(x=r[e],u=0;u<x.strips.length;u++)k=x.strips[u],"action"in k||(k.action=null,l.warn("no action in NLA strip "+c.name)),"action_frame_start"in k||(k.action_frame_start=0,l.warn("no action_frame_start in NLA strip "+c.name)),"action_frame_end"in k||(k.action_frame_end=k.frame_end-k.frame_start,
l.warn("no action_frame_start in NLA strip "+c.name));"b4w_collision_id"in c||(c.b4w_collision_id="",b("material",c,"b4w_collision_id"));e=c.scale;0==e[0]&&0==e[1]&&0==e[2]?e=!0:(r=Math.abs((e[1]-e[2])/e[1]),e=.001>Math.abs((e[0]-e[1])/e[0])&&.001>r);e||l.warn("non-uniform scale for object "+c.name)}for(var y in K)m=K[y],e=y.match(/.*?(?=>>|$)/i)[0],l.warn("WARNING "+String(e)+" is "+m.Lw+" for "+m.type+", reexport "+a.b4w_filepath_blend)};a.SA=function(a,b){"num_channels"in a||(a.num_channels=1,
l.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.rA=function(a){var b;a:{b=a.modifiers;for(var d=0;d<b.length;d++){var q=b[d].type;if("ARRAY"==q||"CURVE"==q){b=!0;break a}}b=!1}if(!b)return null;b=e(a.data,a.data.name+"_MOD");a=a.modifiers;for(d=0;d<a.length;d++){var c=a[d];switch(c.type){case "ARRAY":for(var q=b,l=c,p=0,v=0,k=0,B=new Float32Array(16),c=[],K=1;K<l.count;K++){l.use_constant_offset&&(p+=l.constant_offset_displace[0],v+=l.constant_offset_displace[1],
k+=l.constant_offset_displace[2]);if(l.use_relative_offset)var h=q.b4w_bounding_box,p=p+(h.max_x-h.min_x)*l.relative_offset_displace[0],v=v+(h.max_y-h.min_y)*l.relative_offset_displace[1],k=k+(h.max_z-h.min_z)*l.relative_offset_displace[2];t.MG(p,v,k,B);for(var C=h=e(q),I=B,H=0;H<C.submeshes.length;H++){var w=C.submeshes[H];t.tf(w.position,I,w.position,0);t.wH(w.normal,I,w.normal);t.JG(w.tangent,I,w.tangent)}c.push(h)}for(K=0;K<c.length;K++)for(l=q,p=c[K],v=0;v<l.submeshes.length;v++){k=l.submeshes[v];
B=p.submeshes[v];h=k.base_length;C=k.indices.length;k.base_length+=B.base_length;for(var g in k)if("base_length"!=g)if("indices"==g)for(k[g]=t.PG(k[g],B[g]),I=C;I<k.indices.length;I++)k.indices[I]+=h;else"vertex_colors"!=g&&(k[g]=t.HC(k[g],B[g]))}break;case "CURVE":for(var q=b,K=c.object.Vz,l=new Float32Array(16),v=K.lf?4:3,p=new Float32Array(v),v=new Float32Array(v),k=new Float32Array(3),B=new Float32Array(4),h=new Float32Array(4),C=new Float32Array(3),I=new Float32Array(3),H=new Float32Array(3),
w=new Float32Array(4),M=new Float32Array(4),L=0;L<q.submeshes.length;L++){var R=q.submeshes[L],U=R.position,Z=R.normal,R=R.tangent,X;a:switch(X=c.deform_axis,X){case "POS_X":case "NEG_X":X=0;break a;case "POS_Y":case "NEG_Y":X=1;break a;case "POS_Z":case "NEG_Z":X=2;break a;default:throw"Wrong deform axis value "+X;}C[0]=0;C[1]=0;C[2]=0;C[X]=1;for(var aa=r.uG(K),T=0;T<U.length/3;T++){H[0]=U[3*T];H[1]=U[3*T+1];H[2]=U[3*T+2];var Y=H[X],z=r.tG(K,Y);r.vG(K,z,p);k[0]=p[0];k[1]=p[1];k[2]=p[2];r.sG(K,z,
v);I[0]=v[0];I[1]=0;I[2]=v[2];m.normalize(I,I);u.rotationTo(C,I,B);0>Y?(p[0]=I[0],p[1]=I[1],p[2]=I[2],m.scale(p,Y,p),m.add(k,p,k)):Y>aa&&(p[0]=I[0],p[1]=I[1],p[2]=I[2],m.scale(p,Y-aa,p),m.add(k,p,k));y.fromRotationTranslation(B,k,l);K.lf&&(u.setAxisAngle(C,p[3],h),m.transformQuat(H,h,H));H[X]=0;m.transformMat4(H,l,H);U[3*T]=H[0];U[3*T+1]=H[1];U[3*T+2]=H[2];Z.length&&(w[0]=Z[3*T],w[1]=Z[3*T+1],w[2]=Z[3*T+2],w[3]=0,x.transformMat4(w,l,w),Z[3*T]=w[0],Z[3*T+1]=w[1],Z[3*T+2]=w[2]);R.length&&(M[0]=R[3*
T],M[1]=R[3*T+1],M[2]=R[3*T+2],M[3]=0,x.transformMat4(M,l,M),R[3*T]=M[0],R[3*T+1]=M[1],R[3*T+2]=M[2])}}}f.eF(b)}return b};a.iK=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,
b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,
hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.zA=function(a,b){for(var d=0;d<b.length;d++){var e=b[d];if(e.b4w_use_nla)for(var e=e.b4w_nla_script,c=0;c<e.length;c++){var f=e[c];switch(f.type){case "SELECT":case "SELECT_PLAY":for(var m=0;m<a.length;m++){var l=a[m];l.name==f.object&&(l.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(m=0;m<a.length;m++)l=a[m],l.name==f.object&&
(l.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,v){function d(a){a=ta.Ba(a);a.re=null;a.Ib=null;a.Yc=null;return a}function b(a,b){var c=[];Q.If(a,function(b,d,g){-1<c.indexOf(g)?Q.pF(a,b,d,g,e(g)):c.push(g)});Q.U(a,function(d,g){for(var f=0;f<g.ra.length;f++){var h=g.ra[f];b||"MAIN_REFLECT"!=g.type||(h.$g=!0);-1<c.indexOf(h)?g.ra[f]=e(h):c.push(h)}"ANTIALIASING"==g.type&&Q.Le(a,d,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ra.length;c++){var d=b.ra[c];d.Da=na.H;d.Ca=na.H}});b||Q.Le(a,d,function(a,
b,c){"DEPTH"==c.N&&(c.$g=!0)})});Q.U(a,function(b){var c={};p(a,b,c);for(var d in c){b=c[d];for(var e=b[0],g=0;g<b.length;g++)if(b[g].Da==na.H){e=b[g];break}for(var f=b[0],g=0;g<b.length;g++)if(b[g].Ca==na.H){f=b[g];break}for(var h=b[0],g=0;g<b.length;g++)if(!b[g].$g){h=b[g];break}for(g=0;g<b.length;g++)b[g].Da=e.Da,b[g].Ca=f.Ca,b[g].$g=h.$g}})}function p(a,b,c){Q.Le(a,b,function(b,d,e){e.Pa&&e.N==e.ha&&(c[e.N]=c[e.N]||[],-1==c[e.N].indexOf(e)&&c[e.N].push(e),p(a,b,c))});Q.Jf(a,b,function(a,b,d){d.Pa&&
(c[d.N]=c[d.N]||[],-1==c[d.N].indexOf(d)&&c[d.N].push(d))});b=Q.qb(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.ra.length;d++){var e=b.ra[d];c[e.N].push(e)}}function e(a){if(a.sa)throw"Failed to clone slink with attached texture";return ta.fg(a)}function f(a){var b=Q.Nq(a),c=[];Q.U(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=[];break;default:e=c}for(var g=0;g<d.ra.length;g++){var f=d.ra[g],h=x(e,f,l(f));f.sa=h;
d.Ud[g]=h}for(g=0;g<d.Ud.length;g++)h=d.Ud[g],m(e,h);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}Q.Jf(b,a,function(c,d,g){if(!g.sa){if((c=t(b,a,g.N))&&g.Pa&&!g.sa){d=e;for(var f=c,h=0;h<d.length;h++){var k=d[h];k.Jq===f&&k.Mj++}}else c=x(e,g,l(g));g.sa=c}});Q.Le(b,a,function(a,b,c){m(e,c.sa)});Q.Jf(b,a,function(a,b,c){c.sa&&"NONE"==c.ha&&m(e,c.sa)})})}function r(a){y(a,function(b,c,d){b.Ai&&(qa(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&
"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||qa(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.Df*=Da.resolution_factor)})}function l(a){a=ta.fg(a);delete a.ha;delete a.Pa;delete a.sa;return JSON.stringify(a)}function t(a,b,c){var d=null;Q.Le(a,b,function(a,b,e){if(e.Pa&&e.N==e.ha&&e.N==c&&e.sa)return d=e.sa,!0});Q.Jf(a,b,function(a,b,e){if(e.Pa&&e.N==c&&e.sa)return d=e.sa,!0});return d}function m(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Jq===b&&d.Mj&&d.Mj--}}function x(a,b,c){for(var d=null,
e=0;e<a.length;e++){var g=a[e];if(g.id==c&&0===g.Mj){d=g;break}}if(d)return d.Mj++,d.Jq;b=u(b);a.push({id:c,Mj:1,Jq:b});return b}function u(a){var b=a.Df*a.size;switch(a.N){case "COLOR":var c=na.Yk("COLOR",na.ih);na.resize(c,b,b);na.mq(c,a.Da,a.Ca);return c;case "DEPTH":return a.$g?(c=na.Yk("DEPTH_RBUF",na.hh),na.resize(c,b,b)):(c=na.Yk("DEPTH_TEX",na.Hi),na.resize(c,b,b),na.mq(c,a.Da,a.Ca)),c;case "CUBEMAP":return c=na.CB(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.N;}}function y(a,
b){var c=!1;Q.If(a,function(d,e,g){if(g&&(d=Q.qb(a,d),e=Q.qb(a,e),b(g,!1,d,e)))return c=!0});c||Q.U(a,function(a,c){for(var d=0;d<c.ra.length;d++)if(b(c.ra[d],!0,c,null))return!0})}function K(a){Q.U(a,function(b,c){if("SINK"!=c.type){var d=c.j;Q.Jf(a,b,function(a,b,c){c.Pa&&c.sa&&(ka.km(d,c.N,c.sa),c.N==c.ha&&b.j&&ka.km(b.j,c.N,c.sa))});for(var e=0;e<c.ra.length;e++){var g=c.ra[e];g.Pa&&g.N==g.ha&&ka.km(d,g.N,c.Ud[e])}!d.Ib&&!d.Yc||d.re||(d.re=Fa.oF(d.Ib,d.Yc))}})}function G(a){var b=null,c=0;Q.U(a,
function(a,d){if(d.type==tb.FG){if(c==tb.EG)return b=d,!0;c++}});return b}function A(a,b){var d=Q.Yh(a,b),e=F("NONE"),g=Q.D(a,e),f=Q.Gu(a)[0];Q.If(a,function(b,c){c==f&&Q.fF(a,b,f,b,g)});Q.If(a,function(g,f,h){if(g==d)return Q.m(a,b,e,c(tb.gG,"u_color",h.size,h.Df,h.Ai)),!0});Q.Ve(a,g,f,c("SCREEN","NONE",.5,.5,!0))}function n(a,b){var c=q("SHADOW_CAST");c.Zn=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.np){case "SPOT":case "POINT":c.j=ka.zb(ka.gc);ka.nq(c.j,180*b.Rd/Math.PI,
.1,2*b.distance);break;default:c.j=ka.zb(ka.Xf)}return c}function q(a){return{type:a,Ka:!1,lw:!1,un:!1,Ml:!1,Ti:0,time:0,j:null,rt:null,rc:null,p:[],ra:[],Ud:[],ik:new Float32Array(3),ty:new Float32Array(3),jc:new Float32Array(3),hc:new Float32Array(4),Ac:new Float32Array(16),df:0,Kg:0,Ag:null,Cg:null,zg:null,Bg:null,jf:new Float32Array(3),Rf:new Float32Array(3),Ox:new Float32Array([0,0,0]),Am:new Float32Array(3),Px:new Float32Array(4),Sl:0,no:0,qj:!1,sf:new Float32Array(3),eh:0,ab:null,Km:!1,Af:new Float32Array(2),
Bf:new Float32Array(2),gi:0,Th:0,Hn:0,qd:null,Pf:0,fh:0,Of:0,cg:!1,Ks:0,Ls:new Float32Array(2),Js:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,hi:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,oi:0,ni:0,mi:0,Gx:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,
god_rays_intensity:0,Sh:0,fm:0,ri:0,Zn:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,fy:null,ys:null,Og:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Cs:0,It:0,Jl:0,Kl:0,Mv:0,Jj:"",kE:new Float32Array(2),aa:!0,Cc:!0,ja:!0,na:!0,Nb:!0,Ia:!0}}function c(a,b,c,d,e){return{N:a,ha:b,size:c,Df:d,Ai:e,Pa:!0,sa:null,$g:!1,Da:na.ce,Ca:na.ce}}function P(a,b){for(var c=0,d=E(a,b),e=0;e<d.length;e++){var g=d[e];"SHADOW_CAST"==g.type&&(g=S(a,g,"SHADOW_CAST").j,b.fy=g.ma,b.ys=new Float32Array([.5,
0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.Og=b.Og||[],b.Og[c]=g.va,c++)}}function O(){var a=q("GRASS_MAP");a.j=ka.zb(ka.Re);return a}function F(a){var b=q("POSTPROCESSING");b.ja=!1;b.na=!1;b.Nb=!1;b.j=ka.zb(ka.xb);b.Jj=a;return b}function k(a){var b=q("BLOOM_BLUR");b.ja=!1;b.na=!1;b.Nb=!1;b.j=ka.zb(ka.xb);b.Jj=a;return b}function B(a,b,c,d,e,g,f,h,k){var m=q("MAIN_"+a);if("OPAQUE"===a)m.ja=!0,m.na=c,m.Ka=!1;else if("BLEND"===a)m.ja=!1,m.na=!1,m.Ka=!0;else if("XRAY"===a)m.ja=!1,m.na=!0,m.Ka=!0;else if("REFLECT"===
a)m.ja=!0,m.na=!0,m.Ka=!1;else throw"wrong main subscene type";m.Ka&&h&&(m.self_shadow_normal_offset=h.self_shadow_normal_offset);m.j=b;m.jf.set(f.jf);m.Rf.set(f.Rf);m.df=f.df;m.hc=g;d&&(m.ab=d,d.hc&&(m.qd=new Float32Array(d.hc)),m.Pf=d.waves_height,m.fh=d.waves_length,m.Of=d.Of,d.Nk&&k&&(m.cg=!0,m.Ks=d.Nk,m.Ls.set(d.Jn),m.Js=d.In),d.wm&&(m.Km=!0,a=d.eG,m.Af[0]=(a[0]+a[1])/2,m.Af[1]=(a[2]+a[3])/2,m.Bf[0]=a[0]-a[1],m.Bf[1]=a[2]-a[3],m.gi=d.gi,m.Th=d.Th));m.Ag=new Float32Array(3*e);m.Cg=new Float32Array(3*
e);m.zg=new Float32Array(3*e);m.Bg=new Float32Array(0==e%2?2*e:2*e+2);return m}function J(a,b){var c=q("COLOR_PICKING");b&&(c.type+="_XRAY",c.ja=!1,c.na=!0);c.Cc=!1;c.j=a;return c}function h(a){var b=q("WIREFRAME");b.aa=!1;b.ja=!1;b.na=!1;b.j=a;return b}function C(a){var b=q("ANCHOR_VISIBILITY");b.ja=!0;b.na=!1;b.j=a;return b}function I(a,b){var c=q("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function H(a){var b=q("DEPTH_PACK");b.ja=!1;b.na=!1;b.j=a;return b}function w(a,
b,c){var d=q("SSAO");d.ja=!1;d.na=!1;d.Nb=!1;d.j=a;d.hc=b;d.qd=new Float32Array(b);d.oi=c.radius_increase;d.ssao_hemisphere=c.WD;d.ni=c.influence;d.mi=c.dist_factor;d.Gx=c.yF;return d}function g(a,b){var c=q("SSAO_BLUR");c.ja=!1;c.na=!1;c.Nb=!1;c.ssao_blur_depth=b.IA;c.ssao_blur_discard_value=b.Bs;c.j=a;return c}function M(){var a=q("ANTIALIASING");a.ja=!1;a.na=!1;a.Nb=!1;a.j=ka.zb(ka.xb);return a}function L(a){var b=q(a);b.ja="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;
b.na=!1;b.Nb=!1;b.j=ka.zb(ka.xb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.lE=new Float32Array(4));return b}function R(a,b,c,d){var e=q("COMPOSITING");e.ja=!1;e.na=!1;e.Nb=!1;e.j=ka.zb(ka.xb);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function U(a,b){var c=q("MOTION_BLUR");c.ja=!1;c.na=!1;c.Nb=!1;c.j=ka.zb(ka.xb);c.un=!0;c.Jl=a;c.Kl=b;return c}function Z(a){var b=q("DOF");b.ja=!1;b.na=!1;b.Nb=!1;b.j=a;return b}function X(a){var b=q("OUTLINE_MASK");b.j=a;b.Nb=!1;return b}function aa(a){var b=
q("OUTLINE");b.sf.set(a.sf);b.Sl=a.Sl;b.It=5;b.Cs=3;b.Nb=!1;b.j=ka.zb(ka.xb);return b}function T(){var a=q("REFRACT");a.ja=!1;a.na=!1;a.Nb=!1;a.j=ka.zb(ka.xb);return a}function Y(a,b,c,d,e,g,f){var h=q("GOD_RAYS");h.ja=!1;h.na=!1;h.Nb=!1;h.jf=[1,1,1];h.Rf=[1,1,1];h.df=1;h.lw=d;h.eh=b;h.fm=e;h.Sh=c;h.ri=f;h.j=a;h.Kg=g;h.Ag=new Float32Array(3*g);h.Cg=new Float32Array(3*g);h.zg=new Float32Array(3*g);h.Bg=new Float32Array(0==g%2?2*g:2*g+2);return h}function z(a,b){var c=q("GOD_RAYS_COMBINE");c.ja=!1;
c.na=!1;c.Nb=!1;c.j=ka.zb(ka.xb);c.god_rays_intensity=a;c.Kg=b;c.Ag=new Float32Array(3*b);c.Cg=new Float32Array(3*b);c.zg=new Float32Array(3*b);c.Bg=new Float32Array(0==b%2?2*b:2*b+2);return c}function ea(a,b){var c=q("SKY");c.Cc=!1;c.ja=!1;c.na=!1;c.Nb=!1;var d=ka.zb(ka.xb);d.width=lb.$k;d.height=lb.$k;c.j=d;c.rt=ta.TC();c.Kg=a;c.Ag=new Float32Array(3*a);c.Cg=new Float32Array(3*a);c.zg=new Float32Array(3*a);c.Bg=new Float32Array(0==a%2?2*a:2*a+2);c.jf=[1,1,1];c.Rf=[1,1,1];c.df=1;c.hi.set(b.hi);c.procedural_skydome=
b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function la(){var a=q("COPY");a.ja=!1;a.na=!1;a.j=
ka.zb(ka.xb);return a}function ba(){var a=q("ANAGLYPH");a.ja=!1;a.na=!1;a.j=ka.zb(ka.xb);return a}function fa(){var a=q("LUMINANCE");a.ja=!1;a.na=!1;a.j=ka.zb(ka.xb);return a}function ma(){var a=q("AVERAGE_LUMINANCE");a.ja=!1;a.na=!1;a.j=ka.zb(ka.xb);return a}function ca(a,b,c,d){var e=q("LUMINANCE_TRUNCED");e.ja=!1;e.na=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.Ag=new Float32Array(3*c);e.Cg=new Float32Array(3*c);e.zg=new Float32Array(3*c);e.Bg=new Float32Array(0==c%2?2*c:2*c+2);return e}function ra(a){var b=
q("BLOOM");b.ja=!1;b.na=!1;b.j=ka.zb(ka.xb);b.bloom_blur=a;return b}function sa(){var a=q("SINK");a.Cc=!1;return a}function qa(a,b,c){if(b.type===c)return!0;b=N(a,b);for(var d=0;d<b.length;d++)if(qa(a,b[d],c))return!0;return!1}function V(a,b,c){if(b.type===c)return!0;b=E(a,b);for(var d=0;d<b.length;d++)if(V(a,b[d],c))return!0;return!1}function S(a,b,c){if(b.type===c)return b;b=E(a,b);for(var d=0;d<b.length;d++){var e=S(a,b[d],c);if(e)return e}return null}function E(a,b){var c=Q.Yh(a,b);if(c==Q.Br)throw"Subscene not in graph";
for(var d=[],e=Q.iv(a,c),g=0;g<e;g++){var f=Q.nl(a,c,g);f!=c&&d.push(Q.qb(a,f))}return d}function N(a,b){var c=Q.Yh(a,b);if(c==Q.Br)throw"Subscene not in graph";for(var d=[],e=Q.$h(a,c),g=0;g<e;g++){var f=Q.Hh(a,c,g);f!=c&&d.push(Q.qb(a,f))}return d}function ha(a){var b=[],c=[];y(a,function(a){a.sa&&-1==b.indexOf(a.sa)&&(b.push(a.sa),c.push(a.sa,b.length-1))});return c}function oa(a,b){var c;c=""+(a.N+"\\n");c+="NONE"!=a.ha?a.ha+"\\n":"";c+="(";if(a.Ai){var d=a.Df;Math.round(d)!=d&&(d=d.toFixed(2));
d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.N){c+=" ";if(a.$g)c+="RR";else{var d=a.Da,e=a.Ca,g="";d==na.H?g+="L":d==na.ce&&(g+="N");e==na.H?g+="L":e==na.ce&&(g+="N");c+=g}for(d=0;d<b.length;d+=2)b[d]==a.sa&&(c+=" "+b[d+1])}return c+")\\n"}var ka=v("__camera"),Xa=v("__config"),da=v("__debug"),Q=v("__graph"),Fa=v("__renderer"),na=v("__textures"),ta=v("__util");v("vec4");var tb=Xa.ho,Da=Xa.q,lb=Xa.Uj;a.dB=function(a){switch(a.ha){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;
default:return!0}};a.OG=y;a.MB=function(a,e,m){function q(b,g){var f=d(Aa[g]);e.I.push(f);f=B(b,f,!1,ha,Fa,xa,Ga,Ya,a.ti);t.push(f);Q.D(l,f);Q.m(l,p[g],f,u[g]);Q.m(l,p[g],f,y[g]);Ka&&(Q.m(l,Ka,f,ub),Q.m(l,Ka,f,vb));if(rb){for(var h=0;h<S.length;h++)Q.m(l,S[h],f,qa[h]);var h=x[g],k=c("COLOR","u_scene_depth",1,1,!0);k.Da=na.ce;k.Ca=na.ce;Q.m(l,h,f,k)}v.length&&(Q.m(l,v[g],f,E[g]),f.rc=Ca[0]);N.length&&Q.m(l,N[g],f,V[g]);return f}var l=Q.create(),p=[],t=[],x=[],u=[],y=[],v=[],E=[],N=[],V=[],S=[],qa=
[],Fa=a.zv,ha=a.ab,oa=a.fq,Xa=a.Ef,Eb=a.Jh,Va=a.xE,Ca=a.gF,Jb=a.oh,tc=a.Vh,hc=a.th,Ib=a.antialiasing,Ga=a.jr,xa=a.hc,Ya=a.Od,Za=a.BE,bb=a.HA,$b=a.RA,ob=a.PD,wb=a.PE,xb=a.Ah,rb=a.iC,Na=Boolean(m.length),Aa=[];if(a.anaglyph_use&&!Na){var Cb=e.I[0],Db=d(Cb);ka.Kv(Cb,ka.yb);ka.Kv(Db,ka.Gb);Aa.push(Cb,Db);e.I.push(Db)}else{var Ba=e.I[0];Aa.push(Ba)}if(oa){ka.Wq(Aa[0],Ya);for(var fc=Ya.csm_num,ga=0;ga<fc;ga++){var za=n(ga,Ya);Q.D(l,za);S.push(za);var Pa=Ya.csm_resolution,Ba=za.j;Ba.width=Pa;Ba.height=Pa;
za.ja=!1;qa.push(c("DEPTH","u_shadow_map"+ga,Pa,1,!1));(da.YA()||Da.Ot)&&za.ra.push(c("COLOR","COLOR",Pa,1,!1))}}if(0<Ca.length&&!Na)for(ga=0;ga<Aa.length;ga++){Ba=d(Aa[ga]);e.I.push(Ba);var va=B("REFLECT",Ba,!1,ha,Fa,xa,Ga,null,a.ti);va.rc=Ca[0];va.j.rc=Ca[0];Q.D(l,va);v.push(va);E.push(c("COLOR","u_reflectmap",1,Da.Nj,!0));va.ra.push(c("DEPTH","DEPTH",1,Da.Nj,!0))}p=[];t=[];if(a.hb){var Ka=O();Q.D(l,Ka);Pa=lb.rl;Ka.j.width=Pa;Ka.j.height=Pa;var ub=c("DEPTH","u_grass_map_depth",Pa,1,!1);ub.Da=na.H;
ub.Ca=na.H;var vb=c("COLOR","u_grass_map_color",Pa,1,!1);vb.Da=na.H;vb.Ca=na.H}else vb=ub=Ka=null;for(var Wb=[],Xb=[],ga=0;ga<Aa.length;ga++){var Ba=Aa[ga],Ma={};y.push(c("DEPTH","DEPTH",1,1,!0));if(rb){var Rb=d(Ba);e.I.push(Rb);if(oa){Ma=I(Rb,Ya);Q.D(l,Ma);Xb.push(Ma);for(var Bb=0;Bb<S.length;Bb++)za=S[Bb],Q.m(l,za,Ma,qa[Bb]);var Yb=c("COLOR","u_color",1,1,!0),Sb=c("DEPTH","u_depth",1,1,!0);if(Xa){var lc=d(Ba);e.I.push(lc);var mc=a.xG,Wa=w(lc,xa,mc);Q.D(l,Wa);var nc=c("COLOR","u_ssao_mask",1,1,!0);
Q.m(l,Ma,Wa,Yb);Q.m(l,Ma,Wa,Sb);var oc=d(Ba);e.I.push(oc);var fb=g(oc,mc);Q.D(l,fb);var gc=c("COLOR","u_shadow_mask",1,1,!0);Q.m(l,Wa,fb,nc);Q.m(l,Ma,fb,Sb)}var D=d(Rb);e.I.push(D);var Mb=H(D);Q.D(l,Mb);Q.m(l,Ma,Mb,c("DEPTH","u_depth",1,1,!0));x.push(Mb)}else Ma=I(Rb,Ya),Q.D(l,Ma),x.push(Ma);Ka&&(Q.m(l,Ka,Ma,ub),Q.m(l,Ka,Ma,vb))}va=B("OPAQUE",Ba,!rb,ha,Fa,xa,Ga,null,a.ti);Q.D(l,va);t.push(va);rb&&(Q.m(l,Ma,va,y[ga]),nc?Q.m(l,fb,va,gc):oa&&Q.m(l,Ma,va,c("COLOR","u_shadow_mask",1,1,!0)));var pb=c("COLOR",
"u_color",1,1,!0);u.push(c("COLOR","COLOR",1,1,!0));Ka&&(Q.m(l,Ka,va,ub),Q.m(l,Ka,va,vb));v.length&&(Q.m(l,v[ga],va,E[ga]),va.rc=Ca[0])}p=t;t=[];if(!Na&&a.mB){Ba=d(p[0].j);e.I.push(Ba);var Qa=J(Ba,!1);Q.D(l,Qa);if(a.Ne){Ba=d(p[0].j);e.I.push(Ba);var hb=J(Ba,!0);Q.D(l,hb);Q.m(l,Qa,hb,c("COLOR","COLOR",1,1,!0));Q.m(l,Qa,hb,c("DEPTH","DEPTH",1,1,!0))}}else Qa=null;if(Va.Kd&&!Na)for(ga=0;ga<Aa.length;ga++){var W=T();Q.D(l,W);Q.m(l,p[ga],W,pb);N.push(W);V.push(c("COLOR","u_refractmap",1,1,!0))}for(ga=
0;ga<Aa.length;ga++)va=q("BLEND",ga),Wb.push(va);p=t;t=[];if(a.Ne){for(ga=0;ga<Aa.length;ga++)q("XRAY",ga);p=t;t=[]}if(Da.wireframe_debug){for(ga=0;ga<Aa.length;ga++){Ba=ta.Ba(Aa[ga]);e.I.push(Ba);var Ja=h(Ba);t.push(Ja);Q.D(l,Ja);Q.m(l,p[ga],Ja,u[ga]);Q.m(l,p[ga],Ja,y[ga]);Ka&&(Q.m(l,Ka,Ja,ub),Q.m(l,Ka,Ja,vb))}p=t;t=[]}if(!Na&&a.Yz){Ba=ta.Ba(Aa[0]);e.I.push(Ba);var ib=C(Ba);Q.D(l,ib);Q.m(l,p[0],ib,y[0])}if(Eb&&rb&&!Na){for(ga=0;ga<Aa.length;ga++){var ic=ob.Sh,cb=ob.$D,Nb=ob.ri,db=p[ga],uc=ha?1:0,
ac=c("DEPTH","u_input",1,1,!0);ac.Da=na.H;ac.Ca=na.H;var bc=c("COLOR","u_input",1,.25,!0);bc.Da=na.H;bc.Ca=na.H;var Tb=ic/Nb,Ec=d(Aa[ga]);e.I.push(Ec);var vc=Y(Ec,uc,ic,!0,Tb,Fa,Nb);Q.D(l,vc);Q.m(l,db,vc,ac);var Tb=ic/Nb*.5,Ra=d(Aa[ga]);e.I.push(Ra);var La=Y(Ra,uc,ic,!1,Tb,Fa,Nb);Q.D(l,La);Q.m(l,vc,La,bc);var Tb=ic/Nb*.25,od=d(Aa[ga]);e.I.push(od);var Ob=Y(od,uc,ic,!1,Tb,Fa,Nb);Q.D(l,Ob);Q.m(l,La,Ob,bc);var wc=z(cb,Fa);t.push(wc);Q.D(l,wc);Q.m(l,db,wc,c("COLOR","u_main",1,1,!0));Q.m(l,Ob,wc,c("COLOR",
"u_god_rays",1,1,!0))}p=t;t=[]}if(Jb&&!Na){for(ga=0;ga<Aa.length;ga++){var db=p[ga],pc=fa();Q.D(l,pc);Q.m(l,db,pc,c("COLOR","u_input",1,1,!0));var Fc=ma();Q.D(l,Fc);Fc.j.width=1;Fc.j.height=1;var Fb=c("COLOR","u_input",1,.25,!0);Fb.Da=na.H;Fb.Ca=na.H;var cc=c("COLOR","u_luminance",1,.25,!0);cc.Da=na.H;cc.Ca=na.H;Q.m(l,pc,Fc,Fb);var id=bb.key,dc=bb.pC,Ub=d(Aa[ga]);e.I.push(Ub);var jc=ca(id,dc,Fa,Ub);Q.D(l,jc);Q.m(l,db,jc,c("COLOR","u_main",1,1,!0));Q.m(l,pc,jc,cc);Q.m(l,Fc,jc,c("COLOR","u_average_lum",
1,1,!1));var Pb=c("COLOR","u_color",1,.25,!0);Pb.Da=na.H;Pb.Ca=na.H;var Yc=k("X_BLUR");Q.D(l,Yc);Q.m(l,jc,Yc,Pb);var Zc=k("Y_BLUR");Q.D(l,Zc);Q.m(l,Yc,Zc,Pb);var kc=ra(bb.blur);Q.D(l,kc);var Gc=c("COLOR","u_bloom",1,.25,!0);Gc.Da=na.H;Gc.Ca=na.H;Q.m(l,Zc,kc,Gc);Q.m(l,db,kc,c("COLOR","u_main",1,1,!0));t.push(kc)}p=t;t=[]}if(tc&&!Na){for(ga=0;ga<p.length;ga++){var Mc=p[ga],yb=U(Za.Jl,Za.Kl);t.push(yb);Q.D(l,yb);Q.m(l,Mc,yb,c("COLOR","u_mb_tex_curr",1,1,!0));yb.ra.push(c("COLOR","u_mb_tex_accum",1,1,
!0))}p=t;t=[]}if(xb&&rb&&!Na){for(ga=0;ga<p.length;ga++){var db=p[ga],Vb=d(Aa[ga]);e.I.push(Vb);Pb=c("COLOR","u_color",1,1,!0);Pb.Da=na.H;Pb.Ca=na.H;var qb=F("X_BLUR");Q.D(l,qb);Q.m(l,db,qb,Pb);var zb=F("Y_BLUR");Q.D(l,zb);Q.m(l,qb,zb,Pb);var Ma=Wb[ga],xc=Z(Vb);Vb.dof_distance=e.dof_distance;Vb.kg=e.kg;Vb.dof_front=e.dof_front;Vb.dof_rear=e.dof_rear;Vb.dof_power=e.dof_power;Vb.dof_on=1;t.push(xc);Q.D(l,xc);Q.m(l,db,xc,c("COLOR","u_sharp",1,1,!0));Q.m(l,zb,xc,c("COLOR","u_blurred",1,1,!0));Q.m(l,Ma,
xc,c("DEPTH","u_depth",1,1,!0))}p=t;t=[]}if(!Na&&a.outline){for(ga=0;ga<Aa.length;ga++){var db=p[ga],$c=d(Aa[ga]);e.I.push($c);var ec=X($c);Q.D(l,ec);var Ic=F("X_EXTEND"),ad=c("COLOR","u_color",1,1,!0),sd=c("COLOR","u_outline_mask",1,1,!0);Ic.qj=!0;Q.D(l,Ic);Q.m(l,ec,Ic,ad);var rc=c("COLOR","u_color",1,.5,!0);rc.Da=na.H;rc.Ca=na.H;var yc=F("Y_EXTEND");yc.qj=!0;Q.D(l,yc);Q.m(l,Ic,yc,rc);qb=F("X_BLUR");qb.qj=!0;Q.D(l,qb);Q.m(l,yc,qb,rc);var Nc=c("COLOR","u_color",1,.25,!0);Nc.Da=na.H;Nc.Ca=na.H;var Ab=
c("COLOR","u_outline_mask_blurred",1,.25,!0);Ab.Da=na.H;Ab.Ca=na.H;zb=F("Y_BLUR");zb.qj=!0;Q.D(l,zb);Q.m(l,qb,zb,Nc);var Jc=aa(wb);Q.D(l,Jc);Q.m(l,db,Jc,c("COLOR","u_outline_src",1,1,!0));Q.m(l,ec,Jc,sd);Q.m(l,zb,Jc,Ab);t.push(Jc)}p=t;t=[]}if(hc&&!Na){for(ga=0;ga<p.length;ga++){var db=p[ga],bd=R($b.brightness,$b.contrast,$b.exposure,$b.saturation);Q.D(l,bd);Q.m(l,db,bd,c("COLOR","u_color",1,1,!0));t.push(bd)}p=t;t=[]}if(Ib){for(ga=0;ga<p.length;ga++)if(db=p[ga],Da.smaa){var zc=c("COLOR","u_color",
1,1,!0);zc.Da=na.H;zc.Ca=na.H;var Oc=L("SMAA_EDGE_DETECTION");Q.D(l,Oc);Q.m(l,db,Oc,zc);var $a=L("SMAA_BLENDING_WEIGHT_CALCULATION");Q.D(l,$a);Q.m(l,Oc,$a,zc);var Ac=c("COLOR","u_search_tex",1,1,!1),Pc=c("COLOR","u_area_tex",1,1,!1);Ac.Da=na.H;Ac.Ca=na.H;Pc.Da=na.H;Pc.Ca=na.H;$a.ra.push(Ac);$a.ra.push(Pc);var Bc=L("SMAA_NEIGHBORHOOD_BLENDING");Q.D(l,Bc);Q.m(l,db,Bc,zc);var cd=c("COLOR","u_blend",1,1,!0);cd.Da=na.H;cd.Ca=na.H;Q.m(l,$a,Bc,cd);t.push(Bc)}else{var Kc=M();Q.D(l,Kc);var Qc=c("COLOR","u_color",
1,1,!0);Qc.Da=na.H;Qc.Ca=na.H;Q.m(l,db,Kc,Qc);if(1<Da.resolution_factor){var dd=F("NONE");Q.D(l,dd);Q.m(l,Kc,dd,Qc);t.push(dd)}else t.push(Kc)}p=t;t=[]}if(a.anaglyph_use&&!Na){var Rc=ba();Q.D(l,Rc);Q.m(l,p[0],Rc,c("COLOR","u_sampler_left",1,1,!0));Q.m(l,p[1],Rc,c("COLOR","u_sampler_right",1,1,!0));t.push(Rc)}else t.push(p[0]);var pd=Q.Yh(l,p[0]),ed=!1;Q.Le(l,pd,function(a,b,c){if(c.N==c.ha)return ed=!0});if(ed){var Gb=la();Q.D(l,Gb);Q.m(l,p[0],Gb,c("COLOR","u_color",1,1,!0));p=t;t=[];t.push(Gb)}Qa&&
(hb?t.push(hb):t.push(Qa));ib&&t.push(ib);if(!Na&&a.ym.procedural_skydome){var Cc=ea(Fa,a.ym);Q.D(l,Cc);t.push(Cc)}var Hb=sa();Q.D(l,Hb);for(ga=0;ga<t.length;ga++){var Lc=t[ga];switch(Lc.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":Q.m(l,Lc,Hb,c("COLOR","NONE",1,1,!0));Q.m(l,Lc,Hb,c("DEPTH","NONE",1,1,!0));break;case "SKY":Q.m(l,Lc,Hb,c("CUBEMAP","u_sky",lb.$k,1,!1));break;case "ANCHOR_VISIBILITY":Q.m(l,Lc,Hb,c("COLOR","NONE",1,1,!0));break;default:if(Na){var fd=m[0].d,Dc=c("COLOR","OFFSCREEN",
1,1,!0);Dc.sa=fd;Q.m(l,t[ga],Hb,Dc);for(Bb=1;Bb<m.length;Bb++){var gd=m[Bb].d,Gb=la();Q.D(l,Gb);Q.m(l,t[ga],Gb,c("COLOR","u_color",1,1,!0));Dc=c("COLOR","OFFSCREEN",1,gd.Xg/fd.Xg,!0);Dc.sa=gd;Q.m(l,Gb,Hb,Dc)}}else Q.m(l,t[ga],Hb,c("SCREEN","NONE",1,1,!0))}}if(tb.enabled){var Sc=G(l);Sc&&A(l,Sc)}b(l,rb);1<Da.resolution_factor&&r(l);f(l);K(l);for(ga=0;ga<Xb.length;ga++)P(l,Xb[ga]);for(ga=0;ga<Wb.length;ga++)P(l,Wb[ga]);return l};a.YL=q;a.JK=function(a){var b=null;Q.U(a,function(a,c){return c.j&&null===
c.j.re?(b=c,!0):!1});return b};a.Ab=function(a,b,c){a=E(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.QL=qa;a.VD=V;a.BD=E;a.uL=N;a.La=function(a,b){var c=null;Q.U(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.ZB=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ha(a);Q.U(a,function(a,d){var e=b+="    ",g="",g=d.type.replace(/_/g," ");"POSTPROCESSING"==
d.type&&(g+=" ("+d.Jj.replace(/_/g," ")+")");if(d.j){for(var g=g+"\\n",f=0;f<c.length;f+=2)c[f]==d.j.Ib&&(g+="C"+c[f+1]+" ");for(f=0;f<c.length;f+=2)c[f]==d.j.Yc&&(g+="D"+c[f+1])}d.ra.length&&(g+="\\n-----\\n");for(f=0;f<d.ra.length;f++)g+=oa(d.ra[f],c);f="SINK"==d.type?"dotted":d.Cc?"solid":"dashed";b=e+(String(a)+' [label="'+g+'" color="black" style="'+(f+",bold")+'"];\n')});Q.If(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+oa(e,c)+'" style="'+(e.Pa?"solid":"dotted")+'"];\n'});
return b+="}"};a.NB=function(a){a=Q.LG(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.Cc&&b.push(d)}return b}};b4w.module.__data=function(a,v){function d(a,b){for(var c=ba(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}ia[b.id]=null;gb[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=E.Su(a));d=a.width;a=a.height;Q.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(ya)&&c&&Q.warn("image",b,"is not from app root.")}function p(a,b,c,d,e,g){d=b.r;if(!d)throw"Nothing requested";oa.Cc([[d,oa.or,d]],function(d,
g,h,k){if(d){Q.log("%cLOAD METADATA","color: #616",k);f(d);for(var m in d)a[m]=d[m];(d=a.binaries[0].binfile)?b.zs=d:(ha.vx(b,"load_binaries"),ha.vx(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)Q.yC(a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)Q.zC(a.b4w_export_warnings[d]);e(b,c)}else b.Iv(b.id,!1)},null,function(a){g(b,c,a)})}function e(a,b,c,d,e,g){d=Y(b.r)+b.zs;if(!d)throw"Binary data is missing";oa.Cc([[d,
oa.lk,d]],function(d,g,f,h){d&&(Q.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c))},null,function(a){g(b,c,a)})}function f(a){var b=ab.Dp.split(".").map(function(a){return a|0}),c=a.b4w_format_version.split(".").map(function(a){return a|0});c[0]<b[0]&&Ea.pa("Incompatible file version: "+a.b4w_format_version+", required: "+ab.Dp+". Reexport scene with the latest B4W addon to fix it.");c[1]<b[1]&&Q.warn("Version mismatch. File version: "+ +a.b4w_format_version+", required: "+ab.Dp+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.")}
function r(a,b,c,d,e){d=a.bin_data;var g=a.binaries[0],f=a.objects,h=a.meshes;a=a.actions;for(var k=Ea.ZA(),m=["indices"],q=["normal","tangent"],n=["color","group"],r=["position","texcoord","texcoord2"],p=0;p<h.length;p++)for(var t=h[p].submeshes,x=0;x<t.length;x++)for(var u in t[x]){var y=t[x][u][1];if(-1!=m.indexOf(u)){var w=4*t[x][u][0]+g["int"],v=t[x],A=u,B=d;if(k)var z=new Uint32Array(B,w,y);else for(var z=new Uint32Array(y),B=new DataView(B),F=0;F<y;F++)z[F]=B.getUint32(w+4*F,!0);v[A]=z}else if(-1!=
r.indexOf(u))w=4*t[x][u][0]+g["float"],t[x][u]=l(d,w,y,k);else if(-1!=q.indexOf(u)){w=2*t[x][u][0]+g["short"];v=t[x];A=u;B=d;z=new Float32Array(y);B=new DataView(B);for(F=0;F<y;F++)z[F]=B.getInt16(w+2*F,!0)/32767;v[A]=z}else if(-1!=n.indexOf(u)){w=2*t[x][u][0]+g.ushort;v=t[x];A=u;B=d;z=new Float32Array(y);B=new DataView(B);for(F=0;F<y;F++)z[F]=B.getUint16(w+2*F,!0)/65535;v[A]=z}}for(u=0;u<f.length;u++)for(h=f[u].particle_systems,m=0;m<h.length;m++)q=h[m],q.transforms=l(d,4*q.transforms[0]+g["float"],
q.transforms[1],k);for(f=0;f<a.length;f++){u=a[f];var h=u.fcurves,q=u.frame_range,m=q[0],q=q[1],n=sa.fD(m,q),r=null,t=p=!1,C;for(C in h)p|=-1<C.indexOf("rotation_euler"),t|=-1<C.indexOf("rotation_quaternion");for(C in h)if(p&&t&&-1<C.indexOf("rotation_euler"))delete h[C];else{var x=h[C],O;for(O in x)y=x[O],w=l(d,g["float"]+4*y.bin_data_pos[0],y.bin_data_pos[1],k),v=new Float32Array(n),null===r&&(r=new Int8Array(n)),sa.uA(y,w,v,r,m,q),y.xc=v;-1<C.indexOf("rotation_euler")&&sa.FC(h,C)}u.Oz=r}e(b,c)}
function l(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function t(a,b,c,d,e){0===b.id&&(Ua=a);var g=a.cameras,f=a.groups,h=a.materials,k=a.meshes,l=a.node_groups,q=a.objects,r=a.particles,p=a.scenes,t=a.speakers,u=a.textures,y=a.worlds;l||(Q.warn('"node_groups" datablock undefined. reexport main scene.'),l=a.node_groups=[]);for(var w="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
v={},B=0;B<w.length;B++)for(var z=a[w[B]],F=0;F<z.length;F++){var O=z[F];v[O.uuid]=O}for(var G=0;G<p.length;G++){for(var K=p[G],P=K.objects,E=0;E<P.length;E++)n(P,E,v);K.camera&&n(K,"camera",v);K.world&&n(K,"world",v)}for(G=0;G<f.length;G++)for(var J=f[G].objects,E=0;E<J.length;E++)n(J,E,v);for(G=0;G<q.length;G++){var H=q[G];H.dupli_group&&n(H,"dupli_group",v);H.parent&&n(H,"parent",v);if(H.animation_data){var L=H.animation_data;L.action&&n(L,"action",v);if(L.nla_tracks)for(E=0;E<L.nla_tracks.length;E++)for(var M=
L.nla_tracks[E],N=0;N<M.strips.length;N++)M.strips[N].action&&n(M.strips[N],"action",v)}switch(H.type){case "MESH":if(!H.data)throw"mesh not found for object "+H.name;n(H,"data",v);for(var V=H.modifiers,E=0;E<V.length;E++){var S=V[E];"ARMATURE"==S.type?n(S,"object",v):"CURVE"==S.type&&n(S,"object",v)}var R=H.particle_systems;if(R)for(E=0;E<R.length;E++)n(R[E],"settings",v);break;case "ARMATURE":n(H,"data",v);for(var U=H.pose.bones,T=H.data.bones,E=0;E<U.length;E++){var X=U[E];X.bone=T[X.bone];for(var Y=
X.parent_recursive,N=0;N<Y.length;N++)Y[N]=U[Y[N]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":n(H,"data",v)}var Z=H.constraints;if(Z)for(E=0;E<Z.length;E++){var aa=Z[E];aa.target&&n(aa,"target",v)}var qa=H.lod_levels;if(qa)for(E=0;E<qa.length;E++){var ca=qa[E];ca.object&&n(ca,"object",v)}}for(G=0;G<k.length;G++)for(var D=k[G].materials,E=0;E<D.length;E++)n(D,E,v);for(G=0;G<h.length;G++){for(var na=h[G],ea=na.texture_slots,E=0;E<ea.length;E++)n(ea[E],"texture",v);var ha=na.node_tree;
ha&&A(ha,v)}for(G=0;G<l.length;G++)(ha=l[G].node_tree)&&A(ha,v);for(G=0;G<u.length;G++){var la=u[G],W=la.type;"IMAGE"!=W&&"ENVIRONMENT_MAP"!=W||n(la,"image",v)}for(G=0;G<g.length;G++){var ia=g[G];ia.dof_object&&n(ia,"dof_object",v)}for(G=0;G<t.length;G++){var ka=t[G];ka.sound&&n(ka,"sound",v);if(ka.animation_data&&(L=ka.animation_data,L.action&&n(L,"action",v),L.nla_tracks))for(E=0;E<L.nla_tracks.length;E++)for(M=L.nla_tracks[E],N=0;N<M.strips.length;N++)M.strips[N].action&&n(M.strips[N],"action",
v)}for(G=0;G<r.length;G++){for(var ma=r[G],ea=ma.texture_slots,E=0;E<ea.length;E++)n(ea[E],"texture",v);ma.dupli_group&&n(ma,"dupli_group",v);ma.dupli_object&&n(ma,"dupli_object",v)}for(G=0;G<y.length;G++)if(ea=y[G].texture_slots)for(E=0;E<ea.length;E++)n(ea[E],"texture",v);Fa.WA(a);for(var oa=a.textures,ra=m(a)?a.scenes[0].b4w_anisotropic_filtering:x().b4w_anisotropic_filtering,pa=0;pa<oa.length;pa++)m(a)||"SCENE"!=oa[pa].b4w_source_type||(oa[pa].b4w_source_id=""),ua.VB(oa[pa],ra,a.scenes);for(var Da=
{},ya=a.objects,Ia=0;Ia<ya.length;Ia++){var Ha=ya[Ia];if("MESH"===Ha.type&&!Ha.particle_systems.length)for(var tb=Ha.data,Va=tb.name,Ra=tb.submeshes,La=tb.materials,Oa=0;Oa<Ra.length;Oa++)0!==Ra[Oa].base_length||Da[Va]||(La[Oa]&&Q.warn('material "'+La[Oa].name+'" is not assigned to any face (object "'+Ha.name+'").'),Da[Va]=!0)}for(var lb=a.meshes,gb=0;gb<lb.length;gb++){var nb=lb[gb];nb.materials.length||nb.uv_textures.length&&Q.warn('mesh "'+nb.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",
use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});
for(var Eb=a.meshes,Fb=Ea.Rb("name","DEFAULT",a.materials),cc=0;cc<Eb.length;cc++){var Lb=Eb[cc];0==Lb.materials.length&&Lb.materials.push(Fb)}for(var dc=a.actions,Ub=b.id,jc=0;jc<dc.length;jc++){var Pb=dc[jc];Pb.Qz=Ub;sa.$z(Pb)}for(var Qb=a.scenes,Kb=0;Kb<Qb.length;Kb++){for(var kc=Qb[Kb],Gc=ta.Qn(kc,"ALL"),Mc=[],yb=0;yb<Gc.length;yb++)for(var Vb=Gc[yb].particle_systems,qb=0;qb<Vb.length;qb++){var zb=Vb[qb].settings;if("HAIR"==zb.type)if("OBJECT"==zb.render_type)Xa.Yq(zb.dupli_object,!0);else if("GROUP"==
zb.render_type){for(var xc=zb.dupli_group,$c=ta.Qn(kc,"EMPTY"),ec=0;ec<$c.length;ec++)$c[ec].dupli_group==xc&&Mc.push($c[ec]);for(ec=0;ec<xc.objects.length;ec++)Xa.Yq(xc.objects[ec],!0)}else Q.warn("render type",zb.render_type,"not supported for particle systems ("+zb.name+").")}for(yb=0;yb<Mc.length;yb++)I(Mc[yb],[kc])}fa(a,b.id);for(var Ic=a.scenes,ad=0;ad<Ic.length;ad++){for(var sd=Ic[ad],rc=[],yc=[],Nc=Ic[ad].objects,Ab=0;Ab<Nc.length;Ab++){var Jc=Nc[Ab];C(Nc,Jc,rc,yc);var bd=Jc.dupli_group;if(bd)for(var zc=
bd.objects,Oc=0;Oc<zc.length;Oc++)C(zc,zc[Oc],rc,yc)}for(Ab=0;Ab<yc.length;Ab++)I(yc[Ab],[sd]);for(Ab=0;Ab<rc.length;Ab++)Ea.oA(rc[Ab][0],rc[Ab][1])}fa(a,b.id);var $a=ba(a,b.id);Fa.zA($a,a.scenes);for(pa=0;pa<$a.length;pa++){var Ac=$a[pa];!m(a)&&Ac.parent&&-1<Zb.indexOf(Ac.parent.type)&&(Ac.parent="");Xa.Yq(Ac,!1);Ac.d.zd=b.id}for(var Pc=0;Pc<$a.length;Pc++){var Bc=$a[Pc];if("MESH"==Bc.type){var cd=sa.ij(Bc);if(cd){var Kc=cd.d;if(Kc.Ue){var Qc=Bc.d.Wc,dd=[],Rc;for(Rc in Qc){var pd=Qc[Rc];dd.push(4*
pd.Ui,4*pd.Es)}Kc.Lv.push(dd)}Kc.xm.push(Bc.d)}}}for(var ed=-1,Gb=0;Gb<$a.length;Gb++){var Cc=$a[Gb],Hb=Cc.d;if(Ea.lc(Cc)&&Hb.sj){var Lc=Hb.ld;Lc>ed&&(ed=Lc)}}for(Gb=0;Gb<$a.length;Gb++)if(Cc=$a[Gb],Hb=Cc.d,Ea.lc(Cc)&&Hb.sj){Hb.ld=ed;var fd=Cc,Dc=Hb.ld,gd=ab.ld,Sc=fd.d;Dc>2*gd?Ea.pa('too many bones for "'+fd.name+'"'):Dc>gd?(Q.warn('too many bones for "'+fd.name+'" / '+Dc+" bones (max "+gd+"). Blending between frames will be disabled."),Sc.dj=!1):Sc.dj=!0;Sc.dj=Sc.dj&&!wa.Ut}for(var rd=0;rd<$a.length;rd++){var qc=
$a[rd];if(Ea.lc(qc)){var Ad=qc.lod_levels.length;if(Ad)for(var jd=qc,Hc=0;Hc<Ad;Hc++){var Tc=qc.lod_levels[Hc].object;if(!Tc){jd.d.Fl=!0;jd.d.nf=qc.lod_levels[Hc].distance;break}Tc.d.Fg=qc.d.Fg;jd.d.nf=qc.lod_levels[Hc].distance;Tc.d.wj=qc.lod_levels[Hc].distance;if(qc.lod_levels[Hc+1])Tc.d.nf=qc.lod_levels[Hc+1].distance;else{Tc.d.Fl=!0;Tc.d.nf=1E4;break}jd.d.Fl=!1;jd=Tc}}}for(var td=0;td<$a.length;td++){var ja=$a[td];if(ja.b4w_vehicle){var eb=ja.b4w_vehicle_settings;if("CHASSIS"==eb.part){ja.i=
{};ja.i.Rt=eb.force_max;ja.i.Fs=eb.brake_max;ja.i.GG=eb.suspension_compression;ja.i.IG=eb.suspension_stiffness;ja.i.HG=eb.suspension_damping;ja.i.zH=eb.wheel_friction;ja.i.WM=eb.roll_influence;ja.i.AE=eb.max_suspension_travel_cm;ja.i.Dh=0;ja.i.Ni=1;ja.i.pi=0;ja.i.speed=0;ja.i.Qg=[];ja.i.Lj=[];ja.i.qi=null;for(var Bd=ja.za?ja.za.dupli_group.objects:$a,Uc=0;Uc<Bd.length;Uc++){var Sa=Bd[Uc];if(Sa.b4w_vehicle){var jb=Sa.b4w_vehicle_settings;if(da.cE(Sa)&&eb.name==jb.name){var Cd=da.AH(Sa.b4w_vehicle_settings.part);
ja.i.Qg[Cd]=Sa;ja.i.Lj[Cd]=new Float32Array(8)}else if(da.tv(Sa)&&eb.name==jb.name){ja.i.qi=Sa;ja.i.Eq=jb.steering_max;ja.i.Ix=jb.steering_ratio;ja.i.mv=jb.inverse_control;var sb=Ta.invert(ja.d.V,new Float32Array(16)),kd=Ta.multiply(sb,Sa.d.V,sb);ja.i.Kx=kd;var Vc=new Float32Array([1,0,0,0]);kb.transformMat4(Vc,kd,Vc);ja.i.Jx=Vc}else if(da.sv(Sa)&&eb.name==jb.name){ja.i.Bq=Sa;ja.i.Dx=jb.speed_ratio;ja.i.Bp=jb.max_speed_angle;var sb=Ta.invert(ja.d.V,new Float32Array(16)),ld=Ta.multiply(sb,Sa.d.V,sb);
ja.i.Fx=ld;var Wc=new Float32Array([1,0,0,0]);kb.transformMat4(Wc,ld,Wc);ja.i.Ex=Wc}else if(da.uv(Sa)&&eb.name==jb.name){ja.i.Iq=Sa;ja.i.xt=jb.delta_tach_angle;var sb=Ta.invert(ja.d.V,new Float32Array(16)),md=Ta.multiply(sb,Sa.d.V,sb);ja.i.Rx=md;var Xc=new Float32Array([1,0,0,0]);kb.transformMat4(Xc,md,Xc);ja.i.Qx=Xc}}}if(4!=ja.i.Qg.length)throw"Not enough wheels for chassis "+ja.name;}else if("HULL"==eb.part){ja.i={};ja.i.Qg=[];ja.i.Lj=[];ja.i.Rt=eb.force_max;ja.i.Fs=eb.brake_max;ja.i.yo=eb.floating_factor;
ja.i.fr=eb.water_lin_damp;ja.i.gr=eb.water_rot_damp;ja.i.Dh=0;ja.i.Ni=1;ja.i.pi=0;ja.i.speed=0;ja.i.qi=null;for(var Dd=ja.za?ja.za.dupli_group.objects:$a,Uc=0;Uc<Dd.length;Uc++)Sa=Dd[Uc],Sa.b4w_vehicle&&(jb=Sa.b4w_vehicle_settings,da.bE(Sa)&&eb.name==jb.name?(ja.i.Qg.push(Sa),ja.i.Lj.push(new Float32Array(8))):da.tv(Sa)&&eb.name==jb.name?(ja.i.qi=Sa,ja.i.Eq=jb.steering_max,ja.i.Ix=jb.steering_ratio,ja.i.mv=jb.inverse_control,sb=Ta.invert(ja.d.V,new Float32Array(16)),kd=Ta.multiply(sb,Sa.d.V,sb),ja.i.Kx=
kd,Vc=new Float32Array([1,0,0,0]),kb.transformMat4(Vc,kd,Vc),ja.i.Jx=Vc):da.sv(Sa)&&eb.name==jb.name?(ja.i.Bq=Sa,ja.i.Dx=jb.speed_ratio,ja.i.Bp=jb.max_speed_angle,sb=Ta.invert(ja.d.V,new Float32Array(16)),ld=Ta.multiply(sb,Sa.d.V,sb),ja.i.Fx=ld,Wc=new Float32Array([1,0,0,0]),kb.transformMat4(Wc,ld,Wc),ja.i.Ex=Wc):da.uv(Sa)&&eb.name==jb.name&&(ja.i.Iq=Sa,ja.i.xt=jb.delta_tach_angle,sb=Ta.invert(ja.d.V,new Float32Array(16)),md=Ta.multiply(sb,Sa.d.V,sb),ja.i.Rx=md,Xc=new Float32Array([1,0,0,0]),kb.transformMat4(Xc,
md,Xc),ja.i.Qx=Xc))}}}for(var ud=0;ud<$a.length;ud++){var sc=$a[ud];if(sc.b4w_floating){var nd=sc.b4w_floating_settings;if("MAIN_BODY"==nd.part){sc.Uc={};sc.Uc.yo=nd.floating_factor;sc.Uc.fr=nd.water_lin_damp;sc.Uc.gr=nd.water_rot_damp;sc.Uc.Ik=[];for(var Ed=sc.za?sc.za.dupli_group.objects:$a,vd=0;vd<Ed.length;vd++){var hd=Ed[vd];if(hd.b4w_floating){var Fd=hd.b4w_floating_settings;da.eE(hd)&&nd.name==Fd.name&&(sc.Uc.Ik.push(hd),hd.JA=hd.b4w_floating_settings.synchronize_position)}}}}}for(pa=0;pa<
a.scenes.length;pa++){var wd=a.scenes[pa];mb.enabled&&wd.b4w_enable_physics&&(m(a)||!da.w(x())&&wd==ta.wo(a))&&da.YD(wd)}e(b,c)}function m(a){return a==Ua?!0:!1}function x(){return ta.wo(Ua.scenes)}function u(a,b,c,d,e){!m(a)&&1<a.scenes.length&&(a.scenes=[ta.wo(a.scenes)],Q.warn("loading data contains multiple scenes.","Only the first one will be loaded."));d=x();-1==wa.Ma&&(wa.Ma=d.fps);for(var g=0;g<a.scenes.length;g++){var f=a.scenes[g];if(m(a)&&!f.camera)throw"Scene check failed: No camera";
for(var h=ta.Qn(f,"MESH"),k=0;k<h.length;k++){var l=h[k],q=Fa.rA(l);q&&(a.meshes.push(q),l.data=q)}for(var k=ba(a,b.id),l=a.meshes,q=l.slice(0),n=0;n<k.length;n++){var r=k[n];"MESH"==r.type&&(r=q.indexOf(r.data),-1<r&&q.splice(r,1))}for(n=0;n<q.length;n++)l.splice(l.indexOf(q[n]),1);m(a)?(ta.eA(f,a.textures),f.d.Di.length&&(b.$o=!0),f.b4w_enable_audio&&Da.ss(f),k=ta.Ko(f),l=f.b4w_batch_grid_size):(ta.lA(f,d,a.textures),f.b4w_enable_audio&&!d.h&&Da.ss(d),k=ta.Ko(d),l=d.b4w_batch_grid_size);q=[];qa.XC(k,
l,h,d.d.jr,d.d.ym,q,d.d.zv);m(a)?(ta.$r(f,q),ta.QC(k)):ta.$r(d,q)}d=a.materials;if(Ha.fo&&ab.dy)for(a=0;a<d.length;a++){h=d[a];k=h.texture_slots;for(g=0;g<k.length;g++)if(l=k[g],q=l.texture,"IMAGE"==q.type||"ENVIRONMENT_MAP"==q.type)f=q.image,f.wc||(-1<f.filepath.indexOf(".dds")?f.wc=!0:(f.wc=!q.b4w_disable_compression&&!l.use_map_normal&&"ENVIRONMENT_MAP"!=q.type&&!q.b4w_shore_dist_map&&"MOVIE"!=f.source,f.wc&&(f.filepath+=".dds")));if(g=h.node_tree)for(h=g.nodes,g=0;g<h.length;g++)f=h[g],"TEXTURE"==
f.type&&(k=f.texture)&&(f=k.image)&&!f.wc&&(f.wc=k.d.Ak&&!k.b4w_disable_compression&&"MOVIE"!=f.source,f.wc&&(f.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)g=a[d],g.wc=Boolean("FILE"==g.source&&-1<g.filepath.indexOf(".dds"));e(b,c)}function y(a,b,c,d,e){d=a.groups;a=a.objects;for(var g={},f={},h={},k={},m=0;m<d.length;m++){var l=d[m];g[l.uuid]=l;h[l.uuid]=l}for(m=0;m<a.length;m++)l=a[m],f[l.uuid]=l,k[l.uuid]=l;K(a,null,k,h);for(var q in h)q in g||d.push(h[q]);for(q in k)q in f||a.push(k[q]);
e(b,c)}function K(a,b,c,d){for(var e=[],g=0;g<a.length;g++){var f=a[g],h=c[f.uuid];if(f=h.proxy){b&&-1==e.indexOf(f.uuid)&&e.push(f.uuid);for(var k=c[f.uuid],m=k.constraints,f=0;f<m.length;f++){var l=Ea.fg(m[f]);l.name+="_CLONE";h.constraints.push(l)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=Ea.fg(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=h.b4w_anim_behavior,
k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(g=0;g<e.length;g++)h=Ea.Lo(a,"uuid",e[g]),-1<h&&a.splice(h,1);e={};for(g=0;g<a.length;g++)f=a[g],h=c[f.uuid],b&&(m=Ea.fg(h),h="origin_name"in h?h.origin_name:h.name,m.name=b+"*"+h,m.origin_name=h,G(m),c[m.uuid]=m,e[f.uuid]=m.uuid,f.uuid=m.uuid),h=c[f.uuid],h.dupli_group&&(f=h.dupli_group,m=d[f.uuid],k=Ea.fg(m),k.name=Ea.Fm(m.name+"_CLONE"),k.uuid=ka.gv("Group"+k.name),d[k.uuid]=k,f.uuid=k.uuid,K(k.objects,h.name,c,d));if(b)for(g=0;g<a.length;g++){f=
a[g];h=c[f.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(Q.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);m=h.constraints;for(f=0;f<m.length;f++)b=m[f],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(f=0;f<b.length;f++)d=b[f],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(f=0;f<h.length;f++)b=h[f],b.object&&b.object.uuid in e&&(b.object.uuid=
e[b.object.uuid])}for(var q in e)Oa[q]=e[q]}function G(a){a.uuid=ka.gv("Object"+a.name)}function A(a,b){for(var d=a.nodes,e=0;e<d.length;e++){var g=d[e];"TEXTURE"==g.type&&g.texture&&n(g,"texture",b);"LAMP"==g.type&&g.lamp&&(g.lamp.uuid in Oa&&(g.lamp.uuid=Oa[g.lamp.uuid]),b[g.lamp.uuid]||(g.lamp=null));"GROUP"==g.type&&g.node_group&&n(g,"node_group",b)}g=a.links;for(e=0;e<g.length;e++){var f=g[e];q(f,"from_node",d);q(f,"to_node",d);c(f,"from_socket",f.from_node.outputs);c(f,"to_socket",f.to_node.inputs)}if(d=
a.animation_data)if(d.action&&n(d,"action",b),d.nla_tracks)for(e=0;e<d.nla_tracks.length;e++)for(g=d.nla_tracks[e],f=0;f<g.strips.length;f++)g.strips[f].action&&n(g.strips[f],"action",b)}function n(a,b,c){(c=c[a[b].uuid])||Q.error("Dangling link found:",b,a);a[b]=c}function q(a,b,c){c=Ea.Rb("name",a[b].name,c);a[b]=c}function c(a,b,c){c=Ea.Rb("identifier",a[b].identifier,c);a[b]=c}function P(a,c,d,e,g,f){if(!ab.do_not_load_resources){for(var h=Y(c.r),k=a.images,m={},l=[],q=0;q<k.length;q++){var n=
k[q],r=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var p=O(n,a.textures);if(!p.length)Q.warn("image ",n.name," has no users.");else if(!(p[0].b4w_shore_dist_map||"MOVIE"===n.source&&ab.Nt)){p=ea(h+n.filepath);if("FILE"===n.source){var t=n.wc?oa.lk:oa.mk;Ha.Cp&&ab.Jm&&(p=oa.Zj(p),"dds"==p[1]?(p=oa.Zj(p[0]),p=p[0]+".min50."+p[1]+".dds"):p=p[0]+".min50."+p[1])}else"MOVIE"===n.source&&(ab.dd?(p=oa.Zj(p),p=p[0]+".altconv.seq",t=oa.nk):(p=oa.Zj(p),t=Da.lo(p[1]),p=t!=p[1]?p[0]+".altconv."+t:p[0]+"."+
t,t=oa.ok));l.push([r,t,p]);m[r]=n}}}l.length?(e.hv=0,oa.Cc(l,function(g,h,k,q){if(g){if(k==oa.ok||k==oa.nk){if(k==oa.ok)var n=g.videoWidth,p=g.videoHeight;else n=g.images[0].width,p=g.images[0].height;Q.log("%cLOAD VIDEO "+n+"x"+p,"color: #"+(2048<n||2048<p?"a00":1024<n||1024<p?"aa0":"0a0"),q);-1==q.indexOf(ya)&&Q.warn("video",q,"is not from app root.")}else b(g,q,!0);h=m[h];q=O(h,a.textures);for(n=0;n<q.length;n++){var p=q[n],r=p.image.filepath;k==oa.nk?(p.d.Sw=g.ic,ua.dk(p.d,g.images,h.wc,r)):
ua.dk(p.d,g,h.wc,r)}}g=++e.hv/l.length;f(c,d,g)},function(){Q.log("%cLOADED ALL IMAGES","color: #0a0");g(c,d)})):g(c,d)}}function O(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function F(a,b,c,d,e,g){if(!ab.do_not_load_resources){a=ba(a,b.id);for(var f=Y(b.r),h=[],m={},l=0;l<a.length;l++){var q=a[l];if(k(q)){var n=q.data.sound,p=n.uuid;"BACKGROUND_MUSIC"==Da.Po(q)?(p=Ea.Yt(),b.Wo=!0):"NONE"!=Da.Po(q)&&ab.kv&&(b.cp=!0);if(!(p in m)){m[p]=[];n=ea(f+n.filepath);switch(Da.Ax(q)){case Da.Sm:var r=
oa.mr;break;case Da.kr:r=oa.nr}var n=oa.Zj(n),t=Da.ko(n[1]),n=t!=n[1]?n[0]+".altconv."+t:n[0]+"."+t;h.push([p,r,n])}m[p].push(q)}}h.length?oa.Cc(h,function(a,e,f,k){if(a)for(Q.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(ya)&&Q.warn("sound",k,"is not from app root."),e=m[e],f=0;f<e.length;f++)Da.hH(e[f],a);a=++d.lG/h.length;g(b,c,a)},function(){Q.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,c)}}function k(a){return Da.ze(a)&&Da.Ax(a)!=Da.lr?!0:!1}function B(a,b){for(var c=ta.Bb(a,"SPEAKER",
ta.L),d=0;d<c.length;d++){var e=c[d];Da.ze(e)&&(Da.Nh(e)||b)&&Da.Rp(e)}}function J(a){a=a.d.Di;for(var b=0;b<a.length;b++)ab.dd&&a[b].use_auto_refresh?a[b].d.ei=!0:a[b].d.Oa&&a[b].use_auto_refresh&&a[b].d.Oa.play()}function h(a,b,c,d,e){tb.start();Q.log("%cSTART NLA","color: #0a0");e(b,c)}function C(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,g=0;g<e;g++){var f=b.lod_levels[g],h=f.object;if(h){var k=Ea.Qk(h);k.name=b.name+"_LOD_"+String(g+1);G(k);k.lod_levels=[];c.push([a,
k]);d.push(h);f.object=k}}}function I(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var g=d[e].dupli_group;g&&(g=g.objects,f=g.indexOf(a),-1<f&&g.splice(f,1))}var f=d.indexOf(a);-1<f&&d.splice(f,1)}}function H(a,b,c,d,e){d=!0;for(var g=0;g<a.scenes.length;g++)if(!da.eB(a.scenes[g])){d=!1;break}d&&(e(b,c),Q.log("%cPHYSICS READY","color: #0a0"))}function w(a,b,c,d,e){d=x();for(var g=0;g<a.scenes.length;g++){var f=a.scenes[g],h=m(a)?da.w(f):da.w(d)||da.w(f);m(a)||(f=d);
for(var k=0;k<Lb.length;k++)for(var l=ta.Bb(f,Lb[k],ta.L),q=0;q<l.length;q++){var n=l[q];n.d.zd==b.id&&mb.enabled&&h&&(da.We(n,f),b.sp&&da.w(n)&&da.cl(n))}}e(b,c)}function g(a,c,d,e,g){var f={};e=[];for(var h=a.scenes,k=0;k<a.scenes.length;k++){var m=h[k];if(m.d.ab&&(m=m.d.ab.wm)&&"FILE"===m.source){var l=m.uuid,q=ea(Y(c.r)+m.filepath);e.push([l,m.wc?oa.lk:oa.mk,q]);f[l]=m}}e.length?oa.Cc(e,function(c,d,e,g){if(c){b(c,g,!0);d=f[d];g=O(d,a.textures);for(e=0;e<g.length;e++){var k=g[e];ua.dk(k.d,c,d.wc,
k.image.filepath)}for(e=0;e<h.length;e++)if(g=h[e],g.d.ab.wm===d){var m=c,l=document.createElement("canvas"),k=d.size[0],q=d.size[1];l.width=k;l.height=q;l=l.getContext("2d");l.drawImage(m,0,0);m=l.getImageData(0,0,k,q).data;l=new Float32Array(4);l[0]=1/16581375;l[1]=1/65025;l[2]=1/255;l[3]=1;for(var k=k*q,q=new Float32Array(k),n=0;n<k;n++)q[n]=l[1]*m[4*n+2]+l[2]*m[4*n+3];g.d.tq=q}}},function(){g(c,d)}):g(c,d)}function M(a,c,d,e,g){if(ab.antialiasing&&ab.smaa){e=a.scenes[0];a=[];for(var f=["SMAA_EDGE_DETECTION",
"SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<f.length;h++){var k=ta.la(e,f[h]);k&&a.push(k)}if(a.length){e=[];h=oa.mk;e.push(["SEARCH_TEXTURE",h,V.cc.smaa_search_texture_path]);e.push(["AREA_TEXTURE",h,V.cc.smaa_area_texture_path]);for(h=0;h<a.length;h++)if(f=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==f.type){a=f.ra;for(h=0;h<a.length;h++)if(f=a[h],"u_search_tex"==f.ha)var m=f.sa;else if("u_area_tex"==f.ha)var l=f.sa;break}e.length?oa.Cc(e,function(a,c,d,e){a&&
(b(a,e,!1),c="SEARCH_TEXTURE"==c?m:l,c.source="IMAGE",c.xs=!0,ua.dk(c,a,-1!=e.indexOf(".dds")?1:0,e),ua.mq(c,ua.H,ua.H))},function(){g(c,d)}):g(c,d)}else g(c,d)}else g(c,d)}function L(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];m(a)||(e=x());for(var g=ta.Bb(e,"LAMP",ta.L),f=0;f<g.length;f++){var h=g[f];h.d.zd==b.id&&(b.sp&&Ea.lc(h)&&ta.nj(h),d.gn.push({Rw:e,oc:h}))}g=ta.Bb(e,"ALL",ta.L);for(f=0;f<g.length;f++)h=g[f],"LAMP"!=h.type&&h.d.zd==b.id&&(b.sp&&Ea.lc(h)&&ta.nj(h),d.gn.push({Rw:e,
oc:h}))}}function R(a,b,c,d,e,g){e=d.gn;var f=d.Vv;e.length?(a=e[f].oc,f=e[f].Rw,ta.We(f,a,!1),-1!=Eb.indexOf(a.type)&&f.b4w_enable_audio&&Da.We(a,f),ra.nv(a)&&ra.append(a),d=++d.Vv/e.length,"LAMP"==a.type&&ta.kG(f)):d=1;g(b,c,d)}function U(a,b,c,d,e){if(m(a)){d=ta.GD();for(var g=ta.jj(),f=0;f<d.length;f++){var h=d[f];ta.$E(h,g);h.b4w_use_nla&&tb.eH(h,h.b4w_nla_cyclic)}ta.iq(g)}else ta.cy(x());a=ba(a,b.id);Xa.cH(a);e(b,c)}function Z(a,b,c,d,e){if(m(a))for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||
J(a.scenes[d]),B(a.scenes[d]);else a.scenes[0].b4w_use_nla||J(x()),B(x());e(b,c)}function X(a,b,c,d,e){ab.wg&&(b.$o||b.Wo||b.cp)?pa||aa(a,e,b,c):e(b,c)}function aa(a,b,c,d){var e=Va.canvas.parentElement;Kb=e.style.zIndex;e.style.zIndex="999";pa=document.createElement("div");pa.style.position="relative";pa.style.height="88px";pa.style.width="88px";var g=Math.round(Va.canvas.offsetWidth/2-44);pa.style.top=Math.round(Va.canvas.offsetHeight/2-44).toString()+"px";pa.style.left=g.toString()+"px";pa.style.backgroundImage=
"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Ia=document.createElement("div");Ia.style.position="relative";Ia.style.height=Va.canvas.offsetHeight.toString()+"px";Ia.style.width=Va.canvas.offsetWidth.toString()+"px";Ia.style.background="rgba(0, 0, 0, 0.5)";Ia.style.zIndex="999";e.appendChild(Ia);Ia.appendChild(pa);pa.addEventListener("click",function(){c.$o&&(ua.play(),ua.pause(),ua.reset());if(c.Wo){if(m(a))for(var e=0;e<a.scenes.length;e++)B(a.scenes[e],!0);else B(x(),!0);Da.pause()}c.cp&&Da.UE();T();b(c,d)},!1)}function T(){if(pa){var a=Va.canvas.parentElement;
a.style.zIndex=Kb;Ia.removeChild(pa);a.removeChild(Ia);pa=Ia=null;Kb=0}}function Y(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function z(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function ea(a){var b=a.split("://",2);
return 1<b.length?(b[1]=z(b[1]),b.join("://")):z(a)}function la(a,b,c){sa.Na(b)&&sa.remove(b);ta.Pi(b);da.w(b)&&(da.cl(b),da.jF(b));S.qh(b)&&S.Ce(b);ta.lF(a,b,c);Da.ze(b)&&Da.nG(b);ra.nv(b)&&ra.remove(b)}function ba(a,b){gb[b]||fa(a,b);return gb[b]}function fa(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)ma(c[e].objects,0,m(a),d);gb[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],g=0;g<c.length;g++)for(var f=c[g],h=0;h<f.length;h++)gb[b].push(f[h])}function ma(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],
g=0;g<a.length;g++){var f=a[g],h=ca(f);e[h]=e[h]||[];(c||-1==Zb.indexOf(f.type))&&-1==e[h].indexOf(f)&&e[h].push(f);(f=f.dupli_group)&&ma(f.objects,b+1,c,d)}}function ca(a){return(a=a.parent||sa.ij(a))?1+ca(a):0}var ra=v("__anchors"),sa=v("__animation"),qa=v("__batch"),V=v("__config"),S=v("__controls"),E=v("__dds"),N=v("__extensions");v("__lights");var ha=v("__loader"),oa=v("__assets"),ka=v("__md5"),Xa=v("__objects"),da=v("__physics"),Q=v("__print"),Fa=v("__reformer"),na=v("__renderer"),ta=v("__scenes"),
tb=v("__nla"),Da=v("__sfx"),lb=v("__shaders"),ua=v("__textures"),nb=v("__nodemat"),Ea=v("__util"),kb=v("vec4"),Ta=v("mat4"),ab=V.q,Ha=V.ie,mb=V.Db,wa=V.he,Qb=V.pd,ia=null,gb=null,ya="",Ua=!1,Oa={},pa=null,Ia=null,Kb=0,Zb=["LAMP","CAMERA"],Lb=["MESH","CAMERA","EMPTY"],Eb=["SPEAKER"],Va=null;a.ye=function(a){return ha.ye(a)};a.update=function(){ha.fH(ia)};a.Lc=function(a){Va=a};a.bH=function(a,b){if(pa){Ia.style.height=b.toString()+"px";Ia.style.width=a.toString()+"px";var c=Math.round(a/2-44);pa.style.top=
Math.round(b/2-44).toString()+"px";pa.style.left=c.toString()+"px"}};a.load=function(a,b,c,f,k){var m={load_main:{Ra:ha.Pe,eb:!1,K:[],kb:!1,lb:500,Eb:!1,gb:p},duplicate_objects:{Ra:ha.ud,eb:!1,K:["load_main"],kb:!1,lb:50,Eb:!1,gb:y},load_binaries:{Ra:ha.Pe,eb:!1,K:["load_main"],kb:!1,lb:500,Eb:!1,gb:e},prepare_bindata:{Ra:ha.ud,eb:!1,K:["duplicate_objects","load_binaries"],kb:!1,lb:0,Eb:!1,gb:r},prepare_root_datablocks:{Ra:ha.ud,eb:!1,K:["duplicate_objects","prepare_bindata"],kb:!1,lb:150,Eb:!1,gb:t},
prepare_root_scenes:{Ra:ha.ud,eb:!1,K:["prepare_root_datablocks"],kb:!1,lb:350,Eb:!1,gb:u},load_smaa_textures:{Ra:ha.Pe,eb:!0,K:["prepare_root_scenes"],kb:!1,lb:10,Eb:!0,gb:M},load_shoremap:{Ra:ha.Pe,eb:!0,K:["prepare_root_scenes"],kb:!1,lb:10,Eb:!0,gb:g},load_textures:{Ra:ha.Pe,eb:!0,K:["prepare_root_scenes"],kb:!0,lb:500,Eb:!1,gb:P,eg:{hv:0}},wait_physics_workers:{Ra:ha.Pe,eb:!0,K:["load_shoremap"],kb:!1,lb:20,Eb:!1,dg:H},add_physics_objects:{Ra:ha.ud,eb:!1,K:["wait_physics_workers"],kb:!1,lb:20,
Eb:!1,gb:w},add_objects:{Ra:ha.ud,eb:!1,K:["add_physics_objects"],kb:!1,lb:800,Eb:!1,gb:L,dg:R,Oi:U,eg:{gn:[],Vv:0}},load_speakers:{Ra:ha.Pe,eb:!0,K:["add_objects"],kb:!0,lb:30,Eb:!1,gb:F,eg:{lG:0}},mobile_media_start:{Ra:ha.ud,eb:!ab.wg,K:["load_textures","load_speakers"],kb:!0,lb:5,Eb:!1,gb:X,dg:X},synchronize_media:{Ra:ha.ud,eb:!0,K:["mobile_media_start"],kb:!0,lb:70,Eb:!1,gb:Z},start_nla:{Ra:ha.ud,eb:!0,K:["mobile_media_start"],kb:!1,lb:5,Eb:!1,gb:h}},l=ha.Eu();l||(l=ha.OB(),ia=[],gb=[],Oa={});
ia[l.Vd.length]={};return ha.WB(m,a,b,c,d,f||Qb.us,ab.do_not_load_resources,k)};a.Gm=function(a){var b=ha.Eu();if(!b||!b.Vd.length||a&&!ha.KG(b.Vd[a]))Q.error("Unable to unload data!");else{if(0==a)Q.log("%cUNLOAD ALL","color: #00a"),ra.Y(),sa.Y(),Da.Y(),tb.Y(),ta.Y(),ha.Y(),da.Y(),Xa.Y(),Ea.Y(),na.Y(),nb.Y(),lb.Y(),S.Y(),N.Y(),oa.Y(),ua.Y(),gb=null,Oa={},Ua=!1,ia=null;else{Q.log("%cUNLOAD DATA "+a,"color: #00a");sa.iF(a);for(var b=ta.jl(),c=0;c<b.length;c++)for(var d=b[c],e=ta.Bb(d,"ALL",ta.L),g=
e.length-1;0<=g;g--){var f=e[g];if(f.d.zd==a){la(d,f,!0);e.splice(g,1);var h=ta.Bb(d,f.type,ta.L),f=h.indexOf(f);-1!=f&&h.splice(f,1)}}}T()}};a.ZE=la;a.$w=function(a){ya=a}};b4w.module.__anchors=function(a,v){function d(a,c){var d=document.createElement("div"),f=d.style;f.position="absolute";f.backgroundColor="black";f.borderRadius="20px 20px 20px 0px";f.boxShadow="0px 0px 10px rgb(180, 180, 200)";f.opacity=1;f.padding="8px 12px";f.lineHeight="15px";f.visibility="hidden";f.fontSize="12px";var m=G.parentElement;m.appendChild(d);var h=t.kj(a),l=document.createElement("span"),q=l.style;l.innerHTML=h.title||a.name;q.fontWeight="bold";q.fontSize="12px";q.lineHeight="15px";
q.color="#fff";q.fontFamily="Arial";e(l);d.appendChild(l);var n=h.description;if(n){var h=document.createElement("div"),r=h.style;r.position="absolute";r.bottom="0px";r.left="0px";r.backgroundColor="#000";r.borderRadius="20px 20px 20px 0px";r.boxShadow="0px 0px 10px rgb(180, 180, 200)";r.visibility="hidden";r.padding="8px 12px";r.overflow="hidden";r.lineHeight="15px";r.fontSize="12px";r.zIndex="2";d.appendChild(h);var g=document.createElement("span"),x=g.style;g.innerHTML=n;x.fontSize="12px";x.fontFamily=
"Arial";x.fontWeight="bold";x.lineHeight="15px";x.color="#fff";x.visibility="hidden";h.appendChild(g);var u=!1,v=!1;m.addEventListener("click",function(a){if(!(u||v||A))if(a.target!=l&&a.target!=d||"hidden"!=r.visibility||1!=f.opacity)"visible"==r.visibility&&(f.visibility="visible",q.visibility="visible",r.visibility="hidden",x.visibility="hidden");else{f.visibility="hidden";q.visibility="hidden";r.visibility="visible";u=v=!0;a=d.offsetWidth-24;var e=d.offsetHeight-16,g=Math.min(c,b(n)),h=p(n,g);
g!=a?y.bs(a,g,function(a){a==g&&("visible"==r.visibility&&(x.visibility="visible"),u=!1);r.width=a+"px"}):u=!1;h!=e?y.bs(e,h,function(a){a==h&&("visible"==r.visibility&&(x.visibility="visible"),v=!1);r.height=a+"px"}):v=!1;v||u||(x.visibility="visible")}},!1)}return d}function b(a){var b=document.createElement("div"),c=document.createElement("span"),d=b.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";c.style.color="#fff";c.style.visibility="hidden";
d.lineHeight="15px";b.appendChild(c);d.position="absolute";d.visibility="hidden";d.fontSize="12px";d.display="inline-block";d.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function p(a,b){var c=document.createElement("div"),d=document.createElement("span"),e=c.style;d.innerHTML=a;d.style.fontSize="12px";d.style.fontFamily="Arial";d.style.fontWeight="bold";d.style.color="#fff";d.style.visibility="hidden";e.lineHeight="15px";c.appendChild(d);
e.position="absolute";e.visibility="hidden";e.fontSize="12px";e.display="inline-block";e.width=b+"px";e.lineHeight="15px";document.body.appendChild(c);d=c.offsetHeight;document.body.removeChild(c);return d}function e(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}function f(){for(var a=0,b=0;b<n.length;b++)n[b].mo&&
a++;q=new Float32Array(3*a)}var r=v("__batch"),l=v("__camera"),t=v("__objects"),m=v("__print"),x=v("__renderer"),u=v("__scenes"),y=v("__time");v("__util");var K=v("__config").q,G=null,A=!1,n=[],q=new Float32Array(0),c=new Uint8Array(16),P=new Float32Array(3);a.Qb=function(a){G=a};a.append=function(a){var b;a:{for(b=0;b<n.length;b++)if(n[b].oc==a){b=!0;break a}b=!1}if(!b){b=a.b4w_anchor.detect_visibility&&Boolean(u.la(u.jj(),"ANCHOR_VISIBILITY"));b={type:a.b4w_anchor.type,oc:a,x:0,y:0,depth:0,mh:"out",
mo:b,element:null,Wh:null,Zz:a.b4w_anchor.max_width,cs:0};switch(b.type){case "ANNOTATION":b.element=d(a,b.Zz);b.cs=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.b4w_anchor.element_id),b.element||(m.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}n.push(b);f()}};a.remove=function(a){for(var b=0;b<n.length;b++){var c=n[b];if(c.oc==a){"ANNOTATION"==c.type&&G.parentElement.removeChild(c.element);n.splice(b,1);f();break}}};a.update=function(){for(var a=
0,b=0;b<n.length;b++){var c=n[b];c.mo&&(q.set(c.oc.d.g,3*a),a++);var d,e=c,f=P;d=u.kl(u.jj());f=l.Vp(d,e.oc.d.g,f);f[0]/=K.resolution_factor;f[1]/=K.resolution_factor;e=u.Ou();f[0]/=e;f[1]/=e;d=f;f=d[0];e=d[1];d=d[2];if(f!=c.x||e!=c.y||d!=c.depth){switch(c.type){case "ANNOTATION":var m=c.element;m.style.left=Math.floor(f)+"px";m.style.top=Math.floor(e-c.cs)+"px";break;case "ELEMENT":m=c.element,m.style.left=Math.floor(f-m.offsetWidth/2)+"px",m.style.top=Math.floor(e-m.offsetHeight/2)+"px"}c.x=f;c.y=
e;c.depth=d;c.Wh&&c.Wh(f,e,c.mh,c.oc,m)}}0<a&&(a=u.la(u.jj(),"ANCHOR_VISIBILITY").p[0].o,r.RG(a,q))};a.kH=function(){for(var a=0;a<n.length;a++){var b=n[a],d=b.oc,e=b.x,f=b.y,h=b.depth,h=0>e||0>f||0>h||1<h||u.hp(d)||e>=G.clientWidth||f>=G.clientHeight?"out":"visible";if(b.mo&&"out"!=h){var h=b,m=u.la(u.jj(),"ANCHOR_VISIBILITY"),l=u.Ou(),q=h.x*l,l=h.y*l,q=q*K.resolution_factor,l=l*K.resolution_factor,m=m.j;x.Fw(m.re,q,m.height-l,2,2,c);h=1020==c[0]+c[4]+c[8]+c[12]?"visible":"out"==h.mh||0==c[0]+c[4]+
c[8]+c[12]?"covered":h.mh}if(h!=b.mh){switch(b.type){case "ANNOTATION":case "ELEMENT":var p=b.element;if(!p)break;"out"==h?(p.style.visibility="hidden",p.children.length&&(p.children[0].style.visibility="hidden"),"ANNOTATION"==b.type&&1<p.children.length&&(q=p.children[1],q.style.visibility="hidden",q.children.length&&(q.children[0].style.visibility="hidden"))):"visible"==h?(p.style.visibility="visible",p.children.length&&(p.children[0].style.visibility="visible"),p.style.opacity=1):(p.style.visibility=
"visible",p.style.opacity=.1,p.children.length&&(p.children[0].style.visibility="visible"),"ANNOTATION"==b.type&&1<p.children.length&&(q=p.children[1],q.style.visibility="hidden",q.children.length&&(q.children[0].style.visibility="hidden")))}b.mh=h;b.Wh&&b.Wh(e,f,b.mh,d,p)}}};a.zJ=function(a,b){for(var c=0;c<n.length;c++)n[c].oc==a&&(n[c].Wh=b)};a.qK=function(a){for(var b=0;b<n.length;b++)n[b].oc==a&&(n[b].Wh=null)};a.Y=function(){for(var a=0;a<n.length;a++){var b=n[a];"ANNOTATION"==b.type&&G.parentElement.removeChild(b.element)}n.length=
0};a.nv=function(a){return a.b4w_anchor?!0:!1};a.pause=function(){A=!0};a.od=function(){A=!1}};b4w.module.__md5=function(a){function v(a,f){var t=a[0],m=a[1],x=a[2],u=a[3],t=b(t,m,x,u,f[0],7,-680876936),u=b(u,t,m,x,f[1],12,-389564586),x=b(x,u,t,m,f[2],17,606105819),m=b(m,x,u,t,f[3],22,-1044525330),t=b(t,m,x,u,f[4],7,-176418897),u=b(u,t,m,x,f[5],12,1200080426),x=b(x,u,t,m,f[6],17,-1473231341),m=b(m,x,u,t,f[7],22,-45705983),t=b(t,m,x,u,f[8],7,1770035416),u=b(u,t,m,x,f[9],12,-1958414417),x=b(x,u,t,m,f[10],17,-42063),m=b(m,x,u,t,f[11],22,-1990404162),t=b(t,m,x,u,f[12],7,1804603682),u=b(u,t,m,x,
f[13],12,-40341101),x=b(x,u,t,m,f[14],17,-1502002290),m=b(m,x,u,t,f[15],22,1236535329),t=p(t,m,x,u,f[1],5,-165796510),u=p(u,t,m,x,f[6],9,-1069501632),x=p(x,u,t,m,f[11],14,643717713),m=p(m,x,u,t,f[0],20,-373897302),t=p(t,m,x,u,f[5],5,-701558691),u=p(u,t,m,x,f[10],9,38016083),x=p(x,u,t,m,f[15],14,-660478335),m=p(m,x,u,t,f[4],20,-405537848),t=p(t,m,x,u,f[9],5,568446438),u=p(u,t,m,x,f[14],9,-1019803690),x=p(x,u,t,m,f[3],14,-187363961),m=p(m,x,u,t,f[8],20,1163531501),t=p(t,m,x,u,f[13],5,-1444681467),u=
p(u,t,m,x,f[2],9,-51403784),x=p(x,u,t,m,f[7],14,1735328473),m=p(m,x,u,t,f[12],20,-1926607734),t=d(m^x^u,t,m,f[5],4,-378558),u=d(t^m^x,u,t,f[8],11,-2022574463),x=d(u^t^m,x,u,f[11],16,1839030562),m=d(x^u^t,m,x,f[14],23,-35309556),t=d(m^x^u,t,m,f[1],4,-1530992060),u=d(t^m^x,u,t,f[4],11,1272893353),x=d(u^t^m,x,u,f[7],16,-155497632),m=d(x^u^t,m,x,f[10],23,-1094730640),t=d(m^x^u,t,m,f[13],4,681279174),u=d(t^m^x,u,t,f[0],11,-358537222),x=d(u^t^m,x,u,f[3],16,-722521979),m=d(x^u^t,m,x,f[6],23,76029189),t=
d(m^x^u,t,m,f[9],4,-640364487),u=d(t^m^x,u,t,f[12],11,-421815835),x=d(u^t^m,x,u,f[15],16,530742520),m=d(x^u^t,m,x,f[2],23,-995338651),t=e(t,m,x,u,f[0],6,-198630844),u=e(u,t,m,x,f[7],10,1126891415),x=e(x,u,t,m,f[14],15,-1416354905),m=e(m,x,u,t,f[5],21,-57434055),t=e(t,m,x,u,f[12],6,1700485571),u=e(u,t,m,x,f[3],10,-1894986606),x=e(x,u,t,m,f[10],15,-1051523),m=e(m,x,u,t,f[1],21,-2054922799),t=e(t,m,x,u,f[8],6,1873313359),u=e(u,t,m,x,f[15],10,-30611744),x=e(x,u,t,m,f[6],15,-1560198380),m=e(m,x,u,t,f[13],
21,1309151649),t=e(t,m,x,u,f[4],6,-145523070),u=e(u,t,m,x,f[11],10,-1120210379),x=e(x,u,t,m,f[2],15,718787259),m=e(m,x,u,t,f[9],21,-343485551);a[0]=t+a[0]&4294967295;a[1]=m+a[1]&4294967295;a[2]=x+a[2]&4294967295;a[3]=u+a[3]&4294967295}function d(a,b,d,e,f,p){b=(b+a&4294967295)+(e+p&4294967295)&4294967295;return(b<<f|b>>>32-f)+d&4294967295}function b(a,b,e,f,p,u,y){return d(b&e|~b&f,a,b,p,u,y)}function p(a,b,e,f,p,u,y){return d(b&f|e&~f,a,b,p,u,y)}function e(a,b,e,f,p,u,y){return d(e^(b|~f),a,b,p,
u,y)}var f="0123456789abcdef".split("");a.gv=function(a){var b=a,d=b.length;a=[1732584193,-271733879,-1732584194,271733878];var e;for(e=64;e<=b.length;e+=64){for(var p=b.substring(e-64,e),u=[],y=void 0,y=0;64>y;y+=4)u[y>>2]=p.charCodeAt(y)+(p.charCodeAt(y+1)<<8)+(p.charCodeAt(y+2)<<16)+(p.charCodeAt(y+3)<<24);v(a,u)}b=b.substring(e-64);p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<b.length;e++)p[e>>2]|=b.charCodeAt(e)<<(e%4<<3);p[e>>2]|=128<<(e%4<<3);if(55<e)for(v(a,p),e=0;16>e;e++)p[e]=0;p[14]=8*
d;v(a,p);for(b=0;b<a.length;b++){d=a[b];e="";for(p=0;4>p;p++)e+=f[d>>8*p+4&15]+f[d>>8*p&15];a[b]=e}return a.join("")}};b4w.module.__hud=function(a,v){function d(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){p(' SCENE "'+a.name+'"');if(a.d){var b=0,d=0;l.U(a.d.Cb,function(a,e){if("SINK"==e.type)p(" (F)",e.type);else{var f=e.type,m=Math.round(e.j.width)+"x"+Math.round(e.j.height),l=e.p.length,c=e.Ti,r=e.Cc&&e.aa;r?p(" (A)",f,e.Kg,m,c,"of",l):p(" (P)",f,e.Kg,m,c,"of",l);e.Ti=0;r&&(b+=l,d+=c)}});return[b,d]}p("No INFO")}function p(){for(var a=80+20*m[0],b=[5,18,
3,10,4,3,5],d=arguments[0],e=1;e<arguments.length;e++){for(var f="",l=0;l<b[e]-String(arguments[e]).length;l++)f+=" ";d+=f+arguments[e]}m[0]++;t.fillText(d,30,a)}function e(a,b,d){b*=a.Ga;d.x=a.x+b;d.y=a.y;d.Ga=a.Ga-2*b;d.xa=a.xa}function f(a){return a.x+a.Ga/2}function r(a){var b=t,d={x:0,y:0,Ga:0,xa:0},f=b.canvas.width,b=b.canvas.height;d.x=0;d.y=0;d.Ga=f;d.xa=b;e(d,.01,d);f=.02*d.xa;d.x=d.x;d.y+=f;d.Ga=d.Ga;d.xa-=2*f;f=d.Ga/8;d.x+=f*a;d.y=d.y;d.Ga=f;d.xa=d.xa;e(d,.02,d);return d}var l=v("__graph"),
t=null,m=[0,0];a.Qb=function(a){a=a.getContext("2d");d(a);return t=a};a.Ai=function(){t&&d(t)};a.reset=function(){var a=t;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),m[0]=0,m[1]=0)};a.fG=function(a,d){var e=t;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";p(" FPS",(1/d).toFixed(2));m[0]++;for(var f=e=0,l=0;l<a.length;l++){var r=b(a[l]),e=e+r[0],f=f+r[1];m[0]++}p(" ---------------------------------------------");
p("    ","TOTAL ACTIVE","","",f,"of",e)}};a.print=function(){var a=t;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",p.apply(Math,arguments))};a.NM=function(a,b,d,e,m,l,n){var q=t;if(q){b=r(b);var c=b.xa/5;b.x=b.x;b.y+=4*c;b.Ga=b.Ga;b.xa=c;q.textAlign="center";q.fillStyle="#00FF00";t.fillText(a,f(b),b.y-10);q.strokeStyle="#00FF00";q.lineWidth=.5;q.beginPath();q.moveTo(b.x,b.y);q.lineTo(b.x+b.Ga,b.y);q.lineTo(b.x+b.Ga,b.y+b.xa);q.lineTo(b.x,b.y+b.xa);q.closePath();q.stroke();if(!l&&!n)for(l=
1E6,n=-1E6,a=0;a<d.length;a++)l=Math.min(l,d[a]),n=Math.max(n,d[a]);q.textAlign="right";t.fillText(String(l),b.x-10,b.y+b.xa);t.fillText(String(n),b.x-10,b.y);q.textAlign="center";t.fillText(String(e),b.x,b.y+b.xa+15);t.fillText(String(m),b.x+b.Ga,b.y+b.xa+15);q.strokeStyle="#FF0000";q.lineWidth=1.5;q.beginPath();e=b.Ga/(d.length-1);n=b.xa/(n-l);for(a=0;a<d.length;a++)m=b.x+e*a,c=b.y+b.xa-(d[a]-l)*n,0==a?q.moveTo(m,c):q.lineTo(m,c);q.stroke()}};a.wK=function(a,b,d,e,m,l,n){var q=t;if(q)for(q.textAlign=
"center",q.fillStyle="#00FF00",q.font="bold 12px Courier",d=r(d),t.fillText(b?"["+a+"]":a,f(d),d.y),0<=l&&t.fillText(l?"[M]":"[ ]",f(d)-15,d.y+30),0<=n&&t.fillText(n?"[S]":"[ ]",f(d)+15,d.y+30),a={x:0,y:0,Ga:0,xa:0},b=0;b<e.length;b++){l=e[b];var c="VOLUME"==l[0];if(c){n=d.y+350;var p=d.Ga,v=a;v.x=d.x;v.y=n;v.Ga=p;v.xa=250}else{n=d.y+10+50*b;var p=d.Ga,v=d.xa,F=a;F.x=d.x;F.y=n;F.Ga=p;F.xa=v}n=q;var p=a,F=b==m,k=l[0],v=l[1],B=l[2],J=l[3],h=(J-B)/l[4],h=1>h?Math.floor(1/h-1E-5).toFixed(0).length:0;
l=l[5]?Math.log(v/B)/Math.log(J/B):(v-B)/(J-B);n.textAlign="center";F?n.fillText("["+k+"]",f(p),p.y):n.fillText(k,f(p),p.y);n.strokeStyle="#00FF00";n.lineWidth=c?3:1;c?(n.textAlign="right",n.fillText(J.toFixed(h),f(p)-10,p.y+15),n.textAlign="right",n.fillText(B.toFixed(h),f(p)-10,p.y+p.xa-15)):(n.textAlign="right",n.fillText(B.toFixed(h),p.x+28,p.y+15),n.textAlign="left",n.fillText(J.toFixed(h),p.x+p.Ga-28,p.y+15));n.beginPath();if(c){var C=p.y+15+(p.xa-30)*(1-l);n.moveTo(f(p),p.y+15);n.lineTo(f(p),
p.y+p.xa-15);n.moveTo(f(p)-5,p.y+15);n.lineTo(f(p)+5,p.y+15);n.moveTo(f(p)-5,p.y+p.xa-15);n.lineTo(f(p)+5,p.y+p.xa-15);n.moveTo(f(p)-5,C);n.lineTo(f(p)+5,C)}else{var I=p.x+30+(p.Ga-60)*l;n.moveTo(p.x+30,p.y+15);n.lineTo(p.x+p.Ga-30,p.y+15);n.moveTo(p.x+30,p.y+15-5);n.lineTo(p.x+30,p.y+15+5);n.moveTo(p.x+p.Ga-30,p.y+15-5);n.lineTo(p.x+p.Ga-30,p.y+15+5);n.moveTo(I,p.y+15-5);n.lineTo(I,p.y+15+5)}n.stroke();"EQ_Q"==k?(l=Math.log(1+1/(2*v*v)+Math.sqrt((2+1/(v*v))*(2+1/(v*v))/4-1))/Math.log(2),c?(n.textAlign=
"left",n.fillText(v.toFixed(h),f(p)+10,C),n.textAlign="left",n.fillText("("+l.toFixed(h+1)+")",f(p)+10,C+10)):(n.textAlign="right",n.fillText(v.toFixed(h),I,p.y+30),n.textAlign="left",n.fillText("("+l.toFixed(h+1)+")",I,p.y+30))):c?(n.textAlign="left",n.fillText(v.toFixed(h),f(p)+10,C)):(n.textAlign="center",n.fillText(v.toFixed(h),I,p.y+30))}}};b4w.module.__prerender=function(a,v){var d=v("__config"),b=v("__debug"),p=v("__geometry"),e=v("__util"),f=v("__renderer"),r=v("vec3"),l=d.q,t="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Up=function(a){if(-1<t.indexOf(a.type)){for(var d=!1,u=a.p,y=0;y<u.length;y++){var v=u[y],G=v,A=a,n=G.sb,q=A.j;G.aa=!0;n.Dl=!1;if(n)if(n.Kh)G.aa=!1;else{var c=q.ff,P=n.Hb.F,O=n.nf,c=Math.sqrt((P[0]-c[0])*(P[0]-c[0])+(P[1]-c[1])*
(P[1]-c[1])+(P[2]-c[2])*(P[2]-c[2])),P=n.Fg*n.Hb.Ea;c>=n.wj&&c<O+P?(n.Dl=!0,"OUTLINE_MASK"!=A.type||Boolean(n.Jd)?(q=q.Do,n.zh?n=!1:"STATIC"===n.type?(O=n.Hb,n=O.F,n=e.rG(n,q,O.Ea)):(O=n.bg,n=O.F,n=e.sC(n,q,O.Yf,O.Zf,O.$f)),n?G.aa=!1:"WIREFRAME"==A.type&&(G.aa=G.o.wireframe_mode==b.Sr.WM_DEBUG_SPHERES?G.o.yh:!G.o.yh)):G.aa=!1):G.aa=!1}else G.aa=!1;v.aa&&(d=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||d?a.aa=!0:(a.aa&&f.clear(a),a.aa=!1)}}if("MAIN_BLEND"==
a.type&&l.alpha_sort&&a.p){d=a.j.ff;u=r.dist(d,a.ty)>l.alpha_sort_threshold;for(y=0;y<a.p.length;y++)if(G=a.p[y],v=G.sb,v.Co||u){if((A=G.o)&&A.Ka&&A.Oe!=p.ee){A=A.da;if(!A||!G.aa)continue;(G=A.vl)&&G.type==p.Tr&&p.UG(A,v.V,d)}v.Co=!1}u&&a.ty.set(d)}}};b4w.module.camera=function(a,v){function d(a,c){b.Kb(a)?(t.copy(c,a.d.dc),r.B(a),p.S(a)):e.error("set_pivot(): Wrong object or camera move style")}var b=v("__camera");v("__config");var p=v("__physics"),e=v("__print"),f=v("__constraints"),r=v("__transform"),l=v("__util"),t=v("vec3"),m=v("vec4");v("quat");var x=v("mat3"),u=v("mat4"),y=new Float32Array(2),K=new Float32Array(3),G=new Float32Array(3),A=new Float32Array(4),n=new Float32Array(9);a.Uf=b.Uf;a.Xm=b.Xm;a.ta=b.ta;a.Mb=b.Mb;a.wb=b.wb;a.mf=b.mf;
a.Kb=b.Kb;a.xe=b.xe;a.rb=b.rb;a.rN=function(a,b){a.d.ia=b};a.gf=function(a){return b.mf(a)?b.gf(a):(e.error("get_move_style(): Wrong object"),null)};a.ZF=function(a,c){if(b.Kb(a)||b.xe(a)||b.rb(a)){var d=a.d;d.cr=c[0];d.br=c[1];d.dr=c[2]}else e.error("set_velocity_params(): Wrong object or camera move style")};a.mj=function(a,c){if(!b.Kb(a)&&!b.xe(a)&&!b.rb(a))return e.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var d=a.d;c[0]=d.cr;c[1]=d.br;c[2]=
d.dr;return c};a.pN=function(a,c,d,e){var f=a.d;b.EC(c,d,e,f.g,f.quat);r.B(a);p.S(a)};a.pu=function(a,c){if(b.mf(a))return c||(c=new Float32Array(3)),t.copy(a.d.g,c),c;e.error("get_eye(): Wrong object")};a.yN=d;a.EN=function(a,c,d){b.Kb(a)?(t.copy(c,a.d.g),t.copy(d,a.d.dc),r.B(a),p.S(a)):e.error("set_trans_pivot(): Wrong object or camera move style")};a.No=function(a,c){if(b.Kb(a))return c||(c=new Float32Array(3)),t.copy(a.d.dc,c),c;e.error("get_pivot(): Wrong object or camera move style")};a.YM=
function(b,c,d){e.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.Ee(b,c,d)};a.FE=function(a,c,d){if(b.Kb(a)){var f=a.d;if(f.ey){var m=x.fromMat4(f.V,n),k=t.subtract(f.g,f.dc,G);K[0]=c;K[1]=0;K[2]=d;t.scale(K,t.len(k),K);t.transformMat3(K,m,K);t.add(f.dc,K,f.dc);t.add(f.g,K,f.g);r.B(a);p.S(a)}}else e.error("move_pivot(): wrong object")};a.XM=function(b,c){e.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");a.Tg(b,
c,0)};a.lL=function(a){e.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.rb(a)?-b.kd(a,y)[1]:(e.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.jN=function(a,c){e.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.rb(a))if(a.d.mb){var d=b.kd(a,y);(d=-c-d[1])&&b.Tg(a,0,d);r.B(a);p.S(a)}else e.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else e.error("set_hover_cam_angle(): wrong object or camera move style")};
a.zD=function(a,c){if(b.rb(a))return a.d.ac?(c||(c=new Float32Array(2)),c[0]=a.d.ac.Qa,c[1]=a.d.ac.Za):e.error("get_hover_angle_limits(): camera hasn't angle limits"),c;e.error("get_hover_angle_limits(): wrong object")};a.iD=function(a){var c;if(b.rb(a)||b.Kb(a))return a.d.mb?(c||(c=new Float32Array(2)),c[0]=a.d.jg,c[1]=a.d.pe):e.error("get_cam_dist_limits(): camera hasn't distance limits"),c;e.error("get_cam_dist_limits(): wrong object")};a.WN=function(b,c){e.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");
a.ap(b,c)};a.ap=function(a,c){if(b.rb(a)){var d=a.d;if(d.mb){var f=t.subtract(c,d.g,K);t.add(f,d.Ec,d.Ec)}r.Nd(a,c);r.B(a);p.S(a)}else e.error("hover_cam_set_translation(): wrong object")};a.AD=function(a,c){if(!b.rb(a))return e.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));t.copy(a.d.Ec,c);return c};a.Xo=function(a){return b.Kb(a)||b.rb(a)?a.d.mb:(e.error("has_distance_limits(): wrong object"),null)};a.pJ=function(a,c,d,f){switch(b.gf(a)){case b.ta:case b.Mb:f|=r.an;
break;case b.wb:if(c>d){e.error("apply_vertical_limits(): wrong vertical limits");return}break;default:e.error("apply_vertical_limits(): wrong object");return}a.d.Xd={Qa:c,Za:d};b.aF(a,f==r.vk);r.B(a);p.S(a)};a.cK=function(a){a.d.Xd=null};a.mJ=function(a,c,d,f){switch(b.gf(a)){case b.ta:case b.Mb:break;case b.wb:if(c>d){e.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:e.error("apply_horizontal_limits(): wrong object");return}a.d.kc={left:c,right:d};b.XE(a,f==r.vk);
r.B(a);p.S(a)};a.ZJ=function(a){a.d.kc=null};a.yD=function(a,c){if(b.Kb(a)||b.xe(a)||b.rb(a)){var d=a.d;c=c||new Float32Array(2);if(d.kc)return c[0]=d.kc.left,c[1]=d.kc.right,c}else e.error("get_horizontal_limits(): wrong object")};a.UD=function(a){if(b.Kb(a)||b.xe(a)||b.rb(a))return Boolean(a.d.kc);e.error("has_horizontal_limits(): wrong object")};a.nJ=function(a,c,d){b.rb(a)?c<d?e.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=l.ge(c,-Math.PI,Math.PI),d=l.ge(d,-Math.PI,Math.PI),
c=l.ua(c,-Math.PI/2,0),d=l.ua(d,-Math.PI/2,0),a.d.ac={Qa:c,Za:d},b.XD(a),r.B(a),p.S(a)):e.error("apply_hover_angle_limits(): wrong object")};a.$J=function(a){b.rb(a)?a.d.ac=null:e.error("clear_hover_angle_limits(): wrong object")};a.jJ=function(a,c,d){if(b.Kb(a)||b.rb(a))if(c>d)e.error("apply_distance_limits(): wrong distance limits");else{var f=a.d;f.mb=!0;f.pe=c;f.jg=d;r.B(a);p.S(a)}else e.error("apply_distance_limits(): wrong object")};a.WJ=function(a){b.Kb(a)||b.rb(a)?a.d.mb=!1:e.error("clear_distance_limits(): wrong object")};
a.eN=function(b,c,d){e.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.Kc(b,c,Math.PI/2-d)};a.hM=function(a){l.qa(a.d.quat,l.vc,K);return 0<=K[1]?!0:!1};a.Pw=function(d,c){switch(a.gf(d)){case b.Uf:case b.Xm:break;case b.ta:b.Ee(d,c,0,void 0,void 0);break;case b.Mb:b.Kc(d,c,0,void 0,void 0);break;case b.wb:b.Tg(d,c,0,void 0,void 0);break;default:e.error("rotate_camera(): Wrong object")}r.B(d);p.S(d)};a.Ee=function(a,c,d,f,m){b.Kb(a)?(b.Ee(a,c,d,f,m),r.B(a),
p.S(a)):e.error("rotate_target_camera(): wrong object")};a.Kc=function(a,c,d,f,m){b.xe(a)?(b.Kc(a,c,d,f,m),r.B(a),p.S(a)):e.error("rotate_eye_camera(): wrong object")};a.Tg=function(a,c,d,f,m){b.rb(a)?(b.Tg(a,c,d,f,m),r.B(a),p.S(a)):e.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){e.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.Kc(b,c,-d)};a.kd=function(a,c){c||(c=new Float32Array(2));b.kd(a,c);return c};a.ll=function(a,c){c||(c=new Float32Array(2));
b.ll(a,c);return c};a.au=function(a,c){e.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.au(a,c);return c};a.lx=function(a,c){for(var d=a.d.I,e=0;e<d.length;e++){var f=d[e];f.type!=b.yb&&f.type!=b.Gb||b.UF(f,c,f.Td)}};a.Lu=function(a){a=a.d.I;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.yb||d.type==b.Gb)return d.$j}return 0};a.iM=function(a){e.error("is_underwater() deprecated, always returns false");return a.d.Yx};a.XN=function(a,c,d,e){a=a.d.I;
for(var f=0;f<a.length;f++){var k=a[f];k.rc||b.Vg(k,k.Aa);var m=K;m[0]=-c;m[1]=-d;m[2]=0;u.translate(k.va,m,k.va);u.rotateZ(k.va,e,k.va);u.multiply(k.va,k.ma,k.Mf);b.Is(k);b.Hs(k)}};a.uD=function(a){return l.em(a.d.I[0].Dc)};a.gN=function(a,c){for(var d=a.d.I,e=0;e<d.length;e++){var f=d[e];f.Dc=l.eC(c);f.rc||b.Vg(f,f.Aa);u.multiply(f.va,f.ma,f.Mf);b.Is(f);b.Hs(f)}};a.Vk=function(a,b){b||(b=l.Sa);f.Vk(a,b)};a.kO=function(a,c){if(b.Kb(a)){r.ol(c,!1,K);d(a,K);r.B(a);var f=r.Mo(c),m=b.cD(a)/2,f=f/Math.sin(m),
m=r.NE(a,K);r.Gc(a,0,f-m,0);r.B(a);p.S(a)}else e.error("zoom_object(): wrong object")};a.xN=function(d,c){if(b.mf(d)&&a.qv(d)){var f=d.d;if(b.Kb(d)){var m=t.dist(f.g,f.dc);f.Mh=c/2*f.Lh/m}else b.rb(d)&&a.Xo(d)?(m=t.distance(f.g,f.Ec),f.Mh=c/2*f.Lh/m):d.d.I[0].top=c/2;b.dH(d)}else e.error("set_ortho_scale(): wrong object")};a.tL=function(d){if(b.mf(d)&&a.qv(d))return 2*d.d.I[0].top;e.error("get_ortho_scale(): wrong object")};a.qv=function(a){if(b.mf(a))return a.d.I[0].type==b.Sc;e.error("is_ortho_camera(): wrong object")};
a.DJ=function(a,c,d,f){f||(f=new Float32Array(3));var l=a.d.I[0];switch(l.type){case b.gc:case b.de:case b.yb:case b.Gb:var k=Math.tan(l.Dc*Math.PI/360);A[0]=(2*c/l.width-1)*k*l.Aa;A[1]=-1;A[2]=(2*d/l.height-1)*k;A[3]=0;m.transformMat4(A,a.d.V,A);f[0]=A[0];f[1]=A[1];f[2]=A[2];t.normalize(f,f);return f;default:return e.error("Non-compatible camera"),f}};a.Vp=function(a,c,d){d||(d=new Float32Array(2));return b.Vp(a,c,d)}};b4w.module.config=function(a,v){var d=v("__config");a.Wf=d.Wf;a.Vf=d.Vf;a.gh=d.gh;a.Lr=d.Lr;a.set=d.set;a.get=d.get;a.reset=d.reset;a.Ku=d.Ku};b4w.module.constraints=function(a,v){var d=v("__camera"),b=v("__constraints"),p=v("__physics"),e=v("__transform");a.gJ=function(a,d,l,t,m){m=m||1;d instanceof Array&&2==d.length?b.es(a,d[0],d[1],l,t,m):b.fs(a,d,l,t,m);e.B(a);p.S(a)};a.eJ=function(a,d,l,t){b.hA(a,d,l,t);e.B(a);p.S(a)};a.fJ=function(a,r,l,t,m,x,u,y){if(!d.xe(a))return m_print.error("append_semi_stiff_cam(): Wrong object"),null;b.gA(a,r,l,t,m,x,u,y);e.B(a);p.S(a)};a.dJ=function(a,d,l,t){if(!t||0>t)t=.25;b.fA(a,d,l,t);e.B(a);p.S(a)};
a.iA=function(a,d){b.jA(a,d);e.B(a);p.S(a)};a.bJ=function(a,d,l){b.bA(a,d,l);e.B(a);p.S(a)};a.hJ=function(a,d,l,t){b.kA(a,d,l,t);e.B(a);p.S(a)};a.iJ=function(a,d){3==d.length?b.nA(a,d):b.mA(a,d);e.B(a);p.S(a)};a.cJ=function(a,d,l,t){3==d.length?b.dA(a,d,l,t):b.cA(a,d,l,t);e.B(a);p.S(a)};a.gs=function(a,d,l){b.gs(a,d,l);e.B(a);p.S(a)};a.remove=function(a){a.Ta&&b.remove(a)};a.yu=b.yu};b4w.module.controls=function(a,v){var d=v("__controls"),b=v("__print");a.ca=d.ca;a.Um=d.Um;a.td=d.td;a.sd=d.sd;a.cI=8;a.NI=9;a.kI=13;a.KI=16;a.gI=17;a.aI=18;a.GI=19;a.eI=20;a.mI=27;a.MI=32;a.wr=37;a.zr=38;a.xr=39;a.vr=40;a.vI=96;a.wI=97;a.xI=98;a.yI=99;a.zI=100;a.AI=101;a.BI=102;a.CI=103;a.DI=104;a.EI=105;a.tr=65;a.bI=66;a.My=67;a.ur=68;a.jI=69;a.Ny=70;a.oI=71;a.qI=72;a.rI=73;a.sI=74;a.Oy=75;a.Py=76;a.tI=77;a.uI=78;a.FI=79;a.Ry=80;a.II=81;a.Sy=82;a.yr=83;a.Uy=84;a.OI=85;a.QI=86;a.Ar=87;a.RI=88;a.SI=
89;a.TI=90;a.SH=49;a.TH=50;a.UH=51;a.VH=52;a.WH=53;a.XH=54;a.YH=55;a.ZH=56;a.$H=57;a.iI=110;a.JI=186;a.lI=187;a.fI=188;a.hI=189;a.HI=190;a.nI=191;a.pI=192;a.Qy=219;a.dI=220;a.Ty=221;a.LI=222;a.uk=d.uk;a.tk=d.tk;a.sk=d.sk;a.ht=d.ht;a.Ua=d.Ua;a.Wn=d.Wn;a.gt=d.gt;a.mt=d.mt;a.Wk=d.Wk;a.Xn=d.Xn;a.wh=d.wh;a.Ri=d.Ri;a.Zk=d.Zk;a.kt=d.kt;a.pt=d.pt;a.it=d.it;a.jt=d.jt;a.ot=function(a,b){return d.ot(a,b||!1)};a.Mw=d.Mw;a.uh=d.uh;a.nt=d.nt;a.Yn=function(a,b){return d.Yn(a,b||!1)};a.bN=function(a,b){d.FF(a,b)};
a.eL=function(a){return a.value};a.Pb=d.Pb;a.te=d.te;a.kK=function(a,e,f){b.error("create_sensor_lock() deprecated");a.wp=e.slice(0);a.vp=Array(e.length);a.Gl=f||d.io};a.QM=function(a){b.error("remove_sensor_lock() deprecated");a.wp=null;a.vp=null;a.Gl=null};a.M=function(a,b,f,r,l,t,m){l=l||d.io;d.M(a,b,f,r,l,t,void 0===m?null:m)};a.vh=function(a,b,f,r,l){var t;r=d.Ua(r);d.M(a,b,f,[r],d.io,l,void 0===t?null:t)};a.RJ=function(a){return d.qh(a,null)};a.qh=d.qh;a.RM=function(a){b.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");
d.Ce(a,null)};a.Ce=d.Ce;a.reset=d.reset;a.$p=d.$p;a.aq=function(a,b,f){d.aq(a,b,!!f)};a.cq=d.cq;a.bq=d.bq;a.im=d.im;a.Rq=d.Rq;a.Sq=d.Sq;a.Uq=d.Uq;a.$x=d.im;a.Tq=d.Tq};b4w.module.data=function(a,v){var d=v("__data");v("__print");v("__util");a.load=d.load;a.Gm=function(a){d.Gm(a|0)};a.$w=d.$w;a.ye=d.ye;a.pM=d.load;a.Y=a.Gm};b4w.module.debug=function(a,v){v("__batch");v("__config");var d=v("__controls"),b=v("__debug"),p=v("__physics"),e=v("__print"),f=v("__scenegraph"),r=v("__scenes"),l=v("__shaders"),t=v("__sfx"),m=v("__textures"),x=v("__util"),u=v("vec3");a.MM=function(){p.aC()};a.LM=function(a){e.log("O",p.GC(a));for(var b=p.aD().l.p,d=0;d<b.length;d++){var f=b[d];f.Db.P==a&&e.log("B",f)}};a.iO=function(){for(var a=r.A(),b=r.Bb(a,"MESH",r.L),a=r.la(a,"MAIN_OPAQUE").p,d=0;d<b.length;d++){var f=b[d],m=f.d;if("DYNAMIC"==
m.type)for(var l=0;l<a.length;l++){var c=a[l];if(c.aa&&c.sb==m){e.log(f.name,f);break}}}};a.DM=function(a){for(var b=r.A(),d=r.Bb(b,"MESH",r.L),f=0;f<d.length;f++){var m=d[f];if(m.name==a){e.log("Object",m);for(var l=r.Go(b),c=0;c<l.length;c++){for(var p=l[c],t=p.p,u=[],k=0;k<t.length;k++)t[k].sb==m.d&&u.push(t[k]);e.log("Subscene "+p.type,u)}}}};a.EM=function(){var a=r.A();console.log("Armatures: "+r.Bb(a,"ARMATURE",r.L).length);console.log("Cameras: "+r.Bb(a,"CAMERA",r.L).length);console.log("Curves: "+
r.Bb(a,"CURVE",r.L).length);console.log("Empties: "+r.Bb(a,"EMPTY",r.L).length);console.log("Lamps: "+r.Bb(a,"LAMP",r.L).length);console.log("Meshes: "+r.Bb(a,"MESH",r.L).length);console.log("Speakers: "+r.Bb(a,"SPEAKER",r.L).length)};a.Mp=function(){for(var a=0,b=r.A(),b=[r.la(b,"MAIN_OPAQUE"),r.la(b,"MAIN_BLEND")],d=0;d<b.length;d++){var e=b[d];if(e)for(var e=e.p,f=0;f<e.length;f++){var m=e[f].o;m&&(a+=m.Mp)}}return a};a.yj=function(){for(var a=0,b=r.A(),b=[r.la(b,"MAIN_OPAQUE"),r.la(b,"MAIN_BLEND")],
d=0;d<b.length;d++){var e=b[d];if(e)for(var e=e.p,f=0;f<e.length;f++){var m=e[f].o;m&&(a+=m.yj)}}return a};a.yM=function(){var a=r.A(),a=[r.la(a,"MAIN_OPAQUE"),r.la(a,"MAIN_BLEND")];return a[0].p.length+a[1].p.length};a.AM=function(){return x.Dd(l.kD())};a.VK=function(){for(var a=r.A(),b=r.Go(a),a={},d=0;d<b.length;d++){var e=b[d];if("SINK"!=e.type&&"WIREFRAME"!=e.type)for(var f=e.p,m=0;m<f.length;m++){var c=f[m].o,l=f[m].sb;c&&("COLOR_PICKING"!=e.type&&"OUTLINE_MASK"!=e.type||l.Ql||l.Pl)&&(a[c.id]=
c)}}var f=e=d=b=0,p;for(p in a)c=a[p],c=c.da,c.al&&(e++,f+=c.al/1048576),b++,d+=c.vt/1048576;return{vbo_number:b,vbo_memory:d,ibo_number:e,ibo_memory:f}};a.BM=function(){for(var a=[],b=0,d=r.A(),d=[r.la(d,"MAIN_OPAQUE"),r.la(d,"MAIN_BLEND")],e=0;e<d.length;e++){var f=d[e];if(f)for(var f=f.p,m=0;m<f.length;m++){var c=f[m].o;if(c)for(var c=c.X,l=0;l<c.length;l++){var p=c[l];if("IMAGE"===p.source||"ENVIRONMENT_MAP"===p.source){var t=p.$a;-1===a.indexOf(t)&&(a.push(t),p=p.width*p.height*4/1048576/p.Rn,
p*=1.3333,b+=p)}}}}return{number:a.length,memory:b}};a.zM=function(){for(var a=[],b=0,d=r.A(),d=r.Go(d),e=0;e<d.length;e++){var f=d[e];if("SINK"!=f.type){var l=f.j,c=[l.Ib,l.Yc];c.push.apply(c,f.Ud);for(f=0;f<c.length;f++){var p=c[f];m.tj(p)&&-1==a.indexOf(p)&&(a.push(p),b+=l.width*l.height*m.LD(p))}}}return{number:a.length,memory:b/1024/1024}};a.sE=function(){var a=r.A();(a=r.la(a,"MAIN_OPAQUE"))&&r.Jv(a.j,a,[1,1,0])};a.vE=function(){var a=r.A(),b=r.la(a,"MAIN_OPAQUE"),a=r.DG(a,["SHADOW_CAST"]);
if(b)for(var d=0;d<a.length;d++){var e=a[d],f;switch(d){case 0:f=[1,0,0];break;case 1:f=[0,1,0];break;case 2:f=[0,0,1];break;default:f=[1,0,1]}r.Jv(e.j,b,f)}};a.ZM=function(){for(var a=r.jl(),b=0;b<a.length;b++)e.log("\n"+f.ZB(r.Ko(a[b])))};a.$M=function(){};a.fK=d.debug;a.CM=function(a,b){return u.dist(a.d.g,b.d.g)};a.Nv=b.Nv;a.gl=b.gl;a.vw=b.vw;a.Sp=b.Sp;a.GK=function(a,d){function e(){b.gl("FBRES",a());setTimeout(e,d)}d||(d=16);e()};a.qJ=function(){var a=new Float32Array(3),b=new Float32Array([0,
0,0,1]),d=new Float32Array([1,0,0]),e=new Float32Array([0,1,0]),f=new Float32Array([0,0,1]),m=new Float32Array([-1,0,0]),c=new Float32Array([0,-1,0]),l=new Float32Array([0,0,-1]);if(!x.Ze(a,x.Nz))throw"Wrong VEC3_IDENT";if(!x.Ze(b,x.Hz))throw"Wrong QUAT4_IDENT";if(!x.Ze(d,x.Qe))throw"Wrong AXIS_X";if(!x.Ze(e,x.Sa))throw"Wrong AXIS_Y";if(!x.Ze(f,x.rd))throw"Wrong AXIS_Z";if(!x.Ze(m,x.Tm))throw"Wrong AXIS_MX";if(!x.Ze(c,x.vc))throw"Wrong AXIS_MY";if(!x.Ze(l,x.Sf))throw"Wrong AXIS_MZ";};a.xM=function(){for(var a=
t.pl(),b=0;b<a.length;b++){var d=a[b];"BACKGROUND_MUSIC"==t.Po(d)&&t.xj(d,!0)}};a.Ps=function(a){b.Ps(a)};a.dN=function(a){var b=r.A();if(b=r.la(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&r.bG(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&r.aG(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.gL=function(){return e.rD()};a.LL=function(){return e.ND()};a.Vs=function(){return e.Vs()}};b4w.module.main=function(a,v){function d(){}function b(){}function p(){}function e(){window.performance||(c.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(c.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});R.mx(0)}function f(a,d){a.addEventListener("webglcontextlost",function(a){a.preventDefault();c.error("WebGL context lost");m()},!1);k.Lc(d);var e=k.Cu();e&&c.log("%cRENDERER INFO:","color: #00a",
d.getParameter(e.UNMASKED_VENDOR_WEBGL)+", "+d.getParameter(e.UNMASKED_RENDERER_WEBGL));H.Lc(d);B.Lc(d);L.Lc(d);M.Lc(d);F.Lc(d);O.Lc(d);w.rx(a.width,a.height,1,r("x"),r("y"));g.Qb();b=K();u()}function r(a){if("x"==a)var b=Y.offsetLeft;else if("y"==a)b=Y.offsetTop;else return 0;return l(b,Y,a)}function l(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=l(a+d,b,c)}return a}function t(){d=function(){}}function m(){x()||(la=performance.now()/1E3,g.pause(),
I.pause(),L.pause(),G.pause())}function x(){return ba<la}function u(){sa(u);var a=performance.now()/1E3;ea||(ea=a);var c=a-ea;if(!(c<1/T.Hd)){for(var d=R.Ih(),e=0;e<fa.length;e++)fa[e](d,c);x()||(ba>ea&&(c-=ba-Math.max(la,ea)),d+=c,R.mx(d),F.update(),C.update(),O.update(),y(d,c),b(c));ea=a}}function y(a,b){O.ye()&&(J.reset(),U.update(b),h.update(a,b),g.update(a,b),b&&A.update(b),O.ye()&&(I.update(a,b),O.ye()&&(d(b,a),O.ye()&&(P.update(a,b),O.ye()&&(G.update(),w.update(a,b),G.kH(),ma&&(ma(Y.toDataURL()),
ma=null))))))}function K(){var a=60,b=0,c=T.St,d=T.IC;return function(e){a=Z.Ub(1/e,a,e,c);e=I.vD();b=(b+1)%d;0==b&&p(Math.round(a),e)}}var G=v("__anchors"),A=v("__animation"),n=v("__compat"),q=v("__config"),c=v("__print"),P=v("__controls"),O=v("__data"),F=v("__debug"),k=v("__extensions"),B=v("__geometry"),J=v("__hud"),h=v("__nla"),C=v("__assets"),I=v("__physics"),H=v("__renderer"),w=v("__scenes"),g=v("__sfx"),M=v("__shaders"),L=v("__textures"),R=v("__time"),U=v("__transform"),Z=v("__util"),X=v("__version"),
aa=q.context,T=q.q,Y=null,z=null,ea=0,la=0,ba=0,fa=[],ma=null,ca=["webgl","experimental-webgl"],ra=null,sa=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/T.Hd)}}();a.Qb=function(a,b){q.RF();c.$F(T.console_verbose);var d=X.version()+" "+X.type()+" ("+X.eo()+")";c.log("%cINIT ENGINE","color: #00a",d);if(!window.WebGLRenderingContext)return null;
e();Y=a;n.qA();for(var d=null,g=0;g<ca.length;g++){var h=ca[g];try{d=a.getContext(h,aa)}catch(m){}if(d)break}if(!d)return null;ra=d;f(Y,d);q.tA();n.OF(d);c.log("%cSET PRECISION:","color: #00a",T.precision);b?(J.Qb(b),z=b):(q.q.show_hud_debug_info=!1,q.pd.Ll=!1);G.Qb(a);return d};a.kq=function(a){F.kq(a)};a.resize=function(a,b,d){!1!==d&&(Y.style.width=a+"px",Y.style.height=b+"px",z&&(z.style.width=a+"px",z.style.height=b+"px"));z&&(z.width=a,z.height=b,J.Ai());if(navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))T.canvas_resolution_factor=1;d=a*T.canvas_resolution_factor;b*=T.canvas_resolution_factor;T.allow_hidpi&&1<window.devicePixelRatio&&(d*=window.devicePixelRatio,b*=window.devicePixelRatio);Y.width=d;Y.height=b;if(d>ra.drawingBufferWidth||b>ra.drawingBufferHeight){c.warn("Canvas size exceeds platform limits, downscaling");var e=Math.min(ra.drawingBufferWidth/d,ra.drawingBufferHeight/b);d*=e;b*=e;Y.width=d;Y.height=b}w.rx(d,b,d/a,
r("x"),r("y"));w.ea()&&U.B(w.A().camera);y(R.Ih(),0);O.bH(Y.width,Y.height)};a.LF=function(a){p=a};a.XJ=function(){p=function(){}};a.tN=function(a){c.error("set_on_before_render_callback() deprecated, use set_render_callback() instead");d=a};a.SF=function(a){d=a};a.aK=function(){c.error("clear_on_before_render_callback() deprecated, use clear_render_callback() instead");t()};a.bK=function(){t()};a.ML=function(){return R.Ih()};a.OM=function(){c.error("redraw() deprecated");y(R.Ih(),0)};a.pause=m;a.od=
function(){x()&&(ba=performance.now()/1E3,g.od(),I.od(),L.play(!0),G.od())};a.Cl=x;a.reset=function(){O.Gm(0);z=Y=null;ba=la=ea=0;p=function(){};b=function(){};d=function(){};fa.length=0;ra=null;R.reset()};a.EJ=function(a){ma=a};a.bL=function(){return Y};a.yt=function(){return n.yt()};a.ds=function(a){for(var b=0;b<fa.length;b++)if(fa[b]==a)return;fa.push(a)};a.kF=function(a){for(var b=0;b<fa.length;b++)if(fa[b]==a){fa.splice(b,1);break}}};b4w.module.physics=function(a,v){var d=v("__print"),b=v("__physics"),p=v("__util");a.vy=0;a.CH=1;a.BH=2;a.qr=3;a.Et=function(a){b.w(a)?b.Et(a):d.error("No physics for object "+a.name)};a.cl=function(a){b.w(a)?b.cl(a):d.error("No physics for object "+a.name)};a.w=function(a){return b.w(a)};a.Zo=function(a){return b.Zo(a)};a.cv=function(a){return b.cv(a)};a.fx=function(a,f){b.w(a)?b.fx(a,f):d.error("No physics for object "+a.name)};a.cN=function(a,f,p){b.w(a)?b.s("set_damping",a.l.P,f,p):d.error("No physics for object "+
a.name)};a.TM=function(a){if(b.w(a)){var f=a.game;b.s("set_damping",a.l.P,f.damping,f.rotation_damping)}else d.error("No physics for object "+a.name)};a.om=function(a,f,p){b.w(a)?b.om.apply(this,arguments):d.error("No physics for object "+a.name)};a.S=function(a){b.w(a)?b.S(a):d.error("No physics for object "+a.name)};a.os=function(a){b.w(a)?b.os.apply(this,arguments):d.error("No physics for object "+a.name)};a.ps=function(a){b.w(a)?b.ps.apply(this,arguments):d.error("No physics for object "+a.name)};
a.js=function(a,f,p,l){b.w(a)?b.js.apply(this,arguments):d.error("No physics for object "+a.name)};a.ns=function(a,f,p,l){b.w(a)?b.ns.apply(this,arguments):d.error("No physics for object "+a.name)};a.Ci=function(a,f){b.w(a)?(b.mc(a)||b.nc(a)||d.error("Wrong object"),b.Ci(a,p.ua(f,-1,1))):d.error("No physics for object "+a.name)};a.hO=function(a,f,r){if(b.w(a)){b.mc(a)||b.nc(a)||d.error("Wrong object");f=p.ua(f,0,1);var l=a.i.Dh;-1==r||1==r?l=Math.max(-1,Math.min(l+r*f,1)):0==r&&0<=l?(l-=f,l=Math.max(0,
l)):0==r&&0>l?(l+=f,l=Math.min(0,l)):d.error("Wrong steering direction");b.Ci(a,p.ua(l,-1,1))}else d.error("No physics for object "+a.name)};a.Bi=function(a,f){b.w(a)?(b.mc(a)||b.nc(a)||d.error("Wrong object"),b.Bi(a,p.ua(f,-1,1))):d.error("No physics for object "+a.name)};a.gO=function(a,f,r){if(b.w(a)){b.mc(a)||b.nc(a)||d.error("Wrong object");f=p.ua(f,0,1);var l=a.i.pi;-1==r||1==r?l=Math.max(-1,Math.min(l+r*f,1)):0==r&&0<=l?(l-=f,l=Math.max(0,l)):0==r&&0>l?(l+=f,l=Math.min(0,l)):d.error("Wrong steering direction");
b.Bi(a,p.ua(l,-1,1))}else d.error("No physics for object "+a.name)};a.ar=function(a,f){b.w(a)?(b.mc(a)||b.nc(a)||d.error("Wrong object"),b.ar(a,p.ua(f,0,1))):d.error("No physics for object "+a.name)};a.fO=function(a,f){if(b.w(a)){b.mc(a)||b.nc(a)||d.error("Wrong object");f=p.ua(f,-1,1);var r=a.i.Ni;b.ar(a,p.ua(r+r*f,0,1))}else d.error("No physics for object "+a.name)};a.mc=function(a){return b.mc(a)};a.nc=function(a){return b.nc(a)};a.HL=function(a){if(!b.w(a))return d.error("No physics for object "+
a.name),null;if(b.mc(a)||b.nc(a))return a.b4w_vehicle_settings.name;d.error("Wrong object");return null};a.JL=function(a){if(!b.w(a))return d.error("No physics for object "+a.name),null;if(b.mc(a)||b.nc(a))return a.i.Dh;d.error("Wrong object")};a.IL=function(a){if(!b.w(a))return d.error("No physics for object "+a.name),null;if(b.mc(a)||b.nc(a))return a.i.pi;d.error("Wrong object")};a.GL=function(a){if(!b.w(a))return d.error("No physics for object "+a.name),null;if(b.mc(a)||b.nc(a))return a.i.Ni;d.error("Wrong object")};
a.Nu=function(a){if(!b.w(a))return d.error("No physics for object "+a.name),null;if(b.mc(a)||b.nc(a))return b.Nu(a);d.error("Wrong object")};a.oj=function(a){return b.oj(a)};a.jq=function(a,f,p){b.w(a)?b.jq(a,f,p):d.error("No physics for object "+a.name)};a.mm=function(a,f){b.w(a)?b.mm(a,f):d.error("No physics for object "+a.name)};a.Yw=function(a,f){b.w(a)?b.Yw(a,f):d.error("No physics for object "+a.name)};a.Xw=function(a,f){b.w(a)?b.Xw(a,f):d.error("No physics for object "+a.name)};a.Uw=function(a,
f){b.w(a)?b.Uw(a,f):d.error("No physics for object "+a.name)};a.Ns=function(a){b.w(a)?b.Ns(a):d.error("No physics for object "+a.name)};a.Os=function(a,f,p){b.w(a)?b.Os(a,f,p):d.error("No physics for object "+a.name)};a.IF=function(a,f){b.w(a)?b.IF(a,f):d.error("No physics for object "+a.name)};a.nm=function(a,f,p){b.w(a)?b.nm(a,f,p):d.error("No physics for object "+a.name)};a.Ww=function(a,f){b.w(a)?b.Ww(a,f):d.error("No physics for object "+a.name)};a.Vw=function(a,f){b.w(a)?b.Vw(a,f):d.error("No physics for object "+
a.name)};a.mn=function(a,f,p,l){b.w(a)?b.mn(a,f,p,l||!1):d.error("No physics for object "+a.name)};a.dq=function(a,f){b.w(a)?b.dq(a,f):d.error("No physics for object "+a.name)};a.pn=function(a,f){b.w(a)?b.pn(a,f):d.error("No physics for object "+a.name)};a.Ln=function(a){b.w(a)?b.Ln(a):d.error("No physics for object "+a.name)};a.on=function(a,f,p,l,t,m){b.w(a)?b.on(a,f,p,l,t,m):d.error("No physics for object "+a.name)};a.eq=function(a,f,p,l,t){b.w(a)?b.eq(a,f,p,l,t):d.error("No physics for object "+
a.name)};a.hs=function(a,f,p,l,t,m,x,u,v,K){b.w(f)&&b.w(t)?b.hs(a,f,p,l,t,m,x,u,v,K):d.error("Wrong objects")};a.Us=function(a){b.w(a)&&b.SD(a)?b.Us(a):d.error("Wrong object")};a.yw=function(a,f,p,l,t,m){b.w(a)&&b.w(l)?b.yw(a,f,p,l,t,m):d.error("Wrong objects")}};b4w.module.scenes=function(a,v){var d=v("__batch"),b=v("__camera"),p=v("__graph"),e=v("__objects"),f=v("__print"),r=v("__physics"),l=v("__scenes"),t=v("__util");a.L=l.L;a.iq=function(a){var b=l.jl();l.iq(t.Rb("name",a,b))};a.A=function(){return l.ea()?l.A().name:""};a.yL=function(){for(var a=l.jl(),b=[],d=0;d<a.length;d++)b.push(a[d].name);return b};a.hj=function(){if(l.ea())return l.kl(l.A());f.error("No active scene");return!1};a.oL=function(a,b){var d=l.Ed(l.Tf,a,b|0);if(d)return d;f.error("get object "+
a+": not found")};a.mL=function(a,b,d){if(a=l.Ed(l.Vm,a,b,d|0))return a;f.error("get object "+b+": not found")};a.nL=function(a,b){var d=l.Ed(l.Wm,a,b|0);if(d)return d;f.error("get object "+a+": not found")};a.xu=function(a){return l.xu(a)};a.bm=l.bm;a.IM=function(a){return a&&a.d&&a.d.Lb};a.QF=function(a,b){a&&a.d&&a.d.Lb?a.d.Jd=b:f.error("set_outline_intensity(): wrong object")};a.ED=function(a){a&&a.d&&a.d.Lb||f.error("get_outline_intensity(): wrong object")};a.nh=function(a,b,d,e){a&&a.d&&a.d.Lb?
l.nh(a,b,d,e):f.error("apply_outline_anim(): wrong object")};a.sA=function(a){if(a&&a.d&&a.d.Lb){var b=a.d.Cj;l.nh(a,b.Rl,b.Tl,b.Ul)}else f.error("apply_outline_anim_def(): wrong object")};a.Pi=function(a){a&&a.d&&a.d.Lb?l.Pi(a):f.error("clear_outline_anim(): wrong object")};a.oq=l.oq;a.DD=function(a){var b=l.A();if(b=l.la(b,"OUTLINE"))a=a||new Float32Array(3),a.set(b.sf)};a.iN=function(b,d){f.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.QF(b,d)};a.kL=function(b){f.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.ED(b)};a.kJ=function(b,d,e,l){f.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.nh(b,d,e,l)};a.lJ=function(b){f.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.sA(b)};a.YJ=function(b){f.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.Pi(b)};a.hN=function(b){f.error("set_glow_color() deprecated, use set_outline_color() instead");a.oq(b)};a.jL=function(b){f.error("get_glow_color() deprecated, use get_outline_color() instead");
a.DD(b)};a.zL=function(){if(!l.ea())return f.error("No active scene"),!1;var a=l.A(),b=l.la(a,"SHADOW_CAST");if(!b)return null;var d=a.d.Od,e=l.la(a,"MAIN_OPAQUE"),p=l.la(a,"DEPTH"),t={};t.csm_resolution=d.csm_resolution;t.self_shadow_polygon_offset=b.self_shadow_polygon_offset;p&&(t.self_shadow_normal_offset=p.self_shadow_normal_offset);t.enable_csm=d.enable_csm;t.csm_num=d.csm_num;t.csm_first_cascade_border=d.csm_first_cascade_border;t.first_cascade_blur_radius=d.first_cascade_blur_radius;t.csm_last_cascade_border=
d.csm_last_cascade_border;t.last_cascade_blur_radius=d.last_cascade_blur_radius;t.fade_last_cascade=d.fade_last_cascade;t.blend_between_cascades=d.blend_between_cascades;d.enable_csm?(t.csm_borders=l.mD(a,e.j),t.blur_radii=new Float32Array(d.csm_num),t.blur_radii.set(e.j.am.subarray(0,d.csm_num))):(t.csm_borders=null,t.blur_radii=null);return t};a.CN=function(a){if(!l.ea())return f.error("No active scene"),!1;var e=l.A();"number"==typeof a.self_shadow_polygon_offset&&p.U(e.d.Cb,function(b,d){"SHADOW_CAST"===
d.type&&(d.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var t=l.la(e,"DEPTH");t&&("number"==typeof a.self_shadow_normal_offset&&(t.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(t.pcf_blur_radius=a.pcf_blur_radius));var r=l.la(e,"MAIN_BLEND");r&&("number"==typeof a.self_shadow_normal_offset&&(r.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(r.pcf_blur_radius=a.pcf_blur_radius),r.Ia=!0);r=e.d.Od;
"number"==typeof a.csm_first_cascade_border&&(r.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(r.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(r.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(r.last_cascade_blur_radius=a.last_cascade_blur_radius);if(t){for(var v=t.p,G=0;G<v.length;G++){var A=v[G];A.sb.Tb&&(A=A.o,d.tn(A,r),d.Wb(A))}t.Ia=!0}t=e.camera.d.I;
for(G=0;G<t.length;G++)b.Wq(t[G],r);l.hq(e)};a.ou=function(){if(!l.ea())return f.error("No active scene"),!1;var a=l.A();return l.ou(a)};a.bx=function(a,b,d){if(!l.ea())return f.error("No active scene"),!1;var e=l.A();l.bx(e,parseFloat(a),b,d)};a.tu=function(a){if(!l.ea())return f.error("No active scene"),!1;var b=l.A();return l.tu(b,a)};a.dx=function(a){if(!l.ea())return f.error("No active scene"),!1;var b=l.A();l.dx(b,a)};a.Ju=function(){if(!l.ea())return f.error("No active scene"),!1;var a=l.A();
return l.Ju(a)};a.kx=function(a){if(!l.ea())return f.error("No active scene"),!1;var b=l.A();l.kx(b,a)};a.cL=function(){if(!l.ea())return f.error("No active scene"),null;var a=l.A(),a=l.la(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.aN=function(a){if(!l.ea())return f.error("No active scene"),null;var b=l.A(),b=l.la(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=
a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.Ia=!0};a.Hu=function(){if(!l.ea())return f.error("No active scene"),!1;var a=l.A();return l.Hu(a)};a.ix=function(a){if(!l.ea())return f.error("No active scene"),!1;var b=l.A();l.ix(b,a)};a.lu=function(){if(!l.ea())return f.error("No active scene"),!1;var a=l.A();return l.la(a,"DOF")?l.lu(a):null};a.ax=function(a){if(!l.ea())return f.error("No active scene"),
!1;var b=l.A();l.ax(b,a)};a.uu=function(){if(!l.ea())return f.error("No active scene"),!1;var a=l.A();return l.la(a,"GOD_RAYS")?l.uu(a):null};a.ex=function(a){if(!l.ea())return f.error("No active scene"),!1;var b=l.A();l.ex(b,a)};a.hu=function(){if(!l.ea())return f.error("No active scene"),!1;var a=l.A();return l.la(a,"BLOOM")?l.hu(a):null};a.Tw=function(a){if(!l.ea())return f.error("No active scene"),!1;var b=l.A();l.Tw(b,a)};a.Tu=function(){return l.Tu()};a.qx=function(a){if(!l.ea())return f.error("No active scene"),
!1;var b=l.A();l.qx(b,a)};a.Ru=l.Ru;a.px=function(a){if(!l.ea())return f.error("No active scene"),!1;var b=l.A();l.px(b,a)};a.Qu=function(a){if(!l.ea())return f.error("No active scene"),!1;var b=l.A();l.Qu(b,a)};a.eO=function(){if(!l.ea())return f.error("No active scene"),!1;var a=l.A();l.cy(a)};a.nj=function(a){e.gp(a)||t.zl(a)?l.nj(a):f.error("show/hide is only supported for dynamic meshes/empties")};a.uq=function(a){e.gp(a)||t.zl(a)?l.uq(a):f.error("show/hide is only supported for dynamic meshes/empties")};
a.hp=function(a){if(e.gp(a)||t.zl(a))return l.hp(a);f.error("show/hide is only supported for dynamic meshes/empties");return!1};a.Dl=function(a){return a.d.Dl};a.Qs=function(a){return l.ea()?l.Qs(a,l.A()):(f.error("No active scene"),!1)};a.OJ=function(a,b){return l.Ed(l.Tf,a,b|0)?!0:!1};a.MJ=function(a,b,d){return l.Ed(l.Vm,a,b,d|0)?!0:!1};a.NJ=function(a,b){return l.Ed(l.Wm,a,b|0)?!0:!1};a.XK=function(a,b){var d=l.A();a||(a="ALL");b||0===b||(b=l.L);return l.Bb(d,a,b)};a.rL=function(a){return a?a.name:
(f.error("Wrong object name"),"")};a.sL=function(a){return a&&a.type?a.type:(f.error("Wrong object ID"),"UNDEFINED")};a.qL=function(a){return a.za};a.pL=function(a){return a.Tc.slice(0)};a.tD=function(){for(var a=l.Bb(l.A(),"MESH",l.L),b=0;b<a.length;b++){var d=a[b];if(r.oj(d))return d}return null};a.Fu=function(a,b){b||0===b||(b=1);return l.Fu(a,b)};a.iu=function(){return l.iu()};a.EL=function(a){return"MESH"==a.type?a.d.type:null};a.kj=function(){if(!l.ea())return f.error("No active scene"),!1;
var a=l.A();return l.kj(a)};a.We=function(a){if(!a.d.fp)return f.error('object "'+a.name+'" has been created not by coping.'),!1;var b=a.name;if(l.Ed(l.Tf,a.name,0))for(var d=1;;){b=a.name+(3>String(d).length?"."+("000"+String(d)).slice(-3):"."+String(d));if(!l.Ed(l.Tf,b,0)){a.name=b;f.error('object "'+a.name+'" already exists. Name was replaced by "'+b+'".');break}d++}l.We(l.A(),a,!0)};a.Iw=function(a){l.Iw(a)||f.error('object "'+a.name+'" was not copied.')}};b4w.module.transform=function(a,v){var d=v("__print"),b=v("__physics"),p=v("__transform"),e=v("__util"),f=v("__objects"),r=new Float32Array(3),l=new Float32Array(4);a.vk=p.vk;a.an=p.an;a.Nd=function(a,e,l,u){f.Fc(a)?(r[0]=e,r[1]=l,r[2]=u,p.Nd(a,r),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rq=function(a,e){f.Fc(a)?(p.Nd(a,e),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.FN=function(a,l,v,u,y){f.Fc(a)?(r[0]=l,r[1]=v,r[2]=u,e.bk(r,1,y.d.quat,y.d.g,
r),p.Nd(a,r),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.Fd=function(a,b){b||(b=new Float32Array(3));p.Fd(a,b);return b};a.Ie=function(a,e,r,u,v){f.Fc(a)?(l[0]=e,l[1]=r,l[2]=u,l[3]=v,p.Ie(a,l),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.AN=function(){d.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.Ie};a.TF=function(a,e){f.Fc(a)?(p.Ie(a,e),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.BN=
function(){d.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.TF};a.hf=function(a,b){b||(b=new Float32Array(4));p.hf(a,b);return b};a.wL=function(){d.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.hf};a.qq=function(a,e,l,u){f.Fc(a)?(r[0]=e,r[1]=l,r[2]=u,p.qq(a,r),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.zN=function(a,e){f.Fc(a)?(p.qq(a,e),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.xf=function(a,b){f.Fc(a)?(p.xf(a,b),p.B(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.lj=function(a){return p.lj(a)};a.yK=function(a){if("EMPTY"!=a.type)return d.error("Wrong object: "+a.name),!1;for(var e=0;e<a.Tc.length;e++)if(!f.Fc(a.Tc[e])){d.error('Wrong object: "'+a.Tc[e].name+'" is not dynamic.');return}p.Nd(a,[0,0,0]);p.Ie(a,[0,0,0,1]);p.xf(a,1);p.B(a);b.S(a)};a.Mo=function(a){return e.lc(a)?p.Mo(a):(d.error("Wrong object: "+a.name),0)};a.ol=function(a,b,f){return e.lc(a)?
p.ol(a,b,f):(d.error("Wrong object: "+a.name),null)};a.Gc=function(a,e,l,r){f.Fc(a)?(p.Gc(a,e,l,r),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.wu=function(a){return p.wu(a)};a.Qo=function(a,b){b||(b=new Float32Array(8));if(f.Fc(a))return p.Qo(a,b),b;d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.pm=function(a,e){f.Fc(a)?(p.pm(a,e),p.B(a),b.S(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.distance=function(a,b){return p.distance(a,b)}};b4w.module.util=function(a,v){var d=v("__print"),b=v("__util"),p=v("vec3");v("mat4");a.Qe=new Float32Array([1,0,0]);a.Sa=new Float32Array([0,1,0]);a.rd=new Float32Array([0,0,1]);a.Tm=new Float32Array([-1,0,0]);a.vc=new Float32Array([0,-1,0]);a.Sf=new Float32Array([0,0,-1]);a.yv=b.yv;a.Rb=b.Rb;a.of=function(a){return b.of(a)};a.ef=function(a,d){d||(d=new Float32Array(4));return b.ef(a,d)};a.Bw=function(a,d){d||(d=new Float32Array(3));return b.Bw(a,d)};a.sign=b.sign;a.ua=b.ua;a.qa=b.qa;a.NL=function(a,
d){return b.Xp(a,b.vc,b.Sa,b.Sf,d)};a.Gn=function(a,d){return b.Gn(a,d)};a.Xp=function(a,f,r,l,t){return 0!=p.dot(r,l)?(d.error("Wrong in-plane direction"),null):b.Xp(a,f,r,l,t)};a.fv=b.fv;a.Ub=b.Ub;a.ii=b.ii;a.yg=b.yg;a.Sn=b.Sn;a.Aw=b.Aw;a.Dw=b.Dw;a.sy=b.sy;a.rp=b.rp;a.lc=b.lc;a.we=b.we;a.wd=b.wd;a.ge=b.ge;a.yx=b.yx};b4w.module.camera_anim=function(a,v){function d(a,b,d,e){b=l.wd(a-b);a=l.wd(d-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;e[0]=b;e[1]=a;return e}var b=v("camera"),p=v("controls"),e=v("print"),f=v("scenes"),r=v("transform"),l=v("util"),t=new Float32Array(2),m=new Float32Array(2),x=new Float32Array(3),u=new Float32Array(3),y=new Float32Array(3),K=new Float32Array(4),G=new Float32Array(2),A=new Float32Array(2),n=v("vec3"),q=v("quat");a.SN=
function(a,d,f,m,k,v,A,h){if(!b.xe(a))e.error("track_to_target(): wrong object");else if(a&&d){if(l.yg(d))var C=d;else C=y,r.ol(d,!1,C);d=f||1;f=m||2;var G=k||1;k=v||1;u[0]=0;u[1]=-1;u[2]=0;var H=r.hf(a);v=l.qa(H,u);m=b.kd(a,t);var w=r.Fd(a);n.subtract(C,w,x);n.normalize(x,x);var g=q.rotationTo(v,x,q.create());q.multiply(g,H,K);l.Sn(K,!1);n.subtract(C,w,u);var M=n.length(u)*(1-1/f),C=Math.asin(x[1]);f=Math.acos(-x[2]/Math.abs(Math.cos(C)));0<x[0]&&(f=2*Math.PI-f);var L=f-m[0],R=C-m[1];y[0]=0;y[1]=
0;y[2]=-1;f=r.hf(a);0>l.qa(f,y)[1]?(R=0<v[1]?C-Math.PI+m[1]:C+Math.PI+m[1],L=0<L?-Math.PI+L:Math.PI+L):Math.abs(L)>Math.PI&&(L=0<L?L-2*Math.PI:L+2*Math.PI);var U=0,C=p.uh();v=Math.abs(L/d);d=Math.abs(R/d);var Z=v>d?v:d,X=Z+G,aa=X+k,T=aa+G,Y=L,z=R,ea=M;p.M(a,"TRACK_TO_TARGET",p.ca,[C],null,function(a,c,d){if(d)if(d=p.Pb(a,c,0),U+=d,U<Z){var e=L/Z*d;d*=R/Z;c=U/Z;c=6*c*(1-c);e*=c;d*=c;Y-=e;z-=d;b.Kc(a,e,d)}else U<X?(Y&&(b.Kc(a,Y,z),Y=0,h&&h()),c=(U-Z)/G,d=-M*d/G,ea-=e,r.Gc(a,0,6*d*c*(1-c),0)):U<aa?ea&&
(r.Gc(a,0,ea,0),ea=0):U<T?(c=(U-aa)/G,d=M*d/G,d=6*d*c*(1-c),r.Gc(a,0,d,0)):(r.rq(a,w),p.Ce(a,c),A&&A())})}};a.ws=function(a){function n(a,c,e){if(1==e)if(k!=b.wb&&b.UD(a)){e=b.yD(a,A);if(null===u||e[0]!=u[0]||e[1]!=u[1]){u=u||G;u.set(e);v=Math.min(.2,l.wd(u[1]-u[0])/2);e=u;var f=b.kd(r,t)[0];e=d(f,e[0],e[1],m);h=.3*Math.min(1,e[0]/.2,e[1]/.2)}c=p.Pb(a,c,0);e=b.kd(a,t)[0];e=d(e,u[0],u[1],m);e[1]>v&&e[0]>v?h=.3*l.sign(h):e[1]<v?h-=Math.pow(.3,2)/.4*c:e[0]<v&&(h+=Math.pow(.3,2)/.4*c);b.Pw(a,c*h)}else u=
null,c=p.Pb(a,c,0),b.Pw(a,.3*c)}function q(){p.Ce(r,"AUTO_ROTATE");p.Ce(r,"DISABLE_AUTO_ROTATE");a()}a=a||function(){};var r=f.hj(),k=b.gf(r);if(k==b.Uf)e.error("auto_rotate(): wrong camera type");else{var u=null,v=0,h=0;if(p.qh(r,"AUTO_ROTATE"))q();else{var x=p.wh("X"),y=p.wh("Y"),H=p.Wk(),w=p.Ri(),g=p.Zk(),K=p.uh();p.M(r,"DISABLE_AUTO_ROTATE",p.sd,[x,y,H,w,g],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},q);p.M(r,"AUTO_ROTATE",p.ca,[K],function(a){return a[0]},n)}}};a.aE=function(){var a=
f.hj();return p.qh(a,"AUTO_ROTATE")};a.TA=function(){var a=f.hj();return b.gf(a)==b.Uf?!1:!0}};b4w.module.sfx=function(a,v){var d=v("__scenes"),b=v("__sfx"),p=v("__print");a.play=function(a,d,p){b.play(a,d,p)};a.Rp=function(a){b.Rp(a)};a.rj=function(a){return b.rj(a)};a.LN=function(a,d,r,l){p.error("speaker_play() deprecated, use play() or play_def() instead");b.Xc(a,d);l&&b.Hj(a,l);b.play(a,0,r)};a.NN=function(a){p.error("speaker_stop() deprecated, use stop() instead");b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.mG(a)};a.od=function(a){b.oG(a)};a.MN=function(a,d){p.error("speaker_playback_rate() deprecated, use playrate() instead");
b.Hj(a,d)};a.Hj=function(a,d){b.Hj(a,d)};a.zu=function(a){return b.zu(a)};a.Xc=function(a,d){b.Xc(a,d)};a.Nh=function(a){return b.Nh(a)};a.Hv=function(a,d){b.Hv(a,d)};a.Bx=function(a,d,p){b.Bx(a,d,p)};a.Pu=function(a){return a&&"object"===typeof a?b.Pu(a):b.CD()};a.sq=function(a,d){a&&"object"===typeof a?b.sq(a,d):b.PF(d)};a.xj=function(a,d){a&&"object"===typeof a?b.xj(a,d):b.GE(d)};a.pv=function(a){return a&&"object"===typeof a?b.pv(a):b.hE()};a.pl=function(){return b.pl().slice(0)};a.DL=function(){p.error("get_speakers() deprecated, use get_speaker_objects() instead");
return a.pl()};a.Kn=b.Kn;a.Zw=function(a){b.Zw(d.A(),a)};a.ku=function(){return b.ku(d.A())};a.Bt=function(a,d,p){a&&"object"===typeof a?b.Bt(a,d,p):b.nC(d,p)};a.Zx=function(a){a&&"object"===typeof a?b.Zx(a):b.QG()};a.ks=b.ks;a.Ws=b.Ws;a.ko=b.ko;a.lo=b.lo;a.gx=b.gx;a.Au=b.Au;a.cx=b.cx;a.ru=b.ru;a.qu=b.qu;a.mu=function(a){if(a&&b.ze(a))return b.mu(a);p.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.storage=function(a,v){function d(a){e=a;try{f=window.localStorage}catch(b){p.warn("Applying chrome localStorage bug workaround"),f=null}f||(p.warn("localStorage is not available, initializing temporary storage"),f={})}function b(){return f[e]?JSON.parse(f[e]):{}}var p=v("__print"),e="",f=null;a.Qb=d;a.set=function(a,d){var p=b();p[a]=String(d);f[e]=JSON.stringify(p)};a.Y=function(){delete f[e]};a.get=function(a){var d=b();return d[a]?d[a]:""};a.debug=function(){p.log(b())};d("b4w")};"object"==typeof module&&module.uo&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,v){var d=v("__version");a.version=d.version;a.type=d.type;a.eo=d.eo};"object"==typeof module&&module.uo&&b4w.module.version(exports);b4w.register("embed_main",function(a,v){function d(a,c){fa=document.querySelector("#circle_container");ma=document.querySelector("#preloader_caption");ca=document.querySelector("#first_stage");ra=document.querySelector("#second_stage");sa=document.querySelector("#third_stage");qa=document.querySelector("#load_container");V=document.querySelector("#preloader_container");S=document.querySelector("#opened_button");E=document.querySelector("#logo_container");N=document.querySelector("#buttons_container");
ha=document.querySelector("#quality_buttons_container");oa=document.querySelector("#help_info_container");ka=document.querySelector("#help_button");if(c){R.pause();var d=document.querySelector("#rel_version");X.version()&&(d.innerHTML=X.version());d=document.querySelector("#fullscreen_on_button");H.$A()||d.parentElement.removeChild(d);d=Z.get("quality");d&&"CUSTOM"!=d||(d="HIGH",Z.set("quality",d));ha.className="control_panel_button";switch(d){case "LOW":ha.className="control_panel_button low_mode_button";
break;case "HIGH":ha.className="control_panel_button high_mode_button";break;case "ULTRA":ha.className="control_panel_button ultra_mode_button"}b();if(d=e())f(d),H.uC(),window.addEventListener("resize",k,!1),k()}else if((d=H.ql(!0))&&d.fallback_image){var g=document.createElement("div");g.className="image_wrapper";document.body.appendChild(g);V.style.display="none";g.style.backgroundImage="url("+d.fallback_image+")"}else if(d&&d.fallback_video){var g=document.createElement("div"),h=document.createElement("video");
g.className="video_wrapper";g.appendChild(h);h.autoplay=!0;for(var l=0;l<d.fallback_video.length;l++){var m=document.createElement("source");m.src=d.fallback_video[l];h.appendChild(m)}document.body.appendChild(g);V.style.display="none"}else I("Browser could not initialize WebGL")}function b(){window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};p();for(var a=0;a<Xa.length;a++){var b=Xa[a],c=document.getElementById(b.id);r(c);switch(b.type){case "simple_button":c&&c.addEventListener("mouseup",
b.callback,!1);break;case "menu_button":c&&c.addEventListener("mouseup",function(a){b.callback(a,b)},!1);break;case "trigger_button":(function(a){c&&c.addEventListener("mouseup",function(b){a.callback(b)},!1)})(b)}}}function p(){for(var a=document.querySelectorAll(".control_panel_button a"),b=0;b<a.length;b++){var c=a[b];c.hasAttribute("href")&&(c.href+=document.location.href);r(c.parentNode)}}function e(){var a=g.get("built_in_module_name");if(b4w.module_check(a)){var a=v(a).data.main_file,b=document.getElementById("built_in_scripts");
b.parentElement.removeChild(b);return a}a=H.ql();E.style.display="block";if(a&&a.load)return a=a.load;I("Please specify a scene to load");return null}function f(a){H.Zb(E,"opacity",0,1,300,"","",function(){ma.style.display="block";H.Zb(ma,"opacity",0,1,300,"","",function(){R.od();L.load(a,B,J,!1)})})}function r(a){a&&(q()?(a.addEventListener("touchstart",function(){a.className+=" hover";O()},!1),a.addEventListener("touchend",function(){a.className=a.className.replace(" hover","");P()},!1)):(a.addEventListener("mouseenter",
function(){a.className+=" hover"},!1),a.addEventListener("mouseout",function(){a.className=a.className.replace(" hover","")},!1)))}function l(a){if(!c()){var b=a?a.target:document.querySelector("#auto_rotate_on_button");w.ws(function(){b&&u(b)});b&&u(b);R.Cl()&&(m(),y())}}function t(a){c()||(w.ws(),a&&u(a.target))}function m(a){c()||(R.od(),a&&u(a.target))}function x(){K("buttons_container")||P();var a=document.querySelector("#fullscreen_on_button")||document.querySelector("#fullscreen_off_button");
a&&u(a)}function u(a){var b=a.id,c;a:{for(c=0;c<Xa.length;c++)if(Xa[c].id==a.id){c=Xa[c];break a}c=null}var d=c.callback;a.id=c.id=c.Sj;c.Sj=b;K(a.id)||(a.className=a.className.replace(" hover",""));c.callback=c.Rj;c.Rj=d}function y(){var a=document.querySelector("#play_button")||document.querySelector("#pause_button");a&&u(a)}function K(a){var b=!1;if(document.querySelectorAll)for(var c=document.querySelectorAll(":hover"),d=0;d<c.length;d++)if(c[d].id==a){b=!0;break}return b}function G(){if(!c()){N.removeEventListener("mouseleave",
P);N.removeEventListener("mouseenter",O);document.body.removeEventListener("touchmove",P);F();var a=document.querySelector("#help_button"),b=document.querySelector("#tw_button"),d=function(a){ea=!0;H.Zb(a,"marginRight",0,-45,50,"","px");H.Zb(a,"opacity",1,0,50,"","",function(){a.nextElementSibling&&"opened_button"!=a.nextElementSibling.id?d(a.nextElementSibling):setTimeout(function(){Y=ea=!1;n()},100)})},e=function(a){z=!0;H.Zb(a,"marginBottom",0,-45,50,"","px");H.Zb(a,"opacity",1,0,50,"","",function(){a.nextElementSibling&&
"opened_button"!=a.nextElementSibling.id?e(a.nextElementSibling):setTimeout(function(){T=z=!1;n()},100)})};d(a);e(b)}}function A(){O();if(!c())if(S.removeEventListener("mouseup",A),T||Y)G();else{var a=document.querySelector("#fullscreen_on_button")||document.querySelector("#fullscreen_off_button")||document.querySelector("#quality_buttons_container"),b=document.querySelector("#vk_button"),d=function(a){ea=!0;a.style.marginRight="-45px";"help_button"==a.id&&ba?setTimeout(function(){ea=!1;Y=!0;n()},
100):(a.style.display="block",H.Zb(a,"marginRight",-45,0,50,"","px",function(){a.previousElementSibling?d(a.previousElementSibling):setTimeout(function(){ea=!1;Y=!0;n()},100)}),H.Zb(a,"opacity",0,1,50,"",""))},e=function(a){z=!0;a.style.marginBottom="-45px";a.style.display="block";H.Zb(a,"marginBottom",-45,0,50,"","px",function(){a.previousElementSibling?e(a.previousElementSibling):setTimeout(function(){z=!1;T=!0;n()},100)});H.Zb(a,"opacity",0,1,50,"","")};d(a);e(b);N.addEventListener("mouseleave",
P,!1);N.addEventListener("mouseenter",O,!1);document.body.addEventListener("touchmove",P,!1)}}function n(){c()||(S.addEventListener("mouseup",A,!1),(!K("buttons_container")&&(T||Y)||q()&&(T||Y))&&P())}function q(){return!!("ontouchstart"in window&&!isFinite(navigator.yE)||navigator.yE)}function c(){return z||ea}function P(){c()||(O(),aa=setTimeout(G,2E3))}function O(){clearTimeout(aa)}function F(a){if(!c()&&la){la=!1;a?(a.stopPropagation(),a=a.target):a=document.querySelectorAll(".active_elem")[0];
ha.style.marginRight="0px";for(var b=0,d=ha.children;b<d.length;b++)d[b].style.display="none",d[b].style.opacity=0;ha.className="control_panel_button "+a.id}}function k(){R.resize(window.innerWidth,window.innerHeight)}function B(a,b){if(b){var c=document.querySelector("#auto_rotate_on_button");w.TA()||c.parentElement.removeChild(c);H.tC();R.SF(h);k();(c=H.ql())&&"autorotate"in c&&l();c=M.kj();c.title&&(document.title=c.title)}else I("Could not load the scene")}function J(a){ma.innerHTML=a+"%";33>
a?(fa.style.display="block",ca.style.width=4.7*a+"px",fa.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",fa.style.transform="rotate("+(3.6*a-503)+"deg)"):66>a?(ca.style.width="142px",ra.style.backgroundColor="#000",ra.style.marginTop="135px",0<135-4.5*(a-33)&&(ra.style.marginTop=135-3.5*(a-33)+"px"),fa.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",fa.style.transform="rotate("+(3.6*a-503)+"deg)"):100!=a&&(ra.style.marginTop="0px",sa.style.backgroundColor="#000",sa.style.height="0px",75<a&&
(sa.style.height=.1*a+"px"),fa.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",fa.style.transform="rotate("+(3.6*a-503)+"deg)");100==a&&(U.Kn()||(a=document.querySelector("#sound_on_button"),a.parentElement.removeChild(a)),ca.parentElement.removeChild(ca),ra.parentElement.removeChild(ra),sa.parentElement.removeChild(sa),fa.parentElement.removeChild(fa),qa.style.backgroundColor="#000",H.Zb(ma,"opacity",1,0,300,"","",function(){H.Zb(qa,"opacity",1,0,300,"","",function(){H.Zb(E,"opacity",1,0,300,
"","",function(){H.Zb(V,"opacity",1,0,300,"","",function(){V.parentElement.removeChild(V);A()})});S.style.display="block";H.Zb(S,"transform",0,1,300,"scale(",")")})}))}function h(){}function C(a){if(g.get("quality")!=a){switch(a){case g.Wf:var b="LOW";break;case g.Vf:b="HIGH";break;case g.gh:b="ULTRA"}Z.set("quality",b);setTimeout(function(){window.location.reload()},100)}}function I(a){var b=document.querySelector("#error_name"),c=document.querySelector("#error_info"),d=document.querySelector("#error_container");
fa.style.display="none";b.innerHTML=a;c.innerHTML="For more info visit <a href=https://www.blend4web.com/troubleshooting>"+"https://www.blend4web.com/troubleshooting".replace("https://www.","")+"</a>";d.style.display="block";E.style.opacity=1;E.style.marginTop="-90px"}var H=v("app"),w=v("camera_anim"),g=v("config"),M=v("scenes"),L=v("data"),R=v("main"),U=v("sfx"),Z=v("storage"),X=v("version"),aa=null,T=!1,Y=!1,z=!1,ea=!1,la=!1,ba=!1,fa,ma,ca,ra,sa,qa,V,S,E,N,ha,oa,ka,Xa=[{type:"simple_button",id:"opened_button",
callback:A},{type:"simple_button",id:"help_button",callback:function(){c()||(oa.className=q()?"touch":"",oa.style.display="block",ka.style.display="none",ba=!0)}},{type:"simple_button",id:"close_help",callback:function(){ba&&(oa.style.display="none",ka.style.display="block",ba=!1)}},{type:"trigger_button",id:"fullscreen_on_button",callback:function(){c()||H.rF(x,x)},Sj:"fullscreen_off_button",Rj:function(){c()||H.wC()}},{type:"trigger_button",id:"pause_button",callback:function(a){c()||(R.pause(),
a&&u(a.target),w.aE()&&(t(),(a=document.querySelector("#auto_rotate_on_button")||document.querySelector("#auto_rotate_off_button"))&&u(a)))},Sj:"play_button",Rj:m},{type:"trigger_button",id:"auto_rotate_on_button",callback:l,Sj:"auto_rotate_off_button",Rj:t},{type:"trigger_button",id:"sound_on_button",callback:function(a){c()||(U.xj(null,!0),u(a.target))},Sj:"sound_off_button",Rj:function(a){c()||(U.xj(null,!1),u(a.target))}},{type:"menu_button",id:"quality_buttons_container",callback:function(a,
b){if(!c()){la=!0;ha.style.marginRight="-30px";for(var d=b.gB,e=b.fB,f=0;f<d.length;f++){var g=document.getElementById(d[f]);0>ha.className.indexOf(d[f])?g.addEventListener("mouseup",e[f],!1):(g.className="active_elem",g.addEventListener("mouseup",F,!1))}ha.className="quality_buttons_container";f=0;for(d=ha.children;f<d.length;f++)d[f].style.display="block",d[f].style.opacity=1}},gB:["low_mode_button","high_mode_button","ultra_mode_button"],fB:[function(){C(g.Wf)},function(){C(g.Vf)},function(){C(g.gh)}]}];
a.Qb=function(){g.set("background_color",[.224,.224,.224,1]);var a="DEBUG"==X.type(),b=!1,c=!1,e=!1,f=H.ql();f&&"compressed_textures"in f&&!k&&!a&&(e=c=!0);f&&"show_fps"in f&&(b=!0);f&&f.load?Z.Qb("b4w_webplayer:"+f.load):Z.Qb("b4w_webplayer:"+window.location.href);f=Z.get("quality");f&&"CUSTOM"!=f||(f="HIGH",Z.set("quality",f));switch(f){case "LOW":var h=g.Wf;break;case "HIGH":h=g.Vf;break;case "ULTRA":h=g.gh}g.set("quality",h);var k=b4w.module_check(g.get("built_in_module_name"));H.Qb({canvas_container_id:"main_canvas_container",
callback:d,gl_debug:a,physics_enabled:!k,show_fps:b,report_init_failure:!1,console_verbose:a,error_purge_elements:["control_panel"],alpha:!1,key_pause_enabled:!1,fps_elem_id:"fps_container",fps_wrapper_id:"fps_wrapper",assets_dds_available:c,assets_min50_available:e})}});window.addEventListener("load",function(){b4w.require("embed_main").Qb()},!1);var yd=["b4w","$","jQuery"],zd=[],Gd;for(Gd in window)-1!=yd.indexOf(Gd)||Gd in qd||zd.push(Gd);zd.length&&console.error("globals detected:",zd);
