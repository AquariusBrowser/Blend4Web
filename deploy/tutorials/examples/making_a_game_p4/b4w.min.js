var b4w=function(a){var p={};a.module=p;var d={};a.register=function(a,d){if(p[a])throw Error('Module "'+a+'" already registered');p[a]=d};a.require=function(a,c){if(!p[a])throw Error('Module "'+a+'" not found');c=c||"__B4W_DEF_NS";d[c]||(d[c]=function(a){return function(c){var b=p[c];if(!b)throw Error('Module "'+c+'" not found');b.Oh||(b.Oh={});b.Oh[a]||(b.Oh[a]={},b(b.Oh[a],d[a]));return b.Oh[a]}}(c));return d[c](a)};a.module_check=function(a){return p[a]?!0:!1};return a}({});"object"==typeof module&&module.em&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function p(){return"26.05.2015 11:58:35"}a.version=function(){return"15.05"};a.type=function(){return"RELEASE"};a.date=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.em&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function d(){return b4w.module_check(a.Sb.sj)}function b(){for(var d=a.Sb,b=null,e=document.getElementsByTagName("script"),l=0;l<e.length;l++){for(var g=e[l].src,m=0;m<d.ar.length;m++)if(0<=g.indexOf(d.ar[m])){b=g;break}if(null!==b)break}b||(c.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),b=document.location.href);d=b.indexOf("?");0<=d&&(b=b.substring(0,d));return b.substring(0,b.lastIndexOf("/")+1)}var c=p("__print"),
e=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.aw=e.ya(a.context);a.o={alpha_sort:!0,alpha_sort_threshold:.1,hn:"5.04",nd:1E4,console_verbose:!1,do_not_load_resources:!1,Rk:!1,dq:1.5,ox:10,background_color:[0,0,0,0],Yf:.01,resolution_factor:1,canvas_resolution_factor:1,Lk:3,allow_cors:!1,mm:!1,kj:!0,show_hud_debug_info:!1,XC:!0,af:"DEPTH",anaglyph_use:!1,Bk:!0,Hi:.5,rd:!0,gf:!0,Ng:!0,Wg:!0,Fg:!0,ih:!0,Jg:!0,antialiasing:!0,smaa:!1,
wireframe_debug:!1,pt:!1,Qg:!0,zi:!0,kb:!0,wk:!0,water_dynamic:!0,shore_smoothing:!0,rh:!0,od:1024,en:512,dt:!0,precision:"highp",quality:a.P_HIGH,el:!0,$y:!1,rs:!1,Op:!1,jt:!1,Qf:!1,Cl:!1,Qq:!1,Dl:!1,Zp:!1,pE:!1,Nc:!1,allow_hidpi:!1,gyro_use:!1,$p:!1,Lm:!1,enable_selectable:!0,enable_outlining:!0,Me:!0,mr:128,Im:!1,Zm:0};a.Pw=e.ya(a.o);a.Md={Fa:-1,eq:!1,Lf:1};a.controls={Yy:1/120};a.Nd={dir:"ASSETS=../../assets/",Ty:15,Wr:!0,gn:!1,Tl:!1};a.iv=e.ya(a.Nd);a.Sb={shaders_dir:"",nA:"include/",sj:"built_in_data",
ar:["b4w.min.js","b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"],gs:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.ub={enabled:!0,nd:60,Si:"",zv:!1};a.jz=e.ya(a.ub);a.Mi={Oj:1024,Ee:384};a.Oz=e.ya(a.Mi);a.Wc={so:!0,gk:!1,Yo:!1,up:!1,Pp:!1};a.mA=e.ya(a.Wc);a.Cb={outlining_overview_mode:!1,Ve:[1,.4,.05],Tc:1,mk:.2,nk:3.8,ok:1};a.Ul={enabled:!1,QA:"MAIN_OPAQUE",PA:0,qA:"COLOR"};a.Lw=e.ya(a.Ul);a.dv=function(){var b=a.o,d=a.ub,c=a.Mi;switch(b.quality){case a.P_ULTRA:b.af="DEPTH";
b.shore_smoothing=!0;b.gf=!0;b.Ng=!0;b.Wg=!0;b.Fg=!0;b.Bk=!0;b.Hi=1;b.rd=!0;b.Qg=!0;b.zi=!0;b.kb=!0;b.wk=!0;b.resolution_factor=1.75;c.Oj=2048;b.Lk=3;b.kj=!0;b.Rk=!1;b.precision="highp";b.water_dynamic=!0;b.rh=!0;b.antialiasing=!0;b.smaa=!0;b.Jg=!0;b.ih=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.Me=!0;d.nd=120;break;case a.P_HIGH:b.af="DEPTH";b.shore_smoothing=!0;b.gf=!0;b.Ng=!0;b.Wg=!0;b.Fg=!0;b.Bk=!0;b.Hi=.5;b.rd=!0;b.Qg=!0;b.zi=!0;b.kb=!0;b.wk=!0;b.resolution_factor=1;c.Oj=1024;b.Lk=3;b.kj=!0;
b.Rk=!1;b.precision="highp";b.water_dynamic=!0;b.rh=!0;b.antialiasing=!0;b.smaa=!1;b.Jg=!0;b.ih=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.Me=!0;d.nd=60;break;case a.P_LOW:b.af="NONE",b.shore_smoothing=!1,b.gf=!1,b.Ng=!1,b.Wg=!1,b.Fg=!1,b.Bk=!1,b.Hi=.5,b.rd=!1,b.Qg=!1,b.zi=!1,b.kb=!1,b.wk=!1,b.resolution_factor=1,c.Oj=512,b.Lk=2,b.kj=!1,b.Rk=!0,b.precision="mediump",b.water_dynamic=!1,b.rh=!1,b.antialiasing=!1,b.smaa=!1,b.Jg=!1,b.ih=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.Me=!1,d.nd=60}};a.set=
function(b,d){switch(b){case "allow_cors":a.o.allow_cors=d;break;case "allow_hidpi":a.o.allow_hidpi=d;break;case "alpha":a.context.alpha=d;break;case "alpha_sort":a.o.alpha_sort=d;break;case "alpha_sort_threshold":a.o.alpha_sort_threshold=d;break;case "anaglyph_use":a.o.anaglyph_use=d;break;case "animation_framerate":a.Md.Fa=d;break;case "antialiasing":a.o.antialiasing=d;break;case "assets_dds_available":a.Nd.Tl=d;break;case "assets_min50_available":a.Nd.gn=d;break;case "audio":a.Wc.so=d;break;case "background_color":a.o.background_color=
d;break;case "built_in_module_name":a.Sb.sj=d;break;case "canvas_resolution_factor":a.o.canvas_resolution_factor=d;break;case "console_verbose":a.o.console_verbose=d;break;case "do_not_load_resources":a.o.do_not_load_resources=d;break;case "gyro_use":a.o.gyro_use=d;break;case "physics_enabled":a.ub.enabled=d;break;case "physics_uranium_path":a.ub.Si=d;break;case "precision":a.o.precision=d;break;case "quality":a.o.quality=d;break;case "resolution_factor":a.o.resolution_factor=d;break;case "sfx_mix_mode":a.Wc.gk=
d;break;case "shaders_dir":a.Sb.shaders_dir=d;break;case "show_hud_debug_info":a.o.show_hud_debug_info=d;break;case "smaa":a.o.smaa=d;break;case "smaa_search_texture_path":a.Sb.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.Sb.smaa_area_texture_path=d;break;case "wireframe_debug":a.o.wireframe_debug=d;break;case "enable_selectable":a.o.enable_selectable=d;break;case "enable_outlining":a.o.enable_outlining=d;break;case "outlining_overview_mode":a.Cb.outlining_overview_mode=d;break;
case "glow_materials":a.o.Me=d;break;default:c.error("Unknown config property: "+b)}};a.get=function(b){switch(b){case "allow_cors":return a.o.allow_cors;case "allow_hidpi":return a.o.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.o.alpha_sort;case "alpha_sort_threshold":return a.o.alpha_sort_threshold;case "anaglyph_use":return a.o.anaglyph_use;case "animation_framerate":return a.Md.Fa;case "antialiasing":return a.o.antialiasing;case "assets_dds_available":return a.Nd.Tl;
case "assets_min50_available":return a.Nd.gn;case "audio":return a.Wc.so;case "background_color":return a.o.background_color;case "built_in_module_name":return a.Sb.sj;case "canvas_resolution_factor":return a.o.canvas_resolution_factor;case "console_verbose":return a.o.console_verbose;case "do_not_load_resources":return a.o.do_not_load_resources;case "gyro_use":return a.o.gyro_use;case "physics_enabled":return a.ub.enabled;case "physics_uranium_path":return a.ub.Si;case "precision":return a.o.precision;
case "quality":return a.o.quality;case "resolution_factor":return a.o.resolution_factor;case "sfx_mix_mode":return a.Wc.gk;case "shaders_dir":return a.Sb.shaders_dir;case "show_hud_debug_info":return a.o.show_hud_debug_info;case "smaa":return a.o.smaa;case "smaa_search_texture_path":return a.Sb.smaa_search_texture_path;case "smaa_area_texture_path":return a.Sb.smaa_area_texture_path;case "wireframe_debug":return a.o.wireframe_debug;case "enable_selectable":return a.o.enable_selectable;case "enable_outlining":return a.o.enable_outlining;
case "outlining_overview_mode":return a.Cb.outlining_overview_mode;case "glow_materials":return a.o.Me;default:c.error("Unknown config property: "+b)}};a.reset=function(){a.context=e.ya(a.aw);a.o=e.ya(a.Pw);a.Nd=e.ya(a.iv);a.ub=e.ya(a.jz);a.Mi=e.ya(a.Oz);a.Wc=e.ya(a.mA);a.Ul=e.ya(a.Lw)};a.Uq=d;a.dA=function(){var c=a.Sb,e=a.ub;d()||""!=c.shaders_dir||(c.shaders_dir=b()+"../shaders/");if(d())c.smaa_search_texture_path="smaa_search_texture.png",c.smaa_area_texture_path="smaa_area_texture.png";else if(""==
c.smaa_search_texture_path||""==c.smaa_area_texture_path){var f=b()+c.gs;c.smaa_search_texture_path=c.smaa_search_texture_path||f+"smaa_search_texture.png";c.smaa_area_texture_path=c.smaa_area_texture_path||f+"smaa_area_texture.png"}e.enabled&&""==e.Si&&(f=b()+c.gs,e.Si=f+"uranium.js")};a.get_std_assets_path=function(){return a.Nd.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function d(a,d){var q=document.createElement("div"),f=q.style;f.position="absolute";f.backgroundColor="black";f.borderRadius="20px 20px 20px 0px";f.boxShadow="0px 0px 10px rgb(180, 180, 200)";f.opacity=1;f.padding="8px 12px";f.lineHeight="15px";f.visibility="hidden";f.fontSize="12px";var h=l.get_container();h.appendChild(q);var z=g.get_meta_tags(a),r=document.createElement("span"),x=r.style;r.innerHTML=z.title||a.name;x.fontWeight="bold";x.fontSize="12px";x.lineHeight=
"15px";x.color="#fff";x.fontFamily="Arial";e(r);q.appendChild(r);var L=z.description;if(L){var z=document.createElement("div"),F=z.style;F.position="absolute";F.bottom="0px";F.left="0px";F.backgroundColor="#000";F.borderRadius="20px 20px 20px 0px";F.boxShadow="0px 0px 10px rgb(180, 180, 200)";F.visibility="hidden";F.padding="8px 12px";F.overflow="hidden";F.lineHeight="15px";F.fontSize="12px";F.zIndex="2";q.appendChild(z);var I=document.createElement("span"),M=I.style;I.innerHTML=L;M.fontSize="12px";
M.fontFamily="Arial";M.fontWeight="bold";M.lineHeight="15px";M.color="#fff";M.visibility="hidden";z.appendChild(I);var k=!1,B=!1;h.addEventListener("click",function(a){if(!(k||B||E))if(a.target!=r&&a.target!=q||"hidden"!=F.visibility||1!=f.opacity)"visible"==F.visibility&&(f.visibility="visible",x.visibility="visible",F.visibility="hidden",M.visibility="hidden");else{f.visibility="hidden";x.visibility="hidden";F.visibility="visible";k=B=!0;a=q.offsetWidth-24;var I=q.offsetHeight-16,e=Math.min(d,b(L)),
z=c(L,e);z==I&&(F.height=z+"px");e!=a?A.animate(a,e,200,function(a){a==e&&("visible"==F.visibility&&(M.visibility="visible"),k=!1);F.width=a+"px"}):k=!1;z!=I?A.animate(I,z,200,function(a){a==z&&("visible"==F.visibility&&(M.visibility="visible"),B=!1);F.height=a+"px"}):B=!1;B||k||(M.visibility="visible")}},!1)}return q}function b(a){var b=document.createElement("div"),d=document.createElement("span"),c=b.style;d.innerHTML=a;d.style.fontSize="12px";d.style.fontFamily="Arial";d.style.fontWeight="bold";
d.style.color="#fff";d.style.visibility="hidden";c.lineHeight="15px";b.appendChild(d);c.position="absolute";c.visibility="hidden";c.fontSize="12px";c.display="inline-block";c.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function c(a,b){var d=document.createElement("div"),c=document.createElement("span"),e=d.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";c.style.color="#fff";c.style.visibility=
"hidden";e.lineHeight="15px";d.appendChild(c);e.position="absolute";e.visibility="hidden";e.fontSize="12px";e.display="inline-block";e.width=b+"px";e.lineHeight="15px";document.body.appendChild(d);c=d.offsetHeight;document.body.removeChild(d);return c}function e(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}
function h(){for(var a=0,b=0;b<B.length;b++)B[b].Xl&&a++;w=new Float32Array(3*a)}var k=p("__batch"),f=p("__camera"),l=p("__container"),g=p("__objects"),m=p("__print"),n=p("__renderer"),r=p("__scenes"),A=p("__time");p("__util");var v=p("__config").o,E=!1,B=[],w=new Float32Array(0),t=new Uint8Array(16),x=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<B.length;b++)if(B[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.b4w_anchor.detect_visibility&&Boolean(r.ha(r.Ug(),"ANCHOR_VISIBILITY"));b={type:a.b4w_anchor.type,
obj:a,x:0,y:0,depth:0,Dg:"out",Xl:b,element:null,jh:null,Lu:a.b4w_anchor.max_width,Qo:0};switch(b.type){case "ANNOTATION":b.element=d(a,b.Lu);b.Qo=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.b4w_anchor.element_id),b.element||(m.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}B.push(b);h()}};a.remove=function(a){for(var b=0;b<B.length;b++){var d=B[b];if(d.obj==a){"ANNOTATION"==d.type&&(a=d,l.get_container().removeChild(a.element));
B.splice(b,1);h();break}}};a.update=function(){for(var a=0,b=0;b<B.length;b++){var d=B[b];d.Xl&&(w.set(d.obj.d.g,3*a),a++);var c,e=d,z=x;c=r.Lj(r.Ug());z=f.project_point(c,e.obj.d.g,z);z[0]/=v.resolution_factor;z[1]/=v.resolution_factor;e=r.yq();z[0]/=e;z[1]/=e;c=z;z=c[0];e=c[1];c=c[2];if(z!=d.x||e!=d.y||c!=d.depth){switch(d.type){case "ANNOTATION":var g=d.element;g.style.left=Math.floor(z)+"px";g.style.top=Math.floor(e-d.Qo)+"px";break;case "ELEMENT":g=d.element,g.style.left=Math.floor(z-g.offsetWidth/
2)+"px",g.style.top=Math.floor(e-g.offsetHeight/2)+"px"}d.x=z;d.y=e;d.depth=c;d.jh&&d.jh(z,e,d.Dg,d.obj,g)}}0<a&&(a=r.ha(r.Ug(),"ANCHOR_VISIBILITY").p[0].D,k.dB(a,w))};a.xB=function(){for(var a=l.get_container(),b=0;b<B.length;b++){var d=B[b],c=d.obj,e=d.x,z=d.y,g=d.depth,g=0>e||0>z||0>g||1<g||r.is_hidden(c)||e>=a.clientWidth||z>=a.clientHeight?"out":"visible";if(d.Xl&&"out"!=g){var g=d,f=r.ha(r.Ug(),"ANCHOR_VISIBILITY"),h=r.yq(),F=g.x*h,h=g.y*h,F=F*v.resolution_factor,h=h*v.resolution_factor,f=f.h;
n.bs(f.ae,F,f.height-h,2,2,t);g=1020==t[0]+t[4]+t[8]+t[12]?"visible":"out"==g.Dg||0==t[0]+t[4]+t[8]+t[12]?"covered":g.Dg}if(g!=d.Dg){switch(d.type){case "ANNOTATION":case "ELEMENT":var I=d.element;if(!I)break;"out"==g?(I.style.visibility="hidden",I.children.length&&(I.children[0].style.visibility="hidden"),"ANNOTATION"==d.type&&1<I.children.length&&(F=I.children[1],F.style.visibility="hidden",F.children.length&&(F.children[0].style.visibility="hidden"))):"visible"==g?(I.style.visibility="visible",
I.children.length&&(I.children[0].style.visibility="visible"),I.style.opacity=1):(I.style.visibility="visible",I.style.opacity=.1,I.children.length&&(I.children[0].style.visibility="visible"),"ANNOTATION"==d.type&&1<I.children.length&&(F=I.children[1],F.style.visibility="hidden",F.children.length&&(F.children[0].style.visibility="hidden")))}d.Dg=g;d.jh&&d.jh(e,z,d.Dg,c,I)}}};a.attach_move_cb=function(a,b){for(var d=0;d<B.length;d++)B[d].obj==a&&(B[d].jh=b)};a.detach_move_cb=function(a){for(var b=
0;b<B.length;b++)B[b].obj==a&&(B[b].jh=null)};a.cleanup=function(){for(var a=0;a<B.length;a++){var b=B[a];"ANNOTATION"==b.type&&l.get_container().removeChild(b.element)}B.length=0};a.Tq=function(a){return a.b4w_anchor?!0:!1};a.pause=function(){E=!0};a.resume=function(){E=!1}};b4w.module.__boundings=function(a,p){function d(a,b){for(var d=a[0],c=a[1],e=a[2],g=a[0],f=a[1],h=a[2],k=3;k<a.length;k+=3)var l=a[k],q=a[k+1],n=a[k+2],d=Math.max(d,l),c=Math.max(c,q),e=Math.max(e,n),g=Math.min(g,l),f=Math.min(f,q),h=Math.min(h,n);b.max_x=d;b.max_y=c;b.max_z=e;b.min_x=g;b.min_y=f;b.min_z=h;return b}function b(a,b){b||(b=new Float32Array(24));var d=a.max_x,c=a.max_y,e=a.max_z,g=a.min_x,f=a.min_y,h=a.min_z;b[0]=g;b[1]=f;b[2]=h;b[3]=d;b[4]=f;b[5]=h;b[6]=d;b[7]=c;b[8]=h;b[9]=g;b[10]=
c;b[11]=h;b[12]=g;b[13]=f;b[14]=e;b[15]=d;b[16]=f;b[17]=e;b[18]=d;b[19]=c;b[20]=e;b[21]=g;b[22]=c;b[23]=e;return b}function c(a,b,d){f.add(b,d,a.F);f.scale(a.F,.5,a.F);a.Ba=f.distance(a.F,b);return a}var e=p("__geometry"),h=p("__util"),k=p("__tsr"),f=p("vec3"),l=new Float32Array(24),g=new Float32Array(3),m=new Float32Array(3),n=new Float32Array(3);a.Cp=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.CC=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Ed=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Tp=function(a,b){var d=a.max_y,c=a.max_z,e=a.min_x,g=a.min_y,f=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,d);a.max_z=Math.max(b.max_z,c);a.min_x=Math.min(b.min_x,e);a.min_y=Math.min(b.min_y,g);a.min_z=Math.min(b.min_z,f)};a.pv=d;a.ul=function(c,e,g){g||(g=a.Ed());c=b(c,l);h.We(c,e,c);return d(c,g)};a.gx=b;a.oE=function(b,d,c){c||
(c=a.Ed());var e=d.min_x,g=d.max_x,f=d.min_y,h=d.max_y,k=d.min_z;d=d.max_z;if(e>=b.max_x||g<=b.min_x||f>=b.max_y||h<=b.min_y||k>=b.max_z||d<=b.min_z)return c.min_x=-.1,c.max_x=.1,c.min_y=-.1,c.max_y=.1,c.min_z=-.2,c.max_z=-.1,c;c.min_x=Math.max(b.min_x,e);c.max_x=Math.min(b.max_x,g);c.min_y=Math.max(b.min_y,f);c.max_y=Math.min(b.max_y,h);c.min_z=Math.max(b.min_z,k);c.max_z=Math.min(b.max_z,d);return c};a.sE=function(b,d,c){c||(c=a.Ed());var e=b.max_x-b.min_x,g=b.max_y-b.min_y,f=b.max_z-b.min_z;c.min_x=
b.min_x-.5*(d-1)*e;c.max_x=b.max_x+.5*(d-1)*e;c.min_y=b.min_y-.5*(d-1)*g;c.max_y=b.max_y+.5*(d-1)*g;c.min_z=b.min_z-.5*(d-1)*f;c.max_z=b.max_z+.5*(d-1)*f;return c};a.wl=function(b,d,c){c||(c=a.Zi());f.transformMat4(b.F,d,c.F);c.Ba=b.Ba*h.dn(d);return c};a.vl=function(a,b,d){d||(d={wf:new Float32Array(3),xf:new Float32Array(3),yf:new Float32Array(3),F:new Float32Array([0,0,0])});k.transform_vec3(a.F,b,d.F);f.copy(a.wf,d.wf);f.copy(a.xf,d.xf);f.copy(a.yf,d.yf);k.transform_dir_vec3(d.wf,b,d.wf);k.transform_dir_vec3(d.xf,
b,d.xf);k.transform_dir_vec3(d.yf,b,d.yf);return d};a.Ml=function(a,b){return{Ba:a,F:new Float32Array(b)}};a.Zi=function(){return{F:new Float32Array([0,0,0]),Ba:0}};a.Ll=function(a,b,d,c){return{wf:new Float32Array(a),xf:new Float32Array(b),yf:new Float32Array(d),F:new Float32Array([c[0],c[1],c[2]])}};a.rv=function(){return{F:new Float32Array([0,0,0]),Ba:1E12}};a.cx=function(a,b){var d=f.subtract(b.F,a.F,f.create());0==f.length(d)&&f.set(1,0,0,d);var c=f.normalize(d,f.create()),d=f.scale(c,a.Ba,f.create());
f.add(d,a.F,d);var e=f.scale(c,-a.Ba,f.create());f.add(e,a.F,e);var g=f.scale(c,b.Ba,f.create());f.add(g,b.F,g);var h=f.scale(c,-b.Ba,f.create());f.add(h,b.F,h);d=[d,e,g,h];c=f.normalize(c,f.create());e=d[0];g=d[0];for(h=1;h<d.length;h++){var k=f.dot(d[h],c);k<f.dot(e,c)&&(e=d[h]);k>f.dot(g,c)&&(g=d[h])}c=[e,g];d=c[0];c=c[1];a.F=f.scale(f.add(d,c,f.create()),.5,f.create());a.Ba=f.length(f.subtract(c,d,f.create()))/2};a.Dp=function(a,b){var d=b.max_y,c=b.min_y,e=Math.max(0,d-c-2*a);return{Ba:a,height:e,
F:new Float32Array([0,(d+c)/2,0])}};a.Fp=function(a,b){var d=b.max_y,c=b.min_y,e=Math.max(0,d-c);return{Ba:a,height:e,F:new Float32Array([0,(d+c)/2,0])}};a.Ep=function(a,b){var d=b.max_y,c=b.min_y,e=Math.max(0,d-c);return{Ba:a,height:e,F:new Float32Array([0,(d+c)/2,0])}};a.GC=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.vz=function(a){for(var b=0,d=0,c=0,e=0,g=0,f=0,h=0,k=0,l=0;l<a.submeshes.length;l++){var q=
a.submeshes[l];if(q.position.length){b=e=q.position[0];d=g=q.position[1];c=f=q.position[2];break}}for(l=0;l<a.submeshes.length;l++)for(var q=a.submeshes[l],q=q.position,n=0;n<q.length/3;n++)var m=q[3*n],z=q[3*n+1],N=q[3*n+2],b=Math.max(m,b),d=Math.max(z,d),c=Math.max(N,c),e=Math.min(m,e),g=Math.min(z,g),f=Math.min(N,f),h=Math.max(Math.sqrt(m*m+z*z+N*N),h),k=Math.max(Math.sqrt(m*m+N*N),k);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=d;a.b4w_bounding_box.min_y=g;a.b4w_bounding_box.max_z=
c;a.b4w_bounding_box.min_z=f;a.b4w_bounding_sphere_radius=h;a.b4w_bounding_cylinder_radius=k};a.Yx=function(b){var d=b.subarray(0,3),h=b.subarray(6,9),k=b.subarray(12,15),l=b.subarray(18,21);b=f.subtract(h,d,g);f.normalize(b,b);var w=e.$x(d,h,k,m),w=f.cross(w,b,w);f.normalize(w,w);var t=f.create(),x=f.create();f.subtract(h,d,n);x[0]=f.dot(n,b);x[1]=f.dot(n,w);h=f.create();f.subtract(k,d,n);h[0]=f.dot(n,b);h[1]=f.dot(n,w);k=f.create();f.subtract(l,d,n);k[0]=f.dot(n,b);k[1]=f.dot(n,w);l=a.Zi();k=[t,
x,h,k];t=c(l,k[0],k[1]);for(l=2;l<k.length;l++)if(f.distance(t.F,k[l])>t.Ba){for(var G=t,t=k,x=k[l],h=l-1,G=c(G,x,t[0]),C=1;C<=h;C++)if(f.distance(G.F,t[C])>G.Ba){for(var q=G,G=t,y=x,H=t[C],z=C-1,q=c(q,y,H),N=0;N<=z;N++)if(f.distance(q.F,G[N])>q.Ba){var O=y,L=H,F=G[N],I=f.subtract(L,F,n),I=f.squaredLength(I),M=f.subtract(O,F,n),R=f.squaredLength(M),M=f.subtract(O,L,n),ca=f.squaredLength(M),M=I*(R+ca-I),S=R*(ca+I-R),I=ca*(I+R-ca),R=M+S+I;f.copy(O,q.F);f.scale(q.F,M/R,q.F);f.scaleAndAdd(q.F,L,S/R,q.F);
f.scaleAndAdd(q.F,F,I/R,q.F);q.Ba=f.distance(q.F,O)}G=q}t=G}l=t;b=f.scale(b,l.F[0],n);f.scaleAndAdd(b,w,l.F[1],b);f.add(b,d,l.F);return l}};b4w.module.__compat=function(a,p){function d(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function c(){return!window.ActiveXObject&&"ActiveXObject"in window}var e=p("__config"),h=p("__extensions"),k=p("__print");
p("__util");a.Yz=function(a){var l=e.Md,g=e.o,m=e.context,n=e.Mi,r=e.Wc;g.mr=a.MAX_VERTEX_UNIFORM_VECTORS;g.od=a.getParameter(a.MAX_TEXTURE_SIZE);g.en=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var A=Boolean(h.Tx());d("Firefox")&&e.Uq()&&(k.warn("Firefox detected for single HTML version, disable video textures."),g.Zp=!0);d("Firefox/28.0")&&(d("Linux")||d("Macintosh"))&&(k.warn("Firefox 28 detected, applying depth hack"),A=!1);d("iPad")||d("iPhone")?(k.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
m.alpha||(g.background_color[3]=1),g.jt=!0,g.smaa=!1,g.gf=!1,g.precision="highp",g.Qq=!0):d("Mac OS X")&&d("Safari")&&!d("Chrome")&&(k.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),r.Yo=!0,r.up=!0);d("Windows")&&(d("Chrome/40")||d("Firefox/33")||d("Firefox/34")||d("Firefox/35")||d("Firefox/36"))&&(k.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),g.Dl=!0);b()&&(k.warn("Mobile detected, applying various hacks for video textures."),
g.Qf=!0,d("iPad")||d("iPhone")||(k.warn("Mobile (not iOS) detected, disable playback rate for video textures."),r.Pp=!0));(d("Firefox/35.0")||d("Firefox/36.0"))&&d("Windows")&&(k.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),g.$p=!0);if(d("iPhone")||c())k.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),g.Nc=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(k.warn("Not enough varyings, disable shadows on blend objects"),g.Op=!0);if(m=h.uq())d("Macintosh")&&
-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(k.warn("OS X / Intel HD 3000 detected, applying depth hack"),A=!1),d("Windows")&&d("Chrome")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Intel")&&(k.warn("Chrome / Windows / Intel GPU detected, applying cubemap mipmap/rgb hack"),g.Lm=!0),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(k.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),
A=!1,l.eq=!0),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(k.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),g.precision="highp",g.af="NONE"),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(k.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),g.precision="highp",g.gf=!1),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&
-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(k.warn("Qualcomm Adreno detected, applying shader constants hack."),g.rs=!0,-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(k.warn('Qualcomm Adreno305 detected, set "highp" precision.'),g.precision="highp"),-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(k.warn('Qualcomm Adreno330 detected, set "highp" precision.'),g.precision="highp")),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(k.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.mm=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(k.warn("Vertex textures are not allowed. Disabling vertex textures"),g.el=!1);g.allow_hidpi&&1<window.devicePixelRatio&&(k.log("%cENABLE HIDPI MODE","color: #00a"),g.resolution_factor=1,g.smaa=!1);A||(g.Qg=!1,g.zi=!1,g.kb=!1,g.water_dynamic=!1,g.shore_smoothing=!1,g.rh=!1,g.smaa=!1);g.dt=Boolean(h.vq());g.bi=A;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,
a.HIGH_FLOAT).precision&&(g.precision="mediump");c()&&(k.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),n.Ee=512);c()&&d("Touch")&&(k.warn("IE11 and touchscreen detected. Behaviour of the mouse move sensor will be changed."),g.Im=!0);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(k.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.mm=!0);d("Chrome")&&(k.warn("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),
g.Cl=!0)};a.detect_mobile=b;a.bv=function(){d("Firefox/35.0")&&d("Windows")&&(k.warn("Windows/Firefox 35 detected, forcing context's alpha"),e.context.alpha=!0)};a.Nm=c};b4w.module.__constraints=function(a,p){function d(a){var b={};b.type=a;return b}function b(a,b){a.Qa&&a.Qa.O&&e(a.Qa.O,a);b.O&&c(b.O,a);a.Qa=b}function c(a,b){if(-1==a.Ec.indexOf(b))a.Ec.push(b);else throw"Descendant object override is forbidden";}function e(a,b){var d=a.Ec.indexOf(b);if(-1!=d)a.Ec.splice(d,1);else throw"No descendant object";}function h(a,b,d){switch(b.type){case 1:var c=a.d.quat,e=b.O.d.T;d=b.O.d.quat;b.dc?(A.copy(b.dc,c),A.multiply(d,c,c)):A.copy(d,c);r.transformMat4(b.offset,
e,a.d.g);a.d.scale=b.Ck*b.O.d.scale;break;case 9:var h=a.d.g,c=a.d.quat,e=b.O.d.T;d=b.O.d.quat;A.multiply(A.invert(b.hg,b.hg),c,c);A.multiply(d,c,c);r.transformMat4(b.offset,e,h);A.copy(d,b.hg);break;case 10:h=a.d.g;c=a.d.quat;e=b.O.d.T;d=b.O.d.quat;A.multiply(A.invert(b.hg,b.hg),c,c);A.multiply(d,c,c);r.transformMat4(b.offset,e,h);A.copy(d,b.hg);h=a.d.quat;c=A.multiply(b.O.d.quat,b.dc,C);c=n.mq(c,E);h=n.mq(h,B);n.rotate_eye_camera(a,m.Ce(h[0],c[0]+b.Rv,c[0]+b.Qv),m.Ce(h[1],c[1]+b.Pv,c[1]+b.Sv));
break;case 12:var h=a.d.g,c=a.d.quat,e=b.O.d.T,q=b.O.d.g,x=b.sA,t=w,H=C;r.transformMat4(b.offset,e,t);m.smooth_v(t,h,d,x,h);e=w;r.sub(q,h,e);r.normalize(e,e);var p=c,h=z,q=h.subarray(0,3),t=h.subarray(3,6),P=h.subarray(6,9);r.copy(e,t);r.negate(t,t);r.normalize(t,t);Boolean(.999999<Math.abs(r.dot(e,m.AXIS_Y)))?(e=v.fromQuat(A.normalize(p,H),N),r.copy(e.subarray(0,3),q)):r.cross(m.AXIS_Y,t,q);r.normalize(q,q);r.cross(q,t,P);r.normalize(P,P);A.fromMat3(h,H);A.normalize(H,H);m.As(H,c,d,.16*x,c);break;
case 2:c=a.d.quat;h=G;d=C;l(b.O,b.xv,!0,h,d);b.dc?(A.copy(b.dc,c),A.multiply(d,c,c)):A.copy(d,c);a.d.scale=b.Ck*h[3];m.transform_vec3(b.offset,h[3],d,h,a.d.g);break;case 3:h=a.d.g;c=a.d.quat;d=b.O.d.g;k(h,c,d);break;case 4:h=a.d.g;c=a.d.quat;d=b.target;k(h,c,d);break;case 5:h=a.d.g;c=a.d.quat;d=b.O.d.g;k(h,c,d);c=r.dist(h,d);if(c=c>b.dist_max?c-b.dist_max:c<b.ci?c-b.ci:0)r.sub(d,h,w),r.normalize(w,w),r.scale(w,c,w),r.add(h,w,h);break;case 6:h=a.d.g;c=a.d.quat;d=b.target;k(h,c,d);c=r.dist(h,d);if(c=
c>b.dist_max?c-b.dist_max:c<b.ci?c-b.ci:0)r.sub(d,h,w),r.normalize(w,w),r.scale(w,c,w),r.add(h,w,h);break;case 7:e=b.O.d.T;r.transformMat4(b.offset,e,a.d.g);break;case 8:q=b.O.d.g;h=a.d.g;r.add(q,b.offset,h);break;case 13:c=a.d.quat;e=b.O.d.T;d=b.O.d.quat;b.dc?(A.copy(b.dc,c),A.multiply(d,c,c)):A.copy(d,c);r.transformMat4(b.offset,e,a.d.g);break;case 11:h=b.O.d;d=g.create_sep(h.g,h.scale,h.quat,y);g.multiply(d,b.Ws,d);h=a.d.g;h[0]=d[0];h[1]=d[1];h[2]=d[2];a.d.scale=d[3];c=a.d.quat;c[0]=d[4];c[1]=
d[5];c[2]=d[6];c[3]=d[7];break;case 14:d=b.O,c=n.Wx(d),h=a.d.g,x=n.Mj(c,"TOP"),H=n.Mj(c,"BOTTOM"),e=x-H,b.gr?(q=n.Mj(c,"LEFT"),h[0]=q+e*b.Vm):(q=n.Mj(c,"RIGHT"),h[0]=q-e*b.Vm),h[2]=b.Us?-(x-e*b.Zn):-(H+e*b.Zn),n.Gy(c)?h[1]=-b.distance:(h[1]=-1,r.normalize(h,h),r.scale(h,b.distance/Math.abs(h[1]),h)),g.transform_dir_vec3(h,d.d.xb,h),r.add(d.d.g,h,h),c=a.d.quat,b.dc?(A.copy(b.dc,c),A.multiply(d.d.quat,c,c)):A.copy(d.d.quat,c)}"CAMERA"==a.d.type&&(h=m.AXIS_Y,10==b.type&&(d=b.O.d.quat,h=r.transformQuat(h,
d,O)),n.fo(a),f(a,h))}function k(a,b,d){var c=w;m.quat_to_dir(b,m.AXIS_MY,c);r.normalize(c,c);var e=t;r.subtract(d,a,e);r.normalize(e,e);a=m.Kz(c,e,G);A.multiply(a,b,b);A.normalize(b,b)}function f(a,b){var d=a.d,c=d.quat,e=m.quat_to_dir(d.quat,m.AXIS_Y,w);r.normalize(e,e);if(.999999<Math.abs(r.dot(b,e)))e=A.identity(C);else{var h=r.cross(b,e,t);r.normalize(h,h);if(d.ra==n.MS_TARGET_CONTROLS)d.Vn&&r.negate(h,h);else{var g=m.quat_to_dir(d.quat,m.AXIS_Z,x);0<r.dot(g,b)&&r.negate(h,h)}d=m.quat_to_dir(d.quat,
m.AXIS_X,x);r.normalize(d,d);var g=m.clamp(r.dot(d,h),-1,1),z=Math.acos(g),e=-.999999>=g?A.setAxisAngle(e,z,C):A.rotationTo(d,h,C);A.normalize(e,e)}A.multiply(e,c,c);n.fo(a)}function l(a,b,d,c,e){var h=a.d,z=h.Kf,f=h.Gc[b];b=f.ai;a=a.pose.bones[f.vn];var f=a.Jo,k=G,l=h.Cc,x=h.Bc,n=h.uc,m=h.tc,r=l[4*b+1],t=l[4*b+2],w=l[4*b+3],O=x[4*b+1],B=x[4*b+2],K=x[4*b+3];k[0]=(1-z)*l[4*b]+z*x[4*b];k[1]=(1-z)*r+z*O;k[2]=(1-z)*t+z*B;k[3]=(1-z)*w+z*K;l=C;x=q;l[0]=n[4*b];l[1]=n[4*b+1];l[2]=n[4*b+2];l[3]=n[4*b+3];x[0]=
m[4*b];x[1]=m[4*b+1];x[2]=m[4*b+2];x[3]=m[4*b+3];A.slerp(l,x,z,l);z=y;g.set_transcale(k,z);g.set_quat(l,z);d?(d=H,g.translate(f,a.Ju,d),g.multiply(z,d,z)):g.multiply(z,f,z);g.multiply(h.xb,z,z);c[0]=z[0];c[1]=z[1];c[2]=z[2];c[3]=z[3];e&&(e[0]=z[4],e[1]=z[5],e[2]=z[6],e[3]=z[7])}var g=p("__tsr"),m=p("__util"),n=p("__camera"),r=p("vec3");p("vec4");var A=p("quat"),v=p("mat3");p("mat4");a.dC=1;a.cC=2;a.hC=3;a.iC=4;a.YB=5;a.ZB=6;a.eC=7;a.XB=8;a.bC=9;a.aC=10;a.Fd=11;a.$B=12;a.fC=13;a.gC=14;var E=new Float32Array(2),
B=new Float32Array(2),w=new Float32Array(3),t=new Float32Array(3),x=new Float32Array(3),G=new Float32Array(4),C=new Float32Array(4),q=new Float32Array(4),y=new Float32Array(16),H=new Float32Array(16),z=new Float32Array(9),N=new Float32Array(9),y=new Float32Array(8),O=new Float32Array(3);a.So=function(a,c,e,g,z){var f=d(1);f.O=c;f.offset=new Float32Array(e);f.dc=g?new Float32Array(g):null;f.Ck=z;b(a,f);h(a,f,0)};a.Ro=function(a,c,e,g,z,f){var q=d(2);q.O=c;q.xv=e;q.offset=new Float32Array(g);q.dc=z?
new Float32Array(z):null;q.Ck=f;b(a,q);h(a,q,0)};a.Uu=function(a,c,e,g){var z=d(9),f=a.d.quat,q=c.d.quat;z.O=c;z.offset=new Float32Array(e);z.hg=new Float32Array(q);g&&(A.copy(g,f),A.multiply(q,f,f));b(a,z);h(a,z,0)};a.Tu=function(a,c,e,g,z,f,q,k){var l=d(10),x=a.d.quat,n=c.d.quat;l.O=c;l.offset=new Float32Array(e);l.hg=new Float32Array(n);l.Qv=m.angle_wrap_0_2pi(z);l.Rv=m.angle_wrap_0_2pi(f);l.Sv=m.angle_wrap_periodic(q,-Math.PI,Math.PI);l.Pv=m.angle_wrap_periodic(k,-Math.PI,Math.PI);g?(l.dc=new Float32Array(g),
A.copy(g,x),A.multiply(n,x,x)):l.dc=A.create();b(a,l);h(a,l,0)};a.Su=function(a,c,e,g){var z=d(12);z.O=c;z.offset=new Float32Array(e);z.sA=g;b(a,z);h(a,z,0)};a.Wu=function(a,c,e,g){var z=d(13);z.O=c;z.offset=new Float32Array(e);z.Ck=1;z.dc=g?new Float32Array(g):null;b(a,z);h(a,z,0)};a.yC=c;a.hE=e;a.Yu=function(a,c){var e=d(3);e.O=c;b(a,e);h(a,e,0)};a.Zu=function(a,c){var e=d(4);e.target=new Float32Array(c);b(a,e);h(a,e,0)};a.Pu=function(a,c,e,g){var z=d(5);z.O=c;z.ci=e;z.dist_max=g;b(a,z);h(a,z,0)};
a.Qu=function(a,c,e,g){var z=d(6);z.target=new Float32Array(c);z.ci=e;z.dist_max=g;b(a,z);h(a,z,0)};a.Vu=function(a,c,e){var g=d(7);g.O=c;g.offset=new Float32Array(e);b(a,g);h(a,g,0)};a.Ou=function(a,c,e){var g=d(8);g.O=c;g.offset=new Float32Array(e);b(a,g);h(a,g,0)};a.Nu=function(a,c,e){var g=d(11);g.O=c;g.Ws=new Float32Array(e);b(a,g);h(a,g,0)};a.append_stiff_viewport=function(a,c,e){var g=d(14);g.O=c;if("left"in e)g.gr=!0,g.Vm=e.left;else if("right"in e)g.gr=!1,g.Vm=e.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");
return}if("top"in e)g.Us=!0,g.Zn=e.top;else if("bottom"in e)g.Us=!1,g.Zn=e.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in e?(g.distance=e.distance,g.dc="rotation"in e?new Float32Array(e.rotation):null,b(a,g),h(a,g,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.lB=function(a,b){a.Qa&&h(a,a.Qa,b)};a.Jz=k;a.correct_up=f;a.Hv=function(a){return a.Qa?!0:!1};a.remove=function(a){a.Qa.O&&e(a.Qa.O,a);a.Qa=null};a.ce=function(a){return a.Qa?
a.Qa.type:null};a.get_parent=function(a){return a.Qa&&a.Qa.O?a.Qa.O:null};a.be=function(a){return a.Qa&&11==a.Qa.type?a.Qa.Ws:null};a.Ox=l};b4w.module.__container=function(a,p){p("__anchors");var d=p("__print"),b=p("__util"),c=null,e=null;a.get_canvas=function(){return c};a.get_container=function(){return e};a.init=function(a){a&&a.parentNode?(c=a,e=a.parentNode):b.oa("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":e.insertBefore(a,e.firstElementChild);break;case "JUST_BEFORE_CANVAS":e.insertBefore(a,c);break;case "JUST_AFTER_CANVAS":c.nextElementSibling?e.insertBefore(a,c.nextElementSibling):
e.appendChild(a,c);break;case "LAST":e.appendChild(a,c);break;default:d.error(b+" behavior unknown")}}};b4w.module.__controls=function(a,p){function d(a){return{type:a,value:0,ca:null,an:null,$m:null,bk:null,Rc:!1,key:0,jc:"",Gl:null,ln:!1,Fl:function(){},El:null,wp:function(){},wd:null,On:new Float32Array(3),am:new Float32Array(3),io:!1,as:function(){},axis:"",Ac:0,Gh:new Float32Array(3),xk:new Float32Array(4),threshold:0,Zr:new Float32Array(4),mj:0,lj:0,js:0,nj:0,Lc:0,repeat:!1,Zo:!1,Rj:0,Qj:0,Pj:0,Dm:0,Cm:0,Bm:0}}function b(a,b){var d;if(a.bk){d=a.an;for(var c=a.$m,e=0;e<d.length;e++)c[e]=d[e].value;
d=a.bk(c)}else d=!1;d||(a.value=Number(b))}function c(a){a=N.indexOf(a);-1<a?N.splice(a,1):w.error("Wrong object")}function e(a,b){for(var d=0,c=0;c<b.length;c++)for(var e=b[c].xe,g=0;g<e.length;g++)for(var h=e[g].td,z=0;z<h.length;z++)h[z]===a&&d++;return d}function h(a,b){switch(a.type){case 80:t.remove_collision_test(a.Gl,a.jc,a.Fl);a.Rc=!0;break;case 90:t.clear_collision_impulse_test(a.El);a.Rc=!0;break;case 100:t.remove_ray_test(a.wd,a.jc,a.On,a.am,a.io);a.Rc=!0;break;case 130:a.Rc=!0}var d=
b.indexOf(a);-1<d&&b.splice(d,1)}function k(a){for(var d=0;d<O.length;d++){var c=O[d];20==c.type&&a.keyCode==c.key&&b(c,1)}oa&&a.preventDefault();ra&&ra(a)}function f(a){for(var d=0;d<O.length;d++){var c=O[d];20==c.type&&0==a.keyCode&&16==c.key&&b(c,0);20==c.type&&a.keyCode==c.key&&b(c,0)}oa&&a.preventDefault();ra&&ra(a)}function l(a){var d=!1,c=null;S=!0;R=a.clientX;ca=a.clientY;I=a.clientX;M=a.clientY;for(var e=0;e<O.length;e++){var g=O[e];50==g.type&&(b(g,1),g.ca=a.which);160==g.type&&(d||(c=x.pick_object(a.clientX,
a.clientY),d=!0),g.value=c==g.wd?1:0)}K&&a.preventDefault();fa&&fa(a)}function g(a){for(var d=0;d<O.length;d++){var c=O[d];50==c.type&&b(c,0);160==c.type&&c.Zo&&(c.value=0)}S=!1;K&&!sa&&a.preventDefault();fa&&fa(a)}function m(a){var d=a.clientX,c=a.clientY;I=d;M=c;if(!z.Im||S)for(var e=d-R,g=c-ca,h=Math.sqrt(e*e+g*g),F=0;F<O.length;F++){var f=O[F];if(40===f.type)switch(f.axis){case "X":b(f,e);f.ca=d;break;case "Y":b(f,g);f.ca=c;break;case "XY":b(f,h),f.ca[0]=d,f.ca[1]=c}}K&&!sa&&a.preventDefault();
fa&&fa(a)}function n(a){var d=a.wheelDelta||-40*a.detail,d=d*H.Yy;F+=d;for(d=0;d<O.length;d++){var c=O[d];30===c.type&&b(c,F)}U&&a.preventDefault();ha&&ha(a)}function r(a){var b=a.targetTouches;if(1==b.length){for(var d=b[0],b=d.pageX,d=d.pageY,c=!1,e=null,g=0;g<O.length;g++){var h=O[g];160==h.type&&(c||(e=x.pick_object(b,d),c=!0),h.value=e==h.wd)}ia[0]=b;ia[1]=-1;ma[0]=d;ma[1]=-1}else 1<b.length&&(qa=ea=E(b),ia[0]=b[0].pageX,ia[1]=b[1].pageX,ma[0]=b[0].pageY,ma[1]=b[1].pageY);Y.set(ia);W.set(ma);
V&&V(a)}function A(J){var d=J.targetTouches;if(0!==d.length){if(1===d.length){Y[0]=d[0].pageX;Y[1]=-1;W[0]=d[0].pageY;W[1]=-1;var d=Y[0]-ia[0],c=W[0]-ma[0],e=Math.sqrt(d*d+c*c);if(-1!=ia[1]&&-1!=ma[1]){var g=Y[0]-ia[1],h=W[0]-ma[1],z=Math.sqrt(g*g+h*h);z<e&&(d=g,c=h,e=z)}for(z=0;z<O.length;z++){var F=O[z];if(60===F.type)switch(F.ca=a.PL_SINGLE_TOUCH_MOVE,F.axis){case "X":b(F,d);break;case "Y":b(F,c);break;case "XY":b(F,e)}}}else if(1<d.length){Y[0]=d[0].pageX;Y[1]=d[1].pageX;W[0]=d[0].pageY;W[1]=
d[1].pageY;qa=E(d);e=qa-ea;g=P;g[0]=(Y[0]+Y[1])/2;g[1]=(W[0]+W[1])/2;h=u;h[0]=(ia[0]+ia[1])/2;h[1]=(ma[0]+ma[1])/2;var f,d=g[0],c=g[1],z=h[0],F=h[1];f=Math.sqrt((d-z)*(d-z)+(c-F)*(c-F));for(z=0;z<O.length;z++)if(F=O[z],70===F.type&&Math.abs(f)<Math.abs(e)&&(F.ca=a.PL_MULTITOUCH_MOVE_ZOOM,b(F,e)),60===F.type&&Math.abs(f)>Math.abs(e))switch(F.ca=a.PL_MULTITOUCH_MOVE_PAN,F.axis){case "X":d=g[0]-h[0];b(F,d);break;case "Y":c=g[1]-h[1];b(F,c);break;case "XY":b(F,f)}}X&&J.preventDefault();V&&V(J)}}function v(a){for(var d=
0;d<O.length;d++){var c=O[d];if(170==c.type||180==c.type)c.Qj=a.beta,c.Rj=a.gamma,c.Pj=a.alpha,c.value||(c.Dm=a.gamma,c.Cm=a.beta,c.Bm=a.alpha,b(c,1))}}function E(a){var b=a[0],d=a[1];a=b.pageX;var b=b.pageY,c=d.pageX,d=d.pageY;return Math.sqrt((a-c)*(a-c)+(b-d)*(b-d))}var B=p("__config"),w=p("__print"),t=p("__physics"),x=p("__scenes"),G=p("__time"),C=p("__util"),q=p("vec3"),y=p("quat"),H=B.controls,z=B.o,N=[],O=[],L={},F=0,I=0,M=0,R=0,ca=0,S=!1,Y=new Float32Array(2),W=new Float32Array(2),ia=new Float32Array(2),
ma=new Float32Array(2),P=new Float32Array(2),u=new Float32Array(2),qa=0,ea=0,ja=!1,Z=0,oa=!1,K=!1,U=!1,X=!1,sa=!1,ra=null,fa=null,ha=null,V=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(J,d){for(var c=0;c<O.length;c++){var e=O[c],g=J,h=d;if(h)switch(e.type){case 110:var z=e.wd,f=z.d.g,z=z.d.quat,l=q.dist(e.Gh,f),k=e.Zr;y.invert(e.xk,k);y.multiply(z,k,k);y.normalize(k,k);k=Math.abs(2*
Math.acos(k[3]));l/=h;e.mj=C.smooth(l,e.mj,h,.3);e.ca[0]=l;l=k/h;e.lj=C.smooth(l,e.lj,h,.3);e.ca[1]=l;e.mj>=e.threshold||e.lj>=e.js?b(e,1):b(e,0);q.copy(f,e.Gh);y.copy(z,e.xk);e.Ac=g;break;case 120:z=e.wd;f=z.d.g;z=Math.abs(f[1]-e.Gh[1])/h;e.nj=C.smooth(z,e.nj,h,.3);e.ca=z;e.nj>=e.threshold?b(e,1):b(e,0);q.copy(f,e.Gh);e.Ac=g;break;case 130:!e.Rc&&0<=e.Lc&&g-e.Ac>=e.Lc&&(b(e,1),e.repeat?e.Ac=g:e.Lc=-e.Lc);break;case 140:e.Ac||(e.Ac=g);b(e,g-e.Ac);e.Ac=g;break;case 150:b(e,g);break;case 170:e.ca[0]=
Math.PI*(e.Rj-e.Dm)/180;e.ca[1]=Math.PI*(e.Qj-e.Cm)/180;e.ca[2]=Math.PI*(e.Pj-e.Bm)/180;e.Dm=e.Rj;e.Cm=e.Qj;e.Bm=e.Pj;break;case 180:e.ca[0]=Math.PI*e.Rj/180,e.ca[1]=Math.PI*e.Qj/180,e.ca[2]=Math.PI*e.Pj/180}}for(c=0;c<N.length;c++)for(h=N[c],e=h.xe,g=0;g<e.length;g++)if(f=e[g],f.Ys!=Z){f.Ys=Z;for(var z=f,l=z.td,k=z.Tz,x=0;x<l.length;x++)k[x]=l[x].value;var z=z.Ny(k),l=f,k=l.dr,K=x=void 0;switch(l.type){case a.CT_CONTINUOUS:z?K=x=1:1==k?K=x=-1:x=0;break;case a.CT_TRIGGER:z&&-1==k?K=x=1:z||1!=k?x=
0:K=x=-1;break;case a.CT_SHOT:z&&-1==k?K=x=1:z||1!=k?x=0:(x=0,K=-1);break;case a.CT_LEVEL:x=l.cr!=z?1:0;break;default:C.oa("Wrong sensor manifold type: "+l.type)}K&&(l.dr=K);if(l=x)if(k=h==L?null:h,ja=!1,f.callback(k,f.id,l,f.Av),f.cr=z,ja){c=-1;break}}for(c=0;c<N.length;c++)for(h=N[c],e=h.xe,g=0;g<e.length;g++)for(f=e[g],h=f.td,f=0;f<h.length;f++)switch(z=h[f],z.type){case 30:b(z,0);break;case 40:b(z,0);break;case 60:b(z,0);break;case 70:b(z,0);break;case 130:b(z,0)}F=0;R=I;ca=M;ia.set(Y);ma.set(W);
ea=qa;Z++};a.create_custom_sensor=function(a){var c=d(10);b(c,a);return c};a.create_keyboard_sensor=function(a){var b=d(20);b.key=a;return b};a.create_collision_sensor=function(a,c,e){if(!a||!a.m)return w.error("Wrong collision object"),null;var g=d(80);g.Gl=a;g.jc=c||"ANY";g.ln=e||!1;g.Fl=function(a,J){b(g,a);a&&J&&e&&(g.ca=g.ca||new Float32Array(3),g.ca[0]=J[0],g.ca[1]=J[1],g.ca[2]=J[2])};g.Rc=!0;return g};a.create_collision_impulse_sensor=function(a){if(!a||!a.m)return w.error("Wrong collision impulse object"),
null;var c=d(90);c.El=a;c.wp=function(a){b(c,a)};c.Rc=!0;return c};a.create_ray_sensor=function(a,c,e,g,z){if(!a)return w.error("Wrong collision object"),null;var h=d(100);h.wd=a;h.On=c;h.am=e;h.io=g||!1;h.jc=z||"ANY";h.as=function(a,J){b(h,a);a&&(h.ca=J)};h.Rc=!0;return h};a.create_mouse_click_sensor=function(){return d(50)};a.create_mouse_wheel_sensor=function(){return d(30)};a.create_mouse_move_sensor=function(a){var b=d(40);b.axis=a||"XY";b.ca="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=
function(a){var b=d(60);b.axis=a||"XY";b.ca=0;return b};a.create_touch_zoom_sensor=function(){var a=d(70);a.ca=0;return a};a.create_motion_sensor=function(a,b,c){if(!a)return w.error("Wrong collision object"),null;var e=d(110);e.wd=a;var g=a.d.g;a=a.d.quat;e.Zr=new Float32Array(4);e.Gh=new Float32Array(g);e.xk=new Float32Array(a);e.mj=0;e.lj=0;e.threshold=b||.1;e.js=c||.1;e.Ac=0;e.ca=new Float32Array([0,0]);return e};a.create_vertical_velocity_sensor=function(a,b){if(!a)return w.error("Wrong collision object"),
null;var c=d(120);c.wd=a;var e=a.d.quat;c.Gh=new Float32Array(a.d.g);c.xk=new Float32Array(e);c.nj=0;c.threshold=b||1;c.Ac=0;c.ca=0;return c};a.create_timer_sensor=function(a,b){var c=d(130);c.Lc=a;c.repeat=b;c.Rc=!0;return c};a.reset_timer_sensor=function(a,b,c,d){a=a||L;a=a.Oc;if(!a||!a[b])return w.error("reset_timer_sensor(): wrong object"),null;b=a[b].td[c];if(!b)return w.error("reset_timer_sensor(): sensor not found"),null;b.Ac=G.get_timeline();b.Lc=d};a.create_elapsed_sensor=function(){var a=
d(140);a.Ac=0;return a};a.create_gyro_delta_sensor=function(){var a=d(170);a.ca=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=d(180);a.ca=new Float32Array(3);return a};a.create_timeline_sensor=function(){return d(150)};a.create_selection_sensor=function(a,b){var c=d(160);c.wd=a;c.Zo=b;return c};a.Sz=b;a.get_sensor_value=function(a,b,c){a=a||L;a=a.Oc;if(!a||!a[b])return w.error("get_sensor_value(): wrong object"),null;b=a[b].td[c];return b?b.value:(w.error("get_sensor_value(): sensor not found"),
null)};a.get_sensor_payload=function(a,b,c){a=a||L;a=a.Oc;if(!a||!a[b])return w.error("get_sensor_payload(): wrong object"),null;b=a[b].td[c];return b?b.ca:(w.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){N=[];O=[];L={}};a.check_sensor_manifold=function(a,b){a=a||L;if(!a.Oc)return!1;if(b&&a.Oc[b])return!0;if(!b)for(var c in a.Oc)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||L;var d=a.Oc;if(d){var g=a.xe;if(b){var z=d[b];if(z){for(var F=z.td,f=0;f<F.length;f++)1===
e(F[f],N)&&h(F[f],O);delete d[b];z=g.indexOf(z);-1<z?g.splice(z,1):C.oa("Incorrect manifolds array");Object.getOwnPropertyNames(d).length||c(a)}}else{for(b in d){z=d[b];F=z.td;for(f=0;f<F.length;f++)1===e(F[f],N)&&h(F[f],O);delete d[b];z=g.indexOf(z);-1<z?g.splice(z,1):C.oa("Incorrect manifolds array")}c(a);ja=!0}}};a.create_sensor_manifold=function(a,b,c,d,g,z,F){a=a||L;a.Oc=a.Oc||{};a.xe=a.xe||[];var f=a.Oc,I=a.xe,q=f[b];if(q){d=q.td;for(var l=0;l<d.length;l++)1===e(d[l],N)&&h(d[l],O);q=I.indexOf(q);
-1<q?I.splice(q,1):C.oa("Incorrect manifolds array")}c={id:b,type:c,td:d.slice(0),Ny:g,Tz:Array(d.length),callback:z,Av:F,dr:-1,cr:0,Ys:-1};f[b]=c;I.push(c);-1==N.indexOf(a)&&N.push(a);a=c.td;for(b=0;b<a.length;b++){f=a[b];if(f.Rc){switch(f.type){case 80:t.append_collision_test(f.Gl,f.jc,f.Fl,f.ln);break;case 90:t.apply_collision_impulse_test(f.El,f.wp);break;case 100:t.append_ray_test(f.wd,f.jc,f.On,f.am,f.io,f.as);break;case 130:f.Ac=G.get_timeline(),0>f.Lc&&(f.Lc=-f.Lc)}f.Rc=!1}-1==O.indexOf(f)&&
O.push(f)}ja=!0};a.Vl=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.Ow=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<N.length;a++){var b=N[a],c=b.Oc,b=b.xe,d;for(d in c)delete c[d];b.splice(0,b.length)}for(a=0;a<O.length;a++)h(O[a],O),a--;N.splice(0,N.length)};a.debug=function(){w.log(String(N.length)+" objects with manifolds",N);w.log(String(O.length)+" sensors",O);for(var a=[],b=[],c=0;c<O.length;c++){var d=
O[c];80==d.type&&a.push(d);100==d.type&&b.push(d)}w.log(String(a.length)+" collision sensors",a);w.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",k,!1);a.addEventListener("keyup",f,!1);oa=b};a.register_mouse_events=function(a,b,c){if(c)var d=window;else d=a,d.addEventListener("mouseout",g,!1);a.addEventListener("mousedown",l,!1);d.addEventListener("mousemove",m,!1);d.addEventListener("mouseup",g,!1);K=b;sa=c};a.register_wheel_events=function(a,
b){a.addEventListener("mousewheel",n,!1);a.addEventListener("DOMMouseScroll",n,!1);U=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",r,!1);a.addEventListener("touchmove",A,!1);document.addEventListener("touchstart",function(){});X=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&z.gyro_use&&window.addEventListener("deviceorientation",v,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",k,!1);a.removeEventListener("keyup",
f,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",l,!1);a.removeEventListener("mousemove",m,!1);a.removeEventListener("mouseout",g,!1);a.removeEventListener("mouseup",g,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",n,!1);a.removeEventListener("DOMMouseScroll",n,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",r,!1);a.removeEventListener("touchmove",A,!1);document.removeEventListener("touchstart",function(){})};
a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&z.gyro_use&&window.removeEventListener("deviceorientation",v,!1)};a.wC=function(a){ra=a};a.xC=function(a){fa=a};a.AC=function(a){ha=a};a.zC=function(a){V=a}};b4w.module.__curve=function(a,p){function d(a,b,c,d,e){var m=d.length;e||(e=new Float32Array(m));for(var n=m+a,r=new Float32Array(n),A=1;A<=n-1;A++)r[A-1]=b>=c[A-1]&&b<c[A+1-1]?1:0;for(var v=2;v<=a;v++)for(A=1;A<=n-v;A++)r[A-1]=(0!=r[A-1]?(b-c[A-1])*r[A-1]/(c[A+v-1-1]-c[A-1]):0)+(0!=r[A+1-1]?(c[A+v-1]-b)*r[A+1-1]/(c[A+v-1]-c[A+1-1]):0);b==c[n-1]&&(r[m-1]=1);a=0;for(A=1;A<=m;A++)a+=r[A-1]*d[A-1];for(A=1;A<=m;A++)e[A-1]=0!=a?r[A-1]*d[A-1]/a:0;return e}function b(a){a=a.$j;return a[a.length-1]}function c(a){a=
a.Ip;return a[a.length-1]}var e=p("__util");a.Aw=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;b.Ue=e;a=a.points;var g=a.length/5,m=[],n=g+e,g=g+2;m[0]=0;for(var r=2;r<=n;r++)m[r-1]=r>e&&r<g?m[r-2]+1:m[r-2];b.$j=m;if("2D"==c.dimensions)b.Re=!1;else if("3D"==c.dimensions)b.Re=!0;else throw"Wrong curve dimensions";e=[];m=[];for(c=0;c<a.length;c+=5)e.push(a[c]),e.push(a[c+1]),e.push(a[c+2]),b.Re&&e.push(a[c+3]),m.push(a[c+4]);b.Kl=
e;b.uo=m;a=[];for(var c=b.Kl,e=b.Re?4:3,m=b.uo,n=b.$j,g=b.Ue,r=c.length/e,A=r+g,v=0,E=n[A-1]/999,B=0;1E3>B;B++){5E-6>n[A-1]-v&&(v=n[A-1]);for(var w=d(g,v,n,m),t=0;t<e;t++)for(var x=a[e*B+t]=0;x<r;x++)a[e*B+t]+=w[x]*c[e*x+t];v+=E}e=b.Re?4:3;m=new Float32Array(1E3);m[0]=0;for(c=1;1E3>c;c+=1)n=a[(c-1)*e],g=a[(c-1)*e+1],r=a[(c-1)*e+2],A=a[c*e],v=a[c*e+1],E=a[c*e+2],m[c]=m[c-1]+Math.sqrt((A-n)*(A-n)+(v-g)*(v-g)+(E-r)*(E-r));b.Ip=m;return b};a.FA=function(a,c,e){e||(e=[]);var l=c,g=Math.max(l,0);c=g=Math.min(l,
b(a));var l=a.Kl,g=a.Re?4:3,m=a.uo,n=a.$j,r=a.Ue;a=l.length/g;var A=a+r;5E-6>n[A-1]-c&&(c=n[A-1]);A=new Float32Array(a);d(r,c,n,m,A);for(c=0;c<g;c++)for(m=e[c]=0;m<a;m++)e[c]+=A[m]*l[g*m+c]};a.CA=function(a,b,c){c||(c=[]);var d=a.Kl,e=a.Re?4:3,m=a.uo,n=a.$j,r=a.Ue;a=d.length/e;var A=a+r;5E-6>n[A-1]-b&&(b=n[A-1]);var A=new Float32Array(a),v=b;b=A;var E=m.length;b||(b=new Float32Array(E));var B=new Float32Array(E),w=new Float32Array(E),t=B,x=w;t||(t=new Float32Array(E));x||(x=new Float32Array(E));for(var G=
E+r,C=new Float32Array(G),q=new Float32Array(G),y=1;y<=G-1;y++)C[y-1]=v>=n[y-1]&&v<n[y+1-1]?1:0;v==n[G-1]&&(C[E-1]=1);for(var H=2;H<=r;H++)for(y=1;y<=G-H;y++){var z=0!=C[y-1]?C[y-1]/(n[y+H-1-1]-n[y-1]):0,N=0!=C[y+1-1]?-C[y+1-1]/(n[y+H-1]-n[y+1-1]):0,O=0!=q[y-1]?(v-n[y-1])*q[y-1]/(n[y+H-1-1]-n[y-1]):0,L=0!=q[y+1-1]?(n[y+H-1]-v)*q[y+1-1]/(n[y+H-1]-n[y+1-1]):0;C[y-1]=(0!=C[y-1]?(v-n[y-1])*C[y-1]/(n[y+H-1-1]-n[y-1]):0)+(0!=C[y+1-1]?(n[y+H-1]-v)*C[y+1-1]/(n[y+H-1]-n[y+1-1]):0);q[y-1]=z+N+O+L}for(y=1;y<=
E;y++)t[y-1]=C[y-1],x[y-1]=q[y-1];n=0;for(r=1;r<=E;r++)n+=B[r-1]*m[r-1];v=0;for(r=1;r<=E;r++)v+=w[r-1]*m[r-1];for(r=1;r<=E;r++)b[r-1]=0!=n?w[r-1]*m[r-1]/n+B[r-1]*m[r-1]*v/(n*n):0;for(m=0;m<e;m++)for(n=c[m]=0;n<a;n++)c[m]+=A[n]*d[e*n+m]};a.qE=b;a.EA=c;a.DA=function(a,d){if(0>=d)return 0;var f=b(a);if(d>=c(a))return f;var l=a.Ip,g=e.pj(l,d,0,l.length-1);return f*(g+(d-l[g])/(l[g+1]-l[g]))/1E3}};b4w.module.__dds=function(a,p){function d(a,b,c,d){var e=new Uint16Array(4),g=new Uint16Array(c*d),h=0,f=0,l=0,x=f=h=0,k=0,C=0,q=0,y=c/4;d/=4;for(var H=0;H<d;H++)for(var z=0;z<y;z++)l=b+4*(H*y+z),e[0]=a[l],e[1]=a[l+1],h=e[0]&31,f=e[0]&2016,x=e[0]&63488,k=e[1]&31,C=e[1]&2016,q=e[1]&63488,e[2]=5*h+3*k>>3|5*f+3*C>>3&2016|5*x+3*q>>3&63488,e[3]=5*k+3*h>>3|5*C+3*f>>3&2016|5*q+3*x>>3&63488,h=a[l+2],f=4*H*c+4*z,g[f]=e[h&3],g[f+1]=e[h>>2&3],g[f+2]=e[h>>4&3],g[f+3]=e[h>>6&3],f+=c,g[f]=e[h>>8&3],g[f+1]=e[h>>
10&3],g[f+2]=e[h>>12&3],g[f+3]=e[h>>14],h=a[l+3],f+=c,g[f]=e[h&3],g[f+1]=e[h>>2&3],g[f+2]=e[h>>4&3],g[f+3]=e[h>>6&3],f+=c,g[f]=e[h>>8&3],g[f+1]=e[h>>10&3],g[f+2]=e[h>>12&3],g[f+3]=e[h>>14];return g}function b(a,b,c,e){var v=new Int32Array(c,0,31),E,B,w,t,x,G;if(542327876!=v[0])return k.error("Invalid magic number in DDS header"),0;if(!v[20]&4)return k.error("Unsupported format, must contain a FourCC code"),0;E=v[21];switch(E){case f:B=8;w=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case l:B=16;w=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case g:B=16;w=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return k.error("Unsupported FourCC code:",h(E)),null}G=1;v[2]&131072&&!1!==e&&(G=Math.max(1,v[7]));t=v[4];x=v[3];v=v[1]+4;if(b)for(E=0;E<G;++E)e=Math.max(4,t)/4*Math.max(4,x)/4*B,b=new Uint8Array(c,v,e),a.compressedTexImage2D(a.TEXTURE_2D,E,w,t,x,0,b),v+=e,t=Math.max(.5*t,1),x=Math.max(.5*x,1);else if(E==f)Math.max(4,t),Math.max(4,x),b=new Uint16Array(c),c=d(b,v/2,t,x),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,t,x,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),e&&a.generateMipmap(a.TEXTURE_2D);else return k.error("No manual decoder for",h(E),"and no native support"),0;return G}function c(a,c,d,e,g,h){var f=new XMLHttpRequest;f.open("GET",d,!0);f.responseType="arraybuffer";f.onload=function(){if(200==f.status){a.bindTexture(a.TEXTURE_2D,e);var d=b(a,c,f.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}h&&
h(e)};f.send(null);return e}function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function h(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var k=p("__print"),f=e("DXT1"),l=e("DXT3"),g=e("DXT5");a.$C=d;a.yB=b;a.zq=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.Rx=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case f:b=6;break;case l:case g:b=4;break;default:k.error("Unsupported FourCC code:",h(a))}return b};
a.WD=c;a.VD=function(a,b,d,e){var g=a.createTexture();c(a,b,d,g,!0,e);return g}};b4w.module.__debug=function(a,p){function d(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&k.oa("Structure assertion failed: incompatible types");for(var c in a)c in b||k.oa("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||k.oa("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&k.oa("Structure assertion failed: incompatible types for key "+c)}var c=
p("__extensions"),e=p("__print"),h=p("__textures"),k=p("__util"),f=null,l={},g=!1,m={},n=[],r=-1,A=null,v=!1;a.Fo={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Vc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(l[a[d]]=d)}f=a};a.Kv=function(a){if(g){var b=f.getError();b!=f.NO_ERROR&&(b in l?k.oa("GL Error: "+b+", gl."+l[b]+" ("+
a+")"):k.oa("Unknown GL error: "+b+" ("+a+")"))}};a.Fv=function(){if(g)switch(f.checkFramebufferStatus(f.FRAMEBUFFER)){case f.FRAMEBUFFER_COMPLETE:break;case f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case f.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case f.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case f.FRAMEBUFFER_UNSUPPORTED:e.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:e.error("FRAMEBUFFER CHECK FAILED")}};a.Iv=function(){if(-1!=r)return r;f.bindFramebuffer(f.FRAMEBUFFER,f.createFramebuffer());var a=h.Dj("DEBUG",h.Nh);h.resize(a,1,1);f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,a.Kb,a.Pa,0);f.checkFramebufferStatus(f.FRAMEBUFFER)!=f.FRAMEBUFFER_COMPLETE?(r=!0,e.warn("depth-only issue was found")):r=!1;f.bindFramebuffer(f.FRAMEBUFFER,null);return r};
a.Lv=function(a,b,c){if(g&&!f.getShaderParameter(a,f.COMPILE_STATUS))throw c=d(c),e.error("shader compilation failed:\n"+c+"\n"+f.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.Mv=function(a,b,h,l,k,n){if(g&&!f.getProgramParameter(a,f.LINK_STATUS)){var q=c.oq();q&&(k=q.getTranslatedShaderSource(h),n=q.getTranslatedShaderSource(l));k=d(k);n=d(n);e.error("shader linking failed:\n"+k+"\n\n\n"+n+"\n"+f.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){g=a};a.aD=function(a){m[a]=a in m?m[a]+1:1};a.update=function(){for(var a in m)e.log(a,m[a]),m[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(k.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}n.push(a)};a.msg=function(){for(var a=1,b=0;b<n.length;b++){var c=n[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],k.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);
else c.push(arguments[b]);n.push(c)};var E=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),g=0;g<n.length;g++){var h=n[g];a=h[0];if(!(a<d)){var f=String(h[1]);c[f]||(c[f]=E[b++%E.length]);a=["%c"+(a/1E3).toFixed(6),c[f],f];for(f=2;f<h.length;f++)a.push(h[f]);e.log.apply(this,a)}}n.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-
1E3*a),d=0;d<n.length;d++){var g=n[d];a=g[0];if(!(a<c))for(var h=2;h<g.length;h++){var f=String(g[1]);3<g.length&&(f+="_"+String(h-2));b[f]||(b[f]=f+"\n");b[f]+=String(a)+" "+g[h]+"\n"}}a="";for(f in b)a+=b[f]+"\n\n";e.log(a);n.splice(0)};a.HC=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(k.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.vC=function(a,b){typeof a!=b&&k.oa("Type assertion failed: value type is not a {"+b+"}:",a)};a.tC=b;a.uC=function(a){v?b(a,A):v=!0;A=a}};b4w.module.__extensions=function(a,p){function d(a){if(a in e)return e[a];var d=c.getExtension(a)||null;e[a]=d;b.log("%cGET EXTENSION","color: #"+(d?"0a0":"a00"),a);return d}var b=p("__print"),c=null,e={};a.Vc=function(a){c=a};a.vq=function(){return d("WEBGL_compressed_texture_s3tc")||d("WEBKIT_WEBGL_compressed_texture_s3tc")||d("MOZ_WEBGL_compressed_texture_s3tc")};a.Tx=function(){return d("WEBGL_depth_texture")||d("WEBKIT_WEBGL_depth_texture")||d("MOZ_WEBGL_depth_texture")};a.Lx=function(){return d("EXT_texture_filter_anisotropic")||
d("WEBKIT_EXT_texture_filter_anisotropic")||d("MOZ_EXT_texture_filter_anisotropic")};a.oq=function(){return d("WEBGL_debug_shaders")};a.uq=function(){return d("WEBGL_debug_renderer_info")};a.pq=function(){return d("OES_element_index_uint")};a.ey=function(){return d("OES_standard_derivatives")};a.cleanup=function(){e={}}};b4w.module.__graph=function(a){function p(a,b,c){c||(c=null);if(d(a,b))throw"Graph already has node with given ID";a.va.push(b,c)}function d(a,b){for(var c=a.va,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,c,e){e||(e=null);if(d(a,b)&&d(a,c))a.ma.push(b,c,e);else throw"Wrong node IDs";}function c(a,b){if(!d(a,b))throw"Node not found";for(var c=a.va,e=0;e<c.length;e+=2)c[e]==b&&(c.splice(e,2),e-=2)}function e(a){a=a.va;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function h(a,b){for(var c=a.va,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function k(a){var b=[],c={};f(a,c);for(var d=a.va,e=0;e<d.length;e+=2)0==w(a,d[e])&&l(a,d[e],c,b);return{va:b,ma:a.ma.slice(0)}}function f(a,b){for(var c=a.va,d=0;d<c.length;d+=2)b[c[d]]=!1}function l(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<B(a,b);e++)l(a,t(a,b,e),c,d);d.unshift(b,E(a,b))}}function g(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<B(a,b);e++){var h=t(a,b,e);g(a,h,c,d)}if(20==d||30==d)for(e=
0;e<w(a,b);e++)h=x(a,b,e),g(a,h,c,d)}}function m(a){var b=a.va;a=a.ma;for(var c=[],d=[],e=[],g=0;g<b.length;g++)e[b[2*g]]=g,c.push(g,b[2*g+1]);for(g=0;g<a.length;g+=3)d.push(e[a[g]],e[a[g+1]],a[g+2]);return{va:c,ma:d}}function n(a,b,c){if(c.gd==c.Te){for(var d=0,e=0;d<c.Te;d++)-1!=c.Sd[d]&&(a[e]=d,b[e]=c.Sd[d],e++);return!0}if(c.Te>c.kh||c.hf>c.jf||c.Dh>c.Fh||c.Ch>c.Eh)return!1;for(var e=d=-1,g=!1;!g&&r(c,H,d,e);)if(d=H[0],e=H[1],A(c,d,e)){var h;h=c;g={};g.ki=h.ki;g.li=h.li;g.nn=h.nn;g.Ij=h.Ij;g.Te=
h.Te;g.kh=h.kh;g.Ue=h.Ue;g.gd=g.jk=h.gd;g.Ch=h.Ch;g.Dh=h.Dh;g.hf=h.hf;g.Eh=h.Eh;g.Fh=h.Fh;g.jf=h.jf;g.Rh=-1;g.Sd=h.Sd;g.Ff=h.Ff;g.Of=h.Of;g.Pf=h.Pf;g.dg=h.dg;g.eg=h.eg;g.Fk=h.Fk;h.Fk[0]+=1;var g=h=g,f=d,q=e,l=g.ki,k=g.li,m=g.Te,C=g.kh,E=g.Sd,y=g.Ff,u=g.Of,G=g.Pf,p=g.dg,ja=g.eg;v(f<m);v(q<C);v(g.gd<m);v(g.gd<C);m=++g.gd;g.Rh=f;u[f]||(u[f]=m,g.Ch++,p[f]&&g.hf++);p[f]||(p[f]=m,g.Dh++,u[f]&&g.hf++);G[q]||(G[q]=m,g.Eh++,ja[q]&&g.jf++);ja[q]||(ja[q]=m,g.Fh++,G[q]&&g.jf++);E[f]=q;y[q]=f;for(E=0;E<w(l,f);E++)y=
x(l,f,E),u[y]||(u[y]=m,g.Ch++,p[y]&&g.hf++);for(E=0;E<B(l,f);E++)y=t(l,f,E),p[y]||(p[y]=m,g.Dh++,u[y]&&g.hf++);for(E=0;E<w(k,q);E++)y=x(k,q,E),G[y]||(G[y]=m,g.Eh++,ja[y]&&g.jf++);for(E=0;E<B(k,q);E++)y=t(k,q,E),ja[y]||(ja[y]=m,g.Fh++,G[y]&&g.jf++);g=n(a,b,h);v(1>=h.gd-h.jk);v(-1!=h.Rh);y=h.ki;f=h.li;q=h.gd;l=h.Rh;k=h.Sd;u=h.Ff;m=h.Of;G=h.Pf;C=h.dg;p=h.eg;if(h.jk<q){m[l]==q&&(m[l]=0);for(ja=0;ja<w(y,l);ja++)E=x(y,l,ja),m[E]==q&&(m[E]=0);C[l]==q&&(C[l]=0);for(ja=0;ja<B(y,l);ja++)E=t(y,l,ja),C[E]==q&&
(C[E]=0);y=k[l];G[y]==q&&(G[y]=0);for(ja=0;ja<w(f,y);ja++)E=x(f,y,ja),G[E]==q&&(G[E]=0);p[y]==q&&(p[y]=0);for(ja=0;ja<B(f,y);ja++)E=t(f,y,ja),p[E]==q&&(p[E]=0);k[l]=-1;u[y]=-1;h.gd=h.jk;h.Rh=-1}}return g}function r(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.hf,g=a.jf,h=a.Dh,f=a.Fh,q=a.Ch,l=a.Eh,k=a.gd,x=a.Te,n=a.kh,r=a.Sd,m=a.Ff,t=a.Of,w=a.Pf,A=a.dg,B=a.eg;if(e>k&&g>k)for(;c<x&&(-1!=r[c]||0==A[c]||0==t[c]);)c++,d=0;else if(h>k&&f>k)for(;c<x&&(-1!=r[c]||0==A[c]);)c++,d=0;else if(q>k&&l>k)for(;c<x&&
(-1!=r[c]||0==t[c]);)c++,d=0;else if(0==c&&0!=a.Ue){for(t=0;t<x&&-1!=r[c=a.Ue[t]];)t++;t==x&&(c=x)}else for(;c<x&&-1!=r[c];)c++,d=0;if(e>k&&g>k)for(;d<n&&(-1!=m[d]||0==B[d]||0==w[d]);)d++;else if(h>k&&f>k)for(;d<n&&(-1!=m[d]||0==B[d]);)d++;else if(q>k&&l>k)for(;d<n&&(-1!=m[d]||0==w[d]);)d++;else for(;d<n&&-1!=m[d];)d++;return c<x&&d<n?(b[0]=c,b[1]=d,!0):!1}function A(a,b,c){var d=a.ki,e=a.li,g=a.kh,h=a.Sd,f=a.Ff,q=a.Of,l=a.Pf,k=a.dg,n=a.eg;v(b<a.Te);v(c<g);v(-1==h[b]);v(-1==f[c]);if(!(0,a.nn)(E(d,
b),E(e,c)))return!1;for(var r=g=0,m=0,A=0,u=0,H=0,y=0;y<B(d,b);y++){var p=t(d,b,y);if(-1!=h[p]){var Z=h[p];if(!G(e,c,Z)||!C(a.Ij,d,b,p,e,c,Z))return!1}else q[p]&&m++,k[p]&&g++,q[p]||k[p]||u++}for(y=0;y<w(d,b);y++)if(p=x(d,b,y),-1!=h[p]){if(Z=h[p],!G(e,Z,c)||!C(a.Ij,d,p,b,e,Z,c))return!1}else q[p]&&m++,k[p]&&g++,q[p]||k[p]||u++;for(y=0;y<B(e,c);y++)if(Z=t(e,c,y),-1!=f[Z]){if(p=f[Z],!G(d,b,p))return!1}else l[Z]&&A++,n[Z]&&r++,l[Z]||n[Z]||H++;for(y=0;y<w(e,c);y++)if(Z=x(e,c,y),-1!=f[Z]){if(p=f[Z],!G(d,
p,b))return!1}else l[Z]&&A++,n[Z]&&r++,l[Z]||n[Z]||H++;return m<=A&&g<=r&&u<=H}function v(a){if(!a)throw"Assertion failed";}function E(a,b){for(var c=a.va,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function B(a,b){for(var c=a.ma,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function w(a,b){for(var c=a.ma,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function t(a,b,c){a=a.ma;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function x(a,b,c){a=a.ma;for(var d=
0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function G(a,b,c){a=a.ma;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function C(a,b,c,d,e,g,h){for(var f=q(b,c,d),l=q(e,g,h),k=0;k<f;k++){for(var x=!1,n=0;n<l;n++)if(a(y(b,c,d,k),y(e,g,h,n))){x=!0;break}if(!x)return!1}return!0}function q(a,b,c){var d=0;a=a.ma;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function y(a,b,c,d){a=a.ma;for(var e=0,g=0;g<a.length;g+=3)if(a[g]==b&&a[g+1]==c){if(e==
d)return a[g+2];e++}return null}var H=[-1,-1];a.Bo=-1;a.kC=10;a.yo=20;a.oC=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{va:b,ma:c}};a.TC=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{va:c,ma:d}};a.hl=p;a.BD=d;a.ed=b;a.Ki=c;a.lg=function(a,
b,c,d){if(!G(a,b,c))throw"Edge not found";a=a.ma;for(var e=0,g=0;g<a.length;g+=3)if(a[g]==b&&a[g+1]==c){if(-1==d)a.splice(g,3);else{if(d==e){a.splice(g,3);break}e++}g-=3}};a.v=function(a,b){if(-1==h(a,b)){var c=e(a);p(a,c,b);return c}throw"Non-unique attribute";};a.Ez=function(a,b,c,d,e){a=a.ma;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&a[g+2]==d&&(a[g+2]=e)};a.hq=e;a.lh=h;a.l=function(a,c,d,e){c=h(a,c);d=h(a,d);if(-1!=c&&-1!=d)b(a,c,d,e);else throw"Attributes not found";};a.S=function(a,b){for(var c=
a.va,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.qe=function(a,b){for(var c=a.ma,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.re=function(a,b,c){for(var d=a.ma,e=0;e<d.length;e+=3)if(d[e+1]==b){var g=d[e];if(c(g,E(a,g),d[e+2]))break}};a.lf=function(a,b,c){for(var d=a.ma,e=0;e<d.length;e+=3)if(d[e]==b){var g=d[e+1];if(c(g,E(a,g),d[e+2]))break}};a.$n=k;a.WA=function(a){a=k(a).va;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.LD=function(){};a.Ns=function(a,b,c){if(!d(a,b))throw"No such node";
var e={};f(a,e);g(a,b,e,c);b=[];for(var h in e)e[h]&&(h=Number(h),b.push(h,E(a,h)));a={va:b,ma:a.ma.slice(0)};e=a.ma;for(h=0;h<e.length;h+=3)b=e[h+1],d(a,e[h])&&d(a,b)||(e.splice(h,3),h-=3);return a};a.dy=function(a){for(var b=[],c=a.va,d=0;d<c.length;d+=2){var e=c[d];w(a,e)||b.push(e)}return b};a.xq=function(a){for(var b=[],c=a.va,d=0;d<c.length;d+=2){var e=c[d];B(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.ki=m(a);e.li=m(b);e.nn=c||function(a,b){return a==b};e.Ij=d||function(a,
b){return a==b};d=a.va.length/2;var g=b.va.length/2;e.Te=d;e.kh=g;e.Ue=0;e.gd=e.jk=0;e.hf=e.Ch=e.Dh=0;e.jf=e.Eh=e.Fh=0;e.Rh=-1;e.Sd=Array(d);e.Ff=Array(g);e.Of=Array(d);e.Pf=Array(g);e.dg=Array(d);e.eg=Array(g);e.Fk=[1];for(c=0;c<d;c++)e.Sd[c]=-1,e.Of[c]=0,e.dg[c]=0;for(c=0;c<g;c++)e.Ff[c]=-1,e.Pf[c]=0,e.eg[c]=0;g=Array(d);d=Array(d);if(n(g,d,e)){for(c=0;c<g.length;c++)g[c]=a.va[2*g[c]],d[c]=b.va[2*d[c]];return[g,d]}return null};a.Sa=E;a.nh=B;a.Oq=w;a.Vg=t;a.Nj=x;a.uD=q;a.Tg=y;a.replace=function(a,
b,d){for(var g=a.ma,h=e(a),f=0;f<b.length;f++){var q=b[f];c(a,q);for(var l=0;l<g.length;l+=3)g[l]==q&&(g[l]=h),g[l+1]==q&&(g[l+1]=h),g[l]==g[l+1]&&(g.splice(l,3),l-=3)}p(a,h,d)};a.wz=function(a,b,c,d,e){if(!G(a,b,c))throw"Edge not found";a=a.ma;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&(a[g]=d,a[g+1]=e)};a.UC=function(a,b){var c=a.va,d=a.ma,e;e="digraph debug {\n    node [shape=box];\n";for(var g=0;g<c.length;g+=2){var h=c[g],f=c[g+1],f=b?b(h,f):String(h);e+="    ";e+=String(h)+' [label="'+
f.replace(/\"/g,'\\"')+'"];\n'}for(g=0;g<d.length;g+=3)c=d[g],h=d[g+1],e+="    ",e+=String(c)+" -> "+String(h)+";\n";return e+="}"}};b4w.module.__ipc=function(a){a.Ct=0;var p=a.vt=1;a.wt=2;a.yt=3;a.zt=4;a.At=5;a.Dt=6;var d=a.Ft=7,b=a.Gt=8,c=a.Ht=9;a.It=10;a.Et=11;a.Bt=12;a.xt=13;a.eu=100;a.Gd=101;a.Jt=102;a.Kt=103;a.Lt=104;a.Nt=105;a.Mt=106;a.Ot=107;a.Pt=108;a.Qt=109;a.Rt=110;a.St=111;a.Tt=112;a.Ut=113;a.Vt=114;a.Wt=115;a.Xt=116;a.Yt=117;a.Zt=118;a.$t=119;a.au=120;a.cu=121;a.du=122;a.fu=123;a.Do=124;a.gu=125;a.hu=126;a.iu=127;a.ju=128;a.ku=129;a.lu=130;a.mu=131;a.nu=132;a.ou=133;a.pu=134;a.qu=135;a.ru=136;a.Eo=137;var e=a.dj=138;
a.su=139;a.Co=140;a.tu=141;a.uu=142;a.mC=143;a.bu=144;var h=null,k={msg_id:c,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),bc:new Float32Array(16)};k.bc[0]=c;var f={msg_id:d,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),bc:new Float32Array(10)};f.bc[0]=d;var l={msg_id:b,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0,bc:new Float32Array(11)};
l.bc[0]=b;var g={msg_id:p,body_id_a:0,body_id_b:0,result:0,coll_point:new Float32Array(3),bc:new Float32Array(7)};g.bc[0]=p;var m={msg_id:e,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),bc:new Float32Array(9)};m.bc[0]=e;a.init=function(a,r){a.addEventListener("message",function(a){a=a.data;var h=a[0]|0;switch(h){case c:var n=k;n.body_id=a[1];n.time=a[2];n.trans[0]=a[3];n.trans[1]=a[4];n.trans[2]=a[5];n.quat[0]=a[6];n.quat[1]=a[7];n.quat[2]=a[8];n.quat[3]=a[9];n.linvel[0]=a[10];n.linvel[1]=
a[11];n.linvel[2]=a[12];n.angvel[0]=a[13];n.angvel[1]=a[14];n.angvel[2]=a[15];break;case d:n=f;n.chassis_hull_body_id=a[1];n.prop_ind=a[2];n.trans[0]=a[3];n.trans[1]=a[4];n.trans[2]=a[5];n.quat[0]=a[6];n.quat[1]=a[7];n.quat[2]=a[8];n.quat[3]=a[9];break;case b:n=l;n.body_id=a[1];n.from[0]=a[2];n.from[1]=a[3];n.from[2]=a[4];n.to[0]=a[5];n.to[1]=a[6];n.to[2]=a[7];n.local=a[8];n.body_id_b_hit=a[9];n.cur_result=a[10];break;case p:n=g;n.body_id_a=a[1];n.body_id_b=a[2];n.result=a[3];n.coll_point[0]=a[4];
n.coll_point[1]=a[5];n.coll_point[2]=a[6];break;case e:n=m;n.body_id=a[1];n.trans[0]=a[2];n.trans[1]=a[3];n.trans[2]=a[4];n.quat[0]=a[5];n.quat[1]=a[6];n.quat[2]=a[7];n.quat[3]=a[8];break;default:n=a}r(h,n)},!1);h=a};a.cleanup=function(){h=null};a.t=function(){if(h){switch(arguments[0]|0){case c:var a=k,r=a.bc;r[1]=a.body_id;r[2]=a.time;r[3]=a.trans[0];r[4]=a.trans[1];r[5]=a.trans[2];r[6]=a.quat[0];r[7]=a.quat[1];r[8]=a.quat[2];r[9]=a.quat[3];r[10]=a.linvel[0];r[11]=a.linvel[1];r[12]=a.linvel[2];
r[13]=a.angvel[0];r[14]=a.angvel[1];r[15]=a.angvel[2];break;case d:a=f;r=a.bc;r[1]=a.chassis_hull_body_id;r[2]=a.prop_ind;r[3]=a.trans[0];r[4]=a.trans[1];r[5]=a.trans[2];r[6]=a.quat[0];r[7]=a.quat[1];r[8]=a.quat[2];r[9]=a.quat[3];break;case b:a=l;r=a.bc;r[1]=a.body_id;r[2]=a.from[0];r[3]=a.from[1];r[4]=a.from[2];r[5]=a.to[0];r[6]=a.to[1];r[7]=a.to[2];r[8]=a.local;r[9]=a.body_id_b_hit;r[10]=a.cur_result;break;case p:a=g;r=a.bc;r[1]=a.body_id_a;r[2]=a.body_id_b;r[3]=a.result;r[4]=a.coll_point[0];r[5]=
a.coll_point[1];r[6]=a.coll_point[2];break;case e:a=m;r=a.bc;r[1]=a.body_id;r[2]=a.trans[0];r[3]=a.trans[1];r[4]=a.trans[2];r[5]=a.quat[0];r[6]=a.quat[1];r[7]=a.quat[2];r[8]=a.quat[3];break;default:for(r=[],a=0;a<arguments.length;a++)r.push(arguments[a])}h.postMessage(r)}};a.tq=function(a){switch(a){case c:return k;case d:return f;case b:return l;case p:return g;case e:return m;default:return null}}};b4w.module.__hud=function(a,p){function d(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){c(' SCENE "'+a.name+'"');if(a.d){var b=0,d=0;f.S(a.d.mb,function(a,e){if("SINK"==e.type)c(" (F)",e.type);else{var g=e.type,h=Math.round(e.h.width)+"x"+Math.round(e.h.height),f=e.p.length,l=e.$h,k=e.enqueue&&e.Ra;k?c(" (A)",g,e.bg,h,l,"of",f):c(" (P)",g,e.bg,h,l,"of",f);e.$h=0;k&&(b+=f,d+=l)}});return[b,d]}c("No INFO")}function c(){for(var a=80+20*g[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var e="",h=0;h<b[d]-String(arguments[d]).length;h++)e+=" ";c+=e+arguments[d]}g[0]++;l.fillText(c,30,a)}function e(a,b,c){b*=a.Ca;c.x=a.x+b;c.y=a.y;c.Ca=a.Ca-2*b;c.ua=a.ua}function h(a){return a.x+a.Ca/2}function k(a){var b=l,c={x:0,y:0,Ca:0,ua:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.Ca=d;c.ua=b;e(c,.01,c);d=.02*c.ua;c.x=c.x;c.y+=d;c.Ca=c.Ca;c.ua-=2*d;d=c.Ca/8;c.x+=d*a;c.y=c.y;c.Ca=d;c.ua=c.ua;e(c,.02,c);return c}var f=p("__graph"),
l=null,g=[0,0];a.init=function(a){a=a.getContext("2d");d(a);return l=a};a.Hh=function(){l&&d(l)};a.reset=function(){var a=l;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),g[0]=0,g[1]=0)};a.pA=function(a,d){var e=l;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";c(" FPS",(1/d).toFixed(2));g[0]++;for(var h=e=0,f=0;f<a.length;f++){var k=b(a[f]),e=e+k[0],h=h+k[1];g[0]++}c(" ---------------------------------------------");
c("    ","TOTAL ACTIVE","","",h,"of",e)}};a.print=function(){var a=l;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",c.apply(Math,arguments))};a.plot_array=function(a,b,c,d,e,g,f){var w=l;if(w){b=k(b);var t=b.ua/5;b.x=b.x;b.y+=4*t;b.Ca=b.Ca;b.ua=t;w.textAlign="center";w.fillStyle="#00FF00";l.fillText(a,h(b),b.y-10);w.strokeStyle="#00FF00";w.lineWidth=.5;w.beginPath();w.moveTo(b.x,b.y);w.lineTo(b.x+b.Ca,b.y);w.lineTo(b.x+b.Ca,b.y+b.ua);w.lineTo(b.x,b.y+b.ua);w.closePath();w.stroke();if(!g&&
!f)for(g=1E6,f=-1E6,a=0;a<c.length;a++)g=Math.min(g,c[a]),f=Math.max(f,c[a]);w.textAlign="right";l.fillText(String(g),b.x-10,b.y+b.ua);l.fillText(String(f),b.x-10,b.y);w.textAlign="center";l.fillText(String(d),b.x,b.y+b.ua+15);l.fillText(String(e),b.x+b.Ca,b.y+b.ua+15);w.strokeStyle="#FF0000";w.lineWidth=1.5;w.beginPath();d=b.Ca/(c.length-1);f=b.ua/(f-g);for(a=0;a<c.length;a++)e=b.x+d*a,t=b.y+b.ua-(c[a]-g)*f,0==a?w.moveTo(e,t):w.lineTo(e,t);w.stroke()}};a.draw_mixer_strip=function(a,b,c,d,e,g,f){var w=
l;if(w)for(w.textAlign="center",w.fillStyle="#00FF00",w.font="bold 12px Courier",c=k(c),l.fillText(b?"["+a+"]":a,h(c),c.y),0<=g&&l.fillText(g?"[M]":"[ ]",h(c)-15,c.y+30),0<=f&&l.fillText(f?"[S]":"[ ]",h(c)+15,c.y+30),a={x:0,y:0,Ca:0,ua:0},b=0;b<d.length;b++){g=d[b];var t="VOLUME"==g[0];if(t){f=c.y+350;var x=c.Ca,G=a;G.x=c.x;G.y=f;G.Ca=x;G.ua=250}else{f=c.y+10+50*b;var x=c.Ca,G=c.ua,C=a;C.x=c.x;C.y=f;C.Ca=x;C.ua=G}f=w;var x=a,C=b==e,q=g[0],G=g[1],y=g[2],H=g[3],z=(H-y)/g[4],z=1>z?Math.floor(1/z-1E-5).toFixed(0).length:
0;g=g[5]?Math.log(G/y)/Math.log(H/y):(G-y)/(H-y);f.textAlign="center";C?f.fillText("["+q+"]",h(x),x.y):f.fillText(q,h(x),x.y);f.strokeStyle="#00FF00";f.lineWidth=t?3:1;t?(f.textAlign="right",f.fillText(H.toFixed(z),h(x)-10,x.y+15),f.textAlign="right",f.fillText(y.toFixed(z),h(x)-10,x.y+x.ua-15)):(f.textAlign="right",f.fillText(y.toFixed(z),x.x+28,x.y+15),f.textAlign="left",f.fillText(H.toFixed(z),x.x+x.Ca-28,x.y+15));f.beginPath();if(t){var N=x.y+15+(x.ua-30)*(1-g);f.moveTo(h(x),x.y+15);f.lineTo(h(x),
x.y+x.ua-15);f.moveTo(h(x)-5,x.y+15);f.lineTo(h(x)+5,x.y+15);f.moveTo(h(x)-5,x.y+x.ua-15);f.lineTo(h(x)+5,x.y+x.ua-15);f.moveTo(h(x)-5,N);f.lineTo(h(x)+5,N)}else{var O=x.x+30+(x.Ca-60)*g;f.moveTo(x.x+30,x.y+15);f.lineTo(x.x+x.Ca-30,x.y+15);f.moveTo(x.x+30,x.y+15-5);f.lineTo(x.x+30,x.y+15+5);f.moveTo(x.x+x.Ca-30,x.y+15-5);f.lineTo(x.x+x.Ca-30,x.y+15+5);f.moveTo(O,x.y+15-5);f.lineTo(O,x.y+15+5)}f.stroke();"EQ_Q"==q?(g=Math.log(1+1/(2*G*G)+Math.sqrt((2+1/(G*G))*(2+1/(G*G))/4-1))/Math.log(2),t?(f.textAlign=
"left",f.fillText(G.toFixed(z),h(x)+10,N),f.textAlign="left",f.fillText("("+g.toFixed(z+1)+")",h(x)+10,N+10)):(f.textAlign="right",f.fillText(G.toFixed(z),O,x.y+30),f.textAlign="left",f.fillText("("+g.toFixed(z+1)+")",O,x.y+30))):t?(f.textAlign="left",f.fillText(G.toFixed(z),h(x)+10,N)):(f.textAlign="center",f.fillText(G.toFixed(z),O,x.y+30))}}};b4w.module.__renderer=function(a,p){function d(a){for(var b=a.h,d=a.p,g=0;g<d.length;g++){var h=d[g];if(h.Ra){var f=a,l=b,k=h.qd,r=h.D,m=r.Wb;w.useProgram(m.Ei);for(var h=r.R,F=r.Xo,I=m.Vs,M=I.length;M--;){var A=I[M];A.rm(w,A.Xf,f,k,r,l)}l=r.Ap;w.colorMask(l,l,l,l);w.depthMask(r.V);r.Ha?w.enable(w.CULL_FACE):w.disable(w.CULL_FACE);l=r.M;for(r=0;r<l.length;r++)I=l[r],w.activeTexture(w.TEXTURE0+r),w.bindTexture(I.Kb,I.Pa);if("SKY"==f.type){l=f;m=m.Qi;r=l.h.ab.Pa;I=l.Zh;for(M=0;6>M;M++)if(A=e(M),n.Dl?
(w.bindTexture(w.TEXTURE_CUBE_MAP,r),w.texImage2D(A,0,w.RGBA,1,1,0,w.RGBA,w.UNSIGNED_BYTE,B)):(w.uniformMatrix4fv(m.u_cube_view_matrix,!1,I[M]),w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,A,r,0),c(h,F,k.jo)),l.hk&&3!=M){var A=l,ca=M,v=t;n.Dl?v.set(B):(w.readPixels(191,191,1,1,w.RGBA,w.UNSIGNED_BYTE,v),255!=v[0]&&255!=v[1]&&255!=v[2]||w.readPixels(191,220,1,1,w.RGBA,w.UNSIGNED_BYTE,v));var E=v[0],p=v[1],v=v[2],E=E/255,p=p/255,v=v/255;2===ca?(A.kc[3]=E,A.kc[7]=p,A.kc[11]=v):2>ca?(A.kc[4*
ca]=E,A.kc[4*ca+1]=p,A.kc[4*ca+2]=v):(A.kc[4*(ca-2)]=E,A.kc[4*(ca-2)+1]=p,A.kc[4*(ca-2)+2]=v)}f.$h+=6}else c(h,F,k.jo),f.$h++}}}function b(a){if(a){var b=(a.aa?w.COLOR_BUFFER_BIT:0)|(a.ga?w.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=E;break;case "SHADOW_CAST":a=r;break;case "DEPTH":a=A;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=v;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=E;break;default:a=
n.background_color}}else b=w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT,a=n.background_color;w.colorMask(!0,!0,!0,!0);w.depthMask(!0);w.clearColor(a[0],a[1],a[2],a[3]);w.clear(b)}function c(a,b,c){w.bindBuffer(w.ARRAY_BUFFER,a.nf);for(var d=0;d<b.length;d++){var e=b[d];w.enableVertexAttribArray(e.Xf);w.vertexAttribPointer(e.Xf,e.pd,w.FLOAT,!1,0,e.nv+e.px*c)}a.de?(w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,a.de),w.drawElements(a.mode,a.count,a.Hm,0)):w.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],
w.disableVertexAttribArray(e.Xf)}function e(a){switch(a){case 0:return w.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return w.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return w.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return w.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return w.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return w.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function h(a){var b=a.Qi,c=[],d=[],e={},g;for(g in b){var h=!1;switch(g){case "u_proj_matrix":var f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.pa)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":f=
function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.ea)};h=!0;break;case "u_shadow_cast_billboard_view_matrix":f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.ss)};h=!0;break;case "u_view_proj_prev":f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.tz)};h=!0;break;case "u_view_proj_inverse":f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Jh)};h=!0;break;case "u_sky_vp_inverse":f=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.vd)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":f=function(a,
b,c,d,e,g){a.uniform3fv(b,g.Le)};h=!0;break;case "u_camera_eye_last":f=function(a,b,c,d,e,g){a.uniform3fv(b,g.Yp)};h=!0;break;case "u_camera_quat":f=function(a,b,c,d,e,g){a.uniform4fv(b,g.quat)};h=!0;break;case "u_view_max_depth":f=function(a,b,c,d,e,g){a.uniform1f(b,g.bb)};h=!0;break;case "u_camera_range":f=function(a,b,c,d,e,g){a.uniform2f(b,g.Ta,g.bb)};break;case "u_csm_center_dists":f=function(a,b,c,d,e,g){a.uniform4fv(b,g.Hp)};break;case "u_cam_water_depth":f=function(a,b,c){a.uniform1f(b,c.zl)};
h=!0;break;case "u_waves_height":f=function(a,b,c){a.uniform1f(b,c.rf)};break;case "u_waves_length":f=function(a,b,c){a.uniform1f(b,c.yg)};break;case "u_fog_color_density":f=function(a,b,c){a.uniform4fv(b,c.Xb)};break;case "u_underwater_fog_color_density":f=function(a,b,c){a.uniform4fv(b,c.$c)};break;case "u_bloom_key":f=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":f=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":f=function(a,b,c){a.uniform1f(b,c.time)};
h=!0;break;case "u_wind":f=function(a,b,c){a.uniform3fv(b,c.Xi)};break;case "u_sky_tex_dvar":f=function(a,b,c){a.uniform1f(b,c.ws)};break;case "u_sky_tex_fac":f=function(a,b,c){a.uniform4fv(b,c.xs)};break;case "u_sky_tex_color":f=function(a,b,c){a.uniform3fv(b,c.vs)};break;case "u_horizon_color":f=function(a,b,c){a.uniform3fv(b,c.Oe)};break;case "u_zenith_color":f=function(a,b,c){a.uniform3fv(b,c.sf)};break;case "u_environment_energy":f=function(a,b,c){a.uniform1f(b,c.Ke)};break;case "u_world_vec":f=
function(a,b,c,d,e,g){c=g.ea;a.uniform3fv(b,[c[4],c[5],c[6]])};h=!0;break;case "u_sky_color":f=function(a,b,c){a.uniform3fv(b,c.th)};break;case "u_rayleigh_brightness":f=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":f=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":f=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":f=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":f=
function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":f=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":f=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":f=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":f=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":f=function(a,b,c){a.uniform3fv(b,c.Vf)};break;case "u_light_directions":f=
function(a,b,c){a.uniform3fv(b,c.Tf)};break;case "u_light_color_intensities":f=function(a,b,c){a.uniform3fv(b,c.Sf)};break;case "u_light_factors":f=function(a,b,c){a.uniform4fv(b,c.Uf)};break;case "u_sun_quaternion":f=function(a,b,c){a.uniform4fv(b,c.Qs)};break;case "u_sun_intensity":f=function(a,b,c){a.uniform3fv(b,c.Ps)};break;case "u_sun_direction":f=function(a,b,c){a.uniform3fv(b,c.Kk)};break;case "u_height":f=function(a,b,c,d,e,g){a.uniform1f(b,g.height)};h=!0;break;case "u_model_matrix":f=function(a,
b,c,d){a.uniformMatrix4fv(b,!1,d.T)};h=!0;break;case "u_transb":f=function(a,b,c,d){a.uniform4fv(b,d.Cc)};h=!0;break;case "u_transa":f=function(a,b,c,d){a.uniform4fv(b,d.Bc)};h=!0;break;case "u_arm_rel_trans":f=function(a,b,c,d){a.uniform4fv(b,d.jl)};h=!0;break;case "u_arm_rel_quat":f=function(a,b,c,d){a.uniform4fv(b,d.il)};h=!0;break;case "u_quat":f=function(a,b,c,d){a.uniform4fv(b,d.quat)};h=!0;break;case "u_quatsb":f=function(a,b,c,d){a.uniform4fv(b,d.uc)};h=!0;break;case "u_quatsa":f=function(a,
b,c,d){a.uniform4fv(b,d.tc)};h=!0;break;case "u_frame_factor":f=function(a,b,c,d){a.uniform1f(b,d.Kf)};h=!0;break;case "au_center_pos":f=function(){};h=!0;break;case "au_wind_bending_amp":f=function(a,b,c,d){a.uniform1f(b,d.bd)};h=!0;break;case "au_wind_bending_freq":f=function(a,b,c,d){a.uniform1f(b,d.se)};h=!0;break;case "au_detail_bending_freq":f=function(a,b,c,d){a.uniform1f(b,d.Ud)};h=!0;break;case "au_detail_bending_amp":f=function(a,b,c,d){a.uniform1f(b,d.Td)};h=!0;break;case "au_branch_bending_amp":f=
function(a,b,c,d){a.uniform1f(b,d.Pd)};h=!0;break;case "u_node_values":f=function(a,b,c,d){a.uniform1fv(b,d.ge)};h=!0;break;case "u_node_rgbs":f=function(a,b,c,d){a.uniform3fv(b,d.qc)};h=!0;break;case "u_diffuse_color":f=function(a,b,c,d,e){a.uniform4fv(b,e.Nb)};h=!0;break;case "u_diffuse_intensity":f=function(a,b,c,d,e){a.uniform1f(b,e.Ge)};h=!0;break;case "u_diffuse_params":f=function(a,b,c,d,e){a.uniform2fv(b,e.Vd)};h=!0;break;case "u_emit":f=function(a,b,c,d,e){a.uniform1f(b,e.Zd)};h=!0;break;
case "u_ambient":f=function(a,b,c,d,e){a.uniform1f(b,e.Ld)};h=!0;break;case "u_specular_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.xd)};h=!0;break;case "u_specular_alpha":f=function(a,b,c,d,e){a.uniform1f(b,e.uh)};h=!0;break;case "u_specular_params":f=function(a,b,c,d,e){a.uniform3fv(b,e.fc)};h=!0;break;case "u_reflect_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.kg)};h=!0;break;case "u_mirror_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.jn)};h=!0;break;case "u_grass_map_dim":f=function(a,b,
c,d,e){a.uniform3fv(b,e.Zb)};h=!0;break;case "u_grass_size":f=function(a,b,c,d,e){a.uniform1f(b,e.Am)};h=!0;break;case "u_scale_threshold":f=function(a,b,c,d,e){a.uniform1f(b,e.Aq)};h=!0;break;case "u_cube_fog":f=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.kc)};break;case "u_jitter_amp":f=function(a,b,c,d,e){a.uniform1f(b,e.Zq)};h=!0;break;case "u_jitter_freq":f=function(a,b,c,d,e){a.uniform1f(b,e.$q)};h=!0;break;case "u_wireframe_mode":f=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;
case "u_wireframe_edge_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":f=function(a,b,c){a.uniform2fv(b,c.Hy)};h=!0;break;case "u_subsample_indices":f=function(a,b,c){a.uniform4fv(b,c.Iy)};h=!0;break;case "u_refr_bump":f=function(a,b,c,d,e){a.uniform1f(b,e.cs)};h=!0;break;case "u_lamp_light_positions":f=function(a,b,c,d,e){a.uniform3fv(b,e.Sm)};break;case "u_lamp_light_directions":f=function(a,b,c,d,e){a.uniform3fv(b,e.Qm)};break;case "u_lamp_light_color_intensities":f=
function(a,b,c,d,e){a.uniform3fv(b,e.Pm)};break;case "u_lamp_light_factors":f=function(a,b,c,d,e){a.uniform4fv(b,e.Rm)};break;case "u_halo_size":f=function(a,b,c,d,e){a.uniform1f(b,e.Fq)};h=!0;break;case "u_halo_hardness":f=function(a,b,c,d,e){a.uniform1f(b,e.Cq)};h=!0;break;case "u_halo_rings_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.Eq)};h=!0;break;case "u_halo_lines_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.Dq)};h=!0;break;case "u_halo_stars_blend":f=function(a,b,c,d,e){a.uniform1f(b,e.Gq)};
h=!0;break;case "u_halo_stars_height":f=function(a,b,c,d,e){a.uniform1f(b,e.Hq)};h=!0;break;case "u_fresnel_params":f=function(a,b,c,d,e){a.uniform4fv(b,e.Sc)};h=!0;break;case "u_texture_scale":f=function(a,b,c,d,e){a.uniform3fv(b,e.kf)};h=!0;break;case "u_parallax_scale":f=function(a,b,c,d,e){a.uniform1f(b,e.gg)};h=!0;break;case "u_color_id":f=function(a,b,c,d){a.uniform3fv(b,d.Aj)};h=!0;break;case "u_line_points":f=function(a,b,c,d,e){a.uniform3fv(b,e.UD)};h=!0;break;case "u_diffuse_color_factor":f=
function(a,b,c,d,e){a.uniform1f(b,e.Fe)};h=!0;break;case "u_alpha_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.ye)};h=!0;break;case "u_specular_color_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.Ds)};h=!0;break;case "u_normal_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.tr)};h=!0;break;case "u_normalmap0_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.ag[0])};h=!0;break;case "u_normalmap1_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.ag[1])};h=!0;break;case "u_normalmap2_scale":f=function(a,b,c,
d,e){a.uniform2fv(b,e.ag[2])};h=!0;break;case "u_normalmap3_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.ag[3])};h=!0;break;case "u_foam_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":f=function(a,b,c,d,e){a.uniform2fv(b,e.bq)};h=!0;break;case "u_foam_mag":f=function(a,b,c,d,e){a.uniform2fv(b,e.aq)};h=!0;break;case "u_foam_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.lm)};h=!0;break;case "u_water_norm_uv_velocity":f=function(a,b,c,d,e){a.uniform1f(b,
e.Lh)};h=!0;break;case "u_shallow_water_col":f=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":f=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":f=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":f=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":f=function(a,b,c,d,e){a.uniform1f(b,e.Jr)};h=!0;break;case "u_p_cyclic":f=
function(a,b,c,d,e){a.uniform1i(b,e.Fr)};h=!0;break;case "u_p_max_lifetime":f=function(a,b,c,d,e){a.uniform1f(b,e.Lr)};h=!0;break;case "u_p_fade_in":f=function(a,b,c,d,e){a.uniform1f(b,e.Gr)};h=!0;break;case "u_p_fade_out":f=function(a,b,c,d,e){a.uniform1f(b,e.Hr)};h=!0;break;case "u_p_size":f=function(a,b,c,d,e){a.uniform1f(b,e.sn)};h=!0;break;case "u_p_alpha_start":f=function(a,b,c,d,e){a.uniform1f(b,e.Cr)};h=!0;break;case "u_p_alpha_end":f=function(a,b,c,d,e){a.uniform1f(b,e.Br)};h=!0;break;case "u_p_nfactor":f=
function(a,b,c,d,e){a.uniform1f(b,e.rn)};h=!0;break;case "u_p_gravity":f=function(a,b,c,d,e){a.uniform1f(b,e.Ir)};h=!0;break;case "u_p_mass":f=function(a,b,c,d,e){a.uniform1f(b,e.Kr)};h=!0;break;case "u_p_size_ramp":f=function(a,b,c,d,e){a.uniform2fv(b,e.Mr)};h=!0;break;case "u_p_color_ramp":f=function(a,b,c,d,e){a.uniform4fv(b,e.Dr)};h=!0;break;case "u_p_wind":f=function(a,b,c,d,e){a.uniform3fv(b,e.pk)};h=!0;break;case "u_texel_size":f=function(a,b,c){a.uniform2fv(b,c.Xn)};h=!0;break;case "u_p_time":f=
function(a,b,c,d,e){a.uniform1f(b,e.rc.P.time)};h=!0;break;case "u_position":f=function(a,b,c,d,e){a.uniform3fv(b,e.Di)};h=!0;break;case "u_va_frame_factor":f=function(a,b,c,d){a.uniform1f(b,d.ht)};h=!0;break;case "u_normal_offset":f=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":f=function(a,b,c,d,e,g){a.uniform4fv(b,g.uk)};break;case "u_v_light_matrix":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.gt)};h=!0;break;case "u_b_light_matrix":f=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.ap)};break;case "u_p_light_matrix0":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.fg[0])};h=!0;break;case "u_p_light_matrix1":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.fg[1])};h=!0;break;case "u_p_light_matrix2":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.fg[2])};h=!0;break;case "u_p_light_matrix3":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.fg[3])};h=!0;break;case "u_motion_blur_exp":f=function(a,b,c){a.uniform1f(b,c.or)};h=!0;break;case "u_refl_plane":f=function(a,b,c,d){a.uniform4fv(b,d.cc)};
break;case "u_radial_blur_step":f=function(a,b,c){a.uniform1f(b,c.zk)};break;case "u_god_rays_intensity":f=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":f=function(a,b,c){a.uniform1f(b,c.xh)};break;case "u_ssao_blur_discard_value":f=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":f=function(a,b,c){a.uniform1f(b,c.wh)};break;case "u_ssao_dist_factor":f=function(a,b,c){a.uniform1f(b,c.vh)};break;case "u_dof_dist":f=
function(a,b,c,d,e,g){a.uniform1f(b,g.dof_distance)};h=!0;break;case "u_dof_front":f=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_front)};h=!0;break;case "u_dof_rear":f=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_rear)};h=!0;break;case "u_outline_intensity":f=function(a,b,c,d){a.uniform1f(b,d.Tc)};h=!0;break;case "u_outline_color":f=function(a,b,c){a.uniform3fv(b,c.Ve)};break;case "u_draw_outline":f=function(a,b,c){a.uniform1f(b,c.Zl)};h=!0;break;case "u_glow_mask_small_coeff":f=function(a,b,c){a.uniform1f(b,
c.small_glow_mask_coeff)};h=!0;break;case "u_glow_mask_large_coeff":f=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};h=!0;break;case "u_brightness":f=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":f=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":f=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":f=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:f=null}f&&(f={name:g,rm:f,Xf:b[g]},h?c.push(f):(d.push(f),e[g]=f))}a.Vs=
c;a.Ai=d;a.un=e}var k=p("__config"),f=p("__debug"),l=p("__textures"),g=p("__util"),m=p("__camera");p("mat4");var n=k.o,r=[1,1,1,1],A=[1,1,1,1],v=[0,0,0,1],E=[0,0,0,0],B=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var w=null,t=new Uint8Array(4);a.Vc=function(a){var b=n.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);
a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);w=a};a.di=function(a){if(a.Ra){var c=a.h;w.bindFramebuffer(w.FRAMEBUFFER,c.ae);if(a.ll){var g=c.ab;w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,g.Kb,g.Pa,0)}w.viewport(0,0,c.width,c.height);"MAIN_CUBE_REFLECT"!=a.type&&b(a);a.Da?w.enable(w.BLEND):w.disable(w.BLEND);a.Bb?w.enable(w.DEPTH_TEST):w.disable(w.DEPTH_TEST);if(a.ia){for(var c=a.h,g=a.p,l=0;l<g.length;l++){var k=g[l],t=k.D,z=t.Wb;w.useProgram(z.Ei);
k=k.qd;z.Ai.length||h(z);for(var z=z.Ai,n=z.length;n--;){var r=z[n];r.rm(w,r.Xf,a,k,t,c)}}a.ia=!1}switch(a.type){case "SHADOW_CAST":w.enable(w.POLYGON_OFFSET_FILL);w.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);w.cullFace(w.BACK);break;case "MAIN_PLANE_REFLECT":w.disable(w.POLYGON_OFFSET_FILL);w.cullFace(w.FRONT);break;default:w.disable(w.POLYGON_OFFSET_FILL),w.cullFace(w.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(c=a.h,g=c.ab.Pa,l=0;6>l;l++){t=e(l);c.ea=a.Zh[l];m.yl(c);
w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,t,g,0);b(a);t=a.p;for(k=0;k<t.length;k++)t[k].Ra=t[k].Yl[l];d(a)}else d(a);f.Kv("draw subscene: "+a.type);w.bindFramebuffer(w.FRAMEBUFFER,null)}};a.clear=function(a){w.bindFramebuffer(w.FRAMEBUFFER,a.h.ae);b(a)};a.Uo=function(a){var b=a.Xo;b.length=0;var c=a.R;a=a.Wb;c&&a||g.oa("Incomplete batch");c=c.Tb;a=a.attributes;for(var d in a){var e=c[d];b.push({Xf:a[d],nv:4*e.offset,px:1<e.frames?4*e.length:0,pd:e.pd})}};a.mv=h;a.Vo=function(a){var b=
a.Wb,c=a.M;a=a.Jb;w.useProgram(b.Ei);for(var d=0;d<c.length;d++)w.uniform1i(b.Qi[a[d]],d)};a.bs=function(a,b,c,d,e,f){d||(d=1);e||(e=1);f||(f=new Uint8Array(4*d*e));f.length!=4*d*e&&g.oa("read_pixels(): Wrong storage");w.bindFramebuffer(w.FRAMEBUFFER,a);w.readPixels(b,c,d,e,w.RGBA,w.UNSIGNED_BYTE,f);w.bindFramebuffer(w.FRAMEBUFFER,null);return f};a.fB=function(a){var b=a.Wb;w.useProgram(b.Ei);b.Ai.length||h(b);b=b.un.u_cube_fog;b.rm(w,b.Xf,null,null,a,null)};a.Dz=function(a,b){var c=w.createFramebuffer();
w.bindFramebuffer(w.FRAMEBUFFER,c);if(a){var d=a,e=d.Pa,d=d.Kb==w.TEXTURE_CUBE_MAP?w.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Kb;w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,d,e,0)}l.Vq(b)?w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,b.of):l.ri(b)&&(d=b,e=d.Pa,d=d.Kb,w.framebufferTexture2D(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,d,e,0));f.Fv();w.bindFramebuffer(w.FRAMEBUFFER,null);return c};a.Cz=function(a,b,c,d,e){null==a?(w.bindFramebuffer(w.FRAMEBUFFER,a),w.viewport(0,0,
d,e),w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT)):(l.ri(b)&&w.deleteTexture(b.Pa),l.Vq(c)?w.deleteRenderbuffer(c.of):l.ri(c)&&w.deleteTexture(c.Pa),w.deleteFramebuffer(a))};a.ED=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function d(a,c,d){var e=a.He;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.He,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function c(a,b){var c=a+b;if(x[c])return x[c];if(B){var d=B[b];if(!d)return null}else{d=v.fy(a+b);if(!d)return null;d=w.Sr.parse(d)}return x[c]=d}function e(a,b,d){function e(b){b=b.a;for(var d=0;d<b.length;d++){var m=b[d];switch(m.type){case "condition":a:for(var m=
m.a,A=0;A<m.length;A++){var H=m[A];switch(H.type){case "if":case "elif":var K=H.c;try{var U=g(K)}catch(X){throw"Failed to process #"+H.type+" expression: "+K.join(" ");}if(U){e(H.group);break a}break;case "else":e(H.group);break a;case "ifdef":H.name in r&&e(H.group);break;case "ifndef":H.name in r||e(H.group)}}break;case "include":m=c(E.shaders_dir,E.nA+m.file);e(m);break;case "var":case "export":case "import":break;case "define":A=m.name;r[A]=m.b;m.Ua&&(w[A]=m.Ua);break;case "error":throw"Shader error: #error "+
m.b.join(" ");case "line":break;case "pragma":t.push("#pragma "+m.name+" "+m.b.join(" "));break;case "undef":m=m.name;delete r[m];delete w[m];break;case "warning":n.warn("Shader warning: #warning "+m.b.join(" "));break;case "extension":t.push("#extension "+h(m.b,r,w,!1));break;case "#":break;case "node":B[m.name]=m;break;case "nodes_global":m=k;for(A=0;A<m.length;A++)if(H=m[A],K=B[H.id])for(var y=0,R=0;R<K.k.length;R++){var fa=K.k[R];"node_param"==fa.type&&(fa=fa.qualifier.join(" ")+" ","vert"==a?
fa+=H.Wi[y]:"frag"==a&&(fa+=H.Ua[y],null!==H.rk[y]&&(fa+=" = "+H.rk[y])),fa+=";",t.push(fa),y++)}break;case "nodes_main":m=k;for(A=0;A<m.length;A++)if(H=m[A],K=B[H.id]){y={};R={};for(fa=0;fa<H.Ie.length;fa++)R[H.Ie[fa][0]]=[H.Ie[fa][1]];u=P=G=0;for(var fa=H,ha=K.k,V=y,J=R,aa=0;aa<ha.length;aa++){var wa=ha[aa];switch(wa.type){case "node_in":var na=fa.K[G];if(null!==fa.Km[G]){if(("MATERIAL"==fa.id&&3===G||"MATERIAL_EXT"==fa.id&&3===G||"TEXTURE_COLOR"==fa.id||"TEXTURE_NORMAL"==fa.id)&&wa.e){V[wa.name]=
fa.Km[G];G++;continue}var p=wa.qualifier.join(" ")+" ",p=p+na,p=p+(" = "+fa.Km[G]),p=p+";";t.push(p)}V[wa.name]=na;G++;break;case "node_out":na=fa.Ma[P];if(!wa.e||-1<C.indexOf(na))p=wa.qualifier.join(" ")+" ",p+=na,p+=";",t.push(p),V[wa.name]=na;-1<C.indexOf(na)&&(J["USE_OUT_"+wa.name]=[1]);P++;break;case "node_param":"vert"==a?na=fa.Wi[u]:"frag"==a&&(na=fa.Ua[u]),V[wa.name]=na,u++}}t.push("{");f(H,K.f,y,R);t.push("}")}break;case "lamp":v[m.name]=m;break;case "lamps_main":m=x;for(A=0;A<m.length;A++)if(H=
m[A],H.Fy){t.push("{");K=v[H.type].f;for(y=0;y<K.length;y++){R=K[y];fa=[];for(ha=0;ha<R.b.length;ha++){V=R.b[ha];switch(V){case "LAMP_IND":V=H.index;break;case "LAMP_LIGHT_FACT_IND":V=H.Ly;break;case "LAMP_FAC_CHANNELS":V=H.Ky;break;case "LAMP_SPOT_SIZE":V=l(H.Xc);break;case "LAMP_SPOT_BLEND":V=l(H.pg||.01);break;case "LAMP_LIGHT_DIST":V=l(H.distance);break;case "LAMP_SHADOW_MAP_IND":V=H.vx?1:0}fa.push(V)}t.push(fa.join(" "))}t.push("}")}break;case "textline":t.push(h(m.b,r,w,!1));break;default:throw"Unknown element type: "+
m.type;}}}function g(a,b){var c=h(a,r,w,!0,b);return A.Sr.parse(c)}function f(a,b,c,d){for(var e=0;e<b.length;e++){var l=b[e];switch(l.type){case "node_condition":a:for(var k=a,l=l.a,q=c,m=d,x=0;x<l.length;x++){var z=l[x];switch(z.type){case "node_if":case "node_elif":var ha=z.c;try{var n=g(ha,m)}catch(J){throw"Failed to process #"+z.type+" expression: "+ha.join(" ");}if(n){f(k,z.f,q,m);break a}break;case "node_else":f(k,z.f,q,m);break a;case "node_ifdef":(z.name in r||z.name in m)&&f(k,z.f,q,m);
break;case "node_ifndef":z.name in r||z.name in m||f(k,z.f,q,m)}}break;case "textline":k=[];for(q=0;q<l.b.length;q++)m=l.b[q],m in c?k.push(c[m]):k.push(m);t.push(h(k,r,w,!0,d))}}}var k=d.on,x=d.Wm;d=d.He||[];for(var t=[],r={},m=0;m<d.length;m++)r[d[m][0]]=[d[m][1]];for(m=0;m<k.length;m++)r["USE_NODE_"+k[m].id]=[1];var w={},B={},v={},C=[];for(m in k)for(var p in k[m].K)C.push(k[m].K[p]);e(b);var G=0,P=0,u=0;return t.join("\n")}function h(a,b,c,d,e){var g=[];k(a,b,c,d,g,e);return g.join(" ")}function k(a,
b,c,d,e,g){for(var f=0;f<a.length;f++){var h=a[f];h in b||g&&h in g?(h=g&&g[h]||b[h],0==h.length&&d?e.push(0):k(h,b,c,d,e,g)):e.push(h)}}function f(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);r.Lv(d,b,c);return d}function l(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return g(a);case 2:return"vec2("+g(a[0])+","+g(a[1])+")";case 3:return"vec3("+g(a[0])+","+g(a[1])+","+g(a[2])+")";case 4:return"vec4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+")";case 9:return"mat3("+
g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+")";case 16:return"mat4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+","+g(a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(a[13])+","+g(a[14])+","+g(a[15])+")";default:throw"Wrong glsl value dimension";}}function g(a){return a%1?String(a):String(a)+".0"}var m=p("__config"),n=p("__print"),r=p("__debug"),A=p("__gpp_eval"),v=p("__assets");
p("__util");var E=m.Sb;if(b4w.module_check("shader_texts"))var B=p("shader_texts"),w=null;else B=null,w=p("__gpp_parser");var t={},x={},G=[],C=null;a.Vc=function(a){C=a};a.s=d;a.Ux=b;a.MD=function(a,b){for(var c=a.He,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.Vz=function(a){a.He=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var e=b[c],g;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":g=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":g=1;break;case "SHADOW_TEX_RES":g=l(2048);break;case "AA_METHOD":g="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":g="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":g="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":g="POST_EFFECT_NONE";break;case "SHADOW_SRC":g="SHADOW_SRC_NONE";break;case "SHADOW_DST":g=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":g="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":g="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":g="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":g=m.o.precision;break;case "EPSILON":g="highp"==m.o.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":g="u_va_frame_factor";break;default:n.error("Unknown directive ("+a.Ui+", "+a.hi+"): "+e)}d(a,e,g)}};a.yD=function(a){return a.Ui};a.qq=function(a){return a.hi};a.FD=function(a,c){for(var e=
c.He,g=0;g<e.length;g++){var f=e[g][0],h=e[g][1];b(a,f)&&d(a,f,h)}};a.Qx=function(a){var b=JSON.stringify(a),d=t[b];if(d)return d;var g=a.hi,d=c(E.shaders_dir,a.Ui),g=c(E.shaders_dir,g);if(!d||!g)return null;var h=e("vert",d,a),l=e("frag",g,a),d=C,k=f(d,b,h,d.VERTEX_SHADER),m=f(d,b,l,d.FRAGMENT_SHADER),g=d.createProgram();d.attachShader(g,k);d.attachShader(g,m);d.linkProgram(g);d.validateProgram(g);d.getProgramParameter(g,d.VALIDATE_STATUS)==d.jC&&n.error("shader program is not valid",b);r.Mv(g,b,
k,m,h,l);a={oo:k,fq:m,Ei:g,attributes:{},Qi:{},Ai:[],un:{},Vs:[],fb:a};l=d.getProgramParameter(g,d.ACTIVE_ATTRIBUTES);for(h=0;h<l;h++)k=d.getActiveAttrib(g,h).name,a.attributes[k]=d.getAttribLocation(g,k);l=d.getProgramParameter(g,d.ACTIVE_UNIFORMS);for(h=0;h<l;h++)k=d.getActiveUniform(g,h).name.split("[0]").join(""),a.Qi[k]=d.getUniformLocation(g,k);return t[b]=d=a};a.Kw=function(){return G};a.nq=function(){return t};a.cleanup=function(){for(var a in t){var b=t[a];C.deleteProgram(b.Ei);C.deleteShader(b.oo);
C.deleteShader(b.fq);delete t[a]}for(var c in x)delete x[c];for(var d in G)delete G[d]};a.VC=function(a){var b=a.He;n.log("Shader: "+a.Ui+" "+a.hi+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)n.log("  "+b[a][0],b[a][1])};a.u=l;a.tp=function(a,b){return b in a.Qi?!0:!1};a.iy=function(a){return(C.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function d(a){return 65536<a.I?y.pq()?!1:!0:!1}function b(a){return 0<a.ba.length?!0:!1}function c(a,c,d){if(!b(a))return a;d||G.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.I*(c||1)+", will use drawArrays","color: #aa0");c=a.ba;d=a.I;var g=a.H,f=a.B,h;for(h in g){var l=g[h],k=A(l,d);g[h]=e(c,l,k)}for(g=0;g<f.length;g++){var q=f[g];for(h in q)l=q[h],k=A(l,d),q[h]=e(c,l,k)}for(g=0;g<a.U.length;g++){h=a.U[g].Ob;for(var m in h)l=h[m],k=
A(l,d),h[m]=e(c,l,k)}a.I=c.length;a.ba=new Uint16Array(0);return a}function e(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var g=a[e],f=0;f<c;f++)d[c*e+f]=b[c*g+f];return d}function h(a,b){var c=a.Yc,d=a.Tb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function k(b,c){var d,e;switch(c){case a.Mh:case a.cj:d=L.TRIANGLES;e=L.STATIC_DRAW;break;case a.Ao:d=L.POINTS;e=L.STATIC_DRAW;
break;case a.bj:d=L.TRIANGLES;e=L.DYNAMIC_DRAW;break;case a.zo:d=L.POINTS;e=L.DYNAMIC_DRAW;break;case a.st:d=L.LINES;e=L.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.Ti=e}function f(a){a.Pe?(a.de||(a.de=L.createBuffer()),L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,a.de),L.bufferData(L.ELEMENT_ARRAY_BUFFER,a.Pe,a.Ti),a.Fj=a.Pe.byteLength):a.Fj=0;a.nf||(a.nf=L.createBuffer());L.bindBuffer(L.ARRAY_BUFFER,a.nf);L.bufferData(L.ARRAY_BUFFER,a.Yc,a.Ti);a.Lp=a.Yc.byteLength}function l(a){for(var b=
q.jb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].ba.length;b.ba=new Uint32Array(c);var e=c=0,g=0;if(0<a[0].U.length)for(var f=0;f<a[0].U.length;f++){for(d=0;d<a.length;d++)c+=a[d].U[f].Ob.a_position.length,e+=a[d].U[f].Ob.a_normal.length,g+=a[d].U[f].Ob.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(g)};b.U.push({Uj:a[0].U[f].Uj,Ob:d})}for(d=c=0;d<a.length;d++)c+=a[d].I;b.I=c;var e=a[0],h;for(h in e.H){for(d=c=0;d<a.length;d++)c+=
a[d].H[h].length;b.H[h]=new Float32Array(c)}for(h in e.B[0]){for(d=c=0;d<a.length;d++)c+=a[d].B[0][h].length;for(d=0;d<e.B.length;d++)b.B[d]=b.B[d]||{},b.B[d][h]=new Float32Array(c)}for(h=e=c=0;h<a.length;h++){for(var g=a[h],l=g.ba,f=g.I,k=g.H,d=0;d<l.length;d++)b.ba[c+d]=l[d]+e;var c=c+l.length,m;for(m in k){var l=k[m],t=e*A(l,f);b.H[m].set(l,t)}for(d=0;d<g.B.length;d++){var k=g.B[d],x=b.B[d];for(m in k)l=k[m],t=e*A(l,f),x[m].set(l,t)}e+=f}if(0<b.U.length)for(h=0;h<b.U.length;h++)for(m=b.U[h].Ob,
d=g=e=c=0;d<a.length;d++)f=a[d].U[h].Ob,m.a_position.set(f.a_position,c),m.a_normal.set(f.a_normal,e),m.a_tangent.set(f.a_tangent,g),c+=f.a_position.length,e+=f.a_normal.length,g+=f.a_tangent.length;return b}function g(a,b,d,e,g,f){var h=q.jb("SUBMESH_"+a.name+"_"+b),l=a.submeshes[b],k=l.base_length,t=a.materials[b];h.I=k;var x=!1;if(n(d,"a_texcoord")){var z=null,A=a.materials[b];b=a.submeshes[b];if(A.texture_slots.length)switch(A=A.texture_slots[0],A.texture_coords){case "UV":A=a.uv_textures.indexOf(A.uv_layer);
-1==A||0==A?z=new Float32Array(b.texcoord):1==A&&(z=new Float32Array(b.texcoord2));break;case "ORCO":for(var B=a.b4w_bounding_box,z=new Float32Array(2*b.base_length),A=(B.max_x+B.min_x)/2,v=(B.max_z+B.min_z)/2,H=B.max_x-B.min_x,B=B.max_z-B.min_z,C=0,K=0;K<b.position.length;K+=3)z[C++]=(b.position[K]-A)/H+.5,z[C++]=(v-b.position[K+2])/B+.5}null===z&&(z=new Float32Array(b.texcoord));b=z}else b=new Float32Array(0);var U,z=l.group;if(n(d,"a_influence")&&e){A=new Float32Array(4*k);v=z.length/k;H=new Float32Array(v);
for(B=0;B<v;B++)for(U in H[B]=-1,e)if(C=e[U],C.kt===B){H[B]=C.ai;break}K=3<v?v:4;e=new Float32Array(K);U=new Uint32Array(K);for(var B=new Float32Array(4),C=new Float32Array(K),K=new Uint32Array(K),X=new Float32Array(4),E=0;E<k;E++)e.set(C),U.set(K),B.set(X),A.set(r(z,v,E,k,H,e,U,B),4*E)}else A=new Float32Array(0);U=A;e=g?q.ya(g):{};e.a_color={Mf:!0};e.a_color.src=n(d,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Ic:7}]:[];g={a_texcoord:b,a_influence:U};U=l.vertex_colors;b=l.color;z=a.name;
A=[];for(v=0;v<U.length;v++)A.push(U[v].name);for(var y in e)if(v=e[y].src,v.length){for(B=H=0;B<v.length;B++)H+=q.mg(v[B].Ic);g[y]=new Float32Array(H*k);for(B=C=0;B<v.length;B++){var fa=v[B].name,K=v[B].Ic,X=q.hs(K),ha=A.indexOf(fa);-1==ha&&q.oa('vertex color "'+fa+'" for mesh "'+z+'" not found.');var E=U[ha].mask,V=q.mg(E);(K&E)!==K&&G.error("Wrong color extraction from "+fa+" to "+y+".");for(var J=fa=0;J<ha;J++)fa+=q.mg(U[J].mask);ha=fa*k;for(fa=0;fa<k;fa++)for(J=0;3>J;J++)X[J]&&(g[y][fa*H+(C+
q.Li(K,J))]=b[ha+fa*V+q.Li(E,J)]);C+=V}}else g[y]=new Float32Array(0);y=a.uv_textures;e=l.texcoord;U=l.texcoord2;b=a.name;if(f)for(var aa in f){z=y.indexOf(aa);-1==z&&q.oa('uv map "'+aa+'" for mesh "'+b+'" not found');if(0==z)var wa=new Float32Array(e);else 1==z&&(wa=new Float32Array(U));g[f[aa]]=wa}h.H=g;h.ba=new Uint32Array(l.indices);f=l.position.length/k/3;wa=(aa=n(d,"a_normal")&&l.normal.length?!0:!1)&&n(d,"a_tangent")&&l.tangent.length?!0:!1;y=aa&&t.texture_slots.length&&n(d,"a_tangent")&&"ORCO"==
t.texture_slots[0].texture_coords?!0:!1;0<a.b4w_shape_keys.length&&(x=!0);for(g=0;g<f;g++){t=m(l,d,k,aa,wa,y,g);if(x)if(e={},e.name=a.b4w_shape_keys[g].name,h.U.push(e),0!=g){e.Ob=t;e.Uj=a.b4w_shape_keys[g].value;continue}else e.Ob=m(l,d,k,aa,wa,y,g),e.Uj=1;h.B.push(t)}if(1<f&&!x){a=h.B[0];var t={},na;for(na in a)t[na]=new Float32Array(a[na]);h.B.push(t)}n(d,"a_polyindex")&&(c(h,1,!0),h.H.a_polyindex=w(h));return h}function m(a,b,c,d,e,g,f){var h={},l=new Float32Array(3*c),k=new Float32Array(d?3*
c:0),m=new Float32Array(e||g?4*c:0),t=f*c*3;l.set(a.position.subarray(t,t+3*c),0);d&&(t=f*c*3,k.set(a.normal.subarray(t,t+3*c),0));if(e)t=f*c*4,m.set(a.tangent.subarray(t,t+4*c),0);else if(g)for(a=m,G.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+mesh.name+'". Please add a UV-map.'),b=0;b<c;b++)d=z,e=N,d[0]=k[3*b],d[1]=k[3*b+1],d[2]=k[3*b+2],H.cross(d,q.AXIS_Z,e),0==H.length(e)&&H.cross(d,q.AXIS_X,e),H.normalize(e,e),a[4*b]=e[0],a[4*b+1]=e[1],
a[4*b+2]=e[2],a[4*b+3]=1;else if(d&&n(b,"a_tangent"))for(m=new Float32Array(4*c),c=0;c<m.length;c++)m[c]=1;h.a_position=l;h.a_normal=k;h.a_tangent=m;return h}function n(a,b){return-1<a.indexOf(b)?!0:!1}function r(b,c,d,e,g,f,h,l){for(var k=!0,q=0;q<c;q++){var m=b[q*e+d];if(-1!==m){var t=g[q];-1!==t&&(f[q]=m,h[q]=t,k=!1)}}if(k)return l;v(f,h,a.Yk,!1);for(q=b=0;4>q;q++)b+=f[q];if(.01>b)return l;for(q=0;4>q;q++)f[q]/=b;if(.01>Math.abs(f[0]-1))l[0]=h[0]+1;else for(q=0;4>q;q++)l[q]=h[q]+f[q];return l}
function A(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function v(b,c,d,e){for(var g=b.length,f=g,h=!1,l=e?-1:1;1<f||h;){1<f&&(f=Math.floor(f/1.247330950103979));for(var h=!1,k=0;f+k<g;k++)if(d==a.Yk?0>l*(b[k]-b[k+f]):b[k]<b[k+f]&&e)h=b[k],b[k]=b[k+f],b[k+f]=h,h=c[k],c[k]=c[k+f],c[k+f]=h,h=!0}}function E(a,b,c){var d=[],e=[];H.subtract(b,a,d);H.subtract(c,a,e);H.normalize(d,d);H.normalize(e,
e);return Math.acos(H.dot(d,e))}function B(a,c,d){c||(c=[]);d=d?a.B[0].a_normal:a.B[0].a_position;if(b(a)){a=a.ba;for(var e=a.length/3,g=0;g<e;g++){var f=new Float32Array(9),h=a[3*g];f[0]=d[3*h];f[1]=d[3*h+1];f[2]=d[3*h+2];h=a[3*g+1];f[3]=d[3*h];f[4]=d[3*h+1];f[5]=d[3*h+2];h=a[3*g+2];f[6]=d[3*h];f[7]=d[3*h+1];f[8]=d[3*h+2];c[g]=f}}else for(g=0;g<d.length;g++)f=new Float32Array(9),f[0]=d[9*g],f[1]=d[9*g+1],f[2]=d[9*g+2],f[3]=d[9*g+3],f[4]=d[9*g+4],f[5]=d[9*g+5],f[6]=d[9*g+6],f[7]=d[9*g+7],f[8]=d[9*
g+8],c[g]=f;return c}function w(a){for(var b=new Float32Array(a.I),c=0;c<a.I;c++)b[c]=c%3;return b}function t(a,b,c){var d=H.dist(a,b);a=H.dist(a,c);b=H.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function x(a,b,c,d,e){c-=b;for(var g=0;g<c;g+=d)g%d==e&&vec3.normalize(a.subarray(g+b-e,g+b+1),a.subarray(g+b-e,g+b+1))}var G=p("__print"),C=p("__tsr"),q=p("__util"),y=p("__extensions"),H=p("vec3"),z=new Float32Array(3),N=new Float32Array(3),O=new Float32Array(3);a.Jd=10;a.Go=20;a.pC=30;a.cj=10;a.Ao=
20;a.bj=30;a.zo=40;a.st=50;a.Yk=0;a.wu=1;a.Mh=a.cj;var L=null;a.Vc=function(a){L=a};a.WC=function(a){var b=_buffers[a];L.deleteBuffer(b.de);L.deleteBuffer(b.nf);delete _buffers[a]};a.NA=function(e,g,h,l){d(e)&&c(e);var q=e.ba,m=e.I,t=e.B,x={},r;for(r in e.H)r in l&&!l[r].Mf||(x[r]=e.H[r]);l={Pe:null,Yc:null,Hm:0,count:0,Tb:{},mode:0,Ti:0,Fj:0,Lp:0,nf:null,de:null,Sj:null,U:null};if(0<e.U.length){r=t[0];for(var n=1;n<e.U.length;n++){for(var z=e.U[n].Ob,w=z.a_position,B=z.a_normal,v=r.a_position,H=
r.a_normal,C=w.length,E=e.U[n].Uj,K=0;K<C;K++)v[K]+=E*w[K],H[K]+=E*B[K];z=z.a_tangent;w=r.a_tangent;B=z.length;for(K=0;K<B;K++)w[K]+=E*z[K]}}if(q.length)if(r=q.length,65536>=m)var n=new Uint16Array(q),U=L.UNSIGNED_SHORT;else n=new Uint32Array(q),U=L.UNSIGNED_INT;else r=m,n=null;var E=0,K=t.length,X;for(X in t[0])z=t[0][X],E+=z.length*K;for(X in x)z=x[X],E+=z.length;X=new Float32Array(E);var E=0,K={},y;for(y in x)if(w=x[y],z=w.length)X.set(w,E),K[y]={BC:y,pd:A(w,m),offset:E,frames:1,length:z},E+=z;
x=t.length;for(y in t[0])if(w=t[0][y],z=w.length,w=A(w,m),z)for(K[y]={pd:w,offset:E,frames:x,length:z},1<x&&(K[y+"_next"]={pd:w,offset:E+z,frames:x,length:z}),B=0;B<x;B++)w=t[B][y],X.set(w,E),E+=z;l.count=r;l.Pe=n;l.Yc=X;l.Hm=U;l.Tb=K;k(l,h);f(l);g!=a.Jd&&b(e)&&(l.Sj={Wy:new Float32Array(q.length),Xy:new Float32Array(q.length),Ww:new Float32Array(q.length/3),type:g});l.U=e.U;return l};a.Dy=d;a.Cy=b;a.Sn=c;a.hB=function(a,b,c){k(a,b);a.count=c.length;a.Pe=c;a.Hm=c instanceof Uint16Array?L.UNSIGNED_SHORT:
L.UNSIGNED_INT};a.Ok=function(a,b,c,d){var e=a.Yc,g=a.Tb,h=g[b];h?(c&&h.pd!=c&&q.oa('invalid num_comp for "'+b+'"'),e.set(d,h.offset)):(e=e.length,h=new Float32Array(e+d.length),h.set(a.Yc),h.set(d,e),a.Yc=h,g[b]={pd:c,offset:e});f(a)};a.fx=h;a.ZD=function(a){a.Ti=L.STATIC_DRAW};a.Qy=function(a){a.Ti=L.DYNAMIC_DRAW};a.at=f;a.vp=function(a){a.de&&L.deleteBuffer(a.de);a.nf&&L.deleteBuffer(a.nf)};a.Jq=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Os=function(a,b){for(var c=0;c<a.B.length;c++){var d=
a.B[c].a_position;C.transform_vectors(d,b,d,0);d=a.B[c].a_normal;0<d.length&&C.transform_dir_vectors(d,b,d,0);d=a.B[c].a_tangent;0<d.length&&C.transform_tangents(d,b,d,0)}(c=a.H.au_center_pos)&&c.length&&C.transform_vectors(c,b,c,0);return a};a.LA=function(a,b){var c=a.H.au_center_pos;if(c&&c.length){var d=new Float32Array(c);C.transform_vectors(d,b,d,0);for(var e=0;e<a.B.length;e++)for(var g=0;g<d.length;g++)a.B[e].a_position[g]+=d[g]-c[g];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';
};a.KA=function(a,b){var c=a.I,d;for(d in b){var e=b[d].length;a.H[d]=new Float32Array(e*c);for(var g=0;g<c;g++)for(var f=0;f<e;f++)a.H[d][g*e+f]=b[d][f]}};a.MA=l;a.Py=function(a,b,d){if(!a.I)return q.jb("EMPTY");var e=d.length;65536<a.I*e&&!y.pq()&&c(a,e);var g=a.ba,f=a.I,h=a.H;a=a.B;for(var l in b){var k=b[l].length,m=k*f;h[l]=new Float32Array(m);for(var t=0;t<f;t++)for(m=0;m<k;m++)h[l][t*k+m]=b[l][m]}b=q.jb("CLONE_"+e+"_SUBMESHES");b.I=f*e;b.ba=new Uint32Array(g.length*e);for(t=0;t<e;t++)for(k=
g.length*t,l=f*t,m=0;m<g.length;m++)b.ba[k+m]=g[m]+l;for(var x in h)for(g=h[x],m=g.length*e,k=A(g,f),b.H[x]=new Float32Array(m),t=0;t<e;t++)l=f*k*t,b.H[x].set(g,l);for(x in a[0])for(t=0;t<a.length;t++)for(g=a[t][x],m=g.length*e,k=A(g,f),b.B[t]=b.B[t]||{},b.B[t][x]=new Float32Array(m),m=0;m<e;m++)switch(h=d[m],l=f*k*m,x){case "a_position":C.transform_vectors(g,h,b.B[t][x],l);break;case "a_normal":C.transform_dir_vectors(g,h,b.B[t][x],l);break;case "a_tangent":C.transform_tangents(g,h,b.B[t][x],l);
break;default:throw"Wrong attribute name: "+x;}return b};a.Xp=g;a.ix=function(a){var b=a.I,c=a.B[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.ba.length);for(var g=0;g<b;g++)d[12*g]=c[3*g],d[12*g+1]=c[3*g+1],d[12*g+2]=c[3*g+2],d[12*g+3]=c[3*g],d[12*g+4]=c[3*g+1],d[12*g+5]=c[3*g+2],d[12*g+6]=c[3*g],d[12*g+7]=c[3*g+1],d[12*g+8]=c[3*g+2],d[12*g+9]=c[3*g],d[12*g+10]=c[3*g+1],d[12*g+11]=c[3*g+2],e[8*g]=-.5,e[8*g+1]=-.5,e[8*g+2]=-.5,e[8*g+3]=.5,e[8*g+4]=.5,e[8*g+5]=
.5,e[8*g+6]=.5,e[8*g+7]=-.5,a[6*g]=4*g+2,a[6*g+1]=4*g+1,a[6*g+2]=4*g,a[6*g+3]=4*g+2,a[6*g+4]=4*g,a[6*g+5]=4*g+3;c=q.jb("HALO");c.B=[];c.B[0]={};c.I=4*b;c.B[0].a_position=d;c.H.a_halo_bb_vertex=e;c.ba=a;return c};a.ny=n;a.jx=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=g(a,d,b,null,null,null);e.I&&c.push(e)}return 0==c.length?q.jb("EMPTY"):1==c.length?c[0]:l(c)};a.gB=function(a,b,c){for(var d=a.Pe,e=h(a,"a_position"),g=a.Sj,f=g.Wy,l=g.Xy,g=g.Ww,k=d,m=k.length/
3,t=0;t<m;t++){var x=k[3*t],z=k[3*t+1],r=k[3*t+2],n=e[3*x+1],w=e[3*x+2],A=e[3*z+1],K=e[3*z+2],B=e[3*r+1],v=e[3*r+2];f[3*t]=(e[3*x]+e[3*z]+e[3*r])/3;f[3*t+1]=(n+A+B)/3;f[3*t+2]=(w+K+v)/3}q.We(f,b,l);b=l.length/3;for(e=0;e<b;e++)f=l[3*e]-c[0],k=l[3*e+1]-c[1],m=l[3*e+2]-c[2],g[e]=f*f+k*k+m*m;c=d;d=g.length;if(!(2>d))for(l=d,e=!1;1<l||e;)for(1<l&&(l=Math.floor(l/1.247330950103979)),e=!1,b=0;l+b<d;b++)0>g[b]-g[b+l]&&(e=g[b],g[b]=g[b+l],g[b+l]=e,e=c,f=b,k=b+l,m=e[3*f],t=e[3*f+1],x=e[3*f+2],e[3*f]=e[3*k],
e[3*f+1]=e[3*k+1],e[3*f+2]=e[3*k+2],e[3*k]=m,e[3*k+1]=t,e[3*k+2]=x,e=!0);d=c;L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,a.de);L.bufferData(L.ELEMENT_ARRAY_BUFFER,d,L.DYNAMIC_DRAW)};a.Bs=v;a.jp=function(a,b,c){for(var d=b.length/3,e=a.length/3,g=[],f=Array(3),h=Array(3),l=Array(3),k=0;k<e;k++){for(var q=a[3*k],m=a[3*k+1],t=a[3*k+2],x=0;3>x;x++)f[x]=b[3*q+x],h[x]=b[3*m+x],l[x]=b[3*t+x];if(c)var x=E(f,h,l),z=E(h,l,f),r=Math.PI-x-z;else r=z=x=1;var n=g,K;K=f;var w=l,A=[],B=[],v=[];H.subtract(h,K,A);H.subtract(w,
K,B);H.cross(A,B,v);H.normalize(v,v);K=v;for(w=0;3>w;w++)A=3*m+w,B=3*t+w,n[3*q+w]=x*K[w],n[A]=z*K[w],n[B]=r*K[w]}if(c)for(var C in c)for(k=c[C],a=0;3>a;a++){b=3*k[0]+a;for(e=1;e<k.length;e++)f=3*k[e]+a,g[b]+=g[f];for(e=1;e<k.length;e++)f=3*k[e]+a,g[f]=g[b]}for(k=0;k<d;k++){c=k;C=g;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=C[e];H.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,C[e]=a[b]}return g};a.lp=function(a,b,c){for(var d={},e=b.length/3,g=0;g<e;g++){var f=String(b[3*g])+String(b[3*g+1])+String(b[3*
g+2]);d[f]=[]}e=a.length;for(g=0;g<e;g++)b=a[g],f=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),f in d&&d[f].push(b);return d};a.tm=function(a,b,c,d){var e=B(a,null,!1);if(c)var g=B(a,null,!0);var f=e.length,h=new Float32Array(f),l=z,k=N;for(a=0;a<f;a++){var m=e[a];l.set(m.subarray(0,3));k.set(m.subarray(3,6));O.set(m.subarray(6));h[a]=Math.sqrt(t(l,k,O))}l=new Float32Array(f);l[0]=h[0];for(a=1;a<f;a++)l[a]=l[a-1]+h[a];f=l[h.length-1];h=[];for(a=0;a<b;a++){var k=f*q.Mc(d),k=q.pj(l,k,0,l.length-
1),m=c?g[k]:e[k],k=a,x=m,r=d,m=void 0,m=new Float32Array(3),n=x[0],w=x[1],A=x[2],v=x[3],K=x[4],U=x[5],H=x[6],C=x[7],E=x[8],x=q.Mc(r),r=q.Mc(r);1<x+r&&(x=1-x,r=1-r);var y=1-x-r,w=y*w+x*K+r*C,A=y*A+x*U+r*E;m[0]=y*n+x*v+r*H;m[1]=w;m[2]=A;h[k]=m}return h};a.bD=B;a.Wp=w;a.vE=t;a.$x=function(a,b,c,d){var e=b[0]-a[0],g=c[0]-a[0],f=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=f*a-b*h;d[1]=g*b-e*a;d[2]=e*h-f*g;return d};a.Nz=function(a,b,c){a=a.B[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-
c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.ev=function(a,b,c){var d=a.n;a=a.d.bf;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=c);for(e=0;e<d.length;e++)if(!d[e].Jf&&d[e].Cd&&!d[e].Kg){var g=d[e].R.Tb;b=d[e].R.Yc;L.bindBuffer(L.ARRAY_BUFFER,d[e].R.nf);if(g.a_position){var f=g.a_position.offset,h=g.a_position.length+f,l=d[e].R.U[0].Ob.a_position;for(c=f;c<h;c++)b[c]=l[c-f];for(l=1;l<d[e].R.U.length;l++){var k=d[e].R.U[l].Ob.a_position,q=a[l].value;if(q)for(c=
f;c<h;c++)b[c]+=q*k[c-f]}L.bufferSubData(L.ARRAY_BUFFER,4*f,b.subarray(f))}if(g.a_normal){f=g.a_normal.offset;h=g.a_normal.length+f;l=d[e].R.U[0].Ob.a_normal;for(c=f;c<h;c++)b[c]=l[c-f];for(l=1;l<d[e].R.U.length;l++)if(k=d[e].R.U[l].Ob.a_normal,q=a[l].value)for(c=f;c<h;c++)b[c]+=q*k[c-f];x(b,f,h,3,2);L.bufferSubData(L.ARRAY_BUFFER,4*f,b.subarray(f))}if(g.a_tangent){f=g.a_tangent.offset;g=g.a_tangent.length+f;l=d[e].R.U[0].Ob.a_tangent;for(c=f;c<g;c++)b[c]=l[c-f];for(l=1;l<d[e].R.U.length;l++)if(h=
d[e].R.U[l].Ob.a_tangent,q=a[l].value)for(c=f;c<g;c++)b[c]+=q*h[c-f];x(b,f,g,4,3);L.bufferSubData(L.ARRAY_BUFFER,4*f,b.subarray(f))}}};a.check_shape_keys=function(a){return a.d.Cd};a.get_shape_keys_names=function(a){var b=[];if(a.d)for(var c=1;c<a.d.bf.length;c++)b.push(a.d.bf[c].name);return b};a.get_shape_key_value=function(a,b){if(a.d)for(var c=1;c<a.d.bf.length;c++)if(b==a.d.bf[c].name)return a.d.bf[c].value;return 0};a.Lq=function(a,b){var c=a.d.bf;if(c)for(var d=1;d<c.length;d++)if(c[d].name==
b)return!0;return!1};a.ni=function(a){return a&&a.d&&a.d.hd?!0:!1}};b4w.module.__objects=function(a,p){function d(a){a={type:a,nc:0,my:[0,0],g:new Float32Array(3),quat:new Float32Array(4),xb:new Float32Array(8),T:new Float32Array(16),Rq:new Float32Array(16),Fb:new Float32Array(3),Qb:new Float32Array(3),Zg:0,$g:0,Mm:!1,Aj:null,Tc:0,Vn:!1,et:!1,ra:r.MS_STATIC,lo:1,ko:1,mo:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Xd:null,Xs:!1,Wd:0,Gf:0,Oa:!1,Pb:null,Zc:null,tb:null,$l:!0,G:null,wi:null,lc:null,sc:null,cc:null,ji:0,ei:0,nm:0,ui:0,Yf:0,Tr:"",Qk:!1,xc:!1,Ib:!1,
ec:!1,Ub:!1,Gb:!1,vc:!1,je:!1,Bf:!1,ad:!1,Gj:!1,hd:!1,kb:!1,Mg:!1,Yg:!1,ak:!1,ng:!1,lk:!1,Cb:!1,kk:!1,yr:!1,Yj:!1,is_visible:!1,pm:!1,Yi:0,bd:0,se:0,Ud:0,Td:0,Pd:0,fe:"",Eb:null,oj:!1,Be:!1,Th:"",sl:!1,Kf:0,time:0,jo:0,ht:0,he:0,ii:!1,Tk:!1,Cd:!1,bf:[],ah:!1,Ae:!1,ze:1,gl:0,fl:1,Mk:new Int8Array([-1,-1]),Hk:[],nr:[],ts:[],uc:null,tc:null,Cc:null,Bc:null,Gc:null,Ur:null,jl:null,il:null,ge:null,$f:null,ck:null,qc:null,Zf:null,dk:null,Mb:null,pl:null,nl:null,ol:null,Za:null,Pc:null,rb:null,zf:null,Af:null,
scale:1,Se:1E4};z.identity(a.quat);y.identity(a.xb);O.identity(a.T);O.identity(a.Rq);return a}function b(a){var b=a.parent;if(b&&b.Bg)return!0;switch(a.type){case "MESH":var c=g.Vj(a),d=a.b4w_do_not_batch,e=a.b4w_collision,f=a.b4w_vehicle,h=a.b4w_floating,b=a.b4w_character,l=a.b4w_billboard,k=x.py(a),q=t.Kq(a),m=0<a.data.b4w_shape_keys.length,r=a.b4w_dynamic_geometry;if(!(c=c||d||e||f||m||h))a:{a=a.data;for(c=0;c<a.materials.length;c++)if("LENS_FLARES"===a.materials[c].name){c=!0;break a}c=!1}return c||
k||b||l||q||r;case "EMPTY":return b=g.Vj(a),l=t.Kq(a),a=a.b4w_do_not_batch,b||l||a;default:return!0}}function c(a,b,d,g,f,h,l,k,q){for(var m=0;m<a.nodes.length;m++){var t=a.nodes[m];if("VALUE"==t.type){var x=b+t.name;g.push(t.outputs[0].default_value);f.push(x,f.length/2)}else"RGB"==t.type?(x=b+t.name,t=t.outputs[0].default_value.slice(0,3),l.push(t[0],t[1],t[2]),k.push(x,k.length/2)):"GROUP"==t.type&&(x=t.node_group.node_tree,c(x,b+t.name+"%join%",x.animation_data,g,f,h,l,k,q))}if(d)for((a=d.action)&&
e(a,b,h,f,q,k),d=d.nla_tracks,g=0;g<d.length;g++)for(l=d[g].strips,m=0;m<d[g].strips.length;m++)a=l[m].action,e(a,b,h,f,q,k)}function e(a,b,c,d,e,g){var f=a.d.Ua,l;for(l in f){var k=b+l.match(/"(.*?)"/)[1],f=h(d,k);null!=f?(k=a.name+"%join%"+l,c.push(k,f)):(f=h(g,k),null!=f&&(k=a.name+"%join%"+l,e.push(k,f)))}}function h(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function k(a,b,c){return{name:a,type:b,modifiers:[],particle_systems:[],constraints:[],data:null,parent:null,
b4w_vehicle_settings:null,b4w_floating_settings:null,b4w_character_settings:null,b4w_vehicle:!1,b4w_character:!1,b4w_floating:!1,n:[],Ho:c,Ec:[],xe:[],Kd:[],Oc:null,Qa:null,Fc:null,j:null,C:[],m:null,i:null,la:null}}function f(a){return a instanceof Array?a.slice():a}function l(a){if("object"!=typeof a||null===a)return a;var b=a instanceof Array?[]:{},c=null,d=null,e=null;a.M&&(c=a.M,a.M=null);a.Jb&&(d=a.Jb,a.Jb=null);a.U&&(e=a.U,a.U=null);for(var g in a)b[g]=a[g]&&"object"==typeof a[g]?a[g]instanceof
Float32Array?new Float32Array(a[g]):a[g]instanceof Uint32Array?new Uint32Array(a[g]):a[g]instanceof Uint16Array?new Uint16Array(a[g]):a[g]instanceof WebGLUniformLocation?a[g]:a[g]instanceof WebGLProgram?a[g]:a[g]instanceof WebGLShader?a[g]:a[g]instanceof WebGLBuffer?null:l(a[g]):a[g];c&&(b.M=c,a.M=c);d&&(b.Jb=d,a.Jb=d);e&&(b.U=e,a.U=e);return b}var g=p("__animation"),m=p("__batch"),n=p("__boundings"),r=p("__camera"),A=p("__config"),v=p("__constraints"),E=p("__curve"),B=p("__geometry"),w=p("__lights"),
t=p("__nla"),x=p("__particles"),G=p("__print"),C=p("__scenes"),q=p("__transform"),y=p("__tsr"),H=p("__util"),z=p("quat"),N=p("vec3"),O=p("mat4"),L=A.Cb,F=0,I=0,M=[],R=new Float32Array(4);a.Cj=d;a.Pk=function(a,e){var f=b(a);a.Bg=f;a.d=d("MESH"===a.type?f?"DYNAMIC":"STATIC":a.type);a.Ho=!1;a.Qa=null;a.Ec=[];a.C=[];a.m=null;a.i=null;a.la=null;a.xa||(a.xa=null);var f=a.d,h=a.location,l=a.scale[0];H.yn(a.rotation_quaternion,R);q.set_translation(a,h);q.set_rotation(a,R);q.set_scale(a,l);switch(a.type){case "ARMATURE":h=
a.pose.bones;for(l=0;l<h.length;l++){var k=h[l],t=k.bone,x=new Float32Array(t.matrix_local),A=new Float32Array(16);O.invert(x,A);var B=new Float32Array(k.matrix_basis),p=new Float32Array(3);N.subtract(t.tail_local,t.head_local,p);H.MB(p,A,p);k.Ju=p;k.Du=[k].concat(k.parent_recursive);k.Jo=y.from_mat4(x,y.create());k.Io=y.from_mat4(B,y.create());k.bl=y.create();k.hj=!1}h=g.yv(a);f.Gc=h;h=g.kp(a,h);a.b4w_animation_mixing?(f.uc=new Float32Array(h.wa),f.tc=new Float32Array(h.wa),f.Cc=new Float32Array(h.g),
f.Bc=new Float32Array(h.g)):(f.uc=h.wa,f.tc=h.wa,f.Cc=h.g,f.Bc=h.g);f.Ur=h;f.Kf=0;f.Ae=a.b4w_animation_mixing;break;case "MESH":f.ng=L.outlining_overview_mode||a.b4w_selectable;f.lk=a.b4w_selectable;f.Cb=L.outlining_overview_mode||a.b4w_outlining;f.kk=a.b4w_outlining;f.yr=L.outlining_overview_mode||a.b4w_outline_on_select;f.Be=a.b4w_billboard;f.sv=a.b4w_pres_glob_orientation;f.Th="BASIC";f.sl="SPHERICAL"==a.b4w_billboard_geometry;f.wi={mk:a.b4w_outline_settings.outline_duration,nk:a.b4w_outline_settings.outline_period,
ok:a.b4w_outline_settings.outline_relapses};f.ng&&(a.d.Aj=H.gq(F),F++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.Tk=a.data.b4w_vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;l=a.d;if(a.data.b4w_shape_keys.length)for(l.Cd=!0,h=0;h<a.data.b4w_shape_keys.length;h++)k={},k.value=a.data.b4w_shape_keys[h].value,k.name=a.data.b4w_shape_keys[h].name,l.bf.push(k);else l.Cd=!1;if(l=g.get_first_armature_object(a)){h=a.d;t=a.data.vertex_groups;if(t.length){x=l.data.bones;
A=l.pose.bones;B=0;k={};for(p=0;p<x.length;p++){var Z=x[p].name,oa=H.keysearch("name",Z,t);if(oa){var K=H.xm(A,"name",Z);k[Z]={hp:p,ai:B++,vn:K,kt:oa.index}}}t=B;h.Gc=k;k=g.sq();h.he=t;t>2*k?(h.ah=!1,G.error('too many bones for "'+a.name+'" / '+h.he+" bones (max "+k+" with blending, "+2*k+" without blending). Skinning will be disabled.")):h.ah=!0}h=a.d.Gc;h=g.kp(l,h);l.b4w_animation_mixing?(f.uc=new Float32Array(h.wa),f.tc=new Float32Array(h.wa),f.Cc=new Float32Array(h.g),f.Bc=new Float32Array(h.g)):
(f.uc=h.wa,f.tc=h.wa,f.Cc=h.g,f.Bc=h.g);f.jl=new Float32Array(4);f.il=z.create();f.Ur=h;f.Kf=0}l=a.d;h=a.data.materials;k=[];t=[];x=[];A=[];B=[];p=[];for(Z=0;Z<h.length;Z++)oa=h[Z],(K=oa.node_tree)&&c(K,oa.name+"%join%",K.animation_data,k,t,x,A,B,p);l.ge=k;l.$f=t;l.ck=x;l.qc=A;l.Zf=B;l.dk=p;a.n=[];f.xc=a.b4w_shadow_cast;f.Ib=a.b4w_shadow_receive;f.ec=a.b4w_shadow_cast_only&&f.xc;f.Ub=a.b4w_reflexible;f.Gb=a.b4w_reflexible_only&&f.Ub;f.vc=a.b4w_reflective;f.je=a.b4w_reflection_type;a.al=null;if(a.b4w_reflective)if(l=
a.d,"CUBE"==a.b4w_reflection_type)l.lc=I++;else{a:{h=a.constraints;for(k=0;k<h.length;k++)if(t=h[k],"LOCKED_TRACK"==t.type&&"REFLECTION PLANE"==t.name){h=t.target;break a}h=null}if(h){k=null;for(t=0;t<M.length;t++)if(M[t]==h){k=t;break}null==k?(M.push(h),l.sc=M.length-1):l.sc=k;a.al=h}}f.Bf=a.b4w_caustics;f.ad=a.b4w_wind_bending;f.Yi=a.b4w_wind_bending_angle;l=m.SB(a.b4w_wind_bending_angle,m.ov(a.data.b4w_bounding_box),a.scale[0]);f.bd=l;f.se=a.b4w_wind_bending_freq;f.Ud=a.b4w_detail_bending_freq;
f.Td=a.b4w_detail_bending_amp;f.Pd=a.b4w_branch_bending_amp;f.Yg=!1;f.fe=a.b4w_main_bend_stiffness_col;l=a.b4w_detail_bend_colors;f.Eb={};f.Eb.fr=l.leaves_stiffness_col;f.Eb.er=l.leaves_phase_col;f.Eb.Ar=l.overall_stiffness_col;f.Mg=a.b4w_do_not_cull;f.Gj=a.b4w_disable_fogging;f.hd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";l=a.data.materials[0];f.ji=l.physics.friction;f.ei=l.physics.elasticity;f.ui=0;f.Se=1E4;f.Yf=a.b4w_lod_transition;f.ak=!0;break;case "CAMERA":r.Bv(a);r.jv(a);
break;case "LAMP":w.Jy(a);break;case "CURVE":if(l=E.Aw(a))a.Iu=l;break;case "EMPTY":f.Mb=n.Ed(),l=n.Zi(),f.Pc=l}if(!e&&(a.parent&&"OBJECT"==a.parent_type?(h=f.g,k=f.quat,l=f.scale,v.So(a,a.parent,h,k,l)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(h=f.g,k=f.quat,l=f.scale,v.Ro(a,a.parent,a.parent_bone,h,k,l)):a.xa&&a.xa.b4w_group_relative?(l=y.create_sep(f.g,f.scale,f.quat),v.Nu(a,a.xa,l)):a.xa&&!a.xa.b4w_group_relative&&(q.w(a),y.multiply(a.xa.d.xb,a.d.xb,a.d.xb),q.set_translation(a,
y.get_trans_view(a.d.xb)),q.set_scale(a,y.get_scale(a.d.xb)),q.set_rotation(a,y.get_quat_view(a.d.xb))),l=a.dupli_group))for(h=l.objects,l=0;l<h.length;l++)h[l].xa=a;a.field&&(f.nm=a.field.strength,C.$s(a));f.Qk=a.game.use_collision_compound;f.Tr=a.game.physics_type;q.w(a)};a.pB=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||q.w(c);c.b4w_use_default_animation&&g.Vj(c)&&(g.apply_def(c),c.C.length&&g.play(c,null,g.SLOT_ALL))}};a.$b=function(a){return a.Bg?
!0:!1};a.oi=function(a){return"MESH"==a.type&&a.Bg?!0:!1};a.get_meta_tags=function(a){a=a.b4w_object_tags;return{title:a?a.title:"",description:a?a.description:"",category:a?a.category:""}};a.cleanup=function(){I=F=0;M=[]};a.Pq=k;a.copy=function(a,b,c){b=k(b,a.type,!1);var d=[];if(c){for(var e=0;e<a.n.length;e++)a.n[e].Jf||(b.n.push(l(a.n[e])),d.push(a.n[e].R));for(e=0;e<a.n.length;e++)if(a.n[e].Jf){var g=l(a.n[e]);b.n.push(g);for(var h=0;h<d.length;h++)d[h]==a.n[e].R&&(g.R=b.n[h].R)}}else b.n=f(a.n);
b.d=l(a.d);a.Bg&&(b.Bg=a.Bg);a.xa&&(b.xa=a.xa);a.Kd&&(b.Kd=f(a.Kd));!a.m||a.b4w_vehicle||a.b4w_character||a.b4w_floating||(b.m=l(a.m));b.game=l(a.game);b.b4w_collision_id=a.b4w_collision_id;b.b4w_correct_bounding_offset=a.b4w_correct_bounding_offset;b.b4w_collision=a.b4w_collision;b.data=a.data;b.particle_systems=c?l(a.particle_systems):f(a.particle_systems);if(c)for(e=0;e<b.n.length;e++){b.n[e].R&&B.at(b.n[e].R);if("PARTICLES"==b.n[e].type&&b.n[e].xn)for(h=0;h<b.fE.length;h++)if(b.particle_systems[h].name==
b.n[e].xn){b.n[e].rc=b.particle_systems[h];break}b.n[e].mh=b.uuid;m.eB(b.n[e],H.Gg(b.d,0))}b.uuid=H.sm();b.d.Mm=!0;b.d.Aj=H.gq(F);F++;return b};a.bw=l;a.hy=function(a,b){for(var c=a.d.$f,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.by=function(a,b){for(var c=a.d.Zf,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}};b4w.module.__particles=function(a,p){function d(){throw"_rand() undefined";}function b(a,b,c,d,e,g,f){var h=a.P.Wl,k=a.P.jd,q=a.P.time;a=a.P.Vr;for(var m=b?4:1,H=0;H<h.length;H+=m){var z=h[H];if(z>a&&z<=q)for(z=0;8>z;z++)k[8*H+z]=e[z];for(z=0;8>z;z++)n[z]=k[8*H+z];z=r;z[0]=c[3*H];z[1]=c[3*H+1];z[2]=c[3*H+2];l.transform_vec3(z,n,z);g[3*H]=z[0];g[3*H+1]=z[1];g[3*H+2]=z[2];var p=r;p[0]=d[3*H];p[1]=d[3*H+1];p[2]=d[3*H+2];l.transform_dir_vec3(p,n,p);f[3*H]=p[0];f[3*H+1]=p[1];f[3*H+2]=p[2];if(b)for(z=1;4>
z;z++)g[3*(H+z)]=g[3*H],g[3*(H+z)+1]=g[3*H+1],g[3*(H+z)+2]=g[3*H+2],f[3*(H+z)]=p[0],f[3*(H+z)+1]=p[1],f[3*(H+z)+2]=p[2]}}function c(a){a?(f.GA(a),d=function(){return f.uz()}):d=function(){return Math.random()}}var e=p("__config"),h=p("__geometry"),k=p("__scenes"),f=p("__util"),l=p("__tsr"),g=p("vec3"),m=e.Md,n=new Float32Array(8),r=new Float32Array(3);a.Xg=function(a){return 0<a.particle_systems.length?!0:!1};a.Em=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.zD=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.py=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.Ax=function(a,e,l,k){l.P=l.P||{};var r=h.jx(e),t=l.settings.count,x=l.settings.frame_start/m.Fa,n=l.settings.frame_end/m.Fa,C=l.settings.lifetime/m.Fa,q=l.settings.lifetime_random,y=l.settings.emit_from,H=
l.settings.factor_random,z=l.settings.angular_velocity_mode,p=l.settings.angular_velocity_factor,O=l.settings.b4w_randomize_emission,L=l.settings.b4w_cyclic;c(l.seed);var F=l.P.JB="WORLD"==l.settings.b4w_coordinate_system?!0:!1;l.P.frame=0;if(e=!a.Nf){var I;I=[];for(var M=0;M<t;M++)I.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);I=new Float32Array(I);for(var M=[],R=0;R<t;R++)M.push(4*R,4*R+2,4*R+1,4*R,4*R+3,4*R+2);M=new Uint16Array(M)}switch(y){case "VERT":for(var R=r.B[0].a_position,r=r.B[0].a_normal,ca=R.length/
3,y=[],S=0;S<t;S++){var Y=Math.round((ca-1)*d());y.push(Y);e&&(y.push(Y),y.push(Y),y.push(Y))}ca=[];for(S=0;S<y.length;S++)ca.push(R[3*y[S]]),ca.push(R[3*y[S]+1]),ca.push(R[3*y[S]+2]);R=new Float32Array(ca);ca=[];for(S=0;S<y.length;S++)ca.push(r[3*y[S]]),ca.push(r[3*y[S]+1]),ca.push(r[3*y[S]+2]);y=new Float32Array(ca);break;case "FACE":R=[];y=[];S=[];f.Tj(0,S);ca=h.tm(r,t,!1,S);f.Tj(0,S);r=h.tm(r,t,!0,S);for(S=0;S<ca.length;S++)R.push(ca[S][0],ca[S][1],ca[S][2]),e&&(R.push(ca[S][0],ca[S][1],ca[S][2]),
R.push(ca[S][0],ca[S][1],ca[S][2]),R.push(ca[S][0],ca[S][1],ca[S][2])),y.push(r[S][0],r[S][1],r[S][2]),e&&(y.push(r[S][0],r[S][1],r[S][2]),y.push(r[S][0],r[S][1],r[S][2]),y.push(r[S][0],r[S][1],r[S][2]));R=new Float32Array(R);y=new Float32Array(y);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}y=[R,y];r=y[0];y=y[1];l.P.Di=new Float32Array(r);l.P.cz=new Float32Array(y);l.P.nz=new Float32Array(r.length);l.P.dz=new Float32Array(y.length);
l.P.time=0;l.P.Vr=-1;R=[];n=(n-x)/t;for(ca=0;ca<t;ca++)S=O?n*ca+10*n*(.5-d()):n*ca,L||(S+=x),R.push(S),e&&(R.push(S),R.push(S),R.push(S));x=new Float32Array(R);l.P.Wl=new Float32Array(x);l.P.Mp=new Float32Array(x);l.P.jd=new Float32Array(8*x.length);for(O=0;O<8*x.length;O++)for(L=0;8>L;L++)l.P.jd[8*O+L]=k[L];F&&b(l,e,r,y,k,r,y);l=[];k=C*q;for(q=0;q<t;q++)F=k*d(),l.push(C-F),e&&(l.push(C-F),l.push(C-F),l.push(C-F));C=new Float32Array(l);l=[];for(k=0;k<t;k++){q=[d()-.5,d()-.5,d()-.5];g.normalize(q,
q);l.push(H*q[0]);l.push(H*q[1]);l.push(H*q[2]);switch(z){case "NONE":l.push(0);break;case "SPIN":case "VELOCITY":l.push(p);break;case "RAND":l.push(2*p*(d()-.5));break;default:throw"Undefined velocity factor";}if(e)for(q=l.slice(-4),F=0;12>F;F++)l.push(q[F%4])}t=new Float32Array(l);H=f.jb("EMITTER_PARTICLES");z=f.Qc();z.a_position=r;z.a_normal=y;H.B[0]=z;e?(a.Yd=h.bj,H.ba=M):(a.Yd=h.zo,H.ba=new Uint16Array(0));H.I=r.length/3;H.H.a_p_delay=x;H.H.a_p_lifetime=C;H.H.a_p_vels=t;e&&(H.H.a_p_bb_vertex=
I);return H};a.mB=function(a){for(var c=a.n,d=0;d<c.length;d++){var e=c[d],g=c[d].rc;if(g){var f=e.R;if(!g.P.JB)break;var l=g.P.nz,k=g.P.dz;b(g,!e.Nf,g.P.Di,g.P.cz,a.d.xb,l,k);h.Qy(f);h.Ok(f,"a_position",3,l);h.Ok(f,"a_normal",3,k)}}};a.Wz=function(a,b,c){var d=b.settings.lifetime/m.Fa,e=b.settings.normal_factor,g=9.81*b.settings.effector_weights.gravity,f=b.settings.effector_weights.wind,h=b.settings.mass,l=b.settings.b4w_fade_in/m.Fa,q=b.settings.b4w_fade_out/m.Fa,r=b.settings.b4w_cyclic;a.Jr=b.settings.frame_end/
m.Fa-b.settings.frame_start/m.Fa;a.Fr=r?1:0;a.rn=e;a.Ir=g;e=k.ky();a.pk[0]=e[0]*f;a.pk[1]=e[1]*f;a.pk[2]=e[2]*f;a.Lr=d;a.Kr=h;a.Gr=l;a.Hr=q;a.Nf?(d=c.halo.size,f=c.halo.hardness,30>f?(f=.5,h=.9):40>f?(f=.1,h=1):50>f?(f=0,h=.8):(f=0,h=.5)):(d=b.settings.particle_size,h=f=1);a.sn=d;a.Cr=f;a.Br=h;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;f=Math.min(2*d.length,
b.length);for(h=0;h<f;h+=2)l=d[h/2],b[h]=l.position,b[h+1]=(l.color[0]+l.color[1]+l.color[2])/3;a.Nr=d.length}a.Mr.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;f=Math.min(4*d.length,c.length);for(h=0;h<f;h+=4)l=d[h/4],c[h]=l.position,c[h+1]=l.color[0],c[h+2]=l.color[1],c[h+3]=l.color[2];a.Er=d.length}a.Dr.set(c)};a.fA=function(a,b){a.P.Vr=
a.P.time;a.P.time=b};a.pz=function(a){for(var b=a.I,c=a.B[0].a_position,d=a.H.a_texcoord,e=[],g=[],f=0;f<b;f++)g.push(c[3*f]),g.push(c[3*f+1]),e.push(c[3*f+2]);e=new Float32Array(e);g=new Float32Array(g);a.H.a_lf_dist=e;a.H.a_lf_bb_vertex=g;a.H.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.n;for(var d=0;d<a.length;d++){var e=a[d],g=e.rc;g&&g.name==b&&(e.sn=c)}};a.set_normal_factor=function(a,b,c){a=a.n;for(var d=0;d<a.length;d++){var e=a[d],g=e.rc;g&&g.name==b&&(e.rn=c)}};a.set_factor=function(a,
b,c){a=a.n;for(var d=0;d<a.length;d++){var e=a[d],g=e.rc;if(g&&g.name==b){var f=g.P.Wl;if(1==c)g=f;else if(0==c)for(var l=!e.Nf,k=l?4:1,g=g.P.Mp,q=0;q<g.length;q+=k)g[q]=1E4,l&&(g[q+1]=g[q],g[q+2]=g[q],g[q+3]=g[q]);else for(var m=1/c,g=g.P.Mp,k=(l=!e.Nf)?4:1,r=0,q=0;q<g.length;q+=k)q>=r?(g[q]=f[q],r+=m):g[q]=1E4,l&&(g[q+1]=g[q],g[q+2]=g[q],g[q+3]=g[q]);h.Ok(e.R,"a_p_delay",1,g)}}};a.vB=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var e=a[d];if("EMITTER"==e.settings.type)for(var g=
e.P.Wl,d=0;d<8*g.length;d++)e.P.jd[8*d]=b[0],e.P.jd[8*d+1]=b[1],e.P.jd[8*d+2]=b[2],e.P.jd[8*d+3]=b[3],e.P.jd[8*d+4]=c[0],e.P.jd[8*d+5]=c[1],e.P.jd[8*d+6]=c[2],e.P.jd[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,p){function d(a,b,c,d){for(var e=[],f=[],h=[],p=[],B=2*c/(a-1),w=2*d/(b-1),t=0;t<a;t++)for(var x=-c+t*B,G=0;G<b;G++)if(f.push(x,0,-d+G*w),h.push(0,1,0),p.push(t/(a-1),G/(b-1)),t&&G){var C=t*b+G,q=C-1,y=(t-1)*b+G,H=y-1;e.push(C,q,y);e.push(q,H,y)}a=k.Qc();a.a_position=new Float32Array(f);a.a_normal=new Float32Array(h);h=k.jb("GRID_PLANE");h.B[0]=a;h.H.a_texcoord=new Float32Array(p);h.ba=new Uint32Array(e);h.I=f.length/3;return h}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=4){var h=a[f+1],v=a[f+2],p=a[f+3];e(a[f],d);e(h,d);e(v,d);e(p,d);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=k.Qc();a.a_position=new Float32Array(d);b=k.jb("FROM_QUADS");b.B[0]=a;b.ba=new Uint32Array(c);b.I=d.length/3;return b}function c(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function e(a,b){b.push(a[0],a[1],a[2])}var h=p("__geometry"),k=p("__util"),f=p("__config").o;a.rD=function(a){for(var b=k.jb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=k.Qc();d.a_point=
new Float32Array(c);b.B[0]=d;b.ba=new Uint32Array(c);b.I=2*a;return b};a.sD=function(a,b){var c=d(2,2,a,b);c.name="PLANE";return c};a.qD=d;a.Fx=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==p-1)||1==b%2&&(0==a||a==v-1)?!0:!1}var e=c/=Math.pow(2,a-1),A=c,v=b+1,p=b+1;b=[];c=[];for(var B=0,w=0,t=-1,x=[],G=0;G<a;G++){for(var C=2*e/(v-1),q=2*A/(p-1),y=[],H=[],z=0,N=0;N<v;N++){for(var O=-e+N*C,L=[],F=0;F<p;F++){var I=-A+F*q;if(O>-B&&O<B&&I>-w&&I<w)L.push(-1),z++;else{for(var M=null,R=0;R<x.length;R+=
3)if(O==x[R]&&I==x[R+1]){M=x[R+2];break}R=null!==M?M:t+1;d(N,F)?(L.push(-2),z++):(null==M&&(0==F||F==p-1||0==N||N==v-1?(M=G==a-1?C:2*C,y.push(O,I,R)):M=C,c.push(O,M,I),t++),L.push(R));if(N&&F)if(1==N)if(d(N-1,F)){if(1<F){var I=R-1,M=H[N-1][F+1],ca=M-1;b.push(R,I,ca)}else M=H[N-1][F+1],ca=M-1;b.push(R,ca,M)}else d(N,F)||(I=R-1,M=H[N-1][F],b.push(R,I,M));else if(N==v-1){if(!d(N,F))if(F==p-1)I=R-1,M=H[N-1][F-1],ca=H[N-2][F],b.push(R,I,M),b.push(R,M,ca);else{var I=R-1,M=H[N-1][F],ca=M-1,S=M+1;b.push(R,
I,ca);b.push(R,ca,M);b.push(R,M,S);2==F&&(S=H[N-2][F-2],b.push(I,S,ca))}}else 1==F?d(N,F-1)?(I=H[N-1][F],M=H[N-1][F-1],b.push(R,M,I)):(I=L[F-1],M=H[N-1][F],ca=H[N-2][F-1],b.push(R,I,M),b.push(I,ca,M)):F==p-1?d(N,F)||(I=L[F-1],M=H[N-1][F-1],ca=H[N-2][F],b.push(R,I,M),b.push(R,M,ca)):-1!=H[N-1][F]&&-1!=H[N-1][F-1]&&-1!=L[F-1]?(I=L[F-1],M=H[N-1][F],ca=H[N-1][F-1],b.push(R,I,M),b.push(I,ca,M),F==p-2&&d(N,F+1)&&(S=H[N-1][F+1],b.push(R,M,S))):F==p-2&&d(N,F+1)&&(M=H[N-1][F],S=H[N-1][F+1],b.push(R,M,S))}}H.push(L)}x=
y;B=e;w=A;e*=2;A*=2}2E4>B&&(a=-(2*B)/(v-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-B,a,-w),c.push(-B,a,w),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(B,a,-w),c.push(B,a,w),R=t+1,b.push(R+3,R+2,R+1,R+2,R+0,R+1,R+6,R+4,R+2,R+4,R+0,R+2,R+5,R+7,R+1,R+7,R+3,R+1,R+5,R+4,R+7,R+7,R+4,R+6));a=k.Qc();a.a_position=new Float32Array(c);e=k.jb("multigrid_plane");e.B[0]=a;e.ba=new Uint32Array(b);e.I=c.length/3;f.pt&&(h.Sn(e,1,!0),a.a_polyindex=h.Wp(e));return e};a.pD=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],d=[],f=0;f<b;f+=3){var h=a[f+1],v=a[f+2];e(a[f],d);e(h,d);e(v,d);c.push(f,f+1,f+2)}a=k.Qc();a.a_position=new Float32Array(d);b=k.jb("FROM_TRIANGLES");b.B[0]=a;b.ba=new Uint32Array(c);b.I=d.length/3;return b};a.oD=b;a.Bx=function(a){a=k.NB(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.lb=function(){var a=k.jb("FULLSCREEN_TRI"),
b=k.Qc();b.a_position=new Float32Array([0,0,1,0,0,1]);a.B[0]=b;a.ba=new Uint32Array([0,1,2]);a.I=3;return a};a.Cx=function(){var a=k.jb("FULLSCREEN_QUAD"),b=k.Qc();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.B[0]=b;a.ba=new Uint32Array([0,2,1,1,2,3]);a.I=4;return a};a.xx=function(){var a=k.jb("BILLBOARD"),b=k.Qc();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.B[0]=b;a.ba=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.yx=function(){var a=k.jb("CUBEMAP_BOARD"),b=k.Qc();
b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.B[0]=b;a.ba=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.jq=function(a,b){var d=k.jb("UV_SPHERE"),f,r,A=[],v=[],p=[];for(r=0;8>=r;r++)for(f=0;16>=f;f++){var B=f/16,w=r/8;v.push(-a*Math.cos(2*B*Math.PI)*Math.sin(w*Math.PI)+b[0],a*Math.cos(w*Math.PI)+b[1],a*Math.sin(2*B*Math.PI)*Math.sin(w*Math.PI)+b[2])}for(r=B=0;8>r;r++)for(f=0;16>f;f++){var w=c(v,17*r+f+1),t=c(v,17*r+f),x=c(v,17*(r+1)+f),G=c(v,17*(r+1)+f+1);Math.abs(w[1])==a+b[1]?(e(w,A),
e(x,A),e(G,A),p.push(B,B+1,B+2),B+=3):Math.abs(x[1])==a+b[1]?(e(w,A),e(t,A),e(x,A),p.push(B,B+1,B+2),B+=3):(e(w,A),e(t,A),e(x,A),e(G,A),p.push(B,B+1,B+2),p.push(B,B+2,B+3),B+=4)}f={};f.a_position=A;v=h.lp(p,v,A);f.a_normal=h.jp(p,A,v);f.a_tangent=[];d.H.a_influence=[];d.H.a_color=[];d.H.a_texcoord=[];d.B[0]=f;d.ba=p;d.I=A.length/3;return d};a.iq=function(a){var b=k.jb("INDEX"),c=k.Qc();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.B[0]=c;b.ba=new Uint16Array(0);b.I=a;return b}};b4w.module.__prerender=function(a,p){function d(a,b){var d=a.qd,e=b.h;d.is_visible=!1;var g;if(!(g=!d||d.Yg)){var f=e.Le,l=d.rb.F;g=d.Se;f=Math.sqrt((l[0]-f[0])*(l[0]-f[0])+(l[1]-f[1])*(l[1]-f[1])+(l[2]-f[2])*(l[2]-f[2]));l=d.Yf*d.rb.Ba;g=!(f>=d.ui&&f<g+l)}if(g)return!1;d.is_visible=!0;(g="OUTLINE_MASK"==b.type&&!Boolean(d.Tc))||(e=e.Kj,d.Mg?g=!1:("STATIC"===d.type?(g=d.rb,d=g.F,d=h.BA(d,e,g.Ba)):(g=d.Af,d=g.F,d=h.ax(d,e,g.wf,g.xf,g.yf)),g=d));return g?!1:"WIREFRAME"==b.type?a.D.wireframe_mode==c.Fo.WM_DEBUG_SPHERES?
a.D.Kg:!a.D.Kg:!0}var b=p("__config"),c=p("__debug"),e=p("__geometry"),h=p("__util"),k=p("__renderer"),f=p("vec3"),l=b.o,g="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.wn=function(a){if(-1<g.indexOf(a.type)){for(var b=!1,c=a.p,h=0;h<c.length;h++){var v=c[h];if("MAIN_CUBE_REFLECT"==a.type)for(var p=0;6>p;p++)a.h.Kj=a.Pl[p],v.Yl[p]=d(v,a),v.Yl[p]&&(b=!0);else v.Ra=d(v,a),v.Ra&&
(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?a.Ra=!0:(a.Ra&&k.clear(a),a.Ra=!1)}}if("MAIN_BLEND"==a.type&&l.alpha_sort&&a.p){b=a.h.Le;c=f.dist(b,a.rt)>l.alpha_sort_threshold;for(h=0;h<a.p.length;h++)if(p=a.p[h],v=p.qd,v.pm||c){var B=p.D;if(B&&B.Da&&B.ue!=e.Jd){B=B.R;if(!B||!p.Ra)continue;(p=B.Sj)&&p.type==e.Go&&e.gB(B,v.T,b)}v.pm=!1}c&&a.rt.set(b)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}var d=!1,b=0,c=0;a.hA=function(a){d=a};a.log=function(){if(d){var a=p(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){b++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){c++;var a=p(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=
p(arguments,"B4W INFO");console.info.apply(console,a)};a.dx=function(){b++;var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.ex=function(){c++;var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){d&&console.time.apply(console,arguments)};a.timeEnd=function(){d&&console.timeEnd.apply(console,arguments)};a.group=function(){d&&console.group.apply(console,arguments)};a.groupCollapsed=function(){d&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){d&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.jy=function(){return c};a.Vx=function(){return b};a.clear_errors_warnings=function(){b=c=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function d(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",c("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",c("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,c("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,c("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,c("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,c("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,c("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",c("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,c("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,c("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,c("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,c("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a){if(a=a.nla_tracks)for(var b=0;b<a.length;b++)for(var d=a[b],e=0;e<d.strips.length;e++){var g=d.strips[e];"action"in g||(g.action=null,c("strip",g,"action"));"action_frame_start"in g||(g.action_frame_start=0,c("strip",g,"action_frame_start"));"action_frame_end"in g||(g.action_frame_end=g.frame_end-g.frame_start,c("strip",g,"action_frame_end"));"repeat"in g||(g.repeat=1,c("strip",g,"repeat"));"use_reverse"in g||(g.use_reverse=!1,c("strip",g,"use_reverse"));"scale"in
g||(g.scale=1,c("strip",g,"scale"))}}function c(a,b,c){c=c+">>"+a;c in v||(v[c]={Rn:[],fs:"undefined",type:a});v[c].Rn.push(b.name)}function e(a,b){param_id in v||(v[param_id]={Rn:[],fs:"deprecated",type:a});v[param_id].Rn.push(b.name)}function h(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=g.Ef(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=g.xj(d[c]);e.submeshes.push(f)}return e}
var k=p("__boundings"),f=p("__curve"),l=p("__print"),g=p("__util"),m=p("vec3"),n=p("vec4"),r=p("quat"),A=p("mat4"),v={};a.sp=function(a){return 5.04<=a};a.Gv=function(a){v={};var f=a.worlds;if(0==f.length){l.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var h={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,b4w_fog_color:[.5,
.5,.5],b4w_fog_density:0,texture_slots:[]};f.push(h)}for(var f=a.worlds,k=0;k<f.length;k++){var h=f[k],m=h.b4w_shadow_settings;"csm_resolution"in m||(c("world",h,"b4w_shadow_settings.csm_resolution"),m.csm_resolution=2048);"self_shadow_polygon_offset"in m||(c("world",h,"b4w_shadow_settings.self_shadow_polygon_offset"),m.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in m||(c("world",h,"b4w_shadow_settings.self_shadow_normal_offset"),m.self_shadow_normal_offset=.01);"b4w_enable_csm"in m||
(c("world",h,"b4w_shadow_settings.b4w_enable_csm"),m.b4w_enable_csm=!1);"csm_num"in m||(c("world",h,"b4w_shadow_settings.csm_num"),m.csm_num=1);"csm_first_cascade_border"in m||(c("world",h,"b4w_shadow_settings.csm_first_cascade_border"),m.csm_first_cascade_border=10);"first_cascade_blur_radius"in m||(c("world",h,"b4w_shadow_settings.first_cascade_blur_radius"),m.first_cascade_blur_radius=3);"csm_last_cascade_border"in m||(c("world",h,"b4w_shadow_settings.csm_last_cascade_border"),m.csm_last_cascade_border=
100);"last_cascade_blur_radius"in m||(c("world",h,"b4w_shadow_settings.last_cascade_blur_radius"),m.last_cascade_blur_radius=1.5);"fade_last_cascade"in m||(c("world",h,"b4w_shadow_settings.fade_last_cascade"),m.fade_last_cascade=!0);"blend_between_cascades"in m||(c("world",h,"b4w_shadow_settings.blend_between_cascades"),m.blend_between_cascades=!0);m=h.b4w_ssao_settings;"dist_factor"in m||(c("world",h,"b4w_ssao_settings.dist_factor"),m.dist_factor=0,m.samples=16);"hemisphere"in m||(c("world",h,"b4w_ssao_settings.hemisphere"),
m.hemisphere=!1);"blur_depth"in m||(c("world",h,"b4w_ssao_settings.blur_depth"),m.blur_depth=!1);"blur_discard_value"in m||(c("world",h,"b4w_ssao_settings.blur_discard_value"),m.blur_discard_value=1);"use_sky_blend"in h||(c("world",h,"use_sky_blend"),h.use_sky_blend=!1);"use_sky_paper"in h||(c("world",h,"use_sky_paper"),h.use_sky_paper=!1);"use_sky_real"in h||(c("world",h,"use_sky_real"),h.use_sky_real=!1);"b4w_outline_color"in h||(h.b4w_outline_color="b4w_glow_color"in h?h.b4w_glow_color:[1,1,1],
c("world",h,"b4w_outline_color"));"b4w_outline_factor"in h||(h.b4w_outline_factor="b4w_glow_factor"in h?h.b4w_glow_factor:1,c("world",h,"b4w_outline_factor"));"b4w_small_glow_mask_coeff"in h||(c("world",h,"b4w_small_glow_mask_coeff"),h.b4w_small_glow_mask_coeff=2);"b4w_large_glow_mask_coeff"in h||(c("world",h,"b4w_large_glow_mask_coeff"),h.b4w_large_glow_mask_coeff=2);"b4w_small_glow_mask_width"in h||(c("world",h,"b4w_small_glow_mask_width"),h.b4w_small_glow_mask_width=2);"b4w_large_glow_mask_width"in
h||(c("world",h,"b4w_large_glow_mask_width"),h.b4w_large_glow_mask_width=6);"b4w_fog_density"in h||(c("world",h,"b4w_fog_density"),h.b4w_fog_density=0);"b4w_sky_settings"in h&&"rayleigh_brightness"in h.b4w_sky_settings||(c("world",h,"rayleigh_brightness"),h.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,
mie_collection_power:.5,mie_distribution:.4});"render_sky"in h.b4w_sky_settings||(c("world",h,"render_sky"),h.b4w_sky_settings.render_sky=!1);"b4w_bloom_settings"in h?("blur"in h.b4w_bloom_settings||(c("world",h,"b4w_bloom_settings.blur"),h.b4w_bloom_settings.blur=4),"edge_lum"in h.b4w_bloom_settings||(c("world",h,"b4w_bloom_settings.edge_lum"),h.b4w_bloom_settings.edge_lum=1)):(c("world",h,"b4w_bloom_settings"),h.b4w_bloom_settings={key:.2,blur:4});"b4w_motion_blur_settings"in h?("motion_blur_factor"in
h.b4w_motion_blur_settings||(c("world",h,"b4w_motion_blur_settings.motion_blur_factor"),h.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in h.b4w_motion_blur_settings||(c("world",h,"b4w_motion_blur_settings.motion_blur_decay_threshold"),h.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(c("world",h,"b4w_motion_blur_settings"),h.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});"b4w_color_correction_settings"in h||(c("world",
h,"b4w_color_correction_settings"),h.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in h.b4w_god_rays_settings||(c("world",h,"b4w_god_rays_settings.steps_per_pass"),h.b4w_god_rays_settings.steps_per_pass=10);"b4w_render_glow_over_blend"in h||(h.b4w_render_glow_over_blend=!1,c("world",h,"b4w_render_glow_over_blend"));m=h.texture_slots;for(h=0;h<m.length;h++){var r=m[h];"blend_type"in r||(r.blend_type="MIX",c("world_texture_slot",r,"blend_type"));"use_map_blend"in
r||(r.use_map_blend=!1,c("world_texture_slot",r,"use_map_blend"));"use_map_horizon"in r||(r.use_map_horizon=!0,c("world_texture_slot",r,"use_map_horizon"));"use_map_zenith_up"in r||(r.use_map_zenith_up=!1,c("world_texture_slot",r,"use_map_zenith_up"));"use_rgb_to_intensity"in r||(r.use_rgb_to_intensity=!1,c("world_texture_slot",r,"use_rgb_to_intensity"));"invert"in r||(r.invert=!1,c("world_texture_slot",r,"invert"));"color"in r||(r.color=[1,0,1],c("world_texture_slot",r,"color"));"blend_factor"in
r||(r.blend_factor=0,c("world_texture_slot",r,"blend_factor"));"horizon_factor"in r||(r.horizon_factor=1,c("world_texture_slot",r,"horizon_factor"));"zenith_up_factor"in r||(r.zenith_up_factor=0,c("world_texture_slot",r,"zenith_up_factor"));"zenith_down_factor"in r||(r.zenith_down_factor=0,c("world_texture_slot",r,"zenith_down_factor"));"default_value"in r||(r.default_value=1,c("world_texture_slot",r,"default_value"))}}h=a.scenes;for(k=0;k<h.length;k++)f=h[k],"b4w_use_nla"in f||(f.b4w_use_nla=!1,
c("scene",f,"b4w_use_nla")),"fps"in f||(f.fps=24,c("scene",f,"fps")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,c("scene",f,"b4w_nla_cyclic")),"b4w_nla_script"in f||(f.b4w_nla_script=[],c("scene",f,"b4w_nla_script")),"b4w_detect_collisions"in f&&(e("scene",f),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,
ratio:12,attack:.003,release:.25},c("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,c("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,c("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=!1,c("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=
!0,c("scene",f,"b4w_enable_antialiasing")),"b4w_tags"in f||(f.b4w_tags={title:"",description:""},c("scene",f,"b4w_tags")),"b4w_enable_object_selection"in f||(f.b4w_enable_object_selection="AUTO",c("scene",f,"b4w_enable_object_selection")),"b4w_enable_outlining"in f||(f.b4w_enable_outlining="AUTO",c("scene",f,"b4w_enable_outlining")),"b4w_enable_glow_materials"in f||(f.b4w_enable_glow_materials="AUTO",c("scene",f,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in f||(f.b4w_enable_anchors_visibility=
"AUTO",c("scene",f,"b4w_enable_anchors_visibility"));f=a.meshes;for(k=0;k<f.length;k++){m=f[k];m.b4w_bounding_box||(c("mesh",m,"b4w_bounding_box"),m.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});m.uv_textures||(c("mesh",m,"uv_textures"),m.uv_textures=[]);m.b4w_bounding_sphere_center||(m.b4w_bounding_sphere_center=[0,0,0]);m.b4w_bounding_cylinder_center||(m.b4w_bounding_cylinder_center=[0,0,0]);m.b4w_bounding_ellipsoid_center||(m.b4w_bounding_ellipsoid_center=[0,0,0]);m.b4w_bounding_ellipsoid_axes||
(h=m.b4w_bounding_box,m.b4w_bounding_ellipsoid_axes=[(h.max_x-h.min_x)/2,(h.max_y-h.min_y)/2,(h.max_z-h.min_z)/2]);"b4w_shape_keys"in m||(m.b4w_shape_keys=[],c("mesh",m,"b4w_shape_keys"));for(var h=m,r=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],n=null,q=0;q<r.length;q++)h[r[q]]&&(n?(h[r[q]]=!1,l.warn('WARNING property "'+r[q]+'" of object "'+h.name+'" has been set to "false". Foreground property "'+n+'" already exists.')):n=
r[q]);for(h=0;h<m.b4w_vertex_anim.length;h++)r=m.b4w_vertex_anim[h],"allow_nla"in r||(c('mesh["b4w_vertex_anim"]',m,"allow_nla"),r.allow_nla=!0)}h=a.cameras;for(k=0;k<h.length;k++)f=h[k],f.type||(f.type="PERSP",c("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,e("camera",f)),"b4w_trans_velocity"in f||(f.b4w_trans_velocity=1,c("camera",f,"b4w_trans_velocity")),"b4w_rot_velocity"in f||(f.b4w_rot_velocity=1,c("camera",f,"b4w_rot_velocity")),"b4w_zoom_velocity"in f||(f.b4w_zoom_velocity=
.1,c("camera",f,"b4w_zoom_velocity")),"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,c("camera",f,"b4w_use_distance_limits")),"b4w_distance_min"in f||(f.b4w_distance_min=1,c("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,c("camera",f,"b4w_distance_max")),"b4w_horizontal_translation_min"in f||(f.b4w_horizontal_translation_min=-100,c("camera",f,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in f||(f.b4w_horizontal_translation_max=100,
c("camera",f,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in f||(f.b4w_vertical_translation_min=-100,c("camera",f,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in f||(f.b4w_vertical_translation_max=100,c("camera",f,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in f||(f.b4w_use_horizontal_clamping=!1,c("camera",f,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in f||(f.b4w_rotation_left_limit=-Math.PI,c("camera",f,"b4w_rotation_left_limit")),
"b4w_rotation_right_limit"in f||(f.b4w_rotation_right_limit=Math.PI,c("camera",f,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in f||(f.b4w_horizontal_clamping_type="LOCAL",c("camera",f,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,c("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=-Math.PI/2,c("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in f||(f.b4w_rotation_up_limit=
Math.PI/2,c("camera",f,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in f||(f.b4w_vertical_clamping_type="LOCAL",c("camera",f,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in f||(f.b4w_hover_angle_min=Math.PI/6,c("camera",f,"b4w_hover_angle_min")),"b4w_hover_angle_max"in f||(f.b4w_hover_angle_max=Math.PI/6,c("camera",f,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in f||(f.b4w_enable_hover_hor_rotation=!0,c("camera",f,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in f||
(f.b4w_use_panning=!0,c("camera",f,"b4w_use_panning"));h=a.lamps;for(k=0;k<h.length;k++)f=h[k],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,c("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=!1,c("lamp",f,"b4w_dynamic_intensity")),"use_diffuse"in f||(f.use_diffuse=!0,c("lamp",f,"use_diffuse")),"use_specular"in f||(f.use_specular=!0,c("lamp",f,"use_specular"));h=a.speakers;for(k=0;k<h.length;k++)f=h[k],"b4w_behavior"in f||(f.b4w_behavior=f.b4w_background_music?
"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in f||(f.b4w_disable_doppler=!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=!1),"b4w_loop_count"in f||(f.b4w_loop_count=0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in f||(f.b4w_playlist_id=
""),f.animation_data&&b(f.animation_data);h=a.textures;for(k=0;k<h.length;k++)f=h[k],"b4w_anisotropic_filtering"in f||(f.b4w_anisotropic_filtering="OFF",c("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,c("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=[1,1],c("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=[1,1],c("texture",f,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in f||(f.b4w_parallax_steps=
5,c("material",f,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in f||(f.b4w_parallax_lod_dist=10,c("material",f,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,c("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],c("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=100,c("texture",f,"b4w_max_shore_dist")),"b4w_disable_compression"in f||(f.b4w_disable_compression=
!1,c("texture",f,"b4w_disable_compression")),"b4w_source_type"in f||(f.b4w_source_type="",c("texture",f,"b4w_source_type")),"b4w_source_id"in f||(f.b4w_source_id="",c("texture",f,"b4w_source_id")),"b4w_source_size"in f||(f.b4w_source_size=1024,c("texture",f,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in f||(f.b4w_enable_canvas_mipmapping=!0,c("texture",f,"b4w_enable_canvas_mipmapping"));f=a.materials;for(k=0;k<f.length;k++){n=f[k];"b4w_node_mat_type"in n&&e("material",n);"b4w_skydome"in n&&
e("material",n);"b4w_procedural_skydome"in n&&e("material",n);n.b4w_water&&("b4w_water_shore_smoothing"in n||(n.b4w_water_shore_smoothing=!1,c("material",n,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in n||(n.b4w_water_dynamic=!1,c("material",n,"b4w_water_dynamic")),"b4w_waves_height"in n||(n.b4w_waves_height=1,c("material",n,"b4w_waves_height")),"b4w_waves_length"in n||(n.b4w_waves_length=1,c("material",n,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in n||(n.b4w_water_dst_noise_scale0=.05,
c("material",n,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in n||(n.b4w_water_dst_noise_scale1=.03,c("material",n,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in n||(n.b4w_water_dst_noise_freq0=1.3,c("material",n,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in n||(n.b4w_water_dst_noise_freq1=1,c("material",n,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in n||(n.b4w_water_dir_min_shore_fac=.4,c("material",n,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
n||(n.b4w_water_dir_freq=.5,c("material",n,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in n||(n.b4w_water_dir_noise_scale=.05,c("material",n,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in n||(n.b4w_water_dir_noise_freq=.07,c("material",n,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in n||(n.b4w_water_dir_min_noise_fac=.5,c("material",n,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in n||(n.b4w_water_dst_min_fac=.2,c("material",n,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
n||(n.b4w_water_waves_hor_fac=5,c("material",n,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in n||(n.b4w_water_absorb_factor=6,c("material",n,"b4w_water_absorb_factor")),"b4w_water_fog_color"in n||(n.b4w_water_fog_color=new Float32Array(3),n.b4w_water_fog_color=[.5,.7,.7],c("material",n,"b4w_water_fog_color")),"b4w_foam_factor"in n||(n.b4w_foam_factor=5,c("material",n,"b4w_foam_factor")),"b4w_generated_mesh"in n||(n.b4w_generated_mesh=!1,c("material",n,"b4w_generated_mesh")),"b4w_water_num_cascads"in
n||(n.b4w_water_num_cascads=5,c("material",n,"b4w_water_num_cascads")),"b4w_water_subdivs"in n||(n.b4w_water_subdivs=64,c("material",n,"b4w_water_subdivs")),"b4w_water_detailed_dist"in n||(n.b4w_water_detailed_dist=1E3,c("material",n,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in n||(n.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in n||(n.b4w_dynamic_grass_color="");"diffuse_intensity"in n||(n.diffuse_intensity=1,c("material",n,"diffuse_intensity"));"b4w_use_ghost"in n||(n.b4w_use_ghost=
!1);"b4w_collision_margin"in n||(n.b4w_collision_margin=.04,c("material",n,"b4w_collision_margin"));"b4w_collision_group"in n||(n.b4w_collision_group=128,c("material",n,"b4w_collision_group"));"b4w_collision_mask"in n||(n.b4w_collision_mask=127,c("material",n,"b4w_collision_mask"));"b4w_do_not_render"in n||(n.b4w_do_not_render=!1,c("material",n,"b4w_do_not_render"));"HALO"!=n.type||"b4w_halo_sky_stars"in n||(n.b4w_halo_sky_stars=!1,c("material",n,"b4w_halo_sky_stars"));"HALO"!=n.type||"b4w_halo_stars_blend_height"in
n||(n.b4w_halo_stars_blend_height=10,c("material",n,"b4w_halo_stars_blend_height"));"HALO"!=n.type||"b4w_halo_stars_min_height"in n||(n.b4w_halo_stars_min_height=0,c("material",n,"b4w_halo_stars_min_height"));"specular_shader"in n||(n.specular_shader="COOKTORR",c("material",n,"specular_shader"));"diffuse_shader"in n||(n.diffuse_shader="LAMBERT",c("material",n,"diffuse_shader"));"roughness"in n||(n.roughness=.5,c("material",n,"roughness"));"diffuse_fresnel"in n||(n.diffuse_fresnel=.1,c("material",
n,"diffuse_fresnel"));"diffuse_fresnel_factor"in n||(n.diffuse_fresnel_factor=.5,c("material",n,"diffuse_fresnel_factor"));"specular_slope"in n||(n.specular_slope=.2,c("material",n,"specular_slope"));"specular_toon_size"in n||(n.specular_toon_size=.5,c("material",n,"specular_toon_size"));"specular_toon_smooth"in n||(n.specular_toon_smooth=.1,c("material",n,"specular_toon_smooth"));"specular_alpha"in n||(n.specular_alpha=1,c("material",n,"specular_alpha"));"b4w_wettable"in n||(n.b4w_wettable=!1,c("material",
n,"b4w_wettable"));"b4w_refractive"in n||(n.b4w_refractive=!1,c("material",n,"b4w_refractive"));"b4w_refr_bump"in n||(n.b4w_refr_bump=0,c("material",n,"b4w_refr_bump"));"b4w_shallow_water_col"in n||(n.b4w_shallow_water_col=[0,.8,.3],c("material",n,"b4w_shallow_water_col"));"b4w_shore_water_col"in n||(n.b4w_shore_water_col=[0,.9,.2],c("material",n,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in n||(n.b4w_shallow_water_col_fac=1,c("material",n,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in
n||(n.b4w_shore_water_col_fac=.5,c("material",n,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in n||(n.b4w_water_sss_strength=5.9,c("material",n,"b4w_water_sss_strength"));"b4w_water_sss_width"in n||(n.b4w_water_sss_width=.45,c("material",n,"b4w_water_sss_width"));"b4w_render_above_all"in n||(n.b4w_render_above_all=!1,c("material",n,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in n||(n.b4w_water_norm_uv_velocity=.05,c("material",n,"b4w_water_norm_uv_velocity"));m=n.texture_slots;for(h=
0;h<m.length;h++)r=m[h],"blend_type"in r||(r.blend_type="MIX",c("texture_slot",r,"blend_type"));if(n.node_tree){m=n.node_tree.nodes;for(h=0;h<m.length;h++)d(m[h]);n.node_tree.animation_data&&b(n.node_tree.animation_data)}}f=a.node_groups;for(k=0;k<f.length;k++)for(m=f[k].node_tree.nodes,h=0;h<m.length;h++)d(m[h]);f=a.objects;for(k=0;k<f.length;k++){m=f[k];switch(m.type){case "MESH":"b4w_dynamic_geometry"in m||(m.b4w_dynamic_geometry=!1);"b4w_reflexible"in m||(m.b4w_reflexible=!1);"b4w_reflexible_only"in
m||(m.b4w_reflexible_only=!1);"b4w_reflective"in m||(m.b4w_reflective=!1);"b4w_reflection_type"in m||(m.b4w_reflection_type="PLANE",c("object",m,"b4w_reflection_type"));"b4w_wind_bending"in m||(m.b4w_wind_bending=!1,c("object",m,"b4w_wind_bending"));"b4w_wind_bending_angle"in m||(m.b4w_wind_bending_angle=10,m.b4w_wind_bending_freq=.25,c("object",m,"wind bending params"));"b4w_detail_bending_amp"in m||(m.b4w_detail_bending_amp=.1,m.b4w_branch_bending_amp=.3,c("object",m,"detail bending params"));"b4w_detail_bending_freq"in
m||(m.b4w_detail_bending_freq=1,c("object",m,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in m||(m.b4w_main_bend_stiffness_col="",c("object",m,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in m||(m.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},c("object",m,"b4w_detail_bend_colors"));"b4w_caustics"in m||(m.b4w_caustics=!1);"vertex_groups"in m&&m.vertex_groups.length&&m.data&&0==m.data.vertex_groups.length&&(m.data.vertex_groups=
m.vertex_groups,delete m.vertex_groups,c("object",m,"vertex_groups"));"b4w_vertex_anim"in m&&m.b4w_vertex_anim.length&&m.data&&0==m.data.b4w_vertex_anim.length&&(m.data.b4w_vertex_anim=m.b4w_vertex_anim,delete m.b4w_vertex_anim,c("object",m,"b4w_vertex_anim"));"b4w_do_not_render"in m||(m.b4w_do_not_render=!1);"use_ghost"in m.game||(m.game.use_ghost=!1);"use_sleep"in m.game||(m.game.use_sleep=!1);"velocity_min"in m.game||(m.game.velocity_min=0);"velocity_max"in m.game||(m.game.velocity_max=0);"collision_group"in
m.game||(m.game.collision_group=1);"collision_mask"in m.game||(m.game.collision_mask=255);"b4w_vehicle_settings"in m?m.b4w_vehicle_settings&&("steering_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_ratio=10),"steering_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_max=1),"inverse_control"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.inverse_control=!1),"force_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.force_max=1500),"brake_max"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.brake_max=100),"speed_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_stiffness=
20),"suspension_damping"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"floating_factor"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_rot_damp=.9)):(m.b4w_vehicle_settings=null,c("object",m,"b4w_vehicle_settings"));"b4w_floating_settings"in m?m.b4w_floating_settings&&("floating_factor"in m.b4w_floating_settings||(m.b4w_floating_settings.floating_factor=3),"water_lin_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_lin_damp=
.8),"water_rot_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_rot_damp=.8)):(m.b4w_floating_settings=null,c("object",m,"b4w_floating_settings"));"b4w_character_settings"in m?m.b4w_character_settings&&("walk_speed"in m.b4w_character_settings||(m.b4w_character_settings.walk_speed=4),"run_speed"in m.b4w_character_settings||(m.b4w_character_settings.run_speed=8),"step_height"in m.b4w_character_settings||(m.b4w_character_settings.step_height=.25),"jump_strength"in m.b4w_character_settings||
(m.b4w_character_settings.jump_strength=5),"waterline"in m.b4w_character_settings||(m.b4w_character_settings.waterline=0)):(m.b4w_character_settings=null,c("object",m,"b4w_character_settings"));"b4w_selectable"in m||(m.b4w_selectable=!1,c("object",m,"b4w_selectable"));"b4w_outlining"in m||(m.b4w_outlining=!1,c("object",m,"b4w_outlining"));"b4w_outline_on_select"in m||(m.b4w_outline_on_select=!1,c("object",m,"b4w_outline_on_select"));"b4w_billboard"in m||(m.b4w_billboard=!1,c("object",m,"b4w_billboard"));
"b4w_billboard_geometry"in m||(m.b4w_billboard_geometry="SPHERICAL",c("object",m,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in m||(m.b4w_pres_glob_orientation=!1,c("object",m,"b4w_pres_glob_orientation"));"b4w_outline_settings"in m||("b4w_glow_settings"in m?m.b4w_outline_settings=m.b4w_glow_settings:(m.b4w_outline_settings={},m.b4w_outline_settings.outline_duration=1,m.b4w_outline_settings.outline_period=1,m.b4w_outline_settings.outline_relapses=0),c("object",m,"b4w_outline_settings"));
"b4w_lod_transition"in m||(m.b4w_lod_transition=.01,c("object",m,"b4w_lod_transition"));"lod_levels"in m||(m.lod_levels=[],c("object",m,"lod_levels"));"b4w_animation_mixing"in m||(m.b4w_animation_mixing=!1,c("object",m,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in m||(m.b4w_group_relative=!1,c("object",m,"b4w_group_relative")),"b4w_anchor"in m||(m.b4w_anchor=null,c("object",m,"b4w_anchor")),!m.b4w_anchor||"max_width"in m.b4w_anchor||(m.b4w_anchor.max_width=250)}"collision_margin"in
m.game||(m.game.collision_margin=.04,c("object",m,"collision_margin"));"b4w_anim_behavior"in m||(m.b4w_anim_behavior=m.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",c("object",m,"b4w_anim_behavior"));if(!("rotation_quaternion"in m)){h=[0,0,0,1];g.euler_to_quat(m.rotation_euler,h);var r=h,n=h[0],q=h[1],A=h[2];r[0]=h[3];r[1]=n;r[2]=q;r[3]=A;m.rotation_quaternion=h;c("object",m,"rotation_quaternion")}"webgl_do_not_batch"in m&&(m.b4w_do_not_batch=m.webgl_do_not_batch)&&e("object",m);"b4w_shadow_cast_only"in
m||(m.b4w_shadow_cast_only=!1,c("object",m,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in m||(m.b4w_correct_bounding_offset="AUTO",c("object",m,"b4w_correct_bounding_offset"));r=m.particle_systems;for(h=0;h<r.length;h++)n=r[h],q=n.settings,"use_rotation_dupli"in q||(q.use_rotation_dupli=!1,c("object",q,"use_rotation_dupli")),"use_whole_group"in q||(q.use_whole_group=!1,c("object",q,"use_whole_group")),n.transforms||(n.transforms=new Float32Array,c("particle_system",n,"transforms")),"b4w_billboard_align"in
q||(q.b4w_billboard_align="VIEW",c("particle_settings",q,"b4w_billboard_align")),"b4w_dynamic_grass"in q||(q.b4w_dynamic_grass=!1,c("object",q,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in q||(q.b4w_dynamic_grass_scale_threshold=.01,c("object",q,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in q||(q.b4w_initial_rand_rotation=!1,c("particle_settings",q,"b4w_initial_rand_rotation")),"b4w_rotation_type"in q||(q.b4w_rotation_type="Z",c("particle_settings",q,"b4w_rotation_type")),
"b4w_rand_rotation_strength"in q||(q.b4w_rand_rotation_strength=1,c("particle_settings",q,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in q||(q.b4w_hair_billboard=!1,c("particle_settings",q,"b4w_hair_billboard")),"b4w_hair_billboard_type"in q||(q.b4w_hair_billboard_type="BASIC",c("particle_settings",q,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in q||(q.b4w_hair_billboard_jitter_amp=0,c("particle_settings",q,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in
q||(q.b4w_hair_billboard_jitter_freq=0,c("particle_settings",q,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in q||(q.b4w_hair_billboard_geometry="SPHERICAL",c("particle_settings",q,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in q||(q.b4w_wind_bend_inheritance="PARENT",c("particle_settings",q,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in q||(q.b4w_shadow_inheritance="PARENT",c("particle_settings",q,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in
q||(q.b4w_reflection_inheritance="PARENT",c("particle_settings",q,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in q||(q.b4w_vcol_from_name="",c("particle_settings",q,"b4w_vcol_from_name")),"b4w_vcol_to_name"in q||(q.b4w_vcol_to_name="",c("particle_settings",q,"b4w_vcol_to_name")),"b4w_coordinate_system"in q||(q.b4w_coordinate_system="LOCAL",c("particle_settings",q,"b4w_coordinate_system")),"b4w_allow_nla"in q||(q.b4w_allow_nla=!0,c("particle_settings",q,"b4w_allow_nla"));"constraints"in m||
(m.constraints=[],c("object",m,"constraints"));r=m.modifiers;for(h=0;h<r.length;h++){a:{n=r[h];switch(n.type){case "ARRAY":if(!("fit_type"in n)){l.error("WARNING Incomplete modifier "+String(n.type)+' for "'+m.name+'", reexport "'+a.b4w_filepath_blend+'" scene');n=!1;break a}}n=!0}n||(r.splice(h,1),h--)}"animation_data"in m||(m.animation_data={action:null,nla_tracks:[]},c("object",m,"animation_data"));m.animation_data&&("action"in m.animation_data||(m.animation_data.action=null,l.warn("no action in animation data "+
m.name)),"nla_tracks"in m.animation_data||(m.animation_data.nla_tracks=[],l.warn("no NLA in animation data "+m.name)),b(m.animation_data));"b4w_collision_id"in m||(m.b4w_collision_id="",c("material",m,"b4w_collision_id"));h=m.scale;0==h[0]&&0==h[1]&&0==h[2]?h=!0:(r=Math.abs((h[1]-h[2])/h[1]),h=.001>Math.abs((h[0]-h[1])/h[0])&&.001>r);h||l.warn("non-uniform scale for object "+m.name)}for(var H in v)k=v[H],h=H.match(/.*?(?=>>|$)/i)[0],l.warn("WARNING "+String(h)+" is "+k.fs+" for "+k.type+", reexport "+
a.b4w_filepath_blend)};a.Dv=function(a,b){"num_channels"in a||(a.num_channels=1,l.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.cv=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=h(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=b,l=e,v=0,q=0,p=0,H=new Float32Array(16),e=[],z=1;z<
l.count;z++){l.use_constant_offset&&(v+=l.constant_offset_displace[0],q+=l.constant_offset_displace[1],p+=l.constant_offset_displace[2]);if(l.use_relative_offset)var N=d.b4w_bounding_box,v=v+(N.max_x-N.min_x)*l.relative_offset_displace[0],q=q+(N.max_y-N.min_y)*l.relative_offset_displace[1],p=p+(N.max_z-N.min_z)*l.relative_offset_displace[2];g.XA(v,q,p,H);for(var O=N=h(d),L=H,F=0;F<O.submeshes.length;F++){var I=O.submeshes[F];g.We(I.position,L,I.position,0);g.OB(I.normal,L,I.normal);g.UA(I.tangent,
L,I.tangent)}e.push(N)}for(z=0;z<e.length;z++)for(l=d,v=e[z],q=0;q<l.submeshes.length;q++){p=l.submeshes[q];H=v.submeshes[q];N=p.base_length;O=p.indices.length;p.base_length+=H.base_length;for(var M in p)if("base_length"!=M)if("indices"==M)for(p[M]=g.aB(p[M],H[M]),L=O;L<p.indices.length;L++)p.indices[L]+=N;else"vertex_colors"!=M&&(p[M]=g.nx(p[M],H[M]))}break;case "CURVE":for(var d=b,z=e.object.Iu,l=new Float32Array(16),q=z.Re?4:3,v=new Float32Array(q),q=new Float32Array(q),p=new Float32Array(3),H=
new Float32Array(4),N=new Float32Array(4),O=new Float32Array(3),L=new Float32Array(3),F=new Float32Array(3),I=new Float32Array(4),R=new Float32Array(4),ca=0;ca<d.submeshes.length;ca++){var S=d.submeshes[ca],Y=S.position,W=S.normal,S=S.tangent,ia;a:switch(ia=e.deform_axis,ia){case "POS_X":case "NEG_X":ia=0;break a;case "POS_Y":case "NEG_Y":ia=1;break a;case "POS_Z":case "NEG_Z":ia=2;break a;default:throw"Wrong deform axis value "+ia;}O[0]=0;O[1]=0;O[2]=0;O[ia]=1;for(var ma=f.EA(z),P=0;P<Y.length/3;P++){F[0]=
Y[3*P];F[1]=Y[3*P+1];F[2]=Y[3*P+2];var u=F[ia],qa=f.DA(z,u);f.FA(z,qa,v);p[0]=v[0];p[1]=v[1];p[2]=v[2];f.CA(z,qa,q);L[0]=q[0];L[1]=0;L[2]=q[2];m.normalize(L,L);r.rotationTo(O,L,H);0>u?(v[0]=L[0],v[1]=L[1],v[2]=L[2],m.scale(v,u,v),m.add(p,v,p)):u>ma&&(v[0]=L[0],v[1]=L[1],v[2]=L[2],m.scale(v,u-ma,v),m.add(p,v,p));A.fromRotationTranslation(H,p,l);z.Re&&(r.setAxisAngle(O,v[3],N),m.transformQuat(F,N,F));F[ia]=0;m.transformMat4(F,l,F);Y[3*P]=F[0];Y[3*P+1]=F[1];Y[3*P+2]=F[2];W.length&&(I[0]=W[3*P],I[1]=
W[3*P+1],I[2]=W[3*P+2],I[3]=0,n.transformMat4(I,l,I),W[3*P]=I[0],W[3*P+1]=I[1],W[3*P+2]=I[2]);S.length&&(R[0]=S[3*P],R[1]=S[3*P+1],R[2]=S[3*P+2],R[3]=0,n.transformMat4(R,l,R),S[3*P]=R[0],S[3*P+1]=R[1],S[3*P+2]=R[2])}}}k.vz(b)}return b};a.SC=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,
1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",
use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.kv=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,e=0;e<d.length;e++){var f=d[e];switch(f.type){case "SELECT":case "SELECT_PLAY":for(var g=
0;g<a.length;g++){var h=a[g];h.name==f.object&&(h.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(g=0;g<a.length;g++)h=a[g],h.name==f.object&&(h.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,p){function d(a){a=Na.ya(a);a.ae=null;a.ab=null;a.Hc=null;return a}function b(a,b){var d=[];Q.qe(a,function(b,c,f){-1<d.indexOf(f)?Q.Ez(a,b,c,f,e(f)):d.push(f)});Q.S(a,function(c,f){for(var g=0;g<f.ka.length;g++){var h=f.ka[g];b||"MAIN_PLANE_REFLECT"!=f.type&&"MAIN_CUBE_REFLECT"!=f.type&&"MAIN_XRAY"!=f.type||(h.ug=!0);-1<d.indexOf(h)?f.ka[g]=e(h):d.push(h)}"ANTIALIASING"==f.type&&Q.re(a,c,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ka.length;c++){var d=
b.ka[c];d.Y=T.r;d.X=T.r}});b||Q.re(a,c,function(a,b,c){"DEPTH"==c.L&&(c.ug=!0)})});Q.S(a,function(b){var d={};c(a,b,d);for(var e in d){b=d[e];for(var f=b[0],g=0;g<b.length;g++)if(b[g].Y==T.r){f=b[g];break}for(var h=b[0],g=0;g<b.length;g++)if(b[g].X==T.r){h=b[g];break}for(var J=b[0],g=0;g<b.length;g++)if(!b[g].ug){J=b[g];break}for(g=0;g<b.length;g++)b[g].Y=f.Y,b[g].X=h.X,b[g].ug=J.ug}})}function c(a,b,d){Q.re(a,b,function(b,e,f){f.Ka&&f.L==f.da&&(d[f.L]=d[f.L]||[],-1==d[f.L].indexOf(f)&&d[f.L].push(f),
c(a,b,d))});Q.lf(a,b,function(a,b,c){c.Ka&&(d[c.L]=d[c.L]||[],-1==d[c.L].indexOf(c)&&d[c.L].push(c))});b=Q.Sa(a,b);if("MOTION_BLUR"==b.type)for(var e=0;e<b.ka.length;e++){var f=b.ka[e];d[f.L].push(f)}}function e(a){if(a.qa)throw"Failed to clone slink with attached texture";return Na.Ef(a)}function h(a){var b=Q.$n(a),c=[];Q.S(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var e=[];break;default:e=c}for(var h=0;h<d.ka.length;h++){var J=
d.ka[h],k=m(e,J,f(J));J.qa=k;d.Ad[h]=k}for(h=0;h<d.Ad.length;h++)k=d.Ad[h],g(e,k);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":e=[]}Q.lf(b,a,function(c,d,g){if(!g.qa){if((c=l(b,a,g.L))&&g.Ka&&!g.qa){d=e;for(var h=c,J=0;J<d.length;J++){var k=d[J];k.Wn===h&&k.Gi++}}else c=m(e,g,f(g));g.qa=c}});Q.re(b,a,function(a,b,c){g(e,c.qa)});Q.lf(b,a,function(a,b,c){c.qa&&"NONE"==c.da&&g(e,c.qa)})})}function k(a){r(a,function(b,c,d){b.Hh&&(ra(a,
d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ra(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.ff*=gb.resolution_factor)})}function f(a){a=Na.Ef(a);delete a.da;delete a.Ka;delete a.qa;return JSON.stringify(a)}function l(a,b,c){var d=null;Q.re(a,b,function(a,b,e){if(e.Ka&&e.L==e.da&&e.L==c&&e.qa)return d=e.qa,!0});Q.lf(a,b,function(a,b,e){if(e.Ka&&e.L==c&&e.qa)return d=e.qa,!0});return d}function g(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Wn===b&&d.Gi&&d.Gi--}}
function m(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.Gi){d=f;break}}if(d)return d.Gi++,d.Wn;b=n(b);a.push({id:c,Gi:1,Wn:b});return b}function n(a){var b=a.ff*a.size;switch(a.L){case "COLOR":var c=T.Dj("COLOR",T.Ag);T.resize(c,b,b);T.En(c,a.Y,a.X);return c;case "DEPTH":return a.ug?(c=T.Dj("DEPTH_RBUF",T.zg),T.resize(c,b,b)):(c=T.Dj("DEPTH_TEX",T.Nh),T.resize(c,b,b),T.En(c,a.Y,a.X)),c;case "CUBEMAP":return c=T.jw(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.L;}}function r(a,b){var c=!1;Q.qe(a,function(d,e,f){if(f&&(d=Q.Sa(a,d),e=Q.Sa(a,e),b(f,!1,d,e)))return c=!0});c||Q.S(a,function(a,c){for(var d=0;d<c.ka.length;d++)if(b(c.ka[d],!0,c,null))return!0})}function A(a){Q.S(a,function(b,c){if("SINK"!=c.type){var d=c.h;Q.lf(a,b,function(a,b,c){c.Ka&&c.qa&&(na.Dk(d,c.L,c.qa),c.L==c.da&&b.h&&na.Dk(b.h,c.L,c.qa))});for(var e=0;e<c.ka.length;e++){var f=c.ka[e];f.Ka&&f.L==f.da&&na.Dk(d,f.L,c.Ad[e])}!d.ab&&!d.Hc||d.ae||(d.ae=Xa.Dz(d.ab,d.Hc))}})}function v(a){var b=
null,c=0;Q.S(a,function(a,d){if(d.type==ta.QA){if(c==ta.PA)return b=d,!0;c++}});return b}function E(a,b){var c=Q.lh(a,b),d=C("NONE"),e=Q.v(a,d),f=Q.xq(a)[0];Q.qe(a,function(b,c){c==f&&Q.wz(a,b,f,b,e)});Q.qe(a,function(e,f,g){if(e==c)return Q.l(a,b,d,t(ta.qA,"u_color",g.size,g.ff,g.Hh)),!0});Q.ed(a,e,f,t("SCREEN","NONE",.5,.5,!0))}function B(a,b){var c=w("SHADOW_CAST");c.Nl=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Tm){case "SPOT":case "POINT":c.h=na.ib(na.Lb);na.Ek(c.h,
180*b.Xc/Math.PI,.1,2*b.distance);break;default:c.h=na.ib(na.uf)}return c}function w(a){return{type:a,Ia:"",Da:!1,Or:!1,ll:!1,hk:!1,$h:0,time:0,h:null,Zh:null,Pl:[],p:[],ka:[],Ad:[],Xi:new Float32Array(3),rt:new Float32Array(3),Zb:new Float32Array(3),Xb:new Float32Array(4),kc:new Float32Array(16),ws:0,Ke:0,bg:0,Tf:null,Vf:null,Sf:null,Uf:null,Oe:new Float32Array(3),sf:new Float32Array(3),xs:new Float32Array(4),Ps:new Float32Array([0,0,0]),Kk:new Float32Array(3),Qs:new Float32Array(4),vs:new Float32Array(3),
xi:0,Zl:0,qi:!1,Ve:new Float32Array(3),pf:0,Wa:null,Sk:!1,cf:new Float32Array(2),df:new Float32Array(2),sh:0,gh:0,zl:0,$c:null,rf:0,yg:0,qf:0,Bf:!1,op:0,pp:new Float32Array(2),np:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,th:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,xh:0,
wh:0,vh:0,Hs:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,fh:0,zk:0,Ah:0,Nl:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,gt:null,ap:null,fg:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,tl:0,fm:0,ek:0,fk:0,or:0,vk:"",Hy:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,Xn:new Float32Array(2),A:new Float32Array(2),Ra:!0,enqueue:!0,aa:!0,ga:!0,Bb:!0,ia:!0,pe:1}}function t(a,
b,c,d,e){return{L:a,da:b,size:c,ff:d,Hh:e,Ka:!0,qa:null,ug:!1,Y:T.Hd,X:T.Hd}}function x(a,b){for(var c=0,d=V(a,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=ha(a,f,"SHADOW_CAST").h,b.gt=f.ea,b.ap=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.fg=b.fg||[],b.fg[c]=f.pa,c++)}}function G(){var a=w("GRASS_MAP");a.h=na.ib(na.we);return a}function C(a){var b=w("POSTPROCESSING");b.aa=!1;b.ga=!1;b.Bb=!1;b.h=na.ib(na.pb);b.vk=a;switch(a){case "NONE":b.A[0]=1;b.A[1]=1;break;case "GRAYSCALE":b.A[0]=
1;b.A[1]=1;break;case "X_BLUR":b.A[0]=1;b.A[1]=0;break;case "Y_BLUR":b.A[0]=0;b.A[1]=1;break;case "X_GLOW_BLUR":b.A[0]=1;b.A[1]=0;break;case "Y_GLOW_BLUR":b.A[0]=0;b.A[1]=1;break;case "X_EXTEND":b.A[0]=1;b.A[1]=0;break;case "Y_EXTEND":b.A[0]=0;b.A[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function q(a){var b=w("BLOOM_BLUR");b.aa=!1;b.ga=!1;b.Bb=!1;b.h=na.ib(na.pb);b.vk=a;switch(a){case "X_BLUR":b.A[0]=1;b.A[1]=0;break;case "Y_BLUR":b.A[0]=0;b.A[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+
a;}return b}function y(a,b){var c=w("GLOW_COMBINE");c.aa=!1;c.ga=!1;c.Bb=!1;c.small_glow_mask_coeff=b.Ne.small_glow_mask_coeff;c.large_glow_mask_coeff=b.Ne.large_glow_mask_coeff;c.small_glow_mask_width=b.Ne.small_glow_mask_width;c.large_glow_mask_width=b.Ne.large_glow_mask_width;c.A[0]=1;c.A[1]=1;c.h=a;return c}function H(a,b,c,d,e,f,g,h,J){var k=w("MAIN_"+a);if("OPAQUE"===a)k.aa=!0,k.ga=c,k.Da=!1;else if("BLEND"===a)k.aa=!1,k.ga=!1,k.Da=!0;else if("XRAY"===a)k.aa=!1,k.ga=!0,k.Da=!0;else if("PLANE_REFLECT"===
a||"CUBE_REFLECT"===a)k.aa=!0,k.ga=!0,k.Da=!1;else if("GLOW"===a)k.aa=!0,k.ga=!1,k.Da=!1;else throw"wrong main subscene type";k.Da&&h&&(k.self_shadow_normal_offset=h.self_shadow_normal_offset);k.h=b;if(a=g.In)k.xs.set([a.tv,a.sy,a.WB,a.VB]),k.vs.set(a.color),k.ws=a.za;k.Oe.set(g.Oe);k.sf.set(g.sf);k.Ke=g.Ke;k.Xb=f;d&&(k.Wa=d,d.Xb&&(k.$c=new Float32Array(d.Xb)),k.rf=d.waves_height,k.yg=d.waves_length,k.qf=d.qf,d.vj&&J&&(k.Bf=!0,k.op=d.vj,k.pp.set(d.Bl),k.np=d.Al),d.Gk&&(k.Sk=!0,f=d.oA,k.cf[0]=(f[0]+
f[1])/2,k.cf[1]=(f[2]+f[3])/2,k.df[0]=f[0]-f[1],k.df[1]=f[2]-f[3],k.sh=d.sh,k.gh=d.gh));k.Tf=new Float32Array(3*e);k.Vf=new Float32Array(3*e);k.Sf=new Float32Array(3*e);k.Uf=new Float32Array(0==e%2?2*e:2*e+2);return k}function z(a,b){var c=w("COLOR_PICKING");b&&(c.type+="_XRAY",c.aa=!1,c.ga=!0);c.enqueue=!1;c.h=a;return c}function N(a){var b=w("WIREFRAME");b.Ra=!1;b.aa=!1;b.ga=!1;b.h=a;return b}function O(a){var b=w("ANCHOR_VISIBILITY");b.aa=!0;b.ga=!1;b.A[0]=1;b.A[1]=1;b.h=a;return b}function L(a,
b){var c=w("DEPTH");c.h=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function F(a){var b=w("DEPTH_PACK");b.aa=!1;b.ga=!1;b.h=a;return b}function I(a,b,c){var d=w("SSAO");d.aa=!1;d.ga=!1;d.Bb=!1;d.h=a;d.A[0]=1;d.A[1]=1;d.Xb=b;d.$c=new Float32Array(b);d.xh=c.radius_increase;d.ssao_hemisphere=c.ry;d.wh=c.influence;d.vh=c.dist_factor;d.Hs=c.Lz;return d}function M(a,b){var c=w("SSAO_BLUR");c.aa=!1;c.ga=!1;c.Bb=!1;c.A[0]=1;c.A[1]=1;c.h=a;c.ssao_blur_depth=b.vv;c.ssao_blur_discard_value=
b.fp;return c}function R(){var a=w("ANTIALIASING");a.aa=!1;a.ga=!1;a.Bb=!1;a.pe=1/gb.resolution_factor;a.A[0]=1;a.A[1]=1;a.h=na.ib(na.pb);return a}function ca(a){var b=w(a);b.aa="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ga=!1;b.Bb=!1;b.pe=1/gb.resolution_factor;b.A[0]=1;b.A[1]=1;b.h=na.ib(na.pb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.Iy=new Float32Array(4));return b}function S(a,b,c,d){var e=w("COMPOSITING");e.aa=!1;e.ga=!1;e.Bb=!1;e.A[0]=1;e.A[1]=1;e.h=na.ib(na.pb);
e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function Y(a,b){var c=w("MOTION_BLUR");c.aa=!1;c.ga=!1;c.Bb=!1;c.h=na.ib(na.pb);c.ll=!0;c.ek=a;c.fk=b;return c}function W(a){var b=w("DOF");b.aa=!1;b.ga=!1;b.Bb=!1;b.A[0]=1;b.A[1]=1;b.h=a;b.pe=b.h.dof_power;return b}function ia(a){var b=w("OUTLINE_MASK");b.Bb=!1;b.A[0]=1;b.A[1]=1;b.h=a;return b}function ma(a){var b=w("OUTLINE");b.Ve.set(a.Ve);b.xi=a.xi;b.fm=5;b.tl=3;b.Bb=!1;b.h=na.ib(na.pb);return b}function P(){var a=w("REFRACT");a.aa=
!1;a.ga=!1;a.Bb=!1;a.h=na.ib(na.pb);return a}function u(a,b,c,d,e,f,g){var h=w("GOD_RAYS");h.aa=!1;h.ga=!1;h.Bb=!1;h.Oe=[1,1,1];h.sf=[1,1,1];h.Ke=1;h.Or=d;h.pf=b;h.zk=e;h.fh=c;h.Ah=g;h.h=a;h.bg=f;h.Tf=new Float32Array(3*f);h.Vf=new Float32Array(3*f);h.Sf=new Float32Array(3*f);h.A[0]=1;h.A[1]=1;h.Uf=new Float32Array(0==f%2?2*f:2*f+2);return h}function qa(a,b){var c=w("GOD_RAYS_COMBINE");c.aa=!1;c.ga=!1;c.Bb=!1;c.h=na.ib(na.pb);c.god_rays_intensity=a;c.bg=b;c.Tf=new Float32Array(3*b);c.Vf=new Float32Array(3*
b);c.Sf=new Float32Array(3*b);c.A[0]=1;c.A[1]=1;c.Uf=new Float32Array(0==b%2?2*b:2*b+2);return c}function ea(a,b){var c=w("SKY");c.enqueue=!1;c.aa=!1;c.ga=!1;c.Bb=!1;var d=na.ib(na.pb);d.width=Qa.Ee;d.height=Qa.Ee;c.h=d;c.Zh=Na.zx();c.bg=a;c.Tf=new Float32Array(3*a);c.Vf=new Float32Array(3*a);c.Sf=new Float32Array(3*a);c.Uf=new Float32Array(0==a%2?2*a:2*a+2);c.Oe=[1,1,1];c.sf=[1,1,1];c.Ke=1;c.th.set(b.th);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;
c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;c.A[0]=1;c.A[1]=1;return c}function ja(){var a=w("COPY");a.aa=!1;a.ga=!1;a.h=na.ib(na.pb);return a}function Z(){var a=w("ANAGLYPH");a.aa=!1;
a.ga=!1;a.h=na.ib(na.pb);return a}function oa(){var a=w("LUMINANCE");a.aa=!1;a.ga=!1;a.A[0]=1;a.A[1]=1;a.h=na.ib(na.pb);return a}function K(){var a=w("AVERAGE_LUMINANCE");a.aa=!1;a.ga=!1;a.A[0]=1;a.A[1]=1;a.h=na.ib(na.pb);return a}function U(a,b,c,d){var e=w("LUMINANCE_TRUNCED");e.aa=!1;e.ga=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.A[0]=1;e.A[1]=1;e.h=d;e.Tf=new Float32Array(3*c);e.Vf=new Float32Array(3*c);e.Sf=new Float32Array(3*c);e.Uf=new Float32Array(0==c%2?2*c:2*c+2);return e}function X(a){var b=
w("BLOOM");b.aa=!1;b.ga=!1;b.A[0]=1;b.A[1]=1;b.h=na.ib(na.pb);b.bloom_blur=a;return b}function sa(){var a=w("SINK");a.enqueue=!1;return a}function ra(a,b,c){if(b.type===c)return!0;b=J(a,b);for(var d=0;d<b.length;d++)if(ra(a,b[d],c))return!0;return!1}function fa(a,b,c){if(b.type===c)return!0;b=V(a,b);for(var d=0;d<b.length;d++)if(fa(a,b[d],c))return!0;return!1}function ha(a,b,c){if(b.type===c)return b;b=V(a,b);for(var d=0;d<b.length;d++){var e=ha(a,b[d],c);if(e)return e}return null}function V(a,b){var c=
Q.lh(a,b);if(c==Q.Bo)throw"Subscene not in graph";for(var d=[],e=Q.Oq(a,c),f=0;f<e;f++){var g=Q.Nj(a,c,f);g!=c&&d.push(Q.Sa(a,g))}return d}function J(a,b){var c=Q.lh(a,b);if(c==Q.Bo)throw"Subscene not in graph";for(var d=[],e=Q.nh(a,c),f=0;f<e;f++){var g=Q.Vg(a,c,f);g!=c&&d.push(Q.Sa(a,g))}return d}function aa(a){var b=[],c=[];r(a,function(a){a.qa&&-1==b.indexOf(a.qa)&&(b.push(a.qa),c.push(a.qa,b.length-1))});return c}function wa(a,b){var c;c=""+(a.L+"\\n");c+="NONE"!=a.da?a.da+"\\n":"";c+="(";if(a.Hh){var d=
a.ff;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.L){c+=" ";if(a.ug)c+="RR";else{var d=a.Y,e=a.X,f="";d==T.r?f+="L":d==T.Hd&&(f+="N");e==T.r?f+="L":e==T.Hd&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.qa&&(c+=" "+b[d+1])}return c+")\\n"}var na=p("__camera"),Ba=p("__config"),Ga=p("__debug"),Q=p("__graph"),Xa=p("__renderer"),T=p("__textures"),Na=p("__util");p("vec4");var ta=Ba.Ul,gb=Ba.o,Qa=Ba.Mi;a.Nv=function(a){switch(a.da){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;
default:return!0}};a.$A=r;a.uw=function(a,c,e){function f(b,e){var h=d(va[e]);c.G.push(h);h=H(b,h,!1,La,Xa,za,Ia,Fa,a.qg);l.push(h);Q.v(g,h);Q.l(g,J[e],h,n[e]);"XRAY"==b?h.ka.push(t("DEPTH","DEPTH",1,1,!0)):Q.l(g,J[e],h,r[e]);$a&&(Q.l(g,$a,h,Kb),Q.l(g,$a,h,Lb));if(yb){for(var k=0;k<w.length;k++)Q.l(g,w[k],h,fa[k]);var k=aa[e],m=t("COLOR","u_scene_depth",1,1,!0);m.Y=T.Hd;m.X=T.Hd;Q.l(g,k,h,m)}if(ha.length)for(m=ha.length/va.length,k=0;k<m;k++){var q=m*e+k;Q.l(g,ha[q],h,V[q])}if(Ba.length)for(k=0;k<
Ba.length;k++)Q.l(g,Ba[k],h,ra[k]);wa.length&&Q.l(g,wa[e],h,p[e]);return h}var g=Q.create(),J=[],l=[],aa=[],m=[],n=[],r=[],ha=[],V=[],wa=[],p=[],w=[],fa=[],Ba=[],ra=[],Xa=a.br,La=a.Wa,Mb=a.Bn,zb=a.gf,vc=a.Wg,ac=a.Sy,lb=a.wb,mc=a.Fg,wc=a.ih,jb=a.Jg,Ab=a.antialiasing,Ia=a.vo,za=a.Xb,Fa=a.ud,sb=a.Vy,eb=a.uv,Nb=a.Cv,Bb=a.ly,Cb=a.hz,tb=a.Ng,yb=a.Tw,Oa=Boolean(e.length),va=[];if(a.anaglyph_use&&!Oa){var mb=c.G[0],Ob=d(mb);na.lr(mb,na.qb);na.lr(Ob,na.zb);va.push(mb,Ob);c.G.push(Ob)}else{var pa=c.G[0];va.push(pa)}if(Mb){na.eo(va[0],
Fa);for(var pb=Fa.csm_num,ba=0;ba<pb;ba++){var ub=B(ba,Fa);Q.v(g,ub);w.push(ub);var Ya=Fa.csm_resolution,pa=ub.h;pa.width=Ya;pa.height=Ya;ub.aa=!1;fa.push(t("DEPTH","u_shadow_map"+ba,Ya,1,!1));(Ga.Iv()||gb.$p)&&ub.ka.push(t("COLOR","COLOR",Ya,1,!1))}}if(lb&&lb.ur&&!Oa)for(ba=0;ba<lb.ur;ba++){pa=na.ib(na.Lb);pa.width=Qa.Ee;pa.height=Qa.Ee;na.Ek(pa,90,.1,100);na.$e(pa,pa.ta);var Aa=H("CUBE_REFLECT",pa,!1,La,Xa,za,Ia,null,a.qg);Aa.Zh=Na.Dx();for(var xa=0;6>xa;xa++)Aa.Pl.push(na.mw());Q.v(g,Aa);var qb=
t("CUBEMAP","u_cube_reflection",Qa.Ee,1,!1);qb.Y=T.r;qb.X=T.r;var Vb=t("DEPTH","DEPTH",Qa.Ee,1,!1);ra.push(qb);Aa.ka.push(Vb);Ba.push(Aa);lb.Ej.push(Aa)}if(lb&&0<lb.Ak.length&&!Oa)for(ba=0;ba<va.length;ba++)for(xa=0;xa<lb.Ak.length;xa++)pa=d(va[ba]),pa.cc=new Float32Array(4),c.G.push(pa),Aa=H("PLANE_REFLECT",pa,!1,La,Xa,za,Ia,null,a.qg),Q.v(g,Aa),qb=t("COLOR","u_plane_reflection",1,gb.Hi,!0),qb.Y=T.r,qb.X=T.r,Vb=t("DEPTH","DEPTH",1,gb.Hi,!0),V.push(qb),Aa.ka.push(Vb),ha.push(Aa),lb.Ci.push(Aa);J=
[];l=[];if(a.kb){var $a=G();Q.v(g,$a);Ya=Qa.Oj;$a.h.width=Ya;$a.h.height=Ya;var Kb=t("DEPTH","u_grass_map_depth",Ya,1,!1);Kb.Y=T.r;Kb.X=T.r;var Lb=t("COLOR","u_grass_map_color",Ya,1,!1);Lb.Y=T.r;Lb.X=T.r}else Lb=Kb=$a=null;for(var Pb=[],xc=[],Qb=[],kb=[],ba=0;ba<va.length;ba++){var pa=va[ba],ab={};r.push(t("DEPTH","DEPTH",1,1,!0));if(yb){var hc=d(pa);c.G.push(hc);ab=L(hc,Fa);Q.v(g,ab);if(Mb){Qb.push(ab);for(xa=0;xa<w.length;xa++)ub=w[xa],Q.l(g,ub,ab,fa[xa]);var Fb=t("COLOR","u_color",1,1,!0),D=t("DEPTH",
"u_depth",1,1,!0);if(zb){var bc=d(pa);c.G.push(bc);var nb=a.HA,Db=I(bc,za,nb);Q.v(g,Db);var Gb=t("COLOR","u_ssao_mask",1,1,!0);Q.l(g,ab,Db,Fb);Q.l(g,ab,Db,D);var da=d(pa);c.G.push(da);var db=M(da,nb);Q.v(g,db);var Ma=t("COLOR","u_shadow_mask",1,1,!0);Q.l(g,Db,db,Gb);Q.l(g,ab,db,D)}var vb=d(hc);c.G.push(vb);var ua=F(vb);Q.v(g,ua);Q.l(g,ab,ua,t("DEPTH","u_depth",1,1,!0));aa.push(ua)}else aa.push(ab);$a&&(Q.l(g,$a,ab,Kb),Q.l(g,$a,ab,Lb))}Aa=H("OPAQUE",pa,!yb,La,Xa,za,Ia,null,a.qg);Q.v(g,Aa);l.push(Aa);
xc.push(Aa);yb&&(Q.l(g,ab,Aa,r[ba]),Gb?Q.l(g,db,Aa,Ma):Mb&&Q.l(g,ab,Aa,t("COLOR","u_shadow_mask",1,1,!0)));var Rb=t("COLOR","u_color",1,1,!0);n.push(t("COLOR","COLOR",1,1,!0));$a&&(Q.l(g,$a,Aa,Kb),Q.l(g,$a,Aa,Lb));if(ha.length)for(var Ja=ha.length/va.length,xa=0;xa<Ja;xa++){var $c=Ja*ba+xa;Q.l(g,ha[$c],Aa,V[$c])}if(Ba.length)for(xa=0;xa<Ba.length;xa++)Q.l(g,Ba[xa],Aa,ra[xa])}J=l;l=[];if(!Oa&&a.Uv){pa=d(J[0].h);c.G.push(pa);var Sa=z(pa,!1);Q.v(g,Sa);if(a.te){pa=d(J[0].h);c.G.push(pa);var nc=z(pa,!0);
Q.v(g,nc);Q.l(g,Sa,nc,t("COLOR","COLOR",1,1,!0));Q.l(g,Sa,nc,t("DEPTH","DEPTH",1,1,!0))}}else Sa=null;if(ac.rd&&!Oa)for(ba=0;ba<va.length;ba++){var yc=P();Q.v(g,yc);Q.l(g,J[ba],yc,Rb);wa.push(yc);p.push(t("COLOR","u_refractmap",1,1,!0))}if(a.zm){for(ba=0;ba<va.length;ba++)Aa=f("BLEND",ba),Pb.push(Aa);J=l;l=[]}if(a.Me){for(ba=0;ba<va.length;ba++){var Hc=d(va[ba]);c.G.push(Hc);var ic=H("GLOW",Hc,!1,La,Xa,za,Ia);Q.v(g,ic);Q.l(g,xc[ba],ic,r[ba]);var Hb=C("X_GLOW_BLUR");Hb.Ia="GLOW_MASK_SMALL";Hb.pe=a.Ne.small_glow_mask_width;
var Ta=t("COLOR","u_color",1,1,!0);Ta.Y=T.r;Ta.X=T.r;Q.v(g,Hb);Q.l(g,ic,Hb,Ta);var Ha=C("Y_GLOW_BLUR");Ha.Ia="GLOW_MASK_SMALL";Ha.pe=a.Ne.small_glow_mask_width;var ad=t("COLOR","u_color",1,.5,!0);ad.Y=T.r;ad.X=T.r;Q.v(g,Ha);Q.l(g,Hb,Ha,ad);var Ic=C("X_GLOW_BLUR");Ic.Ia="GLOW_MASK_LARGE";Ic.pe=a.Ne.large_glow_mask_width;var bd=t("COLOR","u_color",1,.5,!0);bd.Y=T.r;bd.X=T.r;Q.v(g,Ic);Q.l(g,Ha,Ic,bd);var cd=C("Y_GLOW_BLUR");cd.Ia="GLOW_MASK_LARGE";cd.pe=a.Ne.large_glow_mask_width;var Wb=t("COLOR","u_color",
1,.25,!0);Wb.Y=T.r;Wb.X=T.r;Q.v(g,cd);Q.l(g,Ic,cd,Wb);var dd=d(va[ba]);c.G.push(dd);var jc=y(dd,a);Q.v(g,jc);a.zm?Q.l(g,Pb[ba],jc,t("COLOR","u_src_color",1,1,!0)):Q.l(g,xc[ba],jc,t("COLOR","u_src_color",1,1,!0));var md=t("COLOR","u_glow_mask_small",1,.5,!0);md.Y=T.r;md.X=T.r;Q.l(g,Ha,jc,md);var cc=t("COLOR","u_glow_mask_large",1,.25,!0);cc.Y=T.r;cc.X=T.r;Q.l(g,cd,jc,cc);m.push(jc)}J=m;l=[]}if(!a.zm){for(ba=0;ba<va.length;ba++)Aa=f("BLEND",ba),Pb.push(Aa);J=l;l=[]}if(a.te){for(ba=0;ba<va.length;ba++){var nd=
f("XRAY",ba);kb.push(nd)}J=l;l=[]}if(gb.wireframe_debug){for(ba=0;ba<va.length;ba++){pa=Na.ya(va[ba]);c.G.push(pa);var dc=N(pa);l.push(dc);Q.v(g,dc);Q.l(g,J[ba],dc,n[ba]);Q.l(g,J[ba],dc,r[ba]);$a&&(Q.l(g,$a,dc,Kb),Q.l(g,$a,dc,Lb))}J=l;l=[]}if(!Oa&&a.Ku){pa=Na.ya(va[0]);c.G.push(pa);var Sb=O(pa);Q.v(g,Sb);Q.l(g,J[0],Sb,r[0])}if(vc&&yb&&!Oa){for(ba=0;ba<va.length;ba++){var rb=Bb.fh,ed=Bb.xy,oc=Bb.Ah,bb=J[ba],Xb=La?1:0,Jc=t("DEPTH","u_input",1,1,!0);Jc.Y=T.r;Jc.X=T.r;var zc=t("COLOR","u_input",1,.25,
!0);zc.Y=T.r;zc.X=T.r;var Tb=rb/oc,Ac=d(va[ba]);c.G.push(Ac);var Kc=u(Ac,Xb,rb,!0,Tb,Xa,oc);Q.v(g,Kc);Q.l(g,bb,Kc,Jc);var Tb=rb/oc*.5,Eb=d(va[ba]);c.G.push(Eb);var fd=u(Eb,Xb,rb,!1,Tb,Xa,oc);Q.v(g,fd);Q.l(g,Kc,fd,zc);var Tb=rb/oc*.25,gd=d(va[ba]);c.G.push(gd);var rd=u(gd,Xb,rb,!1,Tb,Xa,oc);Q.v(g,rd);Q.l(g,fd,rd,zc);var Bc=qa(ed,Xa);l.push(Bc);Q.v(g,Bc);Q.l(g,bb,Bc,t("COLOR","u_main",1,1,!0));Q.l(g,rd,Bc,t("COLOR","u_god_rays",1,1,!0))}J=l;l=[]}if(mc&&!Oa){for(ba=0;ba<va.length;ba++){var bb=J[ba],
Lc=oa();Q.v(g,Lc);Q.l(g,bb,Lc,t("COLOR","u_input",1,1,!0));var Mc=K();Q.v(g,Mc);Mc.h.width=1;Mc.h.height=1;var Ib=t("COLOR","u_input",1,.25,!0);Ib.Y=T.r;Ib.X=T.r;var od=t("COLOR","u_luminance",1,.25,!0);od.Y=T.r;od.X=T.r;Q.l(g,Lc,Mc,Ib);var ud=eb.key,sd=eb.Yw,pd=d(va[ba]);c.G.push(pd);var cb=U(ud,sd,Xa,pd);Q.v(g,cb);Q.l(g,bb,cb,t("COLOR","u_main",1,1,!0));Q.l(g,Lc,cb,od);Q.l(g,Mc,cb,t("COLOR","u_average_lum",1,1,!1));var Ub=t("COLOR","u_color",1,.25,!0);Ub.Y=T.r;Ub.X=T.r;Hb=q("X_BLUR");Q.v(g,Hb);
Q.l(g,cb,Hb,Ub);Ha=q("Y_BLUR");Q.v(g,Ha);Q.l(g,Hb,Ha,Ub);var Sc=X(eb.blur);Q.v(g,Sc);var Tc=t("COLOR","u_bloom",1,.25,!0);Tc.Y=T.r;Tc.X=T.r;Q.l(g,Ha,Sc,Tc);Q.l(g,bb,Sc,t("COLOR","u_main",1,1,!0));l.push(Sc)}J=l;l=[]}if(wc&&!Oa){for(ba=0;ba<J.length;ba++){var vd=J[ba],Uc=Y(sb.ek,sb.fk);l.push(Uc);Q.v(g,Uc);Q.l(g,vd,Uc,t("COLOR","u_mb_tex_curr",1,1,!0));Uc.ka.push(t("COLOR","u_mb_tex_accum",1,1,!0))}J=l;l=[]}if(tb&&yb&&!Oa){for(ba=0;ba<J.length;ba++){var bb=J[ba],pc=d(va[ba]);c.G.push(pc);Ub=t("COLOR",
"u_color",1,1,!0);Ub.Y=T.r;Ub.X=T.r;var qc=C("X_BLUR");Q.v(g,qc);Q.l(g,bb,qc,Ub);var rc=C("Y_BLUR");Q.v(g,rc);Q.l(g,qc,rc,Ub);var ab=Pb[ba],Vc=W(pc);pc.dof_distance=c.dof_distance;pc.Xd=c.Xd;pc.dof_front=c.dof_front;pc.dof_rear=c.dof_rear;pc.dof_power=c.dof_power;pc.dof_on=1;l.push(Vc);Q.v(g,Vc);Q.l(g,bb,Vc,t("COLOR","u_sharp",1,1,!0));Q.l(g,rc,Vc,t("COLOR","u_blurred",1,1,!0));Q.l(g,ab,Vc,t("DEPTH","u_depth",1,1,!0))}J=l;l=[]}if(!Oa&&a.outline){for(ba=0;ba<va.length;ba++){var bb=J[ba],Wc=d(va[ba]);
c.G.push(Wc);var hd=ia(Wc);Q.v(g,hd);var Cc=C("X_EXTEND"),Nc=t("COLOR","u_color",1,1,!0),Xc=t("COLOR","u_outline_mask",1,1,!0);Cc.qi=!0;Q.v(g,Cc);Q.l(g,hd,Cc,Nc);var wb=t("COLOR","u_color",1,.5,!0);wb.Y=T.r;wb.X=T.r;var Dc=C("Y_EXTEND");Dc.qi=!0;Q.v(g,Dc);Q.l(g,Cc,Dc,wb);qc=C("X_BLUR");qc.qi=!0;Q.v(g,qc);Q.l(g,Dc,qc,wb);var id=t("COLOR","u_color",1,.25,!0);id.Y=T.r;id.X=T.r;var Yb=t("COLOR","u_outline_mask_blurred",1,.25,!0);Yb.Y=T.r;Yb.X=T.r;rc=C("Y_BLUR");rc.qi=!0;Q.v(g,rc);Q.l(g,qc,rc,id);var Yc=
ma(Cb);Q.v(g,Yc);Q.l(g,bb,Yc,t("COLOR","u_outline_src",1,1,!0));Q.l(g,hd,Yc,Xc);Q.l(g,rc,Yc,Yb);l.push(Yc)}J=l;l=[]}if(jb&&!Oa){for(ba=0;ba<J.length;ba++){var bb=J[ba],Oc=S(Nb.brightness,Nb.contrast,Nb.exposure,Nb.saturation);Q.v(g,Oc);Q.l(g,bb,Oc,t("COLOR","u_color",1,1,!0));l.push(Oc)}J=l;l=[]}if(Ab){for(ba=0;ba<J.length;ba++)if(bb=J[ba],gb.smaa){var Zb=t("COLOR","u_color",1,1,!0);Zb.Y=T.r;Zb.X=T.r;var sc=ca("SMAA_EDGE_DETECTION");Q.v(g,sc);Q.l(g,bb,sc,Zb);var Pc=ca("SMAA_BLENDING_WEIGHT_CALCULATION");
Q.v(g,Pc);Q.l(g,sc,Pc,Zb);var la=t("COLOR","u_search_tex",1,1,!1),Ua=t("COLOR","u_area_tex",1,1,!1);la.Y=T.r;la.X=T.r;Ua.Y=T.r;Ua.X=T.r;Pc.ka.push(la);Pc.ka.push(Ua);var jd=ca("SMAA_NEIGHBORHOOD_BLENDING");Q.v(g,jd);Q.l(g,bb,jd,Zb);var tc=t("COLOR","u_blend",1,1,!0);tc.Y=T.r;tc.X=T.r;Q.l(g,Pc,jd,tc);l.push(jd)}else{var Ka=R();Q.v(g,Ka);var Wa=t("COLOR","u_color",1,1,!0);Wa.Y=T.r;Wa.X=T.r;Q.l(g,bb,Ka,Wa);if(1<gb.resolution_factor){var qd=C("NONE");Q.v(g,qd);Q.l(g,Ka,qd,Wa);l.push(qd)}else l.push(Ka)}J=
l;l=[]}if(a.anaglyph_use&&!Oa){var fb=Z();Q.v(g,fb);Q.l(g,J[0],fb,t("COLOR","u_sampler_left",1,1,!0));Q.l(g,J[1],fb,t("COLOR","u_sampler_right",1,1,!0));l.push(fb)}else l.push(J[0]);var kd=Q.lh(g,J[0]),Ec=!1;Q.re(g,kd,function(a,b,c){if(c.L==c.da)return Ec=!0});if(Ec){var ec=ja();Q.v(g,ec);Q.l(g,J[0],ec,t("COLOR","u_color",1,1,!0));J=l;l=[];l.push(ec)}Sa&&(nc?l.push(nc):l.push(Sa));Sb&&l.push(Sb);if(!Oa&&a.Ik.procedural_skydome){var Fc=ea(Xa,a.Ik);Q.v(g,Fc);l.push(Fc)}var $b=sa();Q.v(g,$b);for(ba=
0;ba<l.length;ba++){var fc=l[ba];switch(fc.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":Q.l(g,fc,$b,t("COLOR","NONE",1,1,!0));Q.l(g,fc,$b,t("DEPTH","NONE",1,1,!0));break;case "SKY":Q.l(g,fc,$b,t("CUBEMAP","u_sky",Qa.Ee,1,!1));break;case "ANCHOR_VISIBILITY":Q.l(g,fc,$b,t("COLOR","NONE",1,1,!0));break;default:if(Oa){var td=e[0].d,Qc=t("COLOR","OFFSCREEN",1,1,!0);Qc.qa=td;Q.l(g,l[ba],$b,Qc);for(xa=1;xa<e.length;xa++){var gc=e[xa].d,ec=ja();Q.v(g,ec);Q.l(g,l[ba],ec,t("COLOR","u_color",1,1,!0));
Qc=t("COLOR","OFFSCREEN",1,gc.og/td.og,!0);Qc.qa=gc;Q.l(g,ec,$b,Qc)}}else Q.l(g,l[ba],$b,t("SCREEN","NONE",1,1,!0))}}if(ta.enabled){var Zc=v(g);Zc&&E(g,Zc)}b(g,yb);1<gb.resolution_factor&&k(g);h(g);A(g);for(ba=0;ba<Qb.length;ba++)x(g,Qb[ba]);for(ba=0;ba<Pb.length;ba++)x(g,Pb[ba]);for(ba=0;ba<kb.length;ba++)x(g,kb[ba]);return g};a.ID=w;a.wc=function(a,b,c){var d=a.pe;a.Xn[0]=b*a.A[0]*d;a.Xn[1]=c*a.A[1]*d};a.Hb=function(a,b){a.pe=b};a.eD=function(a){var b=null;Q.S(a,function(a,c){return c.h&&null===
c.h.ae?(b=c,!0):!1});return b};a.Ea=function(a,b,c){a=V(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.AD=ra;a.qy=fa;a.rq=V;a.wD=J;a.Aa=function(a,b){var c=null;Q.S(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Jw=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=aa(a);Q.S(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==
d.type&&(f+=" ("+d.vk.replace(/_/g," ")+")");if(d.h){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.h.ab&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.h.Hc&&(f+="D"+c[g+1])}d.ka.length&&(f+="\\n-----\\n");for(g=0;g<d.ka.length;g++)f+=wa(d.ka[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});Q.qe(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+wa(e,c)+'" style="'+(e.Ka?"solid":"dotted")+
'"];\n'});return b+="}"};a.vw=function(a){a=Q.WA(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function d(){return{name:"",type:0,source:"",width:0,height:0,Jl:1,jj:!0,og:1024,Sp:!1,Qd:null,Ja:null,ph:null,ls:1,me:0,qh:!1,Uk:!1,Rf:!1,J:0,na:0,Rg:0,zB:!1,sg:!1,kn:0,Yb:0,Kb:0,Pa:null,of:null}}function b(b,e,f,g){var h=b.type,k=new Uint8Array([204,204,204,255]),l=d();switch(h){case "DATA_TEX2D":case "IMAGE":var m=q.createTexture(),n=q.TEXTURE_2D;q.bindTexture(n,m);q.texImage2D(n,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,k);b.image&&"MOVIE"==b.image.source&&(l.Rf=
!0,l.J=b.frame_start,l.na=b.frame_offset,l.Rg=b.frame_duration,l.zB=b.use_auto_refresh,l.sg=b.use_cyclic,l.kn=b.movie_length,0!=l.na&&A.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":m=q.createTexture();n=q.TEXTURE_2D;q.bindTexture(n,m);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(f=B.keysearch("name",b.b4w_source_id,f)))l.og=b.b4w_source_size,f.dd=f.dd||[],f.dd.push(b),
q.texImage2D(n,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":m=q.createTexture();n=q.TEXTURE_CUBE_MAP;q.bindTexture(n,m);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var r=0;6>r;r++)w.Lm?q.texImage2D(q["TEXTURE_CUBE_MAP_"+f[r]],0,q.RGB,1,1,0,q.RGB,q.UNSIGNED_BYTE,k):q.texImage2D(q["TEXTURE_CUBE_MAP_"+f[r]],0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,k);break;case "VORONOI":case "BLEND":return null;default:return A.error('texture "'+
b.name+'" has unsupported type "'+h+'"'),null}("NONE"!=h||b.b4w_enable_canvas_mipmapping&&"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=h?w.Lm&&"ENVIRONMENT_MAP"==h?q.texParameteri(n,q.TEXTURE_MIN_FILTER,q.LINEAR):q.texParameteri(n,q.TEXTURE_MIN_FILTER,y[w.Lk]):q.texParameteri(n,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(n,q.TEXTURE_MAG_FILTER,q.LINEAR);k=n;f=b.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=e);"OFF"!==f&&w.kj&&(e=E.Lx())&&(f=parseFloat(f.split("x")[0]),q.texParameterf(k,e.TEXTURE_MAX_ANISOTROPY_EXT,
f));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(q.texParameteri(n,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(n,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE)):(q.texParameteri(n,q.TEXTURE_WRAP_S,q.REPEAT),q.texParameteri(n,q.TEXTURE_WRAP_T,q.REPEAT));l.type=a.Ag;l.width=1;l.height=1;l.Pa=m;l.Kb=n;"CANVAS"==b.b4w_source_type&&"NONE"==h?(h=b.b4w_source_id,m=b.b4w_source_size,l.Sp=b.b4w_enable_canvas_mipmapping,l.name=h,l.source="CANVAS",n=document.createElement("canvas"),n.width=m,n.height=m,l.Qd=n.getContext("2d"),
g in G||(G[g]={}),G[g][h]=l,c(l)):"SCENE"==b.b4w_source_type&&"NONE"==h?(l.name=b.b4w_source_id,l.source="SCENE"):(l.name=b.name,l.source=h,q.generateMipmap(n),q.bindTexture(n,null));return b.d=l}function c(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Kb;q.bindTexture(b,a.Pa);var c=f(a),d=l(a),e=a.Qd.canvas;q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(b,0,c,c,d,e);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!1);a.Sp&&q.generateMipmap(b);q.bindTexture(b,null);a.width=e.width;a.height=e.height}
function e(a){var b=a.Kb;q.bindTexture(b,a.Pa);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(b,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.ph[a.me]);q.bindTexture(b,null)}function h(a){q.texParameteri(a,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(a,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.texParameteri(a,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(a,q.TEXTURE_MIN_FILTER,q.LINEAR)}function k(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}
function f(b){switch(b.type){case a.Ag:b=q.RGBA;break;case a.Zk:b=q.RGB;break;case a.ej:b=q.RGBA;break;case a.fj:b=q.RGB;break;case a.Nh:b=q.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function l(b){switch(b.type){case a.Ag:b=q.UNSIGNED_BYTE;break;case a.Zk:b=q.UNSIGNED_BYTE;break;case a.ej:b=q.FLOAT;break;case a.fj:b=q.FLOAT;break;case a.Nh:b=q.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function g(a,b){return b in C&&a in C[b]?(w.Nc?C[b][a].qh=!0:C[b][a].Ja.play(),
!0):null}function m(a,b){if(b in C&&a in C[b]){var c=C[b][a];w.Nc?(c.me=c.na,e(c),c.me++):c.Ja.currentTime=c.na/c.Yb;return!0}return null}function n(a,b){return b in C&&a in C[b]?(w.Nc?C[b][a].qh=!1:C[b][a].Ja.pause(),!0):null}var r=p("__config"),A=p("__print"),v=p("__dds"),E=p("__extensions"),B=p("__util"),w=r.o,t=r.Md,x=r.Wc;a.Hd=0;a.r=0;a.Au=0;a.yu=0;a.zu=0;a.xu=0;a.Ag=10;a.Zk=20;a.ej=30;a.fj=40;a.Nh=50;a.zg=60;var G={},C={},q=null,y;a.Vc=function(b){y=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,
b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.Hd=b.NEAREST;a.r=b.LINEAR;a.Au=b.NEAREST_MIPMAP_NEAREST;a.yu=b.LINEAR_MIPMAP_NEAREST;a.zu=b.NEAREST_MIPMAP_LINEAR;a.xu=b.LINEAR_MIPMAP_LINEAR;q=b};a.Px=function(a,b){return b in G&&a in G[b]?G[b][a].Qd:null};a.kB=function(a,b){return b in G&&a in G[b]?(c(G[b][a]),!0):!1};a.Dj=function(b,c){var e=d();e.name=b;e.type=c;e.source="NONE";if(c==a.zg)e.of=q.createRenderbuffer();else{var f=q.TEXTURE_2D,g=q.createTexture();q.bindTexture(f,g);q.texParameteri(f,
q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(f,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(f,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(f,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.bindTexture(f,null);e.Kb=f;e.Pa=g}return e};a.jw=function(b){var c=q.createTexture(),e=q.TEXTURE_CUBE_MAP;q.bindTexture(e,c);q.texParameteri(e,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(e,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(e,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(e,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);
for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)q.texImage2D(q[f[g]],0,q.RGBA,b,b,0,q.RGBA,q.UNSIGNED_BYTE,null);q.bindTexture(e,null);e=d();e.name="CUBEMAP";e.type=a.Ag;e.source="NONE";e.width=3*b;e.height=2*b;e.Jl=1;e.Pa=c;e.Kb=q.TEXTURE_CUBE_MAP;return e};a.En=function(b,c,d){if(b.type!=a.zg){var e=b.Kb;q.bindTexture(e,b.Pa);c&&q.texParameteri(e,
q.TEXTURE_MIN_FILTER,c);d&&q.texParameteri(e,q.TEXTURE_MAG_FILTER,d);q.bindTexture(e,null)}};a.vD=function(b){if(b.type==a.zg)return{min:a.Hd,Oy:a.Hd};var c=b.Kb;q.bindTexture(c,b.Pa);b=q.getTexParameter(c,q.TEXTURE_MIN_FILTER);var d=q.getTexParameter(c,q.TEXTURE_MAG_FILTER);q.bindTexture(c,null);return{min:b,Oy:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.zg)q.bindRenderbuffer(q.RENDERBUFFER,b.of),q.renderbufferStorage(q.RENDERBUFFER,q.DEPTH_COMPONENT16,
c,d),q.bindRenderbuffer(q.RENDERBUFFER,null);else{var e=b.Kb;q.bindTexture(e,b.Pa);var g=f(b),h=l(b);q.texImage2D(e,0,g,c,d,0,g,h,null);q.bindTexture(e,null)}c>w.od||d>w.od?A.error('Slink texture "'+b.name+'" has unsupported size'):(b.width=c,b.height=d)}};a.Dw=b;a.wB=function(a){var b=a.Kb;q.bindTexture(b,a.Pa);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Ja.length?q.texImage2D(b,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.Ja):q.texImage2D(b,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,a.Ja);q.bindTexture(b,null)};
a.tB=e;a.Ri=function(a,b,c,d,e){var f=a.source,g=a.Kb;q.bindTexture(g,a.Pa);if(4==b.length){var l=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==f)if(l)q.texImage2D(g,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=v.zq(b);if(c.width>w.od||c.height>w.od){A.error("texture has unsupported size",d);return}v.yB(q,E.vq(),b,!0);k(c.width,c.height)&&(a.$o||A.warn("using NPOT texture",d),h(g));a.width=c.width;a.height=c.height;a.Jl=v.Rx(b)}else{q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,
!0);if(b.width>w.od||b.height>w.od){A.error("texture has unsupported size",d);return}a.Rf?w.Nc?b&&(e in C||(C[e]={}),C[e][a.name]=a,a.ph=b,a.Yb=a.kn/b.length,a.Rg=Math.round(a.Rg/a.Yb),a.na=Math.round(a.na/a.Yb),a.J=Math.round(a.J/a.Yb),a.me=a.na,q.texImage2D(g,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.ph[0])):(a.Ja=b,a.Ja.loop=a.sg,b&&(e in C||(C[e]={}),C[e][a.name]=a),a.Yb=t.Fa,b.duration&&(a.Yb=a.kn/b.duration),x.Pp||(b.playbackRate=t.Fa/a.Yb,x.up&&2<b.playbackRate&&(b.playbackRate=2)),q.texImage2D(g,
0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.Ja)):q.texImage2D(g,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,b);w.Nc&&a.Rf?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);k(b.width,b.height)?(a.$o||(a.Rf?A.warn("using NPOT video texture",d):A.warn("using NPOT texture",d)),h(g)):a.Rf||q.generateMipmap(g)}else if("ENVIRONMENT_MAP"==f)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],l){for(l=0;6>l;l++)e=c[l],q.texImage2D(q["TEXTURE_CUBE_MAP_"+
e[0]],0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!1);f=b.width/3;if(f>w.en||f>w.en){A.error("cubemap has unsupported size",d);return}for(l=0;6>l;l++){e=c[l];var m=document.createElement("canvas");m.width=f;m.height=f;var n=m.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(n.translate(0,f),n.scale(1,-1)):(n.translate(f,0),n.scale(-1,1));n.drawImage(b,e[1]*f,e[2]*f,f,f,0,0,f,f);q.texImage2D(q["TEXTURE_CUBE_MAP_"+e[0]],0,q.RGBA,q.RGBA,
q.UNSIGNED_BYTE,m)}a.width=3*f;a.height=2*f;k(b.width/3,b.height/2)?(A.warn("using NPOT cube map texture",d),h(g)):q.generateMipmap(g)}else"DATA_TEX2D"==f&&(q.texImage2D(g,0,q.RGBA,b.width,b.height,0,q.RGBA,q.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);q.bindTexture(g,null)};a.Sw=function(a){q.deleteTexture(a)};a.ri=function(a){return a&&a.name&&(a.Pa||a.of)?!0:!1};a.Vq=function(a){return a&&a.name&&a.of?!0:!1};a.ND=function(b){return b.type==a.ej||b.type==a.fj?!0:!1};a.gy=function(b){var c=
0;switch(b.type){case a.Ag:case a.Zk:c=4;break;case a.ej:case a.fj:c=16;break;case a.Nh:c=3;break;case a.zg:c=2}return c};a.Hx=function(a){var c=null,c={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,a,0);c.image={filepath:null};return c};a.cleanup=function(){if(!w.Nc)for(var a in C)for(var b in C[a])C[a][b].Ja.pause(),C[a][b].Ja.src="",C[a][b].Ja.load();G={};C={}};a.play_video=g;a.reset_video=m;a.pause_video=n;a.pause=function(){for(var a in C)for(var b in C[a])w.Nc&&
!C[a][b].qh||!w.Nc&&C[a][b].Ja.paused||(n(b,a),C[a][b].Uk=!0)};a.reset=function(){for(var a in C)for(var b in C[a])m(b,a),C[a][b].Uk=!1};a.play=function(a){for(var b in C)for(var c in C[b])if(!a||C[b][c].Uk)g(c,b),C[b][c].Uk=!1}};b4w.module.__assets=function(a,p){function d(){return v.Uq()?p(v.Sb.sj).data:null}function b(){var a={gj:null,Hu:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.gj=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=d();b&&a.gj in b&&(a.status=200,b[a.gj]&&(a.response=a.Hu(b[a.gj])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function c(b){for(var c=0,d=0;d<b.length;d++){var m=b[d];20===m.state&&c++;if(c>=G.Ty)break;if(10===m.state)switch(m.state=20,c++,m.type){case a.AT_ARRAYBUFFER:e(m,"arraybuffer");break;case a.AT_JSON:e(m,"json");break;case a.AT_TEXT:e(m,"text");break;case a.AT_AUDIOBUFFER:h(m);break;case a.AT_IMAGE_ELEMENT:k(m);
break;case a.AT_AUDIO_ELEMENT:f(m);break;case a.aj:l(m);break;case a.$i:g(m);break;default:w.oa("Wrong asset type: "+m.type)}}}function e(a,c){var e=d(),f=e&&a.q in e?new b:new XMLHttpRequest;f.open("GET",a.q,!0);"text"==c?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==c?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=c;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==c&&
"string"==typeof b)try{b=JSON.parse(b)}catch(d){a.hb(null,a.uri,a.type,a.q,a.nb);E.error(d+" (parsing JSON "+a.q+")");return}a.hb(b,a.uri,a.type,a.q,a.nb)}else a.hb(null,a.uri,a.type,a.q,a.nb),E.error("empty responce when trying to get "+a.q)}else a.hb(null,a.uri,a.type,a.q,a.nb),E.error(f.status+" when trying to get "+a.q);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Yr(b.loaded/b.total)},!1);f.send(null)}function h(a){var c=d(),e=c&&a.q in c?new b:new XMLHttpRequest;
e.open("GET",a.q,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?B.Nw(b,function(b){a.hb(b,a.uri,a.type,a.q,a.nb);a.state=30},function(){a.hb(null,a.uri,a.type,a.q,a.nb);E.error("failed to decode "+a.q);a.state=30}):(a.hb(null,a.uri,a.type,a.q,a.nb),E.error("empty responce when trying to get "+a.q),a.state=30)}else a.hb(null,a.uri,a.type,a.q,a.nb),E.error(e.status+" when trying to get "+a.q),a.state=
30};e.send(null)}function k(a){var b=document.createElement("img");C.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.hb(b,a.uri,a.type,a.q,a.nb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.hb(null,a.uri,a.type,a.q,a.nb),E.error("could not load image: "+a.q),a.state=30)},!1);var c=d();if(c&&a.q in c)if(c[a.q]){var e=n(a.q);b.src="data:"+e+";base64,"+c[a.q]}else x.Nm()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=
new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.q}function f(a){var b=document.createElement("audio");C.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.hb(b,a.uri,a.type,a.q,a.nb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.hb(null,a.uri,a.type,a.q,a.nb),E.error("could not load sound: "+a.q),a.state=30)},!1);var c=d();if(c&&a.q in c)if(c[a.q]){var e=r(a.q);b.src="data:"+e+";base64,"+c[a.q];40!=a.state&&(a.hb(b,
a.uri,a.type,a.q,a.nb),a.state=30)}else x.Nm()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.q,C.Qf&&b.load();setTimeout(function(){b.tA=1},5E3)}function l(a){function b(){40!=a.state&&(a.hb(null,a.uri,a.type,a.q),E.error("could not load video: "+a.q,a.nb),a.state=30)}var c=document.createElement("video");c.muted=!0;if(C.allow_cors||C.Qf)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",
b,!1);40!=a.state&&(a.hb(c,a.uri,a.type,a.q,a.nb),a.state=30)},!1);c.addEventListener("error",b,!1);var e=d();if(e&&a.q in e)if(e[a.q]){var f=A(a.q);c.src="data:"+f+";base64,"+e[a.q];40!=a.state&&(a.hb(c,a.uri,a.type,a.q,a.nb),a.state=30)}else x.Nm()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),c.dispatchEvent(e);else c.src=a.q,C.Qf&&c.load();setTimeout(function(){c.tA=1},1E4)}function g(a){function c(b){a.hb(b,a.uri,a.type,a.q,a.nb)}var e=
d(),f=e&&a.q in e?new b:new XMLHttpRequest;f.open("GET",a.q,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;b?m(b,c):(a.hb(null,a.uri,a.type,a.q,a.nb),E.error("empty responce when trying to get "+a.q))}else a.hb(null,a.uri,a.type,a.q,a.nb),E.error(f.status+" when trying to get "+a.q);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Yr(b.loaded/b.total)},!1);f.send(null)}function m(a,
b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],ep:[],Yb:c[4]},g=20,h=0;h<e;h++){var l=c[g/4],k=new Blob([d.subarray(g+4,g+4+l)],{type:"image/jpg"}),m=document.createElement("img");m.src=window.URL.createObjectURL(k);f.images.push(m);f.ep.push(k);g+=l+8-l%4}m.onload=function(){for(var a=0;a<f.images.length;a++)window.URL.revokeObjectURL(f.images[a].src);delete f.ep;b(f)}}function n(a){var b="image";switch(w.vm(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+=
"/png"}return b}function r(a){var b="audio";switch(w.vm(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function A(a){var b="video";switch(w.vm(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var v=p("__config"),E=p("__print"),B=p("__sfx"),w=p("__util"),t=p("__version"),x=p("__compat"),G=v.Nd,C=v.o;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=
30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.aj=70;a.$i=80;var q=[],y=0,H={};a.Oi=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.fy=function(a){if(H[a])return H[a];var b=G.Wr?a+t.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return H[a]=b;w.oa("Error XHR: responce is empty, GET "+a)}else w.oa("Error XHR: "+
c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<q.length;a++)q[a].state=40;q=[];y=0;H={}};a.enqueue=function(a,b,e,f){for(var g=0;g<a.length;g++){var h=a[g],h={uri:h[0],type:h[1],q:h[2],nb:h[3],state:10,hb:b||function(){},Pr:e||function(){},Yr:f||function(){},Qr:y};if(G.Wr){var l=d();l&&h.q in l||(h.q+=t.timestamp())}q.push(h)}c(q);y++};a.update=function(){c(q);for(var a=q,b=0,d=!0,e=0;e<a.length;e++){var f=a[e];f.Qr===a[b].Qr?30!==f.state&&(d=!1):(d&&(a[e-1].Pr(),d=e-b,a.splice(b,d),e-=
d),b=e,d=30===a[e].state?!0:!1);e===a.length-1&&d&&(a[e].Pr(),a.splice(b))}}};b4w.module.__loader=function(a,p){function d(c,d,e,f){var g=w,h=v.create(),l;for(l in d){var k=b(d[l]);(f&&k.cb||!c&&k.vb)&&n(k);v.v(h,k)}for(l in d)for(k=d[l],k.name=l,c=0;c<k.K.length;c++)v.l(h,d[k.K[c]],k,null);d=b({name:"out",Na:a.tt,$a:function(a,b,c,d,e){0===b.id&&(g.Pn=!0);A(b)||(b.status=2);b.jr(b.id,!0);e(b,c);E.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},eb:5});var m=[];if(e)for(e=v.xq(h),c=0;c<e.length;c++)m.push(v.Sa(h,e[c]));else v.S(h,function(a,b){b.Ya||m.push(b)});v.v(h,
d);for(c=0;c<m.length;c++)d.K.push(m[c].name),v.l(h,m[c],d,null);return h}function b(a){a.Ya=a.Ya||!1;a.Na||0===a.Na||(a.Na=a.cd);a.K=a.K||[];a.pi=a.pi||!1;a.Hn=a.Hn||!1;a.eb=a.eb||0;a.cb=a.cb||!1;a.vb=a.vb||!1;a.status=0;a.XD=0;a.Ym=0;a.Df=a.Df||null;return a}function c(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];v.Sa(a.yd,f).pi&&(v.lf(a.yd,f,function(d){var e=!0;v.re(a.yd,d,function(a,b){if(!b.pi)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function e(a){function b(c,d){var e=v.Sa(a.yd,c),f=v.Sa(a.yd,d),g=f.Na-e.Na;0==g&&(g=e.Ya-f.Ya);return g}var d=[],e=a.oe,f=!1;do{var g=c(a,e);d.push.apply(d,e);0<g.length&&(f=!0);e=g}while(0<g.length);f&&d.sort(b);a.oe=d;return a.oe.length}function h(a,b,c){if(b.Hn)return b.pi=!0,f(a,b),!1;if(!b.$a&&!b.Cf&&!b.Vh)return f(a,b),!1;if(0==b.status&&(b.status++,b.$a))return b.$a(c,a,b,b.Df,f,l),!0;if(1==b.status){if(b.Cf)return b.Cf(c,a,b,b.Df,f,l),!0;b.status++}return 2==
b.status&&(b.status++,b.Vh)?(b.Vh(c,a,b,b.Df,f,l),!0):!1}function k(a){if(0==a.Jk)return 100;var b=0;v.S(a.yd,function(c,d){a.do_not_load_resources&&d.cb||(b+=d.Ym*d.eb)});return B.trunc(100*b/a.Jk)}function f(a,b){b.pi=!0;b.status=3;g(a,b,1)}function l(a,b,c){1>c?g(a,b,c):b.status++}function g(a,b,c){var d=w;if(b.$a||b.Cf||b.Vh)if(b.Ym=c,b=k(a),a.Jp!=b||1==c)a.Nn(b,performance.now()-a.Ts),a.Jp=b,d.bn=!0}function m(a,b){var c=null;v.S(a.yd,function(a,d){if(d.name==b)return c=d,1});return c}function n(a){a.Hn=
!0;a.Ym=1}function r(a){a.Nn=null;a.Il=null;a.yd=null;a.oe=null}function A(a){return a&&(3==a.status||4==a.status)}var v=p("__graph"),E=p("__print"),B=p("__util");a.cd=0;a.ve=1;a.tt=2;var w=null;a.wq=function(){return w};a.ww=function(){var a={Bd:[],Sl:0,ij:0,Pn:!1,bn:!1};return w=a};a.Ew=function(a,b,c,e,f,g,h,l){var k=w,m={id:k.Bd.length,status:0,q:b,bp:"",jr:c||function(){},Xm:l||!1,AE:g,Ts:0,Jp:0,Jk:0,Cn:!1,Nn:e||function(){},Il:f||function(){},yd:null,oe:null,Gm:!1,Fm:!1,Jm:!1};a=d(0===m.id,
a,g,h);m.yd=a;b=[];c=v.dy(a);for(e=0;e<c.length;e++)b.push(c[e]);m.oe=b;v.S(a,function(a,b){!(b.$a||b.Cf||b.Vh)||m.do_not_load_resources&&b.cb||(m.Jk+=b.eb)});k.Bd.push(m);k.ij++;return m.id};a.sB=function(b){var c=w;if(c&&0!=w.ij)if(c.bn)c.bn=!1;else{var d=performance.now();do{var f=c.Bd[c.Sl],g=b[f.id];if(!A(f))if(0==f.status&&(f.status=1,f.Ts=performance.now(),f.Nn(0,0)),e(f)){var l=f,k=l.oe.length;do{var m=v.Sa(l.yd,l.oe[0]),n=h(l,m,g);m.Na==a.ve&&(l.Cn=!0);m=l.oe.shift();l.oe.push(m);k--}while(!n&&
0!=k)}else l=c,k=f,k.Il(g,k),k.status=3,l.ij--,r(k);c.Pn&&(c.Sl=(c.Sl+1)%c.Bd.length);if(f.Cn){f.Cn=!1;break}}while(16>performance.now()-d)}};a.Ko=function(a){var b=w;a.Il(null,a);a.status=3;b.ij--;r(a);a.status=4;0===a.id&&(b.Pn=!0);a.jr(a.id,!1)};a.rE=l;a.us=function(a,b){var c=m(a,b);null!==c&&n(c)};a.VA=A;a.is_primary_loaded=function(a){var b=w;if(!b)return!1;a|=0;return b.Bd[a]&&(3==b.Bd[a].status||2==b.Bd[a].status)};a.cleanup=function(){w=null}};b4w.module.__nla=function(a,p){function d(){return{type:"CLIP",J:0,W:0,le:!1,paused:!1,vf:"",Sh:"",Db:0,Qh:0,Ph:0,Vp:0,Up:0,Bh:!1,ft:!1,scale:1,repeat:1}}function b(a,c){if(a.animation_data){var d=a.animation_data.nla_tracks;if(d)for(var e=0;e<d.length;e++)c.push(d[e])}d=a.nodes;for(e=0;e<d.length;e++){var f=d[e];f.node_group&&(f=f.node_group.node_tree)&&b(f,c)}}function c(a,b){for(var c=a.b4w_nla_script,d=b.Ye,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",J:f.frame_range[0],
W:f.frame_range[1],Qe:!1});break;case "SELECT":case "SELECT_PLAY":var g=B.md(B.tf,f.object,0),h=B.cy(a),l=h.indexOf(g);if(-1==l){E.error("NLA script error: non-selectable object");return}for(var f={type:f.type,zs:"SELECT"==f.type?f.target_slot:e+1,rA:e+1,Ze:-1,Rz:h.length,Qz:l,J:f.frame_range[0],W:f.frame_range[1],Qe:!1},l=[],k=0;k<h.length;k++)l.push(A.create_selection_sensor(h[k],!0));A.create_sensor_manifold(g,"NLA_SELECT_"+e,A.CT_SHOT,l,A.Ow,function(a,c,d,e){if(!(b.Ab>=b.Ye.length)&&(d=b.Ye[b.Ab],
"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.Qe)){for(d=0;d<e.Rz;d++)if(A.get_sensor_value(a,c,d)&&d==e.Qz){e.Ze=1;return}e.Ze=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",Jn:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",Jn:f.target_slot,Xv:f.condition,Ii:f.register1,Ji:f.register2,pn:f.number1,qn:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",xz:f.registerd,ez:f.number1});break;case "MATH":d.push({type:"MATH",gz:f.operation,Ii:f.register1,Ji:f.register2,pn:f.number1,
qn:f.number2,oh:f.registerd});break;case "SHOW":case "HIDE":g=B.md(B.tf,f.object,0);d.push({type:f.type,obj:g});break;case "REDIRECT":d.push({type:"REDIRECT",url:f.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",iz:f.param_name,oh:f.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function e(a,b,c,d){if(a.Ye.length){if(a.Ab>=a.Ye.length)if(a.cyclic)a.Ab=0;else{a.na-=G.Fa*c;return}var f=k(a,b,!1,d),g=a.Ye[a.Ab];switch(g.type){case "PLAY":g.Qe?f>=g.W&&(g.Qe=!1,a.Ab++,e(a,b,c,d)):(a.na+=g.J-
f,g.Qe=!0,h(a,g));break;case "SELECT":case "SELECT_PLAY":-1<g.Ze?"SELECT"==g.type||"SELECT_PLAY"==g.type&&0==g.Ze?(a.Ab=g.Ze?g.zs:g.rA,g.Ze=-1,e(a,b,c,d)):g.Qe?f>=g.W&&(g.Qe=!1,a.Ab=g.zs,g.Ze=-1,e(a,b,c,d)):(a.na+=g.J-f,g.Qe=!0,h(a,g)):a.na-=G.Fa*c;break;case "JUMP":a.Ab=g.Jn;e(a,b,c,d);break;case "CONDJUMP":var f=-1==g.Ii?g.pn:a.sd[g.Ii],l=-1==g.Ji?g.qn:a.sd[g.Ji],m=!1;switch(g.Xv){case "EQUAL":f==l&&(m=!0);break;case "NOTEQUAL":f!=l&&(m=!0);break;case "LESS":f<l&&(m=!0);break;case "GREATER":f>l&&
(m=!0);break;case "LEQUAL":f<=l&&(m=!0);break;case "GEQUAL":f>=l&&(m=!0)}m?a.Ab=g.Jn:a.Ab++;e(a,b,c,d);break;case "REGSTORE":a.sd[g.xz]=g.ez;a.Ab++;e(a,b,c,d);break;case "MATH":f=-1==g.Ii?g.pn:a.sd[g.Ii];l=-1==g.Ji?g.qn:a.sd[g.Ji];switch(g.gz){case "ADD":a.sd[g.oh]=f+l;break;case "MUL":a.sd[g.oh]=f*l;break;case "SUB":a.sd[g.oh]=f-l;break;case "DIV":0==l&&t.oa("Division by zero in NLA script"),a.sd[g.oh]=f/l}a.Ab++;e(a,b,c,d);break;case "SHOW":B.show_object(g.obj);a.Ab++;e(a,b,c,d);break;case "HIDE":B.hide_object(g.obj);
a.Ab++;e(a,b,c,d);break;case "REDIRECT":window.location.href=g.url;a.Ye.length=0;break;case "PAGEPARAM":a:{f=location.href.toString();if(-1!=f.indexOf("?"))for(f=f.split("?")[1].split("&"),l=0;l<f.length;l++)if(m=f[l].split("="),1<m.length&&m[0]==g.iz){f=Number(m[1]);break a}f=0}a.sd[g.oh]=f;a.Ab++;e(a,b,c,d);break;case "NOOP":a.Ab++,e(a,b,c,d)}}}function h(a,b){for(var c=a.Ye,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.Ze=-1)}}function k(a,b,c,d){b=(b-d)*G.Fa+a.na-a.J;a.cyclic&&c&&(b%=a.W-a.J+1);return b+=
a.J}function f(a,b){a=t.clamp(a,b.J,b.W);var c=a-b.J,d=(b.W-b.J)/b.repeat,c=c/d&&0==c%d?b.Ph:b.Qh+c%d/b.scale;b.ft&&(c=b.Ph-c+b.Qh);return c}function l(a,b,c){b?x.pause_video(a.name,c):(x.reset_video(a.name,c),x.play_video(a.name,c))}function g(a,b){for(var c=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],l=d();l.type=h.type;l.J=h.frame_start;l.W=h.frame_end;l.Db=b;l.Qh=h.action_frame_start;l.Ph=h.action_frame_end;l.ft=h.use_reverse;l.scale=h.scale;l.repeat=h.repeat;
h.action&&(l.vf=h.action.name,l.Sh=h.action.uuid);c.push(l)}}return c}function m(a){return w.ee(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var n=p("__animation"),r=p("__camera"),A=p("__controls"),v=p("__config");p("__loader");var E=p("__print"),B=p("__scenes"),w=p("__sfx"),t=p("__util"),x=p("__textures"),G=v.Md,C=v.o,q=[],y=-1;a.rB=function(a,e,f){e={J:a.frame_start,W:a.frame_end,na:0,si:-1,nc:f,cyclic:e,ie:[],M:[],Ye:[],Zj:!1,om:!1,kE:a.name,Ab:0,sd:{R1:0,R2:0,R3:0,
R4:0,R5:0,R6:0,R7:0,R8:0}};a.Xa=e;c(a,e);for(var h=B.Ga(a,"ALL",B.DATA_ID_ALL),l=0;l<h.length;l++){var k=h[l],A=0,v=[];if((f=k.animation_data)&&f.nla_tracks.length){var p=f.nla_tracks;if(t.is_armature(k)||r.is_camera(k)||t.is_mesh(k)||t.Wj(k)||w.ee(k))p=g(p,A),p.length&&(v=v.concat(p),A++)}m(k)&&(p=k.data.animation_data.nla_tracks,p=g(p,A),p.length&&(v=v.concat(p),A++));if(n.Iq(k)){var x=k.data.materials;for(f=0;f<x.length;f++){var y=x[f].node_tree;if(y&&(p=[],b(y,p),p=g(p,A),p.length)){for(var y=
A,G=p,W=n.kq(),ia=[],ma=0,P=0;P<G.length;P++){var u=G[P];""!=u.Sh?u=t.keysearch("uuid",u.Sh,W):(u=u.vf,u=t.keysearch("name",u,W)||t.keysearch("name",u+"_B4W_BAKED",W));var u=u.fcurves,qa=[],ea;for(ea in u)qa.push(ea);ia.push(qa)}for(P=0;P<ia.length;P++){W=!1;for(u=0;u<P;u++)if(t.hv(ia[P],ia[u])){G[P].Db=G[u].Db;W=!0;break}W||(G[P].Db=A+ma++)}A=y+ma;v=v.concat(p)}}}for(f=0;f<k.particle_systems.length;f++)p=k.particle_systems[f],x=p.settings,"EMITTER"==x.type&&x.b4w_allow_nla&&(x=d(),x.type="CLIP",
x.J=e.J,x.W=e.W+1,x.vf=p.name,x.Db=A,x.Qh=x.J,x.Ph=x.W,v.push(x),A++);p=A+1;if(t.is_mesh(k)&&k.data)for(f=0;f<k.data.b4w_vertex_anim.length;f++)y=k.data.b4w_vertex_anim[f],y.allow_nla&&(A=p,x=d(),x.type="CLIP",x.J=e.J,x.W=e.W+1,x.vf=y.name,x.Db=A,x.Qh=x.J,x.Ph=x.W,v.push(x));v.length&&(k.$k=v,e.ie.push(k))}a=a.d.Ih;for(f=0;f<a.length;f++)if(ea=a[f].d,ea.Ja||ea.ph)x=d(),x.type="VIDEO",h=1,C.Nc&&(h=ea.Yb),x.J=Math.min(ea.J*h,e.W),x.W=ea.sg?e.W:Math.min((ea.Rg+ea.J+ea.na)*h,e.W),x.vf=a[f].name,ea.Fu=
x,e.M.push(ea);a=e.J;f=e.W;for(ea=0;ea<e.ie.length;ea++)for(h=e.ie[ea],l=h.$k,k=0;k<l.length;k++)v=l[k],x=h.name+" ["+v.J+":"+v.W+"]",v.J=Math.max(a,v.J),v.W=Math.min(f+1,v.W),v.J>v.W?(E.warn("NLA: out of scene range: "+x),l.splice(k,1),k--):v.vf||"CLIP"!=v.type||(E.warn('NLA: no action in strip for object "'+h.name+'".'),l.splice(k,1),k--);for(a=0;a<e.ie.length;a++)for(f=e.ie[a].$k,ea=0;ea<f.length;ea++){h=f[ea];l=e.J;k=e.W+1;for(v=0;v<f.length;v++)x=f[v],h.Db==x.Db&&(x.W<=h.J&&(l=h.J),x.J>=h.W&&
(k=Math.min(k,x.J)));h.Vp=l;h.Up=k}q.push(e)};a.start=function(){y=0};a.update=function(a,b){if(!(0>y)){0==y&&(y=a);for(var c=0;c<q.length;c++){var d=q[c];if(d.Zj&&!d.om)d.na-=G.Fa*b;else{e(d,a,b,y);for(var g=k(d,a,!0,y),h=0;h<d.ie.length;h++){for(var m=d.ie[h],r=m.$k,t=0;t<r.length;t++){var A=r[t];"SOUND"==A.type&&g<d.si-1E-6&&(A.le=!1)}for(t=0;t<r.length;t++)switch(A=r[t],A.type){case "CLIP":if(A.Vp<=g&&g<A.Up&&!A.le){var v=m,p=A;""!=p.Sh?n.av(v,p.Sh,p.Db):n.apply(v,p.vf,p.Db);n.set_behavior(v,
n.AB_FINISH_STOP,p.Db);var x=f(p.J,p);n.set_current_frame_float(v,x,p.Db);for(v=0;v<r.length;v++)r[v]!=A&&r[v].Db==A.Db&&(r[v].le=!1);A.le=!0}A.le&&(v=m,p=f(g,A),x=n.get_current_frame_float(v,A.Db),1E-6<Math.abs(p-x)&&n.set_current_frame_float(v,p,A.Db));break;case "SOUND":(g<d.si-1E-6||d.si<A.J)&&A.J<=g&&g<A.W&&!A.le&&(w.play(m,(A.J-g)/G.Fa,(A.W-A.J)/G.Fa),A.le=!0),d.si<A.W&&A.W<=g&&A.le&&(A.le=!1)}}for(h=0;h<d.M.length;h++)A=d.M[h].Fu,A.J<=Math.round(g)&&Math.round(g)<A.W&&!A.Bh&&(l(d.M[h],A.Bh,
d.nc),A.Bh=!0),A.W<=Math.round(g)&&A.Bh&&(l(d.M[h],A.Bh,d.nc),A.Bh=!1);d.si=g;d.om=!1}}}};a.cleanup=function(){q.length=0;y=-1};a.Kq=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||m(a)||n.Iq(a)?!0:!1};a.set_frame=function(a,b){var c=B.get_active();c.Xa&&(c.Xa.na-=k(c.Xa,b,!0,y)-a,c.Xa.om=!0)};a.get_frame=function(a){var b=B.get_active();return b.Xa?k(b.Xa,a,!0,y):-1};a.IA=function(){var a=B.get_active();a.Xa&&(a.Xa.Zj=!0)};a.mz=function(){var a=B.get_active();a.Xa&&(a.Xa.Zj=!1)};
a.get_frame_start=function(){var a=B.get_active();return a.Xa?a.Xa.J:-1};a.get_frame_end=function(){var a=B.get_active();return a.Xa?a.Xa.W:-1};a.is_play=function(){var a=B.get_active();return a.Xa?!a.Xa.Zj:!1};a.check_nla=function(){var a=B.get_active();return a.Xa?a.b4w_use_nla:!1};a.check_nla_scripts=function(){var a=B.get_active();return a.Xa?0<a.b4w_nla_script.length:!1}};b4w.module.__camera=function(a,p){function d(b){b=b.d;switch(b.ra){case a.MS_TARGET_CONTROLS:b.Zg=Y.dist(b.g,b.Fb);b.$g=b.G[0].top;break;case a.MS_HOVER_CONTROLS:b.Oa&&(b.Zg=Y.dist(b.g,b.Qb),b.$g=b.G[0].top)}}function b(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Ta:new Float32Array([0,0,0,0]),bb:new Float32Array([0,0,0,0])}}function c(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function e(c){var d={type:c,name:"",ff:1,width:0,height:0,ae:null,ab:null,Hc:null,ta:0,pc:0,Ta:0,bb:0,left:0,right:0,top:0,bottom:0,Le:new Float32Array(3),Yp:new Float32Array(3),quat:new Float32Array(4),ea:new Float32Array(16),DC:new Float32Array(16),pa:new Float32Array(16),Jh:new Float32Array(16),tz:new Float32Array(16),vd:new Float32Array(16),ss:new Float32Array(16),Dd:new Float32Array(16),
dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Xd:null,dof_on:0,Kj:b(),Pi:0,zd:0,cc:null,Yh:null,Ol:null,Hp:new Float32Array(4),uk:new Float32Array(4)};if(c==a.pb)return d;switch(c){case a.Lb:l(d,40,.1,1E3);break;case a.Dc:l(d,2.5,.1,1E3);break;case a.Id:break;case a.we:break;case a.uf:break;case a.qb:case a.zb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return d}function h(b,c,d){if(b.type!=a.qb&&b.type!=a.zb)throw"set_stereo_params(): wrong camera type";
b.Pi=c;b.zd=d;C(b,b.ta);if(ca.fa())for(c=ca.get_active(),b=c.d.ud,c=ca.Lj(c).d.G,d=0;d<c.length;d++)O(c[d],b)}function k(a,b){return f(a.d.quat,b)}function f(a,b){var c=S.quat_to_dir(a,S.AXIS_Y,ea),d=S.quat_to_dir(a,S.AXIS_Z,ja),e=-Math.asin(c[1]/Y.length(c)),c=Math.abs(e)>Math.PI/4?Y.scale(d,-S.sign(e),Z):Y.scale(c,-S.sign(d[1]),Z),f=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=S.sign(e)*Math.PI-e);d=f;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function l(b,c,d,e,f){switch(b.type){case a.Lb:case a.qb:case a.zb:b.pc=
c;b.ta=1;break;case a.Dc:b.top=c;b.ta=1;break;case a.Id:delete b.pc;b.pc=c;b.ta=f/c;break;case a.we:b.top=c;b.ta=f/c;break;default:R.error("set_frustum(): Unsupported camera type: "+b.type)}b.Ta=d;b.bb=e}function g(b,c){var d=c.d.g,e=c.d.quat,f=ra;P.rotateX(c.d.T,-Math.PI/2,f);P.invert(f,b.ea);if(b.cc){var f=b.cc[0],g=b.cc[1],h=b.cc[2],l=b.cc[3],k=ra;k[0]=1-2*f*f;k[1]=-2*f*g;k[2]=-2*f*h;k[3]=0;k[4]=-2*f*g;k[5]=1-2*g*g;k[6]=-2*g*h;k[7]=0;k[8]=-2*f*h;k[9]=-2*g*h;k[10]=1-2*h*h;k[11]=0;k[12]=-2*f*l;k[13]=
-2*g*l;k[14]=-2*h*l;k[15]=1;P.multiply(b.ea,k,b.ea);C(b,b.ta,!0);f=U;g=ra;P.invert(b.ea,g);P.transpose(g,g);W.transformMat4(b.cc,g,f);g=X;g[0]=(S.sign(f[0])+b.pa[8])/b.pa[0];g[1]=(S.sign(f[1])+b.pa[9])/b.pa[5];g[2]=-1;g[3]=(1+b.pa[10])/b.pa[14];W.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.pa[2]=f[0];b.pa[6]=f[1];b.pa[10]=f[2]+1;b.pa[14]=f[3]}b.type==a.qb?b.ea[12]+=b.zd/2:b.type==a.zb&&(b.ea[12]-=b.zd/2);P.multiply(b.pa,b.ea,b.Dd);y(b);q(b);Y.copy(b.Le,b.Yp);Y.copy(d,b.Le);ia.copy(e,
b.quat)}function m(b,c,d,e){P.lookAt(c,d,e,b.ea);b.type==a.qb?b.ea[12]+=b.zd/2:b.type==a.zb&&(b.ea[12]-=b.zd/2);P.multiply(b.pa,b.ea,b.Dd);y(b);q(b);Y.copy(c,b.Le)}function n(a){var b=a.d.G;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];g(e,a);S.gm(e.Dd,e.Kj);if(e.Xd)if(e.dof_on){var f=Y.dist(c.g,e.Xd.location);e.dof_distance=f}else e.dof_distance=0}}function r(b){b=b.d;if(b.ra==a.MS_TARGET_CONTROLS){var c=S.quat_to_dir(b.quat,S.AXIS_Z,ea);b.Vn=0<c[1]}}function A(b,c){var d=
b.d,e=d.Pb;!e||d.ra!=a.MS_EYE_CONTROLS&&d.ra!=a.MS_TARGET_CONTROLS||(c&&(d=k(b,u),e.left+=d[0],e.right+=d[0]),e.left=S.angle_wrap_0_2pi(e.left),e.right=S.angle_wrap_0_2pi(e.right))}function v(b,c){var d=b.d,e=d.Zc;!e||d.ra!=a.MS_EYE_CONTROLS&&d.ra!=a.MS_TARGET_CONTROLS||(c&&(d=k(b,u),e.Va+=d[1],e.La+=d[1]),e.Va=S.angle_wrap_periodic(e.Va,-Math.PI,Math.PI),e.La=S.angle_wrap_periodic(e.La,-Math.PI,Math.PI))}function E(b){var c=b.d;if(z(b)&&c.G[0].type===a.Dc){if(c.ra===a.MS_TARGET_CONTROLS)var d=Y.dist(c.g,
c.Fb),c=d/c.Zg*c.$g;else c.Oa&&c.ra===a.MS_HOVER_CONTROLS?(d=Y.distance(c.g,c.Qb),c=d/c.Zg*c.$g):c=b.d.G[0].top;for(var e in b.d.G)d=b.d.G[e],d.top=c,C(d,d.ta);n(b)}}function B(a,b,c,d,e){var f=a.d,g=b,h=c;if(d||e)a=k(a,qa),d&&(g=b-a[0]),e&&(h=c-a[1]);if(g||h)b=ia.identity(oa),g&&(g=ia.setAxisAngle(S.AXIS_Y,g,K),ia.multiply(b,g,b)),h&&(g=S.quat_to_dir(f.quat,S.AXIS_X,ea),h=ia.setAxisAngle(g,h,K),ia.normalize(h,h),ia.multiply(b,h,b)),ia.multiply(b,f.quat,f.quat)}function w(a,b,c,d,e){var f=a.d,g=b,
h=c;if(d||e){var l=k(a,qa);d&&(g=b-l[0]);e&&(h=c-l[1])}x(a,a.d.Fb,g,h);a=k(a,qa);a=S.angle_wrap_periodic(a[1],-Math.PI,Math.PI);f.Vn=Math.abs(a)>Math.PI/2}function t(a,b,c,d,e){var f=a.d,g=b,h=c;if(d||e){var l=k(a,qa);d&&(g=b-l[0]);e&&(h=c-l[1])}f.$l||(g=0);x(a,f.Qb,g,h);h&&G(a)}function x(a,b,c,d){var e=a.d;if(c||d){var f=ia.identity(oa);c&&(c=ia.setAxisAngle(S.AXIS_Y,c,K),ia.multiply(f,c,f));a=N(a);d&&(!a||a&&e.Oa)&&(a=S.quat_to_dir(e.quat,S.AXIS_X,ea),d=ia.setAxisAngle(a,d,K),ia.normalize(d,d),
ia.multiply(f,d,f));S.Iz(e.g,b,f,e.g);ia.multiply(f,e.quat,e.quat)}}function G(a){var b=a.d;if(b.Oa){var c=k(a,u)[1];a=a.d;a.tb.La-a.tb.Va?(c=(a.tb.La-c)/(a.tb.La-a.tb.Va),c=Math.max(c,0)):c=0;c=c*(a.Gf-a.Wd)+a.Wd;a=S.quat_to_dir(b.quat,S.AXIS_MY,ea);Y.normalize(a,a);Y.scale(a,c,a);Y.subtract(b.Qb,a,b.g)}}function C(b,c,d){switch(b.type){case a.Lb:if(!c)throw"No aspect ratio";b.ta=c;case a.Id:P.perspective(S.yk(b.pc),b.ta,b.Ta,b.bb,b.pa);break;case a.Dc:if(!c)throw"No aspect ratio";b.ta=c;case a.we:c=
b.top*b.ta;P.ortho(-c,c,-b.top,b.top,b.Ta,b.bb,b.pa);break;case a.uf:P.ortho(b.left,b.right,b.bottom,b.top,b.Ta,b.bb,b.pa);break;case a.qb:case a.zb:if(!c)throw"No aspect ratio";b.ta=c;var e=Math.tan(b.pc*Math.PI/360);c=b.Ta*e;var f=b.ta*b.Pi*e;b.type==a.qb?(e=f-b.zd/2,f+=b.zd/2):(e=f+b.zd/2,f-=b.zd/2);e=-(b.Ta/b.Pi*e);f*=b.Ta/b.Pi;P.frustum(e,f,-c,c,b.Ta,b.bb,b.pa);b.left=e;b.right=f;break;case a.pb:return;default:throw"Wrong camera type: "+b.type;}d||(P.multiply(b.pa,b.ea,b.Dd),y(b),q(b))}function q(a){P.copy(a.ea,
a.vd);a.vd[12]=0;a.vd[13]=0;a.vd[14]=0;a.vd[15]=1;P.multiply(a.pa,a.vd,a.vd);P.invert(a.vd,a.vd)}function y(a){P.copy(a.ea,a.Jh);P.multiply(a.pa,a.Jh,a.Jh);P.invert(a.Jh,a.Jh)}function H(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Ta);d||(d=b.bb);var g,h,l,k,m,n,q,r;switch(b.type){case a.pb:throw"Extraction from NONE camera is not possible";case a.Lb:case a.Id:g=c*Math.tan(b.pc*Math.PI/360);k=-g;h=g*b.ta;l=-h;m=d/c*g;r=-m;n=m*b.ta;q=-n;break;case a.Dc:case a.we:l=b.top*b.ta;g=m=b.top;h=n=l;k=r=
-b.top;l=q=-l;break;case a.uf:g=m=b.top;h=n=b.right;k=r=b.bottom;l=q=b.left;break;case a.qb:case a.zb:m=c/b.Ta;g=c*Math.tan(b.pc*Math.PI/360);k=-g;h=b.right*m;l=b.left*m;q=d/c;m=g*q;r=-m;n=h*q;q*=l;break;default:throw"Wrong camera type: "+b.type;}e[0]=l;e[1]=k;e[2]=-c;e[3]=h;e[4]=k;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=l;e[10]=g;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=m;e[17]=-d;e[18]=n;e[19]=m;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;f&&(c=ra,P.invert(b.ea,c),S.We(e,c,e,0));return e}function z(a){return"CAMERA"===
a.type?!0:!1}function N(b){return z(b)&&b.d&&b.d.ra==a.MS_HOVER_CONTROLS?!0:!1}function O(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.Yh){var d=b.csm_num;a.Yh=Array(d);for(var e=0;e<d;e++)a.Yh[e]=new Float32Array(3);a.Ol=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Ta:L(b,a,d-1),f=L(b,a,d),e=H(a,e,f,fa),e=I.Yx(e);a.Yh[d].set(e.F);a.Ol[d]=e.Ba;a.Hp[d]=Y.length(e.F);a.uk[d]=F(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.uk[0]=b.first_cascade_blur_radius}function L(a,b,c){var d=
a.csm_num,e=S.clamp(a.csm_first_cascade_border,b.Ta,b.bb);a=S.clamp(a.csm_last_cascade_border,b.Ta,b.bb);return S.clamp(F(e,a,d,c),b.Ta,b.bb)}function F(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var I=p("__boundings");p("__config");var M=p("__constraints"),R=p("__print"),ca=p("__scenes"),S=p("__util"),Y=p("vec3"),W=p("vec4"),ia=p("quat"),ma=p("mat3"),P=p("mat4");a.pb=10;a.Lb=20;a.Dc=30;a.Id=40;a.we=50;a.uf=60;a.qb=70;a.zb=80;a.MS_STATIC=0;
a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var u=new Float32Array(2),qa=new Float32Array(2),ea=new Float32Array(3),ja=new Float32Array(3),Z=new Float32Array(3),oa=new Float32Array(4),K=new Float32Array(4),U=new Float32Array(4),X=new Float32Array(4),sa=new Float32Array(16),ra=new Float32Array(16),fa=new Float32Array(24);a.Bv=function(b){var f=b.d,g=b.data;switch(g.type){case "PERSP":var h=e(a.Lb);if(g.angle_y)var m=g.angle_y/Math.PI*180;l(h,m,g.clip_start,g.clip_end);break;case "ORTHO":h=
e(a.Dc),l(h,g.ortho_scale/2,g.clip_start,g.clip_end)}h.name=b.name;f.Xs=!1;f.ra=c(g.b4w_move_style);f.dof_distance=b.data.dof_distance;f.Xd=b.data.dof_object;f.dof_front=b.data.b4w_dof_front;f.dof_rear=b.data.b4w_dof_rear;f.dof_power=b.data.b4w_dof_power;f.$l=b.data.b4w_enable_hover_hor_rotation;f.G=[h];f.lo=b.data.b4w_trans_velocity;f.ko=b.data.b4w_rot_velocity;f.mo=b.data.b4w_zoom_velocity;f.ra==a.MS_TARGET_CONTROLS&&(f.Fb.set(g.b4w_target),r(b));g=b.d;m=g.ra;if(m===a.MS_TARGET_CONTROLS||m===a.MS_EYE_CONTROLS||
m===a.MS_HOVER_CONTROLS){var n=b.data,q=null,K=null,p=null;m===a.MS_TARGET_CONTROLS||m===a.MS_EYE_CONTROLS?(n.b4w_use_panning&&(g.et=n.b4w_use_panning),n.b4w_use_horizontal_clamping&&(q={left:n.b4w_rotation_left_limit,right:n.b4w_rotation_right_limit}),n.b4w_use_vertical_clamping&&(K={La:n.b4w_rotation_down_limit,Va:n.b4w_rotation_up_limit}),m===a.MS_TARGET_CONTROLS&&(g.Oa=n.b4w_use_distance_limits&&n.b4w_distance_min<=n.b4w_distance_max,g.Oa&&(g.Wd=n.b4w_distance_min,g.Gf=n.b4w_distance_max))):m===
a.MS_HOVER_CONTROLS&&(n.b4w_use_horizontal_clamping&&n.b4w_horizontal_translation_min<=n.b4w_horizontal_translation_max&&(q={left:n.b4w_horizontal_translation_min,right:n.b4w_horizontal_translation_max}),n.b4w_use_vertical_clamping&&n.b4w_vertical_translation_min<=n.b4w_vertical_translation_max&&(K={La:n.b4w_vertical_translation_min,Va:n.b4w_vertical_translation_max}),g.Oa=n.b4w_use_distance_limits&&n.b4w_hover_angle_min<=n.b4w_hover_angle_max&&n.b4w_distance_min<=n.b4w_distance_max,g.Oa&&(p={La:n.b4w_hover_angle_min,
Va:n.b4w_hover_angle_max},g.Wd=n.b4w_distance_min,g.Gf=n.b4w_distance_max));var X=q;X&&m==a.MS_EYE_CONTROLS&&(X.left*=-1,X.right*=-1);if(X=K)switch(m){case a.MS_TARGET_CONTROLS:X.La*=-1;X.Va*=-1;break;case a.MS_HOVER_CONTROLS:var w=-X.La;X.La=-X.Va;X.Va=w}(X=p)&&m==a.MS_HOVER_CONTROLS&&(X.La*=-1,X.Va*=-1);g.Pb=q;g.Zc=K;g.tb=p;A(b,"LOCAL"==n.b4w_horizontal_clamping_type);v(b,"LOCAL"==n.b4w_vertical_clamping_type)}if(f.ra===a.MS_HOVER_CONTROLS)if(f=b.d,f.Oa){g=b.d;m=S.quat_to_dir(g.quat,S.AXIS_MY,ea);
n=U;n.set(S.AXIS_Y);n[3]=0;m=S.line_plane_intersect(n,0,g.g,m,g.Qb);if(!m||100<Y.len(m))g.Qb[0]=g.g[0],g.Qb[1]=0,g.Qb[2]=g.g[2];g=k(b,u);f=S.Ce(g[1],f.tb.Va,f.tb.La);0<g[1]&&R.warn("Active hover camera has wrong orientation");f?t(b,0,f):G(b)}else f.$l=!1;h.type==a.Dc&&d(b)};a.uy=d;a.mw=b;a.ib=e;a.EC=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.ab);case "DEPTH":return Boolean(a.Hc);case "SCREEN":return!Boolean(a.ab)&&!Boolean(a.Hc);default:throw"Wrong attachment type: "+b;}};
a.Dk=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.ab=c;break;case "DEPTH":a.Hc=c;break;case "SCREEN":a.ab=null;a.Hc=null;break;default:throw"Wrong attachment type: "+b;}};a.tD=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.ab;case "DEPTH":return a.Hc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.lr=function(b,c){if(b.type!=a.Lb||c!=a.qb&&c!=a.zb)throw"make_stereo(): wrong camera type";b.type=c;h(b,6,.065)};a.eA=h;a.get_camera_angles=k;a.mq=f;a.get_camera_angles_char=
function(a,b){k(a,b);b[0]=S.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.d,d=S.quat_to_dir(c.quat,S.AXIS_MY,ea),e=Math.asin(d[1]/Y.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?S.quat_to_dir(c.quat,S.AXIS_MZ,ja):S.quat_to_dir(c.quat,S.AXIS_Z,ja)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.Ek=l;a.Xz=function(b,c,d,e,f,g,h){switch(b.type){case a.uf:b.left=c;b.right=d;b.bottom=e;b.top=
f;b.Ta=g;b.bb=h;break;default:R.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.ra};a.iA=g;a.lE=m;a.ps=function(a,b,c){var d=ea;d[0]=0;d[1]=-1;d[2]=0;Y.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=ja;e[0]=0;e[1]=0;e[2]=-1;Y.transformQuat(e,c,e);m(a,b,d,e)};a.kx=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];P.lookAt(a,b,c,ra);P.invert(ra,ra);P.rotateX(ra,Math.PI/2,ra);ma.fromMat4(ra,sa);ia.fromMat3(sa,e)};a.jB=n;a.iB=
function(b){var c=b.d,d=b.d;if(d.ra===a.MS_TARGET_CONTROLS||d.ra===a.MS_EYE_CONTROLS){if(d.Pb){var e=d.Pb.left,f=d.Pb.right,g=k(b,u);(g=d.ra==a.MS_TARGET_CONTROLS?S.Ce(g[0],e,f):S.Ce(g[0],f,e))&&(d.ra==a.MS_TARGET_CONTROLS?w(b,g,0):B(b,g,0))}d.Zc&&(e=d.Zc.La,f=d.Zc.Va,g=k(b,u),(g=d.ra==a.MS_TARGET_CONTROLS?S.Ce(g[1],f,e):S.Ce(g[1],e,f))&&(d.ra==a.MS_TARGET_CONTROLS?w(b,0,g):B(b,0,g)));d.ra===a.MS_TARGET_CONTROLS&&d.Oa&&(g=b.d,e=Y.subtract(g.g,g.Fb,ea),f=Y.length(e),f>g.Gf?(Y.scale(e,g.Gf/f,e),Y.add(g.Fb,
e,g.g)):f<g.Wd&&(f=S.quat_to_dir(g.quat,S.AXIS_MY,ja),Y.scale(f,100*g.Wd,f),Y.add(e,f,e),Y.scale(e,-g.Wd/Y.length(e),e),Y.add(g.Fb,e,g.g)))}d.ra===a.MS_HOVER_CONTROLS&&(d=b.d,g=d.Oa?d.Qb:d.g,d.Pb&&(e=S.clamp(g[0],d.Pb.left,d.Pb.right)-g[0],g[0]+=e,d.Oa&&(d.g[0]+=e)),d.Zc&&(e=S.clamp(g[2],d.Zc.La,d.Zc.Va)-g[2],g[2]+=e,d.Oa&&(d.g[2]+=e)),d=b.d,d.Oa&&d.tb&&(g=k(b,u)[1],g=S.Ce(g,d.tb.Va,d.tb.La),S.quat_to_dir(d.quat,S.AXIS_MY,ea),g&&t(b,0,g)));E(b);switch(c.ra){case a.MS_TARGET_CONTROLS:M.Jz(c.g,c.quat,
c.Fb);M.correct_up(b,S.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.Qa||M.correct_up(b,S.AXIS_Y)}r(b)};a.fo=r;a.oz=A;a.sz=v;a.qB=E;a.rotate_eye_camera=B;a.rotate_target_camera=w;a.rotate_hover_camera=t;a.ty=G;a.OD=function(b){switch(b.type){case a.Lb:case a.Dc:case a.qb:case a.zb:return!0;default:return!1}};a.Jx=function(b){b=b.d.G[0];switch(b.type){case a.Lb:case a.Id:case a.qb:case a.zb:return Math.PI*b.pc/180;default:return R.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.$e=C;a.yl=q;
a.mp=y;a.hx=H;a.jv=function(a){a=a.d;var b=I.Ed();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Mb=b;var c=I.Ml(1,[0,0,0]);a.Pc=c;a.nl=I.Dp(1,b);a.pl=I.Fp(1,b);a.ol=I.Ep(1,b)};a.is_camera=z;a.is_target_camera=function(b){return z(b)&&b.d&&b.d.ra==a.MS_TARGET_CONTROLS?!0:!1};a.is_eye_camera=function(b){return z(b)&&b.d&&b.d.ra==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=N;a.eo=O;a.Hw=L;a.project_point=function(b,c,d){b=b.d.G[0];switch(b.type){case a.Lb:case a.Id:case a.Dc:case a.we:case a.qb:case a.zb:var e=
U;e.set(c);e[3]=1;W.transformMat4(e,b.Dd,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return R.error("Non-compatible camera"),d}};a.Wx=function(a){return a.d.G[0]};a.Mj=function(b,c){switch(b.type){case a.Lb:case a.Id:case a.qb:case a.zb:var d=Math.tan(S.yk(b.pc)/2);switch(c){case "LEFT":return-d*b.ta;case "RIGHT":return d*b.ta;case "TOP":return d;case "BOTTOM":return-d}break;case a.Dc:case a.we:switch(c){case "LEFT":return-b.top*
b.ta;case "RIGHT":return b.top*b.ta;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.uf:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:S.oa("Unknown camera type")}};a.Gy=function(b){switch(b.type){case a.Dc:case a.we:case a.uf:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.Lb:case a.Id:case a.qb:case a.zb:var d=S.yk(b.pc);return c?d*b.ta:d;default:return 0}}};b4w.module.__lights=function(a,p){function d(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Hg:new Float32Array(3),Xc:0,pg:0,Gx:!1,Rp:!1,tg:!0,mf:!0,Je:1,distance:25,dD:"INVERSE_SQUARE"}}function b(a){a.Hg[0]=a.color[0]*a.Je;a.Hg[1]=a.color[1]*a.Je;a.Hg[2]=a.color[2]*a.Je}var c=p("__util"),e=p("vec3");a.HD=d;a.Jy=function(a){var k=a.data,f=d(k.type);f.name=a.name;f.tg=k.use_diffuse;f.mf=k.use_specular;var l=c.quat_to_dir(a.d.quat,c.AXIS_Y,[]);e.normalize(l,
l);f.direction[0]=l[0];f.direction[1]=l[1];f.direction[2]=l[2];f.color[0]=k.color[0];f.color[1]=k.color[1];f.color[2]=k.color[2];f.Je=k.energy;b(f);f.distance=k.distance;if("POINT"===f.type||"SPOT"===f.type)f.distance=k.distance;"SPOT"===f.type?(f.pg=k.spot_blend,f.Xc=k.spot_size):"POINT"===f.type&&(f.Xc=Math.PI/2);f.Gx=k.b4w_generate_shadows;f.Rp=k.b4w_dynamic_intensity;a.la=f};a.Zz=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.aA=function(a,b){a.pg=b};a.$z=function(a,b){a.distance=
b};a.bA=function(a,b){a.Xc=b};a.ms=function(a,c){a.Je=c;b(a)};a.Om=function(a){return"LAMP"===a.type?!0:!1};a.nB=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.la;b&&c.quat_to_dir(a.d.quat,c.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,p){function d(){Ia||(Ia=b(Fa));return Ia}function b(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.dd||!c.dd.length)return c}return null}function c(){if(!za)throw"No active scene available";return za}function e(a,b,c,d){for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.nc==d){e=g;break}}return e}function h(a,b){b||(b="ALL");var c=[];k(a.objects,b,c);return c}function k(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||
c.push(e);(e=e.dupli_group)&&k(e.objects,b,c)}}function f(b){if("NONE"==ya.af||!b.b4w_render_shadows)return!1;var c=!1,d=!1;if(0==Z(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=Z(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function l(a){if(!a.sa)return!1;a=a.sa.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].la.type)return!0;return!1}function g(a){if(!ya.shore_smoothing)return!1;a=oa(a);for(var b=0;b<a.length;b++){var c=
a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function m(b){var c=oa(b),d=[];b=Z(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<c.length;e++){var f=c[e];if(f.b4w_water){for(var g={},h=0;h<b.length;h++)for(var l=b[h],k=l.data.materials,J=0;J<k.length;J++)k[J]==f&&(g.qf=l.location[1]);if(ya.bi)for(g.Xb=f.b4w_water_fog_color.slice(0),g.Xb.push(f.b4w_water_fog_density),f.b4w_water_dynamic?(g.Og=!0,g.waves_height=f.b4w_waves_height,g.waves_length=f.b4w_waves_length,g.dst_noise_scale0=f.b4w_water_dst_noise_scale0,
g.dst_noise_scale1=f.b4w_water_dst_noise_scale1,g.dst_noise_freq0=f.b4w_water_dst_noise_freq0,g.dst_noise_freq1=f.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=f.b4w_water_dir_min_shore_fac,g.dir_freq=f.b4w_water_dir_freq,g.dir_noise_scale=f.b4w_water_dir_noise_scale,g.dir_noise_freq=f.b4w_water_dir_noise_freq,g.dir_min_noise_fac=f.b4w_water_dir_min_noise_fac,g.dst_min_fac=f.b4w_water_dst_min_fac,g.waves_hor_fac=f.b4w_water_waves_hor_fac):(g.Og=!1,g.waves_height=0,g.waves_length=0),g.vj=null,g.Al=
null,g.Bl=new Float32Array(2),g.Gk=null,f=f.texture_slots,h=0;h<f.length;h++)l=f[h].texture,"VORONOI"==l.type&&(g.vj=l.noise_scale,g.Bl.set([.3,.7]),g.Al=l.noise_intensity),!0===l.b4w_shore_dist_map&&(g.Gk=l.image,g.sh=l.image.size[0],g.oA=l.b4w_shore_boundings,g.gh=l.b4w_max_shore_dist);else g.waves_height=0,g.waves_length=0,g.vj=null,g.Al=null,g.Bl=null,g.Xb=null,g.Og=!1;d.push(g)}}if(0<d.length){g=d[0];if(!g.Og)for(e=0;e<d.length;e++)d[e].Og&&(g=d[e]);return g}return null}function n(a){function b(a){if(a){a=
a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.rd=!0)}}}var c={};a=oa(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.rd=!0);e.node_tree&&b(e.node_tree)}return c}function r(b){if(!ya.Bk||!b.b4w_render_reflections)return null;var c=[],d=0;b=Z(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];if(f.d.vc)if("CUBE"==f.d.je)d++;else{var g=f.al;f.al=null;if(g){g.d||
kc.Pk(g,!1);for(var f=null,h=0;h<c.length;h++)if(c[h]==g){f=h;break}null==f&&c.push(g)}}}return{Ak:c,ur:d,Ej:[],Ci:[]}}function A(a,b){var c={},d=a.world.b4w_sky_settings;c.es=d.render_sky;c.procedural_skydome=d.procedural_skydome&&b;c.use_as_environment_lighting=d.use_as_environment_lighting;c.th=d.color;c.rayleigh_brightness=d.rayleigh_brightness;c.mie_brightness=d.mie_brightness;c.spot_brightness=d.spot_brightness;c.scatter_strength=d.scatter_strength;c.rayleigh_strength=d.rayleigh_strength;c.mie_strength=
d.mie_strength;c.rayleigh_collection_power=d.rayleigh_collection_power;c.mie_collection_power=d.mie_collection_power;c.mie_distribution=d.mie_distribution;c.Ub=d.reflexible;c.Gb=d.reflexible_only;!b&&d.procedural_skydome&&Da.warn("There is no sun on the scene. Procedural sky won't be rendered");return c}function v(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.ry=a.hemisphere;b.vv=a.blur_depth;b.fp=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;
b.Lz=a.samples;return b}function E(a){var b={};a=a.world.b4w_bloom_settings;b.blur=a.blur;b.Yw=a.edge_lum;b.key=a.key;return b}function B(a){var b={};a=a.world.b4w_motion_blur_settings;b.ek=a.motion_blur_decay_threshold;b.fk=a.motion_blur_factor;return b}function w(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function t(a){var b={};a=a.world.b4w_god_rays_settings;b.xy=a.intensity;b.fh=a.max_ray_length;
b.Ah=a.steps_per_pass;return b}function x(a){var b={};a=a.world;b.Ve=a.b4w_outline_color;b.xi=a.b4w_outline_factor;return b}function G(a){var b={};a=a.world;b.small_glow_mask_coeff=a.b4w_small_glow_mask_coeff;b.large_glow_mask_coeff=a.b4w_large_glow_mask_coeff;b.small_glow_mask_width=a.b4w_small_glow_mask_width;b.large_glow_mask_width=a.b4w_large_glow_mask_width;return b}function C(a,b){var c=a.world,d=c.light_settings,e={};e.Ke=d.environment_energy;e.ho=d.use_environment_light;e.bm=d.environment_color;
e.Oe=c.horizon_color.slice(0);e.sf=c.zenith_color.slice(0);e.HB=c.use_sky_paper;e.GB=c.use_sky_blend;e.IB=c.use_sky_real;e.ys=null;e.In=null;e.cm=null;if(e.ho&&"SKY_TEXTURE"==e.bm&&!(b.es&&b.procedural_skydome&&b.use_as_environment_lighting)){for(var d=null,f=0;f<c.texture_slots.length;f++)if(c.texture_slots[f].texture.b4w_use_as_environment_lighting){d=c.texture_slots[f];break}d?e.cm=d:(Da.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),
e.ho=!1)}for(f=0;f<c.texture_slots.length;f++)if(c.texture_slots[f].texture.b4w_use_as_skydome){c=c.texture_slots[f];e.ys=c;e.In={tv:c.blend_factor,sy:c.horizon_factor,WB:c.zenith_up_factor,VB:c.zenith_down_factor,color:c.color,za:c.default_value,invert:c.invert,FB:c.use_rgb_to_intensity,dp:c.blend_type,BB:c.use_map_blend,CB:c.use_map_horizon,EB:c.use_map_zenith_up,DB:c.use_map_zenith_down};break}return e}function q(b){if(!ya.kb)return!1;var c=!1,d=!1;b=Z(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){for(var f=
b[e],g=f.data.materials,h=0;h<g.length;h++)g[h].b4w_terrain&&(c=!0);f=f.particle_systems;for(h=0;h<f.length;h++)g=f[h].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}function y(b){if(La.outlining_overview_mode)return!0;if(ya.enable_selectable)switch(b.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Z(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.ng)return!0;return!1}else return!1}function H(b){if(La.outlining_overview_mode)return!0;
if(ya.enable_outlining)switch(b.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Z(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.Cb)return!0;return!1}else return!1}function z(b){if(ya.Me)switch(b.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Z(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++)if(Gc.rp(d[e]))return!0;return!1}else return!1}function N(b){b=Z(b,"MESH",a.DATA_ID_ALL);
for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++){var f=d[e],g=f.game_settings.alpha_blend;if(f.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function O(b){switch(b.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0}b=Z(b,"EMPTY",a.DATA_ID_ALL);for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_anchor&&d.b4w_anchor.detect_visibility)return!0}return!1}function L(a,b,c){var d=Ca.lh(a,b);Ca.re(a,d,function(a,b,d){if(d.Ka){switch(d.L){case "COLOR":case "CUBEMAP":a=
b.h.ab;break;case "DEPTH":a=b.h.Hc;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.da){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.of)throw"Batch texture can't use renderbuffer";ga.tp(c.Wb,d.da)&&T.Eg(c,a,d.da)}}});for(a=0;a<b.ka.length;a++){var d=b.ka[a],e=b.Ad[a];switch(d.da){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;
default:if(e.of)throw"Batch texture can't use renderbuffer";ga.tp(c.Wb,d.da)&&T.Eg(c,e,d.da)}}}function F(a,b){return{Ra:!0,Yl:[!0,!0,!0,!0,!0,!0],qd:a,D:b}}function I(a,b,c,d,e){switch(a.type){case "MAIN_OPAQUE":M(a,b,c,"OPAQUE",d,e);break;case "MAIN_BLEND":M(a,b,c,"BLEND",d,e);break;case "MAIN_XRAY":M(a,b,c,"XRAY",d,e);break;case "MAIN_GLOW":M(a,b,c,"GLOW",d,e);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var f=b.d,g=b.n,h=0;h<g.length;h++){var l=g[h];if(("MAIN"==l.type||"NODES"==
l.type||"PARTICLES"==l.type)&&"REFLECT"==l.Ia){if("MAIN_PLANE_REFLECT"==a.type){var k;a:{if(d.d.wb){k=d.d.wb.Ci;for(var J=0;J<k.length;J++)if(k[J]==a){k=J;break a}}k=null}if(k==f.sc)continue}else{a:{if(d.d.wb)for(k=d.d.wb.Ej,J=0;J<k.length;J++)if(k[J]==a){k=J;break a}k=null}if(k==f.lc)continue}e||(R(l,a,b,c,"REFLECT",d),k=l.fb,ga.s(k,"DISABLE_FOG",0),ga.s(k,"WATER_EFFECTS",0),"special_skydome.glslf"==ga.qq(k)&&ga.s(k,"REFLECTION_PASS",1),ga.s(k,"SHADOW_SRC","SHADOW_SRC_NONE"),ga.s(k,"TEXTURE_NORM",
0),S(d,l),T.yb(l),Y(l));a.p.push(F(f,l))}}break;case "DEPTH":f=b.d;b=b.n;for(g=0;g<b.length;g++)if(h=b[g],"DEPTH"==h.type&&!h.ec&&"DEPTH"==h.Ia){if(!e){l=h;J=a;k=f;var m=c,n=d,aa=l.fb;if(ka.qy(m,J,"SHADOW_CAST"))if(l.Ib){if("DEPTH"!=ya.af)throw"Wrong shadows type";ga.s(aa,"SHADOW_SRC","SHADOW_SRC_DEPTH");ga.s(aa,"SHADOW_DST","SHADOW_DST_MASK");T.kl(l,n.d.ud);ka.rq(m,J)}else ga.s(aa,"SHADOW_SRC","SHADOW_SRC_NONE"),ga.s(aa,"SHADOW_DST","SHADOW_DST_MASK");else ga.s(aa,"SHADOW_SRC","SHADOW_SRC_NONE"),
ga.s(aa,"SHADOW_DST","SHADOW_DST_NONE");l.kb&&(J=ka.Aa(m,"GRASS_MAP"))&&ia(l,J,k);T.yb(l);Y(l)}a.p.push(F(f,h));L(c,a,h);W(h)}break;case "SHADOW_CAST":f=!1;g=b.d;b=b.n;h=ka.Aa(c,"GRASS_MAP");for(l=0;l<b.length;l++)if(k=b[l],"DEPTH"==k.type&&"SHADOW_CAST"==k.Ia){f=!0;if(!e){if("DEPTH"!=ya.af)throw"Wrong shadows type";ga.s(k.fb,"SHADOW_SRC","SHADOW_SRC_NONE");ga.s(k.fb,"SHADOW_DST","SHADOW_DST_DEPTH");k.kb&&h&&ia(k,h,g);T.ja(k,"SHADOW_TEX_RES",ga.u(d.d.ud.csm_resolution));T.yb(k);Y(k)}a.p.push(F(g,
k))}f&&P(a,ka.Aa(c,"MAIN_OPAQUE"),a.p,d,!0);break;case "COLOR_PICKING":qa(a,b,e);break;case "COLOR_PICKING_XRAY":qa(a,b,e);break;case "OUTLINE_MASK":c=b.d;d=b.n;for(b=0;b<d.length;b++)f=d[b],"COLOR_ID"==f.type&&"OUTLINE"==f.Ia&&(e||(T.ja(f,"USE_OUTLINE",1),T.yb(f),Y(f)),a.p.push(F(c,f)));break;case "GRASS_MAP":c=b.d;d=b.n;for(b=0;b<d.length;b++)f=d[b],"GRASS_MAP"==f.type&&(e||(T.yb(f),Y(f)),a.p.push(F(c,f)),f=a.h,k=c.Za,g=a.Zb[0],h=a.Zb[1],l=a.Zb[2],0==g&&0==h?(g=k.min_y,h=k.max_y):(g=Math.min(g,
k.min_y),h=Math.max(h,k.max_y)),k=1E-4*(h-g),a.Zb[0]=g-k,a.Zb[1]=h+k,ta.Ek(f,l/2,-h,-g,l/2),ta.$e(f));break;case "WIREFRAME":for(d=b.d,b=b.n,f=0;f<b.length;f++)g=b[f],"WIREFRAME"==g.type&&(e||(g.kb&&(h=ka.Aa(c,"GRASS_MAP"))&&ia(g,h,d),T.yb(g),Y(g)),a.p.push(F(d,g)),L(c,a,g),W(g))}}function M(a,b,c,d,e,f){for(var g=b.d,h=b.n,l=0;l<h.length;l++){var k=h[l];k.ec||k.Gb||"MAIN"!=k.type&&"NODES"!=k.type&&"NODES_GLOW"!=k.type&&"PARTICLES"!=k.type||!("OPAQUE"==k.Ia&&"OPAQUE"==d||"BLEND"==k.Ia&&"BLEND"==d||
"XRAY"==k.Ia&&"XRAY"==d||"NODES_GLOW"==k.type&&"GLOW"==d)||(f||(R(k,a,b,c,d,e),S(e,k),T.yb(k),Y(k)),a.p.push(F(g,k)),L(c,a,k),W(k))}a.p.sort(function(a,b){var c;if(a.D&&b.D){c=a.D.Da;var d=b.D.Da;(c=c==d?0:c>d?1:-1)||(c=a.D.cg,d=b.D.cg,c=c==d?0:c>d?1:-1)}else c=0;return c})}function R(a,b,c,d,e,f){var g=c.d;if("OPAQUE"===e)var h=ka.Aa(d,"SHADOW_CAST")&&a.Ib?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE";else if("BLEND"===e||"XRAY"===e)if(ka.Aa(d,"SHADOW_CAST")&&a.Ib)switch(ya.af){case "DEPTH":h="SHADOW_SRC_DEPTH";
break;default:throw"Wrong shadows type";}else h="SHADOW_SRC_NONE";else if("REFLECT"===e||"GLOW"===e)h="SHADOW_SRC_NONE";else throw"Wrong main subscene type";e=a.fb;var l=f.d.ud;ga.s(e,"SHADOW_SRC",h);T.kl(a,l);h=b.bg;ga.s(e,"NUM_LIGHTS",h);ga.s(e,"NUM_LFACTORS",0==h%2?h/2:Math.floor(h/2)+1);"special_skydome.glslf"==ga.qq(e)&&ga.s(e,"REFLECTION_PASS",0);ga.s(e,"SSAO_ONLY",0);b.Wa&&b.$c?ga.s(e,"WATER_EFFECTS",1):ga.s(e,"WATER_EFFECTS",0);b.Wa&&b.Bf&&g.Bf?(ga.s(e,"CAUSTICS",1),ga.s(e,"CAUST_SCALE",b.op),
ga.s(e,"CAUST_SPEED",ga.u(b.pp,2)),ga.s(e,"CAUST_BRIGHT",b.np)):ga.s(e,"CAUSTICS",0);b.Wa&&(ga.s(e,"WAVES_HEIGHT",ga.u(b.rf)),ga.s(e,"WAVES_LENGTH",ga.u(b.yg)),ga.s(e,"WATER_LEVEL",ga.u(b.qf)));-1!==a.Jb.indexOf("u_mirrormap")?ga.s(e,"REFLECTION_TYPE","REFL_MIRRORMAP"):a.vc?null!=g.lc&&ka.Aa(d,"MAIN_CUBE_REFLECT")?(c=f.d.wb?f.d.wb.Ej[c.d.lc]:null)?(c=c.h.ab,T.Eg(a,c,"u_cube_reflection"),ga.s(e,"REFLECTION_TYPE","REFL_CUBE")):ga.s(e,"REFLECTION_TYPE","REFL_NONE"):null!=g.sc&&ka.Aa(d,"MAIN_PLANE_REFLECT")?
(c=f.d.wb?f.d.wb.Ci[c.d.sc]:null)?(c=c.h.ab,T.Eg(a,c,"u_plane_reflection"),ga.s(e,"REFLECTION_TYPE","REFL_PLANE")):ga.s(e,"REFLECTION_TYPE","REFL_NONE"):ga.s(e,"REFLECTION_TYPE","REFL_NONE"):ga.s(e,"REFLECTION_TYPE","REFL_NONE");(h=ka.Aa(d,"SKY"))?a.Xr?(c=h.h.ab,T.Eg(a,c,"u_sky")):ya.wk?(a.kc=h.kc,ga.s(e,"PROCEDURAL_FOG",1)):ga.s(e,"PROCEDURAL_FOG",0):ga.s(e,"PROCEDURAL_FOG",0);c=f.d.vo;c.ho&&(ga.s(e,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==c.bm?(c=c.cm?T.Nx(c.cm,!1):h.h.ab,ga.s(e,"SKY_TEXTURE",
1),T.Eg(a,c,"u_sky_texture")):"SKY_COLOR"==c.bm&&ga.s(e,"SKY_COLOR",1));a.kb&&(c=ka.Aa(d,"GRASS_MAP"))&&ia(a,c,g);a.An?(ya.bi&&ga.s(e,"USE_REFRACTION_CORRECTION",1),"NODES"==a.type||"NODES_GLOW"==a.type?(ga.s(e,"REFRACTIVE",1),f.d.rd?ga.s(e,"USE_REFRACTION",1):ga.s(e,"USE_REFRACTION",0)):f.d.rd?ga.s(e,"REFRACTIVE",1):ga.s(e,"REFRACTIVE",0)):(ga.s(e,"REFRACTIVE",0),ga.s(e,"USE_REFRACTION",0),ga.s(e,"USE_REFRACTION_CORRECTION",0));a.pf&&(a.ro&&ka.Aa(d,"DEPTH")?ga.s(e,"SHORE_SMOOTHING",1):ga.s(e,"SHORE_SMOOTHING",
0),a.water_dynamic&&b.Wa&&b.rf?ga.s(e,"DYNAMIC",1):ga.s(e,"DYNAMIC",0));"PARTICLES"==a.type&&(ga.s(e,"SIZE_RAMP_LENGTH",a.Nr),ga.s(e,"COLOR_RAMP_LENGTH",a.Er));if(!a.Jf)for(b=a.M,d=0;d<b.length;d++)if(c=b[d],"SCENE"==c.source)for(g=0;g<Fa.length;g++)for(var h=Fa[g],l=Fa[g].dd,k=0;k<l.length;k++)l[k].d==c&&Ca.l(sb,h,f,null);if(a.bh){b=0;for(var J in a.bh)b++;a.Sm=new Float32Array(3*b);a.Qm=new Float32Array(3*b);a.Pm=new Float32Array(3*b);a.Rm=new Float32Array(4*b);ga.s(e,"NUM_LAMP_LIGHTS",b);for(d=
0;d<f.sa.LAMP.length;d++)ca(a,f.sa.LAMP[d])}}function ca(a,b){var c=b.uuid;if(c in a.bh){c=a.bh[c];a.Sm.set(b.d.g,3*c);a.Qm.set(b.la.direction,3*c);a.Pm.set(b.la.Hg,3*c);var d=Ob,e=b.la;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.mf?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var f=d[0]=Math.cos(e.Xc/2);d[1]=e.pg*(1-f)}a.Rm.set(d,4*c)}}function S(b,c){var d=Z(b,"LAMP",a.DATA_ID_ALL);c.fb.Wm=[];for(var e=u(d)||d[0],f=0;f<d.length;f++){var g=d[f].la;if("SPOT"==g.type||"POINT"==
g.type)var h=Math.cos(g.Xc/2);if("SPOT"==g.type)var l=g.pg*(1-h);var k=g.index;c.fb.Wm.push({type:g.type,index:k,Ly:Math.floor(k/2),Ky:0==k%2?"rg":"ba",Xc:h,pg:l,distance:g.distance,Fy:g.tg||g.mf,vx:k==e.la.index})}}function Y(a){var b=a.Wb.attributes,c=a.R.Tb,d;for(d in b)c[d]||Ea.oa('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES"==a.type||"NODES_GLOW"==a.type)if(b=ga.iy(a.Wb.oo),10<b&&("MAIN"==a.type&&Da.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Kc.join(", ")+
'"'),"NODES"==a.type||"NODES_GLOW"==a.type))d=c=0,a.wg&&(c=Ea.ld(a.wg)),a.gb&&(d=Ea.ld(a.gb)),Da.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Kc.join(", ")+'"')}function W(a){8<a.M.length&&Da.warn("too many textures used - "+a.M.length+' (max 8), materials "'+a.Kc.join(", ")+'"')}function ia(a,b,c){a.Zb=b.Zb;var d=b.Zb[0],e=b.Zb[1],f=b.Zb[2];c=c.Mb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Zb[2]=f;b=b.h;ta.Ek(b,f/2,-e,-d,f/
2);ta.$e(b);d=a.Am||0;d=0==d?c:Math.max(d,c);a.Am=d}function ma(a){var b=X(a,"MAIN_OPAQUE"),c=!0;Ca.S(a.d.mb,function(d,e){"SHADOW_CAST"===e.type&&(P(e,b,e.p,a,c),c=!1)})}function P(b,c,d,e,f){if(0!=d.length){var g=b.h;c=c.h;var h=Z(e,"LAMP",a.DATA_ID_ALL),h=u(h)||h[0],l=h.d;ta.ps(g,l.g,l.quat);hb.copy(c.Le,g.Le);ib.copy(c.ea,g.ss);if("SPOT"==h.la.type||"POINT"==h.la.type)ta.$e(g,g.ta);else{h=Ya;Na.Ed(h);for(l=0;l<d.length;l++){var k=d[l].qd;0==l?Na.Cp(k.Za,h):Na.Tp(h,k.Za)}d=Na.gx(h,ba);Ea.We(d,
g.ea,d);if(e.d.ud.enable_csm){e=hb.copy(c.Yh[b.Nl],mb);h=ib.invert(c.ea,pb);Ea.We(e,h,e);Ea.We(e,g.ea,e);b=c.Ol[b.Nl];if(f)for(qb=0,f=2;f<d.length;f+=3)qb=Math.min(qb,d[f]);f=Ya;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=qb}else{b=f=Ya;c=ub;c.set(d);e=Oa/9;d=ib.identity(pb);ib.rotate(d,e,Ea.AXIS_MZ,d);l=h=-1;for(k=0;10>k;k++){var J=Na.pv(c,Aa),m=(J.max_x-J.min_x)*(J.max_y-J.min_y);if(-1==h||m<h)h=m,l=k,Na.Cp(J,b);Ea.We(c,d,c)}b=l*e;0<b&&(c=ib.identity(pb),ib.rotate(c,
b,Ea.AXIS_MZ,c),ib.multiply(c,g.ea,g.ea));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}ta.Xz(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);ta.$e(g)}Ea.gm(g.Dd,g.Kj)}}function u(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function qa(a,b,c){var d=b.d;b=b.n;for(var e=0;e<b.length;e++){var f=
b[e];"COLOR_ID"==f.type&&("COLOR_PICKING"==a.type&&"COLOR_ID"==f.Ia||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==f.Ia)&&(c||(T.ja(f,"USE_OUTLINE",0),T.yb(f),Y(f)),a.p.push(F(d,f)))}}function ea(a,b){for(var c=U(b,lb),d=a.la,e=a.d,f=d.index,g=0;g<c.length;g++){var h=c[g];h.Vf.set(e.g,3*f);h.Tf.set(d.direction,3*f);h.Sf.set(d.Hg,3*f);switch(d.type){case "SUN":if(h.Qs.set(e.quat),h.Ps=d.Hg,"SKY"===h.type){var l=mb;l[0]=l[1]=l[2]=1;var k=Math.acos(hb.dot(h.Kk,l)),l=Math.acos(hb.dot(d.direction,l));
h.hk=Math.floor(k/.025)!=Math.floor(l/.025)?!0:!1;hb.copy(d.direction,h.Kk);ja(b,h)}else hb.copy(d.direction,h.Kk);case "HEMI":case "POINT":case "SPOT":break;default:Da.error("Unknown light type: "+d.type+'".')}k=va;k[0]=d.tg?1:0;k[1]=d.mf?1:0;h.Uf.set(k,2*f);h.ia=!0;for(k=0;k<h.p.length;k++)l=h.p[k].D,l.bh&&ca(l,a)}}function ja(a,b){Va.di(b);if(b.hk)for(var c=U(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].p,f=0;f<e.length;f++){var g=e[f];g.Ra&&(g=g.D,
T.Ev(g)&&Va.fB(g))}}function Z(b,c,d){if(!b.sa)throw"Access to uninitialized scene";b=b.sa[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.nc==d&&c.push(f)}return c}function oa(b){var c=[];b=Z(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function K(a,b,c){for(var d=a.d,e=a.camera.d.G,f=0;f<e.length;f++){var g=e[f];ta.$e(g,b/c);d.Bn&&ta.eo(g,d.ud)}d.Bn&&
(d.ik=!0,X(a,"DEPTH").ia=!0,X(a,"MAIN_BLEND").ia=!0);var h=d.mb;ka.$A(h,function(d,e,f){if(d.Hh){var g=d.ff*b,l=d.ff*c;if(e)for(e=0;e<f.ka.length;e++)f.ka[e]==d&&Ra.resize(d.qa,g,l);else switch(Ra.ri(d.qa)&&Ra.resize(d.qa,g,l),d=f.h,d.width=g,d.height=l,f.type){case "DOF":sa(a,{dof_power:f.h.dof_power,dof_on:f.h.dof_on});break;case "GLOW_COMBINE":fa(a,{small_glow_mask_width:f.small_glow_mask_width,large_glow_mask_width:f.large_glow_mask_width});break;case "BLOOM":ra(a,{bloom_blur:f.bloom_blur});break;
case "OUTLINE":f=ka.Ea(h,f,"POSTPROCESSING");g=ka.Ea(h,f,"POSTPROCESSING");l=ka.Ea(h,g,"POSTPROCESSING");d=ka.Ea(h,l,"POSTPROCESSING");ka.wc(f,1/b,1/c);ka.wc(g,1/b,1/c);ka.wc(l,1/b,1/c);ka.wc(d,1/b,1/c);break;case "ANTIALIASING":case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":case "SSAO":case "SSAO_BLUR":ka.wc(f,1/b,1/c)}}})}function U(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];Ca.S(a.d.mb,function(a,b){b.type==e&&c.push(b)})}return c}
function X(a,b){return ka.Aa(a.d.mb,b)}function sa(a,b){var c=X(a,"DOF");if(!c)return Da.error("DOF is not enabled on the scene. Check camera settings"),0;var d=a.d.mb;"boolean"==typeof b.dof_on&&(c.h.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.h.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.h.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.h.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.h.dof_power=b.dof_power;var e=ka.Ea(d,c,"POSTPROCESSING"),
d=ka.Ea(d,e,"POSTPROCESSING");ka.Hb(e,c.h.dof_power);ka.wc(e,1/c.h.width,1/c.h.height);ka.Hb(d,c.h.dof_power);ka.wc(d,1/c.h.width,1/c.h.height)}c.ia=!0}function ra(a,b){var c=X(a,"LUMINANCE_TRUNCED"),d=X(a,"BLOOM");if(!c||!d)return Da.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.ia=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.ia=!0);if("number"==typeof b.bloom_blur){var e=a.d.mb,c=ka.Ea(e,d,"BLOOM_BLUR"),e=ka.Ea(e,
c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ka.Hb(c,b.bloom_blur);ka.wc(c,1/d.h.width,1/d.h.height);ka.Hb(e,b.bloom_blur);ka.wc(e,1/d.h.width,1/d.h.height)}}function fa(a,b){var c=X(a,"GLOW_COMBINE");if(!c)return Da.error("Glow is not enabled on the scene"),null;for(var d=a.d.mb,e=ka.rq(d,c),f=0;f<e.length;++f){var g=e[f];if("POSTPROCESSING"===g.type&&"GLOW_MASK_LARGE"===g.Ia)var h=g;if("POSTPROCESSING"===g.type&&"GLOW_MASK_SMALL"===g.Ia)var l=g}e=ka.Ea(d,h,"POSTPROCESSING");d=ka.Ea(d,l,"POSTPROCESSING");
"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.ia=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,c.ia=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ka.Hb(l,b.small_glow_mask_width),ka.wc(l,1/c.h.width,1/c.h.height),l.ia=!0,ka.Hb(d,b.small_glow_mask_width),ka.wc(d,1/c.h.width,1/c.h.height),d.ia=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=
b.large_glow_mask_width,ka.Hb(h,b.large_glow_mask_width),ka.wc(h,1/c.h.width,1/c.h.height),h.ia=!0,ka.Hb(e,b.large_glow_mask_width),ka.wc(e,1/c.h.width,1/c.h.height),e.ia=!0)}function ha(a,b){var c=X(za,"MAIN_OPAQUE");if(!c||!c.Wa)return Da.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.rf,e=c.yg,f=c.qf,g=c.Wa;if(!d||!g.Og)return g.qf;var h=hb.length(c.Xi),l=c.time;h&&(l*=h);var k=va;k[0]=20/e*(a-.25*l);k[1]=20/e*(b-.25*l);h=Ea.qp(k);k[0]=17/e*(b+.1*l);k[1]=17/e*(a+
.1*l);var k=Ea.qp(k),h=h+k-1,J=g.dst_noise_scale0,k=g.dst_noise_scale1,m=g.dst_noise_freq0,n=g.dst_noise_freq1,aa=va;aa[0]=J*(a+m*l);aa[1]=J*(b+m*l);J=Ea.Kn(aa);aa[0]=k*(b-n*l);aa[1]=k*(a-n*l);k=Ea.Kn(aa);k*=d*J;if(c.Sk)if(n=(a-c.cf[0])/c.df[0],aa=(c.cf[1]+b)/c.df[1],n+=.5,aa+=.5,1<n||0>n||1<aa||0>aa)d=k;else var n=Ea.lq(za.d.Fn,c.sh,n,aa),J=g.dir_freq,q=g.dir_noise_scale,r=g.dir_noise_freq,m=g.dir_min_noise_fac,aa=g.dst_min_fac,c=e/c.gh/Math.PI,q=[q/e*(a+r*l),q/e*(b+r*l)],e=Math.sqrt(n),d=d*Math.max(n,
g.dir_min_shore_fac)*Math.sin(e/c+J*l)*Math.max(Ea.Kn(q),m),g=Math.max(e,aa),d=d*(1-g)+k*g,h=h*n;else d=k;return f+(d+.05*h)}function V(a,b){a.qi&&"POSTPROCESSING"==a.type&&b.Ra!=a.Ra&&(a.Ra=b.Ra);b.Ra||"OUTLINE"!=a.type||(a.Zl=0)}function J(a,b,c,d){var e=Ca.Sa(a,b);ta.Dk(e.h,c,d);e.ll=!0;Ca.lf(a,b,function(b,e,f){f.Ka&&f.L==c&&ka.Nv(f)&&aa(a,b,f.da,d)});Ca.re(a,b,function(b,e,f){f.Ka&&f.L==c&&f.L==f.da&&J(a,b,c,d)})}function aa(a,b,c,d){a=Ca.Sa(a,b).p;for(b=0;b<a.length;b++)T.Fz(a[b].D,d,c)}function wa(a){var b=
X(a,"GRASS_MAP");if(b){var c=b.h,d=a.camera.d,e=d.g;a=mb;a[0]=0;a[1]=-b.Zb[2]/2;a[2]=0;hb.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=pa;b[0]=0;b[1]=0;b[2]=0;b[3]=1;ta.ps(c,a,b)}}function na(a,b){Ca.S(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.ka[0]||!d.Ad[0])throw"Wrong MOTION_BLUR subscene";var e=d.ka[0],f=d.Ad[0];d.Ad[0]=d.h.ab;Ca.lf(a,c,function(b,c,d){d.Ka&&aa(a,b,d.da,f)});J(a,c,e.L,f);aa(a,c,e.da,d.Ad[0]);d.or=Math.exp(-b/d.fk)}})}function Ba(b,c){var d=0,e=b.Gu;0==e.Yn&&
(e.Yn=c);var f=c-e.Yn;if(e.ds&&f/e.Lc>=e.ds)a.clear_outline_anim(b);else{f%=e.Lc;if(f<e.zr)switch(e=f/(e.zr/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}b.d.Tc=d}}function Ga(a){Ca.S(a.d.mb,function(a,b){b.ia=!0})}function Q(a){if("WIND"==a.field.type){a=a.d;Ea.quat_to_dir(a.quat,Ea.AXIS_Y,xa);hb.normalize(xa,xa);hb.scale(xa,a.nm,xa);a=Fa;for(var b=0;b<a.length;b++)for(var c=U(a[b],wc),d=0;d<c.length;d++)c[d].Xi.set(xa)}}
function Xa(a){var b=c();if(b=X(b,"OUTLINE"))b.Ve.set(a),b.ia=!0}var T=p("__batch"),Na=p("__boundings"),ta=p("__camera"),gb=p("__config"),Qa=p("__constraints"),Rc=p("__data"),Za=p("__debug"),uc=p("__geometry"),Ca=p("__graph"),Pa=p("__hud"),Gc=p("__nodemat"),kc=p("__objects");p("__particles");var lc=p("__physics"),xb=p("__prerender"),Jb=p("__primitives"),Da=p("__print"),Va=p("__renderer"),ka=p("__scenegraph"),ob=p("__sfx"),ga=p("__shaders"),Ra=p("__textures"),Ea=p("__util"),hb=p("vec3"),ib=p("mat4"),
ya=gb.o,La=gb.Cb,Mb=gb.Md,zb="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),vc=["ARMATURE","EMPTY","MESH","SPEAKER"],ac="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.lC=ac;var lb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),mc="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),
wc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),jb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Ab=0,Ia=null,za=null,Fa=[],sb=null,eb=[],Nb=0,Bb=0,Cb=1,tb=0,yb=0,Oa=Math.PI/2;a.tf=0;a.Wk=1;a.Xk=2;a.DATA_ID_ALL=-1;var va=new Float32Array(2),mb=new Float32Array(3);new Float32Array(4);var Ob=new Float32Array(4),pa=new Float32Array(4),
pb=new Float32Array(16),ba=new Float32Array(24),ub=new Float32Array(24),Ya=Na.Ed(),Aa=Na.Ed(),xa=new Float32Array(3),qb=null;a.set_active=function(a){za=a;ob.Uz(a)};a.rz=function(a,b){var c=a.d,d=ka.vw(c.mb);if(a==b){K(a,Nb,Bb);for(var e=0;e<d.length;e++)a.d.jg.push(d[e])}else for(e=a.dd[0],K(a,e.d.og,e.d.og),e=0;e<d.length;e++)b.d.jg.push(d[e]);d=U(a,wc);for(e=0;e<d.length;e++)d[e].Xi.set(xa);for(e=0;e<c.jg.length;e++)"SHADOW_CAST"==c.jg[e].type&&Va.di(c.jg[e])};a.Ug=d;a.im=b;a.get_active=c;a.fa=
function(){return za?!0:!1};a.Lj=function(a){return a.camera};a.mi=function(){return Fa};a.ay=function(){if(1==Fa.length)return Fa;for(var a=[],b=0;b<Fa.length;b++){var c=Fa[b];if(!c.dd.length){b=Ca.lh(sb,c);b=Ca.Ns(sb,b,Ca.yo);b=Ca.$n(b);Ca.S(b,function(b,c){a.push(c)});break}}return a};a.md=function(b,c,d,f){for(var g=Fa,h=null,l=0;l<g.length;l++){var k=Z(g[l],"ALL",a.DATA_ID_ALL);switch(b){case a.tf:h=e(c,k,!1,d);break;case a.Wk:h=null;(k=e(c,k,!1,f))&&k.dupli_group&&(h=e(d,k.dupli_group.objects,
!0,f));break;case a.Xk:for(var h=null,J=0;J<c.length;J++)if((h=e(c[J],k,0!=J,d))&&h.dupli_group)k=h.dupli_group.objects;else break}if(h)break}return h};a.Xu=function(a,b,c){for(var d in vc){var e=vc[d],f=h(a,e),g=b.d.Ih,l=!1;for(d=0;d<c.length;d++)if(l=!0,c[d].d&&c[d].d.Rf){for(var k=0;k<g.length;k++)g[k]==c[d]&&(l=!1);l&&g.push(c[d])}e in b.sa||(b.sa[e]=[]);for(k=0;k<f.length;k++)Ea.is_armature(f[k])&&f[k].proxy||(b.sa.ALL.push(f[k]),b.sa[e].push(f[k]))}};a.Ru=function(b,c){b.sa={ALL:[]};for(var d in zb){var e=
zb[d],k=h(b,e);b.sa[e]=[];for(var J=0;J<k.length;J++)Ea.is_armature(k[J])&&k[J].proxy||(b.sa.ALL.push(k[J]),b.sa[e].push(k[J]))}b.dd=b.dd||[];b.d=b.d||{};b.Xa=null;e=b.d;k=b.camera.d;d=b.world.b4w_shadow_settings;J=e.ud={};d.csm_resolution>ya.od?(J.csm_resolution=ya.od,Da.error("Shadow map texture has unsupported size. Changed to "+ya.od+".")):J.csm_resolution=d.csm_resolution;J.self_shadow_polygon_offset=d.self_shadow_polygon_offset;J.self_shadow_normal_offset=d.self_shadow_normal_offset;J.enable_csm=
d.b4w_enable_csm;var aa=Z(b,"LAMP",a.DATA_ID_ALL);if(aa=u(aa)||aa[0])J.Tm=aa.la.type,J.Xc=aa.la.Xc,J.distance=aa.la.distance,"SPOT"!=J.Tm&&"POINT"!=J.Tm||!J.enable_csm||(Da.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),J.enable_csm=!1);J.enable_csm?(J.csm_num=d.csm_num,J.csm_first_cascade_border=d.csm_first_cascade_border,J.first_cascade_blur_radius=d.first_cascade_blur_radius,J.csm_last_cascade_border=d.csm_last_cascade_border,J.last_cascade_blur_radius=d.last_cascade_blur_radius,
J.fade_last_cascade=d.fade_last_cascade,J.blend_between_cascades=d.blend_between_cascades):(J.csm_num=1,J.csm_first_cascade_border=d.csm_first_cascade_border,J.first_cascade_blur_radius=d.first_cascade_blur_radius,J.csm_last_cascade_border=d.csm_last_cascade_border,J.last_cascade_blur_radius=d.last_cascade_blur_radius,J.fade_last_cascade=!1,J.blend_between_cascades=!1);e.Ih=[];for(d=0;d<c.length;d++)c[d].d&&c[d].d.Rf&&e.Ih.push(c[d]);d=b.world.b4w_fog_color;e.Xb=new Float32Array([d[0],d[1],d[2],b.world.b4w_fog_density]);
e.qg=l(b);e.Ik=A(b,e.qg);e.vo=C(b,e.Ik);e.br=Z(b,"LAMP",a.DATA_ID_ALL).length;e.Wa=m(b);e.Sy=n(b);e.te=N(b);e.Ku=O(b);e.vr=0;k.G[0].type!=ta.Lb&&ya.anaglyph_use?(Da.warn("Anaglyph stereo is disabled for the non-perspective camera"),d=!1):d=ya.anaglyph_use;e.anaglyph_use=d;e.Bn=ya.bi&&f(b);e.hD=b.world.b4w_fog_color;e.shore_smoothing=g(b);e.wb=r(b);e.uv=E(b);e.Vy=B(b);e.Cv=w(b);e.ly=t(b);e.hz=x(b);e.Ne=G(b);e.Ng=ya.Ng&&(0<k.dof_distance||k.Xd);e.kb=q(b);e.ih=ya.ih&&b.b4w_enable_motion_blur;e.Jg=ya.Jg&&
b.b4w_enable_color_correction;e.antialiasing=ya.antialiasing&&b.b4w_enable_antialiasing;e.Fg=ya.Fg&&b.b4w_enable_bloom&&e.qg;e.gf=ya.gf&&b.b4w_enable_ssao;e.HA=v(b);e.Wg=ya.Wg&&b.b4w_enable_god_rays&&e.qg;e.rd=ya.rd&&b.b4w_render_refractions;e.Tw=ya.bi;e.Uv=y(b);e.outline=H(b);e.Me=z(b);e.zm=b.world.b4w_render_glow_over_blend;d=b.dd.sort(function(a,b){return b.d.og-a.d.og});e.mb=ka.uw(e,k,d);e.jg=[];e.ik=!1;e.mn=!1;Fa.push(b);sb||(sb=Ca.create());Ca.v(sb,b)};a.Hl=h;a.wm=function(a){return a.d.mb};
a.wx=function(a){Ca.S(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=T.Gp(c.vk);break;case "SSAO":d=T.Bw(c);break;case "SSAO_BLUR":d=T.Cw(c);break;case "DEPTH_PACK":d=T.kw();break;case "REFRACT":case "COPY":d=T.Gp("NONE");break;case "GOD_RAYS":ka.Ea(a,c,"WIREFRAME")||ka.Ea(a,c,"MAIN_BLEND")||ka.Ea(a,c,"GOD_RAYS");d=T.ow(c.Or,c.pf,c.Ah);break;case "GOD_RAYS_COMBINE":ka.Ea(a,c,"WIREFRAME")||ka.Ea(a,c,"MAIN_BLEND");ka.Ea(a,c,"GOD_RAYS");d=T.pw();break;case "MOTION_BLUR":d=T.sw(c.ek);
break;case "DOF":var d=T.lw(),e=ka.Ea(a,c,"POSTPROCESSING"),f=ka.Ea(a,e,"POSTPROCESSING");ka.Hb(e,c.h.dof_power);ka.Hb(f,c.h.dof_power);break;case "OUTLINE":var d=T.tw(),e=ka.Ea(a,c,"POSTPROCESSING"),f=ka.Ea(a,e,"POSTPROCESSING"),g=ka.Ea(a,f,"POSTPROCESSING"),h=ka.Ea(a,g,"POSTPROCESSING");ka.Hb(f,c.tl);ka.Hb(e,c.tl);ka.Hb(h,c.fm*c.xi);ka.Hb(g,c.fm*c.xi);break;case "GLOW_COMBINE":d=T.nw();break;case "COMPOSITING":d=T.iw();break;case "ANTIALIASING":d=T.ew();break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
T.zw(c.type);break;case "ANAGLYPH":d=T.cw();break;case "SKY":d=T.yw();break;case "LUMINANCE":d=T.qw();break;case "AVERAGE_LUMINANCE":d=T.fw();break;case "LUMINANCE_TRUNCED":d=T.rw();break;case "BLOOM_BLUR":d=T.gw();break;case "BLOOM":d=ka.Ea(a,c,"BLOOM_BLUR");e=ka.Ea(a,d,"BLOOM_BLUR");ka.Hb(d,c.bloom_blur);ka.Hb(e,c.bloom_blur);d=T.hw();break;case "VELOCITY":d=T.Fw();break;case "ANCHOR_VISIBILITY":d=T.dw()}d&&(e=F(kc.Cj("NONE"),d),Y(d),c.p.push(e),L(a,c,d),W(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=
a.d.mb,e=b.d;!ka.Aa(d,"SHADOW_CAST")&&e.Ib&&(e.Ib=!1);e=U(a,ac);c&&(lc.has_physics(b)&&lc.append_object(b,a),a.sa.ALL.push(b),a.sa[b.type].push(b),b.xa&&b.xa.dupli_group.objects&&(b.origin_name=b.name,b.xa.dupli_group.objects.push(b)));for(var f=0;f<e.length;f++)I(e[f],b,d,a,c);break;case "LAMP":b.la.index=a.d.vr++;c=U(a,lb);for(d=0;d<c.length;d++)c[d].bg++;ea(b,a)}};a.remove_object=function(a){if(!a.d.Mm)return!1;var b=c();Rc.qz(b,a,!1);var d=b.sa.ALL.indexOf(a);-1!=d&&b.sa.ALL.splice(d,1);d=b.sa[a.type].indexOf(a);
-1!=d&&b.sa[a.type].splice(d,1);a.xa&&a.xa.dupli_group.objects&&(d=a.xa.dupli_group.objects.indexOf(a),-1!=d&&a.xa.dupli_group.objects.splice(d,1));Qa.Hv(a)&&Qa.remove(a);return!0};a.rC=I;a.Dn=function(a){a.d.ik=!0};a.Sx=function(a,b){for(var c=a.d.ud,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=ta.Hw(c,b,e);return d};a.hide_object=function(a){a.d.Yg=!0};a.show_object=function(a){a.d.Yg=!1};a.is_hidden=function(a){return a.d.Yg};a.Az=function(a,b,c){b=b.d;a=U(a,ac);for(var d=0;d<a.length;d++)for(var e=
a[d].p,f=e.length-1;0<=f;f--){var g=e[f];g.qd==b&&(g.D&&c&&uc.vp(g.D.R),e.splice(f,1))}};a.check_object=function(a,b){return b.sa[a.type]&&-1<b.sa[a.type].indexOf(a)?!0:!1};a.uA=function(a){var b=a.sa.LAMP;if(b.length==a.d.vr){for(var c=[],d=0;d<b.length;d++)c[b[d].la.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].la,g=b[c[e]].la;if(g.tg&&g.mf&&(!f.tg||!f.mf)||!f.tg&&(g.tg||!f.mf&&g.mf))f=c[d],c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].la.index=d,ea(b[c[d]],a)}};
a.rg=ea;a.cleanup=function(){for(var a=0;a<Fa.length;a++){var b=Fa[a];Ca.S(b.d.mb,function(a,b){if("SINK"!=b.type){var c=b.h;Va.Cz(c.ae,c.ab,c.Hc,c.width,c.height);for(var c=b.p,d=0;d<c.length;d++){var e=c[d].D;e&&T.Tv(e)}}});b.d.mb=[];b.d.jg=[]}za=Ia=null;Fa.length=0;sb=null;eb.length=0;xa[0]=0;xa[1]=0;xa[2]=0};a.kr=function(a,b,c){a=ta.hx(a,a.Ta,a.bb,null,!0);var d=Jb.Bx(a);a=kc.Cj("DYNAMIC");a.Za=a.Mb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.rb=a.Pc=Na.rv();var e=
a.rb.Ba;a.Af=a.zf=Na.Ll([e,0,0],[0,e,0],[0,0,e],a.rb.F);c=T.xw(d,c);b.p.push(F(a,c))};a.Ga=Z;a.xD=function(a){return[a.frame_start,a.frame_end]};a.qs=function(a,b,c,d,e){Nb=a;Bb=b;Cb=c;tb=e;yb=d;za&&K(za,a,b)};a.OA=U;a.ha=X;a.get_environment_colors=function(a){a=U(a,lb)[0];var b=a.Oe,c=a.sf,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Ke,d,e]};a.set_environment_colors=function(a,b,c,d){a=U(a,lb);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Ke=b);c&&f.Oe.set(c);
d&&f.sf.set(d);f.ia=!0}};a.get_sky_params=function(a){if(a=X(a,"SKY")){var b={};b.color=Array(3);hb.copy(a.th,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=
a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=X(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.th.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=
b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),
"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.ia=!0,c.hk=!0,ja(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=U(a,mc)[0].Xb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=U(a,mc),d=0;d<c.length;d++){var e=c[d];e.Xb.set(b);e.ia=!0}};a.get_ssao_params=function(a){var b=X(a,"SSAO");a=X(a,"SSAO_BLUR");if(!b)return null;var c=b.p[0].D,d={};d.ssao_quality=T.sb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;
d.ssao_blur_depth=a.ssao_blur_depth;d.fp=a.ssao_blur_discard_value;d.radius_increase=b.xh;d.influence=b.wh;d.dist_factor=b.vh;d.ssao_only=b.ssao_only;d.ssao_white=T.sb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=X(a,"SSAO"),d=X(a,"SSAO_BLUR");if(!c)return Da.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.p[0].D;T.ja(e,"SSAO_QUALITY",b.ssao_quality);T.yb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.p[0].D,T.ja(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),
T.yb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.p[0].D,T.ja(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),T.yb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.xh&&(c.xh=b.xh);"number"==typeof b.wh&&(c.wh=b.wh);"number"==typeof b.vh&&(c.vh=b.vh);if("number"==typeof b.ssao_only){c=X(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.p.length;f++)e=c.p[f].D,T.ja(e,"SSAO_ONLY",b.ssao_only),T.yb(e,!0)}"number"==typeof b.ssao_white&&
(e=c.p[0].D,T.ja(e,"SSAO_WHITE",b.ssao_white),T.yb(e,!0));c.ia=!0;d.ia=!0};a.get_dof_params=function(a){a=X(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.h.dof_distance;b.dof_front=a.h.dof_front;b.dof_rear=a.h.dof_rear;b.dof_power=a.h.dof_power;b.Xd=a.h.Xd;return b};a.set_dof_params=sa;a.get_god_rays_params=function(a){var b=U(a,["GOD_RAYS"]);a=X(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].fh;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=
T.sb(b[0].p[0].D,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=U(a,["GOD_RAYS"]),d=X(a,"GOD_RAYS_COMBINE");if(!c||!d)return Da.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].fh=e,c[f].zk=e/c[f].Ah/(f+1),c[f].ia=!0;if("number"==typeof b.god_rays_steps)for(var g=ga.u(b.god_rays_steps,
1),e=c[0].fh,f=0;f<c.length;f++){c[f].Ah=g;c[f].zk=e/g/(f+1);c[f].ia=!0;var h=c[f].p[0].D;T.ja(h,"STEPS_PER_PASS",g);T.yb(h,!0)}d.ia=!0};a.get_bloom_params=function(a){var b=X(a,"LUMINANCE_TRUNCED");a=X(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=ra;a.get_glow_material_params=function(a){a=X(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=
a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=fa;a.get_wind_params=function(){var a=xa,b=hb.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=Z(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return Da.error("There is no wind on the scene"),
0;d=g.d;"number"==typeof c.wind_dir&&(mb=[0,c.wind_dir/180*Math.PI,-Math.PI/2],Ea.euler_to_quat(mb,pa),d.quat.set(pa),Q(g));"number"==typeof c.wind_strength&&(d.nm=c.wind_strength,Q(g));Ga(b)};a.Pz=function(a){a.d.mn=!0};a.get_water_surface_level=ha;a.get_water_mat_params=function(a,b){var c=X(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.rf,b.waves_length=c.yg,c.$c)){b.water_fog_density=c.$c[3];var d=b.water_fog_color=[];d[0]=c.$c[0];d[1]=c.$c[1];d[2]=c.$c[2]}};a.set_water_params=function(a,b){var c=
X(a,"MAIN_OPAQUE");if(!c||!c.Wa)return Da.error("set_water_params() - no water parameters on the scene"),null;c=c.Wa;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==
typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Og=b.water_dynamic);for(var d=U(a,jb),e=0;e<d.length;e++){var f=d[e];
"number"==typeof b.water_fog_density&&c.Xb&&(f.$c[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.Xb&&f.$c.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.rf=b.waves_height);"number"==typeof b.waves_length&&(f.yg=b.waves_length);f.ia=!0}};a.get_shore_dist=function(a,b){var c=X(za,"MAIN_OPAQUE");if(!c.Sk)return 100;var d=c.gh,e=c.qf,f=(a[0]-c.cf[0])/c.df[0],g=(c.cf[1]+a[2])/c.df[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*Ea.lq(za.d.Fn,c.sh,f,g),e=(e-a[1])*b,
e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var d=c().camera.d,e=0;e<Fa.length;e++){var f=Fa[e],g=f.d.mb;if(f.d.Wa)var h=d.g[1]-ha(d.g[0],d.g[2]);for(var l=f.d.Ih,k=0;k<l.length;k++){var J=l[k].d,m=J.Ja,n=J.Rg+J.na;if(m){var aa=Math.round(m.currentTime*J.Yb),q=J.na/J.Yb;if(aa<J.na-(ya.Qf?5:0)||l[k].d.sg&&aa>n)m.currentTime=q;!J.sg&&aa>n&&m.pause();2<=m.readyState&&!m.paused&&Ra.wB(J)}else if(J.ph){m=Math.min(J.ph.length,J.Rg+J.na);if(J.me<J.na||J.sg&&J.me>=m)J.me=J.na;!J.sg&&J.me>=m&&(J.qh=!1);
m=Math.round(a*Mb.Fa/J.Yb)*J.ls;m!=Ab&&J.qh&&(Ra.tB(J),J.me++);Ab=m}}Ca.S(g,function(b,c){-1<wc.indexOf(c.type)&&(c.time=a);f.d.Wa&&(c.zl=h)})}for(e=0;e<Fa.length;e++)if(f=Fa[e],k=f.d,d=k.jg,k.ik&&(ma(f),k.ik=!1),k.mn&&(wa(f),k.mn=!1),d.length){f.b4w_enable_motion_blur&&na(k.mb,b);if(k.outline){for(var r=0,e=0;e<f.sa.MESH.length;e++)k=f.sa.MESH[e],r+=k.d.Tc,-1!=eb.indexOf(k)&&Ba(k,a);Ca.S(f.d.mb,function(a,b){"OUTLINE"===b.type&&(b.Zl=r)})}g=null;for(k=0;k<d.length;k++)"OUTLINE_MASK"==d[k].type&&
(g=k);for(k=0;k<d.length;k++)l=d[k],xb.wn(l),null!==g&&V(l,d[g]),Va.di(l)}ya.show_hud_debug_info&&Pa.pA(Fa,b)};a.um=function(a){var b=[];Ca.S(a.d.mb,function(a,c){b.push(c)});return b};a.apply_outline_anim=function(a,b,c,d){a.Gu={Yn:0,zr:b,Lc:c,ds:d};-1==eb.indexOf(a)&&eb.push(a)};a.clear_outline_anim=function(a){a.d.Tc=0;a=eb.indexOf(a);-1!=a&&eb.splice(a,1)};a.OC=function(){eb=[]};a.get_cam_water_depth=function(){var a=X(za,"MAIN_BLEND"),b=za;return a||b.d.Wa?a.zl:null};a.get_object_data_id=function(a){return a.d.nc};
a.ct=Ga;a.kA=function(a,b){switch(b){case "WM_NONE":a.Ra=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.p.length;c++)a.p[c].D.wireframe_mode=Za.Fo[b];a.Ra=!0}a.Da="WM_TRANSPARENT_WIREFRAME"==b;a.ia=!0};a.jA=function(a,b){for(var c=0;c<a.p.length;c++)a.p[c].D.wireframe_edge_color=b,a.ia=!0};a.Oo=function(a,b){for(var c=0;c<b.length;c++)a.sa.ALL.push(b[c]),a.sa.MESH.push(b[c])};a.$s=Q;a.pick_object=function(b,c){var e=
d();if(!e)return Da.error("No active scene"),null;var f=X(e,"COLOR_PICKING");if(f){b-=yb;c-=tb;b*=Cb;c*=Cb;xb.wn(f);Va.di(f);var g=X(e,"COLOR_PICKING_XRAY");g?(xb.wn(g),Va.di(g),f=g.h):f=f.h;c=f.height-c;for(var h=Va.bs(f.ae,b,c),f=Z(e,"MESH",a.DATA_ID_ALL),g=0;g<f.length;g++){var k=f[g].d,l=k.Aj;if(l&&3>Math.abs(255*l[0]-h[0])&&3>Math.abs(255*l[1]-h[1])&&3>Math.abs(255*l[2]-h[2]))return k.Cb&&k.yr&&(La.outlining_overview_mode?(Xa(La.Ve),k.Tc=La.Tc,a.apply_outline_anim(f[g],La.mk,La.nk,La.ok)):(Xa(e.world.b4w_outline_color),
k.Tc=e.world.b4w_outline_factor,e=k.wi,a.apply_outline_anim(f[g],e.mk,e.nk,e.ok))),f[g]}}else Da.error("Object Selection is not available on the scene");return null};a.set_outline_color=Xa;a.ky=function(){return xa};a.cy=function(b){var c=[];b=Z(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.ng&&c.push(e)}return c};a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.cB=function(){for(var b=
za,c=Z(b,"MESH",a.DATA_ID_ALL),d=0;d<c.length;d++)for(var e=c[d].n,f=0;f<e.length;f++){var g=e[f];if("MAIN"==g.type||"NODES"==g.type)S(b,g),T.yb(g)}};a.yq=function(){return Cb};a.Zs=function(a,b){var c=b.d.rb.F,d=a.d.wb?a.d.wb.Ej[b.d.lc]:null;if(d){var e=mb;hb.negate(c,e);for(c=0;6>c;c++){var f=d.Zh[c],g=d.Pl[c],h=d.h;ib.translate(Ea.ut[c],e,f);ib.multiply(h.pa,f,h.Dd);Ea.gm(h.Dd,g)}}};a.lv=function(a,b){b.d.wb&&(a.d.cc=b.d.wb.Ci[a.d.sc].h.cc)};a.bt=function(a,b){var c=b.d.wb.Ak[a],d=b.d.wb.Ci[a].h;
Ea.YA(c.d.g,c.d.quat,Ea.AXIS_Y,d.cc);ta.iA(d,b.camera)}};b4w.module.__physics=function(a,p){function d(a,b){for(var c=a.Ec,e=0;e<c.length;e++)c[e].d.Qk&&b.push(c[e]),d(c[e],b)}function b(a,b){if(W)switch(a){case y.Ct:W.m.qt=!0;y.t(y.eu,Date.now()-performance.now(),R.nd,R.zv?ca.dq:0);break;case y.Dt:C.log(b);break;case y.yt:C.error(b);break;case y.zt:q.fbmsg.apply(this,b.slice(1));break;case y.Ht:var d=c(b.body_id);if(d){var e=b.trans,f=b.quat,g=b.linvel,h=b.angvel,d=d.m;d.Ql=b.time;N.set_sep(e,1,f,d.Rl);F.copy(g,d.hr);F.copy(h,d.Po)}break;case y.Ft:(e=
c(b.chassis_hull_body_id))&&N.set_sep(b.trans,1,b.quat,e.j.Fi[b.prop_ind]);break;case y.At:if(d=c(b[1]))e=b[4],d=d.Fc.qj[b[2]],z.set_translation(d,b[3]),z.set_rotation(d,e),z.w(d);break;case y.It:if(d=c(b[1]))d.j.speed=b[2];break;case y.vt:for(var e=b.body_id_a,d=b.body_id_b,f=b.result,g=b.coll_point,e=parseInt(e),h=W.m.p,k=0;k<h.length;k++)for(var l=h[k].ub,m=0;m<l.fd.length;m++){for(var n=l.fd[m],r=n.qk,t=!1,A=0;A<r.length;A++){var v=r[A];if(v[0]===e&&v[1]===d){n.Rr[A]=f;t=!0;break}}if(t){r=n.Rr;
for(A=t=0;A<r.length;A++)t=t||r[A];n.callback(t,g)}}break;case y.wt:if(d=c(b[1]))d=d.m,d.zj&&d.zj(b[2]);break;case y.Gt:if(d=c(b.body_id))for(d=d.m,f=b.from,g=b.to,h=b.local,k=b.body_id_b_hit,l=b.cur_result,m=0;m<d.Xe.length;m++)if(r=d.Xe[m],O.yj(r.L,f)&&O.yj(r.da,g)&&r.local==h){for(e in r.ke)r.ke[e]=1;-1!=k&&(r.ke[k]=l);for(var n=r.jc,A=r.callback,r=r.ke,t=!1,v=1,p=0;p<W.m.p.length;p++){var u=W.m.p[p].ub;if(("ANY"==n||u.id==n)&&u.N in r&&1!==r[u.N]){t=!0;v=r[u.N];break}}A(t,v)}break;case y.Et:console.log("Physics message ping: ",
performance.now()-b[1]);break;case y.Bt:S=b[1];break;case y.xt:console.log(b[1]);break;default:C.error("Wrong message: "+a)}}function c(a){return ma[a]||null}function e(){P.body++;return P.body}function h(a){return{N:a,cn:0,Xj:!1,ef:!0,QD:!1,is_character:!1,Ay:!1,Bj:null,id:"",QC:{},fd:[],zj:null,Xe:[],Ql:0,Rl:new Float32Array([0,0,0,1,0,0,0,1]),hr:new Float32Array(3),Po:new Float32Array(3),uj:new Float32Array(3),tj:new Float32Array(4)}}function k(a,b){switch(a){case "BOX":var c=b.Mb;break;case "CYLINDER":c=
b.pl;break;case "CONE":c=b.ol;break;case "SPHERE":c=b.Pc;break;case "CAPSULE":c=b.nl}return c}function f(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.F&&(b.center=a.F);"number"===typeof a.Ba&&(b.radius=a.Ba);"number"===typeof a.height&&
(b.height=a.height);return b}function l(a,b,c,d){var e=a.d.g,f=b.d.T,g=new Float32Array(16);M.invert(f,g);f=new Float32Array(3);F.transformMat4(e,g,f);switch(b.j.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Mb;y.t(y.Kt,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:y.t(y.Jt,c,f,a.tE)}}function g(a){return a.m&&a.m.Bj?!0:!1}function m(a,b,c,d,e,f,g,h,k,l){var m;P.Bp++;m=P.Bp.toString(16);y.t(y.Rt,m,a,h,b.m.N,c,d,e.m.N,f,g,k,l);b.m.Bj=m}function n(a){var b=a.m;if(b&&
(0===b.cn||!0===b.Xj||!1===b.ef||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.m.uj[0]||a.d.g[1]!=a.m.uj[1]||a.d.g[2]!=a.m.uj[2]||a.d.quat[0]!=a.m.tj[0]||a.d.quat[1]!=a.m.tj[1]||a.d.quat[2]!=a.m.tj[2])){a.m.uj.set(a.d.g);a.m.tj.set(a.d.quat);var b=a.m,c=y.tq(y.dj);c.body_id=a.m.N;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=qa,I.identity(qa)):c.quat=a.d.quat;y.t(y.dj,c)}a=a.Ec;for(b=0;b<a.length;b++)n(a[b])}function r(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;F.transformQuat(e,
a,e)}function A(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.m.p.length;e++){var f=b.m.p[e];if("ANY"==a||f.ub.id==a)f=f.ub.N,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function v(a,b){y.t(y.Gd,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=O.To(e.L)+O.To(e.da)+String(e.local);c[f]=c[f]||{L:e.L,da:e.da,local:e.local,gp:[]};var g=c[f].gp,h;for(h in e.ke)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].L,e=c[f].da,h=c[f].local,g=c[f].gp,y.t(y.Do,a,d,e,h,g)}else y.t(y.Do,
a,null,null,!1,null)}function E(a,b){if(b.zh){var c=a.m.N,d=b.Pg*b.cq,e=b.Uh*b.ip,f=-b.yh*b.Qn*2*Math.PI/b.Js;b.Sq&&(f*=-1);switch(b.type){case 10:y.t(y.Gd,c);y.t(y.uu,c,d,e,f);break;case 20:y.t(y.Gd,c),y.t(y.tu,c,d,e,f)}}}function B(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function w(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function t(a){return a.b4w_character?!0:!1}function x(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?
!0:!1}var G=p("__config");p("__constraints");var C=p("__print"),q=p("__debug"),y=p("__ipc");p("__renderer");var H=p("__scenes"),z=p("__transform"),N=p("__tsr"),O=p("__util"),L=p("__version"),F=p("vec3"),I=p("quat"),M=p("mat4"),R=G.ub,ca=G.o,S=0,Y=null,W=null,ia=[],ma={},P={body:0,Bp:0,shape:0},u=new Float32Array(3),qa=new Float32Array(4),ea=new Float32Array(4),ja=new Float32Array(16),Z=new Float32Array(8),oa=new Float32Array(8);a.vy=function(a){if(W)C.warn("Multiple physics scenes are currently not supported");
else{a.m={qt:!1,p:[]};var c=R.Si+L.timestamp();C.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+R.nd);Y=new Worker(c);y.init(Y,b);W=a}};a.Ov=function(a){return a.m?a.m.qt:!0};a.cleanup=function(){if(W){Y.terminate();W=Y=null;ia.length=0;ma={};for(var a in P)P[a]=0}};a.append_object=function(a,b){var c=a.d;if(!c)throw"No object render: "+a.name;if(a.parent&&c.Qk)return null;var n=[];c.Qk&&d(a,n);if(B(a)||w(a)||t(a)||x(a)||a.b4w_collision){var q,r=a,A=c.Tr,v=r.d,J=r.game,aa=e();if("CAMERA"==r.type)var p=
J.use_collision_bounds?J.collision_bounds_type:"BOX",u=k(p,v),z=v.ji,G=v.ei,z=.5,G=0;else"EMPTY"==r.type?(p="EMPTY",u=null,G=z=0):(p=J.use_collision_bounds?J.collision_bounds_type:"BOX",u=k(p,v),z=v.ji,G=v.ei);var Q=v.g,Xa=v.quat,T=J.use_ghost,R=J.use_sleep,ta=J.mass,S=J.velocity_min,ca=J.velocity_max,N=J.damping,L=J.rotation_damping,P=J.collision_margin,Y=J.collision_group,Z=J.collision_mask,oa=v.Pc.Ba,qa=f(u),lc=r.b4w_correct_bounding_offset,xb;var Jb=p;if(n.length){var Da=[],Va={};Va.quat=new Float32Array([0,
0,0,1]);Va.trans=new Float32Array(3);Va.worker_bounding=qa;Va.bounding_type=Jb;Da.push(Va);M.invert(v.T,ja);I.invert(v.quat,ea);for(var ka=0;ka<n.length;ka++){var ob={},ga=n[ka],Ra=ga.game.collision_bounds_type,Ea=new Float32Array(4),hb=new Float32Array(3);F.transformMat4(ga.d.g,ja,hb);I.multiply(ea,ga.d.quat,Ea);ob.trans=hb;ob.quat=Ea;ob.bounding_type=Ra;ob.worker_bounding=f(k(Ra,ga.d));Da.push(ob)}xb=Da}else xb=[];y.t(y.Nt,aa,Q,Xa,A,T,R,ta,S,ca,N,L,P,Y,Z,p,qa,oa,z,G,xb,lc);ia.push(r);ma[aa]=r;var ib=
h(aa);ib.type=A;ib.cn=ta;ib.Xj=T;q=ib;a.m=q;var ya={D:null,ub:q};b.m.p.push(ya)}else for(var La=a.n||[],Mb=0;Mb<La.length;Mb++){var zb=La[Mb],vc;if(vc="PHYSICS"==zb.type){var ac;a:{for(var lb=b.m.p,mc=0;mc<lb.length;mc++){var wc=lb[mc].D;if(wc&&wc.id==zb.id){ac=!0;break a}}ac=!1}vc=!ac}if(vc)if(zb.zc.I)if(zb.pf&&b.d.Wa){var jb=zb,Ab=W,Ia=H.ha(Ab,"MAIN_OPAQUE");y.t(y.Vt,Ia.qf);if(Ia.Wa&&jb.RB){var za={};za.dst_noise_scale0=jb.dst_noise_scale0;za.dst_noise_scale1=jb.dst_noise_scale1;za.dst_noise_freq0=
jb.dst_noise_freq0;za.dst_noise_freq1=jb.dst_noise_freq1;za.dir_min_shore_fac=jb.dir_min_shore_fac;za.dir_freq=jb.dir_freq;za.dir_noise_scale=jb.dir_noise_scale;za.dir_noise_freq=jb.dir_noise_freq;za.dir_min_noise_fac=jb.dir_min_noise_fac;za.dst_min_fac=jb.dst_min_fac;za.waves_hor_fac=jb.waves_hor_fac;var Fa=Ia.rf,sb=Ia.yg;Ia.Sk?y.t(y.Co,za,Ia.df[0],Ia.df[1],Ia.cf[0],Ia.cf[1],Ia.gh,Fa,sb,Ia.sh,Ab.d.Fn):y.t(y.Co,za,0,0,0,0,0,Fa,sb,0,null)}}else{var eb;if(zb.AB){var Nb=a,Bb=zb,Cb=e(),tb=Bb.zc;y.t(y.Tt,
Cb,tb.B[0].a_position,tb.ba||null,Nb.d.g,Bb.yp,Bb.xp,Bb.zp);var yb=h(Cb);yb.Xj=!0;eb=yb}else{var Oa=a,va=zb,mb=e(),Ob=va.zc;y.t(y.Ut,mb,Ob.B[0].a_position,Ob.ba||null,Oa.d.g,va.ji,va.ei,va.yp,va.xp,va.zp);eb=h(mb)}q=eb;q.id=zb.jc;ya={D:zb,ub:q};b.m.p.push(ya)}else C.error("Object "+a.name+" has collision material with no assigned vertices")}if(B(a)||w(a)){var pa=a,pb=pa.m.N;B(pa)?(pa.j.type=10,y.t(y.Ot,pb,pa.j.RA,pa.j.TA,pa.j.SA,pa.j.TB,pa.j.Uy)):w(pa)&&(pa.j.type=20,y.t(y.Mt,pb,pa.j.km,pa.j.po,pa.j.qo));
if(pa.j.ig){var ba=pa.j.ig;switch(pa.j.type){case 10:l(ba[1],pa,pb,!0);l(ba[0],pa,pb,!0);l(ba[3],pa,pb,!1);l(ba[2],pa,pb,!1);break;case 20:for(var ub=0;ub<ba.length;ub++)l(ba[ub],pa,pb,!1)}}pa.m.id=pa.b4w_vehicle_settings.name;E(a,a.j)}else if(t(a)){var Ya=a.d,Aa=a.m,xa=Ya.Mb.max_y-Ya.Mb.min_y,qb=Aa.N,Vb=a.b4w_character_settings,$a=Vb.walk_speed,Kb=Vb.run_speed,Lb=Vb.step_height,Pb=Vb.jump_strength,xc=Vb.waterline,Qb=O.Vw(a);y.t(y.Pt,qb,Qb,xa,$a,Kb,Lb,Pb,xc);Aa.is_character=!0}else if(x(a)){var kb=
a,ab=kb.m.N;y.t(y.St,ab,kb.Fc.km,kb.Fc.po,kb.Fc.qo);if(kb.Fc.qj)for(var hc=kb.Fc.qj,Fb=0;Fb<hc.length;Fb++){var D=hc[Fb],bc=D.d.g,nb=kb.d.T,Db=new Float32Array(16);M.invert(nb,Db);var Gb=new Float32Array(3);F.transformMat4(bc,Db,Gb);y.t(y.Lt,ab,Gb,D.wv)}kb.m.Ay=!0}else a.b4w_collision&&(q.id=a.b4w_collision_id);for(Mb=0;Mb<ia.length;Mb++)if(a=ia[Mb],a.m){var da=a;if(!g(da))for(var db=0;db<da.constraints.length;db++){var Ma=da.constraints[db],vb=Ma.target,ua=Ma.pivot_type;if("RIGID_BODY_JOINT"==Ma.type&&
vb.m){var Rb=new Float32Array([Ma.pivot_x,Ma.pivot_y,Ma.pivot_z]),Ja,$c=new Float32Array([Ma.axis_x,Ma.axis_y,Ma.axis_z]);Ja=O.euler_to_quat($c,new Float32Array(4));var Sa=M.fromRotationTranslation(Ja,Rb,new Float32Array(16)),nc=M.multiply(da.d.T,Sa,new Float32Array(16)),yc=M.invert(vb.d.T,new Float32Array(16)),Hc=M.multiply(yc,nc,yc),ic=O.eh(Hc),Hb=O.matrix_to_quat(Hc),Ta=Ma,Ha={};Ha.use_limit_x=Ta.use_limit_x;Ha.use_limit_y=Ta.use_limit_y;Ha.use_limit_z=Ta.use_limit_z;Ha.use_angular_limit_x=Ta.use_angular_limit_x;
Ha.use_angular_limit_y=Ta.use_angular_limit_y;Ha.use_angular_limit_z=Ta.use_angular_limit_z;Ha.limit_max_x=Ta.limit_max_x;Ha.limit_min_x=Ta.limit_min_x;Ha.limit_max_y=Ta.limit_max_y;Ha.limit_min_y=Ta.limit_min_y;Ha.limit_max_z=Ta.limit_max_z;Ha.limit_min_z=Ta.limit_min_z;Ha.limit_angle_max_x=Ta.limit_angle_max_x;Ha.limit_angle_min_x=Ta.limit_angle_min_x;Ha.limit_angle_max_y=Ta.limit_angle_max_y;Ha.limit_angle_min_y=Ta.limit_angle_min_y;Ha.limit_angle_max_z=Ta.limit_angle_max_z;Ha.limit_angle_min_z=
Ta.limit_angle_min_z;m(ua,da,Rb,Ja,vb,ic,Hb,Ha,null,null)}}}};a.mx=c;a.update=function(){for(var a=0;a<ia.length;a++){var b=ia[a],c=b.m;if(c.ef&&c.Ql){var d=performance.now()/1E3-c.Ql,d=Math.min(d,10/R.nd),d=d-1/R.nd;ca.$y&&(d=0);var e=Z;N.wy(c.Rl,d,c.hr,c.Po,Z);z.gA(b,e);z.w(b);n(b);if(b.j)for(var c=b,d=c.j.ig,e=c.d.xb,f=Z,g=0;g<d.length;g++){var h=d[g];N.multiply(e,c.j.Fi[g],f);z.set_tsr(h,f);z.w(h)}b.j&&b.j.zh&&(c=b.j,d=c.zh)&&(e=b.j.Ks,h=ja,f=b.d.g,g=b.d.quat,O.bo(b.j.Ls,g,f,h),O.eh(h,d.d.g),
O.matrix_to_quat(h,d.d.quat),h=qa,O.co(e,g,f,h),e=ea,I.setAxisAngle(h,-c.yh*c.Qn*2*Math.PI,e),I.multiply(e,d.d.quat,d.d.quat),z.w(d));b.j&&b.j.Mn&&(c=b.j,d=c.Mn)&&(f=b.j.Fs,e=ja,g=b.d.g,h=b.d.quat,O.bo(b.j.Gs,h,g,e),O.eh(e,d.d.g),O.matrix_to_quat(e,d.d.quat),e=qa,O.co(f,h,g,e),f=ea,g=Math.abs(c.speed)*c.Es,g>c.fn&&(g=c.fn),I.setAxisAngle(e,-g,f),I.multiply(f,d.d.quat,d.d.quat),z.w(d));b.j&&b.j.Un&&(c=b.j,d=c.Un)&&(e=b.j.Rs,h=ja,f=b.d.g,g=b.d.quat,O.bo(b.j.Ss,g,f,h),O.eh(h,d.d.g),O.matrix_to_quat(h,
d.d.quat),b=qa,O.co(e,g,f,b),e=ea,I.setAxisAngle(b,-Math.abs(c.Pg)*c.Np,e),I.multiply(e,d.d.quat,d.d.quat),z.w(d))}}if(a=W)a=H.ha(a,"MAIN_OPAQUE"),a.Wa&&0<a.Wa.waves_height&&(b=F.length(a.Xi),y.t(y.su,a.time*b))};a.Ix=function(){return W};a.pause=function(){W&&y.t(y.fu)};a.resume=function(){W&&y.t(y.iu)};a.enable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(!a.ef){var b=a.N;a.ef=!0;y.t(y.du,b)}};a.disable_simulation=function(a){a=a.m;if(!a)throw"No object physics";if(a.ef){var b=
a.N;a.ef=!1;y.t(y.cu,b)}};a.has_physics=function(a){return a.m?!0:!1};a.has_dynamic_physics=function(a){return(a=a.m)&&a.ef&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.cn&&0==a.Xj?!0:!1};a.has_simulated_physics=function(a){return(a=a.m)&&a.ef?!0:!1};a.set_gravity=function(a,b){y.t(y.ru,a.m.N,b)};a.oy=g;a.apply_constraint=m;a.clear_constraint=function(a){a=a.m;y.t(y.hu,a.Bj);a.Bj=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=N.create_sep(c,1,d,Z);f=N.create_sep(f,1,g,oa);N.invert(c,
c);N.multiply(f,c,c);z.get_tsr(e,f);N.multiply(f,c,c);z.set_tsr(b,c);z.w(b);a.set_transform(b,b.d.g,b.d.quat)};a.set_transform=function(a,b,c){N.set_sep(a.d.g,1,a.d.quat,a.m.Rl);var d=y.tq(y.dj);d.body_id=a.m.N;d.trans=b;d.quat=c;y.t(y.dj,d)};a.sync_transform=n;a.apply_velocity=function(a,b,c,d){r(a,b,c,d,u);a=a.m.N;y.t(y.Gd,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(u[0]),f=Math.abs(u[1]),g=Math.abs(u[2]);u[0]=e?u[0]/e*Math.max(e,b):0;u[1]=f?u[1]/f*Math.max(f,c):0;u[2]=g?u[2]/g*
Math.max(g,d):0;y.t(y.Eo,a,u[0],u[1],u[2])};a.apply_velocity_world=function(a,b,c,d){a=a.m.N;y.t(y.Gd,a);y.t(y.Eo,a,b,c,d)};a.apply_force=function(a,b,c,d){r(a,b,c,d,u);a=a.m.N;y.t(y.Gd,a);y.t(y.Wt,a,u[0],u[1],u[2])};a.apply_torque=function(a,b,c,d){r(a,b,c,d,u);a=a.m.N;y.t(y.Gd,a);y.t(y.Yt,a,u[0],u[1],u[2])};a.set_character_move_dir=function(a,b,c){a=a.m.N;y.t(y.Gd,a);y.t(y.lu,a,b,c)};a.set_character_move_type=function(a,b){y.t(y.mu,a.m.N,b)};a.set_character_walk_velocity=function(a,b){y.t(y.qu,
a.m.N,b)};a.set_character_run_velocity=function(a,b){y.t(y.ou,a.m.N,b)};a.set_character_fly_velocity=function(a,b){y.t(y.ju,a.m.N,b)};a.character_jump=function(a){y.t(y.Zt,a.m.N)};a.character_rotation_inc=function(a,b,c){y.t(y.$t,a.m.N,b,c)};a.set_character_rotation=function(a,b,c){y.t(y.nu,a.m.N,b,c)};a.set_character_rotation_h=function(a,b){y.t(y.ku,a.m.N,b)};a.set_character_rotation_v=function(a,b){y.t(y.pu,a.m.N,b)};a.MC=function(){return!1};a.KC=function(){return!1};a.IC=function(){C.error("check_collision() deprecated");
return!1};a.JC=function(){C.error("check_collision_any() deprecated");return!1};a.LC=function(){C.error("check_ray_hit() deprecated");return!1};a.yE=function(){C.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.m,f=e.N;b=b||"ANY";for(var g=0;g<e.fd.length;g++){var h=e.fd[g];if(h.jc==b&&h.callback==c)return}g=[];a=a.m.N;h=[];A(b,W,h,null);for(var k=0;k<h.length;k++){var l=h[k];a<l?g.push([a,l]):a>l&&g.push([l,a])}h={jc:b,callback:c,qk:g,Rr:new Uint8Array(g.length),
ln:d||!1};e.fd.push(h);y.t(y.Gd,f);y.t(y.Qt,g,d)};a.remove_collision_test=function(a,b,c){a=a.m;b=b||"ANY";for(var d=0;d<a.fd.length;d++){var e=a.fd[d];if(e.jc==b&&e.callback==c){a.fd.splice(d,1);d--;for(var e=e.qk,f=W.m.p,g=0;g<f.length;g++)for(var h=f[g].ub,k=0;k<h.fd.length;k++)for(var l=h.fd[k],m=0;m<l.qk.length;m++)for(var n=l.qk[m],q=0;q<e.length;q++){var r=e[q];n[0]===r[0]&&n[1]===r[1]&&(e.splice(q,1),q--)}e.length&&y.t(y.gu,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.m;c?(y.t(y.Xt,
c.N),c.zj=b):C.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=function(a){var b=a.m;b?(y.t(y.au,b.N),b.zj=null):C.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.m;if(g){a=g.N;b=b||"ANY";c={L:new Float32Array(c),da:new Float32Array(d),local:e,callback:f,jc:b,ke:{}};A(b,W,null,c.ke);delete c.ke[a];for(var h in c.ke)c.ke[h]=1;g.Xe.push(c);v(a,g.Xe)}else C.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,
d,e){if(b=a.m){a=b.N;for(var f=0;f<b.Xe.length;f++){var g=b.Xe[f];O.yj(g.L,c)&&O.yj(g.da,d)&&g.local==e&&(b.Xe.splice(f,1),f--)}v(a,b.Xe)}else C.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.j;c.Pg=b;E(a,c)};a.vehicle_steer=function(a,b){var c=a.j;c.yh=b;E(a,c)};a.vehicle_brake=function(a,b){var c=a.j;c.Uh=b;E(a,c)};a.is_vehicle_chassis=B;a.is_vehicle_hull=w;a.zy=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||
"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.yy=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.By=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.Xq=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Wq=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Yq=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?
!0:!1};a.get_vehicle_speed=function(a){return a.j.speed};a.UB=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=t;a.PD=x;a.Xx=function(){return S};a.Mw=function(){y.t(y.bu)};a.zz=function(a){var b=ia.indexOf(a);-1!=b?(ia.splice(b,1),a.m&&delete ma[a.m.N]):C.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,p){function d(a,b){if(a)for(var c=ja(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}Jb[b.id]=null;Da[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=ha.zq(a));d=a.width;a=a.height;Ga.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Va)&&c&&Ga.warn("image",b,"is not from app root.")}function c(a,b,c,d,e,f){d=b.q;if(!d)throw"Nothing requested";aa.enqueue([[d,aa.AT_JSON,
d]],function(d,f,g,k){if(d){Ga.log("%cLOAD METADATA","color: #616",k);h(d);for(var l in d)a[l]=d[l];(d=a.binaries[0].binfile)?b.bp=d:(J.us(b,"load_binaries"),J.us(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)Ga.dx(a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)Ga.ex(a.b4w_export_warnings[d]);e(b,c)}else J.Ko(b)},null,function(a){f(b,c,a)})}function e(a,b,c,d,e,f){d=P(b.q)+b.bp;if(!d)throw"Binary data is missing";
aa.enqueue([[d,aa.AT_ARRAYBUFFER,d]],function(d,f,g,h){d?(Ga.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c)):J.Ko(b)},null,function(a){f(b,c,a)})}function h(a){var b=Pa.hn.split(".").map(function(a){return a|0}),c=a.b4w_format_version.split(".").map(function(a){return a|0});c[0]<b[0]&&Za.oa("Incompatible file version: "+a.b4w_format_version+", required: "+Pa.hn+". Reexport scene with the latest B4W addon to fix it.");c[1]<b[1]&&Ga.warn("Version mismatch. File version: "+ +a.b4w_format_version+
", required: "+Pa.hn+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");Pa.Zm=parseFloat(a.b4w_format_version)}function k(a,b,c,d,e){d=a.bin_data;var g=a.binaries[0],h=a.objects,k=a.meshes;a=a.actions;for(var l=Za.Jv(),J=["indices"],m=["normal","tangent"],n=["color","group"],aa=["position","texcoord","texcoord2"],q=0;q<k.length;q++)for(var r=k[q].submeshes,t=0;t<r.length;t++)for(var A in r[t]){var v=r[t][A][1];if(-1!=J.indexOf(A)){var p=4*r[t][A][0]+g["int"],
wa=r[t],K=A,u=d;if(l)var w=new Uint32Array(u,p,v);else for(var w=new Uint32Array(v),u=new DataView(u),V=0;V<v;V++)w[V]=u.getUint32(p+4*V,!0);wa[K]=w}else if(-1!=aa.indexOf(A))p=4*r[t][A][0]+g["float"],r[t][A]=f(d,p,v,l);else if(-1!=m.indexOf(A)){p=2*r[t][A][0]+g["short"];wa=r[t];K=A;u=d;w=new Float32Array(v);u=new DataView(u);for(V=0;V<v;V++)w[V]=u.getInt16(p+2*V,!0)/32767;wa[K]=w}else if(-1!=n.indexOf(A)){p=2*r[t][A][0]+g.ushort;wa=r[t];K=A;u=d;w=new Float32Array(v);u=new DataView(u);for(V=0;V<v;V++)w[V]=
u.getUint16(p+2*V,!0)/65535;wa[K]=w}}for(A=0;A<h.length;A++)for(k=h[A].particle_systems,J=0;J<k.length;J++)m=k[J],m.transforms=f(d,4*m.transforms[0]+g["float"],m.transforms[1],l);for(h=0;h<a.length;h++){A=a[h];var k=A.fcurves,J=A.frame_range,n=J[0],aa=J[1],q=X.Mx(n,aa),J=null,t=r=!1,x;for(x in k)r|=-1<x.indexOf("rotation_euler"),t|=-1<x.indexOf("rotation_quaternion");m=[];for(x in k)if(r&&t&&-1<x.indexOf("rotation_euler"))delete k[x];else{var v=k[x],y;for(y in v)p=v[y],wa=f(d,g["float"]+4*p.bin_data_pos[0],
p.bin_data_pos[1],l),K=new Float32Array(q),null===J&&(J=new Int8Array(q)),X.fv(p,wa,K,J,n,aa),p.hc=K;-1<x.indexOf("rotation_euler")&&(X.lx(k[x]),m.push(x))}for(n=0;n<m.length;n++)aa=m[n],q=aa.replace("euler","quaternion"),k[q]=k[aa],delete k[aa];A.Cu=J}e(b,c)}function f(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function l(a,b,c,d,e){0===b.id&&(ka=a);var f=a.cameras,h=a.groups,k=a.materials,l=a.meshes,
J=a.node_groups,n=a.objects,aa=a.particles,q=a.scenes,r=a.speakers,t=a.textures,A=a.worlds;J||(Ga.warn('"node_groups" datablock undefined. reexport main scene.'),J=a.node_groups=[]);for(var v="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),p={},wa=0;wa<v.length;wa++)for(var K=a[v[wa]],u=0;u<K.length;u++){var w=K[u];p[w.uuid]=w}for(var V=0;V<q.length;V++){for(var x=q[V],y=x.objects,U=0;U<y.length;U++)B(y,
U,p);x.camera&&B(x,"camera",p);x.world&&B(x,"world",p)}for(V=0;V<h.length;V++)for(var fa=h[V].objects,U=0;U<fa.length;U++)B(fa,U,p);for(V=0;V<n.length;V++){var I=n[V];I.dupli_group&&B(I,"dupli_group",p);I.parent&&B(I,"parent",p);if(I.animation_data){var z=I.animation_data;z.action&&B(z,"action",p);if(z.nla_tracks)for(U=0;U<z.nla_tracks.length;U++)for(var ha=z.nla_tracks[U],C=0;C<ha.strips.length;C++)ha.strips[C].action&&B(ha.strips[C],"action",p)}switch(I.type){case "MESH":if(!I.data)throw"mesh not found for object "+
I.name;B(I,"data",p);for(var G=I.modifiers,U=0;U<G.length;U++){var M=G[U];"ARMATURE"==M.type?B(M,"object",p):"CURVE"==M.type&&B(M,"object",p)}var ta=I.particle_systems;if(ta)for(U=0;U<ta.length;U++)B(ta[U],"settings",p);break;case "ARMATURE":B(I,"data",p);for(var H=I.pose.bones,Xa=I.data.bones,U=0;U<H.length;U++){var R=H[U];R.bone=Xa[R.bone];for(var sa=R.parent_recursive,C=0;C<sa.length;C++)sa[C]=H[sa[C]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":B(I,"data",p)}var F=I.constraints;
if(F)for(U=0;U<F.length;U++){var ra=F[U];ra.target&&B(ra,"target",p)}var Na=I.lod_levels;if(Na)for(U=0;U<Na.length;U++){var S=Na[U];S.object&&B(S,"object",p)}}for(V=0;V<l.length;V++)for(var D=l[V].materials,U=0;U<D.length;U++)B(D,U,p);for(V=0;V<k.length;V++){for(var ca=k[V],L=ca.texture_slots,U=0;U<L.length;U++)B(L[U],"texture",p);var P=ca.node_tree;P&&E(P,p)}for(V=0;V<J.length;V++)(P=J[V].node_tree)&&E(P,p);for(V=0;V<t.length;V++){var gb=t[V],Y=gb.type;"IMAGE"!=Y&&"ENVIRONMENT_MAP"!=Y||B(gb,"image",
p)}for(V=0;V<f.length;V++){var W=f[V];W.dof_object&&B(W,"dof_object",p)}for(V=0;V<r.length;V++){var Ma=r[V];Ma.sound&&B(Ma,"sound",p);if(Ma.animation_data&&(z=Ma.animation_data,z.action&&B(z,"action",p),z.nla_tracks))for(U=0;U<z.nla_tracks.length;U++)for(ha=z.nla_tracks[U],C=0;C<ha.strips.length;C++)ha.strips[C].action&&B(ha.strips[C],"action",p)}for(V=0;V<aa.length;V++){for(var vb=aa[V],L=vb.texture_slots,U=0;U<L.length;U++)B(L[U],"texture",p);vb.dupli_group&&B(vb,"dupli_group",p);vb.dupli_object&&
B(vb,"dupli_object",p)}for(V=0;V<A.length;V++)if(L=A[V].texture_slots)for(U=0;U<L.length;U++)B(L[U],"texture",p);Q.Gv(a);for(var ua=a.textures,Rb=g(a)?a.scenes[0].b4w_anisotropic_filtering:m().b4w_anisotropic_filtering,Ja=0;Ja<ua.length;Ja++)g(a)||"SCENE"!=ua[Ja].b4w_source_type||(ua[Ja].b4w_source_id=""),Qa.Dw(ua[Ja],Rb,a.scenes,b.id);for(var Rc={},xb=a.objects,ga=0;ga<xb.length;ga++){var ia=xb[ga];if("MESH"===ia.type&&!ia.particle_systems.length)for(var Da=ia.data,ma=Da.name,ea=Da.submeshes,Va=
Da.materials,Pa=0;Pa<ea.length;Pa++)0!==ea[Pa].base_length||Rc[ma]||(Va[Pa]&&Ga.warn('material "'+Va[Pa].name+'" is not assigned to any face (object "'+ia.name+'").'),Rc[ma]=!0)}for(var Jb=a.meshes,qa=0;qa<Jb.length;qa++){var oa=Jb[qa];oa.materials.length||oa.uv_textures.length&&Ga.warn('mesh "'+oa.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,
fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,
b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var Ra=a.meshes,ob=Za.keysearch("name","DEFAULT",a.materials),ya=0;ya<Ra.length;ya++){var Gc=
Ra[ya];0==Gc.materials.length&&Gc.materials.push(ob)}for(var Ea=a.actions,ib=b.id,La=0;La<Ea.length;La++){var dc=Ea[La];dc.Eu=ib;X.Mu(dc)}for(var Sb=a.scenes,rb=0;rb<Sb.length;rb++){for(var ed=Sb[rb],oc=T.Hl(ed,"ALL"),bb=[],Xb=0;Xb<oc.length;Xb++)for(var Jc=oc[Xb].particle_systems,zc=0;zc<Jc.length;zc++){var Tb=Jc[zc].settings;if("HAIR"==Tb.type)if("OBJECT"==Tb.render_type)na.Pk(Tb.dupli_object,!0);else if("GROUP"==Tb.render_type){for(var Ac=Tb.dupli_group,Kc=T.Hl(ed,"EMPTY"),Eb=0;Eb<Kc.length;Eb++)Kc[Eb].dupli_group==
Ac&&bb.push(Kc[Eb]);for(Eb=0;Eb<Ac.objects.length;Eb++)na.Pk(Ac.objects[Eb],!0)}else Ga.warn("render type",Tb.render_type,"not supported for particle systems ("+Tb.name+").")}for(Xb=0;Xb<bb.length;Xb++)O(bb[Xb],[ed])}Z(a,b.id);for(var fd=a.scenes,gd=0;gd<fd.length;gd++){for(var rd=fd[gd],Bc=[],Lc=[],Mc=fd[gd].objects,Ib=0;Ib<Mc.length;Ib++){var od=Mc[Ib];N(Mc,od,Bc,Lc);var ud=od.dupli_group;if(ud)for(var sd=ud.objects,pd=0;pd<sd.length;pd++)N(sd,sd[pd],Bc,Lc)}for(Ib=0;Ib<Lc.length;Ib++)O(Lc[Ib],[rd]);
for(Ib=0;Ib<Bc.length;Ib++)Za.$u(Bc[Ib][0],Bc[Ib][1])}Z(a,b.id);var cb=ja(a,b.id);Q.kv(cb,a.scenes);for(Ja=0;Ja<cb.length;Ja++){var Ub=cb[Ja];!g(a)&&Ub.parent&&-1<hb.indexOf(Ub.parent.type)&&(Ub.parent="");na.Pk(Ub,!1);Ub.d.nc=b.id}for(var Sc=0;Sc<cb.length;Sc++){var Tc=cb[Sc];if("MESH"==Tc.type){var vd=X.get_first_armature_object(Tc);if(vd){var Uc=vd.d;if(Uc.Ae){var pc=Tc.d.Gc,qc=[],rc;for(rc in pc){var Vc=pc[rc];qc.push(4*Vc.ai,4*Vc.hp)}Uc.nr.push(qc)}Uc.Hk.push(Tc.d)}}}for(var Wc=-1,hd=-1,Cc=X.sq(),
Nc=0;Nc<cb.length;Nc++){var Xc=cb[Nc],wb=Xc.d;if(Za.is_mesh(Xc)&&wb.ah){var Dc=wb.he;Dc>Wc&&(Wc=Dc);Cc>=Dc&&Dc>hd&&(hd=Dc)}}for(Nc=0;Nc<cb.length;Nc++)Xc=cb[Nc],wb=Xc.d,Za.is_mesh(Xc)&&wb.ah&&(wb.ii=!0,Wc<Cc?wb.he=Wc:wb.he<=Cc?wb.he=hd:(Ga.warn('too many bones for "'+Xc.name+'" / '+wb.he+" bones (max "+Cc+" with blending, "+2*Cc+" without blending). Blending between frames will be disabled."),wb.he=Wc,wb.ii=!1),wb.ii=wb.ii&&!lc.eq);for(var id=0;id<cb.length;id++){var Yb=cb[id];if(Za.is_mesh(Yb)){var Yc=
Yb.lod_levels.length;if(Yc)for(var Oc=Yb,Zb=0;Zb<Yc;Zb++){var sc=Yb.lod_levels[Zb].object;if(!sc){Oc.d.ak=!0;Oc.d.Se=Yb.lod_levels[Zb].distance;break}sc.d.Yf=Yb.d.Yf;Oc.d.Se=Yb.lod_levels[Zb].distance;sc.d.ui=Yb.lod_levels[Zb].distance;if(Yb.lod_levels[Zb+1])sc.d.Se=Yb.lod_levels[Zb+1].distance;else{sc.d.ak=!0;sc.d.Se=1E4;break}Oc.d.ak=!1;Oc=sc}}}for(var Pc=0;Pc<cb.length;Pc++){var la=cb[Pc];if(la.b4w_vehicle){var Ua=la.b4w_vehicle_settings;if("CHASSIS"==Ua.part){la.j={};la.j.cq=Ua.force_max;la.j.ip=
Ua.brake_max;la.j.RA=Ua.suspension_compression;la.j.TA=Ua.suspension_stiffness;la.j.SA=Ua.suspension_damping;la.j.TB=Ua.wheel_friction;la.j.jE=Ua.roll_influence;la.j.Uy=Ua.max_suspension_travel_cm;la.j.Pg=0;la.j.Uh=1;la.j.yh=0;la.j.speed=0;la.j.ig=[];la.j.Fi=[];la.j.zh=null;for(var jd=la.xa?la.xa.dupli_group.objects:cb,tc=0;tc<jd.length;tc++){var Ka=jd[tc];if(Ka.b4w_vehicle){var Wa=Ka.b4w_vehicle_settings;if(Ba.zy(Ka)&&Ua.name==Wa.name){var qd=Ba.UB(Ka.b4w_vehicle_settings.part);la.j.ig[qd]=Ka;la.j.Fi[qd]=
new Float32Array(8)}else if(Ba.Xq(Ka)&&Ua.name==Wa.name){la.j.zh=Ka;la.j.Qn=Wa.steering_max;la.j.Js=Wa.steering_ratio;la.j.Sq=Wa.inverse_control;var fb=Ca.invert(la.d.T,new Float32Array(16)),kd=Ca.multiply(fb,Ka.d.T,fb);la.j.Ls=kd;var Ec=new Float32Array([1,0,0,0]);uc.transformMat4(Ec,kd,Ec);la.j.Ks=Ec}else if(Ba.Wq(Ka)&&Ua.name==Wa.name){la.j.Mn=Ka;la.j.Es=Wa.speed_ratio;la.j.fn=Wa.max_speed_angle;var fb=Ca.invert(la.d.T,new Float32Array(16)),ec=Ca.multiply(fb,Ka.d.T,fb);la.j.Gs=ec;var Fc=new Float32Array([1,
0,0,0]);uc.transformMat4(Fc,ec,Fc);la.j.Fs=Fc}else if(Ba.Yq(Ka)&&Ua.name==Wa.name){la.j.Un=Ka;la.j.Np=Wa.delta_tach_angle;var fb=Ca.invert(la.d.T,new Float32Array(16)),$b=Ca.multiply(fb,Ka.d.T,fb);la.j.Ss=$b;var fc=new Float32Array([1,0,0,0]);uc.transformMat4(fc,$b,fc);la.j.Rs=fc}}}if(4!=la.j.ig.length)throw"Not enough wheels for chassis "+la.name;}else if("HULL"==Ua.part){la.j={};la.j.ig=[];la.j.Fi=[];la.j.cq=Ua.force_max;la.j.ip=Ua.brake_max;la.j.km=Ua.floating_factor;la.j.po=Ua.water_lin_damp;
la.j.qo=Ua.water_rot_damp;la.j.Pg=0;la.j.Uh=1;la.j.yh=0;la.j.speed=0;la.j.zh=null;for(var td=la.xa?la.xa.dupli_group.objects:cb,tc=0;tc<td.length;tc++)Ka=td[tc],Ka.b4w_vehicle&&(Wa=Ka.b4w_vehicle_settings,Ba.yy(Ka)&&Ua.name==Wa.name?(la.j.ig.push(Ka),la.j.Fi.push(new Float32Array(8))):Ba.Xq(Ka)&&Ua.name==Wa.name?(la.j.zh=Ka,la.j.Qn=Wa.steering_max,la.j.Js=Wa.steering_ratio,la.j.Sq=Wa.inverse_control,fb=Ca.invert(la.d.T,new Float32Array(16)),kd=Ca.multiply(fb,Ka.d.T,fb),la.j.Ls=kd,Ec=new Float32Array([1,
0,0,0]),uc.transformMat4(Ec,kd,Ec),la.j.Ks=Ec):Ba.Wq(Ka)&&Ua.name==Wa.name?(la.j.Mn=Ka,la.j.Es=Wa.speed_ratio,la.j.fn=Wa.max_speed_angle,fb=Ca.invert(la.d.T,new Float32Array(16)),ec=Ca.multiply(fb,Ka.d.T,fb),la.j.Gs=ec,Fc=new Float32Array([1,0,0,0]),uc.transformMat4(Fc,ec,Fc),la.j.Fs=Fc):Ba.Yq(Ka)&&Ua.name==Wa.name&&(la.j.Un=Ka,la.j.Np=Wa.delta_tach_angle,fb=Ca.invert(la.d.T,new Float32Array(16)),$b=Ca.multiply(fb,Ka.d.T,fb),la.j.Ss=$b,fc=new Float32Array([1,0,0,0]),uc.transformMat4(fc,$b,fc),la.j.Rs=
fc))}}}for(var Qc=0;Qc<cb.length;Qc++){var gc=cb[Qc];if(gc.b4w_floating){var Zc=gc.b4w_floating_settings;if("MAIN_BODY"==Zc.part){gc.Fc={};gc.Fc.km=Zc.floating_factor;gc.Fc.po=Zc.water_lin_damp;gc.Fc.qo=Zc.water_rot_damp;gc.Fc.qj=[];for(var yd=gc.xa?gc.xa.dupli_group.objects:cb,wd=0;wd<yd.length;wd++){var ld=yd[wd];if(ld.b4w_floating){var zd=ld.b4w_floating_settings;Ba.By(ld)&&Zc.name==zd.name&&(gc.Fc.qj.push(ld),ld.wv=ld.b4w_floating_settings.synchronize_position)}}}}}for(Ja=0;Ja<a.scenes.length;Ja++){var xd=
a.scenes[Ja];kc.enabled&&xd.b4w_enable_physics&&(g(a)||!Ba.has_physics(m())&&xd==T.im(a))&&Ba.vy(xd)}e(b,c)}function g(a){return a==ka?!0:!1}function m(){return T.im(ka.scenes)}function n(a,b,c,d,e){!g(a)&&1<a.scenes.length&&(a.scenes=[T.im(a.scenes)],Ga.warn("loading data contains multiple scenes.","Only the first one will be loaded."));d=m();-1==lc.Fa&&(lc.Fa=d.fps);for(var f=0;f<a.scenes.length;f++){var h=a.scenes[f];if(g(a)&&!h.camera)throw"Scene check failed: No camera";for(var k=T.Hl(h,"MESH"),
l=0;l<k.length;l++){var J=k[l],n=Q.cv(J);n&&(a.meshes.push(n),J.data=n)}for(var l=ja(a,b.id),J=a.meshes,n=J.slice(0),aa=0;aa<l.length;aa++){var q=l[aa];"MESH"==q.type&&(q=n.indexOf(q.data),-1<q&&n.splice(q,1))}for(aa=0;aa<n.length;aa++)J.splice(J.indexOf(n[aa]),1);g(a)?(T.Ru(h,a.textures),h.d.Ih.length&&(b.Gm=!0),h.b4w_enable_audio&&ta.Wo(h),l=T.wm(h),J=h.b4w_batch_grid_size):(T.Xu(h,d,a.textures),h.b4w_enable_audio&&!d.i&&ta.Wo(d),l=T.wm(d),J=d.b4w_batch_grid_size);n=[];sa.Ex(l,J,k,d.d.vo,d.d.Ik,
n,d.d.br);g(a)?(T.Oo(h,n),T.wx(l)):T.Oo(d,n)}d=a.materials;if(Gc.Tl&&Pa.dt)for(a=0;a<d.length;a++){k=d[a];l=k.texture_slots;for(f=0;f<l.length;f++)if(J=l[f],n=J.texture,"IMAGE"==n.type||"ENVIRONMENT_MAP"==n.type)h=n.image,h.gc||(-1<h.filepath.indexOf(".dds")?h.gc=!0:(h.gc=!n.b4w_disable_compression&&!J.use_map_normal&&"ENVIRONMENT_MAP"!=n.type&&!n.b4w_shore_dist_map&&"MOVIE"!=h.source,h.gc&&(h.filepath+=".dds")));if(f=k.node_tree)for(k=f.nodes,f=0;f<k.length;f++)h=k[f],"TEXTURE"==h.type&&(l=h.texture)&&
(h=l.image)&&!h.gc&&(h.gc=l.d.jj&&!l.b4w_disable_compression&&"MOVIE"!=h.source,h.gc&&(h.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.gc=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function r(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},h={},k={},l=0;l<d.length;l++){var J=d[l];f[J.uuid]=J;h[J.uuid]=J}for(l=0;l<a.length;l++)J=a[l],g[J.uuid]=J,k[J.uuid]=J;A(a,null,k,h);for(var m in h)m in f||d.push(h[m]);for(m in k)m in g||a.push(k[m]);e(b,c)}function A(a,
b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var k=c[g.uuid],l=k.constraints,g=0;g<l.length;g++){var J=Za.Ef(l[g]);J.name+="_CLONE";h.constraints.push(J)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=Za.Ef(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=h.b4w_anim_behavior,k.b4w_cyclic_animation=
h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=Za.xm(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],b&&(l=Za.Ef(h),h="origin_name"in h?h.origin_name:h.name,l.name=b+"*"+h,l.origin_name=h,v(l),c[l.uuid]=l,e[g.uuid]=l.uuid,g.uuid=l.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],k=Za.Ef(l),k.name=Za.Nk(l.name+"_CLONE"),k.uuid=wa.Mq("Group"+k.name),d[k.uuid]=k,g.uuid=k.uuid,A(k.objects,h.name,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&
h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(Ga.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var m in e)ob[m]=
e[m]}function v(a){a.uuid=wa.Mq("Object"+a.name)}function E(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&B(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in ob&&(e.lamp.uuid=ob[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&B(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];w(f,"from_node",c);w(f,"to_node",c);t(f,"from_socket",f.from_node.outputs);t(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&
B(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&B(e.strips[f],"action",b)}function B(a,b,c){(c=c[a[b].uuid])||Ga.error("Dangling link found:",b,a);a[b]=c}function w(a,b,c){c=Za.keysearch("name",a[b].name,c);a[b]=c}function t(a,b,c){c=Za.keysearch("identifier",a[b].identifier,c);a[b]=c}function x(a,c,d,e,f,g){if(!Pa.do_not_load_resources){for(var h=P(c.q),k=a.images,l={},J=[],m=0;m<k.length;m++){var n=k[m],q=n.uuid;
if("FILE"===n.source||"MOVIE"===n.source){var r=G(n,a.textures);if(!r.length)Ga.warn("image ",n.name," has no users.");else if(!(r[0].b4w_shore_dist_map||"MOVIE"===n.source&&Pa.Zp)){r=qa(h+n.filepath);if("FILE"===n.source){var t=n.gc?aa.AT_ARRAYBUFFER:aa.AT_IMAGE_ELEMENT;Gc.gn&&Pa.Rk&&(r=aa.Oi(r),"dds"==r[1]?(r=aa.Oi(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===n.source&&(Pa.Nc?(r=aa.Oi(r),r=r[0]+".altconv.seq",t=aa.$i):(r=aa.Oi(r),t=ta.detect_video_container(r[1]),r=t!=
r[1]?r[0]+".altconv."+t:r[0]+"."+t,t=aa.aj));J.push([q,t,r]);l[q]=n}}}J.length?(e.Nq=0,aa.enqueue(J,function(f,h,k,m){if(f){if(k==aa.aj||k==aa.$i){if(k==aa.aj)var n=f.videoWidth,r=f.videoHeight;else n=f.images[0].width,r=f.images[0].height;Ga.log("%cLOAD VIDEO "+n+"x"+r,"color: #"+(2048<n||2048<r?"a00":1024<n||1024<r?"aa0":"0a0"),m);-1==m.indexOf(Va)&&Ga.warn("video",m,"is not from app root.")}else b(f,m,!0);h=l[h];m=G(h,a.textures);for(n=0;n<m.length;n++){var r=m[n],q=r.image.filepath;k==aa.$i?(r.d.ls=
f.Yb,Qa.Ri(r.d,f.images,h.gc,q,c.id)):Qa.Ri(r.d,f,h.gc,q,c.id)}}f=++e.Nq/J.length;g(c,d,f)},function(){Ga.log("%cLOADED ALL IMAGES","color: #0a0");f(c,d)})):f(c,d)}}function G(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function C(a,b,c,d,e,f){if(!Pa.do_not_load_resources){a=ja(a,b.id);for(var g=P(b.q),h=[],k={},l=0;l<a.length;l++){var J=a[l];if(q(J)){var m=J.data.sound,n=m.uuid;"BACKGROUND_MUSIC"==ta.ym(J)?(n=Za.sm(),b.Fm=!0):"NONE"!=ta.ym(J)&&Pa.Qq&&(b.Jm=!0);
if(!(n in k)){k[n]=[];m=qa(g+m.filepath);switch(ta.Cs(J)){case ta.Vk:var r=aa.AT_AUDIOBUFFER;break;case ta.wo:r=aa.AT_AUDIO_ELEMENT}var m=aa.Oi(m),t=ta.detect_audio_container(m[1]),m=t!=m[1]?m[0]+".altconv."+t:m[0]+"."+t;h.push([n,r,m])}k[n].push(J)}}h.length?aa.enqueue(h,function(a,e,g,l){if(a)for(Ga.log("%cLOAD SOUND","color: #0aa",l),-1==l.indexOf(Va)&&Ga.warn("sound",l,"is not from app root."),e=k[e],g=0;g<e.length;g++)ta.uB(e[g],a);a=++d.vA/h.length;f(b,c,a)},function(){Ga.log("%cLOADED ALL SOUNDS",
"color: #0aa");e(b,c)}):e(b,c)}}function q(a){return ta.ee(a)&&ta.Cs(a)!=ta.xo?!0:!1}function y(a,b){for(var c=T.Ga(a,"SPEAKER",T.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];ta.ee(e)&&(ta.is_cyclic(e)||b)&&ta.play_def(e)}}function H(a){a=a.d.Ih;for(var b=0;b<a.length;b++)Pa.Nc&&a[b].use_auto_refresh?a[b].d.qh=!0:a[b].d.Ja&&a[b].use_auto_refresh&&a[b].d.Ja.play()}function z(a,b,c,d,e){Na.start();Ga.log("%cSTART NLA","color: #0a0");e(b,c)}function N(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=
b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],h=g.object;if(h){var k=Za.xj(h);k.name=b.name+"_LOD_"+String(f+1);v(k);k.lod_levels=[];c.push([a,k]);d.push(h);g.object=k}}}function O(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function L(a,b,c,d,e){d=!0;for(var f=0;f<a.scenes.length;f++)if(!Ba.Ov(a.scenes[f])){d=!1;break}d&&(e(b,c),Ga.log("%cPHYSICS READY",
"color: #0a0"))}function F(a,b,c,d,e){d=m();for(var f=0;f<a.scenes.length;f++){var h=a.scenes[f],k=g(a)?Ba.has_physics(h):Ba.has_physics(d)||Ba.has_physics(h);g(a)||(h=d);for(var l=0;l<ib.length;l++)for(var J=T.Ga(h,ib[l],T.DATA_ID_ALL),n=0;n<J.length;n++){var aa=J[n];aa.d.nc==b.id&&kc.enabled&&k&&(Ba.append_object(aa,h),b.Xm&&Ba.has_physics(aa)&&Ba.disable_simulation(aa))}}e(b,c)}function I(a,c,d,e,f){var g={};e=[];for(var h=a.scenes,k=0;k<a.scenes.length;k++){var l=h[k];if(l.d.Wa&&(l=l.d.Wa.Gk)&&
"FILE"===l.source){var J=l.uuid,m=qa(P(c.q)+l.filepath);e.push([J,l.gc?aa.AT_ARRAYBUFFER:aa.AT_IMAGE_ELEMENT,m]);g[J]=l}}e.length?aa.enqueue(e,function(d,e,f,k){if(d){b(d,k,!0);e=g[e];k=G(e,a.textures);for(f=0;f<k.length;f++){var l=k[f];Qa.Ri(l.d,d,e.gc,l.image.filepath,c.id)}for(f=0;f<h.length;f++)if(k=h[f],k.d.Wa.Gk===e){var J=d,m=document.createElement("canvas"),l=e.size[0],n=e.size[1];m.width=l;m.height=n;m=m.getContext("2d");m.drawImage(J,0,0);J=m.getImageData(0,0,l,n).data;m=new Float32Array(4);
m[0]=1/16581375;m[1]=1/65025;m[2]=1/255;m[3]=1;for(var l=l*n,n=new Float32Array(l),aa=0;aa<l;aa++)n[aa]=m[1]*J[4*aa+2]+m[2]*J[4*aa+3];k.d.Fn=n}}},function(){f(c,d)}):f(c,d)}function M(a,c,d,e,f){if(Pa.antialiasing&&Pa.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var k=T.ha(e,g[h]);k&&a.push(k)}if(a.length){e=[];h=aa.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,ra.Sb.smaa_search_texture_path]);
e.push(["AREA_TEXTURE",h,ra.Sb.smaa_area_texture_path]);for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.ka;for(h=0;h<a.length;h++)if(g=a[h],"u_search_tex"==g.da)var l=g.qa;else if("u_area_tex"==g.da)var J=g.qa;break}e.length?aa.enqueue(e,function(a,d,e,f){a&&(b(a,f,!1),d="SEARCH_TEXTURE"==d?l:J,d.source="IMAGE",d.$o=!0,Qa.Ri(d,a,-1!=f.indexOf(".dds")?1:0,f,c.id),Qa.En(d,Qa.r,Qa.r))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function R(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=
a.scenes[c];g(a)||(e=m());for(var f=T.Ga(e,"LAMP",T.DATA_ID_ALL),h=0;h<f.length;h++){var k=f[h];k.d.nc==b.id&&(b.Xm&&Za.is_mesh(k)&&T.hide_object(k),d.dl.push({ks:e,obj:k}))}f=T.Ga(e,"ALL",T.DATA_ID_ALL);for(h=0;h<f.length;h++)k=f[h],"LAMP"!=k.type&&k.d.nc==b.id&&(b.Xm&&Za.is_mesh(k)&&T.hide_object(k),d.dl.push({ks:e,obj:k}))}}function ca(a,b,c,d,e,f){e=d.dl;var g=d.xr;e.length?(a=e[g].obj,g=e[g].ks,T.append_object(g,a,!1),-1!=ya.indexOf(a.type)&&g.b4w_enable_audio&&ta.append_object(a,g),U.Tq(a)&&
U.append(a),d=++d.xr/e.length,"LAMP"==a.type&&T.uA(g),null!=a.d.lc&&T.Zs(g,a),a.d.vc&&"PLANE"==a.d.je&&g.d.wb&&(T.lv(a,g),T.bt(a.d.sc,g))):d=1;f(b,c,d)}function S(a,b,c,d,e){if(g(a)){d=T.ay();for(var f=T.Ug(),h=0;h<d.length;h++){var k=d[h];T.rz(k,f);k.b4w_use_nla&&Na.rB(k,k.b4w_nla_cyclic,b.id)}T.set_active(f)}else T.ct(m());a=ja(a,b.id);na.pB(a);e(b,c)}function Y(a,b,c,d,e){if(g(a))for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||H(a.scenes[d]),y(a.scenes[d]);else a.scenes[0].b4w_use_nla||
H(m()),y(m());e(b,c)}function W(a,b,c,d,e){Pa.Qf&&(b.Gm||b.Fm||b.Jm)?ga||ia(a,e,b,c):e(b,c)}function ia(a,b,c,d){var e=La.parentElement;Ea=e.style.zIndex;e.style.zIndex="999";ga=document.createElement("div");ga.style.position="relative";ga.style.height="88px";ga.style.width="88px";var f=Math.round(La.offsetWidth/2-44);ga.style.top=Math.round(La.offsetHeight/2-44).toString()+"px";ga.style.left=f.toString()+"px";ga.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
ga.style.backgroundSize="88px";Ra=document.createElement("div");Ra.style.position="relative";Ra.style.height=La.offsetHeight.toString()+"px";Ra.style.width=La.offsetWidth.toString()+"px";Ra.style.background="rgba(0, 0, 0, 0.5)";Ra.style.zIndex="999";e.appendChild(Ra);Ra.appendChild(ga);ga.addEventListener("click",function(){c.Gm&&(Qa.play(),Qa.pause(),Qa.reset());if(c.Fm){if(g(a))for(var e=0;e<a.scenes.length;e++)y(a.scenes[e],!0);else y(m(),!0);ta.pause()}c.Jm&&ta.lz();ma();b(c,d)},!1)}function ma(){if(ga){var a=
La.parentElement;a.style.zIndex=Ea;Ra.removeChild(ga);a.removeChild(Ra);ga=Ra=null;Ea=0}}function P(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function u(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function qa(a){var b=
a.split("://",2);return 1<b.length?(b[1]=u(b[1]),b.join("://")):u(a)}function ea(a,b,c){X.is_animated(b)&&X.remove(b);T.clear_outline_anim(b);Ba.has_physics(b)&&(Ba.disable_simulation(b),Ba.zz(b));fa.check_sensor_manifold(b)&&fa.remove_sensor_manifold(b);T.Az(a,b,c);ta.ee(b)&&ta.xA(b);U.Tq(b)&&U.remove(b)}function ja(a,b){Da[b]||Z(a,b);return Da[b]}function Z(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)oa(c[e].objects,0,g(a),d);Da[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var h=
c[f],k=0;k<h.length;k++)Da[b].push(h[k])}function oa(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],f=0;f<a.length;f++){var g=a[f],h=K(g);e[h]=e[h]||[];(c||-1==hb.indexOf(g.type))&&-1==e[h].indexOf(g)&&e[h].push(g);(g=g.dupli_group)&&oa(g.objects,b+1,c,d)}}function K(a){return(a=a.parent||X.get_first_armature_object(a))?1+K(a):0}var U=p("__anchors"),X=p("__animation"),sa=p("__batch"),ra=p("__config"),fa=p("__controls"),ha=p("__dds"),V=p("__extensions");p("__lights");var J=p("__loader"),aa=p("__assets"),wa=
p("__md5"),na=p("__objects"),Ba=p("__physics"),Ga=p("__print"),Q=p("__reformer"),Xa=p("__renderer"),T=p("__scenes"),Na=p("__nla"),ta=p("__sfx"),gb=p("__shaders"),Qa=p("__textures"),Rc=p("__nodemat"),Za=p("__util");p("__transform");var uc=p("vec4"),Ca=p("mat4"),Pa=ra.o,Gc=ra.Nd,kc=ra.ub,lc=ra.Md,xb=ra.Wc,Jb=null,Da=null,Va="",ka=!1,ob={},ga=null,Ra=null,Ea=0,hb=["LAMP","CAMERA"],ib=["MESH","CAMERA","EMPTY"],ya=["SPEAKER"],La=null;a.is_primary_loaded=function(a){return J.is_primary_loaded(a)};a.update=
function(){J.sB(Jb)};a.lA=function(a){La=a};a.oB=function(a,b){if(ga){Ra.style.height=b.toString()+"px";Ra.style.width=a.toString()+"px";var c=Math.round(a/2-44);ga.style.top=Math.round(b/2-44).toString()+"px";ga.style.left=c.toString()+"px"}};a.load=function(a,b,f,g,h){var m={load_main:{Na:J.ve,Ya:!1,K:[],cb:!1,eb:500,vb:!1,$a:c},duplicate_objects:{Na:J.cd,Ya:!1,K:["load_main"],cb:!1,eb:50,vb:!1,$a:r},load_binaries:{Na:J.ve,Ya:!1,K:["load_main"],cb:!1,eb:500,vb:!1,$a:e},prepare_bindata:{Na:J.cd,
Ya:!1,K:["duplicate_objects","load_binaries"],cb:!1,eb:0,vb:!1,$a:k},prepare_root_datablocks:{Na:J.cd,Ya:!1,K:["duplicate_objects","prepare_bindata"],cb:!1,eb:150,vb:!1,$a:l},prepare_root_scenes:{Na:J.cd,Ya:!1,K:["prepare_root_datablocks"],cb:!1,eb:350,vb:!1,$a:n},load_smaa_textures:{Na:J.ve,Ya:!0,K:["prepare_root_scenes"],cb:!1,eb:10,vb:!0,$a:M},load_shoremap:{Na:J.ve,Ya:!0,K:["prepare_root_scenes"],cb:!1,eb:10,vb:!0,$a:I},load_textures:{Na:J.ve,Ya:!0,K:["prepare_root_scenes"],cb:!0,eb:500,vb:!1,
$a:x,Df:{Nq:0}},wait_physics_workers:{Na:J.ve,Ya:!0,K:["load_shoremap"],cb:!1,eb:20,vb:!1,Cf:L},add_physics_objects:{Na:J.cd,Ya:!1,K:["wait_physics_workers"],cb:!1,eb:20,vb:!1,$a:F},add_objects:{Na:J.cd,Ya:!1,K:["add_physics_objects"],cb:!1,eb:800,vb:!1,$a:R,Cf:ca,Vh:S,Df:{dl:[],xr:0}},load_speakers:{Na:J.ve,Ya:!0,K:["add_objects"],cb:!0,eb:30,vb:!1,$a:C,Df:{vA:0}},mobile_media_start:{Na:J.cd,Ya:!Pa.Qf,K:["load_textures","load_speakers"],cb:!0,eb:5,vb:!1,$a:W,Cf:W},synchronize_media:{Na:J.cd,Ya:!0,
K:["mobile_media_start"],cb:!0,eb:70,vb:!1,$a:Y},start_nla:{Na:J.cd,Ya:!0,K:["mobile_media_start"],cb:!1,eb:5,vb:!1,$a:z}},aa=J.wq();aa||(aa=J.ww(),Jb={},Da={},ob={});Jb[aa.Bd.length]={};return J.Ew(m,a,b,f,d,g||xb.Yo,Pa.do_not_load_resources,h)};a.unload=function(a){var b=J.wq();if(!b||!b.Bd.length||a&&!J.VA(b.Bd[a]))Ga.error("Unable to unload data!");else{if(0==a)Ga.log("%cUNLOAD ALL","color: #00a"),U.cleanup(),X.cleanup(),ta.cleanup(),Na.cleanup(),T.cleanup(),J.cleanup(),Ba.cleanup(),na.cleanup(),
Za.cleanup(),Xa.cleanup(),Rc.cleanup(),gb.cleanup(),fa.cleanup(),V.cleanup(),aa.cleanup(),Qa.cleanup(),Da=null,ob={},ka=!1,Jb=null;else{Ga.log("%cUNLOAD DATA "+a,"color: #00a");X.yz(a);for(var b=T.mi(),c=0;c<b.length;c++)for(var d=b[c],e=T.Ga(d,"ALL",T.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.nc==a){ea(d,g,!0);e.splice(f,1);var h=T.Ga(d,g.type,T.DATA_ID_ALL),g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}ma()}};a.qz=ea;a.set_debug_resources_root=function(a){Va=a}};b4w.module.__batch=function(a,p){function d(a){a={type:a,Ia:"",id:0,Bz:0,mh:"",M:[],Jb:[],Kc:[],Wh:[],wg:null,gb:{},Wb:null,fb:null,Xo:[],rc:null,R:null,Gc:null,Cd:!1,Kg:!1,Kp:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,Zq:0,$q:0,Aq:0,Am:0,Zb:new Float32Array(3),kc:new Float32Array(16),Da:!1,Ap:!1,V:!1,te:!1,Ha:!1,vg:!1,hd:!1,xc:!1,ec:!1,Ib:!1,Ub:!1,Gb:!1,vc:!1,kb:!1,Xr:!1,Yd:Y.Mh,ue:Y.Jd,Jf:!1,xn:"",nE:"",Bq:!1,Fq:0,Cq:0,Gq:0,Hq:0,Eq:new Float32Array(3),Dq:new Float32Array(3),Nf:!1,Ld:0,Zd:0,
Ge:1,kg:0,Ds:0,uh:1,gg:0,Fe:0,ye:1,tr:0,jn:0,cg:0,cs:0,Vd:Array(2),fc:new Float32Array(3),kf:new Float32Array(3),xd:new Float32Array(3),Nb:new Float32Array(4),Sc:new Float32Array(4),bh:null,Sm:null,Qm:null,Pm:null,Rm:null,pf:!1,water_dynamic:!1,ro:!1,mt:!1,nt:0,ot:0,lt:0,Lh:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,bq:new Float32Array(2),aq:new Float32Array(2),lm:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),ag:null,An:!1,Jr:0,Fr:0,
rn:0,Ir:0,Lr:0,Kr:0,Gr:0,Hr:0,sn:0,Cr:0,Br:0,Nr:0,Er:0,pk:new Float32Array(3),Mr:new Float32Array(8),Dr:new Float32Array(16)};a.Nb[3]=1;a.Ap=!0;a.V=!0;return a}function b(a){switch(a.type){case "MAIN":case "NODES":case "PARTICLES":a.Ia=a.Da?a.te?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.Ia="DEPTH";break;case "COLOR_ID":a.Ia=a.te?"COLOR_ID_XRAY":"COLOR_ID"}}function c(a,b){for(var c=[],d=ja.Aa(b,"SHADOW_CAST"),f=ja.Aa(b,"MAIN_PLANE_REFLECT"),g=ja.Aa(b,"MAIN_CUBE_REFLECT"),h=ja.Aa(b,"OUTLINE_MASK"),
k=ja.Aa(b,"COLOR_PICKING"),l=0;l<a.n.length;l++){var m=a.n[l],n=null;"DEPTH"==m.type&&d&&m.xc&&(n=e(m),n.Ia="SHADOW_CAST");"MAIN"!=m.type&&"NODES"!=m.type&&"PARTICLES"!=m.type||!f&&!g||m.Da||!m.Ub||(n=e(m),n.Ia="REFLECT");"COLOR_ID"==m.type&&(h&&k?(n=e(m),n.Ia="OUTLINE"):h&&!k&&(m.Ia="OUTLINE"));n&&(n.Jf=!0,N(n,a.d.id),c.push(n))}a.n.push.apply(a.n,c)}function e(a){var b=a.R,c=a.rc;a.R=null;a.rc=null;var d=ma.bw(a);a.R=b;d.R=b;a.rc=c;d.rc=c;return d}function h(a,b,c){for(var d=[],e=0;e<a.length;e++){var g=
a[e],h=g.d,k=l(g.data.b4w_bounding_box),m=g.data.b4w_bounding_cylinder_radius,n=g.data.b4w_bounding_sphere_radius,r=g.data.b4w_bounding_sphere_center,q=g.data.b4w_bounding_ellipsoid_axes,t=g.data.b4w_bounding_ellipsoid_center;if(h.Be){var n=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),m=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),A=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),A=Math.sqrt(n*n+m*m+A*A),n=Math.sqrt(n*n+m*m);k.max_x=k.max_y=k.max_z=A;k.min_x=k.min_y=k.min_z=-A;m=n;n=A;r[0]=r[1]=r[2]=
0;q[0]=q[1]=q[2]=A;t[0]=t[1]=t[2]=0}h.Mb=k;A=M.ul(k,h.T);h.Za=A;var A=h,p=m;A.pl=M.Fp(p,k);A.nl=M.Dp(m,k);A.ol=M.Ep(p,k);r=M.Ml(n,r);h.Pc=r;r=M.wl(r,h.T);h.rb=r;q=M.Ll([q[0],0,0],[0,q[1],0],[0,0,q[2]],t);h.zf=q;q=M.vl(q,h.xb);h.Af=q;d=d.concat(f(g,h,b,c))}return d}function k(a,b,c,d){for(var e=[],g=[],h={},k=0;k<a.length;k++){var m=a[k],n=m.d,r=l(m.data.b4w_bounding_box),q=M.ul(r,n.T),t=M.Ml(m.data.b4w_bounding_sphere_radius,m.data.b4w_bounding_sphere_center),A=M.wl(t,n.T),p=m.data.b4w_bounding_ellipsoid_axes,
p=M.Ll([p[0],0,0],[0,p[1],0],[0,0,p[2]],m.data.b4w_bounding_ellipsoid_center),v=M.vl(p,n.xb);n.Mb=r;n.Za=q;n.Pc=t;n.rb=A;n.zf=p;n.Af=v;r={};r.xc=n.xc;r.ec=n.ec;r.Ib=n.Ib;r.ng=n.ng;r.lk=n.lk;r.Cb=n.Cb;r.kk=n.kk;r.wi=n.wi;r.Ub=n.Ub;r.Gb=n.Gb;r.vc=n.vc;r.lc=n.lc;r.sc=n.sc;r.je=n.je;r.Bf=n.Bf;r.ad=n.ad;r.fe=n.fe;r.Eb=n.Eb;r.Be=n.Be;r.Th=n.Th;r.kb=n.kb;r.Mg=n.Mg;r.Gj=n.Gj;r.ge=n.ge;r.$f=n.$f;r.ck=n.ck;r.qc=n.qc;r.Zf=n.Zf;r.dk=n.dk;r.hd=n.hd;q=n.rb.F;r.my=0==c?[0,0]:[Math.floor(q[0]/c),Math.floor(q[2]/
c)];r.Se=n.Se;r.ui=n.ui;r.Yf=n.Yf;n=JSON.stringify(r);h[n]=h[n]||[];h[n].push(m)}for(var V in h){r=JSON.parse(V);c=h[V];var m=ma.Cj("STATIC"),u;for(u in r)m[u]=r[u];m.nc=a[0].d.nc;m.bd=0;m.se=0;m.Ud=0;m.Td=0;m.Pd=0;m.Yg=!1;for(k=0;k<c.length;k++)n=c[k],0==k?(m.Za=U.ya(n.d.Za),m.rb=U.ya(n.d.rb),m.zf=U.ya(n.d.zf),m.Af=U.ya(n.d.Af)):(M.Tp(m.Za,n.d.Za),M.cx(m.rb,n.d.rb));m.Mb=U.ya(m.Za);m.Pc=U.ya(m.rb);g.push({Vb:m,ie:c})}for(a=0;a<g.length;a++)for(h=g[a].Vb,k=g[a].ie,V=0;V<k.length;V++){u=k[V];c=f(u,
h,b,d);m=u.d;m=K.create_sep(m.g,m.scale,m.quat);n={};h.ad&&(n.au_center_pos=[m[0],m[1],m[2]],n.au_wind_bending_amp=[u.d.bd],n.au_wind_bending_freq=[u.b4w_wind_bending_freq],n.au_detail_bending_amp=[u.b4w_detail_bending_amp],n.au_detail_bending_freq=[u.b4w_detail_bending_freq],n.au_branch_bending_amp=[u.b4w_branch_bending_amp]);for(r=0;r<c.length;r++)A=c[r].Vb,q=c[r].zc,t=c[r].D,A.Yj?A.Be?Y.LA(q,m):Y.Os(q,m):("COLOR_ID"==t.type&&(A=c[r].Vb=u.d,t.mh=u.uuid,G(t,A),N(t,U.Gg(A,0))),q=Y.Os(q,m),Y.KA(q,
n));e=e.concat(c)}return e}function f(a,b,c,e){for(var f=[],h=g(c,b),k=U.Gg(b,0),l=a.data,n=l.materials,r=0;r<h.length;r++){var t=h[r];if(!a.b4w_do_not_render||"PHYSICS"==t)for(var A=0;A<n.length;A++){var p=n[A];if(("LENS_FLARES"!=p.name||0!=e)&&!Y.Jq(l,A)){var v=d(t);if(z(v,p)){v.Yd=b.Cd||b.hd?Y.bj:Y.Mh;G(v,b);for(var K=v,V=a.particle_systems,u=0;u<V.length;u++){var w=V[u].settings.b4w_vcol_from_name,x=V[u].settings.b4w_vcol_to_name;""!==w&&""!==x&&(K.gb[w]={Mf:!1,src:[{name:w,Ic:7}]})}"DYNAMIC"==
b.type&&(v.mh=a.uuid);N(v,k);K=Y.Xp(l,A,v.Wh,v.Gc,v.gb,v.wg);"LENS_FLARES"==p.name&&(K=P.pz(K));f.push({D:v,zc:K,Jc:[p.name],Vb:b,Uc:[a]})}}}}h=a.particle_systems;if(0<h.length&&f.length){e=!0;for(r=0;r<h.length;r++)if(h[r].settings.use_render_emitter){e=!1;break}r=f[0].D;h=f[0].zc;l=[];n=a.particle_systems;t=a.data;for(A=0;A<n.length;A++)if(p=n[A],v=p.settings,v.count)if("EMITTER"==v.type){if("DYNAMIC"==b.type){K=d("PARTICLES");V=t.materials;u=p.settings.material-1;u>=V.length&&(ca.warn('Wrong material used for rendering particle system "'+
p.name+'"'),u=0);V=V[u];"HALO"===p.settings.render_type&&(K.Nf=!0);m(K,V);G(K,b);u=K;w=p;switch(w.settings.b4w_billboard_align){case "VIEW":q(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":q(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":q(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":q(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}q(u,"BILLBOARD",0);Z.s(u.fb,"WORLD_SPACE","WORLD"==w.settings.b4w_coordinate_system?1:
0);K.hd=!0;K.mh=a.name+"_"+v.uuid;K.xn=p.name;N(K,k);K.rc=p;v=P.Ax(K,t,p,a.d.xb);P.Wz(K,p,V);l.push({D:K,zc:v,Jc:[V.name],Vb:b,Uc:[a]})}}else if("HAIR"==v.type){K=U.Tj(p.seed);v.b4w_dynamic_grass&&(b.Mg=!0);var y=qa.sp(fa.Zm)&&!v.b4w_initial_rand_rotation&&!v.b4w_hair_billboard,I=4;y&&(I=8);if(p.transforms.length)var B=p.transforms;else for(var V=Y.tm(h,v.count,!1,K),B=new Float32Array(V.length*I),ha=0;ha<V.length;ha++)u=.75+.5*U.Mc(K),B[ha*I]=V[ha][0],B[ha*I+1]=V[ha][1],B[ha*I+2]=V[ha][2],B[ha*I+
3]=u,y&&(B[ha*I+4]=1,B[ha*I+5]=0,B[ha*I+6]=0,B[ha*I+7]=0);V=ja.Aa(c,"GRASS_MAP")?!0:!1;if("OBJECT"==v.render_type)u=[g(c,v.dupli_object.d,!0)],p=H(a,b,r,h,[v.dupli_object],u,[B],v,p,V,K,!1),l=l.concat(p);else if("GROUP"==v.render_type){w=v.dupli_group.objects;x=!1;u=[];for(ha=0;ha<w.length;ha++){var E=g(c,v.dupli_group.objects[ha].d,!0);u.push(E)}if(v.use_whole_group){for(var x=B,B=w,ha=y,y=I,I={},E=new Float32Array([0,0,0,1]),C=0;C<x.length;C+=y)for(var M=0;M<B.length;M++){var R=X.create();X.scale(B[M].d.g,
B[M].d.scale,R);var sa=X.clone([x[C],x[C+1],x[C+2]]);I[M]||(I[M]=new Float32Array(x.length));ha&&(I[M][C+4]=E[0]=x[C+4],I[M][C+5]=E[1]=x[C+5],I[M][C+6]=E[2]=x[C+6],I[M][C+7]=E[3]=x[C+7],U.yn(E,E),U.ZA(R,E,R));X.add(sa,R,sa);I[M][C]=sa[0];I[M][C+1]=sa[1];I[M][C+2]=sa[2];I[M][C+3]=x[C+3]}B=I;x=!0}else if(v.use_group_count){R=w;sa=v.dupli_weights;ha=K;E={};C=[];for(M=0;M<R.length;M++)for(var F=R[M],F=F.origin_name||F.name,ra=0;ra<sa.length;ra++){var S=sa[ra];F==S.name.split(": ")[0]&&C.push(S)}sa.length!=
C.length&&ca.error("dupli weights match failed");for(M=0;M<B.length;M+=I){var L,sa=C;L=[0];for(R=0;R<sa.length;R++)L[R+1]=L[R]+sa[R].count;sa=L[L.length-1]*U.Mc(ha);for(R=F=0;R<L.length;R++)if(sa>=L[R]&&sa<L[R+1]){F=R;break}L=F;E[L]=E[L]||[];E[L].push(B[M],B[M+1],B[M+2],B[M+3]);y&&E[L].push(B[M+4],B[M+5],B[M+6],B[M+7])}for(L in E)E[L]=new Float32Array(E[L]);B=E}else{ha=K;E=w.length;C={};for(M=0;M<B.length;M+=I){var O=Math.floor(E*U.Mc(ha));C[O]=C[O]||[];C[O].push(B[M],B[M+1],B[M+2],B[M+3]);y&&C[O].push(B[M+
4],B[M+5],B[M+6],B[M+7])}for(O in C)C[O]=new Float32Array(C[O]);B=C}p=H(a,b,r,h,w,u,B,v,p,V,K,x);l=l.concat(p)}"INSTANCE"==v.b4w_wind_bend_inheritance&&(a.d.bd=0)}else throw"Unknown particle settings type";a=l;f=e?a:f.concat(a)}return f}function l(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function g(a,b,c){var d=["MAIN","NODES","NODES_GLOW"];(b.ng&&ja.Aa(a,"COLOR_PICKING")||b.Cb&&ja.Aa(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID");ja.Aa(a,"WIREFRAME")&&
d.push("WIREFRAME");d.push("PHYSICS");(ja.Aa(a,"DEPTH")||ja.Aa(a,"SHADOW_CAST"))&&d.push("DEPTH");ja.Aa(a,"GRASS_MAP")&&d.push("GRASS_MAP");if(b.ec||b.Gb)for(a=null,b.ec&&(a="MAIN NODES NODES_GLOW COLOR_ID PHYSICS WIREFRAME".split(" ")),b.Gb&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?U.gv(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function m(a,b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render||b.use_nodes)c=!1;else{r(a,b);c=b.game_settings.alpha_blend;
a.te=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.cg=b.offset_z;a.kf.set([1,1,1]);var d=b.texture_slots;sa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Nb);switch(b.name){case "LENS_FLARES":L(a,"special_lens_flares.glslv","special_lens_flares.glslf");C(a,"a_position");C(a,"a_texcoord");var e=A(d[0],null);F(a,e);break;default:L(a,"main.glslv","main.glslf");var f=v("use_map_color_diffuse",d),g=v("use_map_color_spec",d),h=v("use_map_normal",d),k=v("use_map_mirror",d),l=
v("use_stencil",d);c=f[0];g=g[0];h=h[0];k=k[0];f=f[1];d=l[0]&&v("use_rgb_to_intensity",d)[0];if(c){switch(c.blend_type){case "MIX":q(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":q(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}e=A(c,null);F(a,e,"u_colormap0");a.Fe=c.diffuse_color_factor;a.ye=c.use_map_alpha?c.alpha_factor:0;a.kf.set(c.scale)}l=c&&c==g;g&&(l||(e=A(g,null),F(a,e,"u_specmap0")),a.Ds=g.specular_color_factor);if(h&&(C(a,"a_normal"),C(a,"a_tangent"),e=A(h,
null),F(a,e,"u_normalmap0"),a.tr=h.normal_factor,e=h.texture,e.b4w_use_map_parallax&&fa.zi)){var m=Z.u(e.b4w_parallax_steps),p=Z.u(e.b4w_parallax_lod_dist);q(a,"PARALLAX",1);q(a,"PARALLAX_STEPS",m);q(a,"PARALLAX_LOD_DIST",p);a.gg=e.b4w_parallax_scale}k&&(e=A(k,null),F(a,e,"u_mirrormap"),a.jn=k.mirror_factor);if(k=c&&f&&d?1:0)e=A(f,null),F(a,e,"u_colormap1"),e=A(d,null),F(a,e,"u_stencil0");(e=c||g||h)&&a.kf.set(e.scale);q(a,"TEXTURE_SPEC",void 0==g?0:1);q(a,"ALPHA_AS_SPEC",l?1:0);q(a,"TEXTURE_STENCIL_ALPHA_MASK",
k);C(a,"a_position");C(a,"a_normal");(c||g||h)&&C(a,"a_texcoord");if(b.b4w_water){a.pf=!0;a.ro=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;k=b.texture_slots;L(a,"special_water.glslv","special_water.glslf");C(a,"a_position");C(a,"a_texcoord");C(a,"a_normal");C(a,"a_tangent");fa.pt?(C(a,"a_polyindex"),a.V=!0,a.wireframe_edge_color=[0,0,0],q(a,"DEBUG_WIREFRAME",1)):q(a,"DEBUG_WIREFRAME",0);e=v("use_map_normal",k);l=v("use_map_mirror",k)[0];e.length&&(m=A(e[0]),F(a,m,"u_normalmap0"),
a.Lh=b.b4w_water_norm_uv_velocity);q(a,"NUM_NORMALMAPS",e.length);a.ag=Array(e.length);for(m=0;m<e.length;m++)a.ag[m]=new Float32Array(2),a.ag[m].set([e[m].scale[0],e[m].scale[1]]);l&&(e=A(l),F(a,e,"u_mirrormap"),a.jn=l.mirror_factor);l=null;for(m=0;m<k.length;m++){var K=k[m];if(!0===K.texture.b4w_water_foam){l=K;break}}l&&fa.Qg?(q(a,"FOAM",1),e=A(l),F(a,e,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.bq.set(l.texture.b4w_foam_uv_freq),a.aq.set(l.texture.b4w_foam_uv_magnitude),a.lm[0]=l.scale[0],a.lm[1]=
l.scale[1]):q(a,"FOAM",0);for(m=0;m<k.length;m++)if(K=k[m],!0===K.texture.b4w_shore_dist_map){var V=K;break}V&&fa.el?(V=A(V),F(a,V,"u_shore_dist_map"),q(a,"SHORE_PARAMS",1),V=K.texture.b4w_shore_boundings,q(a,"MAX_SHORE_DIST",Z.u(K.texture.b4w_max_shore_dist)),q(a,"SHORE_MAP_SIZE_X",Z.u(V[0]-V[1])),q(a,"SHORE_MAP_SIZE_Y",Z.u(V[2]-V[3])),q(a,"SHORE_MAP_CENTER_X",Z.u((V[0]+V[1])/2)),q(a,"SHORE_MAP_CENTER_Y",Z.u((V[2]+V[3])/2))):q(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&fa.bi?(q(a,"GENERATED_MESH",
1),a.mt=!0,a.nt=b.b4w_water_num_cascads,a.ot=b.b4w_water_subdivs,a.lt=b.b4w_water_detailed_dist):q(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){var K=Z.u(b.b4w_water_dst_noise_scale0),V=Z.u(b.b4w_water_dst_noise_scale1),k=Z.u(b.b4w_water_dst_noise_freq0),l=Z.u(b.b4w_water_dst_noise_freq1),e=Z.u(b.b4w_water_dir_min_shore_fac),m=Z.u(b.b4w_water_dir_freq),p=Z.u(b.b4w_water_dir_noise_scale),u=Z.u(b.b4w_water_dir_noise_freq),x=Z.u(b.b4w_water_dir_min_noise_fac),U=Z.u(b.b4w_water_dst_min_fac),y=Z.u(b.b4w_water_waves_hor_fac);
q(a,"DST_NOISE_SCALE_0",K);q(a,"DST_NOISE_SCALE_1",V);q(a,"DST_NOISE_FREQ_0",k);q(a,"DST_NOISE_FREQ_1",l);q(a,"DIR_MIN_SHR_FAC",e);q(a,"DIR_FREQ",m);q(a,"DIR_NOISE_SCALE",p);q(a,"DIR_NOISE_FREQ",u);q(a,"DIR_MIN_NOISE_FAC",x);q(a,"DST_MIN_FAC",U);q(a,"WAVES_HOR_FAC",y)}B(a,b);w(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;q(a,"ABSORB",Z.u(b.b4w_water_absorb_factor));
q(a,"SSS_STRENGTH",Z.u(b.b4w_water_sss_strength));q(a,"SSS_WIDTH",Z.u(b.b4w_water_sss_width))}"HALO"===b.type&&(K=b.halo,L(a,"halo.glslv","halo.glslf"),q(a,"NUM_RINGS",K.ring_count),q(a,"NUM_LINES",K.line_count),q(a,"NUM_STARS",K.star_tip_count),q(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.Wh=["a_position"],a.Fq=K.size,a.Cq=K.hardness/20,a.Eq.set(K.b4w_halo_rings_color),a.Dq.set(K.b4w_halo_lines_color),a.Gq=1/b.b4w_halo_stars_blend_height,a.Hq=b.b4w_halo_stars_min_height,a.Bq=!0);q(a,"TEXCOORD",0);
q(a,"NORMAL_TEXCOORD",0);c&&n(a,c,"TEXTURE_COLOR0_CO");f&&n(a,f,"TEXTURE_COLOR1_CO");d&&n(a,d,"TEXTURE_STENCIL_ALPHA_MASK_CO");g&&n(a,g,"TEXTURE_SPEC_CO");h&&n(a,h,"TEXTURE_NORM_CO");q(a,"SHADELESS",b.use_shadeless?1:0);a.vg=b.use_shadeless}c=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===c?0:1);q(a,"ALPHA_CLIP","CLIP"===c?1:0);q(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(q(a,"VERTEX_COLOR",1),C(a,"a_color")):q(a,"VERTEX_COLOR",0);a.Ld=b.ambient;a.Ge=
b.diffuse_intensity;a.Zd=b.emit;a.xd.set(b.specular_color);a.uh=b.specular_alpha;B(a,b);w(a,b);b.b4w_wettable?q(a,"WETTABLE",1):q(a,"WETTABLE",0);E(a,b);a.An=b.b4w_refractive;a.cs=b.b4w_refr_bump;c=!0}break;case "NODES":c=t(a,b);break;case "NODES_GLOW":c=t(a,b,!0);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(r(a,b),a.Da)c=!1;else{L(a,"depth.glslv","depth.glslf");C(a,"a_position");C(a,"a_normal");g=b.game_settings.alpha_blend;q(a,"ALPHA",
"OPAQUE"===g?0:1);a.kf.set([1,1,1]);if((c=v("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===g){a.kf.set(c.scale);q(a,"TEXTURE_COLOR",1);C(a,"a_texcoord");if("IMAGE"==c.texture.d.source||"ENVIRONMENT_MAP"==c.texture.d.source)g=A(c),F(a,g,"u_colormap0");"NONE"==c.texture.d.source&&(g=A(c),F(a,g,"u_colormap0"))}else q(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.AB=b.b4w_use_ghost,a.jc=b.b4w_collision_id,a.yp=b.b4w_collision_margin,a.xp=b.b4w_collision_group,a.zp=b.b4w_collision_mask,
a.ji=b.physics.friction,a.ei=b.physics.elasticity,c=!0):b.b4w_water?(a.pf=!0,a.RB=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,
a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)c=!1;else{r(a,b);a.ue=Y.Jd;a.V=!0;a.Da=!1;g=b.game_settings.alpha_blend;a.te=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;L(a,"color_id.glslv","color_id.glslf");C(a,"a_position");g=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===g?0:1);a.kf.set([1,1,1]);if((c=v("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===g){a.kf.set(c.scale);
q(a,"TEXTURE_COLOR",1);C(a,"a_texcoord");if("IMAGE"==c.texture.d.source||"ENVIRONMENT_MAP"==c.texture.d.source)g=A(c),F(a,g,"u_colormap0");"NONE"==c.texture.d.source&&(g=A(c),F(a,g,"u_colormap0"))}else q(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(r(a,b),a.Da=!1,a.ue=Y.Jd,a.V=!0,L(a,"grass_map.glslv","grass_map.glslf"),C(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,g=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,
a.gb.a_grass_size={Mf:!0,src:[]},c?(a.gb.a_grass_size.src.push({name:c,Ic:4}),q(a,"DYNAMIC_GRASS_SIZE",1)):q(a,"DYNAMIC_GRASS_SIZE",0),a.gb.a_grass_color={Mf:!0,src:[]},g?(a.gb.a_grass_color.src.push({name:g,Ic:7}),q(a,"DYNAMIC_GRASS_COLOR",1)):q(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?c=!1:(L(a,"wireframe.glslv","wireframe.glslf"),C(a,"a_position"),C(a,"a_normal"),C(a,"a_polyindex"),a.V=!0,a.wireframe_mode=
0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=!1;else{c=b.texture_slots;if(a.Nf)L(a,"particles_color.glslv","particles_color.glslf");else if(L(a,"particles_texture.glslv","particles_texture.glslf"),c=v("use_map_color_diffuse",c)[0]){q(a,"TEXTURE_COLOR",1);switch(c.blend_type){case "MIX":q(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":q(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Fe=c.diffuse_color_factor;a.ye=c.use_map_alpha?
c.alpha_factor:0;c=A(c);F(a,c)}sa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Nb);a.Ld=b.ambient;a.Ge=b.diffuse_intensity;a.Zd=b.emit;a.xd.set(b.specular_color);a.uh=b.specular_alpha;C(a,"a_position");C(a,"a_normal");c=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===c?0:1);q(a,"ALPHA_CLIP","CLIP"===c?1:0);q(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);B(a,b);w(a,b);r(a,b);c=b.game_settings.alpha_blend;a.te=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.cg=b.offset_z;
c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function n(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":q(a,c,"TEXTURE_COORDS_UV_ORCO");q(a,"TEXCOORD",1);break;case "NORMAL":q(a,c,"TEXTURE_COORDS_NORMAL");q(a,"NORMAL_TEXCOORD",1);break;default:q(a,c,0)}}function r(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Da=!0;a.ue=Y.Go;a.V=!0;break;case "ALPHA":a.Da=!0;a.ue=Y.Jd;a.V=!0;break;case "CLIP":a.Da=!1;a.ue=Y.Jd;a.V=!0;break;case "ADD":a.Da=!0;a.ue=
Y.Jd;a.V=!1;break;case "OPAQUE":a.Da=!1;a.ue=Y.Jd;a.V=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.Ha=c.use_backface_culling}function A(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&oa.Ri(d,b,c.gc,c.filepath);return d}function v(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function E(a,b){var c=b.raytrace_transparency;a.Sc[0]=c.fresnel;a.Sc[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.kg=c.reflect_factor;a.Sc[2]=c.fresnel;
a.Sc[3]=1-c.fresnel_factor/5}function B(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":q(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":q(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":q(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:ca.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.fc[0]=b.specular_intensity;
a.fc[1]=c;a.fc[2]=d}function w(a,b){switch(b.diffuse_shader){case "LAMBERT":q(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.Vd[0]=0;a.Vd[1]=0;break;case "OREN_NAYAR":q(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.Vd[0]=b.roughness;a.Vd[1]=0;break;case "FRESNEL":q(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.Vd[0]=b.diffuse_fresnel;a.Vd[1]=b.diffuse_fresnel_factor;break;default:ca.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Vd[0]=0,a.Vd[1]=0}}function t(a,b,c){if(!b.use_nodes||
b.b4w_do_not_render)return!1;var d=ia.Vv(b.node_tree,c?U.sm():b.uuid,!1,b.name,c);if(!d)return ca.error('Failed to create node graph for material "'+b.name+'", disable nodes'),x(a,b),!0;L(a,"nodes.glslv","nodes.glslf");q(a,"NODES_GLOW",c?1:0);c=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===c?0:1);q(a,"ALPHA_CLIP","CLIP"===c?1:0);q(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);C(a,"a_position");r(a,b);a.cg=b.offset_z;c=b.game_settings.alpha_blend;a.te=b.b4w_render_above_all&&"OPAQUE"!=
c&&"CLIP"!=c;sa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Nb);a.Zd=b.emit;a.Ld=b.ambient;E(a,b);b.b4w_wettable?q(a,"WETTABLE",1):q(a,"WETTABLE",0);a.fb.on=ia.Wv(d);var e=!1;W.S(d,function(b,c){switch(c.type){case "GEOMETRY_UV":var d=c.data.name,f=c.data.value;a.wg||(a.wg={});a.wg[f]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.gb[d]={Mf:!0,src:[{name:c.data.value}]};f=0;if("GEOMETRY_VC"==c.type)f=7;else for(var g=
0;g<c.Ma.length;g++){var h="RGB".indexOf(c.Ma[g].identifier);-1<h&&(f|=1<<2-h)}a.gb[d].src[0].Ic=f;break;case "GEOMETRY_NO":C(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":d=c.data.value;C(a,"a_normal");q(a,"DIFFUSE_SHADER","DIFFUSE_"+d.Uw);q(a,"SPECULAR_SHADER","SPECULAR_"+d.AA);q(a,"SHADELESS_MAT",d.vg?1:0);a.vg=d.vg;a.uh=d.uh;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;f=c.data.value;!1!==f.d.jj&&(f.d.jj="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);F(a,f.d,d);break;
case "TEXTURE_NORMAL":case "B4W_PARALLAX":q(a,"CALC_TBN_SPACE",1);C(a,"a_normal");C(a,"a_tangent");d=c.data.name;f=c.data.value;f.d.jj=!1;F(a,f.d,d);break;case "LAMP":c.data&&(a.bh=c.data);break;case "B4W_REFRACTION":a.An=!0}});e||(a.vg=!0);return!0}function x(a,b){L(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;q(a,"ALPHA","OPAQUE"===c?0:1);q(a,"ALPHA_CLIP","CLIP"===c?1:0);q(a,"SHADELESS",1);C(a,"a_position");C(a,"a_normal");sa.set(1,0,1,1,a.Nb);q(a,"VERTEX_COLOR",0);a.cg=b.offset_z;
r(a,b)}function G(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Yj?q(a,"AU_QUALIFIER","attribute"):q(a,"AU_QUALIFIER","uniform"),q(a,"STATIC_BATCH",0)):(q(a,"AU_QUALIFIER","attribute"),q(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(S.ey()?q(a,"WIREFRAME_QUALITY",1):q(a,"WIREFRAME_QUALITY",0),a.Kg?(q(a,"DEBUG_SPHERE",1),a.Kp?q(a,"DEBUG_SPHERE_DYNAMIC",1):q(a,"DEBUG_SPHERE_DYNAMIC",0)):q(a,"DEBUG_SPHERE",0),q(a,"ALPHA",1));b.Cd&&(a.Cd=b.Cd);b.ad?(""!==b.fe?(a.gb.a_bending_col_main={Mf:!0,src:[{name:b.fe,
Ic:4}]},C(a,"a_bending_col_main"),""!==b.Eb.fr&&""!==b.Eb.er&&""!==b.Eb.Ar?(a.gb.a_bending_col_detail={Mf:!0,src:[{name:b.Eb.fr,Ic:4},{name:b.Eb.er,Ic:2},{name:b.Eb.Ar,Ic:1}]},C(a,"a_bending_col_detail"),C(a,"a_normal"),q(a,"DETAIL_BEND",1)):q(a,"DETAIL_BEND",0),q(a,"MAIN_BEND_COL",1)):q(a,"MAIN_BEND_COL",0),q(a,"WIND_BEND",1)):q(a,"WIND_BEND",0);b.oj?q(a,"BEND_CENTER_ONLY",1):q(a,"BEND_CENTER_ONLY",0);q(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.sv|0);b.Be?q(a,"BILLBOARD",1):q(a,"BILLBOARD",0);b.Be&&
b.Yj?q(a,"HAIR_BILLBOARD",1):q(a,"HAIR_BILLBOARD",0);b.sl?q(a,"BILLBOARD_SPHERICAL",1):q(a,"BILLBOARD_SPHERICAL",0);switch(b.Th){case "RANDOM":q(a,"BILLBOARD_RANDOM",1);q(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":q(a,"BILLBOARD_RANDOM",0);q(a,"BILLBOARD_JITTERED",1);break;default:q(a,"BILLBOARD_RANDOM",0),q(a,"BILLBOARD_JITTERED",0)}b.kb&&fa.el?q(a,"DYNAMIC_GRASS",1):q(a,"DYNAMIC_GRASS",0);a.kb=b.kb;a.hd=b.hd;a.xc=b.xc;a.ec=b.ec;a.Ib=b.Ib&&!a.vg&&!(a.Da&&fa.Op);a.Ub=b.Ub;a.Gb=b.Gb;a.vc=b.vc;
b.ah?(C(a,"a_influence"),q(a,"SKINNED",1),b.ii?q(a,"FRAMES_BLENDING",1):q(a,"FRAMES_BLENDING",0),q(a,"MAX_BONES",b.he)):(q(a,"SKINNED",0),q(a,"FRAMES_BLENDING",0));b.Tk?(q(a,"VERTEX_ANIM",1),fa.jt?q(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):q(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):q(a,"VERTEX_ANIM",0);if(b.ah&&b.Tk)throw"Skinning and vertex animation are mutually exlusive";b.Gj?q(a,"DISABLE_FOG",1):q(a,"DISABLE_FOG",0);b.Gc&&(a.Gc=b.Gc);if("NODES"==a.type||"NODES_GLOW"==a.type){for(var c=
a.fb.on,d=b.$f,e=b.Zf,f=0;f<c.length;f++){var g=c[f];switch(g.id){case "VALUE":var h=g.rk[0];if(h)for(var k=0;k<d.length;k+=2)if(d[k]==h){g.Ie.push(["VALUE_IND",d[k+1]]);break}break;case "RGB":if(h=g.rk[0])for(k=0;k<e.length;k+=2)if(e[k]==h){g.Ie.push(["RGB_IND",e[k+1]]);break}}}q(a,"NUM_VALUES",b.ge.length);q(a,"NUM_RGBS",b.qc.length)}}}function C(a,b){var c=a.Wh;-1==c.indexOf(b)&&c.push(b)}function q(a,b,c){Z.s(a.fb,b,c)}function y(a,b){if("PHYSICS"==a.type)a.zc=b;else{var c=a.ue,d=a.Yd;a.Bq&&(b=
Y.ix(b));a.mt&&(b=u.Fx(a.nt,a.ot,a.lt));c=Y.NA(b,c,d,a.gb);a.R=c;a.hd||c.Sj||a.Cd||(c.Pe=null,c.Yc=null);c=b.B.length;a.num_vertices=b.I*c;a:switch(a.Yd){case Y.Mh:case Y.cj:case Y.bj:d=!0;break a;default:d=!1}d?Y.Cy(b)?a.num_triangles=b.ba.length/3*c:a.num_triangles=b.I/3*c:a.num_triangles=0}}function H(a,b,c,e,f,g,h,k,l,m,n,r){var q=[],t=k.b4w_dynamic_grass;if(!m&&t)return q;for(var A="INSTANCE"==k.b4w_wind_bend_inheritance,p="INSTANCE"==k.b4w_shadow_inheritance,v="INSTANCE"==k.b4w_reflection_inheritance,
u=[],w=[],x=0;x<f.length;x++){var y=f[x],I=U.xj(b);I.Be=k.b4w_hair_billboard;I.Th=k.b4w_hair_billboard_type;I.sl="SPHERICAL"==k.b4w_hair_billboard_geometry;I.kb=t;I.Yj=!0;I.ge=y.d.ge;I.$f=y.d.$f;I.qc=y.d.qc;I.Zf=y.d.Zf;A?(I.ad=y.d.ad,I.Yi=y.d.Yi,I.se=y.d.se,I.Ud=y.d.Ud,I.fe=y.d.fe,I.Td=y.d.Td,I.Pd=y.d.Pd,I.bd=y.d.bd,I.Eb=y.d.Eb,I.oj=!1):(I.ad=a.d.ad,I.Yi=a.d.Yi,I.se=a.d.se,I.Ud=a.d.Ud,I.fe=a.d.fe,I.Td=a.d.Td,I.Pd=a.d.Pd,I.bd=a.d.bd,I.Eb=a.d.Eb,I.oj=!0);p?(I.xc=y.d.xc,I.ec=y.d.ec,I.Ib=y.d.Ib):(I.xc=
a.d.xc,I.ec=a.d.ec,I.Ib=a.d.Ib);v?(I.Ub=y.d.Ub,I.Gb=y.d.Gb,I.vc=y.d.vc,I.lc=y.d.lc,I.sc=y.d.sc,I.je=y.d.je):(I.Ub=a.d.Ub,I.Gb=a.d.Gb,I.vc=a.d.vc,I.lc=a.d.lc,I.sc=a.d.sc,I.je=a.d.je);u.push(I);var B=h[x];B||(B=new Float32Array);r&&U.Tj(l.seed,n);var ha=new Float32Array(3),C=new Float32Array([0,0,0,1]),E=[],M=qa.sp(fa.Zm)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,H=4;M&&(H=8);for(var R=0;R<B.length;R+=H){ha[0]=B[R];ha[1]=B[R+1];ha[2]=B[R+2];var F=B[R+3];if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var S=
new Float32Array([U.Mc(n),U.Mc(n),U.Mc(n)]);X.normalize(S,S);break;case "Z":S=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}ra.setAxisAngle(S,k.b4w_rand_rotation_strength*(2*Math.PI*U.Mc(n)-Math.PI),C)}else M&&(C.set(B.subarray(R+4,R+8)),U.yn(C,C),k.use_whole_group||(k.use_rotation_dupli?ra.multiply(C,y.d.quat,C):ra.multiply(C,V,C)));var L=K.create_sep(ha,F,C);E.push(L)}w.push(E)}for(var O={},x=0;x<f.length;x++){var P=g[x],I=u[x],W={};I.ad&&
(W.au_wind_bending_amp=[I.bd],W.au_wind_bending_freq=[I.se],W.au_detail_bending_freq=[I.Ud],W.au_detail_bending_amp=[I.Td],W.au_branch_bending_amp=[I.Pd],I.bd=0,I.se=0,I.Ud=0,I.Td=0,I.Pd=0);var Z=U.Gg(I,0),E=w[x];if(E.length)for(var ia=f[x].data,ja=ia.materials,R=0;R<ja.length;R++)if(!Y.Jq(ia,R))for(var ma=0;ma<P.length;ma++){var ea=d(P[ma]),oa=ja[R];if(z(ea,oa)){ea.Yd=Y.Mh;G(ea,I);ea.mh=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(ea.Zq=k.b4w_hair_billboard_jitter_amp,ea.$q=k.b4w_hair_billboard_jitter_freq);
t&&(ea.Aq=k.b4w_dynamic_grass_scale_threshold);A||(delete ea.gb.a_bending_col_main,delete ea.gb.a_bending_col_detail);N(ea,Z);var jb=Y.Xp(ia,R,ea.Wh,ea.Gc,ea.gb,ea.wg),Ab=Y.Py(jb,W,E),Ia=Ab,za=E;Ia.H.au_center_pos=new Float32Array(3*Ia.I);for(var Fa=za.length,sb=Ia.I/Fa,eb=0;eb<Fa;eb++)for(var Nb=za[eb],Bb=3*sb*eb,Cb=0;Cb<sb;Cb++)Ia.H.au_center_pos[Bb+3*Cb]=Nb[0],Ia.H.au_center_pos[Bb+3*Cb+1]=Nb[1],Ia.H.au_center_pos[Bb+3*Cb+2]=Nb[2];Ab=Ia;if(I.ad&&I.oj){var tb=Ab,yb=a.d.T;tb.H.a_emitter_center=new Float32Array(3*
tb.I);var Oa=sa.fromValues(0,0,0,1);sa.transformMat4(Oa,yb,Oa);for(var va=0;va<tb.I;va++)tb.H.a_emitter_center[3*va]=Oa[0],tb.H.a_emitter_center[3*va+1]=Oa[1],tb.H.a_emitter_center[3*va+2]=Oa[2];Ab=tb}var mb=k.b4w_vcol_from_name,Ob=k.b4w_vcol_to_name,pa=ea,pb=c,ba=!A,ub=ia,Ya=[];if(""!==mb&&""!==Ob){var Aa,xa=Ob,qb=pa.gb,Vb=[],$a=void 0;for($a in qb)for(var Kb=qb[$a].src,Lb=0,Pb=0;Pb<Kb.length;Pb++){var xc=Kb[Pb].Ic;xa==Kb[Pb].name&&Vb.push($a,xc,Lb);Lb+=U.mg(xc)}Aa=Vb;if(0<Aa.length)for(var Qb=0;Qb<
Aa.length;Qb+=3)Ya.push({fi:mb,Jj:7,sk:Aa[Qb],tk:Aa[Qb+1],Hj:Aa[Qb+2]});else Y.ny(pa.Wh,"a_color")&&Ob==ub.active_vcol_name&&Ya.push({fi:mb,Jj:7,sk:"a_color",tk:7,Hj:0})}ba&&("a_bending_col_main"in pb.gb&&Ya.push({fi:"a_bending_col_main",Jj:4,sk:"a_bending_col_main",tk:4,Hj:0}),"a_bending_col_detail"in pb.gb&&Ya.push({fi:"a_bending_col_detail",Jj:7,sk:"a_bending_col_detail",tk:7,Hj:0}));for(var kb=Ab,ab=E,hc=e,Fb=Ya,D=ea.gb,bc=!1,nb=0;nb<Fb.length;nb++){var Db=Fb[nb].fi,Gb=hc.H[Db];if(Gb&&0<Gb.length){bc=
!0;break}}if(bc){var da,db=a.d.Mb,Ma=hc.B[0].a_position,vb=ab,ua=O,Rb=new Float32Array(3),Ja=new Float32Array(3),$c=new Uint32Array(vb.length);if(!("verts_indices"in ua)){ua.Rd=new Float32Array(3);ua.Od=new Float32Array(3);ua.no=new Uint32Array(Ma.length/3);ua.vi=new Uint32Array(Ma.length/3);ua.Rd[0]=(db.max_x-db.min_x)/20;ua.Rd[1]=(db.max_y-db.min_y)/20;ua.Rd[2]=(db.max_z-db.min_z)/20;ua.Od[0]=db.min_x;ua.Od[1]=db.min_y;ua.Od[2]=db.min_z;for(var Sa=0;Sa<Ma.length/3;Sa++){var nc=U.trunc((Ma[3*Sa]-
ua.Od[0])/ua.Rd[0]),yc=U.trunc((Ma[3*Sa+1]-ua.Od[1])/ua.Rd[1]),Hc=U.trunc((Ma[3*Sa+2]-ua.Od[2])/ua.Rd[2]),nc=U.clamp(nc,0,19),yc=U.clamp(yc,0,19),Hc=U.clamp(Hc,0,19);ua.no[Sa]=Sa;ua.vi[Sa]=Hc*Math.pow(20,2)+20*yc+nc}Y.Bs(ua.vi,ua.no,Y.Yk,!0);ua.xg=new Uint32Array(Math.pow(20,3));for(Sa=0;Sa<ua.vi.length;Sa++)ua.xg[ua.vi[Sa]]++;delete ua.vi;for(Sa=1;Sa<ua.xg.length;Sa++)ua.xg[Sa]+=ua.xg[Sa-1]}for(var ic=0;ic<vb.length;ic++){Rb[0]=vb[ic][0];Rb[1]=vb[ic][1];Rb[2]=vb[ic][2];for(var Hb=1E10,Ta=-1,Ha=U.trunc((Rb[0]-
ua.Od[0])/ua.Rd[0]),ad=U.trunc((Rb[1]-ua.Od[1])/ua.Rd[1]),Ic=U.trunc((Rb[2]-ua.Od[2])/ua.Rd[2]),Ha=U.clamp(Ha,0,19),ad=U.clamp(ad,0,19),Ic=U.clamp(Ic,0,19),bd=Ic*Math.pow(20,2)+20*ad+Ha,cd=ua.xg[bd],Wb=0==bd?0:ua.xg[bd-1];Wb<cd;Wb++){var dd=ua.no[Wb];Ja[0]=Ma[3*dd];Ja[1]=Ma[3*dd+1];Ja[2]=Ma[3*dd+2];X.sub(Ja,Rb,Ja);var jc=X.sqrLen(Ja);jc<=Hb&&(Hb=jc,Ta=dd)}if(-1==Ta)for(Wb=0;Wb<Ma.length/3;Wb++)Ja[0]=Ma[3*Wb],Ja[1]=Ma[3*Wb+1],Ja[2]=Ma[3*Wb+2],X.sub(Ja,Rb,Ja),jc=X.sqrLen(Ja),jc<=Hb&&(Hb=jc,Ta=Wb);$c[ic]=
Ta}da=$c;for(var md=kb.I/ab.length,nb=0;nb<Fb.length;nb++){var cc=Fb[nb].sk,nd=Fb[nb].tk,Db=Fb[nb].fi,dc=Fb[nb].Jj,Gb=hc.H[Db];switch(cc){case "a_bending_col_main":var Sb=1;break;case "a_bending_col_detail":Sb=3;break;case "a_color":Sb=3;break;default:for(var rb=Sb=0;rb<D[cc].src.length;rb++)Sb+=U.mg(D[cc].src[rb].Ic)}if(Gb&&0<Gb.length){var ed=U.mg(dc),oc=U.mg(nd),bb=dc&nd,Xb=U.hs(bb);bb!=nd&&ca.error("Wrong color extraction from "+Db+" to "+cc+".");if("a_bending_col_main"==cc||"a_bending_col_detail"==
cc)kb.H[cc]=new Float32Array(kb.I*oc);for(rb=0;rb<ab.length;rb++){var Jc=da[rb],zc=Jc*ed,Tb=rb*md*Sb;if(-1!=Jc)for(var Ac=0;Ac<md;Ac++)for(var Kc=Ac*Sb,Eb=0;Eb<Xb.length;Eb++)Xb[Eb]&&(kb.H[cc][Tb+Kc+(Fb[nb].Hj+U.Li(nd,Eb))]=Gb[zc+U.Li(dc,Eb)])}}else kb.H[cc]=new Float32Array(0)}}Ab=kb;q.push({D:ea,zc:Ab,Jc:[oa.name],Vb:I,Uc:[a]})}}}return q}function z(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=ia.rp(b));return c=c&&m(a,b)}function N(a,b){for(var c=null,d=null,e=0;e<a.M.length;e++){var f=a.M[e].Qd;f&&
(c||(c={}),c[e]=f,a.M[e].Qd=null);if(f=a.M[e].Ja)d||(d={}),d[e]=f,a.M[e].Ja=null}a.id=0;a.Bz=b;a.id=U.Gg(a,b);if(c)for(var g in c)a.M[g].Qd=c[g];if(d)for(g in d)a.M[g].Ja=d[g]}function O(a,b,c,e,f){var g=d("WIREFRAME");L(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.Kg=!0;g.V=!0;g.mh=c;f&&(g.Kp=!0);G(g,b);N(g,U.Gg(b,0));e?(b=u.jq(1,a.F),Y.Nz(b,[a.wf[0],a.xf[1],a.yf[2]],a.F)):b=u.jq(a.Ba,a.F);Y.Sn(b,1,!0);b.H.a_polyindex=Y.Wp(b);y(g,b);return g}function L(a,b,c){a.fb={Ui:b,hi:c,He:[],
Wm:[],on:[]};Z.Vz(a.fb)}function F(a,b,c){1==a.M.length&&0==a.Jb.length&&a.Jb.push("default0");c=c||"default"+String(a.M.length);-1==a.Jb.indexOf(c)&&(a.M.push(b),a.Jb.push(c));a.Wb&&ea.Vo(a)}function I(a){if(!a.fb)throw"No shaders info for batch "+a.name;a.Wb=Z.Qx(a.fb);ea.mv(a.Wb);ea.Uo(a);ea.Vo(a)}var M=p("__boundings"),R=p("__config"),ca=p("__print"),S=p("__extensions"),Y=p("__geometry"),W=p("__graph"),ia=p("__nodemat"),ma=p("__objects"),P=p("__particles"),u=p("__primitives"),qa=p("__reformer"),
ea=p("__renderer"),ja=p("__scenegraph"),Z=p("__shaders"),oa=p("__textures"),K=p("__tsr"),U=p("__util"),X=p("vec3"),sa=p("vec4"),ra=p("quat"),fa=R.o,ha=["MAIN","NODES"],V=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);a.GD=d;a.Ex=function(a,e,f,g,l,m,n){for(var r=[],t=[],p=[],v=0;v<f.length;v++){var K=f[v];ma.$b(K)?t.push(K):p.push(K)}v=[];v=v.concat(h(t,a,n));t=v=v.concat(k(p,a,e,n));v=[];K=[];p={};for(e=0;e<t.length;e++){var V=t[e].D,w=t[e].Vb,x=null;if(V.id in p){var I=p[V.id],X=K[I].D,B=
K[I].Vb,z=null,E=null;for(n=0;n<V.M.length;n++){var G=V.M[n].Qd;G&&(z||(z={}),z[n]=G,V.M[n].Qd=null);if(G=V.M[n].Ja)E||(E={}),E[n]=G,V.M[n].Ja=null}U.Ms(V,X)&&U.Ms(w,B)&&(x=K[I]);if(z)for(n in z)V.M[n].Qd=z[n];if(E)for(n in E)V.M[n].Ja=E[n];if(!x){do V.id++;while(p[V.id])}}x||(x={D:V,Vb:t[e].Vb,Uc:[],Tn:[],Jc:[]},p[V.id]=K.length,K.push(x));x.Uc=x.Uc.concat(t[e].Uc);t[e].zc&&t[e].zc.I&&x.Tn.push(t[e].zc);x.Jc=x.Jc.length?x.Jc.concat(t[e].Jc):t[e].Jc;Y.Bs(x.Jc,x.Tn,Y.wu,!1)}for(e=0;e<K.length;e++){t=
K[e].Tn;if(0==t.length)n=U.jb(U.Nk("%empty"));else if(1==t.length)n=t[0];else{p=[];for(n=0;n<t.length;n++)Y.Dy(t[n])||p.push(n);if(p.length<t.length)for(n=0;n<p.length;n++)Y.Sn(t[p[n]]);n=Y.MA(t)}v.push({D:K[e].D,Vb:K[e].Vb,zc:n,Jc:K[e].Jc,Uc:K[e].Uc})}r.push.apply(r,v);for(v=0;v<r.length;v++)r[v].D.Kc=r[v].Jc,y(r[v].D,r[v].zc);for(v=0;v<r.length;v++)if(e=r[v].D,"STATIC"==r[v].Vb.type&&"COLOR_ID"!=e.type)K=ma.Pq(U.Nk("%meta"),"MESH",!0),K.d=r[v].Vb,K.n=[e],m.push(K);else for(t=[],n=0;n<r[v].Uc.length;n++)if(K=
r[v].Uc[n],-1==t.indexOf(K.name)){for(p=0;p<K.n.length;p++)if(K.n[p]==e)throw"Batch already exist in object";K.n.push(e);t.push(K.name)}if(fa.wireframe_debug){for(v=0;v<r.length;v++)if(e=r[v].Vb,"DYNAMIC"==e.type&&(K=r[v].Uc[0],-1<ha.indexOf(r[v].D.type))){t=!1;for(n=0;n<K.n.length;n++)K.n[n].Kg&&(t=!0);t||(e=O(e.zf,e,K.name,!0,!0),K.n.push(e))}for(v=0;v<m.length;v++)K=m[v],e=K.d,-1<ha.indexOf(K.n[0].type)&&(e=O(e.Pc,e,K.name,!1),K.n.push(e))}if(l.es){e=d("MAIN");L(e,"special_skydome.glslv","special_skydome.glslf");
if(l.procedural_skydome)q(e,"PROCEDURAL_SKYDOME",1),e.Xr=!0;else{if(r=g.In){q(e,"WO_SKYTEX",1);v=A(g.ys,null);F(e,v,"u_sky");r.invert&&q(e,"MTEX_NEGATIVE",1);r.FB&&q(e,"MTEX_RGBTOINT",1);switch(r.dp){case "MIX":v=0;break;case "ADD":v=1;break;case "SUBTRACT":v=2;break;case "MULTIPLY":v=3;break;case "SCREEN":v=4;break;case "OVERLAY":v=5;break;case "DIFFERENCE":v=6;break;case "DIVIDE":v=7;break;case "DARKEN":v=8;break;case "LIGHTEN":v=9;break;case "HUE":v=10;break;case "SATURATION":v=11;break;case "VALUE":v=
12;break;case "COLOR":v=13;break;case "SOFT_LIGHT":v=14;break;case "LINEAR_LIGHT":v=15;break;default:ca.warn('Unknown sky texture blend type"'+r.dp+'"'),v=0}q(e,"BLENDTYPE",v);r.BB&&q(e,"WOMAP_BLEND",1);r.CB&&q(e,"WOMAP_HORIZ",1);r.EB&&q(e,"WOMAP_ZENUP",1);r.DB&&q(e,"WOMAP_ZENDOWN",1)}g.GB&&q(e,"WO_SKYBLEND",1);g.HB&&q(e,"WO_SKYPAPER",1);g.IB&&q(e,"WO_SKYREAL",1)}l.Ub&&(e.Ub=!0,l.Gb&&(e.Gb=!0));C(e,"a_position");e.cg=99999;g=u.Cx();y(e,g);K=ma.Pq(U.Nk("%meta"),"MESH",!0);K.d=ma.Cj("DYNAMIC");K.d.Mg=
!0;K.d.Mb=M.Ed();K.d.Pc=M.Zi();K.d.Za=M.Ed();K.d.rb=M.Zi();K.n=[e];m.push(K)}for(v=0;v<f.length;v++)for(n=0;n<f[v].n.length;n++)b(f[v].n[n]);for(v=0;v<m.length;v++)for(n=0;n<m[v].n.length;n++)b(m[v].n[n]);for(v=0;v<f.length;v++)c(f[v],a);for(v=0;v<m.length;v++)c(m[v],a)};a.SB=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.ov=l;a.Nx=A;a.kl=function(a,b){q(a,"CSM_SECTION0",0);q(a,"CSM_SECTION1",
0);q(a,"CSM_SECTION2",0);q(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)q(a,"CSM_SECTION"+String(c),1);q(a,"SHADOW_TEX_RES",Z.u(b.csm_resolution));q(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);q(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.ja=q;a.sb=function(a,b){return Z.Ux(a.fb,b)};a.eB=N;a.Eg=F;a.Fz=function(a,b,c){c=a.Jb.indexOf(c);-1<c&&(a.M[c]=b)};a.xw=function(a,b){var c=d("MAIN");c.Da=!0;sa.set(b[0],b[1],b[2],.5,c.Nb);c.Yd=Y.cj;y(c,a);L(c,"main.glslv","main.glslf");
q(c,"SHADELESS",1);I(c);return c};a.yb=I;a.Ev=function(a){return a.Wb.Ai.length?a.Wb.un.u_cube_fog?!0:!1:!1};a.kw=function(){var a=d("DEPTH_PACK");a.Ha=!0;a.V=!1;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");I(a);return a};a.Gp=function(a){var b=d("POSTPROCESSING");L(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":q(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":q(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");
break;case "X_BLUR":q(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":q(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":q(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":q(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":q(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":q(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;default:throw"Wrong postprocessing effect: "+a;}b.Ha=!0;b.V=!1;a=u.lb();y(b,a);I(b);return b};a.Bw=function(a){var b=
d("SSAO");b.V=!1;b.Ha=!0;var c=u.lb();y(b,c);L(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");q(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Hs);q(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:oa.Hx(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=A(a,c);F(b,a,"u_ssao_special_tex");
I(b);return b};a.Cw=function(a){var b=d("SSAO_BLUR");b.V=!1;b.Ha=!0;var c=u.lb();y(b,c);L(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");q(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);I(b);return b};a.lw=function(){var a=d("DOF");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");q(a,"DEPTH_RGBA",1);I(a);return a};a.tw=function(){var a=d("OUTLINE");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv",
"postprocessing/outline.glslf");I(a);return a};a.nw=function(){var a=d("GLOW_COMBINE");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");I(a);return a};a.ow=function(a,b,c){var e=d("GOD_RAYS");e.V=!1;e.Ha=!0;var f=u.xx();y(e,f);L(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");q(e,"DEPTH_RGBA",a?1:0);q(e,"WATER_EFFECTS",b?1:0);q(e,"STEPS_PER_PASS",Z.u(c,1));I(e);return e};a.pw=function(){var a=d("GOD_RAYS_COM");a.V=!1;a.Ha=
!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");I(a);return a};a.yw=function(){var a=d("SKY");a.V=!1;a.Ha=!0;var b=u.yx();y(a,b);L(a,"procedural_skydome.glslv","procedural_skydome.glslf");q(a,"WATER_EFFECTS",1);I(a);return a};a.ew=function(){var a=d("ANTIALIASING");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");q(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");I(a);return a};a.zw=function(a){var b=
d("SMAA"),c=u.lb();y(b,c);L(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");q(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");q(b,"SMAA_PASS",a);q(b,"SMAA_PREDICATION",0);q(b,"SMAA_REPROJECTION",0);I(b);b.V=!1;b.Ha=!0;return b};a.iw=function(){var a=d("COMPOSITING");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");I(a);return a};a.sw=function(a){var b=d("MOTION_BLUR");b.Ha=!0;b.V=!1;var c=u.lb();y(b,c);L(b,"postprocessing/postprocessing.glslv",
"postprocessing/motion_blur.glslf");q(b,"BLUR_DECAY_THRESHOLD",Z.u(a));I(b);return b};a.cw=function(){var a=d("ANAGLYPH");a.Ha=!0;a.V=!1;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");I(a);return a};a.qw=function(){var a=d("LUMINANCE");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");I(a);return a};a.fw=function(){var a=d("LUMINANCE");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance_av.glslf");I(a);return a};a.rw=function(){var a=d("LUMINANCE_X_BLUR");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");I(a);return a};a.gw=function(){var a=d("POSTPROCESSING");a.Ha=!0;a.V=!1;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");I(a);return a};a.hw=function(){var a=d("BLOOM");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv",
"postprocessing/bloom_combine.glslf");I(a);return a};a.Fw=function(){var a=d("VELOCITY");a.V=!1;a.Ha=!0;var b=u.lb();y(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");I(a);return a};a.dw=function(){var a=d("ANCHOR_VISIBILITY");a.V=!0;a.Ha=!0;a.Yd=Y.Ao;L(a,"anchors.glslv","anchors.glslf");var b=u.iq(1);y(a,b);q(a,"ANCHOR_NUM",1);I(a);a.Di=new Float32Array([0,0,0]);return a};a.dB=function(a,b){var c=b.length/3;if(c!=a.Di.length/3){var d=u.iq(c);y(a,d);q(a,"ANCHOR_NUM",
c);I(a)}a.Di=b};a.Z=function(a,b,c){for(var d=0;d<a.n.length;d++)if(a.n[d].type==c&&!a.n[d].Jf&&-1!=a.n[d].Kc.indexOf(b))return a.n[d];return null};a.oc=function(a,b,c){for(var d=0;d<a.n.length;d++)if(a.n[d].type==c&&a.n[d].Jf&&-1!=a.n[d].Kc.indexOf(b))return a.n[d];return null};a.ns=function(a,b){a.Nb.set(b.Nb);a.Ge=b.Ge;a.xd.set(b.xd);a.fc.set(b.fc);a.Zd=b.Zd;a.Ld=b.Ld;a.Fe=b.Fe;a.ye=b.ye;a.kg=b.kg;a.Sc.set(b.Sc);a.gg=b.gg;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;
a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Lh=b.Lh};a.FC=function(a,b){for(var c=a.n,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.Tv=function(a){for(var b=a.M,c=0;c<b.length;c++)oa.Sw(b[c].Pa);Y.vp(a.R)}};b4w.module.__nodemat=function(a,p){function d(a,c,d,l,m){if(c in U)return U[c];for(var r=P.create(),q=a.nodes,t=a.links,p=a.animation_data,K=0;K<q.length;K++)if(!B(r,q[K],0,p,l))return U[c]=null;if(d&&-1==v(a,r,"GROUP_OUTPUT","group"))return null;K=M(r);if(!R(r,t,K))return null;if(d)return r;for(K=0;K<t.length;K++){d=t[K];for(var q=k(d.from_node,r),u=k(d.to_node,r),x=0;x<q.length;x++)for(var w=0;w<u.length;w++){for(var I=q[x],y=u[w],X=P.Sa(r,I),z=P.Sa(r,y),E=r,C=z,z=[],G=d.from_socket.identifier,
H=d.to_socket.identifier,sa=X.Ma,X=0;X<sa.length;X++)if(sa[X].identifier==G){z.push(X);break}C=C.K;for(X=0;X<C.length;X++)if(C[X].identifier==H){z.push(X);break}2==z.length&&P.ed(E,I,y,z)}}h(r);a=m?v(a,r,"B4W_GLOW_OUTPUT","material",!0):v(a,r,"OUTPUT","material");if(-1==a)return U[c]=null;f(r);r=P.Ns(r,a,P.yo);b(r);g(r);n(r);A(r);e(r,p,l);return U[c]=r}function b(a){P.S(a,function(b,d){for(var e=d.K,f=d.Ma,g=0;g<e.length;g++)c(a,e[g],b,g,1);for(g=0;g<f.length;g++)c(a,f[g],b,g,0)})}function c(a,b,
c,d,e){if(b.Rb){var f=!0;P.qe(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.Rb=!1)}}function e(a,b,c){var d=[];P.qe(a,function(e,f,g){var h=P.Sa(a,e),k=P.Sa(a,f),h=qa.is_vector(h.Ma[g[0]].za),k=qa.is_vector(k.K[g[1]].za);if(h!=k){var l,m={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},n={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};h&&!k?l=E("vector_to_scalar","B4W_VECTOSCAL",[m],[n]):!h&&k&&(l=E("scalar_to_vector","B4W_SCALTOVEC",[n],
[m]));B(a,l,0,b,c);d.push([e,f,a.va[a.va.length-2],g])}});for(var e=0;e<d.length;++e)P.lg(a,d[e][0],d[e][1],-1),P.ed(a,d[e][0],d[e][2],[d[e][3][0],0]),P.ed(a,d[e][2],d[e][1],[0,d[e][3][1]])}function h(a){var b=[];P.S(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":P.qe(a,function(a,e,f){a==c&&"Translucency"==d.Ma[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)P.ed(a,b[c],b[c+1],b[c+2])}function k(a,b){var c=[];P.S(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;
throw"Node not found";}function f(a){var b=[];P.S(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var f=l(a,d);if(-1!=f){var g=P.Nj(a,f,0);P.lg(a,f,d,-1);-1!=g&&P.lg(a,g,f,-1);d=P.Sa(a,f);e.data=d.data;e.Ua[0]=d.Ua[0];P.Ki(a,f)}e.K.splice(1,1)}else if("REROUTE"==e.type){for(var e=P.Nj(a,d,0),h=P.nh(a,d),f=[],g=[],k=[],m=0;m<h;m++){var n=P.Vg(a,d,m),r=g.indexOf(n);-1!=r?k[r]+=1:(g.push(n),k.push(1),
f.push(d,n))}if(-1!=e)for(h=P.Tg(a,e,d,0)[0],m=0;m<g.length;m++)for(n=0;n<k[m];n++)r=P.Tg(a,d,g[m],n)[1],P.ed(a,e,g[m],[h,r]);for(m=0;m<f.length;m+=2)P.lg(a,f[m],f[m+1],-1)}}}function l(a,b){for(var c=a.ma,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function g(a){var b=[];P.S(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=
b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(r(f,k.ic)){g=[];h=P.nh(a,e);for(n=0;n<h;n++){var l=P.Vg(a,e,n),m=P.Tg(a,e,l,0);g.push(e,l,m);P.ed(a,k.id,l,m)}for(var n=0;n<g.length;n+=3)P.lg(a,g[n],g[n+1],0);P.Ki(a,e);g=!1;break}}g&&(k={id:e,ic:f},c.push(k))}}function m(a){for(var b={},c=0;c<a.va.length;c+=2){var d=a.va[c];b[d]=[]}for(c=0;c<a.ma.length;c+=3){var e=a.ma[c],f=a.ma[c+1];b[f].push(e);b[f].push(b[e])}for(d in b)b[d]=JSON.stringify(b[d]).match(/\d+/g)||[],b[d]=b[d].map(function(a){return parseInt(a)});
return b}function n(a){var b=[];P.S(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=m(a),d=[],e=0;e<b.length;e+=2){for(var f=b[e],g=b[e+1],h=!0,k=0;k<d.length;k++){var l=d[k];if(!(3<=l.hh.length||!r(g,l.ic)||-1<c[f].indexOf(l.id)||-1<c[l.id].indexOf(f))){for(var n=!1,q=0;q<l.hh.length;q++){var t=l.hh[q].id;if(-1<c[f].indexOf(t)||-1<c[t].indexOf(f)){n=!0;break}}if(!n){for(var k=[],t=P.Oq(a,f),A={},q=0;q<t;q++)n=P.Nj(a,f,q),n in A||(A[n]=0),h=
P.Tg(a,n,f,A[n]++),k.push(n,f,h);for(var t=[],A=P.nh(a,f),v={},q=0;q<A;q++)n=P.Vg(a,f,q),n in v||(v[n]=0),h=P.Tg(a,f,n,v[n]++),t.push(f,n,h);h=k.concat(t);for(q=0;q<h.length;q+=3)P.lg(a,h[q],h[q+1],0);P.Ki(a,f);q={id:f,ic:g,Zw:k,$w:t};l.hh.push(q);h=!1;break}}}h&&(l={id:f,ic:g,hh:[]},d.push(l))}for(e=0;e<d.length;e++){l=d[e];c=l.hh.length;for(k=0;k<c;k++){g=l.hh[k];q=g.ic;f=g.Zw;g=g.$w;l.ic.K[k+1].Rb=q.K[0].Rb;l.ic.K[k+1].za=q.K[0].za;l.ic.Ma[2*(k+1)].Rb=q.Ma[0].Rb;l.ic.Ma[2*(k+1)].za=q.Ma[0].za;
l.ic.Ma[2*(k+1)+1].Rb=q.Ma[1].Rb;l.ic.Ma[2*(k+1)+1].za=q.Ma[1].za;for(q=0;q<f.length;q+=3)n=f[q],h=f[q+2],h[1]+=k+1,P.ed(a,n,l.id,h);for(q=0;q<g.length;q+=3)n=g[q+1],h=g[q+2],h[0]+=2*(k+1),P.ed(a,l.id,n,h);l.ic.Ie.push(["USE_uv"+(k+2),1])}P.Ki(a,l.id);P.hl(a,l.id,l.ic)}}}function r(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==
b.data.value;default:return!1}}function A(a){var b=[];P.S(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],l=P.nh(a,d),m=0;m<l;m++){var n=P.Vg(a,d,m);if("SEPRGB"!=P.Sa(a,n).type){f=!1;break}g.push(d,n);for(var r={},q=P.nh(a,n),f=0;f<q;f++){var t=P.Vg(a,n,f);t in r||(r[t]=0);var A=P.Tg(a,n,t,r[t]++);g.push(n,t);k[A[0]].push(d,t,A)}h.push(n);f=!0}if(f){for(m=d=l=0;m<k.length;m++)k[m].length&&(l++,d|=1<<2-m);if(l){e.type+=
l;e.Ma=[];for(m=0;m<k.length;m++)if(k[m].length)for(e.Ma.push({za:0,identifier:"RGB"[m],Rb:!0,name:"RGB"[m]}),f=0;f<k[m].length;f+=3)k[m][f+2][0]=qa.Li(d,m);for(m=0;m<g.length;m+=2)P.lg(a,g[m],g[m+1],0);for(m=0;m<h.length;m++)P.Ki(a,h[m]);for(m=0;m<k.length;m++)for(f=0;f<k[m].length;f+=3)P.ed(a,k[m][f],k[m][f+1],k[m][f+2])}}}}function v(a,b,c,d,e){a=a.nodes;for(var f=null,g=0;g<a.length;g++){var h=a[g];e?"GROUP"==h.type&&h.node_tree_name==c&&(f=h):h.type==c&&(f=h)}return f?k(f,b)[0]:(ma.error('No "'+
c+'" node in node '+d),-1)}function E(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function B(a,b,c,d,e){var f=b.name,g=b.type,h=[],k=[],l=[],m=[],n=null,r=[];switch(g){case "CAMERA":k=[];l=L(b);break;case "COMBRGB":case "COMBHSV":k=O(b);l=L(b);break;case "GEOMETRY":a:{for(var g=b.outputs,A=0;A<g.length;A++)if(g[A].is_linked){g=!0;break a}g=!1}if(!g)return!0;g=C(b,c);if(!g)return ma.error("Geometry output is not supported"),!1;switch(g){case "GEOMETRY_UV":if(!b.uv_layer)return ma.error('Missing uv layer in node "',
b.name,'"'),!1;n=G("param_GEOMETRY_UV_a");A=G("param_GEOMETRY_UV_v");h.push(F(n));h.push(F(A));l.push(H(b,"UV"));m.push(F(A));n={name:n,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return ma.error("Missing vertex color layer in node ",b.name),!1;n=G("param_GEOMETRY_VC_a");A=G("param_GEOMETRY_VC_v");h.push(F(n));h.push(F(A));l.push(H(b,"Vertex Color"));m.push(F(A));n={name:n,value:b.color_layer};break;case "GEOMETRY_NO":l.push(H(b,"Normal"));break;case "GEOMETRY_FB":l.push(H(b,"Front/Back"));
break;case "GEOMETRY_VW":l.push(H(b,"View"));break;case "GEOMETRY_GL":l.push(H(b,"Global"))}break;case "GROUP":A=b.node_tree_name;switch(A){case "B4W_LINEAR_TO_SRGB":if(!w(b,[1],[1])){n=t(b,e);break}g="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!w(b,[1],[1])){n=t(b,e);break}g="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!w(b,[1],[1])){n=t(b,e);break}g="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!w(b,[1,1],[1])){n=t(b,e);break}g="B4W_REFLECT";break;case "B4W_REFRACTION":if(!w(b,
[1,0],[1])){n=t(b,e);break}g="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!w(b,[1,1,0,0,0],[1])){n=t(b,e);break}var g="B4W_PARALLAX",v=G("temp_texture");m.push(F(v));break;case "B4W_CLAMP":if(!w(b,[1],[1])){n=t(b,e);break}g="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!w(b,[0,0,0,0,0],[0])){n=t(b,e);break}g="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!w(b,[],[0])){n=t(b,e);break}g="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!w(b,[0,0,0],[0])){n=t(b,e);break}g="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":g=
"B4W_GLOW_OUTPUT";break;default:n=t(b,e)}k=O(b);l=L(b);"B4W_TRANSLUCENCY"==A&&(A=N("TranslucencyParams","TranslucencyParams",[0,0,0,0]),A.Rb=l[0].Rb,l.push(A));break;case "LAMP":n=b.lamp;if(!n)return ma.error("There is no lamp in node: "+b.name),!1;l.push(H(b,"Color"));l.push(H(b,"Light Vector"));l.push(H(b,"Distance"));l.push(H(b,"Visibility Factor"));n.uuid in X?r.push(["LAMP_INDEX",String(X[n.uuid])]):(X[n.uuid]=sa,r.push(["LAMP_INDEX",String(sa++)]));n=X;break;case "NORMAL":k=O(b);l=L(b);A=H(b,
"Normal");m.push(F(G("param_NORMAL_Normal"),A.za,3));break;case "MAPPING":A=b.vector_type;g="MAPPING";k.push(y(b,"Vector"));l.push(H(b,"Vector"));var v=b.rotation,p=b.scale,K=b.translation,x=Z.create(),I=qa.bx(v),U=new Float32Array([p[0],0,0,0,p[1],0,0,0,p[2]]);Z.multiply(I,U,x);x=qa.Ry(x,oa.create());switch(A){case "POINT":x[12]=K[0];x[13]=K[1];x[14]=K[2];break;case "TEXTURE":x[12]=K[0];x[13]=K[1];x[14]=K[2];x=oa.invert(x,x);break;case "NORMAL":oa.invert(x,x),oa.transpose(x,x)}switch(A){case "NORMAL":r.push(["MAPPING_IS_NORMAL",
1]);case "TEXTURE":r.push(["MAPPING_TRS_MATRIX",u.u(x,16)]);break;case "POINT":0!==ja.length(v)?r.push(["MAPPING_TRS_MATRIX",u.u(x,16)]):(0!==ja.length(p)&&r.push(["MAPPING_SCALE",u.u(p,3)]),0!==ja.length(K)&&r.push(["MAPPING_TRANSLATION",u.u(K,3)]));break;case "VECTOR":0!==ja.length(v)?r.push(["MAPPING_TRS_MATRIX",u.u(x,16)]):0!==ja.length(p)&&r.push(["MAPPING_SCALE",u.u(p,3)])}b.use_min&&r.push(["MAPPING_MIN_CLIP",u.u(b.min,3)]);b.use_max&&r.push(["MAPPING_MAX_CLIP",u.u(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":n=
y(b,"Color");n.za.splice(3);k.push(n);(n=y(b,"Alpha"))?k.push(n):k.push(N("Alpha","Alpha",1));n=y(b,"Spec");n.za.splice(3);k.push(n);A=y(b,"Normal");A.za.splice(3);k.push(A);l.push(H(b,"Color"));l.push(H(b,"Alpha"));l.push(H(b,"Normal"));"MATERIAL_EXT"==g&&((n=y(b,"Emit"))?k.push(n):k.push(N("Emit","Emit",0)),n=y(b,"Translucency"),n.za=0,n.name="Translucency",n.identifier="Translucency",n?k.push(n):k.push(N(n.name,n.identifier,n.za)),n=y(b,"Translucency"),n.za=[0,0,0,0],n.name="TranslucencyParams",
n.identifier="TranslucencyParams",n?k.push(n):k.push(N(n.name,n.identifier,n.za)),n=y(b,"Reflectivity"),v=y(b,"Ray Mirror"),n?v="Reflectivity":v?(n=v,v="Ray Mirror"):v="Reflectivity",n?k.push(n):k.push(N(v,v,0)),(n=y(b,"SpecTra"))?k.push(n):k.push(N("SpecTra","SpecTra",0)),l.push(H(b,"Diffuse")),l.push(H(b,"Spec")));v=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":n=b.specular_hardness;break;case "WARDISO":n=b.specular_slope;break;case "TOON":n=b.specular_toon_size;v=b.specular_toon_smooth;
break;default:ma.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),n=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":K=p=0;break;case "OREN_NAYAR":p=b.roughness;K=0;break;case "FRESNEL":p=b.diffuse_fresnel;K=b.diffuse_fresnel_factor;break;default:ma.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),K=p=0}m.push(F(G("param_MATERIAL_diffuse"),[p,K],2));m.push(F(G("param_MATERIAL_spec"),[b.specular_intensity,
n,v],3));n={name:b.name,value:{AA:b.specular_shader,Uw:b.diffuse_shader,vg:b.use_shadeless,uh:b.specular_alpha}};A.Rb&&r.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&r.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":g="MATH_ADD";break;case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";
break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g="MATH_ARCSINE";break;case "ARCCOSINE":g="MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g="MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g="MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";
break;default:return ma.error("Unsupported MATH operation: "+b.operation),!1}r.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=O(b);l=L(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g="MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g=
"MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";break;case "DODGE":g="MIX_RGB_DODGE";break;case "BURN":g="MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return ma.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}r.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);
k=O(b);l=L(b);break;case "OUTPUT":k=O(b);l=[];break;case "RGB":A=e+"%join%"+b.name;A={name:"-1",value:A};m.push(A);l.push(H(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=O(b);l=L(b);break;case "TEXTURE":g=q(b);if("TEXTURE_EMPTY"==g)l.push(H(b,"Color")),l.push(H(b,"Normal")),l.push(H(b,"Value"));else if("TEXTURE_ENVIRONMENT"==g)k.push(y(b,"Vector")),l.push(H(b,"Color")),l.push(H(b,"Value"));else{if("TEXTURE_NORMAL"==g&&"ENVIRONMENT_MAP"==b.texture.type)return ma.error("Wrong output for ENVIRONMENT_MAP texture: "+
b.name),!1;for(p=0;4>p;++p)p?(n=N("Vector"+p,"Vector"+p,[0,0,0]),"TEXTURE_COLOR"==g&&(A=N("Color"+p,"Color"+p,[0,0,0]),v=N("Value"+p,"Value"+p,0)),"TEXTURE_NORMAL"==g&&(A=N("Normal"+p,"Normal"+p,[0,0,0]),v=N("Value"+p,"Value"+p,0))):(n=y(b,"Vector"),"TEXTURE_COLOR"==g&&(A=H(b,"Color"),v=H(b,"Value")),"TEXTURE_NORMAL"==g&&(A=H(b,"Normal"),v=H(b,"Value"))),k.push(n),l.push(A),l.push(v)}v=G("param_TEXTURE_texture");m.push(F(v));n={name:v,value:b.texture};break;case "VALUE":g="VALUE";A=e+"%join%"+b.name;
A={name:"-1",value:A};m.push(A);l.push(H(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":g="VECT_MATH_ADD";break;case "SUBTRACT":g="VECT_MATH_SUBTRACT";break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g="VECT_MATH_NORMALIZE";break;default:return ma.error("Unsupported VECT_MATH operation: "+b.operation),!1}k=O(b);l=L(b);break;default:k=O(b),l=L(b)}f={name:f,type:g,
Wi:h,K:k,Ma:l,Ua:m,data:n,Ie:r};P.hl(a,P.hq(a),f);if(f="GEOMETRY"==b.type)a:{f=b.outputs;for(k=h=0;k<f.length;k++)if(f[k].is_linked&&h++>c){f=!0;break a}f=!1}return f&&!B(a,b,++c,d,e)?!1:!0}function w(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,g=0;g<b.length;g++){var h=d[g],k=b[g];if(!h||h.default_value instanceof Array!=k)return ma.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=e[g],d=c[g],!b||
b.default_value instanceof Array!=d)return ma.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1;return!0}function t(a,b){var c=a.node_group.node_tree,e={},f;for(f in c)if("links"==f||"nodes"==f){e[f]=[];for(var g=0;g<c[f].length;g++){e[f][g]={};for(var h in c[f][g])if("links"==f){e[f][g][h]={};for(var k in c[f][g][h])e[f][g][h][k]=x(c[f][g][h][k])}else e[f][g][h]=x(c[f][g][h])}}else e[f]=x(c[f]);c=a.node_tree_name;if("B4W_REPLACE"==c||"B4W_LEVELS_OF_QUALITY"==
c)f=E("Group input","GROUP_INPUT",[],a.inputs),g=E("Group output","GROUP_OUTPUT",a.outputs,[]),h=null,h="B4W_REPLACE"==c||"B4W_LEVELS_OF_QUALITY"==c&&(ra.quality==ea.P_LOW||ra.mm)?{from_node:f,from_socket:f.outputs[1],to_node:g,to_socket:g.inputs[0]}:{from_node:f,from_socket:f.outputs[0],to_node:g,to_socket:g.inputs[0]},e.nodes=[f,g],e.links=[h];c=a.name;f=e.nodes;g=e.links;for(h=0;h<f.length;h++)f[h].name=I(f[h].type,c,f[h].name);for(h=0;h<g.length;h++)g[h].from_node.name=I(g[h].from_node.type,c,
g[h].from_node.name),g[h].to_node.name=I(g[h].to_node.type,c,g[h].to_node.name);return{az:d(e,a.node_group.uuid,!0,b),bz:e.links}}function x(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?qa.xj(a):a}function G(a){K[a]||(K[a]=0);var b=a+K[a],b=b.replace(/ /g,"_").replace(/\//g,"_");K[a]++;return b}function C(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";
case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function q(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.is_linked)switch(g.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ma.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),
"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function y(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return z(e)}return null}function H(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return z(e)}return null}function z(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=qa.is_vector(a)?a.slice(0):
a;return{name:b,identifier:c,Rb:d,za:a}}function N(a,b,c){return{name:a,identifier:b,Rb:!1,za:c}}function O(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=z(a.inputs[c]);d.za.length&&d.za.splice(3);b.push(d)}return b}function L(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=z(a.outputs[c]);b.push(d)}return b}function F(a,b,c){b=null===b||void 0===b?null:u.u(b,c);return{name:a,value:b}}function I(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function M(a){var b=
[];P.S(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function R(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.az,f=c[d].data.bz;if(!e)return!1;P.S(e,function(b,c){P.hl(a,P.hq(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);ia(c[d],b,a)}return!0}function ca(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function S(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=
c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function Y(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function W(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],g,h=0;h<c.K.length;h++)if(f.from_socket.identifier==c.K[h].identifier){g=c.K[h].za;break}for(var h=
f,l=b,m=g,n=k(h.to_node,l),r=0;r<n.length;r++)for(var q=P.Sa(l,n[r]),t=0;t<q.K.length;t++)if(q.K[t].identifier==h.to_socket.identifier){q.K[t].za=m;break}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function ia(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],k=0;k<b.length;k++){var l=b[k];ca(l.from_node,d,l,e,g,h);ca(l.to_node,d,l,f,g,h)}f=S(b,f,g);e=S(b,h,e);Y(b,f);W(b,c,a,f);if(e.length){var m;P.S(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});W(b,c,m,e)}}var ma=p("__print"),P=p("__graph"),
u=p("__shaders"),qa=p("__util"),ea=p("__config"),ja=p("vec3");p("vec4");var Z=p("mat3"),oa=p("mat4"),K={},U={},X={},sa=0;new Float32Array(4);var ra=ea.o;a.Vv=d;a.Wv=function(a){var b=[],c={};K={};var d=P.$n(a);P.S(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],l=[],m=0;m<d.K.length;m++){var n=d.K[m];if(n.Rb)e.push(null),f.push(null);else{e.push(G("in_"+d.type+"_"+n.identifier));var r=u.u(n.za,0);ra.rs&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==
n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier)&&(n=r,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),r=n=n.replace(/\s+/g,""));f.push(r)}}for(m=0;m<d.Ma.length;m++)n=d.Ma[m],n.Rb?g.push(null):g.push(G("out_"+d.type+"_"+n.identifier));for(m=0;m<d.Ua.length;m++)n=d.Ua[m],
h.push(n.name),k.push(n.value);for(m=0;m<d.Wi.length;m++)l.push(d.Wi[m].name);e={id:d.type,K:e,Km:f,Ma:g,Ua:h,rk:k,Wi:l,Ie:JSON.parse(JSON.stringify(d.Ie))};b.push(e);c[a]=e});P.qe(d,function(a,b,e){var f=P.Sa(d,a);P.Sa(d,b);var g=f.Ma[e[0]];a=c[a].Ma;b=c[b].K;f=a[e[0]]||G("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.rp=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};
a.cleanup=function(){for(var a in U)delete U[a];for(var b in X)delete X[b];sa=0}};b4w.module.__animation=function(a,p){function d(a,b){var c=a.C[b];c&&c.jm&&c.gi&&(c.gi=!1,c.jm(a))}function b(a,b,c){c=a.C[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.mc=d;c.Cg=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.it=d}function c(a,b,c){a=a.C[c];a.type=50;a.Cg=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.rc=b}function e(a){return a.replace(/_B4W_BAKED$/,"")}function h(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:u.oa("Wrong animation behavior")}}function k(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&f(d,b)}return b}function f(a,b){if(a.animation_data){var c=a.animation_data.action;c&&u.ld(c.fcurves)&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&
f(e,b)}}function l(a){return u.is_mesh(a)&&a.d.Tk?!0:!1}function g(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function m(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function n(a,b,c,e){x(a,b,c,e);d(a,c);a.d.Ae&&(q(a,b),C(a,b))}function r(a,b,c){var d=b.frame_range,e=b.d,f=a.C[c];f.Cg=b.name;f.cl=d;f.Mo=e.kz;f.Lo=e.qv;f.wj=e.wj;f.start=d[0];f.length=d[1]-d[0];f.mc=d[0];d=u.ld(e.rj);if(u.is_armature(a)&&d){f.type=
10;var g=A(a,b);g||(g=y(a,b,B(a)),a.Kd.push(b,g));f.g=g.g;f.wa=g.wa;var f=a.d,g=f.Hk,h=a.C[c],e=h.Gn,k;a:{k=f.ts;for(var l=0;l<k.length;l+=2)if(b==k[l]){k=k[l+1];break a}k=null}if(k)h.Gn=k;else{for(h=0;h<g.length;h++)k=y(a,b,g[h].Gc),e.push(k);f.ts.push(b,e)}f.Ae&&(b=f.Mk,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),v(a))}else if(ia.ee(a)&&(e.Ua.volume||e.Ua.pitch))f.volume=e.Ua.volume||null,f.pitch=e.Ua.pitch||null,f.type=40;else if("MESH"==a.type&&t(b)){f.type=60;e=A(a,b);if(!e){e=[];
h=[];k=[];var l=[],m=b.d,n=a.d.ck,r=a.d.dk;for(g in m.Ua){var q=b.name+"%join%"+g;w(g,q,m,h,e,n);w(g,q,m,l,k,r)}e={KB:e,values:h,Gz:k,Hz:l};a.Kd.push(b,e)}f.qr=e.KB;f.sr=e.values;f.pr=e.Gz;f.rr=e.Hz}else if(g=e.Ua.tsr){f.type=20;e=A(a,b);if(!e){e=b.d.wr;h=[];k=[];for(l=0;l<e;l++)h.push(g.subarray(8*l,8*l+4)),k.push(g.subarray(8*l+4,8*l+8));e={g:h,wa:k};a.Kd.push(b,e)}f.g=e.g;f.wa=e.wa;S.Xg(a)&&S.vB(a,f.g,f.wa)}else return W.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+
'"'),!1;u.is_armature(a)&&!d&&E(a,c);return!0}function A(a,b){for(var c=a.Kd,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function v(a){var b=a.d.Mk;if(-1!=b[0]&&-1!=b[1]){var c=a.C;a=c[b[1]].mc;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.mc;d=Math.floor(a);b.mc=d+e}}function E(a,b){var c=a.d.Mk,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.C;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function B(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<
b.length;d++){var e=b[d].name;c[e]={hp:d,ai:d,vn:u.xm(a,"name",e),kt:-1}}return c}function w(a,b,c,d,e,f){for(var g=0;g<f.length;g+=2)b==f[g]&&(e.push(f[g+1]),d.push(new Float32Array(c.Ua[a])))}function t(a){a=a.d;for(var b in a.Ua)if(-1!=b.indexOf("nodes"))return!0;return!1}function x(a,b,c,d){if((c=a.C[c])&&null!=c.type&&(c.play||d)){var e=a.d;d=c.mc;var f=c.start,g=c.length;d+=c.speed*b*Z.Fa;var h=c.type,k=c.speed;if(0<=k&&d>=f+g||0>k&&d<f)switch(c.gi=!0,c.behavior){case 10:d=0<=k?(d-f)%g+f:f+
g-1E-6;break;case 20:d=0<=k?f:f+g-1E-6;c.play=!1;break;case 30:d=0<=k?f+g-1E-6:f,c.play=!1}c.mc=d;switch(h){case 10:if(!e.Ae){d=G(c,d,oa);b=d[0];f=d[1];d=d[2];e.uc=c.wa[b];e.tc=c.wa[f];e.Cc=c.g[b];e.Bc=c.g[f];e.Kf=d;e=e.Hk;c=c.Gn;for(g=0;g<e.length;g++)h=e[g],k=c[g],h.uc=k.wa[b],h.tc=k.wa[f],h.Cc=k.g[b],h.Bc=k.g[f],h.Kf=d;ma.w(a)}break;case 20:h=d=G(c,d,oa);(e=K)||(e=new Float32Array(4));var f=h[0],g=h[1],h=h[2],k=c.g,l=k[f][1],m=k[f][2],n=k[g][1],r=k[g][2];e[0]=(1-h)*k[f][0]+h*k[g][0];e[1]=(1-h)*
l+h*n;e[2]=(1-h)*m+h*r;f=d;(g=X)||(g=new Float32Array(4));h=c.wa;ea.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=d[2];h=c.g;d=(1-g)*h[d[0]][3]+g*h[d[1]][3];c.ao&&(g=U,ma.get_translation(a,g),u.smooth_v(e,g,b,c.ao,e));c.zn&&(g=sa,ma.get_rotation(a,g),u.As(f,g,b,c.zn,f));c=c.wj;c[0]&&ma.set_translation(a,e);c[1]&&ma.set_rotation(a,f);c[2]&&ma.set_scale(a,d);ma.w(a);Y.sync_transform(a);break;case 30:(a=oa)||(a=Array(3));f=d-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);
d=b+1;f-=b;10!=c.behavior&&d==c.length&&(d=--b,f=1);c=c.it;a[0]=b+c;a[1]=d+c;a[2]=f;d=oa;e.jo=d[0];e.ht=d[2];break;case 40:d=G(c,d,oa);b=d[0];e=d[1];d=d[2];c.volume&&ia.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&ia.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:S.fA(c.rc,d/Z.Fa);break;case 60:d=G(c,d,oa);b=d[0];e=d[1];d=d[2];k=c.sr;l=c.qr;f=c.rr;c=c.pr;for(g=0;g<l.length;g++)m=k[g],h=l[g],a.d.ge[h]=(1-d)*m[b]+d*m[e];for(g=0;g<c.length;g++)k=f[g],h=c[g],k=ja.lerp(k.subarray(3*
b,3*b+3),k.subarray(3*e,3*e+3),d,K),a.d.qc[h]=k[0],a.d.qc[h+1]=k[1],a.d.qc[h+2]=k[2];break;default:u.oa("Unknown animation type:"+h)}}}function G(a,b,c){c||(c=Array(3));var d=a.cl[0],e=a.cl[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Mo;e=Math.floor(b);a=a.Lo[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function C(a,b){var c=a.d,d=c.ze,e=c.Mk,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.C[f];if(g.play||0==b)var h=G(g,g.mc,oa),k=h[0],l=h[1],h=h[2],m=g.wa[k],n=g.wa[l],k=g.g[k],l=g.g[l];else d=1}else d=1;e=a.C[e];
if(e.play||0==b)var h=G(e,e.mc,oa),r=h[0],q=h[1],h=h[2];else if(-1!=f&&g.play)d=0;else return;f=e.wa[r];g=e.wa[q];r=e.g[r];e=e.g[q];if(1==d)c.uc.set(f),c.tc.set(g),c.Cc.set(r),c.Bc.set(e);else if(0==d)c.uc.set(m),c.tc.set(n),c.Cc.set(k),c.Bc.set(l);else{for(q=0;q<m.length;q+=4){for(var t=X,A=sa,v=0;4>v;v++)t[v]=m[q+v],A[v]=f[q+v];ea.slerp(t,A,d,t);for(v=0;4>v;v++)c.uc[q+v]=t[v];for(v=0;4>v;v++)t[v]=n[q+v],A[v]=g[q+v];ea.slerp(t,A,d,t);for(v=0;4>v;v++)c.tc[q+v]=t[v]}u.cp(k,r,d,c.Cc);u.cp(l,e,d,c.Bc)}ma.w(a);
d=c.Hk;m=c.nr;for(q=0;q<d.length;q++){n=d[q];k=m[q];for(l=0;l<k.length;l+=2)for(r=k[l],f=k[l+1],g=0;4>g;g++)n.uc[r+g]=c.uc[f+g],n.tc[r+g]=c.tc[f+g],n.Cc[r+g]=c.Cc[f+g],n.Bc[r+g]=c.Bc[f+g];n.Kf=h}}}function q(a,b){var c=a.d,d=c.ze,e=c.gl;if(0!=e){var d=c.fl-d,f=e*b;u.sign(d)==u.sign(e)&&Math.abs(f)<Math.abs(d)?c.ze+=f:(c.ze=c.fl,c.gl=0)}}function y(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.wr,h=0;h<g;h++){for(var k=0;k<d.length;k++){var l=d[k],m=P.create(),n=b.d.rj[l.name];n&&P.copy(n.subarray(8*
h,8*h+8),m);l.Io=m;l.hj=!1}k=H(a,c);e.push(k.g);f.push(k.wa)}return{g:e,wa:f}}function H(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var k=b[h],l=k.ai,m=e[k.vn],k=f,n=g,r=m.Du,q=r[r.length-1],t=q.bl;q.hj||P.identity(t);for(q=r.length-1;0<=q;q--){var m=r[q],A=m.bl;if(m.hj)t=A;else{var v=m.Jo,p=m.Io;P.invert(v,ra);P.multiply(p,ra,ra);P.multiply(v,ra,ra);P.multiply(t,ra,A);t=A;m.hj=!0}}m=m.bl;k[0]=m[0];k[1]=m[1];k[2]=m[2];k[3]=m[3];n[0]=m[4];n[1]=m[5];
n[2]=m[6];n[3]=m[7];ea.normalize(n,n);for(k=0;4>k;k++)n=4*l+k,c[n]=f[k],d[n]=g[k]}c=new Float32Array(c);d=new Float32Array(d);return{g:c,wa:d}}function z(a){var b=[0,0,0],c;for(c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1);return b}function N(a,b,c,d,e,f,g){var h=a+(b-a)/2,k=O(h,d,e,f,g)-c;return.02>Math.abs(k)?h:0<k?N(a,h,c,d,e,f,g):N(h,b,c,d,e,f,g)}function O(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function L(a,b){if(!a.C.length)for(var c=
0;8>c;c++)a.C.push(null);a.C[b]={type:null,Cg:null,cl:null,Mo:0,Lo:null,wj:null,wa:null,g:null,Gn:[],play:!1,behavior:20,mc:0,start:0,length:0,ao:0,zn:0,gi:!1,it:null,speed:1,volume:null,pitch:null,sr:[],qr:[],rr:[],pr:[]};a.Kd=a.Kd||[];-1==fa.indexOf(a)&&fa.push(a)}function F(a,b){ma.w(a);Y.sync_transform(a);n(a,0,b,!0)}function I(a,d,e){e=e||0;if(u.is_mesh(a)){var f=u.keysearch("name",d,a.data.b4w_vertex_anim);if(f)return L(a,e),b(a,f,e),F(a,e),!0;if((f=u.keysearch("name",d,a.particle_systems))&&
"EMITTER"==f.settings.type)return L(a,e),c(a,f,e),F(a,e),!0}if(f=u.keysearch("name",d,ha)||u.keysearch("name",d+"_B4W_BAKED",ha)){L(a,e);if(r(a,f,e))return F(a,e),!0;a.C[e]=null}W.error('Unsupported object: "'+a.name+'" or animation name: "'+d+'"');return!1}function M(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&R(d))return!0}return!1}function R(a){if(a.animation_data)return!0;a=a.nodes;for(var b=0;b<
a.length;b++){var c=a[b];if(c.node_group&&(c=c.node_group.node_tree)&&R(c))return!0}return!1}var ca=p("__config"),S=p("__particles"),Y=p("__physics"),W=p("__print");p("__scenes");var ia=p("__sfx"),ma=p("__transform"),P=p("__tsr"),u=p("__util"),qa=p("__reformer");p("mat4");var ea=p("quat");p("vec4");var ja=p("vec3"),Z=ca.Md;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=
1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var oa=Array(3),K=new Float32Array(3),U=new Float32Array(3),X=new Float32Array(4),sa=new Float32Array(4),ra=new Float32Array(8);new Float32Array(16);var fa=[],ha=[];a.sq=function(){return u.trunc((ca.o.mr-50)/4)};a.frame_to_sec=function(a){return a/Z.Fa};a.update=function(a){for(var b=0;b<fa.length;b++){for(var c=fa[b],e=0;8>e;e++)x(c,a,e);c.d.Ae&&(q(c,a),C(c,a))}for(b=
0;b<fa.length;b++)for(c=fa[b],e=0;8>e&&c.C.length;e++)d(c,e)};a.kq=function(){return ha};a.get_anim_names=function(a){var b=[];if(l(a))for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var d,c=[];for(d=0;d<ha.length;d++){var f=ha[d],g=f.d;u.ld(f.d.rj)?"ARMATURE"==a.type&&c.push(f):g.Ua.volume||g.Ua.pitch?ia.ee(a)&&c.push(f):!t(f)&&u.ld(f.fcurves)&&c.push(f)}"MESH"==a.type&&(c=c.concat(k(a)));d=c;for(c=0;c<d.length;c++)b.push(e(d[c].name));if(S.Xg(a)&&S.Em(a))for(c=
0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.JA=e;a.get_anim_type=function(a,b){var c=a.C[b];return c?c.type:null};a.apply_def=function(a){var d=0,e,f=[];if((e=a.animation_data)&&e.action&&(e=e.action,u.ld(e.fcurves))){var g=u.ld(e.d.rj);"ARMATURE"!=a.type&&g||f.push(e)}ia.ee(a)&&a.data.animation_data&&a.data.animation_data.action&&f.push(a.data.animation_data.action);"MESH"==a.type&&(f=f.concat(k(a)));e=f;for(f=0;f<e.length;f++)g=e[f],L(a,d),r(a,g,d)?(F(a,d),a.C[d].behavior=
h(a.b4w_anim_behavior),d++):a.C[d]=null;e=a.particle_systems;for(f=0;f<e.length;f++){var g=e[f],m=g.settings;"EMITTER"==m.type&&(L(a,d),c(a,g,d),F(a,d),a.C[d].behavior=h(a.b4w_anim_behavior),m.b4w_cyclic&&(a.C[d].behavior=10),d++)}l(a)&&(L(a,d),b(a,a.data.b4w_vertex_anim[0],d),F(a,d),a.C[d].behavior=h(a.b4w_anim_behavior))};a.get_first_armature_object=g;a.play=function(a,b,c){m(a.C,c,function(a){a.play=!0;a.jm=b?b:null;a.gi=!1});a.d.Ae&&v(a)};a.stop=function(a,b){m(a.C,b,function(a){a.play=!1;a.jm=
null;a.gi=!1})};a.is_play=function(a,b){var c=a.C[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.C;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.mc=b,n(a,0,c,!0))}else if(e=d[c])e.mc=b,n(a,0,c,!0)};a.get_current_frame_float=function(a,b){var c=a.C[b];return c&&c.mc?c.mc:0};a.is_cyclic=function(a,b){var c=a.C[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){m(a.C,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.C[b];return c&&c.behavior};a.apply_smoothing=
function(a,b,c,d){m(a.C,d,function(a){a.ao=b||0;a.zn=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.C[c]=null;else a.C[b]=null;a.d.Ae&&E(a,b)};a.update_object_animation=n;a.Vj=function(a){if("ARMATURE"==a.type||g(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||S.Xg(a)&&S.Em(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||M(a)?!0:!1};a.is_animated=function(a){return Boolean(a.C.length)};
a.yv=B;a.kp=H;a.Mu=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);ea.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,e,h){if(-1<c.search(f)){a=b;c=c.split('"')[1];var k=g}else 8==h?(c="tsr",k=g):k=1<h?new Float32Array(h):0;if(!a[c]){h=a;b=c;if("object"==typeof k&&k.length)for(var l=k.length,m=new Float32Array(e*l),
n=0;n<e;n++)for(var r=0;r<l;r++)m[n*l+r]=k[r];else if("number"==typeof k)for(m=new Float32Array(e),n=0;n<e;n++)m[n]=k;else u.oa("Wrong storage default value");h[b]=m}return a[c]}a.d={};var e=a.d;e.kz=1/Z.Lf;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=P.create(),h=a.fcurves,k={},l={},m=0,n;for(n in h){var r=h[n],q;for(q in r){var t=r[q],A=t.hc;qa.Dv(t,a);t=t.num_channels;m||(m=A.length);for(var t=d(k,l,n,m,t),v=t.length/m,p=c(n,q|0),K=0;K<m;K++)t[K*v+p]=A[K]}}for(var x in k)"tsr"==x&&b(k[x],m);for(var w in l)b(l[w],
m);e.Ua=k;e.rj=l;e.qv=a.Cu;e.wr=m;e.wj="tsr"in k?z(h):null;ha.push(a)};a.Mx=function(a,b){return(b-a)*Z.Lf+1};a.fv=function(a,b,c,d,e,f){var g,h,k=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),r=b[1],q=b[2],t=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var A=0,v=0,p=null;e<=f;e++)if(e<r)for(var K=0;K<Z.Lf;K++)c[A++]=q;else if(e>t)for(K=0;K<Z.Lf;K++)c[A++]=a;else{var x=b[v],w=3;0===x&&(w+=2);0===p&&(w+=2);var I=2===x?0:1;if(b[v+1]==b[v+w+1])p=x,v+=
w;else{K=0;e==b[v+1]&&(I&&(d[A]=1),c[A]=b[v+2],A++,K++);if(e==t)for(;K<Z.Lf;K++)c[A++]=a;else for(k[0]=b[v+1],k[1]=b[v+2],0!==x?(l[0]=0,l[1]=0):0===p?(l[0]=b[v+5],l[1]=b[v+6]):(l[0]=b[v+3],l[1]=b[v+4]),0!==x?(m[0]=0,m[1]=0):(m[0]=b[v+w+3],m[1]=b[v+w+4]),n[0]=b[v+w+1],n[1]=b[v+w+2];K<Z.Lf;K++){var U=e+K/Z.Lf;switch(x){case 0:g=k;h=l;var y=m,X=n,B=[],z=[],E=void 0,C=void 0,M=void 0,E=void 0;B[0]=g[0]-h[0];B[1]=g[1]-h[1];z[0]=X[0]-y[0];z[1]=X[1]-y[1];M=X[0]-g[0];E=Math.abs(B[0]);C=Math.abs(z[0]);0!=
E+C&&E+C>M&&(E=M/(E+C),h[0]=g[0]-E*B[0],h[1]=g[1]-E*B[1],y[0]=X[0]-E*z[0],y[1]=X[1]-E*z[1]);I&&(d[A]=1);c[A]=O(N(0,1,U,k[0],l[0],m[0],n[0]),k[1],l[1],m[1],n[1]);A++;break;case 1:h=k[0];y=k[1];g=X=(n[1]-y)/(n[0]-h);h=y-X*h;I&&(d[A]=1);c[A]=g*U+h;A++;break;case 2:I&&(d[A]=1);c[A]=b[v+2];A++;break;default:u.oa("Unknown keyframe intepolation mode: "+x)}}e+1==b[v+w+1]&&(p=x,v+=w)}}};a.fD=function(a){for(var b=0;b<a.length;b++)if(a[b].qC)return a[b];return!1};a.apply=I;a.av=function(a,b,c){c=c||0;var d=
u.keysearch("uuid",b,ha);if(d){L(a,c);if(r(a,d,c)){F(a,c);return}a.C[c]=null}W.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.LB=function(a,b){var c=u.keysearch("name",b,ha)||u.keysearch("name",b+"_B4W_BAKED",ha);return c?u.ld(c.fcurves)?!0:!1:u.keysearch("name",b,a.particle_systems)?!0:!1};a.get_slot_num_by_anim=function(a,b){for(var c=a.C,d=0;d<c.length;d++){var f=c[d];if(f&&e(f.Cg)==e(b))return d}return-1};a.Kx=function(a,b){var c=a.C[b];return c&&c.Cg?e(c.Cg):null};a.remove=
function(a){a.C.length=0;a=fa.indexOf(a);-1!=a&&fa.splice(a,1)};a.yz=function(a){for(var b=ha.length-1;0<=b;b--)ha[b].Eu==a&&ha.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.C.length)return I(a,b,0)?0:-1;for(var c=0;c<a.C.length;c++)if(!a.C[c])return I(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.gl=(b-a.d.ze)/c;a.d.fl=b};a.set_speed=function(a,b,c){m(a.C,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.C[b].speed};a.get_anim_start_frame=function(a,b){return a.C[b].start};
a.get_anim_length=function(a,b){return a.C[b].length};a.Iq=M;a.cleanup=function(){fa.length=0;ha.length=0};a.lx=function(a){var b=(a[0]||a[1]||a[2]).hc.length,c=X,d=K,e=Boolean(a[0]);e||(a[0]={hc:new Float32Array(b),num_channels:8});var f=Boolean(a[1]);f||(a[1]={hc:new Float32Array(b),num_channels:8});var g=Boolean(a[2]);g||(a[2]={hc:new Float32Array(b),num_channels:8});a[3]={hc:new Float32Array(b),num_channels:8};for(var h=0;h<b;h++)d[0]=e?a[0].hc[h]:0,d[1]=f?a[1].hc[h]:0,d[2]=g?a[2].hc[h]:0,u.euler_to_quat(d,
c),a[0].hc[h]=c[3],a[1].hc[h]=c[0],a[2].hc[h]=c[1],a[3].hc[h]=c[2]}};b4w.module.__time=function(a,p){p("__util");var d=0,b=0,c=[],e=0,h=[];a.os=function(a){d=a;b=performance.now();for(a=0;a<c.length;a++){var e=c[a];d>e.dm&&(c.splice(a,1),a--,e.callback())}for(a=0;a<h.length;a++){var e=h[a],l=1-(e.dm-d)/e.duration,l=Math.min(l,1);e.callback(e.L+l*(e.da-e.L));1==l&&(h.splice(a,1),a--)}};a.get_timeline=function(){return d};a.set_timeout=function(a,f){var h;e++;h=e;c.push({id:h,callback:a,dm:d+(performance.now()-b+f)/1E3});return h};a.clear_timeout=function(a){for(var b=
0;b<c.length;b++)if(c[b].id==a){c.splice(b,1);break}};a.animate=function(a,b,c,e){c/=1E3;h.push({callback:e,L:a,da:b,dm:d+c,duration:c});e(a)};a.reset=function(){b=d=0;e=c.length=0}};b4w.module.__transform=function(a,p){function d(a,b){var c=a.d;c.g[0]=b[0];c.g[1]=b[1];c.g[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function b(a){var d=a.d,r=l.Ug();"CAMERA"==a.type&&e.fo(a);h.lB(a,C);"CAMERA"==a.type&&e.iB(a);var t=d.g,p=d.scale,x=d.quat;m.set_sep(t,p,x,d.xb);var w=d.T;B.identity(w);B.fromQuat(x,w);"CAMERA"!=a.type&&n.Mz(w,p,w);w[12]=t[0];w[13]=t[1];w[14]=t[2];B.invert(w,d.Rq);a.C.length&&f.Em(a)&&f.mB(a);d.Mb&&d.Za&&(c.ul(d.Mb,w,d.Za),c.wl(d.Pc,
w,d.rb),c.vl(d.zf,d.xb,d.Af),d.xc&&l.Dn(r),null!=d.lc&&r&&l.Zs(r,a));if(r&&r.d.wb)for(w=r.d.wb.Ak,p=0;p<w.length;p++)if(w[p]==a){l.bt(p,r);break}switch(a.type){case "SPEAKER":g.zA(a,C);break;case "CAMERA":e.jB(a);r&&l.Lj(r)==a&&g.My(r,t,x,C);break;case "LAMP":k.nB(a);r&&l.rg(a,r);break;case "EMPTY":a.field&&l.$s(a);break;case "MESH":t=a.modifiers;x=null;for(p=0;p<t.length;p++)w=t[p],"ARMATURE"==w.type&&(x=w.object);x&&(m.invert(x.d.xb,G),m.multiply(G,d.xb,G),A.set(G[0],G[1],G[2],G[3],d.jl),v.set(G[4],
G[5],G[6],G[7],d.il))}"LAMP"!=a.type&&"CAMERA"!=a.type||!r||(l.Dn(r),l.Pz(r));a=a.Ec;for(p=0;p<a.length;p++)b(a[p]);d.pm=!0}var c=p("__boundings"),e=p("__camera"),h=p("__constraints"),k=p("__lights"),f=p("__particles"),l=p("__scenes"),g=p("__sfx"),m=p("__tsr"),n=p("__util"),r=p("vec3"),A=p("vec4"),v=p("quat"),E=p("mat3"),B=p("mat4"),w=new Float32Array(3),t=new Float32Array(4),x=new Float32Array(9),G=new Float32Array(8),C=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){C=a};a.set_translation=
function(a,b){h.ce(a)==h.Fd?m.set_trans(b,h.be(a)):a.d.g.set(b)};a.get_translation=function(a,b){h.ce(a)==h.Fd?r.copy(m.get_trans_view(h.be(a)),b):r.copy(a.d.g,b)};a.set_rotation=function(a,b){h.ce(a)==h.Fd?m.set_quat(b,h.be(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){h.ce(a)==h.Fd?v.copy(m.get_quat_view(h.be(a)),b):v.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(h.ce(a)==h.Fd){var c=n.euler_to_quat(b,t);m.set_quat(c,h.be(a))}else n.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,
b){h.ce(a)==h.Fd?m.set_scale(b,h.be(a)):a.d.scale=b};a.get_scale=function(a){return h.ce(a)==h.Fd?m.get_scale(h.be(a)):a.d.scale};a.get_tsr=function(a,b){if(h.ce(a)==h.Fd)m.copy(h.be(a),b);else{var c=a.d;m.set_sep(c.g,c.scale,c.quat,b)}};a.set_tsr=function(a,b){h.ce(a)==h.Fd?m.copy(b,h.be(a)):d(a,b)};a.gA=d;a.get_object_size=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=
function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,r.copy(b.rb.F,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,r.transformMat4(c,b.T,c));return c};a.move_local=function(a,b,c,d){a=a.d;w[0]=b;w[1]=c;w[2]=d;b=E.fromMat4(a.T,x);r.transformMat3(w,b,w);r.add(a.g,w,a.g)};a.w=b;a.distance=function(a,b){return r.dist(a.d.g,b.d.g)};a.fz=function(a,b){return r.dist(a.d.g,b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Za.max_x,min_x:a.d.Za.min_x,
max_y:a.d.Za.max_y,min_y:a.d.Za.min_y,max_z:a.d.Za.max_z,min_z:a.d.Za.min_z}}};b4w.module.__tsr=function(a,p){function d(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function b(a,b,c){var d=b[0],e=b[1],f=b[2],h=b[3],k=b[4],p=b[5],w=b[6];b=b[7];var t=a[0]*h,x=a[1]*h,G=a[2]*h;a=b*t+p*G-w*x;var h=b*x+w*t-k*G,C=b*G+k*x-p*t,t=-k*t-p*x-w*G;c[0]=a*b+t*-k+h*-w-C*-p;c[1]=h*b+t*-p+C*-k-a*-w;c[2]=C*b+t*-w+a*-p-h*-k;c[0]+=d;c[1]+=e;c[2]+=f;return c}var c=p("__util"),e=p("vec3"),h=p("quat");p("mat4");var k=new Float32Array(3),f=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,c,e){e||(e=new Float32Array(8));d(a,b,c,e);return e};a.set_sep=d;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.set_quat=function(a,b){b[4]=a[0];b[5]=
a[1];b[6]=a[2];b[7]=a[3]};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],e=a[1],k=a[2];f[0]=a[4];f[1]=a[5];f[2]=a[6];f[3]=a[7];h.invert(f,f);var v=f[0],p=f[1],B=f[2],w=f[3],d=d*c,e=e*c,t=k*c,k=w*d+p*t-B*e,x=w*e+B*d-v*t,G=w*t+v*e-p*d,d=-v*d-p*e-B*t;b[0]=-(k*w+d*-v+x*-B-G*-p);b[1]=-(x*w+d*-p+G*-v-k*-B);b[2]=-(G*w+d*-B+k*-p-x*-v);b[3]=c;b[4]=v;
b[5]=p;b[6]=B;b[7]=w;return b};a.from_mat4=function(a,b){var e=c.eh(a,k),h=c.dn(a),r=c.matrix_to_quat(a,f);d(e,h,r,b);return b};a.multiply=function(a,c,d){b(c,a,d);d[3]=a[3]*c[3];var e=a[4],f=a[5],h=a[6];a=a[7];var k=c[4],p=c[5],B=c[6];c=c[7];d[4]=e*c+a*k+f*B-h*p;d[5]=f*c+a*p+h*k-e*B;d[6]=h*c+a*B+e*p-f*k;d[7]=a*c-e*k-f*p-h*B;return d};a.transform_vec3=b;a.transform_vec3_inv=function(a,b,c){var d=b[3],e=a[0]-b[0],f=a[1]-b[1],h=a[2]-b[2];a=b[4];var k=b[5],p=b[6];b=b[7];var w=a*a+k*k+p*p+b*b,w=w?1/w:
0;a=-a*w;k=-k*w;p=-p*w;b*=w;var w=b*e+k*h-p*f,t=b*f+p*e-a*h,x=b*h+a*f-k*e,e=-a*e-k*f-p*h;c[0]=w*b+e*-a+t*-p-x*-k;c[1]=t*b+e*-k+x*-a-w*-p;c[2]=x*b+e*-p+w*-k-t*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var e=a.length,f=b[0],h=b[1],k=b[2],p=b[3],w=b[4],t=b[5],x=b[6];b=b[7];for(var G=0;G<e;G+=3){var C=a[G]*p,q=a[G+1]*p,y=a[G+2]*p,H=b*C+t*y-x*q,z=b*q+x*C-w*y,N=b*y+w*q-t*C,C=-w*C-t*q-x*y;c[d+G]=H*b+C*-w+z*-x-N*-t;c[d+G+1]=z*b+C*-t+N*-w-H*-x;c[d+G+2]=N*b+C*-x+H*
-t-z*-w;c[d+G]+=f;c[d+G+1]+=h;c[d+G+2]+=k}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var e=a.length,f=b[3],h=b[4],k=b[5],p=b[6];b=b[7];for(var w=0;w<e;w+=3){var t=a[w]*f,x=a[w+1]*f,G=a[w+2]*f,C=b*t+k*G-p*x,q=b*x+p*t-h*G,y=b*G+h*x-k*t,t=-h*t-k*x-p*G;c[d+w]=C*b+t*-h+q*-p-y*-k;c[d+w+1]=q*b+t*-k+y*-h-C*-p;c[d+w+2]=y*b+t*-p+C*-k-q*-h}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],e=b[4],f=b[5],h=b[6];b=b[7];var k=a[0]*d,p=a[1]*d,w=a[2]*d;a=b*k+f*w-h*p;var d=b*p+h*k-e*w,t=b*
w+e*p-f*k,k=-e*k-f*p-h*w;c[0]=a*b+k*-e+d*-h-t*-f;c[1]=d*b+k*-f+t*-e-a*-h;c[2]=t*b+k*-h+a*-f-d*-e;return c};a.transform_tangents=function(a,b,c,d){d||(d=0);var e=a.length,f=b[3],h=b[4],k=b[5],p=b[6];b=b[7];for(var w=0;w<e;w+=4){var t=a[w]*f,x=a[w+1]*f,G=a[w+2]*f,C=b*t+k*G-p*x,q=b*x+p*t-h*G,y=b*G+h*x-k*t,t=-h*t-k*x-p*G;c[d+w]=C*b+t*-h+q*-p-y*-k;c[d+w+1]=q*b+t*-k+y*-h-C*-p;c[d+w+2]=y*b+t*-p+C*-k-q*-h;c[d+w+3]=a[w+3]}return c};a.translate=function(a,b,c){var d=a[3],e=a[4],f=a[5],h=a[6],k=a[7],p=b[0]*
d,w=b[1]*d,t=b[2]*d;b=k*p+f*t-h*w;var d=k*w+h*p-e*t,x=k*t+e*w-f*p,p=-e*p-f*w-h*t;c[0]=a[0]+b*k+p*-e+d*-h-x*-f;c[1]=a[1]+d*k+p*-f+x*-e-b*-h;c[2]=a[2]+x*k+p*-h+b*-f-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){d||(d=new Float32Array(8));e.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var f=a[3];d[3]=f+c*(b[3]-f);h.slerp(a.subarray(4),b.subarray(4),c,d.subarray(4));return d};a.cD=function(a,b,c,d){d||(d=new Float32Array(8));var e=a.subarray(0,
3),f=b.subarray(0,3),k=d.subarray(0,3);k[0]=f[0]*(c+1)-e[0]*c;k[1]=f[1]*(c+1)-e[1]*c;k[2]=f[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);e=d.subarray(4);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;h.normalize(e,e);return d};a.wy=function(a,b,c,d,e){e[0]=a[0]+b*c[0];e[1]=a[1]+b*c[1];e[2]=a[2]+b*c[2];e[3]=a[3];c=d[0];var f=d[1];d=d[2];var h=a[4],k=a[5],p=a[6],w=a[7];e[4]=.5*(c*w+f*p-d*k);e[5]=.5*(f*w+d*h-c*p);e[6]=.5*(d*w+c*k-
f*h);e[7]=.5*(-c*h-f*k-d*p);e[4]=a[4]+e[4]*b;e[5]=a[5]+e[5]*b;e[6]=a[6]+e[6]*b;e[7]=a[7]+e[7]*b;a=e[4];b=e[5];c=e[6];f=e[7];a=a*a+b*b+c*c+f*f;0<a&&(a=1/Math.sqrt(a),e[4]*=a,e[5]*=a,e[6]*=a,e[7]*=a)}};b4w.module.__util=function(a,p){function d(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function b(a,c){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=c.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:b(a[e],c);return d}function c(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function e(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function h(a,b){var c=b;switch(typeof a){case "number":return k(a,
c);case "string":return f(a,c);case "boolean":return k(a|0,c);case "function":case "undefined":return k(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=k(a[d],c);else if(d)for(d=0;d<a.length;d++)c=h(a[d],c);else for(var e in a)c=h(a[e],c)}else c=k(0,c)}return c}function k(a,b){var c=b;R[0]=a;c=(c<<5)-c+ca[0];c&=c;c=(c<<5)-c+ca[1];return c&c}function f(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function l(a){return(34*a+1)*a%289}function g(a){return a-Math.floor(a)}function m(a){return n((34*a+5)*a)}function n(a){return a-289*Math.floor(a/289)}function r(a){return a-7*Math.floor(a/7)}function A(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function v(a){return A(a,0,2*Math.PI)}function E(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||
d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!B(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!B(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function B(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return E(a,b);default:return!0}}var w=p("__print"),t=p("vec3"),x=p("vec4"),G=p("quat"),
C=p("mat3"),q=p("mat4"),y=0,H={},z=new Float32Array(3),N=new Float32Array(3),O=new Float32Array(4),L=new Float32Array(4),F=new Float32Array(9),I=new Float32Array(16),M=new Float32Array(16),R=new Float64Array(1),ca=new Uint32Array(R.buffer),S=new Float32Array([0,0,0]),Y=new Float32Array([0,0,0,1]),W=new Float32Array([0,0,0,1,0,0,0,1]),ia=new Float32Array([1,0,0]),ma=new Float32Array([0,1,0]),P=new Float32Array([0,0,1]),u=new Float32Array([-1,0,0]),qa=new Float32Array([0,-1,0]),ea=new Float32Array([0,
0,-1]),ja=Math.floor(44488.07041494893),Z=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])];a.Bu=S;a.vu=Y;a.nC=W;a.AXIS_X=ia;a.AXIS_Y=ma;a.AXIS_Z=P;a.AXIS_MX=u;a.AXIS_MY=qa;a.AXIS_MZ=ea;a.ut=Z;a.keyfind=d;a.nx=function(a,b){var c=
a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.aB=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Jv=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.gv=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.SD=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==
b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.RD=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.xm=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.$u=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.NC=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.dE=
function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.bE=function(a,b){var c=d("name",b,a);1<c.length&&w.error("obj_by_name(): name resolution ambiguity");return c};a.cE=function(a,b){var c=d("name",b,a),e=c.length;1<e&&w.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=c[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,k=0;k<h.length;k++)f.push(h[k])}return c=c.concat(f)};a.XA=function(a,b,
c,d){d||(d=new Float32Array(16));q.identity(d);d[12]=a;d[13]=b;d[14]=c};var oa=1;a.uz=function(){oa=(69069*oa+5)%Math.pow(2,32);return Math.round(oa/65536)%32768/32767};a.GA=function(a){oa=a};a.Mc=function(a){var b=a[0]%ja*48271-3399*Math.floor(a[0]/ja);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Tj=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/
2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.bx=function(a){var b=C.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,l=f*e,m=f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-k;b[4]=g*m+h;b[5]=d*f;b[6]=g*h+m;b[7]=g*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=
Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));t.transformQuat(b,a,c);return c};a.YC=function(a,b,c){c||(c=new Float32Array(4));a=t.normalize(a,z);var d=t.dot(b,a);a=t.cross(b,a,N);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.YA=
function(a,b,c,d){d||(d=new Float32Array(4));t.transformQuat(c,b,d);d[3]=-t.dot(a,d)};a.Vw=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":z[0]=0;z[1]=-1;z[2]=0;t.transformQuat(z,b,z);N[0]=0;N[1]=0;N[2]=-1;break;case "MESH":z[0]=0;z[1]=0;z[2]=1;t.transformQuat(z,b,z);N[0]=0;N[1]=0;N[2]=1;break;case "EMPTY":z[0]=0,z[1]=1,z[2]=0,t.transformQuat(z,b,z),N[0]=0,N[1]=1,N[2]=0}z[1]=0;t.normalize(z,z);a=t.dot(z,N);return Math.acos(a)*(0<-z[0]*N[2]?-1:1)};a.cp=function(a,b,c,d){if(0!=c){d=d||[];for(var e=
0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.wE=function(){y++;return y.toString(16)};a.Nk=function(a){H[a]||(H[a]=0);var b=a+H[a];H[a]++;return b};a.Qc=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.jb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,I:0,ba:null,B:[],H:b,U:[]}};a.Ef=function(a){return JSON.parse(JSON.stringify(a))};a.PC=function(a,c){var d=[],
e;for(e in c){var f=c[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return b(a,d)};a.ya=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.ya(b[d]):b[d];return c};a.xj=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof
Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.Wj=function(a){return"EMPTY"===a.type?!0:!1};a.is_armature=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));C.fromMat4(a,F);var c=F[0],d=F[3],e=F[6],f=F[1],g=F[4],h=F[7],k=F[2],l=F[5],m=F[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*
k+l*l+m*m)||1;F[0]/=c;F[3]/=c;F[6]/=c;F[1]/=f;F[4]/=f;F[7]/=f;F[2]/=k;F[5]/=k;F[8]/=k;G.fromMat3(F,b);return b};a.eh=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.dn=function(a){O[0]=.577350269189626;O[1]=.577350269189626;O[2]=.577350269189626;O[3]=0;x.transformMat4(O,a,O);return x.length(O)};a.gm=function(a,b){var d=b.left,e=b.right,f=b.top,g=b.bottom,h=b.Ta,k=b.bb;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];
e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];c(d);c(e);c(f);c(g);c(h);c(k)};a.BA=function(a,b,c){return c<-e(a,b.left)||c<-e(a,b.right)||c<-e(a,b.top)||c<-e(a,b.bottom)||c<-e(a,b.Ta)||c<-e(a,b.bb)?!0:!1};a.ax=function(a,b,c,d,f){g=t.dot(c,b.bb);h=t.dot(d,b.bb);
k=t.dot(f,b.bb);g=Math.sqrt(g*g+h*h+k*k);if(g<-e(a,b.Ta)||g<-e(a,b.bb))return!0;var g=t.dot(c,b.left),h=t.dot(d,b.left),k=t.dot(f,b.left);if(Math.sqrt(g*g+h*h+k*k)<-e(a,b.left))return!0;g=t.dot(c,b.right);h=t.dot(d,b.right);k=t.dot(f,b.right);if(Math.sqrt(g*g+h*h+k*k)<-e(a,b.right))return!0;g=t.dot(c,b.top);h=t.dot(d,b.top);k=t.dot(f,b.top);if(Math.sqrt(g*g+h*h+k*k)<-e(a,b.top))return!0;g=t.dot(c,b.bottom);h=t.dot(d,b.bottom);k=t.dot(f,b.bottom);return Math.sqrt(g*g+h*h+k*k)<-e(a,b.bottom)?!0:!1};
a.We=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.OB=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.UA=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*
k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.MB=function(a,b,c){c||(c=new Float32Array(3));O[0]=a[0];O[1]=a[1];O[2]=a[2];O[3]=0;x.transformMat4(O,b,O);c[0]=O[0];c[1]=O[1];c[2]=O[2]};a.gD=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.NB=function(a){for(var b=[],c=0;c<a.length;c+=
3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.pj=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.pj(b,c,d,f-1):b[f]<c?a.pj(b,c,f+1,e):f};a.De=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.yj=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.Mz=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.bo=function(a,
b,c,d){d||(d=new Float32Array(16));b=q.fromRotationTranslation(b,c,I);q.multiply(b,a,d)};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=q.fromRotationTranslation(c,d,I);1!==b&&(d=q.identity(M),b=t.set(b,b,b,z),q.scale(d,b,d),q.multiply(c,d,c));t.transformMat4(a,c,e);return e};a.co=function(a,b,c,d){d||(d=new Float32Array(4));b=q.fromRotationTranslation(b,c,I);x.transformMat4(a,b,d)};a.JD=function(a,b,c,d,e){e||(e=new Float32Array(3));b=q.fromRotationTranslation(c,d,I);q.invert(b,
b);t.transformMat4(a,b,e);return e};a.uE=function(a,b,c){c||(c=new Float32Array(16));q.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.aE=function(b,c,d){a.eh(b,c);c[3]=a.dn(b);a.matrix_to_quat(b,d)};a.To=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.Iz=function(a,b,c,d){d||(d=new Float32Array(3));t.subtract(b,a,z);t.transformQuat(z,c,z);t.subtract(b,z,d)};a.zx=function(){z[0]=0;z[1]=0;z[2]=0;var a=new Float32Array(16),b=new Float32Array(16),
c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);q.lookAt(z,[-1,0,0],[0,-1,0],a);q.scale(a,[-1,1,1],a);q.scale(a,[-1,1,-1],b);q.lookAt(z,[0,-1,0],[0,0,-1],c);q.scale(c,[1,1,-1],c);q.scale(c,[1,-1,-1],d);q.lookAt(z,[0,0,-1],[0,-1,0],e);q.scale(e,[-1,1,1],e);q.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Dx=function(){z[0]=0;z[1]=0;z[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=
new Float32Array(16);q.lookAt(z,[1,0,0],[0,-1,0],a);q.scale(a,[-1,1,-1],b);q.lookAt(z,[0,1,0],[0,0,1],c);q.scale(c,[1,-1,-1],d);q.lookAt(z,[0,0,1],[0,-1,0],e);q.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Gg=function(a,b){return h(a,b)};a.hash_code=h;a.CD=f;a.$D=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,m,n,r,q,t,p,A;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];
h=a[2];k=a[3];l=a[4];m=a[5];n=a[6];r=a[7];q=a[8];t=a[9];p=a[10];A=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=l;c[5]=m;c[6]=n;c[7]=r;c[8]=q;c[9]=t;c[10]=p;c[11]=A;c[12]=f*d+l*e+q*b+a[12];c[13]=g*d+m*e+t*b+a[13];c[14]=h*d+n*e+p*b+a[14];c[15]=k*d+r*e+A*b+a[15];return c};a.Ry=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*
a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.yk=function(a){return a*Math.PI/180};a.Qw=function(a){return 180*a/Math.PI};a.Kn=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,h=1-f,e=b+.211324865405187-f,k=a+
.211324865405187-h,m=b+-.577350269189626,n=a+-.577350269189626,c=c%289,d=d%289,r=l(l(d)+c),h=l(l(d+h)+c+f),q=l(l(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+k*k),0),f=Math.max(.5-(m*m+n*n),0),t=2*g(.024390243902439*r)-1,p=2*g(.024390243902439*h)-1,A=2*g(.024390243902439*q)-1,r=Math.abs(t)-.5,h=Math.abs(p)-.5,q=Math.abs(A)-.5,t=t-Math.floor(t+.5),p=p-Math.floor(p+.5),A=A-Math.floor(A+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(t*t+r*r)),d=d*d*d*d*(1.79284291400159-.85373472095314*
(p*p+h*h)),f=f*f*f*f*(1.79284291400159-.85373472095314*(A*A+q*q));return 130*(c*(t*b+r*a)+d*(p*e+h*k)+f*(A*m+q*n))};a.qp=function(a){var b=1/7,c=b/2,d=n(Math.floor(a[0])),e=n(Math.floor(a[1])),f=g(a[0]);a=g(a[1]);var h=f-.5,k=f-1.5,f=a-.5;a-=1.5;var l=m(d),q=m(d+1),t=l,d=q,l=m(l+e),q=m(q+e),t=m(t+e+1),d=m(d+e+1),e=h+.7*(r(l)*b+c),p=k+.7*(r(q)*b+c),h=h+.7*(r(t)*b+c),k=k+.7*(r(d)*b+c),l=f+.7*(r(Math.floor(l*b))*b+c),f=f+.7*(r(Math.floor(q*b))*b+c),t=a+.7*(r(Math.floor(t*b))*b+c),b=a+.7*(r(Math.floor(d*
b))*b+c);return Math.min(e*e+l*l,p*p+f*f,h*h+t*t,k*k+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=t.transformQuat(b,a,z);b=c[0];var f=c[1];c=c[2];F[0]=f*f+c*c;F[1]=-f*b;F[2]=-c*b;F[3]=-b*f;F[4]=b*b+c*c;F[5]=-c*f;F[6]=-b*c;F[7]=-f*c;F[8]=b*b+f*f;t.transformMat3(a,F,a);t.normalize(a,a);G.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=O,d=L,c=G.setAxisAngle([0,1,0],Math.PI,G.create()),d=G.setAxisAngle([1,0,0],Math.PI/2,G.create());
G.multiply(c,d,c);G.multiply(a,c,b);return b};a.cleanup=function(){y=0;H={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.As=function(a,b,c,d,e){e||(e=new Float32Array(a.length));G.slerp(a,b,Math.exp(-c/d),e)};a.KD=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?
!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=C.fromQuat(a,F);N[0]=0;N[1]=1;N[2]=0;z[0]=c[3];z[1]=c[4];z[2]=c[5];var d=t.cross(N,z,z);t.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);N[0]=c[0];N[1]=c[1];N[2]=c[2];t.normalize(N,N);G.rotationTo(N,d,L);G.multiply(L,a,a)};a.lq=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);
c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.mg=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.hs=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Li=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.sm=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=
16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.ld=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];t.normalize(c,c)};a.ZA=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,m=f*e-g*d,n=g*m-h*l,h=h*k-f*m,f=f*l-g*k;c[0]=
d+2*k*b+2*n;c[1]=e+2*l*b+2*h;c[2]=a+2*m*b+2*f};a.oa=function(a){a&&w.error.apply(w,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=A;a.angle_wrap_0_2pi=v;a.vm=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Ms=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=E(e,f)}if(!d)return!1}return!0};a.yn=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};
a.gq=function(a){a+=1;132651<a&&w.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){O.set(a);O[3]=b;L.set(d);L[3]=0;a=x.dot(O,L);if(0==a)return null;L.set(c);L[3]=1;a=-x.dot(O,L)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.RC=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.Kz=function(a,b,c){var d=t.dot(a,b);-.9999999>d?(t.cross(ia,a,z),
1E-6>t.length(z)&&t.cross(ma,a,z),t.normalize(z,z),G.setAxisAngle(z,Math.PI,c)):(t.cross(a,b,z),c.set(z),c[3]=1+d,G.normalize(c,c));return c};a.Ce=function(a,b,c){if(b==c)return c-a;a=v(a);b=v(b);c=v(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=v(c+b);a=v(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a){return a*a*(3-2*a)};a.hv=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1}};b4w.module.__sfx=function(a,p){function d(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;E.warn("deprecated WebAudio implementation");return null}E.warn("WebAudio is not supported");return null}function b(a,b,d){var e=a.i;if("NONE"!=e.behavior){d||(d=0);var g=e.loop,l=e.pitch;if(e.src&&(g||0<=d)){e.ml=Math.floor(5E4*Math.random());var m=z.currentTime+b;e.yc=m;e.state=20;c(a);"POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior?(b=z.createBufferSource(),
b.buffer=e.src,b.playbackRate.value=l,g?(e.ob&&e.ob.disconnect(),b.loop=!0,b.start(m),e.duration=0):(g=b.buffer?b.buffer.duration:0,d>g?(g=m+d+e.$d,b.loop=!0,b.start(m),b.stop(g),e.duration=d):(b.loop=!1,b.start(m),e.duration=g)),b.connect(e.ac),e.ob=b,h(e),k(e)):"BACKGROUND_MUSIC"==e.behavior&&(B.clear_timeout(e.ql),B.clear_timeout(e.rl),d=function(){var b=a.i,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.ob=b.ob||z.createMediaElementSource(c),b.ob.connect(b.ac),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==b?d():e.ql=B.set_timeout(d,1E3*b),e.duration=g?0:A(a));f(e,m)}}}function c(a){var b=a.i;if(!b.ac){var c=a.d.g;a=a.d.quat;if(x.gk){var d=z.createBiquadFilter();d.type="peaking"}else d=null;var e=z.createGain();switch(b.behavior){case "POSITIONAL":var f=z.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);b.Um.set(c);c=G;w.quat_to_dir(a,
w.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);b.direction.set(c);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.Yv;f.coneOuterAngle=b.Zv;f.coneOuterGain=b.$v;var g=z.createGain();g.gain.value=r(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.ac=f;if(b.Kh){var h=z.createGain();e.connect(h);h.connect(z?N.i.ac:null)}else h=null,e.connect(z?N.i.ac:null);break;case "BACKGROUND_SOUND":f=null;g=z.createGain();g.gain.value=r(b);d?(b.ac=d,d.connect(g)):
b.ac=g;g.connect(e);b.Kh?(h=z.createGain(),e.connect(h),h.connect(z?N.i.ac:null)):(h=null,e.connect(z?N.i.ac:null));break;case "BACKGROUND_MUSIC":h=f=null,g=z.createGain(),g.gain.value=r(b),d?(b.ac=d,d.connect(g)):b.ac=g,g.connect(e),e.connect(z?N.i.ac:null)}b.yi=f;b.kd=d;b.Sg=g;b.If=e;b.$r=h}}function e(a){var c=a.i,d=c.duration,c=c.delay+c.Rw*Math.random();b(a,c,d)}function h(a){a.Kh&&a.$r.gain.cancelScheduledValues(a.yc);a.Bi&&a.ob.playbackRate.cancelScheduledValues(a.yc);a.Vi=a.yc}function k(a){if(a.Kh||
a.Bi){var b=a.$r,c=a.ob,d=c.buffer?c.buffer.duration:0;if(d){var e=a.yc;L[0]=a.ml;for(var f=0;5>f;){var g=a.pitch+a.Bi*w.Mc(L);if(e>=a.Vi){if(a.Kh){var h=1-w.clamp(a.Kh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.Bi&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.Vi=e-.001}}}function f(a,b){if(a.hm||a.$d){var c=a.If;c.gain.cancelScheduledValues(b);a.hm?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.hm)):c.gain.setValueAtTime(1,b);a.$d&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),
c.gain.linearRampToValueAtTime(0,b+a.duration+a.$d))}}function l(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.i;if(20==b.state||40==b.state){var c=b.If,d=z.currentTime;b.$d&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.$d));"BACKGROUND_MUSIC"==b.behavior?b.src&&(B.clear_timeout(b.ql),B.clear_timeout(b.rl),b.rl=B.set_timeout(function(){var b=a.i.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.$d)):(c=b.ob,b.duration<c.buffer.duration?b.$d&&20==
b.state?c.stop(d+b.$d):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.yc=0,b.tn=0,b.xl=0);b.state=30}}function g(a){a=a.i;if(20==a.state){var b=z.currentTime;a.tn=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.yc){L[0]=a.ml;for(var d=a.ob.buffer.duration,e=a.yc;e<b;)c=a.pitch+a.Bi*w.Mc(L),e+=d/c;c*=d/c-(e-b)}else c=0;a.xl=c;a.ob.stop(0);a.ob.disconnect();h(a)}a.state=40}}function m(a){var b=a.i;if(40==b.state){var c=z.currentTime;b.yc+=c-b.tn;if("BACKGROUND_MUSIC"==
b.behavior)b.src.play();else{a=a.i;var d=z.createBufferSource();d.loop=a.ob.loop;d.buffer=a.ob.buffer;d.playbackRate.value=a.ob.playbackRate.value;a.yi?d.connect(a.yi):d.connect(a.Sg);a.ob=d;b.Vi=c;b.ob.start(b.yc,b.xl);k(b)}f(b,b.yc);b.state=20}}function n(a){return!a.i||20!=a.i.state&&40!=a.i.state&&30!=a.i.state?!1:!0}function r(a){return a.muted?0:a.volume}function A(a){a=a.i;return(a=a.src)?a.duration:0}var v=p("__config"),E=p("__print"),B=p("__time"),w=p("__util"),t=p("vec3"),x=v.Wc;a.xo=10;
a.Vk=20;a.wo=30;var G=new Float32Array(3),C=new Float32Array(3),q=new Float32Array(3),y=[],H=[],z=null,N=null,O=[],L=[1],F=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(y.push("ogg"),y.push("ogv")),""!=a.canPlayType("audio/mpeg")&&y.push("mp3"),""!=a.canPlayType("audio/mp4")&&(y.push("mp4"),y.push("m4v")),""!=a.canPlayType("audio/webm")&&y.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&
H.push("ogv"),""!=b.canPlayType("video/mp4")&&H.push("m4v"),""!=b.canPlayType("video/webm")&&H.push("webm"));(z=x.so?d():null)&&E.log("%cINIT WEBAUDIO: "+z.sampleRate+"Hz","color: #00a")};a.Wo=function(a){var b={Wf:new Float32Array(3),ir:new Float32Array(3),dh:new Float32Array(3)};a.i=b;if(z){var c=z.createGain(),d=z.createGain();b.Sg=c;b.If=d;c.connect(d);d.connect(z.destination);if(a.b4w_enable_dynamic_compressor){var d=z.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=
e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.Xh=d;b.ac=d}else b.Xh=null,b.ac=c;c=z.listener;b.Lg=v.o.Cl;b.Lg||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.Hf=0}};a.Uz=function(a){N=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<y.indexOf(a)?a:"ogg"==a&&-1<y.indexOf("mp4")?"mp4":"mp3"==a&&-1<y.indexOf("ogg")?"ogg":"mp4"==a&&-1<y.indexOf("ogg")?"ogg":"ogv"==
a&&-1<y.indexOf("m4v")?"m4v":"webm"==a&&-1<y.indexOf("m4v")?"m4v":"m4v"==a&&-1<y.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<H.indexOf(a)?a:"ogv"==a&&-1<H.indexOf("m4v")?"m4v":"webm"==a&&-1<H.indexOf("m4v")?"m4v":"m4v"==a&&-1<H.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.i={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.i.behavior=z?b.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var c=a.i,d;z?(window.MediaElementAudioSourceNode?d=!0:(E.warn("MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.i.behavior="NONE");a.i.Lg=b.b4w_disable_doppler&&v.o.Cl;a.i.muted=b.muted;a.i.volume=b.volume;a.i.pitch=b.pitch;a.i.attenuation=b.attenuation;a.i.dist_ref=b.distance_reference;a.i.dist_max=b.distance_max||1E4;a.i.Yv=b.cone_angle_inner;a.i.Zv=b.cone_angle_outer;
a.i.$v=b.cone_volume_outer;a.i.cyclic=b.b4w_cyclic_play;a.i.loop=b.b4w_loop;a.i.delay=b.b4w_delay;a.i.Rw=b.b4w_delay_random;a.i.Kh=b.b4w_volume_random;a.i.Bi=b.b4w_pitch_random;a.i.hm=b.b4w_fade_in;a.i.$d=b.b4w_fade_out;a.i.yc=0;a.i.tn=0;a.i.xl=0;a.i.duration=0;a.i.Vi=0;a.i.ml=1;a.i.src=null;a.i.state=10;a.i.Um=new Float32Array(3);a.i.direction=new Float32Array(3);a.i.Ln=new Float32Array(3);a.i.ql=-1;a.i.rl=-1;a.i.Hf=0;O.push(a)};a.Cs=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.i.behavior){case "POSITIONAL":return a.Vk;
case "BACKGROUND_SOUND":return a.Vk;case "BACKGROUND_MUSIC":return a.wo;case "NONE":return a.xo;default:throw"Wrong speaker behavior";}};a.uB=function(a,b){var c=a.i;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.lz=function(){var a=z.createBufferSource();a.buffer=z.createBuffer(1,22050,22050);a.connect(z.destination);a.start(0)};a.Nw=function(a,b,c){z?z.decodeAudioData(a,b,c):c()};a.xA=
function(a){l(a);delete a.i;O.splice(O.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<O.length;a++){var b=O[a].i;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.ob&&b.ob.disconnect()}N&&N.i&&(a=N.i,a.Wf[0]=0,a.Wf[1]=0,a.Wf[2]=0,a.dh[0]=0,a.dh[1]=0,a.dh[2]=0);N=null;O.splice(0);F=null};a.update=function(a){if(z&&0!=O.length){for(var b=0;b<O.length;b++){var c=O[b],d=c.i,f=z.currentTime;z&&!d.loop&&d.cyclic&&20==d.state&&d.duration&&d.yc+d.duration<f&&e(c);20==d.state&&3>d.Vi-f&&k(d)}F&&F.ne.length&&
(-1==F.Ka||a>F.No+F.Qp[F.Ka])&&(b=F,-1<b.Ka&&l(b.ne[b.Ka]),-1==b.Ka&&b.random?c=Math.round(Math.random()*(b.ne.length-1)):b.random?(c=1+Math.round(Math.random()*(b.ne.length-2)),c=(b.Ka+c)%b.ne.length):c=(b.Ka+1)%b.ne.length,e(b.ne[c]),b.Ka=c,b.No=a)}};a.play=b;a.play_def=e;a.stop=l;a.is_play=function(a){return 20==a.i.state};a.wA=g;a.yA=m;a.playrate=function(a,b){var c=a.i;c.pitch=b;!n(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.ob.playbackRate.value=b,h(c),k(c))};a.get_playrate=
function(a){return a.i.pitch};a.cyclic=function(a,b){a.i.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.i.cyclic};a.My=function(a,b,c,d){if(z&&a.i){var e=G;e[0]=0;e[1]=-1;e[2]=0;t.transformQuat(e,c,e);C[0]=0;C[1]=0;C[2]=-1;t.transformQuat(C,c,C);c=z.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],C[0],C[1],C[2]);a.i.ir.set(e);!a.i.Lg&&d&&(q[0]=(b[0]-a.i.Wf[0])/d,q[1]=(b[1]-a.i.Wf[1])/d,q[2]=(b[2]-a.i.Wf[2])/d,w.smooth_v(q,a.i.dh,d,.3,q),c.setVelocity(q[0],q[1],q[2]),a.i.dh.set(q));
a.i.Wf.set(b)}};a.listener_reset_speed=function(a,b){if(z&&N.i&&!N.i.Lg){var c=G;b?c.set(b):c.set(N.i.ir);t.scale(c,a,c);z.listener.setVelocity(c[0],c[1],c[2]);N.i.dh.set(c)}};a.zA=function(a,b){var c=a.i;if(n(a)&&"POSITIONAL"==c.behavior){var d=a.d.g,e=c.yi;e.setPosition(d[0],d[1],d[2]);var f=G;w.quat_to_dir(a.d.quat,w.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.Um;!c.Lg&&b&&(C[0]=(d[0]-f[0])/b,C[1]=(d[1]-f[1])/b,C[2]=(d[2]-f[2])/b,w.smooth_v(C,c.Ln,b,.3,C),e.setVelocity(C[0],C[1],C[2]),c.Ln.set(C));
f.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.i;if(n(a)&&"POSITIONAL"==d.behavior&&!d.Lg){var e=G;c?e.set(c):e.set(d.direction);t.scale(e,b,e);d.yi.setVelocity(e[0],e[1],e[2]);d.Ln.set(e);d.Um.set(a.d.g)}};a.ee=function(a){return a.i?!0:!1};a.ym=function(a){return a.i.behavior};a.check_active_speakers=function(){for(var a=0;a<O.length;a++)if(n(O[a]))return!0;return!1};a.cA=function(a){var b=N.i;b&&(b.volume=a,z&&(b.Sg.gain.value=r(b)))};a.Zx=function(){var a=N.i;return a?a.volume:0};a.set_volume=
function(a,b){var c=a.i;c.volume=b;n(a)&&(c.Sg.gain.value=r(c))};a.get_volume=function(a){return a.i.volume};a.mute=function(a,b){a.i.muted=Boolean(b);n(a)&&(a.i.Sg.gain.value=r(a.i))};a.is_muted=function(a){return a.i.muted};a.Zy=function(a){var b=N.i;b&&(b.muted=Boolean(a),z&&(b.Sg.gain.value=r(b)))};a.Ey=function(){var a=N.i;return a?a.muted:!1};a.get_speaker_objects=function(){return O};a.pause=function(){for(var a=0;a<O.length;a++)g(O[a])};a.resume=function(){for(var a=0;a<O.length;a++)m(O[a])};
a.set_compressor_params=function(a,b){if(a.i&&a.i.Xh){var c=a.i.Xh;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.i||!a.i.Xh)return null;a=a.i.Xh;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(n(a)){a=a.i;var d=a.If,e=z.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,
e+c);a.Hf=c}};a.unduck=function(a){if(n(a)){a=a.i;var b=a.If,c=z.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Hf);a.Hf=0}};a.Xw=function(a,b){if(z){var c=N.i,d=c.If,e=z.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Hf=b}};a.bB=function(){if(z){var a=N.i,b=a.If,c=z.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Hf);a.Hf=0}};a.apply_playlist=function(a,b,c){F={Ka:-1,No:0,random:c,
ne:[],Qp:[]};for(c=0;c<a.length;c++){var d=a[c],e=A(d);0==e?E.warn("Ignoring speaker with zero duration: "+d.name):(l(d),d.i.cyclic=!1,F.ne.push(d),F.Qp.push(e+b))}};a.get_duration=A;a.clear_playlist=function(){if(F)for(var a=F.ne,b=0;b<a.length;b++)l(a[b]);F=null};a.get_positional_params=function(a){return(a=a.i)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.i;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=
b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.yi;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.i;c&&c.kd&&(c.kd.frequency.value=b.freq,c.kd.Q.value=b.Q,c.kd.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.i)&&a.kd?{freq:a.kd.frequency.value,Q:a.kd.Q.value,gain:a.kd.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.i;if(!a||!a.kd)return null;a.kd.getFrequencyResponse(b,
c,d)}};b4w.module.vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new p(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var h=new p(3);h[0]=a;h[1]=c;h[2]=d;return h};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,h){h[0]=a;h[1]=c;h[2]=d;return h};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];return d};
a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);return d};
a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,h){h[0]=a[0]+c[0]*d;h[1]=a[1]+c[1]*d;h[2]=a[2]+c[2]*d;return h};a.distance=function(a,c){var d=c[0]-a[0],h=c[1]-a[1],k=c[2]-a[2];return Math.sqrt(d*d+h*h+k*k)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],h=c[1]-a[1],k=c[2]-a[2];return d*d+h*h+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],h=a[1],k=a[2],d=d*d+h*h+k*k;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var h=a[0],k=a[1];a=a[2];var f=c[0],l=c[1];c=c[2];d[0]=k*c-a*l;d[1]=
a*f-h*c;d[2]=h*l-k*f;return d};a.lerp=function(a,c,d,h){var k=a[0],f=a[1];a=a[2];h[0]=k+d*(c[0]-k);h[1]=f+d*(c[1]-f);h[2]=a+d*(c[2]-a);return h};a.random=function(a,c){a=a||1;var e=2*d()*Math.PI,h=2*d()-1,k=Math.sqrt(1-h*h)*a;c[0]=Math.cos(e)*k;c[1]=Math.sin(e)*k;c[2]=h*a;return c};a.transformMat4=function(a,c,d){var h=a[0],k=a[1];a=a[2];var f=c[3]*h+c[7]*k+c[11]*a+c[15],f=f||1;d[0]=(c[0]*h+c[4]*k+c[8]*a+c[12])/f;d[1]=(c[1]*h+c[5]*k+c[9]*a+c[13])/f;d[2]=(c[2]*h+c[6]*k+c[10]*a+c[14])/f;return d};a.transformMat3=
function(a,c,d){var h=a[0],k=a[1];a=a[2];d[0]=h*c[0]+k*c[3]+a*c[6];d[1]=h*c[1]+k*c[4]+a*c[7];d[2]=h*c[2]+k*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var h=a[0],k=a[1],f=a[2];a=c[0];var l=c[1],g=c[2];c=c[3];var m=c*h+l*f-g*k,n=c*k+g*h-a*f,r=c*f+a*k-l*h,h=-a*h-l*k-g*f;d[0]=m*c+h*-a+n*-g-r*-l;d[1]=n*c+h*-l+r*-a-m*-g;d[2]=r*c+h*-g+m*-l-n*-a;return d};a.rotateX=function(a,c,d,h){var k=[],f=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];f[0]=k[0];f[1]=k[1]*Math.cos(d)-k[2]*Math.sin(d);f[2]=
k[1]*Math.sin(d)+k[2]*Math.cos(d);h[0]=f[0]+c[0];h[1]=f[1]+c[1];h[2]=f[2]+c[2];return h};a.rotateY=function(a,c,d,h){var k=[],f=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];f[0]=k[2]*Math.sin(d)+k[0]*Math.cos(d);f[1]=k[1];f[2]=k[2]*Math.cos(d)-k[0]*Math.sin(d);h[0]=f[0]+c[0];h[1]=f[1]+c[1];h[2]=f[2]+c[2];return h};a.rotateZ=function(a,c,d,h){var k=[],f=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];f[0]=k[0]*Math.cos(d)-k[1]*Math.sin(d);f[1]=k[0]*Math.sin(d)+k[1]*Math.cos(d);f[2]=k[2];h[0]=f[0]+
c[0];h[1]=f[1]+c[1];h[2]=f[2]+c[2];return h};a.forEach=function(){var b=a.create();return function(a,d,h,k,f,l){d||(d=3);h||(h=0);for(k=k?Math.min(k*d+h,a.length):a.length;h<k;h+=d)b[0]=a[h],b[1]=a[h+1],b[2]=a[h+2],f(b,l,b),a[h]=b[0],a[h+1]=b[1],a[h+2]=b[2];return a}}();a.sC=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),h=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(h,h);d=a.dot(d,h);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new p(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,h){var k=new p(4);k[0]=a;k[1]=c;k[2]=d;k[3]=h;return k};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,h,k){k[0]=a;k[1]=c;k[2]=d;k[3]=h;return k};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,h){h[0]=a[0]+c[0]*d;h[1]=a[1]+c[1]*d;h[2]=a[2]+c[2]*d;h[3]=a[3]+c[3]*d;return h};a.distance=function(a,c){var d=c[0]-a[0],h=c[1]-a[1],k=c[2]-a[2],f=c[3]-a[3];return Math.sqrt(d*d+h*h+k*k+f*f)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],h=c[1]-a[1],k=c[2]-a[2],f=c[3]-a[3];return d*d+h*h+k*k+f*f};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],h=a[2];a=a[3];return Math.sqrt(c*c+d*d+h*h+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],h=a[2];a=a[3];return c*c+d*d+h*h+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],h=a[1],k=a[2],f=a[3],d=d*d+h*h+k*k+f*f;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,h){var k=a[0],f=a[1],l=a[2];a=a[3];h[0]=k+d*(c[0]-k);h[1]=f+d*(c[1]-f);h[2]=l+d*(c[2]-l);h[3]=a+d*(c[3]-a);return h};a.random=function(b,c){b=b||1;c[0]=d();c[1]=d();c[2]=d();c[3]=d();a.normalize(c,c);a.scale(c,b,c);return c};a.transformMat4=function(a,c,d){var h=a[0],
k=a[1],f=a[2];a=a[3];d[0]=c[0]*h+c[4]*k+c[8]*f+c[12]*a;d[1]=c[1]*h+c[5]*k+c[9]*f+c[13]*a;d[2]=c[2]*h+c[6]*k+c[10]*f+c[14]*a;d[3]=c[3]*h+c[7]*k+c[11]*f+c[15]*a;return d};a.transformQuat=function(a,c,d){var h=a[0],k=a[1],f=a[2],l=c[0],g=c[1],m=c[2];c=c[3];var n=c*h+g*f-m*k,r=c*k+m*h-l*f,p=c*f+l*k-g*h,h=-l*h-g*k-m*f;d[0]=n*c+h*-l+r*-m-p*-g;d[1]=r*c+h*-g+p*-l-n*-m;d[2]=p*c+h*-m+n*-g-r*-l;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,d,h,k,f,l){d||(d=4);h||(h=0);for(k=k?Math.min(k*
d+h,a.length):a.length;h<k;h+=d)b[0]=a[h],b[1]=a[h+1],b[2]=a[h+2],b[3]=a[h+3],f(b,l,b),a[h]=b[0],a[h+1]=b[1],a[h+2]=b[2],a[h+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,p){var d=p("vec3"),b=p("vec4"),c=p("mat3"),e="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new e(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=d.create(),c=d.fromValues(1,0,0),e=d.fromValues(0,1,0);return function(l,g,m){var n=d.dot(l,g);if(-.9999999>n)return d.cross(c,l,b),1E-6>d.length(b)&&d.cross(e,l,b),d.normalize(b,b),a.setAxisAngle(b,Math.PI,m),m;if(.9999999<n)return m[0]=0,m[1]=0,m[2]=0,m[3]=1,m;d.cross(l,
g,b);m[0]=b[0];m[1]=b[1];m[2]=b[2];m[3]=1+n;return a.normalize(m,m)}}();a.setAxes=function(){var b=c.create();return function(c,d,e,g){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=e[0];b[4]=e[1];b[7]=e[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,g),g)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],m=a[2];a=a[3];var n=b[0],r=b[1],p=b[2];b=b[3];c[0]=d*b+a*n+e*p-m*r;c[1]=e*b+a*r+m*n-d*p;c[2]=m*b+a*p+d*r-e*n;c[3]=a*b-d*n-e*r-m*p;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],e=a[1],m=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*n;c[1]=e*b+m*n;c[2]=m*b-e*n;c[3]=a*b-d*n;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],e=a[1],m=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*
b-m*n;c[1]=e*b+a*n;c[2]=m*b+d*n;c[3]=a*b-e*n;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],e=a[1],m=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*n;c[1]=e*b-d*n;c[2]=m*b+a*n;c[3]=a*b-m*n;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var e=a[0],m=a[1],n=a[2];a=a[3];var r=b[0],p=b[1],v=b[2];b=b[3];var E,B,w;B=e*r+m*p+n*v+a*b;0>B&&(B=-B,r=-r,p=-p,
v=-v,b=-b);1E-6<1-B?(E=Math.acos(B),w=Math.sin(E),B=Math.sin((1-c)*E)/w,c=Math.sin(c*E)/w):B=1-c;d[0]=B*e+c*r;d[1]=B*m+c*p;d[2]=B*n+c*v;d[3]=B*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],m=a[3],n=c*c+d*d+e*e+m*m,n=n?1/n:0;b[0]=-c*n;b[1]=-d*n;b[2]=-e*n;b[3]=m*n;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,m=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*m+m]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+m]-a[3*m+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[m]=(a[3*m+d]+a[3*d+m])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new p(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var c=a[1],e=a[2],h=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=e;b[7]=h}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var c=a[0],e=a[1],h=a[2],k=a[3],f=a[4],l=a[5],g=a[6],m=a[7],n=a[8],r=n*f-l*m,p=-n*k+l*g,v=
m*k-f*g,E=c*r+e*p+h*v;if(!E)return null;E=1/E;b[0]=r*E;b[1]=(-n*e+h*m)*E;b[2]=(l*e-h*f)*E;b[3]=p*E;b[4]=(n*c-h*g)*E;b[5]=(-l*c+h*k)*E;b[6]=v*E;b[7]=(-m*c+e*g)*E;b[8]=(f*c-e*k)*E;return b};a.adjoint=function(a,b){var c=a[0],e=a[1],h=a[2],k=a[3],f=a[4],l=a[5],g=a[6],m=a[7],n=a[8];b[0]=f*n-l*m;b[1]=h*m-e*n;b[2]=e*l-h*f;b[3]=l*g-k*n;b[4]=c*n-h*g;b[5]=h*k-c*l;b[6]=k*m-f*g;b[7]=e*g-c*m;b[8]=c*f-e*k;return b};a.determinant=function(a){var b=a[3],c=a[4],e=a[5],h=a[6],k=a[7],f=a[8];return a[0]*(f*c-e*k)+a[1]*
(-f*b+e*h)+a[2]*(k*b-c*h)};a.multiply=function(a,b,c){var e=a[0],h=a[1],k=a[2],f=a[3],l=a[4],g=a[5],m=a[6],n=a[7];a=a[8];var r=b[0],p=b[1],v=b[2],E=b[3],B=b[4],w=b[5],t=b[6],x=b[7];b=b[8];c[0]=r*e+p*f+v*m;c[1]=r*h+p*l+v*n;c[2]=r*k+p*g+v*a;c[3]=E*e+B*f+w*m;c[4]=E*h+B*l+w*n;c[5]=E*k+B*g+w*a;c[6]=t*e+x*f+b*m;c[7]=t*h+x*l+b*n;c[8]=t*k+x*g+b*a;return c};a.mul=a.multiply;a.translate=function(a,b,c){var e=a[0],h=a[1],k=a[2],f=a[3],l=a[4],g=a[5],m=a[6],n=a[7];a=a[8];var r=b[0];b=b[1];c[0]=e;c[1]=h;c[2]=k;
c[3]=f;c[4]=l;c[5]=g;c[6]=r*e+b*f+m;c[7]=r*h+b*l+n;c[8]=r*k+b*g+a;return c};a.rotate=function(a,b,c){var e=a[0],h=a[1],k=a[2],f=a[3],l=a[4],g=a[5],m=a[6],n=a[7];a=a[8];var r=Math.sin(b);b=Math.cos(b);c[0]=b*e+r*f;c[1]=b*h+r*l;c[2]=b*k+r*g;c[3]=b*f-r*e;c[4]=b*l-r*h;c[5]=b*g-r*k;c[6]=m;c[7]=n;c[8]=a;return c};a.scale=function(a,b,c){var e=b[0];b=b[1];c[0]=e*a[0];c[1]=e*a[1];c[2]=e*a[2];c[3]=b*a[3];c[4]=b*a[4];c[5]=b*a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.tx=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.rx=function(a,b){var c=Math.sin(a),e=Math.cos(a);b[0]=e;b[1]=c;b[2]=0;b[3]=-c;b[4]=e;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.sx=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var c=a[0],e=a[1],h=a[2],k=a[3],f=c+c,l=e+e,g=h+h,c=c*f,m=e*f,e=e*l,n=h*f,r=
h*l,h=h*g,f=k*f,l=k*l,k=k*g;b[0]=1-e-h;b[3]=m-k;b[6]=n+l;b[1]=m+k;b[4]=1-c-h;b[7]=r-f;b[2]=n-l;b[5]=r+f;b[8]=1-c-e;return b};a.normalFromMat4=function(a,b){var c=a[0],e=a[1],h=a[2],k=a[3],f=a[4],l=a[5],g=a[6],m=a[7],n=a[8],r=a[9],p=a[10],v=a[11],E=a[12],B=a[13],w=a[14],t=a[15],x=c*l-e*f,G=c*g-h*f,C=c*m-k*f,q=e*g-h*l,y=e*m-k*l,H=h*m-k*g,z=n*B-r*E,N=n*w-p*E,n=n*t-v*E,O=r*w-p*B,r=r*t-v*B,p=p*t-v*w,v=x*p-G*r+C*O+q*n-y*N+H*z;if(!v)return null;v=1/v;b[0]=(l*p-g*r+m*O)*v;b[1]=(g*n-f*p-m*N)*v;b[2]=(f*r-l*
n+m*z)*v;b[3]=(h*r-e*p-k*O)*v;b[4]=(c*p-h*n+k*N)*v;b[5]=(e*n-c*r-k*z)*v;b[6]=(B*H-w*y+t*q)*v;b[7]=(w*C-E*H-t*G)*v;b[8]=(E*y-B*C+t*x)*v;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.qx=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new p(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var c=a[1],e=a[2],h=a[3],k=a[6],f=a[7],l=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=c;b[6]=a[9];b[7]=a[13];b[8]=e;b[9]=k;b[11]=a[14];b[12]=h;b[13]=f;
b[14]=l}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var c=a[0],e=a[1],h=a[2],k=a[3],f=a[4],l=a[5],g=a[6],m=a[7],n=a[8],r=a[9],p=a[10],v=a[11],E=a[12],B=a[13],w=a[14],t=a[15],x=c*l-e*f,G=c*g-h*f,C=c*m-k*f,q=e*g-h*l,y=e*m-k*l,H=h*m-k*g,z=n*B-r*E,N=n*w-p*E,O=n*t-v*E,L=r*w-p*B,F=r*t-v*B,I=p*t-v*w,M=x*I-G*F+C*L+q*O-y*N+H*z;if(!M)return null;
M=1/M;b[0]=(l*I-g*F+m*L)*M;b[1]=(h*F-e*I-k*L)*M;b[2]=(B*H-w*y+t*q)*M;b[3]=(p*y-r*H-v*q)*M;b[4]=(g*O-f*I-m*N)*M;b[5]=(c*I-h*O+k*N)*M;b[6]=(w*C-E*H-t*G)*M;b[7]=(n*H-p*C+v*G)*M;b[8]=(f*F-l*O+m*z)*M;b[9]=(e*O-c*F-k*z)*M;b[10]=(E*y-B*C+t*x)*M;b[11]=(r*C-n*y-v*x)*M;b[12]=(l*N-f*L-g*z)*M;b[13]=(c*L-e*N+h*z)*M;b[14]=(B*G-E*q-w*x)*M;b[15]=(n*q-r*G+p*x)*M;return b};a.adjoint=function(a,b){var c=a[0],e=a[1],h=a[2],k=a[3],f=a[4],l=a[5],g=a[6],m=a[7],n=a[8],r=a[9],p=a[10],v=a[11],E=a[12],B=a[13],w=a[14],t=a[15];
b[0]=l*(p*t-v*w)-r*(g*t-m*w)+B*(g*v-m*p);b[1]=-(e*(p*t-v*w)-r*(h*t-k*w)+B*(h*v-k*p));b[2]=e*(g*t-m*w)-l*(h*t-k*w)+B*(h*m-k*g);b[3]=-(e*(g*v-m*p)-l*(h*v-k*p)+r*(h*m-k*g));b[4]=-(f*(p*t-v*w)-n*(g*t-m*w)+E*(g*v-m*p));b[5]=c*(p*t-v*w)-n*(h*t-k*w)+E*(h*v-k*p);b[6]=-(c*(g*t-m*w)-f*(h*t-k*w)+E*(h*m-k*g));b[7]=c*(g*v-m*p)-f*(h*v-k*p)+n*(h*m-k*g);b[8]=f*(r*t-v*B)-n*(l*t-m*B)+E*(l*v-m*r);b[9]=-(c*(r*t-v*B)-n*(e*t-k*B)+E*(e*v-k*r));b[10]=c*(l*t-m*B)-f*(e*t-k*B)+E*(e*m-k*l);b[11]=-(c*(l*v-m*r)-f*(e*v-k*r)+n*
(e*m-k*l));b[12]=-(f*(r*w-p*B)-n*(l*w-g*B)+E*(l*p-g*r));b[13]=c*(r*w-p*B)-n*(e*w-h*B)+E*(e*p-h*r);b[14]=-(c*(l*w-g*B)-f*(e*w-h*B)+E*(e*g-h*l));b[15]=c*(l*p-g*r)-f*(e*p-h*r)+n*(e*g-h*l);return b};a.determinant=function(a){var b=a[0],c=a[1],e=a[2],h=a[3],k=a[4],f=a[5],l=a[6],g=a[7],m=a[8],n=a[9],r=a[10],p=a[11],v=a[12],E=a[13],B=a[14];a=a[15];return(b*f-c*k)*(r*a-p*B)-(b*l-e*k)*(n*a-p*E)+(b*g-h*k)*(n*B-r*E)+(c*l-e*f)*(m*a-p*v)-(c*g-h*f)*(m*B-r*v)+(e*g-h*l)*(m*E-n*v)};a.multiply=function(a,b,c){var e=
a[0],h=a[1],k=a[2],f=a[3],l=a[4],g=a[5],m=a[6],n=a[7],r=a[8],p=a[9],v=a[10],E=a[11],B=a[12],w=a[13],t=a[14];a=a[15];var x=b[0],G=b[1],C=b[2],q=b[3];c[0]=x*e+G*l+C*r+q*B;c[1]=x*h+G*g+C*p+q*w;c[2]=x*k+G*m+C*v+q*t;c[3]=x*f+G*n+C*E+q*a;x=b[4];G=b[5];C=b[6];q=b[7];c[4]=x*e+G*l+C*r+q*B;c[5]=x*h+G*g+C*p+q*w;c[6]=x*k+G*m+C*v+q*t;c[7]=x*f+G*n+C*E+q*a;x=b[8];G=b[9];C=b[10];q=b[11];c[8]=x*e+G*l+C*r+q*B;c[9]=x*h+G*g+C*p+q*w;c[10]=x*k+G*m+C*v+q*t;c[11]=x*f+G*n+C*E+q*a;x=b[12];G=b[13];C=b[14];q=b[15];c[12]=x*e+
G*l+C*r+q*B;c[13]=x*h+G*g+C*p+q*w;c[14]=x*k+G*m+C*v+q*t;c[15]=x*f+G*n+C*E+q*a;return c};a.mul=a.multiply;a.translate=function(a,b,c){var e=b[0],h=b[1];b=b[2];var k,f,l,g,m,n,r,p,v,E,B,w;a===c?(c[12]=a[0]*e+a[4]*h+a[8]*b+a[12],c[13]=a[1]*e+a[5]*h+a[9]*b+a[13],c[14]=a[2]*e+a[6]*h+a[10]*b+a[14],c[15]=a[3]*e+a[7]*h+a[11]*b+a[15]):(k=a[0],f=a[1],l=a[2],g=a[3],m=a[4],n=a[5],r=a[6],p=a[7],v=a[8],E=a[9],B=a[10],w=a[11],c[0]=k,c[1]=f,c[2]=l,c[3]=g,c[4]=m,c[5]=n,c[6]=r,c[7]=p,c[8]=v,c[9]=E,c[10]=B,c[11]=w,
c[12]=k*e+m*h+v*b+a[12],c[13]=f*e+n*h+E*b+a[13],c[14]=l*e+r*h+B*b+a[14],c[15]=g*e+p*h+w*b+a[15]);return c};a.scale=function(a,b,c){var e=b[0],h=b[1];b=b[2];c[0]=a[0]*e;c[1]=a[1]*e;c[2]=a[2]*e;c[3]=a[3]*e;c[4]=a[4]*h;c[5]=a[5]*h;c[6]=a[6]*h;c[7]=a[7]*h;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.rotate=function(a,b,c,e){var h=c[0],k=c[1];c=c[2];var f=Math.sqrt(h*h+k*k+c*c),l,g,m,n,r,p,v,E,B,w,t,x,G,C,q,y,H,z,N,O;if(1E-7>Math.abs(f))return null;
f=1/f;h*=f;k*=f;c*=f;l=Math.sin(b);g=Math.cos(b);m=1-g;b=a[0];f=a[1];n=a[2];r=a[3];p=a[4];v=a[5];E=a[6];B=a[7];w=a[8];t=a[9];x=a[10];G=a[11];C=h*h*m+g;q=k*h*m+c*l;y=c*h*m-k*l;H=h*k*m-c*l;z=k*k*m+g;N=c*k*m+h*l;O=h*c*m+k*l;h=k*c*m-h*l;k=c*c*m+g;e[0]=b*C+p*q+w*y;e[1]=f*C+v*q+t*y;e[2]=n*C+E*q+x*y;e[3]=r*C+B*q+G*y;e[4]=b*H+p*z+w*N;e[5]=f*H+v*z+t*N;e[6]=n*H+E*z+x*N;e[7]=r*H+B*z+G*N;e[8]=b*O+p*h+w*k;e[9]=f*O+v*h+t*k;e[10]=n*O+E*h+x*k;e[11]=r*O+B*h+G*k;a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);
return e};a.rotateX=function(a,b,c){var e=Math.sin(b);b=Math.cos(b);var h=a[4],k=a[5],f=a[6],l=a[7],g=a[8],m=a[9],n=a[10],r=a[11];a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[4]=h*b+g*e;c[5]=k*b+m*e;c[6]=f*b+n*e;c[7]=l*b+r*e;c[8]=g*b-h*e;c[9]=m*b-k*e;c[10]=n*b-f*e;c[11]=r*b-l*e;return c};a.rotateY=function(a,b,c){var e=Math.sin(b);b=Math.cos(b);var h=a[0],k=a[1],f=a[2],l=a[3],g=a[8],m=a[9],n=a[10],r=a[11];a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],
c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=h*b-g*e;c[1]=k*b-m*e;c[2]=f*b-n*e;c[3]=l*b-r*e;c[8]=h*e+g*b;c[9]=k*e+m*b;c[10]=f*e+n*b;c[11]=l*e+r*b;return c};a.rotateZ=function(a,b,c){var e=Math.sin(b);b=Math.cos(b);var h=a[0],k=a[1],f=a[2],l=a[3],g=a[4],m=a[5],n=a[6],r=a[7];a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=h*b+g*e;c[1]=k*b+m*e;c[2]=f*b+n*e;c[3]=l*b+r*e;c[4]=g*b-h*e;c[5]=m*b-k*e;c[6]=n*b-f*e;c[7]=r*b-l*e;return c};
a.tx=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.sx=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.rx=function(a,b,c){var e=b[0],h=b[1];b=b[2];var k=Math.sqrt(e*e+h*h+b*b),f;if(1E-7>Math.abs(k))return null;k=1/k;e*=k;h*=k;b*=k;k=Math.sin(a);a=Math.cos(a);f=1-a;c[0]=e*e*f+a;c[1]=h*e*f+b*
k;c[2]=b*e*f-h*k;c[3]=0;c[4]=e*h*f-b*k;c[5]=h*h*f+a;c[6]=b*h*f+e*k;c[7]=0;c[8]=e*b*f+h*k;c[9]=h*b*f-e*k;c[10]=b*b*f+a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.lD=function(a,b){var c=Math.sin(a),e=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=e;b[6]=c;b[7]=0;b[8]=0;b[9]=-c;b[10]=e;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.mD=function(a,b){var c=Math.sin(a),e=Math.cos(a);b[0]=e;b[1]=0;b[2]=-c;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=c;b[9]=0;b[10]=e;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.nD=function(a,b){var c=Math.sin(a),e=Math.cos(a);b[0]=e;b[1]=c;b[2]=0;b[3]=0;b[4]=-c;b[5]=e;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,c){var e=a[0],h=a[1],k=a[2],f=a[3],l=e+e,g=h+h,m=k+k;a=e*l;var n=e*g,e=e*m,r=h*g,h=h*m,k=k*m,l=f*l,g=f*g,f=f*m;c[0]=1-(r+k);c[1]=n+f;c[2]=e-g;c[3]=0;c[4]=n-f;c[5]=1-(a+k);c[6]=h+l;c[7]=0;c[8]=e+g;c[9]=h-l;c[10]=1-(a+r);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];
c[15]=1;return c};a.fromQuat=function(a,b){var c=a[0],e=a[1],h=a[2],k=a[3],f=c+c,l=e+e,g=h+h,c=c*f,m=e*f,e=e*l,n=h*f,r=h*l,h=h*g,f=k*f,l=k*l,k=k*g;b[0]=1-e-h;b[1]=m+k;b[2]=n-l;b[3]=0;b[4]=m-k;b[5]=1-c-h;b[6]=r+f;b[7]=0;b[8]=n+l;b[9]=r-f;b[10]=1-c-e;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,c,e,h,k,f){var l=1/(b-a),g=1/(e-c),m=1/(h-k);f[0]=2*h*l;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*h*g;f[6]=0;f[7]=0;f[8]=(b+a)*l;f[9]=(e+c)*g;f[10]=(k+h)*m;f[11]=-1;f[12]=0;f[13]=0;f[14]=
k*h*2*m;f[15]=0;return f};a.perspective=function(a,b,c,e,h){a=1/Math.tan(a/2);var k=1/(c-e);h[0]=a/b;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=(e+c)*k;h[11]=-1;h[12]=0;h[13]=0;h[14]=2*e*c*k;h[15]=0;return h};a.gE=function(a,b,c,e){var h=Math.tan(a.xE*Math.PI/180),k=Math.tan(a.ZC*Math.PI/180),f=Math.tan(a.TD*Math.PI/180);a=Math.tan(a.iE*Math.PI/180);var l=2/(f+a),g=2/(h+k);e[0]=l;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=g;e[6]=0;e[7]=0;e[8]=-((f-a)*l*.5);e[9]=(h-k)*g*.5;e[10]=c/
(b-c);e[11]=-1;e[12]=0;e[13]=0;e[14]=c*b/(b-c);e[15]=0;return e};a.ortho=function(a,b,c,e,h,k,f){var l=1/(a-b),g=1/(c-e),m=1/(h-k);f[0]=-2*l;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*g;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*m;f[11]=0;f[12]=(a+b)*l;f[13]=(e+c)*g;f[14]=(k+h)*m;f[15]=1;return f};a.lookAt=function(d,b,c,e){var h,k,f,l,g,m,n,r,p=d[0],v=d[1];d=d[2];f=c[0];l=c[1];k=c[2];n=b[0];c=b[1];h=b[2];if(1E-7>Math.abs(p-n)&&1E-7>Math.abs(v-c)&&1E-7>Math.abs(d-h))return a.identity(e);b=p-n;c=v-c;n=d-h;r=1/Math.sqrt(b*
b+c*c+n*n);b*=r;c*=r;n*=r;h=l*n-k*c;k=k*b-f*n;f=f*c-l*b;(r=Math.sqrt(h*h+k*k+f*f))?(r=1/r,h*=r,k*=r,f*=r):f=k=h=0;l=c*f-n*k;g=n*h-b*f;m=b*k-c*h;(r=Math.sqrt(l*l+g*g+m*m))?(r=1/r,l*=r,g*=r,m*=r):m=g=l=0;e[0]=h;e[1]=l;e[2]=b;e[3]=0;e[4]=k;e[5]=g;e[6]=c;e[7]=0;e[8]=f;e[9]=m;e[10]=n;e[11]=0;e[12]=-(h*p+k*v+f*d);e[13]=-(l*p+g*v+m*d);e[14]=-(b*p+c*v+n*d);e[15]=1;return e};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.qx=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.Sr=function(){function a(d,b,c,e,h,k){this.message=d;this.offset=e;this.ti=h;this.Ig=k;this.name="SyntaxError"}(function(a,b){function c(){this.constructor=a}c.prototype=b.prototype;a.prototype=new c})(a,Error);return{SyntaxError:a,parse:function(d){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function c(a){if(bc!==a){bc>a&&(bc=0,nb={ti:1,Ig:1,Ni:!1});var b=nb,c,e;for(c=
bc;c<a;c++)e=d.charAt(c),"\n"===e?(b.Ni||b.ti++,b.Ig=1,b.Ni=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(b.ti++,b.Ig=1,b.Ni=!0):(b.Ig++,b.Ni=!1);bc=a}return nb}function e(a){D<Db||(D>Db&&(Db=D,Gb=[]),Gb.push(a))}function h(){var a,b,c;a=D;b=W();b!==u?(b=k(),b!==u?(c=W(),c!==u?(da++,10===d.charCodeAt(D)?(c=Pb,D++):(c=u,0===da&&e(xc)),c===u&&(d.substr(D,2)===Qb?(c=Qb,D+=2):(c=u,0===da&&e(kb)),c===u&&(13===d.charCodeAt(D)?(c=ab,D++):(c=u,0===da&&e(hc)))),da--,c===u&&0===da&&e(Lb),c===u&&(c=null),c!==u?
a=b:(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u);return a}function k(){var a,b,c,g,h,k,l,m;a=D;b=f();if(b!==u){c=[];g=D;h=W();h!==u?(44===d.charCodeAt(D)?(k=ja,D++):(k=u,0===da&&e(Z)),k!==u?(l=W(),l!==u?(m=f(),m!==u?g=h=[h,k,l,m]:(D=g,g=u)):(D=g,g=u)):(D=g,g=u)):(D=g,g=u);for(;g!==u;)c.push(g),g=D,h=W(),h!==u?(44===d.charCodeAt(D)?(k=ja,D++):(k=u,0===da&&e(Z)),k!==u?(l=W(),l!==u?(m=f(),m!==u?g=h=[h,k,l,m]:(D=g,g=u)):(D=g,g=u)):(D=g,g=u)):(D=g,g=u);c!==u?a=b=0==c.length?b:c[c.length-1]:(D=a,a=u)}else D=
a,a=u;return a}function f(){var a,b,c,f;a=D;b=l();b!==u?(c=W(),c!==u?(63===d.charCodeAt(D)?(c=oa,D++):(c=u,0===da&&e(K)),c!==u?(c=W(),c!==u?(c=k(),c!==u?(f=W(),f!==u?(58===d.charCodeAt(D)?(f=U,D++):(f=u,0===da&&e(X)),f!==u?(f=W(),f!==u?(f=k(),f!==u?a=b?c:f:(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u);a===u&&(a=l());return a}function l(){var a,b,c,d,e,f,h,k;a=D;b=g();if(b!==u){c=[];d=D;e=W();e!==u?(f=Y(),f!==u?(h=W(),h!==u?(k=g(),k!==u?d=e=[e,f,
h,k]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=Y(),f!==u?(h=W(),h!==u?(k=g(),k!==u?d=e=[e,f,h,k]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else D=a,a=u}else D=a,a=u;return a}function g(){var a,b,c,d,e,f,g,h;a=D;b=m();if(b!==u){c=[];d=D;e=W();e!==u?(f=S(),f!==u?(g=W(),g!==u?(h=m(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=S(),f!==u?(g=W(),g!==u?(h=
m(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else D=a,a=u}else D=a,a=u;return a}function m(){var a,b,c,d,e,f,g,h;a=D;b=n();if(b!==u){c=[];d=D;e=W();e!==u?(f=ca(),f!==u?(g=W(),g!==u?(h=n(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=ca(),f!==u?(g=W(),g!==u?(h=n(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a|=c[b][3];
else D=a,a=u}else D=a,a=u;return a}function n(){var a,b,c,d,e,f,g,h;a=D;b=r();if(b!==u){c=[];d=D;e=W();e!==u?(f=R(),f!==u?(g=W(),g!==u?(h=r(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=R(),f!==u?(g=W(),g!==u?(h=r(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else D=a,a=u}else D=a,a=u;return a}function r(){var a,b,c,d,e,f,g,h;a=D;b=A();if(b!==u){c=[];d=D;e=W();e!==u?(f=M(),
f!==u?(g=W(),g!==u?(h=A(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=M(),f!==u?(g=W(),g!==u?(h=A(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else D=a,a=u}else D=a,a=u;return a}function A(){var a,b,c,d,e,f,g,h;a=D;b=v();if(b!==u){c=[];d=D;e=W();e!==u?(f=I(),f!==u?(g=W(),g!==u?(h=v(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,
e=W(),e!==u?(f=I(),f!==u?(g=W(),g!==u?(h=v(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else D=a,a=u}else D=a,a=u;return a}function v(){var a,b,c,d,e,f,g,h;a=D;b=E();if(b!==u){c=[];d=D;e=W();e!==u?(f=F(),f!==u?(g=W(),g!==u?(h=E(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=F(),f!==u?(g=W(),g!==u?(h=E(),h!==u?d=e=[e,
f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else D=a,a=u}else D=a,a=u;return a}function E(){var a,b,c,d,e,f,g,h;a=D;b=B();if(b!==u){c=[];d=D;e=W();e!==u?(f=L(),f!==u?(g=W(),g!==u?(h=B(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=L(),f!==u?(g=W(),g!==u?(h=B(),h!==u?d=e=[e,f,g,
h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else D=a,a=u}else D=a,a=u;return a}function B(){var a,b,c,d,e,f,g,h;a=D;b=w();if(b!==u){c=[];d=D;e=W();e!==u?(f=O(),f!==u?(g=W(),g!==u?(h=w(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=O(),f!==u?(g=W(),g!==u?(h=w(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=
b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else D=a,a=u}else D=a,a=u;return a}function w(){var a,b,c,d,e,f,g,h;a=D;b=t();if(b!==u){c=[];d=D;e=W();e!==u?(f=N(),f!==u?(g=W(),g!==u?(h=t(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);for(;d!==u;)c.push(d),d=D,e=W(),e!==u?(f=N(),f!==u?(g=W(),g!==u?(h=t(),h!==u?d=e=[e,f,g,h]:(D=d,d=u)):(D=d,d=u)):(D=d,d=u)):(D=d,d=u);if(c!==u)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=
Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else D=a,a=u}else D=a,a=u;return a}function t(){var a,c,f;a=D;d.substr(D,7)===sa?(c=sa,D+=7):(c=u,0===da&&e(ra));c!==u?(f=W(),f!==u?(f=G(),f!==u?a=f:(D=a,a=u)):(D=a,a=u)):(D=a,a=u);if(a===u){a=D;c=x();if(c!==u)if(f=W(),f!==u)if(d.substr(D,2)===kc?(f=kc,D+=2):(f=u,0===da&&e(lc)),f===u&&(d.substr(D,2)===xb?(f=xb,D+=2):(f=u,0===da&&e(Jb))),f!==u){a:{a=c;switch(f){case "++":c=++a;break a;case "--":c=--a;break a}c=void 0}a=c}else D=a,a=u;else D=a,a=u;else D=
a,a=u;a===u&&(a=x());a===u&&(a=D,d.substr(D,2)===kc?(c=kc,D+=2):(c=u,0===da&&e(lc)),c===u&&(d.substr(D,2)===xb?(c=xb,D+=2):(c=u,0===da&&e(Jb)),c===u&&(43===d.charCodeAt(D)?(c=Da,D++):(c=u,0===da&&e(Va)),c===u&&(45===d.charCodeAt(D)?(c=ka,D++):(c=u,0===da&&e(ob)),c===u&&(126===d.charCodeAt(D)?(c=ga,D++):(c=u,0===da&&e(Ra)),c===u&&(33===d.charCodeAt(D)?(c=Ea,D++):(c=u,0===da&&e(hb))))))),c!==u?(f=W(),f!==u?(f=t(),f!==u?a=c=b(c,f):(D=a,a=u)):(D=a,a=u)):(D=a,a=u))}return a}function x(){var a,b,c;da++;
var f;a=D;48===d.charCodeAt(D)?(b=wa,D++):(b=u,0===da&&e(na));if(b!==u)if(T.test(d.charAt(D))?(b=d.charAt(D),D++):(b=u,0===da&&e(Na)),b!==u){b=D;c=[];f=q();if(f!==u)for(;f!==u;)c.push(f),f=q();else c=u;b=c!==u?d.substring(b,D):c;b!==u?a=b=parseInt("0x"+b):(D=a,a=u)}else D=a,a=u;else D=a,a=u;if(a===u){a=D;48===d.charCodeAt(D)?(b=wa,D++):(b=u,0===da&&e(na));if(b===u)if(b=D,Q.test(d.charAt(D))?(c=d.charAt(D),D++):(c=u,0===da&&e(Xa)),c!==u){var g;f=[];g=C();if(g!==u)for(;g!==u;)f.push(g),g=C();else f=
u;f===u&&(f=null);f!==u?b=c=[c,f]:(D=b,b=u)}else D=b,b=u;a=b!==u?d.substring(a,D):b;a!==u&&(a=parseInt(a))}da--;a===u&&0===da&&e(aa);a===u&&(b=y(),b!==u&&(b=0),a=b,a===u&&(a=D,40===d.charCodeAt(D)?(b=fa,D++):(b=u,0===da&&e(ha)),b!==u?(b=W(),b!==u?(b=k(),b!==u?(c=W(),c!==u?(41===d.charCodeAt(D)?(c=V,D++):(c=u,0===da&&e(J)),c!==u?a=b:(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u)));return a}function G(){var a,b,c,f,g;b=y();b!==u&&(b=0);a=b;if(a===u){b=[];f=c=D;da++;40===d.charCodeAt(D)?(g=fa,
D++):(g=u,0===da&&e(ha));g===u&&(41===d.charCodeAt(D)?(g=V,D++):(g=u,0===da&&e(J)));da--;g===u?f=void 0:(D=f,f=u);f!==u?(g=ma(),g!==u?c=f=[f,g]:(D=c,c=u)):(D=c,c=u);if(c!==u)for(;c!==u;)b.push(c),f=c=D,da++,40===d.charCodeAt(D)?(g=fa,D++):(g=u,0===da&&e(ha)),g===u&&(41===d.charCodeAt(D)?(g=V,D++):(g=u,0===da&&e(J))),da--,g===u?f=void 0:(D=f,f=u),f!==u?(g=ma(),g!==u?c=f=[f,g]:(D=c,c=u)):(D=c,c=u);else b=u;b!==u&&(b=1);a=b;a===u&&(a=D,40===d.charCodeAt(D)?(b=fa,D++):(b=u,0===da&&e(ha)),b!==u?(c=W(),
c!==u?(f=G(),f!==u?(g=W(),g!==u?(41===d.charCodeAt(D)?(b=V,D++):(b=u,0===da&&e(J)),b!==u?a=f:(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u)):(D=a,a=u))}return a}function C(){var a;Ba.test(d.charAt(D))?(a=d.charAt(D),D++):(a=u,0===da&&e(Ga));return a}function q(){var a;ta.test(d.charAt(D))?(a=d.charAt(D),D++):(a=u,0===da&&e(gb));return a}function y(){var a,b;da++;b=a=D;da++;var c,f,g,h;c=D;d.substr(D,7)===sa?(f=sa,D+=7):(f=u,0===da&&e(ra));f!==u?(g=D,da++,h=z(),da--,h===u?g=void 0:(D=g,g=u),g!==u?c=f=
[f,g]:(D=c,c=u)):(D=c,c=u);da--;c===u?b=void 0:(D=b,b=u);if(b!==u){da++;b=D;c=H();if(c!==u){f=[];for(g=z();g!==u;)f.push(g),g=z();f!==u?b=c+=f.join(""):(D=b,b=u)}else D=b,b=u;da--;b===u&&0===da&&e(Qa);b!==u?a=b:(D=a,a=u)}else D=a,a=u;da--;a===u&&0===da&&e(Qa);return a}function H(){var a;Pa.test(d.charAt(D))?(a=d.charAt(D),D++):(a=u,0===da&&e(Gc));a===u&&(36===d.charCodeAt(D)?(a=Rc,D++):(a=u,0===da&&e(Za)),a===u&&(95===d.charCodeAt(D)?(a=uc,D++):(a=u,0===da&&e(Ca))));return a}function z(){var a;a=
H();a===u&&(a=C());return a}function N(){var a,b,c,f;a=D;42===d.charCodeAt(D)?(b=ib,D++):(b=u,0===da&&e(ya));b===u&&(47===d.charCodeAt(D)?(b=La,D++):(b=u,0===da&&e(Mb)),b===u&&(37===d.charCodeAt(D)?(b=zb,D++):(b=u,0===da&&e(vc))));b!==u?(c=D,da++,61===d.charCodeAt(D)?(f=ac,D++):(f=u,0===da&&e(lb)),da--,f===u?c=void 0:(D=c,c=u),c!==u?a=b:(D=a,a=u)):(D=a,a=u);return a}function O(){var a,b,c;a=D;43===d.charCodeAt(D)?(b=Da,D++):(b=u,0===da&&e(Va));b!==u?(b=D,da++,43===d.charCodeAt(D)?(c=Da,D++):(c=u,
0===da&&e(Va)),c===u&&(61===d.charCodeAt(D)?(c=ac,D++):(c=u,0===da&&e(lb))),da--,c===u?b=void 0:(D=b,b=u),b!==u?a="+":(D=a,a=u)):(D=a,a=u);a===u&&(a=D,45===d.charCodeAt(D)?(b=ka,D++):(b=u,0===da&&e(ob)),b!==u?(b=D,da++,45===d.charCodeAt(D)?(c=ka,D++):(c=u,0===da&&e(ob)),c===u&&(61===d.charCodeAt(D)?(c=ac,D++):(c=u,0===da&&e(lb))),da--,c===u?b=void 0:(D=b,b=u),b!==u?a="-":(D=a,a=u)):(D=a,a=u));return a}function L(){var a;d.substr(D,2)===mc?(a=mc,D+=2):(a=u,0===da&&e(wc));a===u&&(d.substr(D,2)===jb?
(a=jb,D+=2):(a=u,0===da&&e(Ab)));return a}function F(){var a;d.substr(D,2)===Ia?(a=Ia,D+=2):(a=u,0===da&&e(za));a===u&&(d.substr(D,2)===Fa?(a=Fa,D+=2):(a=u,0===da&&e(sb)),a===u&&(60===d.charCodeAt(D)?(a=eb,D++):(a=u,0===da&&e(Nb)),a===u&&(62===d.charCodeAt(D)?(a=Bb,D++):(a=u,0===da&&e(Cb)))));return a}function I(){var a;d.substr(D,2)===tb?(a=tb,D+=2):(a=u,0===da&&e(yb));a===u&&(d.substr(D,2)===Oa?(a=Oa,D+=2):(a=u,0===da&&e(va)));return a}function M(){var a,b,c;a=D;38===d.charCodeAt(D)?(b=mb,D++):
(b=u,0===da&&e(Ob));b!==u?(b=D,da++,38===d.charCodeAt(D)?(c=mb,D++):(c=u,0===da&&e(Ob)),da--,c===u?b=void 0:(D=b,b=u),b!==u?a="&":(D=a,a=u)):(D=a,a=u);return a}function R(){var a,b,c;a=D;94===d.charCodeAt(D)?(b=pa,D++):(b=u,0===da&&e(pb));b!==u?(b=D,da++,94===d.charCodeAt(D)?(c=pa,D++):(c=u,0===da&&e(pb)),da--,c===u?b=void 0:(D=b,b=u),b!==u?a="^":(D=a,a=u)):(D=a,a=u);return a}function ca(){var a,b,c;a=D;124===d.charCodeAt(D)?(b=ba,D++):(b=u,0===da&&e(ub));b!==u?(b=D,da++,124===d.charCodeAt(D)?(c=
ba,D++):(c=u,0===da&&e(ub)),da--,c===u?b=void 0:(D=b,b=u),b!==u?a="|":(D=a,a=u)):(D=a,a=u);return a}function S(){var a;d.substr(D,2)===Ya?(a=Ya,D+=2):(a=u,0===da&&e(Aa));a!==u&&(a="&&");return a}function Y(){var a;d.substr(D,2)===xa?(a=xa,D+=2):(a=u,0===da&&e(qb));a!==u&&(a="||");return a}function W(){var a,b;a=[];for(b=ia();b!==u;)a.push(b),b=ia();return a}function ia(){var a;da++;$a.test(d.charAt(D))?(a=d.charAt(D),D++):(a=u,0===da&&e(Kb));da--;a===u&&0===da&&e(Vb);return a}function ma(){var a;
d.length>D?(a=d.charAt(D),D++):(a=u,0===da&&e(Fb));return a}var P=1<arguments.length?arguments[1]:{},u={},qa={start:h},ea=h,ja=",",Z={type:"literal",value:",",description:'","'},oa="?",K={type:"literal",value:"?",description:'"?"'},U=":",X={type:"literal",value:":",description:'":"'},sa="defined",ra={type:"literal",value:"defined",description:'"defined"'},fa="(",ha={type:"literal",value:"(",description:'"("'},V=")",J={type:"literal",value:")",description:'")"'},aa={type:"other",description:"number"},
wa="0",na={type:"literal",value:"0",description:'"0"'},Ba=/^[0-9]/,Ga={type:"class",value:"[0-9]",description:"[0-9]"},Q=/^[1-9]/,Xa={type:"class",value:"[1-9]",description:"[1-9]"},T=/^[xX]/,Na={type:"class",value:"[xX]",description:"[xX]"},ta=/^[0-9a-fA-F]/,gb={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Qa={type:"other",description:"identifier"},Rc="$",Za={type:"literal",value:"$",description:'"$"'},uc="_",Ca={type:"literal",value:"_",description:'"_"'},Pa=/^[a-zA-Z]/,Gc={type:"class",
value:"[a-zA-Z]",description:"[a-zA-Z]"},kc="++",lc={type:"literal",value:"++",description:'"++"'},xb="--",Jb={type:"literal",value:"--",description:'"--"'},Da="+",Va={type:"literal",value:"+",description:'"+"'},ka="-",ob={type:"literal",value:"-",description:'"-"'},ga="~",Ra={type:"literal",value:"~",description:'"~"'},Ea="!",hb={type:"literal",value:"!",description:'"!"'},ib="*",ya={type:"literal",value:"*",description:'"*"'},La="/",Mb={type:"literal",value:"/",description:'"/"'},zb="%",vc={type:"literal",
value:"%",description:'"%"'},ac="=",lb={type:"literal",value:"=",description:'"="'},mc="<<",wc={type:"literal",value:"<<",description:'"<<"'},jb=">>",Ab={type:"literal",value:">>",description:'">>"'},Ia="<=",za={type:"literal",value:"<=",description:'"<="'},Fa=">=",sb={type:"literal",value:">=",description:'">="'},eb="<",Nb={type:"literal",value:"<",description:'"<"'},Bb=">",Cb={type:"literal",value:">",description:'">"'},tb="==",yb={type:"literal",value:"==",description:'"=="'},Oa="!=",va={type:"literal",
value:"!=",description:'"!="'},mb="&",Ob={type:"literal",value:"&",description:'"&"'},pa="^",pb={type:"literal",value:"^",description:'"^"'},ba="|",ub={type:"literal",value:"|",description:'"|"'},Ya="&&",Aa={type:"literal",value:"&&",description:'"&&"'},xa="||",qb={type:"literal",value:"||",description:'"||"'},Vb={type:"other",description:"whitespace"},$a=/^[\t\x0B\f ]/,Kb={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},Lb={type:"other",description:"end of line"},Pb="\n",xc={type:"literal",
value:"\n",description:'"\\n"'},Qb="\r\n",kb={type:"literal",value:"\r\n",description:'"\\r\\n"'},ab="\r",hc={type:"literal",value:"\r",description:'"\\r"'},Fb={type:"any",description:"any character"},D=0,bc=0,nb={ti:1,Ig:1,Ni:!1},Db=0,Gb=[],da=0,db;if("startRule"in P){if(!(P.Is in qa))throw Error("Can't start parsing from rule \""+P.Is+'".');ea=qa[P.Is]}db=ea();if(db!==u&&D===d.length)return db;db!==u&&D<d.length&&e({type:"end",description:"end of input"});throw function(b,e,f){function g(a){var b=
1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+
b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=c(f),l=f<d.length?d.charAt(f):null;null!==e&&g(e);return new a(null!==b?b:h(e,l),0,0,f,k.ti,k.Ig)}(null,Gb,Db);}}}()};b4w.module.__md5=function(a){function p(a,f){var h=a[0],g=a[1],m=a[2],n=a[3],h=b(h,g,m,n,f[0],7,-680876936),n=b(n,h,g,m,f[1],12,-389564586),m=b(m,n,h,g,f[2],17,606105819),g=b(g,m,n,h,f[3],22,-1044525330),h=b(h,g,m,n,f[4],7,-176418897),n=b(n,h,g,m,f[5],12,1200080426),m=b(m,n,h,g,f[6],17,-1473231341),g=b(g,m,n,h,f[7],22,-45705983),h=b(h,g,m,n,f[8],7,1770035416),n=b(n,h,g,m,f[9],12,-1958414417),m=b(m,n,h,g,f[10],17,-42063),g=b(g,m,n,h,f[11],22,-1990404162),h=b(h,g,m,n,f[12],7,1804603682),n=b(n,h,g,m,
f[13],12,-40341101),m=b(m,n,h,g,f[14],17,-1502002290),g=b(g,m,n,h,f[15],22,1236535329),h=c(h,g,m,n,f[1],5,-165796510),n=c(n,h,g,m,f[6],9,-1069501632),m=c(m,n,h,g,f[11],14,643717713),g=c(g,m,n,h,f[0],20,-373897302),h=c(h,g,m,n,f[5],5,-701558691),n=c(n,h,g,m,f[10],9,38016083),m=c(m,n,h,g,f[15],14,-660478335),g=c(g,m,n,h,f[4],20,-405537848),h=c(h,g,m,n,f[9],5,568446438),n=c(n,h,g,m,f[14],9,-1019803690),m=c(m,n,h,g,f[3],14,-187363961),g=c(g,m,n,h,f[8],20,1163531501),h=c(h,g,m,n,f[13],5,-1444681467),n=
c(n,h,g,m,f[2],9,-51403784),m=c(m,n,h,g,f[7],14,1735328473),g=c(g,m,n,h,f[12],20,-1926607734),h=d(g^m^n,h,g,f[5],4,-378558),n=d(h^g^m,n,h,f[8],11,-2022574463),m=d(n^h^g,m,n,f[11],16,1839030562),g=d(m^n^h,g,m,f[14],23,-35309556),h=d(g^m^n,h,g,f[1],4,-1530992060),n=d(h^g^m,n,h,f[4],11,1272893353),m=d(n^h^g,m,n,f[7],16,-155497632),g=d(m^n^h,g,m,f[10],23,-1094730640),h=d(g^m^n,h,g,f[13],4,681279174),n=d(h^g^m,n,h,f[0],11,-358537222),m=d(n^h^g,m,n,f[3],16,-722521979),g=d(m^n^h,g,m,f[6],23,76029189),h=
d(g^m^n,h,g,f[9],4,-640364487),n=d(h^g^m,n,h,f[12],11,-421815835),m=d(n^h^g,m,n,f[15],16,530742520),g=d(m^n^h,g,m,f[2],23,-995338651),h=e(h,g,m,n,f[0],6,-198630844),n=e(n,h,g,m,f[7],10,1126891415),m=e(m,n,h,g,f[14],15,-1416354905),g=e(g,m,n,h,f[5],21,-57434055),h=e(h,g,m,n,f[12],6,1700485571),n=e(n,h,g,m,f[3],10,-1894986606),m=e(m,n,h,g,f[10],15,-1051523),g=e(g,m,n,h,f[1],21,-2054922799),h=e(h,g,m,n,f[8],6,1873313359),n=e(n,h,g,m,f[15],10,-30611744),m=e(m,n,h,g,f[6],15,-1560198380),g=e(g,m,n,h,f[13],
21,1309151649),h=e(h,g,m,n,f[4],6,-145523070),n=e(n,h,g,m,f[11],10,-1120210379),m=e(m,n,h,g,f[2],15,718787259),g=e(g,m,n,h,f[9],21,-343485551);a[0]=h+a[0]&4294967295;a[1]=g+a[1]&4294967295;a[2]=m+a[2]&4294967295;a[3]=n+a[3]&4294967295}function d(a,b,c,d,e,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function b(a,b,c,e,h,n,r){return d(b&c|~b&e,a,b,h,n,r)}function c(a,b,c,e,h,n,r){return d(b&e|c&~e,a,b,h,n,r)}function e(a,b,c,e,h,n,r){return d(c^(b|~e),a,b,h,
n,r)}var h="0123456789abcdef".split("");a.Mq=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),n=[],r=void 0,r=0;64>r;r+=4)n[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24);p(a,n)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,e),d=0;16>d;d++)e[d]=0;e[14]=8*
c;p(a,e);for(b=0;b<a.length;b++){c=a[b];d="";for(e=0;4>e;e++)d+=h[c>>8*e+4&15]+h[c>>8*e&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a ; a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"textline",b:"void main ( ) { float b ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",
a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { mat4 ck ; vec3 cl , cm , cn , co ; cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"cm = vec3 ( 0.0 ) ; cn = vec3 ( 0.0 ) ; co = vec3 ( 0.0 ) ; bv ( cl , cm , cn , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["cm","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"cn = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"ck = ao ( u_camera_eye , cn , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ck = ai ( u_camera_eye , cn , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"co = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ; ck = ck * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , co ) ;".split(" ")}]}}]},{type:"textline",b:"d cp = av ( cl - cm , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ck ) ; cp . b = cn ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d cp = av ( cl , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["co","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"co = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cj ( cp . a , cp . b , co ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cp . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:"void main ( ) { float e_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:"e_ = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"e_ = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( e_ < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cq ( cD ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( eU ( cJ . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { float fT ; vec2 fU ; vec4 fV , fW ; mat4 fX , fY ; vec3 fZ , f_ , ga , gb ; fZ = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"fZ = mix ( fZ , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"f_ = vec3 ( 0.0 ) ; ga = vec3 ( 0.0 ) ; gb = vec3 ( 0.0 ) ; bv ( fZ , f_ , ga , gb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["f_","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"f_ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"d gc = fE ( fZ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , f_ , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"ga = ( u_model_matrix * vec4 ( f_ , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:["fX","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fX","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"fY = ao ( u_camera_eye , ga , fX , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"fY = ai ( u_camera_eye , ga , fX ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"gb = ( u_model_matrix * vec4 ( f_ , 1.0 ) ) . xyz ; fY = fY * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gb ) ;".split(" ")}]}}]},{type:"textline",b:"d gc = av ( fZ - f_ , f_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , fY ) ; gc . b = ga ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gc = av ( fZ , f_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["gb","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cj ( gc . a , gc . b , gb ) ;".split(" ")}]}}]},{type:"textline",b:"fV = u_view_matrix * vec4 ( gc . a , 1.0 ) ; fW = u_proj_matrix * fV ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"fW . xy += u_subpixel_jitter * fW . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( gc . a ) ; cJ = fV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],
group:{type:"group",a:[{type:"textline",b:"cD = - fV . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"fU = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; fT = SHADOW_TEX_RES / 2.0 ; fU = floor ( fU * fT + 0.5 ) / fT - fU ; fW . xy += fU ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","fW",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","fT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","fT",";"]}]}}]}]}}]},
{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fT , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = vec4 ( 1.0 , fT ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","fT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","fT",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","fT",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 fU ; mat4 fV ; vec3 fW ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fW = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; fV = ai ( u_camera_eye , fW , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"fV = fV * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d fX = av ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , fV ) ; fX . b = fW ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d fX = av ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"fU = u_proj_matrix * u_view_matrix * vec4 ( fX . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"fT = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fT","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["fT","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","fU",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 ga ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gc = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gc = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float ge ( float gd ) { return gd - floor ( gd * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gn ( inout float gf , in float gg [ gc ] , in float gh ) { float gi , gj , gk , gl ; for ( int gm = 0 ; gm < NUM_RINGS ; gm ++ ) { gi = 40.0 * gg [ gm ] ; gj = 300.0 * ( ge ( gi ) - 0.005 ) ; gk = gi ; gl = abs ( gk * ( u_halo_size * gj - gh ) ) ; gf += 1.0 - min ( gl , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gw ( inout float go , in float gp [ gc ] , in float gq ) { float gr , gs , gt , gu ; for ( int gv = 0 ; gv < NUM_LINES ; gv ++ ) { gr = gp [ gv ] ; gs = gr ; gt = 1000.0 * ( ge ( gr ) - 0.005 ) ; gu = 20.0 * abs ( gs * a . x + gt * a . y ) ; go += 1.0 - min ( gu , 1.0 ) ; } go *= gq ; }".split(" ")}]}}]},{type:"textline",b:"void gD ( inout float gx , in vec2 gy ) { float gz , gA , gB , gC ; gA = atan ( gy . y , gy . x ) ; gA *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; gB = cos ( gA ) ; gC = sin ( gA ) ; gA = ( gB * gy . x + gC * gy . y ) * ( gB * gy . y - gC * gy . x ) ; gz = abs ( gA ) ; if ( gz < 1.0 ) { gz = ( 0.01 * u_halo_size ) / ( gz ) ; gx *= sqrt ( min ( gz , 1.0 ) ) ; } } void main ( ) { vec3 gE ; float gF , gG , gH , gI ; gF = ( a . x * a . x + a . y * a . y ) ; gG = sqrt ( gF ) ; gF = max ( 1.0 - gF , 0.0 ) ; gF = pow ( gF , u_halo_hardness ) ; gH = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float gJ [ gc ] ; for ( int gK = 0 ; gK < gc ; gK ++ ) { gJ [ gK ] = fract ( gb / ( float ( gK ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"gI = 0.0 ; gn ( gI , gJ , gG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"gG = 0.0 ; gw ( gG , gJ , gF ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"gD ( gF , a ) ;".split(" ")}]}}]},{type:"textline",b:"gF *= gH ; gE = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"gI *= gF ; gE += u_halo_rings_color * gI ; gF += gI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"gG *= gH ; gE += u_halo_lines_color * gG ; gF += gG ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"gF *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gI = u_halo_stars_blend * ( ga . y - u_halo_stars_height ) ; gF *= clamp ( gI , 0.0 , 1.0 ) ; gF *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"fX ( gE ) ; f_ ( gE , gF ) ; gl_FragColor = vec4 ( gE , gF ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gb ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ga",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 gc , gd ; mat4 ge , gf ; vec3 gg ; gg = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gb = fract ( gg . x + gg . y + gg . z ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ge = N ( gg , u_view_matrix ) ; gf = u_view_matrix ; gf [ 3 ] [ 0 ] = 0.0 ; gf [ 3 ] [ 1 ] = 0.0 ; gf [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ge = N ( gg , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"gc = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; gc = ge * gc ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",
b:"gd = u_proj_matrix * gf * gc ; gd . z = 0.99999 * gd . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["ga","=","gc",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gd = u_proj_matrix * u_view_matrix * gc ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gd",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gc ; gc = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gc , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform",
"float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_CUBE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",
b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || REFLECTION_TYPE == REFL_CUBE".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float",
"u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ; varying vec3 jD ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jF",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec4 kr , ks , kt , ku ; mat3 kv ; vec3 kw , kx , ky , kz , kA , kB , kC , kD ; vec2 kE , kF , kG , kH ; float kI , kJ , kK , kL , kM ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kI = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["kE","=","a",";"]}]}}]},{type:"textline",b:["kw","=","jD",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) kw = kw ; else kw = - kw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],
group:{type:"group",a:[{type:"textline",b:"kx = cross ( kw , jE . xyz ) * jE . w ; kv = mat3 ( jE . xyz , kx , kw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"kJ = length ( cJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kF = normalize ( u_view_matrix_frag * vec4 ( jD , 0.0 ) ) . st ; kF = kF * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( kJ < PARALLAX_LOD_DIST ) { kK = clamp ( 0.5 * ( PARALLAX_LOD_DIST - kJ ) , 0.0 , 1.0 ) ; kK = u_parallax_scale * kK ; kx = normalize ( jB * kv ) ; kL = 1.0 / PARALLAX_STEPS ; kG = kx . xy * kK / ( PARALLAX_STEPS * kx . z ) ; kK = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:["kH","=",
"kF",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kH","=","kE",";"]}]}}]},{type:"textline",b:"kM = texture2D ( u_normalmap0 , kH ) . a ; for ( float kN = 1.0 ; kN <= PARALLAX_STEPS ; kN ++ ) { if ( kM < kK ) { kK -= kL ; kH -= kG ; kM = texture2D ( u_normalmap0 , kH ) . a ; } } kG = kH + kG ; kL = texture2D ( u_normalmap0 , kG ) . a - ( kK + kL ) ; kM = kM - kK ; kK = kM / ( kM - kL ) ; kH = kK * kG + ( 1.0 - kK ) * kH ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kE += kH - kF ;".split(" ")}]}}]},{type:"textline",b:["kF","=","kH",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kF += kH - kE ;".split(" ")}]}}]},{type:"textline",b:["kE","=","kH",";"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],
group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kr = texture2D ( u_normalmap0 , kF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kr = texture2D ( u_normalmap0 , kE ) ;".split(" ")}]}}]},{type:"textline",b:"kx = kr . rgb - 0.5 ; kx = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , kx , u_normal_factor ) ; kx = kv * kx ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["kx","=","kw",";"]}]}}]},{type:"textline",b:"kx = normalize ( kx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"kF = normalize ( u_view_matrix_frag * vec4 ( kx , 0.0 ) ) . st ; kF = kF * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"kw = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ky = jF ; fV ( ky ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kr = vec4 ( ky , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kr","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["kM","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_colormap0 , kF ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"ks = texture2D ( u_colormap0 , kE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"fV ( ks . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_colormap1 , kF ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_colormap1 , kE ) ;".split(" ")}]}}]},{type:"textline",b:"fV ( kt . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"ku = texture2D ( u_stencil0 , kF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ku = texture2D ( u_stencil0 , kE ) ;".split(" ")}]}}]},{type:"textline",b:"ks = mix ( ks , kt , ku . r ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"kr . rgb = mix ( kr . rgb , ks . rgb , u_diffuse_color_factor ) ; kL = u_alpha_factor * ks . a ; kL += ( 1.0 - step ( 0.0 , kL ) ) ; kr . a = mix ( kL , 1.0 , u_diffuse_color . a ) ; kM = ks . a ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"kr . rgb *= mix ( vec3 ( 1.0 ) , ks . rgb , u_diffuse_color_factor ) ; kr . a = ks . a ; kM = ks . a ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"ky = u_diffuse_intensity * kr . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["kz","=","ky",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kA = u_environment_energy * kq ( kx ) ; kA = u_ambient * kA ; kK = eZ ( ky ) ; kB = u_emit * kr . rgb ; kC = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],
group:{type:"group",a:[{type:"textline",b:"kD = vec3 ( kM ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kD = texture2D ( u_specmap0 , kF ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kD = texture2D ( u_specmap0 , kE ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"fV ( kD . rgb ) ; kC = mix ( kC , kD , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"kL = u_specular_params [ 0 ] ; kG = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; kD = kL * kC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"gO kO = jh ( kB , kA , ky ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO kO = jc ( kB , kA , ky , kD , jC , kx , kw , kG , u_diffuse_params , kK , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"kz = kO . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || REFLECTION_TYPE == REFL_CUBE".split(" "),
group:{type:"group",a:[{type:"textline",b:"j_ ( kz , kw , kx , u_reflect_factor ) ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:"j_ ( kz , kw , kx , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kz += kO . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",
a:[{type:"textline",b:"kz = max ( kz - sqrt ( 0.01 * - min ( kI , 0.0 ) ) , 0.5 * kz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"jA ( kz , kI , u_time , kK , kx , u_sun_direction , u_sun_intensity , u_sun_quaternion , jC , kJ ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"kM = kr . a ; if ( kM <= 0.5 ) discard ; kM = 1.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kM = kr . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kM += kO . a . a * kD . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kM","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kz = mix ( kn ( cI , kx . xz * u_refr_bump ) , kz , kM ) ; kM = 1.0 ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"kL = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"kC = gm ( u_cube_fog , kw ) ; kt = vec4 ( kC , u_fog_color_density . a ) ; fV ( kt . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kt = u_fog_color_density ; kt . rgb *= kL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"gC ( kz , kJ , kw , u_cam_water_depth , u_underwater_fog_color_density , kt , kI , kL ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( kz , kJ , kt ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),
group:{type:"group",a:[{type:"textline",b:"kz = vec3 ( dC . a ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","kz",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kz , kM ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kz , kM ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},
{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ; varying vec3 jD ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jF",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec4 kr , ks ; float kt , ku , kv ; mat4 kw ; vec3 kx , ky , kz , kA , kB , kC , kD ; kx = a_position ; ky = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"kz = vec3 ( a_tangent ) ; kA = a_tangent [ 3 ] * cross ( ky , kz ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kB = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; kC = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; kB = kB - u_camera_eye ; kA = cross ( kB , kC ) ; kz = cross ( kC , kA ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"kz = vec3 ( 0.0 ) ; kA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kx = mix ( kx , a_position_next , u_va_frame_factor ) ; ky = mix ( ky , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"kB = vec3 ( a_tangent ) ; kC = a_tangent_next [ 3 ] * cross ( a_normal_next , kB ) ; kz = mix ( kz , kB , u_va_frame_factor ) ; kA = mix ( kA , kC , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bv ( kx , kz , kA , ky ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["kB","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kB = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d kE = fE ( kx , kz , kA , ky , kB , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"kC = ( u_model_matrix * vec4 ( kB , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"kw = ao ( u_camera_eye , kC , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kw = ai ( u_camera_eye , kC , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"kD = ( u_model_matrix * vec4 ( kB , 1.0 ) ) . xyz ; kw = kw * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kD ) ;".split(" ")}]}}]},{type:"textline",b:"d kE = av ( kx - kB , kB , kz , kA , ky , kw ) ; kE . b = kC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d kE = av ( kx , kB , kz , kA , ky , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"kt = ( dot ( cross ( kE . e , kE . c ) , kE . d ) < 0.0 ) ? - 1.0 : 1.0 ; jE = vec4 ( kE . c , kt ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( kE . a , kE . b , ky ) ;".split(" ")}]}}]},{type:"textline",b:"jC = kE . a ; jD = kE . e ; jB = u_camera_eye - kE . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"a = ay ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"jF = kE . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["jF","=","a_color",";"]}]}}]},{type:"textline",b:"kr = u_view_matrix * vec4 ( kE . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["cJ","=","kr",";"]}]}}]},{type:"textline",b:"ks = u_proj_matrix * kr ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"ks . xy += u_subpixel_jitter * ks . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["fO","(","ks",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( kE . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"kt = ks . x ; ku = ks . y ; kv = ks . w ; cI . x = ( kt + kv ) / 2.0 ; cI . y = ( ku + kv ) / 2.0 ; cI . z = kv ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jG = - kr . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","ks",";","}"]}]};a["nodes.glslf"]=
{type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",
file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_CUBE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 jC ; varying vec4 cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 kr = vec3 ( ZERO_VALUE_NODES ) ; vec3 ks = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},
{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 kw ( in vec3 kt , in float ku ) { vec3 kv ; kv = kr ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",
b:"kv = kn ( cI , kt . xz * ku ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kv = texture2D ( u_refractmap , cI . xy / cI . z ) . rgb ; fV ( kv ) ;".split(" ")}]}}]},{type:"textline",b:["return","kv",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kB ( vec3 kx ) { float ky , kz ; vec4 kA ; kA = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; kA = mix ( vec4 ( kx . bg , kA . wz ) , vec4 ( kx . gb , kA . xy ) , step ( kx . b , kx . g ) ) ; kA = mix ( vec4 ( kA . xyw , kx . r ) , vec4 ( kx . r , kA . yzx ) , step ( kA . x , kx . r ) ) ; ky = kA . x - min ( kA . w , kA . y ) ; kz = 1.0e-10 ; return vec3 ( abs ( kA . z + ( kA . w - kA . y ) / ( 6.0 * ky + kz ) ) , ky / ( kA . x + kz ) , kA . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kF ( vec3 kC ) { vec3 kD ; vec4 kE ; kE = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; kD = abs ( fract ( vec3 ( kC . r , kC . r , kC . r ) + kE . xyz ) * 6.0 - kE . www ) ; return kC . b * mix ( kE . xxx , clamp ( kD - kE . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , kC . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 kH ( vec2 kG ) { return vec3 ( kG * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","||","USE_NODE_TEXTURE_NORMAL","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec2 kJ ( vec3 kI ) { return vec2 ( kI . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",k:[{type:"node_out",name:"lH",qualifier:["vec3"],e:!0},{type:"node_out",name:"lI",qualifier:["float"],e:!0},{type:"node_out",name:"lJ",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lH"],f:[{type:"textline",b:"lH = normalize ( kW . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lI"],f:[{type:"textline",b:"lI = abs ( kW . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_lJ"],
f:[{type:"textline",b:"lJ = length ( kW . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"lK",qualifier:["float"],e:!1},{type:"node_in",name:"lL",qualifier:["float"],e:!1},{type:"node_in",name:"lM",qualifier:["float"],e:!1},{type:"node_out",name:"lN",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lN = vec3 ( lK , lL , lM ) ;".split(" ")}]},{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"lO",qualifier:["float"],e:!1},{type:"node_in",name:"lP",qualifier:["float"],
e:!1},{type:"node_in",name:"lQ",qualifier:["float"],e:!1},{type:"node_out",name:"lR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lR = kF ( vec3 ( lO , lP , lQ ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"lS",qualifier:["vec3"],e:!1},{type:"node_param",name:"kK",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"lS = kH ( kK ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"lT",qualifier:["vec3"],e:!1},{type:"node_param",name:"kL",
qualifier:["varying","vec3"]}],f:[{type:"textline",b:["lT","=","kL",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"lU",qualifier:["float"],e:!1},{type:"node_param",name:"kM",qualifier:["varying","float"]}],f:[{type:"textline",b:["lU","=","kM",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"lV",qualifier:["float"],e:!1},{type:"node_out",name:"lW",qualifier:["float"],e:!1},{type:"node_param",name:"kN",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"lV = kN [ 0 ] ; lW = kN [ 1 ] ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"lX",qualifier:["float"],e:!1},{type:"node_out",name:"lY",qualifier:["float"],e:!1},{type:"node_out",name:"lZ",qualifier:["float"],e:!1},{type:"node_param",name:"kO",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"lX = kO [ 0 ] ; lY = kO [ 1 ] ; lZ = kO [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",k:[{type:"node_out",name:"l_",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["l_","=","ln",";"]}]},{type:"node",name:"GEOMETRY_FB",
k:[{type:"node_out",name:"ma",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ma = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mb",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mb","=","lm",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"mc",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mc = vec3 ( lo . r , - lo . b , lo . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",
name:"md",qualifier:["float"],e:!1},{type:"node_in",name:"me",qualifier:["float"],e:!1},{type:"node_in",name:"mf",qualifier:["float"],e:!1},{type:"node_in",name:"mg",qualifier:["float"],e:!1},{type:"node_in",name:"mh",qualifier:["vec3"],e:!1},{type:"node_out",name:"mi",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ls = kB ( mh ) ; ls [ 0 ] += ( md - 0.5 ) ; if ( ls [ 0 ] > UNITY_VALUE_NODES ) ls [ 0 ] -= UNITY_VALUE_NODES ; else if ( ls [ 0 ] < ZERO_VALUE_NODES ) ls [ 0 ] += UNITY_VALUE_NODES ; ls *= vec3 ( UNITY_VALUE_NODES , me , mf ) ; ls = mix ( ks , mix ( kr , ls , step ( kr , ls ) ) , step ( ls , ks ) ) ; mi = mix ( mh , kF ( ls ) , mg ) ;".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"mj",qualifier:["float"],e:!1},{type:"node_in",name:"mk",qualifier:["vec3"],e:!1},{type:"node_out",name:"ml",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ml = mix ( mk , ks - mk , mj ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"mm",qualifier:["vec3"],e:!0},{type:"node_out",name:"mn",qualifier:["vec3"],e:!1},{type:"node_out",name:"mo",qualifier:["float"],e:!1},{type:"node_out",name:"mp",qualifier:["float"],e:!0}],f:[{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_mm"],f:[{type:"textline",b:"mm = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"kX = u_lamp_light_factors [ LAMP_INDEX ] ; lt = u_lamp_light_directions [ LAMP_INDEX ] ; lu = u_lamp_light_positions [ LAMP_INDEX ] ; le = kX . z ; if ( le != - UNITY_VALUE_NODES ) { mn = lu - jC ; mo = length ( mn ) ; mn = normalize ( mn ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mp"],f:[{type:"textline",b:"mp = le / ( le + mo * mo ) ; le = kX . x ; lf = kX . y ; if ( le > - UNITY_VALUE_NODES ) { lg = dot ( mn , lt ) ; lg *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( lg - le ) / lf ) ; mp *= lg ; }".split(" ")}]}]},
{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mn"],f:[{type:"textline",b:["mn","=","lt",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mo"],f:[{type:"textline",b:"mo = length ( lu - jC ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mp"],f:[{type:"textline",b:["mp","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",k:[{type:"node_in",name:"mq",qualifier:["vec3"],e:!1},{type:"node_out",
name:"mr",qualifier:["vec3"],e:!0},{type:"node_out",name:"ms",qualifier:["float"],e:!0},{type:"node_param",name:"kP",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mr"],f:[{type:"textline",b:["mr","=","kP",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ms"],f:[{type:"textline",b:"ms = - dot ( mq , kP ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",k:[{type:"node_in",name:"mt",qualifier:["vec3"],e:!1},{type:"node_out",name:"mu",qualifier:["vec3"],
e:!1}],f:[{type:"textline",b:"mu = - ( u_view_matrix_frag * vec4 ( mt , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"mv",qualifier:["vec3"],e:!1},{type:"node_out",name:"mw",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mw","=","mv",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"mw = ( MAPPING_TRS_MATRIX * vec4 ( mw , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",
name:"MAPPING_SCALE",f:[{type:"textline",b:"mw = mw * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"mw = mw + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"mw = max ( mw , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",b:"mw = min ( mw , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"mw = normalize ( mw ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"mx",qualifier:["float"],e:!1},{type:"node_in",name:"my",qualifier:["float"],e:!1},{type:"node_out",name:"mz",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mz = mx + my ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mz = clamp ( mz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"mA",qualifier:["float"],e:!1},{type:"node_in",name:"mB",qualifier:["float"],e:!1},{type:"node_out",name:"mC",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mC = mA - mB ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mC = clamp ( mC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",k:[{type:"node_in",name:"mD",qualifier:["float"],e:!1},{type:"node_in",
name:"mE",qualifier:["float"],e:!1},{type:"node_out",name:"mF",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mF = mD * mE ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mF = clamp ( mF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"mG",qualifier:["float"],e:!1},{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_out",name:"mI",qualifier:["float"],e:!1}],f:[{type:"textline",
b:"mI = ( mH != ZERO_VALUE_NODES ) ? mG / mH : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mI = clamp ( mI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"mJ",qualifier:["float"],e:!1},{type:"node_in",name:"mK",qualifier:["float"],e:!1},{type:"node_out",name:"mL",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mL = sin ( mJ ) ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mL = clamp ( mL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mK",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"mM",qualifier:["float"],e:!1},{type:"node_in",name:"mN",qualifier:["float"],e:!1},{type:"node_out",name:"mO",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mO = cos ( mM ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"mO = clamp ( mO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mN",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"mP",qualifier:["float"],e:!1},{type:"node_in",name:"mQ",qualifier:["float"],e:!1},{type:"node_out",name:"mR",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mR = tan ( mP ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mR = clamp ( mR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mQ",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"mS",qualifier:["float"],e:!1},{type:"node_in",name:"mT",qualifier:["float"],e:!1},{type:"node_out",name:"mU",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mU = ( mS <= UNITY_VALUE_NODES && mS >= - UNITY_VALUE_NODES ) ? asin ( mS ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mU = clamp ( mU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mT",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"mV",qualifier:["float"],e:!1},{type:"node_in",name:"mW",qualifier:["float"],e:!1},{type:"node_out",name:"mX",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mX = ( mV <= UNITY_VALUE_NODES && mV >= - UNITY_VALUE_NODES ) ? acos ( mV ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"mX = clamp ( mX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["mW",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"mY",qualifier:["float"],e:!1},{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_out",name:"m_",qualifier:["float"],e:!1}],f:[{type:"textline",b:"m_ = atan ( mY ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"m_ = clamp ( m_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["mZ",";"]}]},{type:"node",name:"MATH_POWER",
k:[{type:"node_in",name:"na",qualifier:["float"],e:!1},{type:"node_in",name:"nb",qualifier:["float"],e:!1},{type:"node_out",name:"nc",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( na < ZERO_VALUE_NODES || na == ZERO_VALUE_NODES && nb == ZERO_VALUE_NODES ) nc = ZERO_VALUE_NODES ; else nc = pow ( na , nb ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nc = clamp ( nc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_LOGARITHM",k:[{type:"node_in",name:"nd",qualifier:["float"],e:!1},{type:"node_in",name:"ne",qualifier:["float"],e:!1},{type:"node_out",name:"nf",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nf = ( nd > ZERO_VALUE_NODES && ne > ZERO_VALUE_NODES ) ? log2 ( nd ) / log2 ( ne ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nf = clamp ( nf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MINIMUM",k:[{type:"node_in",name:"ng",qualifier:["float"],e:!1},{type:"node_in",name:"nh",qualifier:["float"],e:!1},{type:"node_out",name:"ni",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ni = min ( ng , nh ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ni = clamp ( ni , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"nj",qualifier:["float"],e:!1},{type:"node_in",
name:"nk",qualifier:["float"],e:!1},{type:"node_out",name:"nl",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nl = max ( nj , nk ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nl = clamp ( nl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"nm",qualifier:["float"],e:!1},{type:"node_in",name:"nn",qualifier:["float"],e:!1},{type:"node_out",name:"no",qualifier:["float"],e:!1}],
f:[{type:"textline",b:"no = floor ( nm + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"no = clamp ( no , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nn",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"np",qualifier:["float"],e:!1},{type:"node_in",name:"nq",qualifier:["float"],e:!1},{type:"node_out",name:"nr",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nr = ( np < nq ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nr = clamp ( nr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"ns",qualifier:["float"],e:!1},{type:"node_in",name:"nt",qualifier:["float"],e:!1},{type:"node_out",name:"nu",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nu = ( ns > nt ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nu = clamp ( nu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"nv",qualifier:["float"],e:!1},{type:"node_in",name:"nw",qualifier:["float"],e:!1},{type:"node_out",name:"nx",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nx = abs ( nw ) > 0.000001 ? mod ( nv , nw ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nx = clamp ( nx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"ny",qualifier:["float"],e:!1},{type:"node_in",name:"nz",qualifier:["float"],e:!1},{type:"node_out",name:"nA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nA = abs ( ny ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nA = clamp ( nA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nz",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"nB",
qualifier:["float"],e:!1},{type:"node_in",name:"nC",qualifier:["vec3"],e:!1},{type:"node_in",name:"nD",qualifier:["vec3"],e:!1},{type:"node_out",name:"nE",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nE = mix ( nC , nD , le ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nE = clamp ( nE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",
k:[{type:"node_in",name:"nF",qualifier:["float"],e:!1},{type:"node_in",name:"nG",qualifier:["vec3"],e:!1},{type:"node_in",name:"nH",qualifier:["vec3"],e:!1},{type:"node_out",name:"nI",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( nF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nI = mix ( nG , nG + nH , lf ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nI = clamp ( nI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"nJ",qualifier:["float"],e:!1},{type:"node_in",name:"nK",qualifier:["vec3"],e:!1},{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_out",name:"nM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nM = mix ( nK , nK * nL , lg ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nM = clamp ( nM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"nN",qualifier:["float"],e:!1},{type:"node_in",name:"nO",qualifier:["vec3"],e:!1},{type:"node_in",name:"nP",qualifier:["vec3"],e:!1},{type:"node_out",name:"nQ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nQ = mix ( nO , nO - nP , le ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nQ = clamp ( nQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"nR",qualifier:["float"],e:!1},{type:"node_in",name:"nS",qualifier:["vec3"],e:!1},{type:"node_in",name:"nT",qualifier:["vec3"],e:!1},{type:"node_out",name:"nU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( nR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lg = UNITY_VALUE_NODES - lf ; nU = ks - ( vec3 ( lg ) + lf * ( ks - nT ) ) * ( ks - nS ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",
b:"nU = clamp ( nU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"nV",qualifier:["float"],e:!1},{type:"node_in",name:"nW",qualifier:["vec3"],e:!1},{type:"node_in",name:"nX",qualifier:["vec3"],e:!1},{type:"node_out",name:"nY",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( nV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lg = UNITY_VALUE_NODES - le ; nX += step ( nX , kr ) ; nY = lg * nW + le * nW / nX ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"nY = clamp ( nY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"nZ",qualifier:["float"],e:!1},{type:"node_in",name:"n_",qualifier:["vec3"],e:!1},{type:"node_in",name:"oa",qualifier:["vec3"],e:!1},{type:"node_out",name:"ob",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( nZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ob = mix ( n_ , abs ( n_ - oa ) , lf ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ob = clamp ( ob , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"oc",qualifier:["float"],e:!1},{type:"node_in",name:"od",qualifier:["vec3"],e:!1},{type:"node_in",name:"oe",qualifier:["vec3"],e:!1},{type:"node_out",name:"of",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; of = min ( od . rgb , oe . rgb * lg ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"of = clamp ( of , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"og",qualifier:["float"],e:!1},{type:"node_in",name:"oh",qualifier:["vec3"],e:!1},{type:"node_in",name:"oi",qualifier:["vec3"],e:!1},{type:"node_out",name:"oj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( og , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oj = max ( oh . rgb , oi . rgb * le ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oj = clamp ( oj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"ok",qualifier:["float"],e:!1},{type:"node_in",name:"ol",qualifier:["vec3"],e:!1},{type:"node_in",name:"om",qualifier:["vec3"],e:!1},{type:"node_out",name:"on",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( ok , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lt = vec3 ( UNITY_VALUE_NODES - lf ) ; on = mix ( ol * ( lt + 2.0 * lf * om ) , ks - ( lt + 2.0 * lf * ( ks - om ) ) * ( ks - ol ) , step ( 0.5 , ol ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"on = clamp ( on , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"oo",qualifier:["float"],e:!1},{type:"node_in",name:"op",qualifier:["vec3"],e:!1},{type:"node_in",name:"oq",qualifier:["vec3"],e:!1},{type:"node_out",name:"or",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lu = ks - lg * oq ; lt = clamp ( op / lu , 0.0 , 1.0 ) ; or = mix ( mix ( lt , ks , step ( lu , kr ) ) , op , step ( op , kr ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"or = clamp ( or , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"os",qualifier:["float"],e:!1},{type:"node_in",name:"ot",qualifier:["vec3"],e:!1},{type:"node_in",name:"ou",qualifier:["vec3"],e:!1},{type:"node_out",name:"ov",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( os , 0.0 , 1.0 ) ; lt = vec3 ( 1.0 - le ) ; lu = lt + le * ou ; lt = clamp ( ks - ( ks - ot ) / lu , 0.0 , 1.0 ) ; ov = mix ( lt , kr , step ( lu , kr ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ov = clamp ( ov , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"ow",qualifier:["float"],e:!1},{type:"node_in",name:"ox",qualifier:["vec3"],e:!1},{type:"node_in",name:"oy",qualifier:["vec3"],e:!1},{type:"node_out",name:"oz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( ow , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oz = ox ; lu = kB ( oy ) ; if ( lu . y != ZERO_VALUE_NODES ) { lt = kB ( oz ) ; lt . x = lu . x ; lv = kF ( lt ) ; oz = mix ( oz , lv , lf ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oz = clamp ( oz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"oA",qualifier:["float"],e:!1},{type:"node_in",name:"oB",qualifier:["vec3"],e:!1},{type:"node_in",name:"oC",qualifier:["vec3"],e:!1},{type:"node_out",name:"oD",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; le = UNITY_VALUE_NODES - lg ; oD = oB ; lu = kB ( oD ) ; if ( lu . y != ZERO_VALUE_NODES ) { lv = kB ( oC ) ; lu . y = le * lu . y + lg * lv . y ; oD = kF ( lu ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oD = clamp ( oD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"oE",qualifier:["float"],e:!1},{type:"node_in",name:"oF",qualifier:["vec3"],e:!1},{type:"node_in",name:"oG",qualifier:["vec3"],e:!1},{type:"node_out",name:"oH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lf = clamp ( oE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; le = UNITY_VALUE_NODES - lf ; lv = kB ( oF ) ; lw = kB ( oG ) ; lv . z = le * lv . z + lf * lw . z ; oH = kF ( lv ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oH = clamp ( oH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"oI",qualifier:["float"],e:!1},{type:"node_in",name:"oJ",qualifier:["vec3"],e:!1},{type:"node_in",name:"oK",qualifier:["vec3"],e:!1},{type:"node_out",name:"oL",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oL = oJ ; lx = kB ( oK ) ; if ( lx . y != ZERO_VALUE_NODES ) { lw = kB ( oL ) ; lw . x = lx . x ; lw . y = lx . y ; ly = kF ( lw ) ; oL = mix ( oL , ly , lg ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oL = clamp ( oL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"oM",qualifier:["float"],e:!1},{type:"node_in",name:"oN",qualifier:["vec3"],e:!1},{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_out",name:"oP",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"le = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lf = UNITY_VALUE_NODES - le ; lx = oO + oN - oO * oN ; oP = oN * ( vec3 ( lf ) + vec3 ( le ) * ( ( ks - oN ) * oO + lx ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oP = clamp ( oP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"oQ",qualifier:["float"],e:!1},{type:"node_in",name:"oR",qualifier:["vec3"],e:!1},{type:"node_in",name:"oS",qualifier:["vec3"],e:!1},{type:"node_out",name:"oT",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"lg = clamp ( oQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oT = oR + lg * ( 2.0 * oS - ks ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oT = clamp ( oT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"oU",qualifier:["vec3"],e:!1},{type:"node_in",name:"oV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"lp = oU ; ld = oV ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"oW",qualifier:["vec3"],e:!1},{type:"node_in",name:"oX",qualifier:["float"],e:!1},{type:"node_in",
name:"oY",qualifier:["vec3"],e:!1},{type:"node_in",name:"oZ",qualifier:["vec3"],e:!0},{type:"node_out",name:"o_",qualifier:["vec3"],e:!0},{type:"node_out",name:"pa",qualifier:["float"],e:!0},{type:"node_out",name:"pb",qualifier:["vec3"],e:!0},{type:"node_param",name:"kQ",qualifier:["const","vec2"]},{type:"node_param",name:"kR",qualifier:["const","vec3"]}],f:[{type:"textline",b:"ly = clamp ( oW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lx = kR [ 0 ] * clamp ( oY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"lz = normalize ( oZ ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lz","=","ln",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT","&&","!","NODES_GLOW"],f:[{type:"textline",b:"lA = k_ * ly ; lB = lb * u_environment_energy * kq ( lz ) ; lf = eZ ( ly ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"kU = vec2 ( kQ [ 0 ] , kQ [ 1 ] ) ; kV = vec2 ( kR [ 1 ] , kR [ 2 ] ) ; lG = jc ( lA , lB , ly , lx , lo , lz , lm , kV , kU , lf , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"lG = jh ( lA , lB , ly ) ;".split(" ")}]}]},{type:"textline",b:["lc","=","lf",";"]}]},{type:"node_else",f:[{type:"textline",b:"lG . a = vec4 ( ly , ZERO_VALUE_NODES ) ; lG . b = kr ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_o_"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"o_ = lG . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["o_","=","kr",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"o_ += lG . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pa"],f:[{type:"textline",b:"pa = clamp ( oX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pa += lG . a . a * lx . r * la ; pa = clamp ( pa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pb"],f:[{type:"textline",b:["pb","=","lz",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"lq = lG . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lq","=","kr",";"]}]}]},{type:"textline",b:["lr","=","lz",";"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_in",name:"pd",qualifier:["float"],e:!1},{type:"node_in",name:"pe",qualifier:["vec3"],e:!1},{type:"node_in",name:"pf",
qualifier:["vec3"],e:!0},{type:"node_in",name:"pg",qualifier:["float"],e:!1},{type:"node_in",name:"ph",qualifier:["float"],e:!1},{type:"node_in",name:"pi",qualifier:["vec4"],e:!1},{type:"node_in",name:"pj",qualifier:["float"],e:!1},{type:"node_in",name:"pk",qualifier:["float"],e:!1},{type:"node_out",name:"pl",qualifier:["vec3"],e:!0},{type:"node_out",name:"pm",qualifier:["float"],e:!0},{type:"node_out",name:"pn",qualifier:["vec3"],e:!0},{type:"node_out",name:"po",qualifier:["vec3"],e:!0},{type:"node_out",
name:"pp",qualifier:["vec3"],e:!0},{type:"node_param",name:"kS",qualifier:["const","vec2"]},{type:"node_param",name:"kT",qualifier:["const","vec3"]}],f:[{type:"textline",b:"lx = clamp ( pc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lC = kT [ 0 ] * clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"lD = normalize ( pf ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lD","=","ln",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT","&&","!","NODES_GLOW"],f:[{type:"textline",b:"le = eZ ( lx ) ; lE = pg * lx ; lF = lb * u_environment_energy * kq ( lD ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"kV = vec2 ( kS [ 0 ] , kS [ 1 ] ) ; kU = vec2 ( kT [ 1 ] , kT [ 2 ] ) ; lG = jc ( lE , lF , lx , lC , lo , lD , lm , kU , kV , le , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ph , pi ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"lG = jh ( lE , lF , lx ) ;".split(" ")}]}]},{type:"textline",b:["lc","=","le",";"]}]},{type:"node_else",f:[{type:"textline",b:"lG . a = vec4 ( lx , ZERO_VALUE_NODES ) ; lG . b = kr ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pl"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"pl = lG . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["pl","=","kr",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["REFLECTION_TYPE","!=","REFL_NONE"],f:[{type:"textline",b:"j_ ( pl , lm , lD , pj ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pl += lG . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pm"],f:[{type:"textline",b:"pm = clamp ( pd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"pm += lG . a . a * lC . r * pk ; pm = clamp ( pm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pn"],f:[{type:"textline",b:["pn","=","lD",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_po"],f:[{type:"textline",b:"po = lG . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pp"],f:[{type:"textline",b:"pp = lG . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"lq = lG . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["lq",
"=","kr",";"]}]}]},{type:"textline",b:["lr","=","lD",";"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"pq",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pq = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"pr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ps",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ps = pr . r * 0.35 + pr . g * 0.45 + pr . b * 0.2 ;".split(" ")}]},{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"pt",qualifier:["vec3"],
e:!1},{type:"node_out",name:"pu",qualifier:["float"],e:!0},{type:"node_out",name:"pv",qualifier:["float"],e:!0},{type:"node_out",name:"pw",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pu"],f:[{type:"textline",b:"pu = pt . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pv"],f:[{type:"textline",b:"pv = pt . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pw"],f:[{type:"textline",b:"pw = pt . b ;".split(" ")}]}]}]},
{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"px",qualifier:["vec3"],e:!1},{type:"node_out",name:"py",qualifier:["float"],e:!0},{type:"node_out",name:"pz",qualifier:["float"],e:!0},{type:"node_out",name:"pA",qualifier:["float"],e:!0}],f:[{type:"textline",b:"lC = kB ( px ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_py"],f:[{type:"textline",b:"py = lC . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pz"],f:[{type:"textline",b:"pz = lC . g ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pA"],f:[{type:"textline",b:"pA = lC . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"pB",qualifier:["float"],e:!1},{type:"node_in",name:"pC",qualifier:["float"],e:!1},{type:"node_in",name:"pD",qualifier:["float"],e:!1},{type:"node_out",name:"pE",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pE = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( pB - pD ) * pC ) ) ) ;".split(" ")}]},{type:"node",
name:"GAMMA",k:[{type:"node_in",name:"pF",qualifier:["vec3"],e:!1},{type:"node_in",name:"pG",qualifier:["float"],e:!1},{type:"node_out",name:"pH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pH = max ( kr , pF ) ; pH = pow ( pH , vec3 ( pG ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"pI",qualifier:["vec3"],e:!1},{type:"node_out",name:"pJ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pJ = max ( kr , pI ) ; pJ = pow ( pJ , vec3 ( 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"pK",qualifier:["vec3"],e:!1},{type:"node_out",name:"pL",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"pL = max ( kr , pK ) ; pL = pow ( pL , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",k:[{type:"node_out",name:"pM",qualifier:["vec3"],e:!1},{type:"node_out",name:"pN",qualifier:["vec3"],e:!1},{type:"node_out",name:"pO",qualifier:["float"],e:!1}],f:[{type:"textline",b:"pO = pM [ 0 ] = pM [ 1 ] = pM [ 2 ] = pN [ 0 ] = pN [ 1 ] = pN [ 2 ] = 0.0 ;".split(" ")}]},
{type:"node",name:"TEXTURE_ENVIRONMENT",k:[{type:"node_in",name:"pP",qualifier:["vec3"],e:!1},{type:"node_out",name:"pQ",qualifier:["vec3"],e:!0},{type:"node_out",name:"pR",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"kX = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , pP ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pQ"],f:[{type:"textline",b:"pQ = kX . xyz ; fV ( pQ ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pR"],f:[{type:"textline",b:"pR = kX . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"pS",qualifier:["vec3"],e:!0},{type:"node_in",name:"pT",qualifier:["vec3"],e:!0},{type:"node_in",name:"pU",qualifier:["vec3"],e:!0},{type:"node_in",name:"pV",qualifier:["vec3"],e:!0},{type:"node_out",name:"pW",qualifier:["vec3"],e:!0},{type:"node_out",name:"pX",qualifier:["float"],e:!0},{type:"node_out",name:"pY",qualifier:["vec3"],
e:!0},{type:"node_out",name:"pZ",qualifier:["float"],e:!0},{type:"node_out",name:"p_",qualifier:["vec3"],e:!0},{type:"node_out",name:"qa",qualifier:["float"],e:!0},{type:"node_out",name:"qb",qualifier:["vec3"],e:!0},{type:"node_out",name:"qc",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_COLOR_var_texture , kJ ( pS ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_pW"],f:[{type:"textline",b:"pW = kX . xyz ; fV ( pW ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pX"],f:[{type:"textline",b:"pX = kX . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_COLOR_var_texture , kJ ( pT ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pY"],f:[{type:"textline",b:"pY = kX . xyz ; fV ( pY ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_pZ"],f:[{type:"textline",b:"pZ = kX . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_COLOR_var_texture , kJ ( pU ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_p_"],f:[{type:"textline",b:"p_ = kX . xyz ; fV ( p_ ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qa"],f:[{type:"textline",b:"qa = kX . w ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_uv4"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_COLOR_var_texture , kJ ( pV ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qb"],f:[{type:"textline",b:"qb = kX . xyz ; fV ( qb ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qc"],f:[{type:"textline",b:"qc = kX . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"qd",qualifier:["vec3"],e:!0},{type:"node_in",name:"qe",qualifier:["vec3"],
e:!0},{type:"node_in",name:"qf",qualifier:["vec3"],e:!0},{type:"node_in",name:"qg",qualifier:["vec3"],e:!0},{type:"node_out",name:"qh",qualifier:["vec3"],e:!0},{type:"node_out",name:"qi",qualifier:["float"],e:!0},{type:"node_out",name:"qj",qualifier:["vec3"],e:!0},{type:"node_out",name:"qk",qualifier:["float"],e:!0},{type:"node_out",name:"ql",qualifier:["vec3"],e:!0},{type:"node_out",name:"qm",qualifier:["float"],e:!0},{type:"node_out",name:"qn",qualifier:["vec3"],e:!0},{type:"node_out",name:"qo",
qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_NORMAL_var_texture , kJ ( qd ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qh"],f:[{type:"textline",b:"qh = normalize ( kY * ( kX . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qi"],f:[{type:"textline",b:"qi = kX . w ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_uv2"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_NORMAL_var_texture , kJ ( qe ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qj"],f:[{type:"textline",b:"qj = normalize ( kY * ( kX . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qk"],f:[{type:"textline",b:"qk = kX . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_NORMAL_var_texture , kJ ( qf ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ql"],f:[{type:"textline",b:"ql = normalize ( kY * ( kX . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qm"],f:[{type:"textline",b:"qm = kX . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],f:[{type:"textline",b:"kX = texture2D ( node_TEXTURE_NORMAL_var_texture , kJ ( qg ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qn"],f:[{type:"textline",b:"qn = normalize ( kY * ( kX . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qo"],f:[{type:"textline",b:"qo = kX . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",k:[{type:"node_out",name:"qp",qualifier:["float"],e:!1}],f:[{type:"textline",b:"qp = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"qq",qualifier:["vec3"],e:!1},{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_out",name:"qs",qualifier:["vec3"],e:!1},{type:"node_out",name:"qt",qualifier:["float"],
e:!0}],f:[{type:"textline",b:"qs = qq + qr ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qt"],f:[{type:"textline",b:"qt = ( abs ( qs [ 0 ] ) + abs ( qs [ 1 ] ) + abs ( qs [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"qu",qualifier:["vec3"],e:!1},{type:"node_in",name:"qv",qualifier:["vec3"],e:!1},{type:"node_out",name:"qw",qualifier:["vec3"],e:!1},{type:"node_out",name:"qx",qualifier:["float"],e:!0}],f:[{type:"textline",
b:"qw = qu - qv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qx"],f:[{type:"textline",b:"qx = ( abs ( qw [ 0 ] ) + abs ( qw [ 1 ] ) + abs ( qw [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"qy",qualifier:["vec3"],e:!1},{type:"node_in",name:"qz",qualifier:["vec3"],e:!1},{type:"node_out",name:"qA",qualifier:["vec3"],e:!1},{type:"node_out",name:"qB",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qA = qy + qz ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qB"],f:[{type:"textline",b:"qB = length ( qA ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qA"],f:[{type:"textline",b:"qA = normalize ( qA ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"qC",qualifier:["vec3"],e:!1},{type:"node_in",name:"qD",qualifier:["vec3"],e:!1},{type:"node_out",name:"qE",qualifier:["vec3"],e:!1},{type:"node_out",name:"qF",qualifier:["float"],e:!0}],f:[{type:"textline",
b:["qE","=","kr",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qF"],f:[{type:"textline",b:"qF = dot ( qC , qD ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"qG",qualifier:["vec3"],e:!1},{type:"node_in",name:"qH",qualifier:["vec3"],e:!1},{type:"node_out",name:"qI",qualifier:["vec3"],e:!1},{type:"node_out",name:"qJ",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qI = cross ( qG , qH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_qJ"],f:[{type:"textline",b:"qJ = length ( qI ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_in",name:"qL",qualifier:["vec3"],e:!1},{type:"node_out",name:"qM",qualifier:["vec3"],e:!1},{type:"node_out",name:"qN",qualifier:["float"],e:!0}],f:[{type:"textline",b:"qM = normalize ( qK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qN"],f:[{type:"textline",b:"qN = length ( qK ) ;".split(" ")}]}]},
{type:"textline",b:["qL",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"qO",qualifier:["vec3"],e:!1},{type:"node_in",name:"qP",qualifier:["vec3"],e:!1},{type:"node_out",name:"qQ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"qQ = reflect ( - qO , qP ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"qR",qualifier:["vec3"],e:!1},{type:"node_in",name:"qS",qualifier:["float"],e:!1},{type:"node_in",name:"qT",qualifier:["const","float"],e:!1},{type:"node_in",
name:"qU",qualifier:["const","float"],e:!1},{type:"node_out",name:"qV",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"lg = length ( kW ) ; if ( lg < qU ) { kU = kJ ( qR ) ; lh = clamp ( 0.5 * ( qU - lg ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lh = qS * lh ; lC = normalize ( lm * kY ) ; li = UNITY_VALUE_NODES / qT ; kV = lC . xy * lh / ( qT * lC . z ) ; lj = UNITY_VALUE_NODES ; lk = texture2D ( node_B4W_PARALLAX_var_texture , kU ) . a ; for ( float qW = 1.0 ; qW <= qT ; qW ++ ) { if ( lk < lj ) { lj -= li ; kU -= kV ; lk = texture2D ( node_B4W_PARALLAX_var_texture , kU ) . a ; } } kV = kU + kV ; li = texture2D ( node_B4W_PARALLAX_var_texture , kV ) . a - ( lj + li ) ; lj = lk - lj ; lj = lj / ( lj - li ) ; kU = lj * kV + ( UNITY_VALUE_NODES - lj ) * kU ; qV = kH ( kU ) ; } else qV = qR ;".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"qX",qualifier:["vec3"],e:!1},{type:"node_out",name:"qY",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"qY = clamp ( qX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"qZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"q_",qualifier:["float"],e:!1},{type:"node_out",name:"ra",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ra = kw ( qZ , q_ ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"rb",qualifier:["float"],e:!1},{type:"node_in",name:"rc",qualifier:["float"],e:!1},{type:"node_in",name:"rd",qualifier:["float"],e:!1},{type:"node_in",name:"re",qualifier:["float"],e:!1},{type:"node_in",name:"rf",qualifier:["float"],e:!1},{type:"node_out",name:"rg",qualifier:["float"],e:!0},{type:"node_out",name:"rh",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rg"],f:[{type:"textline",b:["rg","=","rb",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rh"],f:[{type:"textline",b:"rh = vec4 ( rc , rd , re , rf ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"ri",qualifier:["float"],e:!1}],f:[{type:"textline",b:["ri","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"rj",qualifier:["float"],e:!1},{type:"node_in",name:"rk",qualifier:["float"],e:!1},{type:"node_in",name:"rl",qualifier:["float"],e:!1},{type:"node_out",name:"rm",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"rm = smoothstep ( rk , rl , rj ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",k:[{type:"node_in",name:"rn",qualifier:["vec3"],e:!1},{type:"node_in",name:"ro",qualifier:["float"],e:!1}],f:[{type:"textline",b:"lp = rn ; ld = ro ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",k:[{type:"node_in",name:"rp",qualifier:["vec3"],e:!1},{type:"node_out",name:"rq",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rq = ( rp . r + rp . g + rp . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",k:[{type:"node_in",name:"rr",qualifier:["float"],e:!1},{type:"node_out",name:"rs",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rs [ 0 ] = rr ; rs [ 1 ] = rr ; rs [ 2 ] = rr ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec2 kU , kV ; vec4 kW , kX ; mat3 kY ; float kZ , k_ , la , lb , lc , ld , le , lf , lg , lh , li , lj , lk ; vec3 ll , lm , ln , lo , lp , lq , lr , ls , lt , lu , lv , lw , lx , ly , lz , lA , lB , lC , lD , lE , lF ;".split(" ")},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["ll","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kZ = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",
b:["lm","=","jD",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lm = lm ; else lm = - lm ;".split(" ")}]}}]},{type:"textline",b:"ln = normalize ( lm ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"lo = cross ( lm , jE . xyz ) * jE . w ; kY = mat3 ( jE . xyz , lo , lm ) ; kY = kY ;".split(" ")}]}}]},{type:"textline",b:"lo = u_camera_eye_frag - jC ; lm = normalize ( lo ) ; lo = jC ; kW = cJ ; k_ = u_emit ; la = u_specular_alpha ; lb = u_ambient ; gO lG ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"lC = lp ; li = ld ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lC = max ( lC - sqrt ( 0.01 * - min ( kZ , ZERO_VALUE_NODES ) ) , 0.5 * lC ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"jA ( lC , kZ , u_time , lc , lr , u_sun_direction , ll , u_sun_quaternion , jC , length ( cJ ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"lj = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"lp = gm ( u_cube_fog , lm ) ; kX = vec4 ( lp , u_fog_color_density . a ) ; fV ( kX . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kX = u_fog_color_density ; kX . rgb *= lj ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"gC ( lC , length ( cJ ) , lm , u_cam_water_depth , u_underwater_fog_color_density , kX , kZ , lj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( lC , length ( cJ ) , kX ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"if ( li < 0.5 ) discard ; li = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"kV = texture2DProj ( u_shadow_mask , cI ) . rg ; ld = kV . g ; lC = vec3 ( ld ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","lC",")",";"]},{type:"condition",a:[{type:"if",c:"ALPHA && ! ALPHA_CLIP || NODES_GLOW".split(" "),group:{type:"group",a:[{type:"textline",
b:"f_ ( lC , li ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lC , li ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",
";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 jC ; varying vec4 cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec3","jD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION",
"&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"kK",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["kK","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"kP",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["kP","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"kQ",qualifier:["varying","float"]}],f:[{type:"textline",b:["kQ","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"kR",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["kR","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"kS",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["kS","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec4 kT ; float kU , kV , kW ; mat4 kX ; vec3 kY , kZ , k_ , la , lb , lc , ld ; kY = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kZ = a_normal ; k_ = vec3 ( a_tangent ) ; la = a_tangent [ 3 ] * cross ( kZ , k_ ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",
b:"kZ = a_normal ; k_ = vec3 ( 0.0 ) ; la = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kZ = vec3 ( 0.0 ) ; k_ = vec3 ( 0.0 ) ; la = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kY = mix ( kY , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"kZ = mix ( kZ , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"lb = vec3 ( a_tangent ) ; lc = a_tangent_next [ 3 ] * cross ( a_normal_next , lb ) ; k_ = mix ( k_ , lb , u_va_frame_factor ) ; la = mix ( la , lc , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bv ( kY , k_ , la , kZ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["lb","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"lc = ( u_model_matrix * vec4 ( lb , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],
group:{type:"group",a:[{type:"textline",b:"kX = ao ( u_camera_eye , lc , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kX = ai ( u_camera_eye , lc , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"ld = ( u_model_matrix * vec4 ( lb , 1.0 ) ) . xyz ; kX = kX * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ld ) ;".split(" ")}]}}]},
{type:"textline",b:"d le = av ( kY - lb , lb , k_ , la , kZ , kX ) ; le . b = lc ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d le = av ( kY , lb , k_ , la , kZ , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( le . a , le . b , kZ ) ;".split(" ")}]}}]},{type:"textline",b:"jC = le . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"jD = le . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kU = ( dot ( cross ( le . e , le . c ) , le . d ) < 0.0 ) ? - 1.0 : 1.0 ; jE = vec4 ( le . c , kU ) ;".split(" ")}]}}]},{type:"textline",b:"cJ = u_view_matrix * vec4 ( le . a , 1.0 ) ; kT = u_proj_matrix * cJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"kT . xy += u_subpixel_jitter * kT . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["fO","(","kT",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"fO ( le . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:"kU = kT . x ; kV = kT . y ; kW = kT . w ; cI . x = ( kU + kW ) / 2.0 ; cI . y = ( kV + kW ) / 2.0 ; cI . z = kW ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jG = - cJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","kT",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float kT ; varying vec3 jF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cJ",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 kU ; float kV ; kV = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; kV = smoothstep ( u_p_alpha_start , u_p_alpha_end , kV ) ; kV = u_diffuse_color . a * kT * ( 1.0 - clamp ( kV , 0.0 , 1.0 ) ) ; kU = jF * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gg ( kU , length ( cJ ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["fX","(","kU",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kU , kV ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kU , kV ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float kT ; varying vec3 jF ; varying vec3 cJ ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float lG ; vec4 lH ; kU lI ; lI = lF ( ) ; lH = u_view_matrix * vec4 ( lI . b , 1.0 ) ; gl_Position = u_proj_matrix * lH ; kT = lI . c ; jF = lI . d ; cJ = lH . xyz ; lG = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = lI . a * lG ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",
a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float kT ; varying vec3 jF ; varying vec2 a ; varying vec3 jB ; varying vec3 jC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec2 kr ; float ks ; vec3 kt , ku , kv , kw , kx , ky ; vec4 kz , kA ; kz = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"kA = texture2D ( u_sampler , a ) ; fV ( kA . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"kz . rgb = mix ( kz . rgb , kA . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"kz . rgb *= mix ( vec3 ( 1.0 ) , kA . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"kz . a = kA . a ;".split(" ")}]}}]},{type:"textline",b:"kz . rgb *= jF ; kt = u_diffuse_intensity * kz . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"ku = u_emit * kz . rgb ; kv = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_ENVIRONMENT_LIGHT && ! SKY_TEXTURE && SKY_COLOR".split(" "),group:{type:"group",a:[{type:"textline",b:"kw = u_environment_energy * kq ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kw = u_environment_energy * kq ( kv ) ;".split(" ")}]}}]},{type:"textline",
b:"kw = u_ambient * kw ; ks = u_specular_params [ 0 ] ; kr = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; kx = ks * u_specular_color ; ky = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO kB = jc ( ku , kw , kt , kx , jC , kv , ky , kr , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"gO kB = jh ( ku , kw , kt ) ;".split(" ")}]}}]},{type:"textline",b:"kx = kB . a . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kx","=","kt",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gg ( kx , length ( cJ ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"ks = kz . a * kT ; fX ( kx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&",
"!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"f_ ( kx , ks ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kx , ks ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",
b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float kT ; varying vec3 jF ; varying vec2 a ; varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float kt ( vec2 kr , vec2 ks ) { return ( atan ( ks . y , ks . x ) - atan ( kr . y , kr . x ) ) ; } void main ( ) { vec4 ku , kv , kw ; mat4 kx ; float ky ; kU kz ; kz = lF ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { ky = kz . e ; kx = N ( kz . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { ky = kz . e ; kx = x ( ) ; kx [ 3 ] = vec4 ( kz . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { ky = kz . e ; kx = B ( radians ( 90.0 ) ) ; kx [ 3 ] = vec4 ( kz . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { ky = kt ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + kz . e ; kx = z ( radians ( - 90.0 ) ) ; kx [ 3 ] = vec4 ( kz . b , 1.0 ) ; } ku = vec4 ( a_p_bb_vertex * 2.0 * kz . a * u_p_size , 0.0 , 1.0 ) ; ku = kx * D ( ky ) * ku ; kv = u_view_matrix * ku ; kw = u_proj_matrix * kv ; gl_Position = kw ; kT = kz . c ; jF = kz . d ; a = a_p_bb_vertex + 0.5 ; jC = ku . xyz ; jB = u_camera_eye - ku . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cJ","=","kv",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 lG ; const float lH = 0.99 ; const float lI = 1.8 ; const int lJ = 8 ; float lP ( vec3 lK , vec3 lL ) { float lM , lN , lO ; lM = dot ( lL , lL ) ; lN = 2.0 * dot ( lL , lK ) ; lO = dot ( lK , lK ) - 1.0 ; lM = lN * lN - 4.0 * lM * lO ; lM = sqrt ( lM ) ; lN = ( - lN - lM ) / 2.0 ; lM = lO / lN ; return lM ; } float lW ( float lQ , float lR ) { float lS , lT , lU , lV ; lS = 3.0 * ( 1.0 - lR * lR ) ; lT = 2.0 * ( 2.0 + lR * lR ) ; lU = 1.0 + lQ * lQ ; lV = pow ( 1.0 + lR * lR - 2.0 * lR * lQ , 1.5 ) ; lV = max ( lV , 0.00001 ) ; return ( lS / lT ) * ( lU / lV ) ; } float mb ( vec3 lX , vec3 lY , float lZ ) { vec3 l_ ; float ma ; ma = dot ( lY , - lX ) ; if ( ma < 0.0 ) { return 1.0 ; } l_ = lX + ma * lY ; if ( length ( l_ ) < lZ ) { return 0.0 ; } else if ( length ( l_ ) >= lZ ) { l_ = normalize ( l_ ) * lZ - lX ; ma = acos ( dot ( normalize ( l_ ) , lY ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( ma * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 mf ( float mc , vec3 md , float me ) { return md - md * pow ( u_sky_color , vec3 ( me / mc ) ) ; } void main ( ) { float mg , mh , mi , mj , mk , ml , mm , mn , mo ; vec3 mp , mq , mr , ms , mt , mu , mv ; mp = normalize ( lG ) ; mq = u_sun_direction ; mg = dot ( mp , mq ) ; mh = lW ( mg , - 0.01 ) * u_rayleigh_brightness * mq . y ; mi = lW ( mg - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - mq . y ) ; mg = smoothstep ( 0.0 , 100.0 , lW ( mg , 0.9995 ) ) * u_spot_brightness ; mr = vec3 ( 0.0 , lH , 0.0 ) ; mj = lP ( mr , mp ) ; mk = mj / float ( lJ ) ; ml = mb ( mr , mp , lH - 0.3 ) ; ms = vec3 ( 0.0 , 0.0 , 0.0 ) ; mt = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int mw = 0 ; mw < lJ ; mw ++ ) { mm = mk * float ( mw ) ; mu = mr + mp * mm ; mn = mb ( mu , mq , lH - 0.2 ) ; mo = lP ( mu , mq ) ; mv = mf ( mo , vec3 ( lI ) , u_scatter_strength ) * mn ; ms += mf ( sqrt ( mm ) , u_sky_color * mv , u_rayleigh_strength ) ; mt += mf ( mm , mv , u_mie_strength ) ; } ms = ms * ml * pow ( mj , u_rayleigh_collection_power ) / float ( lJ ) ; mt = ( mt * ml * pow ( mj , u_mie_collection_power ) ) / float ( lJ ) ; mt = vec3 ( mg * mt + mi * mt + mh * ms ) ; fX ( mt ) ; gl_FragColor = vec4 ( mt , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 lG ; void main ( ) { vec4 kr , ks ; kr = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; ks = u_cube_view_matrix * kr ; lG = ks . xyz ; gl_Position = kr ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 kr ; kr = texture2D ( u_sampler , a ) ; fX ( kr . rgb ) ; f_ ( kr . rgb , kr . a ) ; gl_FragColor = kr ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { vec2 kr ; float ks ; vec4 kt ; vec3 ku ; a = a_texcoord ; ku = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; kt = u_proj_matrix * u_view_matrix * vec4 ( ku , 0.0 ) ; kt . x /= kt . w ; kt . y /= kt . w ; kt += 99999.0 * step ( kt . z , 0.0 ) ; kt += 100.0 * ( step ( 1.0 , abs ( kt . x ) ) + step ( 1.0 , abs ( kt . y ) ) ) ; kt . x = - a_lf_dist * kt . x ; kt . y = - a_lf_dist * kt . y ; ks = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; kr = vec2 ( a_lf_bb_vertex . x / ks , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float kv = 1.9 ; kr *= ( 1.0 + kv * length ( kt . xy ) ) ; } gl_Position = vec4 ( kt . xy + kr , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","||","PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","PROCEDURAL_SKYDOME","&&","WO_SKYTEX"],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},
{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_world_vec",";"]}]}}]},{type:"textline",b:"vec3 kw ( vec3 kr , vec3 ks , float kt , float ku ) { float kv ; kv = kt * ku ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","==","MTEX_BLEND"],group:{type:"group",a:[{type:"textline",
b:"return lX ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_ADD"],group:{type:"group",a:[{type:"textline",b:"return ma ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SUB"],group:{type:"group",a:[{type:"textline",b:"return me ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_MUL"],group:{type:"group",a:[{type:"textline",b:"return mj ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SCREEN"],group:{type:"group",
a:[{type:"textline",b:"return mo ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_OVERLAY"],group:{type:"group",a:[{type:"textline",b:"return mt ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DIFF"],group:{type:"group",a:[{type:"textline",b:"return mx ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DIV"],group:{type:"group",a:[{type:"textline",b:"return mB ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==",
"MTEX_DARK"],group:{type:"group",a:[{type:"textline",b:"return mF ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_LIGHT"],group:{type:"group",a:[{type:"textline",b:"return mJ ( kr , ks , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_BLEND_HUE"],group:{type:"group",a:[{type:"textline",b:"return mP ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_BLEND_SAT"],group:{type:"group",a:[{type:"textline",b:"return mV ( ks , kr , kv ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","==","MTEX_BLEND_VAL"],group:{type:"group",a:[{type:"textline",b:"return na ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_BLEND_COLOR"],group:{type:"group",a:[{type:"textline",b:"return ng ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SOFT_LIGHT"],group:{type:"group",a:[{type:"textline",b:"return nl ( ks , kr , kv ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_LIN_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"return np ( ks , kr , kv ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float kE ( float kx , float ky , float kz , float kA ) { float kB ; vec3 kC , kD ; kC = vec3 ( kx ) , kD = vec3 ( ky ) ; kB = kz * kA ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","==","MTEX_BLEND"],group:{type:"group",a:[{type:"textline",b:"return lX ( kD , kC , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_ADD"],group:{type:"group",a:[{type:"textline",b:"return ma ( kC , kD , kB ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","==","MTEX_SUB"],group:{type:"group",a:[{type:"textline",b:"return me ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_MUL"],group:{type:"group",a:[{type:"textline",b:"return nv ( kx , ky , kB , kA ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SCREEN"],group:{type:"group",a:[{type:"textline",b:"return nB ( kx , ky , kB , kA ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_OVERLAY"],group:{type:"group",a:[{type:"textline",
b:"return nH ( kx , ky , kB , kA ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DIFF"],group:{type:"group",a:[{type:"textline",b:"return mx ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DIV"],group:{type:"group",a:[{type:"textline",b:"return mB ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_DARK"],group:{type:"group",a:[{type:"textline",b:"return mF ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_LIGHT"],
group:{type:"group",a:[{type:"textline",b:"return mJ ( kC , kD , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_SOFT_LIGHT"],group:{type:"group",a:[{type:"textline",b:"return nl ( kD , kC , kB ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","==","MTEX_LIN_LIGHT"],group:{type:"group",a:[{type:"textline",b:"return np ( kD , kC , kB ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["!","PROCEDURAL_SKYDOME"],group:{type:"group",
a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","lG",";"]},{type:"condition",a:[{type:"if",c:"! PROCEDURAL_SKYDOME && ( WO_SKYTEX || WO_SKYBLEND )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 kF ; float kG , kH , kI ; vec3 kJ , nI , nJ , nK , nL ; nI = normalize ( lG ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"kJ = textureCube ( u_sky , nI ) . rgb ;".split(" ")}]}},{type:"elif",c:"! ( WO_SKYTEX || WO_SKYBLEND )".split(" "),group:{type:"group",a:[{type:"textline",b:"kJ = u_horizon_color ; fX ( kJ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"nJ = vec3 ( a , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nJ = normalize ( vec3 ( a , 1.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"kG = abs ( a . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kG = ( a . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kH = acos ( nI . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"kG = abs ( kH * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kG = 1.0 - kH * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},
{type:"textline",b:"nK = u_horizon_color ; nL = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"kH = 1.0 ; kF = textureCube ( u_sky , nI ) ; fV ( kF . rgb ) ; kH = kF . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"kH = dot ( kF . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["!","MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"kF = vec4 ( vec3 ( 1.0 ) - kF . rgb , kF . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kH = 1.0 - kH ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ","||","WOMAP_ZENUP","||","WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"kF = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kH = kF . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"nK = kw ( kF . rgb , nK , kH , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP","||","WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:["kI","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( nJ , u_world_vec ) >= 0.0 ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"kI = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"else kI = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",
b:"kI = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"kI = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( kI != 0.0 ) nL = kw ( kF . rgb , nL , kH , kI ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_BLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["!","MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"kH = dot ( kF . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"kG = kE ( u_sky_tex_dvar , kG , kH , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"kJ = mix ( nK , nL , kG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kJ","=","nK",";"]}]}}]},{type:"textline",b:["fX","(","kJ",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"fX ( nK ) ; fX ( nL ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],
group:{type:"group",a:[{type:"textline",b:"kJ = mix ( nK , nL , kG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["kJ","=","nK",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"fV ( kJ ) ; kI = u_camera_eye_frag . y - WATER_LEVEL ; kI = min ( - kI * 0.03 , 0.8 ) ; kH = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; nJ = vec3 ( 0.0 ) ; kF = u_underwater_fog_color_density ; kF . rgb = mix ( kF . rgb , nJ , min ( - nI . y + kI , 1.0 ) ) * kH ; kG = clamp ( sign ( nI . y - 0.05 * kI ) , 0.0 , 1.0 ) ; kJ = mix ( kF . rgb , kJ , kG ) ; fX ( kJ ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( kJ , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 lG ;".split(" ")},{type:"condition",a:[{type:"if",c:"! PROCEDURAL_SKYDOME && ( WO_SKYTEX || WO_SKYBLEND )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 kr , ks ; kr = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; ks = u_sky_vp_inverse * kr ; lG = ks . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:"! PROCEDURAL_SKYDOME && ( WO_SKYTEX || WO_SKYBLEND )".split(" "),group:{type:"group",a:[{type:"textline",b:"a = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","kr",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube",
"u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","&&","SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || WATER_EFFECTS".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform",
"float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float kr = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:"( NUM_NORMALMAPS > 0 || FOAM ) && ! GENERATED_MESH".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","jD",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jE ; varying vec3 nI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nK",";"]}]}}]},{type:"condition",a:[{type:"if",
c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nL",";"]}]}}]},{type:"include",
file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING","&&","USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 nX ( in vec2 nM , in vec3 nN , in vec3 nO , in vec3 nP , out float nQ ) { float nR , nS , nT ; vec2 nU ; vec3 nV , nW ; nV = reflect ( - nO , nN ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:"nU = nM . xy + nN . xz * REFL_BUMP / jG ; nQ = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"nW = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nW = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"nR = dot ( nO , nN ) ; nQ *= max ( 1.0 - 1.0 / nR , 1.0 ) ; } else { nW = texture2D ( u_plane_reflection , nU ) . rgb ; fV ( nW ) ; }".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],
group:{type:"group",a:[{type:"textline",b:"nQ = u_mirror_factor ; nW = nP * textureCube ( u_mirrormap , nV ) . rgb ; fV ( nW ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nQ = u_reflect_factor ; nW = nP * vec3 ( 0.3 , 0.5 , 1.0 ) ; fV ( nW ) ;".split(" ")}]}}]},{type:"textline",b:"nV = normalize ( nV + nO ) ; nR = 1.0 - dot ( nO , nV ) ; nS = u_fresnel_params [ 3 ] ; nT = u_fresnel_params [ 2 ] ; nS = nS + ( 1.0 - nS ) * pow ( nR , nT ) ; nQ = min ( nQ * nS , 1.0 ) ; return nW ; } void main ( ) { vec4 nY ; vec2 nZ , n_ , oa ; float ob , oc , od , oe , of , og ; vec3 oh , oi , oj , ok , ol , om , on ; mat3 oo ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"oo = mat3 ( jE , nI , jD ) ;".split(" ")}]}}]},{type:"textline",b:"oh = normalize ( jD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"oo = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"oh = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"ob = jC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0","||","FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nZ = vec2 ( nJ . x , - nJ . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"nZ = vec2 ( jC . x , - jC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nZ","=","a",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"oi = vec3 ( 0.0 ) ; oj = texture2D ( u_normalmap0 , nZ * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; oi += oj ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"ok = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["ok","+=","oj",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"oj = texture2D ( u_normalmap0 , nZ * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; oi += oj ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["ok","+=","oj",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"oj = texture2D ( u_normalmap0 , nZ * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; oi += oj ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["ok","+=","oj",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"oj = texture2D ( u_normalmap0 , nZ * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; oi += oj ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",
a:[{type:"textline",b:["ok","+=","oj",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"oj = oo * ok ; if ( ! g ( oj , vec3 ( 0.0 ) ) ) oj = normalize ( oj ) ; ok = mix ( oh , oj , 0.2 ) ; ok = normalize ( ok ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"oh = mix ( oh , normalize ( oo * oi ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"oh = mix ( oh , normalize ( oo * oi ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"oh = normalize ( oh ) ;".split(" ")}]}}]},{type:"textline",b:"oj = normalize ( jB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"n_ = cI . xy / cI . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",
a:[{type:"textline",b:"oc = jG * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"od = u_diffuse_color . a ; nY = texture2DProj ( u_scene_depth , cI ) ; oe = cu ( nY ) ; of = max ( oe - jG , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"oa = n_ + oh . xz * u_refr_bump / jG ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],
group:{type:"group",a:[{type:"textline",b:"og = kf ( oe , oa , n_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"oa = n_ ; og = oe ;".split(" ")}]}}]},{type:"textline",b:"oe = max ( og - jG , 0.0 ) ; og = u_view_max_depth / ABSORB * oe ; if ( u_cam_water_depth < 0.0 ) oe = 0.0 ; else oe = min ( od * og , 1.0 ) ; og = u_view_max_depth / ABSORB * of ; od = min ( 15.0 * od * u_view_max_depth * of , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"og = u_view_max_depth / ABSORB * of ; if ( u_cam_water_depth > 0.0 ) od = min ( od * og , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"od *= min ( 5.0 * oc , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"od = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"oe = 1.0 - od ; oa = n_ + oh . xz * REFR_BUMP / jG ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",
a:[{type:"textline",b:"oi = texture2D ( u_refractmap , oa ) . rgb ; fV ( oi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"og = pow ( min ( nK . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; ol = mix ( u_shallow_water_col , u_diffuse_color . rgb , og ) ; og = pow ( min ( nK . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; ol = mix ( u_shore_water_col , ol , og ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"ol = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"og = max ( 1.0 - u_view_max_depth * of , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"og = 1.0 - od ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"of = max ( ob / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"om = normalize ( vec3 ( nK . r , 0.0 , nK . g ) ) ; om = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , om , 0.8 ) ) ; ob = 1.25 * max ( dot ( ok , om ) - 0.2 , 0.0 ) ; ob += max ( dot ( ok , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; og += ob * ( 1.0 - nK . b ) ; of *= ( 1.0 - 0.95 * pow ( nK . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"og += of ; og = min ( u_foam_factor * og , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"nY = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + nZ * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"ob = u_specular_params [ 0 ] ; oa = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; om = ob * u_specular_color ; ok = u_environment_energy * kq ( oh ) ; ok = u_ambient * ok ; ok = ok + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:"on = nX ( n_ , oh , oj , ok , of ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"on = nX ( vec2 ( 0.0 ) , oh , oj , ok , of ) ;".split(" ")}]}}]},{type:"textline",b:"ol = u_diffuse_intensity * ol ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO op = jc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ol , om , jC , oh , oj , oa , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gO op = jh ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ol ) ;".split(" ")}]}}]},{type:"textline",b:"ol = op . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"ob = max ( dot ( u_sun_direction , - jD ) + SSS_WIDTH , 0.0 ) * max ( dot ( - oj , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; ob = clamp ( SSS_STRENGTH * ob , 0.0 , 1.0 ) ; ol = mix ( ol , u_shallow_water_col , ob ) ; ol = mix ( ol , u_shore_water_col , ob ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ol = mix ( oi , ol , oe ) ;".split(" ")}]}}]},{type:"textline",b:"ol = mix ( ol , on , of ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"ob = mix ( nY . g , nY . r , max ( 4.0 * ( og - 0.75 ) , 0.0 ) ) ; ob = mix ( nY . b , ob , max ( 2.0 * og - 1.0 , 0.0 ) ) ; ob = mix ( 0.0 , ob , og ) ; ol = mix ( ol , ok , ob ) ;".split(" ")}]}}]},{type:"textline",
b:"ol += op . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"om = gm ( u_cube_fog , oj ) ; nY = vec4 ( om , u_fog_color_density . a ) ; fV ( nY . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nY","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"if ( u_cam_water_depth < 0.0 ) { gK ( ol , oc , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gg ( ol , oc , nY ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gg ( ol , oc , nY ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["fX","(","ol",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"od = max ( od , op . b . r ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["od","+=","ob",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"f_ ( ol , od ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"oh = fwidth ( nL ) ; oi = smoothstep ( vec3 ( 0.0 ) , oh * kr , nL ) ; oe = min ( min ( oi . x , oi . y ) , oi . z ) ; oe = clamp ( oe , 0.0 , 1.0 ) ; ol = mix ( u_wireframe_edge_color , ol , oe ) ; od = mix ( 1.0 , od , oe ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( ol , od ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",
b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},
{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 jB ; varying vec3 jC ;".split(" ")},{type:"condition",a:[{type:"if",c:"! GENERATED_MESH && ( NUM_NORMALMAPS > 0 || FOAM )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jD",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jE ; varying vec3 nI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nJ",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jG",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 kw ( in vec2 kr ) { float ks ; vec4 kt ; vec2 ku ; ku = 0.5 + vec2 ( ( kr . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( kr . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; kt = texture2D ( u_shore_dist_map , ku ) ; const vec2 kv = vec2 ( 1.0 / 255.0 , 1.0 ) ; ks = dot ( kt . ba , kv ) ; ku = normalize ( kt . rg * 2.0 - 1.0 ) ; return vec3 ( ku , ks ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void kI ( inout vec3 kx , in float ky , in vec3 kz ) { vec2 kA , kB , kC ; float kD , kE , kF , kG , kH ; kD = dx ( DST_NOISE_SCALE_0 * ( kx . xz + DST_NOISE_FREQ_0 * ky ) ) * dx ( DST_NOISE_SCALE_1 * ( kx . zx - DST_NOISE_FREQ_1 * ky ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"kE = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; kF = kz . b ; kG = sqrt ( kF ) ; kE = max ( kF , DIR_MIN_SHR_FAC ) * sin ( kG / kE + DIR_FREQ * ky ) ; kH = max ( dx ( DIR_NOISE_SCALE * ( kx . xz + DIR_NOISE_FREQ * ky ) ) , DIR_MIN_NOISE_FAC ) ; kE *= kH ; kH = WAVES_HEIGHT * mix ( kE , kD , max ( kG , DST_MIN_FAC ) ) ; kA = kz . rg ; kG = WAVES_HOR_FAC * kE * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - kF ) , 0.0 ) ; kA = kG * kA ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"kH = WAVES_HEIGHT * kD ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"kB = 2.0 * ( kx . xz - 0.1 * ky ) ; kC = 1.3 * ( kx . zx + 0.03 * ky ) ; kE = da ( 0.5 * kB ) . x + da ( 0.5 * kC ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"kx . xz += kA ; kE *= kF ;".split(" ")}]}}]},{type:"textline",b:"kH += SMALL_WAVES_FAC * kE ;".split(" ")}]}}]},{type:"textline",
b:"kx . y += kH ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 kJ , nM ; vec2 nN ; float nO , nP , nQ ; vec3 nR , nS , nT , nU ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) nL = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) nL = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) nL = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["nR","=","a_position",";"]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"nO = abs ( nR . y ) ; nN = u_camera_eye . xz - mod ( u_camera_eye . xz , nO ) ; nR . y = WATER_LEVEL ; nR . xz += nN ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",">","0","||","FOAM"],group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d nV = av ( nR , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DYNAMIC","&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"nJ = nV . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"nK = kw ( nV . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nP = length ( u_wind ) ; nQ = u_time ; nQ *= nP ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",
b:["nP","=","nO",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nP","=","0.1",";"]}]}}]},{type:"textline",b:"nR = nV . a + vec3 ( nP , 0.0 , 0.0 ) ; nS = nV . a + vec3 ( 0.0 , 0.0 , nP ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"nT = kw ( nR . xz ) ; nU = kw ( nS . xz ) ; kI ( nR , nQ , nT ) ; kI ( nS , nQ , nU ) ; kI ( nV . a , nQ , nK ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kI ( nR , nQ , vec3 ( 0.0 ) ) ; kI ( nS , nQ , vec3 ( 0.0 ) ) ; kI ( nV . a , nQ , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { nV . a . y = WATER_LEVEL - 1.0 ; nR . y = nV . a . y ; nS . y = nV . a . y ; }".split(" ")}]}}]},{type:"textline",b:"nT = normalize ( nR - nV . a ) ; nU = normalize ( nS - nV . a ) ; jD = normalize ( cross ( nU , nT ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"jE = nU ; nI = cross ( jD , jE ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"nO = dot ( jD , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; nP = clamp ( 0.8 - nO , 0.0 , 1.0 ) ; jD = mix ( jD , vec3 ( 0.0 , 1.0 , 0.0 ) , nP ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"jC = nV . a ; jB = u_camera_eye - nV . a ; kJ = u_view_matrix * vec4 ( nV . a , 1.0 ) ; nM = u_proj_matrix * kJ ;".split(" ")},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:"nQ = nM . x ; nO = nM . y ; nP = nM . w ; cI . x = ( nQ + nP ) / 2.0 ; cI . y = ( nO + nP ) / 2.0 ; cI . z = nP ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTION_TYPE == REFL_PLANE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"jG = - kJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","nM",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",
name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 nL ; const float kr = 1.0 ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 ks = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 ks = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 kt = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 ku = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 kv = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float kw , kx ; vec3 ky , kz ; ky = vec3 ( 0.0 ) ; kw = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"kz = sign ( nL - vec3 ( 0.02 * kr ) ) ; if ( kz . x < 0.0 || kz . y < 0.0 || kz . z < 0.0 ) { ky = ks ; kw = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"kz = sign ( nL - vec3 ( 0.02 * kr ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( kz . x < 0.0 || kz . y < 0.0 || kz . z < 0.0 ) ky = u_wireframe_edge_color ; else ky = kv ; kw = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( kz . x < 0.0 || kz . y < 0.0 || kz . z < 0.0 ) kw = 1.0 ; else kw = 0.0 ; ky = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( kz . x < 0.0 || kz . y < 0.0 || kz . z < 0.0 ) ky = u_wireframe_edge_color ; else if ( gl_FrontFacing ) ky = kt ; else ky = ku ; kw = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"kz = fwidth ( nL ) ; kz = smoothstep ( vec3 ( 0.0 ) , kz * kr , nL ) ; kx = min ( min ( kz . x , kz . y ) , kz . z ) ; kx = clamp ( kx , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { ky = vec3 ( mix ( u_wireframe_edge_color , kv , kx ) ) ; kw = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { ky = u_wireframe_edge_color ; kw = mix ( 1.0 , 0.0 , kx ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) ky = mix ( u_wireframe_edge_color , kt , kx ) ; else ky = mix ( u_wireframe_edge_color , ku , kx ) ; kw = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["fX","(","ky",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"f_ ( ky , kw ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ky , kw ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["varying","vec3","nL",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 kr ; mat4 ks ; vec3 kt , ku , kv , kw , kx ; if ( a_polyindex == 0.0 ) nL = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) nL = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) nL = vec3 ( 0.0 , 0.0 , 1.0 ) ; kt = a_position ; ku = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d ky = av ( kt , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kt = mix ( kt , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"kv = vec3 ( 0.0 ) ; kw = vec3 ( 0.0 ) ; bv ( kt , kv , kw , ku ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["kv","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kv = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d ky = fE ( kt , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , kv , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"kw = ( u_model_matrix * vec4 ( kv , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"ks = ao ( u_camera_eye , kw , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ks = ai ( u_camera_eye , kw , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"kx = ( u_model_matrix * vec4 ( kv , 1.0 ) ) . xyz ; ks = ks * aa ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kx ) ;".split(" ")}]}}]},{type:"textline",b:"d ky = av ( kt - kv , kv , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ks ) ; ky . b = kw ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d ky = av ( kt , kv , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cj ( ky . a , ky . b , ku ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kr = u_view_matrix * vec4 ( ky . a , 1.0 ) ; gl_Position = u_proj_matrix * kr ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 kr , ks ; kr = texture2D ( u_sampler_left , a ) ; ks = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( kr [ 0 ] , ks [ 1 ] , ks [ 2 ] , kr [ 3 ] + ks [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 ku ( float kr , float ks ) { vec2 kt ; kt = a + vec2 ( kr , ks ) * u_texel_size ; return texture2D ( u_color , kt ) ; } float ky ( vec4 kv ) { float kw ; vec3 kx ; kx = vec3 ( 0.299 , 0.587 , 0.114 ) ; kw = dot ( kv . rgb , kx ) ; return kw ; } vec4 nN ( ) { vec2 kz ; float kA , kB , kC , kD , kE , kF ; vec4 kG , kH , kI , kJ , nM ; kG = ku ( - 1.0 , - 1.0 ) ; kH = ku ( 1.0 , - 1.0 ) ; kI = ku ( - 1.0 , 1.0 ) ; kJ = ku ( 1.0 , 1.0 ) ; nM = ku ( 0.0 , 0.0 ) ; kA = ky ( kG ) ; kB = ky ( kH ) ; kC = ky ( kI ) ; kD = ky ( kJ ) ; kE = ky ( nM ) ; kF = min ( kE , min ( min ( kA , kB ) , min ( kC , kD ) ) ) ; kE = max ( kE , max ( max ( kA , kB ) , max ( kC , kD ) ) ) ; kz . x = - ( ( kA + kB ) - ( kC + kD ) ) ; kz . y = ( ( kA + kC ) - ( kB + kD ) ) ; kA = max ( ( kA + kB + kC + kD ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; kB = 1.0 / ( min ( abs ( kz . x ) , abs ( kz . y ) ) + kA ) ; kz = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , kz * kB ) ) * u_texel_size ; kG = 0.5 * ( texture2D ( u_color , a + kz * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + kz * ( 2.0 / 3.0 - 0.5 ) ) ) ; kH = kG * 0.5 + 0.25 * ( texture2D ( u_color , a + kz * - 0.5 ) + texture2D ( u_color , a + kz * 0.5 ) ) ; kC = ky ( kH ) ; if ( ( kC < kF ) || ( kC > kE ) ) return kG ; else return kH ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 or ( ) { bool nO , nP , nQ , nR , nS ; float nT , nU , nV , nW , nX , nY , nZ , n_ , oa , ob , oc , od , oe , of , og ; vec4 oh , oi , oj , ok , ol ; vec2 om , on , oo , op , oq ; om . x = a . x ; om . y = a . y ; oh = texture2D ( u_color , om ) ; oi = ku ( 0.0 , 1.0 ) ; oj = ku ( 1.0 , 0.0 ) ; ok = ku ( 0.0 , - 1.0 ) ; ol = ku ( - 1.0 , 0.0 ) ; nT = ky ( oi ) ; nU = ky ( oj ) ; nV = ky ( ok ) ; nW = ky ( ol ) ; nX = ky ( oh ) ; nY = max ( nT , nX ) ; nZ = min ( nT , nX ) ; nY = max ( nU , nY ) ; nZ = min ( nU , nZ ) ; n_ = max ( nV , nW ) ; oa = min ( nV , nW ) ; n_ = max ( n_ , nY ) ; nY = min ( oa , nZ ) ; oa = n_ * FXAA_QUALITY_EDGE_THRESHOLD ; nZ = n_ - nY ; n_ = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , oa ) ; nO = nZ < n_ ; if ( nO ) return oh ; oi = ku ( - 1.0 , - 1.0 ) ; oj = ku ( 1.0 , 1.0 ) ; ok = ku ( 1.0 , - 1.0 ) ; ol = ku ( - 1.0 , 1.0 ) ; nY = ky ( oi ) ; oa = ky ( oj ) ; n_ = ky ( ok ) ; ob = ky ( ol ) ; oc = nV + nT ; od = nW + nU ; nZ = 1.0 / nZ ; oe = oc + od ; oc = ( - 2.0 * nX ) + oc ; od = ( - 2.0 * nX ) + od ; of = n_ + oa ; n_ = nY + n_ ; og = ( - 2.0 * nU ) + of ; n_ = ( - 2.0 * nV ) + n_ ; nY = nY + ob ; ob = ob + oa ; oa = ( abs ( oc ) * 2.0 ) + abs ( og ) ; oc = ( abs ( od ) * 2.0 ) + abs ( n_ ) ; og = ( - 2.0 * nW ) + nY ; od = ( - 2.0 * nT ) + ob ; n_ = abs ( og ) + oa ; ob = abs ( od ) + oc ; og = nY + of ; oa = u_texel_size . x ; nO = n_ >= ob ; od = oe * 2.0 + og ; if ( ! nO ) nV = nW ; if ( ! nO ) nT = nU ; if ( nO ) oa = u_texel_size . y ; oc = ( od * ( 1.0 / 12.0 ) ) - nX ; nY = nV - nX ; of = nT - nX ; n_ = nV + nX ; ob = nT + nX ; nP = abs ( nY ) >= abs ( of ) ; oe = max ( abs ( nY ) , abs ( of ) ) ; if ( nP ) oa = - oa ; og = clamp ( abs ( oc ) * nZ , 0.0 , 1.0 ) ; on . x = om . x ; on . y = om . y ; oo . x = ( ! nO ) ? 0.0 : u_texel_size . x ; oo . y = ( nO ) ? 0.0 : u_texel_size . y ; if ( ! nO ) on . x += oa * 0.5 ; if ( nO ) on . y += oa * 0.5 ; op . x = on . x - oo . x ; op . y = on . y - oo . y ; oq . x = on . x + oo . x ; oq . y = on . y + oo . y ; nW = ( ( - 2.0 ) * og ) + 3.0 ; nU = ky ( texture2D ( u_color , op ) ) ; od = og * og ; nV = ky ( texture2D ( u_color , oq ) ) ; if ( ! nP ) n_ = ob ; nT = oe * 1.0 / 4.0 ; nY = nX - n_ * 0.5 ; of = nW * od ; nP = nY < 0.0 ; nU -= n_ * 0.5 ; nV -= n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 1.5 ; if ( ! nQ ) op . y -= oo . y * 1.5 ; nS = ( ! nQ ) || ( ! nR ) ; if ( ! nR ) oq . x += oo . x * 1.5 ; if ( ! nR ) oq . y += oo . y * 1.5 ; if ( nS ) { if ( ! nQ ) nU = ky ( texture2D ( u_color , op . xy ) ) ; if ( ! nR ) nV = ky ( texture2D ( u_color , oq . xy ) ) ; if ( ! nQ ) nU = nU - n_ * 0.5 ; if ( ! nR ) nV = nV - n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 2.0 ; if ( ! nQ ) op . y -= oo . y * 2.0 ; nS = ( ! nQ ) || ( ! nR ) ; if ( ! nR ) oq . x += oo . x * 2.0 ; if ( ! nR ) oq . y += oo . y * 2.0 ; if ( nS ) { if ( ! nQ ) nU = ky ( texture2D ( u_color , op . xy ) ) ; if ( ! nR ) nV = ky ( texture2D ( u_color , oq . xy ) ) ; if ( ! nQ ) nU = nU - n_ * 0.5 ; if ( ! nR ) nV = nV - n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 2.0 ; if ( ! nQ ) op . y -= oo . y * 2.0 ; nS = ( ! nQ ) || ( ! nR ) ; if ( ! nR ) oq . x += oo . x * 2.0 ; if ( ! nR ) oq . y += oo . y * 2.0 ; if ( nS ) { if ( ! nQ ) nU = ky ( texture2D ( u_color , op . xy ) ) ; if ( ! nR ) nV = ky ( texture2D ( u_color , oq . xy ) ) ; if ( ! nQ ) nU = nU - n_ * 0.5 ; if ( ! nR ) nV = nV - n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 4.0 ; if ( ! nQ ) op . y -= oo . y * 4.0 ; nS = ( ! nQ ) || ( ! nR ) ; if ( ! nR ) oq . x += oo . x * 4.0 ; if ( ! nR ) oq . y += oo . y * 4.0 ; if ( nS ) { if ( ! nQ ) nU = ky ( texture2D ( u_color , op . xy ) ) ; if ( ! nR ) nV = ky ( texture2D ( u_color , oq . xy ) ) ; if ( ! nQ ) nU = nU - n_ * 0.5 ; if ( ! nR ) nV = nV - n_ * 0.5 ; nQ = abs ( nU ) >= nT ; nR = abs ( nV ) >= nT ; if ( ! nQ ) op . x -= oo . x * 2.0 ; if ( ! nQ ) op . y -= oo . y * 2.0 ; if ( ! nR ) oq . x += oo . x * 2.0 ; if ( ! nR ) oq . y += oo . y * 2.0 ; } } } } oc = om . x - op . x ; nZ = oq . x - om . x ; if ( ! nO ) oc = om . y - op . y ; if ( ! nO ) nZ = oq . y - om . y ; nS = ( nU < 0.0 ) != nP ; og = ( nZ + oc ) ; nQ = ( nV < 0.0 ) != nP ; ob = 1.0 / og ; nR = oc < nZ ; oe = min ( oc , nZ ) ; nP = nR ? nS : nQ ; nX = of * of ; nW = ( oe * ( - ob ) ) + 0.5 ; od = nX * FXAA_QUALITY_SUBPIX ; nY = nP ? nW : 0.0 ; n_ = max ( nY , od ) ; if ( ! nO ) om . x += n_ * oa ; if ( nO ) om . y += n_ * oa ; return texture2D ( u_color , om ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = nN ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = or ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 kr ; vec2 ks , kt ; ks = vec2 ( 0.0 , 0.0 ) ; kt = u_texel_size ; kr = texture2D ( u_color , a ) ; gl_FragColor = kr * 0.0875447373698 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0858112354248 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0808139781061 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0731235112908 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0635705267419 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0530985673112 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0426125984122 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0328565115809 ; ks += kt ; gl_FragColor += texture2D ( u_color , a + ks ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - ks ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * kr , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 kr , ks ; kr = texture2D ( u_main , a ) ; ks = texture2D ( u_bloom , a ) ; kr = kr ; kr += ks ; gl_FragColor = vec4 ( kr . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { float kr ; vec3 ks , kt ; vec4 ku ; ku = texture2D ( u_color , a ) ; ks = ku . rgb ; if ( u_brightness < 0.0 ) ks = ks * ( 1.0 + u_brightness ) ; else ks = ks + ( ( 1.0 - ks ) * u_brightness ) ; ks = ( ks - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; ks *= u_exposure ; kt = vec3 ( 0.299 , 0.587 , 0.114 ) ; kr = dot ( ks , kt ) ; ks = mix ( vec3 ( kr ) , ks , u_saturation ) ; gl_FragColor = vec4 ( ks , ku . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cq ( clamp ( nS ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { float nT , nU ; vec4 nV , nW ; nV = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { nT = nS ( u_depth , a , u_camera_range ) ; nT *= u_view_max_depth ; if ( nT < u_dof_dist ) nU = ( u_dof_dist - nT ) / u_dof_front ; else nU = ( nT - u_dof_dist ) / u_dof_rear ; nU = clamp ( nU , 0.0 , 1.0 ) ; nW = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nV , nW , nU ) ; } else gl_FragColor = nV ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 a ; void main ( ) { float kr ; vec4 ks , kt , ku ; ks = texture2D ( u_src_color , a ) ; kt = texture2D ( u_glow_mask_small , a ) ; ku = texture2D ( u_glow_mask_large , a ) ; gl_FragColor = ks ; if ( ku . a != 0.0 ) { kr = u_glow_mask_large_coeff * ku . a ; kr = clamp ( kr , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , ku . rgb / ku . a , kr ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , kr ) ; } if ( kt . a != 0.0 ) { kr = u_glow_mask_small_coeff * kt . a ; kr = clamp ( kr , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , kt . rgb / kt . a , kr ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , kr ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nT ; varying vec2 nU ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nV ; void main ( ) { vec4 nW ; float nX , nY , nZ , n_ , oa ; vec2 ob , oc , od ; ob = ( nV . xy - a ) ; nX = length ( ob ) ; ob = u_radial_blur_step * ob / nX ; nY = nX / u_radial_blur_step ; ob *= min ( nY , STEPS_PER_PASS ) / STEPS_PER_PASS ; nY = max ( nY , STEPS_PER_PASS ) ; oc = a ; nZ = 0.0 ; for ( float oe = 0.0 ; oe < STEPS_PER_PASS ; oe += 1.0 ) { if ( oe <= nY ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"n_ = nS ( u_input , oc , u_camera_range ) ; nZ += max ( ( 1.0 - pow ( nX , 0.3 ) ) * step ( 0.9 , n_ ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nW = texture2D ( u_input , oc ) ; nZ += cu ( nW ) ;".split(" ")}]}}]},{type:"textline",b:"} oc += ob ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"od = a + nU ; oa = da ( vec2 ( 2.5 * ( od . x ) , 2.5 * ( od . y ) + 1.0 * u_time ) ) . x + 0.75 * da ( vec2 ( 5.0 * ( od . x ) - 0.66 * u_time , 5.0 * ( od . y ) + 0.66 * u_time ) ) . x + 0.5 * dx ( vec2 ( 7.5 * ( od . x ) + 0.33 * u_time , 7.5 * ( od . y ) - 0.33 * u_time ) ) ; oa *= clamp ( 1.2 - sqrt ( 0.2 * nX ) , 0.0 , 1.0 ) * nT ; nZ = max ( oa , nZ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cq ( nZ / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]={type:"group",
a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float nT ; varying vec2 nU ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nV ; void main ( ) { float kr , ks ; vec3 kt ; a = a_bb_vertex + 0.5 ; kt = normalize ( u_sun_direction ) ; nV = u_proj_matrix * u_view_matrix * vec4 ( kt , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { nT = 1.0 ; kt = vec3 ( 0.0 , 1.0 , 0.0 ) ; kt = j ( u_camera_quat , kt ) ; kt = normalize ( kt ) ; kr = dot ( kt , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; ks = atan ( kt . x , kt . z ) ; nU = vec2 ( - ks , acos ( kr ) ) ; } else { nT = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nV . xy = 0.5 * ( nV . xy / nV . w + 1.0 ) ; nV += 99999.0 * step ( nV . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { float kr ; vec3 ks ; vec4 kt ; kt = texture2D ( u_main , a ) ; ks = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; fV ( kt . rgb ) ; kr = cu ( texture2D ( u_god_rays , a ) ) ; ks = kt . rgb + u_god_rays_intensity * vec3 ( kr ) * ks ; fX ( ks ) ; gl_FragColor . rgb = ks ; gl_FragColor . a = kt . a ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { float kr ; vec4 ks ; ks = texture2D ( u_input , a ) ; kr = dot ( ks . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( kr ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float kr , ks ; ks = 0.0 ; for ( float kt = 0.025 ; kt < 1.0 ; kt += 0.05 ) for ( float ku = 0.025 ; ku < 1.0 ; ku += 0.05 ) { kr = max ( texture2D ( u_input , vec2 ( kt , ku ) ) . r , 0.01 ) ; ks += log ( kr ) ; } ks = exp ( ks / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( ks ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nW ; void main ( ) { vec4 nX ; float nY , nZ ; nY = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; nZ = texture2D ( u_luminance , a ) . r ; nX = texture2D ( u_main , a ) ; nZ = nZ / nY ; nY = u_bloom_edge_lum ; gl_FragColor = nX * max ( nZ - nY , 0.0 ) * nW ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nW ; const vec3 kr = vec3 ( 0.0 , 1.0 , 0.0 ) ; void kz ( in vec4 ks , in vec3 kt , out vec3 ku ) { float kv , kw , kx , ky ; kv = ks . w * kt . x + ks . y * kt . z - ks . z * kt . y ; kw = ks . w * kt . y + ks . z * kt . x - ks . x * kt . z ; kx = ks . w * kt . z + ks . x * kt . y - ks . y * kt . x ; ky = - ks . x * kt . x - ks . y * kt . y - ks . z * kt . z ; ku . x = kv * ks . w - ky * ks . x - kw * ks . z + kx * ks . y ; ku . y = kw * ks . w - ky * ks . y - kx * ks . x + kv * ks . z ; ku . z = kx * ks . w - ky * ks . z - kv * ks . y + kw * ks . x ; } void main ( ) { vec3 kA ; a = 2.0 * a_position ; kz ( u_camera_quat , kr , kA ) ; nW = dot ( - kA , u_sun_direction ) * u_bloom_key ; nW *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; float kr = 0.0042 ; void main ( ) { vec4 ks , kt , ku , kv ; ks = texture2D ( u_mb_tex_curr , a ) ; kt = texture2D ( u_mb_tex_accum , a ) ; if ( length ( ks - kt ) > BLUR_DECAY_THRESHOLD ) { ku = ( 1.0 - u_motion_blur_exp ) * ks + u_motion_blur_exp * kt ; ku = ku - kt ; kv = ks - kt ; kv = min ( max ( abs ( ku ) , vec4 ( kr ) ) , abs ( kv ) ) * sign ( ku ) ; gl_FragColor = kt + kv ; } else { gl_FragColor = ks ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 a ; void main ( ) { vec3 kr ; float ks ; vec4 kt , ku , kv ; kt = texture2D ( u_outline_src , a ) ; gl_FragColor = kt ; if ( u_draw_outline != 0.0 ) { ku = texture2D ( u_outline_mask , a ) ; kv = texture2D ( u_outline_mask_blurred , a ) ; ks = kv . a - ku . a ; if ( ks != 0.0 ) { ks = smoothstep ( 0.0 , 1.0 , kv . a ) ; if ( ku . a == 0.0 ) { kr = u_outline_color ; fX ( kr ) ; kv = vec4 ( clamp ( kr , 0.0 , 1.0 ) , ks ) ; gl_FragColor = mix ( kt , kv , ks ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 kr , ks ; vec4 kt ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( kt . r + kt . g + kt . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"kr = vec2 ( 0.0 , 0.0 ) ; ks = u_texel_size ; kt = texture2D ( u_color , a ) ; gl_FragColor = kt * 0.2270270270 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * 0.1945945946 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * 0.1945945946 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * 0.1216216216 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * 0.1216216216 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * 0.0540540541 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * 0.0540540541 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * 0.0162162162 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_GLOW_BLUR || POST_EFFECT == POST_EFFECT_Y_GLOW_BLUR".split(" "),group:{type:"group",a:[{type:"textline",b:"kr = vec2 ( 0.0 , 0.0 ) ; ks = u_texel_size ; kt = texture2D ( u_color , a ) ; gl_FragColor = kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.152507 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.141763 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.141763 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.113861 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.113861 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.079019 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.079019 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.047383 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.047383 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.024549 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.024549 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.01099 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.01099 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.00425 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.00425 ; kr += ks ; kt = texture2D ( u_color , a + kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.00142 ; kt = texture2D ( u_color , a - kr ) ; gl_FragColor += kt * ( 1.0 - step ( 0.0 , - kt . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"ks = u_texel_size ; kt = texture2D ( u_color , a ) ; gl_FragColor = kt ; if ( kt . a == 0.0 ) { kt = texture2D ( u_color , a + ks ) ; if ( kt . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , kt . a ) ; else { kt = texture2D ( u_color , a - ks ) ; if ( kt . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , kt . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 a ; void main ( ) { a = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nX",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nY ; varying vec4 nZ ; varying vec4 n_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","oa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 og ( vec2 ob , sampler2D oc ) { float od , oe , of ; od = texture2D ( oc , ob ) . r ; oe = texture2D ( oc , nY . xy ) . r ; of = texture2D ( oc , nY . zw ) . r ; return vec3 ( od , oe , of ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 ol ( vec2 oh , sampler2D oi ) { vec2 oj ; vec3 ok ; ok = og ( oh , oi ) ; oj = abs ( ok . xx - ok . yz ) ; oj = step ( SMAA_PREDICATION_THRESHOLD , oj ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * oj ) ; }".split(" ")}]}}]},{type:"textline",b:"void op ( bvec2 om , inout vec2 on , vec2 oo ) { if ( om . x ) on . x = oo . x ; if ( om . y ) on . y = oo . y ; } void op ( bvec4 oq , inout vec4 or , vec4 os ) { op ( oq . xy , or . xy , os . xy ) ; op ( oq . zw , or . zw , os . zw ) ; } vec2 ou ( vec2 ot ) { return sign ( ot ) * floor ( abs ( ot ) + .5 ) ; } vec4 ou ( vec4 ov ) { return sign ( ov ) * floor ( abs ( ov ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oI ( vec2 ow , sampler2D ox".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","oy"]}]}}]},{type:"textline",b:") { vec4 oz ; float oA , oB , oC , oD , oE ; vec3 oF ; vec2 oG , oH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"oG = ol ( ow , oy ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"oG = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"oF = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; oA = dot ( texture2D ( ox , ow ) . rgb , oF ) ; oB = dot ( texture2D ( ox , nY . xy ) . rgb , oF ) ; oC = dot ( texture2D ( ox , nY . zw ) . rgb , oF ) ; oz . xy = abs ( oA - vec2 ( oB , oC ) ) ; oG = step ( oG , oz . xy ) ; if ( dot ( oG , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; oD = dot ( texture2D ( ox , nZ . xy ) . rgb , oF ) ; oE = dot ( texture2D ( ox , nZ . zw ) . rgb , oF ) ; oz . zw = abs ( oA - vec2 ( oD , oE ) ) ; oH = max ( oz . xy , oz . zw ) ; oA = dot ( texture2D ( ox , n_ . xy ) . rgb , oF ) ; oD = dot ( texture2D ( ox , n_ . zw ) . rgb , oF ) ; oz . zw = abs ( vec2 ( oB , oC ) - vec2 ( oA , oD ) ) ; oH = max ( oH . xy , oz . zw ) ; oE = max ( oH . x , oH . y ) ; oG . xy *= step ( oE , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * oz . xy ) ; return oG ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oK ( vec2 oJ ) { oJ . r = oJ . r * abs ( 5.0 * oJ . r - 5.0 * 0.75 ) ; return ou ( oJ ) ; } vec4 oK ( vec4 oL ) { oL . rb = oL . rb * abs ( 5.0 * oL . rb - 5.0 * 0.75 ) ; return ou ( oL ) ; } vec2 oT ( sampler2D oM , vec2 oN , vec2 oO , out vec2 oP ) { vec3 oQ ; vec4 oR ; oR = vec4 ( oN , - 1.0 , 1.0 ) ; oQ = vec3 ( u_texel_size , 1.0 ) ; for ( int oS = 0 ; oS < SMAA_MAX_SEARCH_STEPS_DIAG ; oS ++ ) { if ( oR . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oR . w > 0.9 ) { oR . xyz += oQ * vec3 ( oO , 1.0 ) ; oP = texture2D ( oM , oR . xy , 0.0 ) . rg ; oR . w = dot ( oP , vec2 ( 0.5 , 0.5 ) ) ; } } return oR . zw ; } vec2 pa ( sampler2D oU , vec2 oV , vec2 oW , out vec2 oX ) { vec3 oY ; vec4 oZ ; oZ = vec4 ( oV , - 1.0 , 1.0 ) ; oZ . x += 0.25 * u_texel_size . x ; oY = vec3 ( u_texel_size , 1.0 ) ; for ( int o_ = 0 ; o_ < SMAA_MAX_SEARCH_STEPS_DIAG ; o_ ++ ) { if ( oZ . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oZ . w > 0.9 ) { oZ . xyz = oY * vec3 ( oW , 1.0 ) + oZ . xyz ; oX = texture2D ( oU , oZ . xy , 0.0 ) . rg ; oX = oK ( oX ) ; oZ . w = dot ( oX , vec2 ( 0.5 , 0.5 ) ) ; } } return oZ . zw ; } vec2 pg ( sampler2D pb , vec2 pc , vec2 pd , float pe ) { vec2 pf ; pf = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * pd + pc ; pf = SMAA_AREATEX_PIXEL_SIZE * pf + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pf . x += 0.5 ; pf . y += SMAA_AREATEX_SUBTEX_SIZE * pe ; return texture2D ( pb , pf , 0.0 ) . rg ; } vec2 ps ( sampler2D ph , sampler2D pi , vec2 pj , vec2 pk , vec4 pl ) { vec4 pm , pn , po ; vec2 pp , pq , pr ; pp = vec2 ( 0.0 , 0.0 ) ; if ( pk . r > 0.0 ) { pm . xz = oT ( ph , pj , vec2 ( - 1.0 , 1.0 ) , pq ) ; pm . x += float ( pq . y > 0.9 ) ; } else pm . xz = vec2 ( 0.0 , 0.0 ) ; pm . yw = oT ( ph , pj , vec2 ( 1.0 , - 1.0 ) , pq ) ; if ( pm . x + pm . y > 2.0 ) { pn = vec4 ( - pm . x + 0.25 , pm . x , pm . y , - pm . y - 0.25 ) * u_texel_size . xyxy + pj . xyxy ; po . xy = texture2D ( ph , pn . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; po . zw = texture2D ( ph , pn . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; po . yxwz = oK ( po . xyzw ) ; pr = vec2 ( 2.0 , 2.0 ) * po . xz + po . yw ; op ( bvec2 ( step ( 0.9 , pm . zw ) ) , pr , vec2 ( 0.0 , 0.0 ) ) ; pp += pg ( pi , pm . xy , pr , pl . z ) ; } pm . xz = pa ( ph , pj , vec2 ( - 1 , - 1 ) , pq ) ; if ( texture2D ( ph , pj + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { pm . yw = pa ( ph , pj , vec2 ( 1 , 1 ) , pq ) ; pm . y += float ( pq . y > 0.9 ) ; } else pm . yw = vec2 ( 0.0 , 0.0 ) ; if ( pm . x + pm . y > 2.0 ) { pn = vec4 ( - pm . x , - pm . x , pm . y , pm . y ) * u_texel_size . xyxy + pj . xyxy ; po . x = texture2D ( ph , pn . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; po . y = texture2D ( ph , pn . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; po . zw = texture2D ( ph , pn . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; pr = vec2 ( 2.0 , 2.0 ) * po . xz + po . yw ; op ( bvec2 ( step ( 0.9 , pm . zw ) ) , pr , vec2 ( 0 , 0 ) ) ; pp += pg ( pi , pm . xy , pr , pl . w ) . gr ; } return pp ; }".split(" ")}]}}]},
{type:"textline",b:"float py ( sampler2D pt , vec2 pu , float pv ) { vec2 pw , px ; pw = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; px = SMAA_SEARCHTEX_SIZE * vec2 ( pv , 1.0 ) ; pw += vec2 ( - 1.0 , 1.0 ) ; px += vec2 ( 0.5 , - 0.5 ) ; pw *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; px *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( pt , pw * pu + px , 0.0 ) . r ; } float pG ( sampler2D pz , sampler2D pA , vec2 pB , float pC ) { float pD ; vec2 pE ; pE = vec2 ( 0.0 , 1.0 ) ; for ( int pF = 0 ; pF < SMAA_MAX_SEARCH_STEPS ; pF ++ ) { if ( pB . x > pC && pE . g > 0.8281 && pE . r == 0.0 ) { pE = texture2D ( pz , pB , 0.0 ) . rg ; pB = - vec2 ( 2.0 , 0.0 ) * u_texel_size + pB ; } } pD = - ( 255.0 / 127.0 ) * py ( pA , pE , 0.0 ) + 3.25 ; return u_texel_size . x * pD + pB . x ; } float pO ( sampler2D pH , sampler2D pI , vec2 pJ , float pK ) { float pL ; vec2 pM ; pM = vec2 ( 0.0 , 1.0 ) ; for ( int pN = 0 ; pN < SMAA_MAX_SEARCH_STEPS ; pN ++ ) { if ( pJ . x < pK && pM . g > 0.8281 && pM . r == 0.0 ) { pM = texture2D ( pH , pJ , 0.0 ) . rg ; pJ = vec2 ( 2.0 , 0.0 ) * u_texel_size + pJ ; } } pL = - ( 255.0 / 127.0 ) * py ( pI , pM , 0.5 ) + 3.25 ; return - u_texel_size . x * pL + pJ . x ; } float pW ( sampler2D pP , sampler2D pQ , vec2 pR , float pS ) { float pT ; vec2 pU ; pU = vec2 ( 1.0 , 0.0 ) ; for ( int pV = 0 ; pV < SMAA_MAX_SEARCH_STEPS ; pV ++ ) { if ( pR . y > pS && pU . r > 0.8281 && pU . g == 0.0 ) { pU = texture2D ( pP , pR , 0.0 ) . rg ; pR = - vec2 ( 0.0 , 2.0 ) * u_texel_size + pR ; } } pT = - ( 255.0 / 127.0 ) * py ( pQ , pU . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pT + pR . y ; } float qd ( sampler2D pX , sampler2D pY , vec2 pZ , float p_ ) { float qa ; vec2 qb ; qb = vec2 ( 1.0 , 0.0 ) ; for ( int qc = 0 ; qc < SMAA_MAX_SEARCH_STEPS ; qc ++ ) { if ( pZ . y < p_ && qb . r > 0.8281 && qb . g == 0.0 ) { qb = texture2D ( pX , pZ , 0.0 ) . rg ; pZ = vec2 ( 0.0 , 2.0 ) * u_texel_size + pZ ; } } qa = - ( 255.0 / 127.0 ) * py ( pY , qb . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * qa + pZ . y ; } vec2 qk ( sampler2D qe , vec2 qf , float qg , float qh , float qi ) { vec2 qj ; qj = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * ou ( 4.0 * vec2 ( qg , qh ) ) + qf ; qj = SMAA_AREATEX_PIXEL_SIZE * qj + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; qj . y = SMAA_AREATEX_SUBTEX_SIZE * qi + qj . y ; return texture2D ( qe , qj , 0.0 ) . rg ; } void qr ( sampler2D ql , inout vec2 qm , vec4 qn , vec2 qo ) { vec2 qp , qq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qp = step ( qo . xy , qo . yx ) ; qq = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * qp ; qq /= qp . x + qp . y ; qp = vec2 ( 1.0 , 1.0 ) ; qp . x -= qq . x * texture2D ( ql , qn . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; qp . x -= qq . y * texture2D ( ql , qn . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; qp . y -= qq . x * texture2D ( ql , qn . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; qp . y -= qq . y * texture2D ( ql , qn . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; qm *= clamp ( qp , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void qy ( sampler2D qs , inout vec2 qt , vec4 qu , vec2 qv ) { vec2 qw , qx ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qw = step ( qv . xy , qv . yx ) ; qx = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * qw ; qx /= qw . x + qw . y ; qw = vec2 ( 1.0 , 1.0 ) ; qw . x -= qx . x * texture2D ( qs , qu . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; qw . x -= qx . y * texture2D ( qs , qu . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; qw . y -= qx . x * texture2D ( qs , qu . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; qw . y -= qx . y * texture2D ( qs , qu . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; qt *= clamp ( qw , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qM ( vec2 qz , vec2 qA , sampler2D qB , sampler2D qC , sampler2D qD , vec4 qE ) { float qF , qG ; vec3 qH ; vec2 qI , qJ , qK ; vec4 qL ; qL = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; qI = texture2D ( qB , qz ) . rg ; if ( qI . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",
b:"qL . rg = ps ( qB , qC , qz , qI , qE ) ; if ( qL . r == - qL . g ) {".split(" ")}]}}]},{type:"textline",b:"; qH . x = pG ( qB , qD , nY . xy , n_ . x ) ; qH . y = nZ . y ; qJ . x = qH . x ; qF = texture2D ( qB , qH . xy , 0.0 ) . r ; qH . z = pO ( qB , qD , nY . zw , n_ . y ) ; qJ . y = qH . z ; qJ = abs ( ou ( qJ / u_texel_size . xx - qA . xx ) ) ; qK = sqrt ( qJ ) ; qG = texture2D ( qB , qH . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qL . rg = qk ( qC , qK , qF , qG , qE . y ) ; qH . y = qz . y ; qr ( qB , qL . rg , qH . xyzy , qJ ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qI . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qI . r > 0.0 ) { ; qH . y = pW ( qB , qD , nZ . xy , n_ . z ) ; qH . x = nY . x ; qK . x = qH . y ; qF = texture2D ( qB , qH . xy , 0.0 ) . g ; qH . z = qd ( qB , qD , nZ . zw , n_ . w ) ; qK . y = qH . z ; qK = abs ( ou ( qK / u_texel_size . yy - qA . yy ) ) ; qJ = sqrt ( qK ) ; qG = texture2D ( qB , qH . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qL . ba = qk ( qC , qJ , qF , qG , qE . x ) ; qH . x = qz . x ; qy ( qB , qL . ba , qH . xyxz , qK ) ; } return qL ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qY ( vec2 qN , sampler2D qO , sampler2D qP".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qQ"]}]}}]},{type:"textline",b:") { bool qR ; vec2 qS , qT , qU ; vec4 qV , qW , qX ; qV . x = texture2D ( qP , nX . xy ) . a ; qV . y = texture2D ( qP , nX . zw ) . g ; qV . wz = texture2D ( qP , qN ) . xz ; if ( dot ( qV , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { qW = texture2D ( qO , qN , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"qX = texture2D ( qQ , a ) ; qS = 2.0 * cC ( qX ) - 1.0 ; qW . a = sqrt ( 2.0 * length ( qS ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qW ; } else { qR = max ( qV . x , qV . z ) > max ( qV . y , qV . w ) ; qX = vec4 ( 0.0 , qV . y , 0.0 , qV . w ) ; qS = qV . yw ; op ( bvec4 ( qR , qR , qR , qR ) , qX , vec4 ( qV . x , 0.0 , qV . z , 0.0 ) ) ; op ( bvec2 ( qR , qR ) , qS , qV . xz ) ; qS /= dot ( qS , vec2 ( 1.0 , 1.0 ) ) ; qW = qX * vec4 ( u_texel_size , - u_texel_size ) + qN . xyxy ; qV = qS . x * texture2D ( qO , qW . xy , 0.0 ) ; qV += qS . y * texture2D ( qO , qW . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"qX = texture2D ( qQ , qW . xy ) ; qT = 2.0 * cC ( qX ) - 1.0 ; qU = qS . x * qT ; qX = texture2D ( qQ , qW . zw ) ; qT = 2.0 * cC ( qX ) - 1.0 ; qU += qS . y * qT ; qV . a = sqrt ( 2.0 * length ( qU ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qV",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 rh ( vec2 qZ , sampler2D q_ , sampler2D ra".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","rb"]}]}}]},{type:"textline",b:") { float rc ; vec2 rd ; vec4 re , rf , rg ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"re = texture2D ( rb , a ) ; rd = 2.0 * cC ( re ) - 1.0 ; re = texture2D ( q_ , qZ ) ; rf = texture2D ( ra , qZ - rd ) ; rc = abs ( re . a * re . a - rf . a * rf . a ) / 2.0 ; rc = 0.5 * clamp ( 1.0 - sqrt ( rc ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; rg = mix ( re , rf , rc ) ; rg . a = 1.0 ; return rg ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"re = texture2D ( q_ , qZ ) ; rf = texture2D ( ra , qZ ) ; return mix ( re , rf , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 ri ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"ri = vec4 ( oI ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"ri = qM ( a , oa , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"ri = qY ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"ri = vec4 ( rh ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ri = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","ri",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nX",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nY ; varying vec4 nZ ; varying vec4 n_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","oa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void ks ( vec2 kr ) { nY = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + kr . xyxy ; nZ = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kr . xyxy ; n_ = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + kr . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void kv ( vec2 kt , out vec2 ku ) { ku = kt / u_texel_size ; nY = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + kt . xyxy ; nZ = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + kt . xyxy ; n_ = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nY . xz , nZ . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void kx ( vec2 kw ) { nX = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kw . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["ks","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"kv ( a , oa ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["kx","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},
{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float oc ( in vec2 ob ) { return nS ( u_depth , ob , u_camera_range ) ; } void main ( ) { vec3 od , oe , of ; float og , oh , oi , oj , ok , ol , om ; og = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( og , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"od = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; oh = oc ( a ) ; oi = oh * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float on = 8.0 ; const int oo = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float on = 16.0 ; const int oo = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float on = 24.0 ; const int oo = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float on = 32.0 ; const int oo = 4 ;".split(" ")}]}}]},{type:"textline",b:"oj = u_ssao_radius_increase * 0.001 ; const float op = 1.0 + 2.4 / on ; ok = 0.0 ; for ( int oq = 0 ; oq < oo ; oq ++ ) for ( int or = - 1 ; or <= 1 ; or += 2 ) for ( int os = - 1 ; os <= 1 ; os += 2 ) for ( int ot = - 1 ; ot <= 1 ; ot += 2 ) { oe = reflect ( normalize ( vec3 ( or , os , ot ) ) , od ) * ( oj *= op ) ; of = vec3 ( a , oi ) ; of += vec3 ( oe . xy , oe . z * oi * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"of . z -= 1.4 * ( of . z - oi ) * step ( oi , of . z ) ;".split(" ")}]}}]},{type:"textline",b:"ol = oc ( of . xy ) * ( u_camera_range . y - u_camera_range . x ) ; om = clamp ( ( oi - ol ) / ol , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ok += mix ( 1.0 , om , step ( ol , of . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"ok += mix ( step ( of . z , ol ) , 0.5 , om ) ;".split(" ")}]}}]},{type:"textline",b:"} ok = ok / on ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ok = clamp ( ok * ok + 0.6 * ok , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ok = clamp ( ok * ok + ok , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"oh = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * oh ) ; ok = mix ( 1.0 , ok , oh ) ; gl_FragColor = vec4 ( og , ok , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float oc ( in vec2 ob ) { return nS ( u_depth , ob , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec2 od , oe ; float of , og , oh , oi , oj , ok , ol ; of = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"og = oc ( a ) ; oh = 0.0 ; oi = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"od = vec2 ( - 2.0 ) ; for ( int om = 0 ; om < 4 ; ++ om ) { for ( int on = 0 ; on < 4 ; ++ on ) { oe = ( od + vec2 ( float ( om ) , float ( on ) ) ) * u_texel_size ; oj = texture2D ( u_ssao_mask , a + oe ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"ok = oc ( a + oe ) ; ol = 1.0 - clamp ( abs ( ok - og ) * oi , 0.0 , 1.0 ) ; of += oj * ol ; oh += ol ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["of","+=","oj",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , of / oh , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , of / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { vec2 kr ; vec4 ks , kt ; float ku ; ku = texture2D ( u_depth , a ) . x ; ks = vec4 ( a * 2.0 - 1.0 , 2.0 * ku - 1.0 , 1.0 ) ; kt = u_view_proj_inverse * ks ; kt = kt / kt . w ; kt = u_view_proj_prev * kt ; kt /= kt . w ; kr = ( ks . xy - kt . xy ) / 4.0 + 0.5 ; kr = clamp ( kr , 0.0 , 1.0 ) ; gl_FragColor = cq ( kr ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } vec4 l ( in vec4 k ) { return vec4 ( - k . xyz , k . w ) / dot ( k , k ) ; } vec3 q ( vec4 m , vec4 n , vec4 o ) { vec3 p ; p = o . xyz * m . w ; p = j ( n , p ) ; p += m . xyz * o . w ; return p ; } vec3 w ( vec4 r , vec4 s , vec4 t ) { vec4 u ; vec3 v ; v = t . xyz - r . xyz * t . w ; u = l ( s ) ; v = j ( u , v ) ; v /= r . w ; return v ; } mat4 x ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 z ( float y ) { return mat4 ( c , b , b , b , b , cos ( y ) , sin ( y ) , b , b , - sin ( y ) , cos ( y ) , b , b , b , b , c ) ; } mat4 B ( float A ) { return mat4 ( cos ( A ) , b , - sin ( A ) , b , b , c , b , b , sin ( A ) , b , cos ( A ) , b , b , b , b , c ) ; } mat4 D ( float C ) { return mat4 ( cos ( C ) , sin ( C ) , b , b , - sin ( C ) , cos ( C ) , b , b , b , b , c , b , b , b , b , c ) ; } d F ( in d E ) { return d ( E . a , E . b , normalize ( E . c ) , normalize ( E . d ) , normalize ( E . e ) , E . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 G = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 N ( vec3 H , mat4 I ) { vec3 J , L , M ; J = vec3 ( I [ 0 ] [ 0 ] , I [ 1 ] [ 0 ] , I [ 2 ] [ 0 ] ) ; L = vec3 ( I [ 0 ] [ 1 ] , I [ 1 ] [ 1 ] , I [ 2 ] [ 1 ] ) ; M = vec3 ( I [ 0 ] [ 2 ] , I [ 1 ] [ 2 ] , I [ 2 ] [ 2 ] ) ; L = cross ( M , J ) ; J = normalize ( J ) ; L = normalize ( L ) ; M = normalize ( M ) ; return mat4 ( vec4 ( J , 0.0 ) , vec4 ( L , 0.0 ) , vec4 ( M , 0.0 ) , vec4 ( H , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 T ( vec3 O , vec3 P ) { vec3 Q , R , S ; Q = O - P ; Q . y = 0.0 ; R = cross ( G , Q ) ; S = cross ( Q , R ) ; R = normalize ( R ) ; S = normalize ( S ) ; Q = normalize ( Q ) ; return mat4 ( vec4 ( R , 0.0 ) , vec4 ( S , 0.0 ) , vec4 ( Q , 0.0 ) , vec4 ( P , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 aa ( in vec3 U , float V , float W , float X , vec3 Y ) { float Z , _ ; Z = fract ( length ( Y ) / 0.17 ) ; _ = X + Z / 10.0 ; Z = Z ; if ( X != 0.0 ) Z /= X ; U *= 1.0 + 0.5 * sin ( V ) ; _ = length ( U ) * W * sin ( 2.0 * 3.14 * V * _ + Z ) ; return D ( _ ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ai ( in vec3 ab , in vec3 ac , in mat4 ad ) { vec3 ae ; float af , ag ; mat4 ah ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"ah = N ( ac , ad ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"af = fract ( ( ac . x * 1.43 + ac . y * 0.123 + ac . z * 6.1 ) ) ; af = 2.0 * M_PI * af ; ae = normalize ( vec3 ( ad [ 0 ] [ 2 ] , 0.0 , ad [ 2 ] [ 2 ] ) ) ; ag = acos ( ae [ 2 ] ) ; if ( ae [ 0 ] < 0.0 ) ag = 2.0 * M_PI - ag ; ag = ag - af ; if ( ag < 0.0 ) ag = 2.0 * M_PI + ag ; af = af ; if ( ag <= MAX_BILLBOARD_ANGLE ) af += ag ; else if ( ag <= M_PI - MAX_BILLBOARD_ANGLE ) af += MAX_BILLBOARD_ANGLE * ( 2.0 * ag - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( ag <= M_PI + MAX_BILLBOARD_ANGLE ) af += ag - M_PI ; else if ( ag <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) af += MAX_BILLBOARD_ANGLE * ( 2.0 * ag - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else af += ag - 2.0 * M_PI ; ah = B ( af ) ; ah [ 3 ] = vec4 ( ac , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ah = T ( ab , ac ) ;".split(" ")}]}}]},{type:"textline",b:["return","ah",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ao ( in vec3 aj , in vec3 ak , in mat4 al , mat4 am ) { mat4 an ; an = ai ( aj , ak , al ) ; am [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; an = an * am ; return an ; }".split(" ")}]}}]},{type:"textline",b:"d av ( in vec3 ap , in vec3 aq , in vec3 ar , in vec3 as , in vec3 at , in mat4 au ) { ap = ( au * vec4 ( ap , 1.0 ) ) . xyz ; aq = ( au * vec4 ( aq , 1.0 ) ) . xyz ; ar = ( au * vec4 ( ar , 0.0 ) ) . xyz ; as = ( au * vec4 ( as , 0.0 ) ) . xyz ; at = ( au * vec4 ( at , 0.0 ) ) . xyz ; return F ( d ( ap , aq , ar , as , at , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 ay ( vec2 aw , vec3 ax ) { return ( aw + 0.5 ) * ax . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aF ( in vec4 az , in vec4 aA , in float aB ) { float aC , aD , aE ; aC = az [ 0 ] * aA [ 0 ] + az [ 1 ] * aA [ 1 ] + az [ 2 ] * aA [ 2 ] + az [ 3 ] * aA [ 3 ] ; if ( aC < 0.0 ) { aA *= - 1.0 ; aC = - aC ; } if ( abs ( aC ) >= 1.0 ) return az ; aD = acos ( aC ) ; aC = sqrt ( 1.0 - aC * aC ) ; if ( abs ( aC ) < 0.001 ) return vec4 ( az * 0.5 + aA * 0.5 ) ; aE = sin ( ( 1.0 - aB ) * aD ) / aC ; aD = sin ( aB * aD ) / aC ; return az * aE + aA * aD ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aR ( in vec3 aG , in vec4 aH , in vec4 aI , in vec4 aJ , in vec4 aK , in float aL ) { vec3 aM , aN , aO ; vec4 aP , aQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"aP = aF ( aH , aI , aL ) ; aQ = mix ( aJ , aK , aL ) ; aM = j ( aP , aG ) ; aM = aM * aQ . w + aQ . xyz ; return aM ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"aN = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aG , 1.0 ) ) ; aO = j ( aH , aN ) ; aN = j ( aI , aN ) ; aO = aO * aJ . w + aJ . xyz ; aN = aN * aK . w + aK . xyz ; aM = mix ( aO , aN , aL ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aM , 1.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} vec3 a_ ( in vec3 aS , in vec4 aT , in vec4 aU , in float aV ) { vec4 aW ; vec3 aX , aY , aZ ; aX = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aS , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"aW = aF ( aT , aU , aV ) ; aY = j ( aW , aX ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aY , 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"aZ = j ( aT , aX ) ; aX = j ( aU , aX ) ; aY = mix ( aZ , aX , aV ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( aY , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aR ( in vec3 ba , in vec4 bb , in vec4 bc ) { vec3 bd ; bd = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( ba , 1.0 ) ) ; bd = j ( bb , bd ) ; bd = bd * bc . w + bc . xyz ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( bd , 1.0 ) ) ; } vec3 a_ ( in vec3 be , in vec4 bf ) { vec3 bg ; bg = q ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( be , 0.0 ) ) ; bg = j ( bf , bg ) ; return w ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( bg , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void bv ( inout vec3 bh , inout vec3 bi , inout vec3 bj , inout vec3 bk ) { int bl , bm ; vec4 bn ; vec3 bo , bp , bq , br ; float bs , bt ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["bs","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { bo = vec3 ( 0.0 , 0.0 , 0.0 ) ; bp = vec3 ( 0.0 , 0.0 , 0.0 ) ; bq = vec3 ( 0.0 , 0.0 , 0.0 ) ; br = vec3 ( 0.0 , 0.0 , 0.0 ) ; bn = a_influence ; for ( int bu = 0 ; bu < 4 ; bu ++ ) { bl = int ( bn [ bu ] ) ; bt = fract ( bn [ bu ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bo += bt * aR ( bh , u_quatsb [ bl ] , u_quatsa [ bl ] , u_transb [ bl ] , u_transa [ bl ] , bs ) ; bp += bt * a_ ( bi , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ; bq += bt * a_ ( bj , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ; br += bt * a_ ( bk , u_quatsb [ bl ] , u_quatsa [ bl ] , bs ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bo += bt * aR ( bh , u_quatsb [ bl ] , u_transb [ bl ] ) ; bp += bt * a_ ( bi , u_quatsb [ bl ] ) ; bq += bt * a_ ( bj , u_quatsb [ bl ] ) ; br += bt * a_ ( bk , u_quatsb [ bl ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bh = bo ; bi = bp ; bj = bq ; bk = br ; } if ( ! ( a_influence . y > 0.0 ) ) { bm = int ( a_influence [ 0 ] - 1.0 ) ; if ( bm > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bh = aR ( bh , u_quatsb [ bm ] , u_quatsa [ bm ] , u_transb [ bm ] , u_transa [ bm ] , bs ) ; bi = a_ ( bi , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ; bj = a_ ( bj , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ; bk = a_ ( bk , u_quatsb [ bm ] , u_quatsa [ bm ] , bs ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bh = aR ( bh , u_quatsb [ bm ] , u_transb [ bm ] ) ; bi = a_ ( bi , u_quatsb [ bm ] ) ; bj = a_ ( bj , u_quatsb [ bm ] ) ; bk = a_ ( bk , u_quatsb [ bm ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bG ( inout vec3 bw , in vec3 bx , in float by , in float bz , in float bA , in vec3 bB , in float bC ) { vec3 bD ; float bE , bF ; bE = length ( bx ) ; bF = bz * ( 1.0 + 0.1 * fract ( bE ) ) ; bF = by * bC * ( 1.0 + sin ( 2.0 * 3.14 * bA * bF + bE ) ) ; bE = ( bw . y - bx . y ) * abs ( bF ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; bD = bw ; bD . xz += bB . xz * bE * sign ( bF ) ; bE = length ( bw - bx ) ; bw = bx + normalize ( bD - bx ) * bE ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bI ( vec4 bH ) { return bH * bH * ( 3.0 - 2.0 * bH ) ; } vec4 bK ( vec4 bJ ) { return abs ( fract ( bJ + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bM ( vec4 bL ) { return bI ( bK ( bL ) ) ; } void cc ( inout vec3 bN , in float bO , in vec3 bP , in vec3 bQ , in vec3 bR , in float bS , in float bT , in float bU , in vec3 bV ) { vec3 bW ; vec4 bX ; vec2 bY , bZ ; float b_ , ca , cb ; b_ = dot ( bR , vec3 ( 1.0 ) ) ; ca = b_ + bV . g ; cb = dot ( bN , vec3 ( bV . g ) ) ; bY = ( bO + vec2 ( cb , ca ) ) ; bX = ( ( fract ( ( bY . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bQ ) * bS ; bX = bM ( bX ) ; bZ = bX . xz + bX . yw ; bZ . y = 0.5 - bZ . y ; bW = bZ . xyx * bV . rbr * vec3 ( bT * bP . x , bU , bT * bP . z ) ; bN += bW ; }".split(" ")}]}}]},
{type:"textline",b:"void cj ( inout vec3 cd , inout vec3 ce , in vec3 cf ) { vec3 cg , ch , ci ; cg = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ch = ce ; ci = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ch = cd ; ci = ce ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( ch , u_time , cf , cg , ci , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bG ( ch , ci , au_wind_bending_amp , au_wind_bending_freq , u_time , cg , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bG ( ch , ci , au_wind_bending_amp , au_wind_bending_freq , u_time , cg , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"cd += ch - ce ; ce = ch ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cd = ch ; ce = ci ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MTEX_BLEND",b:["0"]},{type:"define",name:"MTEX_ADD",b:["1"]},{type:"define",name:"MTEX_SUB",b:["2"]},{type:"define",name:"MTEX_MUL",b:["3"]},{type:"define",name:"MTEX_SCREEN",b:["4"]},{type:"define",name:"MTEX_OVERLAY",
b:["5"]},{type:"define",name:"MTEX_DIFF",b:["6"]},{type:"define",name:"MTEX_DIV",b:["7"]},{type:"define",name:"MTEX_DARK",b:["8"]},{type:"define",name:"MTEX_LIGHT",b:["9"]},{type:"define",name:"MTEX_BLEND_HUE",b:["10"]},{type:"define",name:"MTEX_BLEND_SAT",b:["11"]},{type:"define",name:"MTEX_BLEND_VAL",b:["12"]},{type:"define",name:"MTEX_BLEND_COLOR",b:["13"]},{type:"define",name:"MTEX_SOFT_LIGHT",b:["14"]},{type:"define",name:"MTEX_LIN_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",
name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float ck = 255.0 ; float cl = 0.0 ; float cm = 1.0 ; vec4 cq ( const in float cn ) { vec4 co , cp ; co = vec4 ( ck * ck * ck , ck * ck , ck , cm ) ; cp = vec4 ( cl , cm / ck , cm / ck , cm / ck ) ; co = fract ( cn * co ) ; co -= co . xxyz * cp ; return co ; } float cu ( const in vec4 cr ) { vec4 cs ; float ct ; cs = vec4 ( cm / ( ck * ck * ck ) , cm / ( ck * ck ) , cm / ck , cm ) ; ct = dot ( cr , cs ) ; return ct ; } vec4 cq ( const in vec2 cv ) { vec4 cw ; vec2 cx , cy ; cx = vec2 ( ck , cm ) ; cy = vec2 ( cl , cm / ck ) ; cw = fract ( cv . xxyy * cx . xyxy ) ; cw -= cw . xxzz * cy . xyxy ; if ( cv . r == cm ) cw . rg = vec2 ( cl , cm ) ; if ( cv . g == cm ) cw . ba = vec2 ( cl , cm ) ; return cw ; } vec2 cC ( const in vec4 cz ) { vec2 cA , cB ; cB = vec2 ( cm / ck , cm ) ; cA . r = dot ( cz . rg , cB ) ; cA . g = dot ( cz . ba , cB ) ; return cA ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cK = 0.0 ; float cL = 1.0 ; vec4 cN ( vec4 cM ) { return cM - floor ( cM * ( cL / 289.0 ) ) * 289.0 ; } vec3 cN ( vec3 cO ) { return cO - floor ( cO * ( cL / 289.0 ) ) * 289.0 ; } vec2 cN ( vec2 cP ) { return cP - floor ( cP * ( cL / 289.0 ) ) * 289.0 ; } vec4 cR ( vec4 cQ ) { return cQ - floor ( cQ * ( cL / 7.0 ) ) * 7.0 ; } vec4 cT ( vec4 cS ) { return cN ( ( 34.0 * cS + 5.0 ) * cS ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 da ( vec2 cU ) { vec4 cV , cW , cX , cY ; vec2 cZ , c_ ; cZ = cN ( floor ( cU ) ) ; c_ = fract ( cU ) ; cV = c_ . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; cW = c_ . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; cX = cT ( cZ . x + vec4 ( cK , cL , cK , cL ) ) ; cX = cT ( cX + cZ . y + vec4 ( cK , cK , cL , cL ) ) ; cY = cR ( cX ) * K + K2 ; cX = cR ( floor ( cX * K ) ) * K + K2 ; cV = cV + JITTER * cY ; cY = cW + JITTER * cX ; cW = cV * cV + cY * cY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"cW . xy = min ( cW . xy , cW . zw ) ; cW . x = min ( cW . x , cW . y ) ; return cW . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cW . xy = ( cW . x < cW . y ) ? cW . xy : cW . yx ; cW . xz = ( cW . x < cW . z ) ? cW . xz : cW . zx ; cW . xw = ( cW . x < cW . w ) ? cW . xw : cW . wx ; cW . y = min ( cW . y , cW . z ) ; cW . y = min ( cW . y , cW . w ) ; return sqrt ( cW . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dj ( vec2 db , float dc ) { vec4 dd , de , df , dg ; vec2 dh , di ; dh = cN ( floor ( db ) ) ; di = fract ( db ) ; dd = di . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; de = di . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; df = cT ( dh . x + vec4 ( cK , cL , cK , cL ) ) ; df = cT ( df + dh . y + vec4 ( cK , cK , cL , cL ) ) ; dg = cR ( df ) * K + K2 ; df = cR ( floor ( df * K ) ) * K + K2 ; dd = dd + JITTER * dg ; dg = de + JITTER * df ; de = dd * dd + dg * dg ; dd += dc ; dg += dc ; df = dd * dd + dg * dg ; dd += dc ; dg += dc ; dd = dd * dd + dg * dg ; de . xy = min ( de . xy , de . zw ) ; de . x = min ( de . x , de . y ) ; df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; dd . xy = min ( dd . xy , dd . zw ) ; dd . x = min ( dd . x , dd . y ) ; return mat3 ( de . xx , cK , df . xx , cK , dd . xx , cK ) ; } vec3 dl ( vec3 dk ) { return cN ( ( ( dk * 34.0 ) + cL ) * dk ) ; } float dx ( vec2 dm ) { vec3 dn , dp , dq , dr ; vec4 ds ; vec2 dt , du , dv ; const vec4 dw = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; dt = floor ( dm + dot ( dm , dw . yy ) ) ; du = dm - dt + dot ( dt , dw . xx ) ; dv = ( du . x > du . y ) ? vec2 ( cL , cK ) : vec2 ( cK , cL ) ; ds = du . xyxy + dw . xxzz ; ds . xy -= dv ; dt = cN ( dt ) ; dn = dl ( dl ( dt . y + vec3 ( cK , dv . y , cL ) ) + dt . x + vec3 ( cK , dv . x , cL ) ) ; dp = max ( 0.5 - vec3 ( dot ( du , du ) , dot ( ds . xy , ds . xy ) , dot ( ds . zw , ds . zw ) ) , cK ) ; dp = dp * dp ; dp = dp * dp ; dn = 2.0 * fract ( dn * dw . www ) - cL ; dq = abs ( dn ) - 0.5 ; dr = floor ( dn + 0.5 ) ; dn = dn - dr ; dp *= 1.79284291400159 - 0.85373472095314 * ( dn * dn + dq * dq ) ; dr . x = dn . x * du . x + dq . x * du . y ; dr . yz = dn . yz * ds . xz + dq . yz * ds . yw ; return 130.0 * dot ( dp , dr ) ; } vec2 dB ( vec2 dy ) { float dz , dA ; dz = dot ( dy , vec2 ( 12.9898 , 78.233 ) ) ; dA = dot ( dy , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; dz = fract ( sin ( dz ) * 43758.5453 ) * 2.0 - cL ; dA = fract ( sin ( dA ) * 43758.5453 ) * 2.0 - cL ; return vec2 ( dz , dA ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dD = 0.1 ; const float dE = 0.1 ; const float dF = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dG = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dH = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dI = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool dL ( vec2 dJ , float dK ) { return all ( lessThanEqual ( dJ , vec2 ( 1.0 + dK ) ) ) && all ( greaterThanEqual ( dJ , vec2 ( 0.0 - dK ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float dX ( vec3 dM , sampler2D dN , float dO ) { vec2 dP , dQ ; mat2 dR ; float dS , dT , dU ; dM . z = clamp ( dM . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==",
"SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dS = 0.0 ; dT = dB ( dM . xy ) . x * M_PI ; dU = cos ( dT ) ; dT = sin ( dT ) ; dR = mat2 ( dU , dT , - dT , dU ) ; for ( int dV = 0 ; dV < 4 ; dV ++ ) for ( int dW = 0 ; dW < 4 ; dW ++ ) { dQ . x = dH [ dV ] [ dW ] ; dQ . y = dI [ dV ] [ dW ] ; dQ = dR * dQ ; dP = dM . xy + dQ * dO / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! dL ( dP , dF ) ) dS += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"dS += step ( dM . z , texture2D ( dN , dP ) . r ) ; } dS /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["dS","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dS , 0.0 , 1.0 ) ; } float en ( vec3 dY , sampler2D dZ , vec3 d_ , sampler2D ea , float eb , float ec , float ed ) { vec2 ee , ef ; mat2 eg ; float eh , ei , ej , ek ; dY . z = clamp ( dY . z , 0.0 , 1.0 ) ; d_ . z = clamp ( d_ . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"eh = 0.0 ; ei = 0.0 ; ej = dB ( dY . xy ) . x * M_PI ; ek = cos ( ej ) ; ej = sin ( ej ) ; eg = mat2 ( ek , ej , - ej , ek ) ; for ( int el = 0 ; el < 4 ; el ++ ) for ( int em = 0 ; em < 4 ; em ++ ) { ef . x = dH [ el ] [ em ] ; ef . y = dI [ el ] [ em ] ; ef = eg * ef ; ee = dY . xy + ef * eb / SHADOW_TEX_RES ; eh += step ( dY . z , texture2D ( dZ , ee ) . r ) ; ee = d_ . xy + ef * ec / SHADOW_TEX_RES ; ei += step ( d_ . z , texture2D ( ea , ee ) . r ) ; } eh = mix ( eh , ei , ed ) ; eh /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["eh","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( eh , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float er ( vec2 eo ) { float ep , eq ; ep = min ( eo . x , eo . y ) ; eq = min ( 1.0 - eo . x , 1.0 - eo . y ) ; return min ( ep , eq ) ; } float eu ( float es , float et ) { if ( et >= 0.0 && et <= dE ) es = ( es - 1.0 ) / dE * et + 1.0 ; return es ; } float eF ( vec3 ev , vec3 ew , sampler2D ex , sampler2D ey , float ez , float eA , float eB , float eC ) { float eD , eE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"eE = er ( ev . xy ) ; if ( - eC > eB && eE >= 0.0 && eE <= dD && dL ( ew . xy , 0.0 ) ) { eE = 1.0 - eE / dD ; eD = en ( ev , ex , ew , ey , ez , eA , eE ) ; } else".split(" ")}]}}]},{type:"textline",b:"eD = dX ( ev , ex , ez ) ; return eD ; } float eN ( vec3 eG , sampler2D eH , float eI , float eJ , float eK ) { float eL , eM ; eL = dX ( eG , eH , eI ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eK > eJ ) { eM = er ( eG . xy ) ; eL = eu ( eL , eM ) ; }".split(" ")}]}}]},{type:"textline",b:"return eL ; } float eU ( float eO ) { vec3 eP , eQ , eR , eS ; float eT ; eT = 1.0 ; eP = cE . xyz / cE . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"eQ = cF . xyz / cF . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"eR = cG . xyz / cG . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eS = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( dL ( eP . xy , 0.0 ) ) { eT = eF ( eP , eQ , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , eO ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( dL ( eP . xy , dG ) ) { eT = eN ( eP , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , eO ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eQ . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"eT = eF ( eQ , eR , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , eO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eT = eN ( eQ , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , eO ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eR . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eT = eF ( eR , eS , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , eO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eT = eN ( eR , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , eO ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( dL ( eS . xy , 0.0 ) ) eT = eN ( eS , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , eO ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","eT",";","}"]}]}}]}]}}]},{type:"textline",b:"float eZ ( inout vec3 eV ) { float eW ; vec3 eX ; vec2 eY ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"eY = texture2DProj ( u_shadow_mask , cI ) . rg ; eX = vec3 ( eY . r ) ; eW = eY . g ; dC = vec4 ( eX , eW ) ; eV *= dC . a ; return dC . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return eU ( cJ . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fd ( vec3 e_ , float fa , vec2 fb ) { vec2 fc ; fc = vec2 ( ( e_ . x - fb . x ) / fa , - ( e_ . z - fb . y ) / fa ) ; return fract ( fc ) ; } vec2 fh ( vec2 fe , float ff , vec2 fg ) { return vec2 ( fe . x * ff , - fe . y * ff ) + fg ; } d fi ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d fE ( vec3 fj , vec3 fk , vec3 fl , vec3 fm , vec3 fn , sampler2D fo , sampler2D fp , vec3 fq , float fr , vec3 fs , vec4 ft , mat4 fu ) { mat4 fv ; vec4 fw ; vec2 fx , fy , fz ; float fA , fB ; vec3 fC ; fC = j ( ft , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; fA = - fC . x ; fB = - fC . z ; fx = vec2 ( fs . x + fr * ( - 1.0 - fA ) / 2.0 , fs . z + fr * ( 1.0 - fB ) / 2.0 ) ; fy = fd ( fn , fr , fx ) ; fA = fr / 2.0 ; fz = abs ( fh ( fy - vec2 ( 0.5 ) , fr , vec2 ( 0.0 ) ) ) ; fB = fA * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fz ) > fB ) return fi ( ) ; fA = fr / fq . z ; fz = ( fy - vec2 ( 0.5 ) ) * fA + vec2 ( 0.5 ) ; fC = fC * ( fr / fq . z - 1.0 ) / 2.0 ; fz . x += fC . x ; fz . y -= fC . z ; fw = texture2D ( fp , fz ) ; fB = fw . r ; if ( fB < u_scale_threshold ) return fi ( ) ; fA = fq . y - fq . x ; fA = fq . y - texture2D ( fo , fz ) . r * fA ; fz = fj . xz - fn . xz ; fn . xz = fh ( fy , fr , fx ) ; fn . y = fA ; fj . xz = fn . xz + fz ; fj . y *= fB ; fj . y += fA ; fC = fw . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fj -= fn ; fv = ai ( fs , fn , fu ) ; d fD = av ( fj , fn , fk , fl , fm , fv ) ; fD . b = fn ; fD . f = fC ; return F ( fD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return F ( d ( fj , fn , fk , fl , fm , fC ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",a:[{type:"if",
c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 fK ( mat4 fF , vec4 fG ) { vec4 fH ; float fI ; vec2 fJ ; fJ = ( fF * u_v_light_matrix [ 3 ] ) . xy ; fI = SHADOW_TEX_RES / 2.0 ; fJ = floor ( fJ * fI + 0.5 ) / fI - fJ ; fH = fF * fG ; fH . xy += fJ ; fH = u_b_light_matrix * fH ; return fH ; } void fO ( vec3 fL ) { vec4 fM ; vec3 fN ; fN = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; fM = u_v_light_matrix * vec4 ( fL + u_normal_offset * fN , 1.0 ) ; cE = fK ( u_p_light_matrix0 , fM ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cF = fK ( u_p_light_matrix1 , fM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cG = fK ( u_p_light_matrix2 , fM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cH = fK ( u_p_light_matrix3 , fM ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void fO ( vec4 fP ) { float fQ , fR , fS ; fQ = fP . x ; fR = fP . y ; fS = fP . w ; cI . x = ( fQ + fS ) / 2.0 ; cI . y = ( fR + fS ) / 2.0 ; cI . z = fS ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void fV ( inout vec3 fU ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"fU = max ( vec3 ( 0.0 ) , fU ) ; fU = pow ( fU , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void fX ( inout vec3 fW ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"fW = max ( vec3 ( 0.0 ) , fW ) ; fW = pow ( fW , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void f_ ( inout vec3 fY , in float fZ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"fY = fY * fZ ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gg ( inout vec3 gc , in float gd , in vec4 ge ) { float gf ; gf = ge . w * gd ; gf = exp ( - gf * gf ) ; gf = clamp ( gf , 0.0 , 1.0 ) ; gc = mix ( ge . rgb , gc , gf ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gm ( in mat4 gh , in vec3 gi ) { vec3 gj , gk , gl ; gj = mix ( gh [ 0 ] . rgb , gh [ 1 ] . rgb , max ( sign ( gi . x ) , 0.0 ) ) ; gk = mix ( gh [ 2 ] . rgb , gh [ 3 ] . rgb , max ( sign ( gi . z ) , 0.0 ) ) ; gl = vec3 ( gh [ 0 ] . a , gh [ 1 ] . a , gh [ 2 ] . a ) ; gj = mix ( gj , gk , abs ( gi . z ) ) ; gj = mix ( gj , gl , abs ( gi . y ) ) ; return gj ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void go ( inout float gn ) { gn -= 0.5 ; gn = 4.0 * ( gn * gn * gn ) + 0.5 ; } void gC ( inout vec3 gp , in float gq , in vec3 gr , in float gs , in vec4 gt , in vec4 gu , in float gv , in float gw ) { vec3 gx , gy ; float gz , gA , gB ; gz = gu . w * gq ; gz = exp ( - gz * gz ) ; gz = clamp ( gz , 0.0 , 1.0 ) ; gA = max ( gr . y , 0.0 ) ; gq = max ( gq - max ( gs / gA , 0.0 ) , 0.0 ) ; gB = gt . w * gq ; gB = 1.0 - gB ; gB = max ( gB , 0.0 ) ; go ( gB ) ; gB += max ( gv - 0.5 , 0.0 ) ; if ( gB < gz ) { gx = vec3 ( 0.0 , 0.02 , 0.05 ) ; gy = gt . rgb ; gs = clamp ( - gs * 0.03 , 0.0 , 0.8 ) ; gy = mix ( gy , gx , min ( gA , 1.0 ) ) ; gy = mix ( gy , vec3 ( 0.0 ) , gs ) * gw ; gp = mix ( gy , gp , gB ) ; } if ( gB >= gz ) { gp = mix ( gu . rgb , gp , gz ) ; } } void gK ( inout vec3 gD , in float gE , in float gF , in vec4 gG , in float gH ) { vec3 gI ; float gJ ; gJ = gG . w * gE ; gJ = 1.0 - gJ ; gJ = clamp ( gJ , 0.0 , 1.0 ) ; go ( gJ ) ; gF = clamp ( - gF * 0.03 , 0.0 , 0.8 ) ; gI = mix ( gG . rgb , vec3 ( 0.0 ) , gF ) * gH ; gD = mix ( gI , gD , gJ ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",
b:"float gL = 0.0 ; float gM = 1.0 ; float gN = 0.5 ; struct gO { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float gW ( vec3 gP , vec3 gQ , vec3 gR , float gS , float gT ) { float gU ; vec3 gV ; gV = normalize ( gP + gQ ) ; gU = ( gM - gS ) * max ( dot ( gR , gV ) , gL ) + gS ; return pow ( gU , gT ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hf ( vec3 gX , vec3 gY , vec3 gZ , float g_ ) { float ha , hb , hc , hd ; vec3 he ; he = normalize ( gX + gY ) ; ha = max ( dot ( gZ , he ) , 0.001 ) ; hb = max ( dot ( gZ , gY ) , 0.01 ) ; hc = max ( dot ( gZ , gX ) , 0.01 ) ; ha = tan ( acos ( ha ) ) ; hd = max ( g_ , 0.001 ) ; return hc * ( gM / ( 4.0 * M_PI * hd * hd ) ) * ( exp ( - ( ha * ha ) / ( hd * hd ) ) / ( sqrt ( hb * hc ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hn ( vec3 hg , vec3 hh , vec3 hi , float hj , float hk ) { float hl ; vec3 hm ; hm = normalize ( hg + hh ) ; hl = acos ( dot ( hm , hi ) ) ; if ( hl < hj ) return gM ; else if ( hl >= hj + hk || hk == gL ) return gL ; else return gM - ( hl - hj ) / hk ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void hC ( float ho , vec3 hp , vec3 hq , vec3 hr , float hs , inout float ht ) { vec3 hu , hv ; float hw , hx , hy , hz , hA , hB ; if ( hs > gL ) { hw = max ( dot ( hp , hr ) , gL ) ; hx = hs * hs ; hy = gM - gN * ( hx / ( hx + 0.33 ) ) ; hu = hq - ho * hp ; hv = hr - hw * hp ; if ( length ( hu ) == gL || length ( hv ) == gL || abs ( ho ) > gM || abs ( hw ) > gM ) ht = ht * hy ; else { hz = acos ( ho ) ; hw = acos ( hw ) ; hu = normalize ( hu ) ; hv = normalize ( hv ) ; hA = max ( hz , hw ) ; hB = min ( hz , hw ) ; hB *= 0.95 ; hz = max ( dot ( hu , hv ) , gL ) ; hw = 0.45 * ( hx / ( hx + 0.09 ) ) ; ht = ht * ( hy + ( hw * hz * sin ( hA ) * tan ( hB ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void hJ ( vec3 hD , vec3 hE , float hF , float hG , out float hH ) { float hI ; if ( hF == gL ) { hH = gM ; } else { hI = gM + abs ( dot ( hE , hD ) ) ; hI = hG + ( gM - hG ) * pow ( hI , hF ) ; hH = clamp ( hI , gL , gM ) ; } }".split(" ")}]}}]},{type:"textline",b:"void hR ( vec3 hK , vec3 hL , vec3 hM , vec2 hN , const float hO , out float hP ) { float hQ ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"hJ ( hK , hL , hN [ 0 ] , hN [ 1 ] , hP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hQ = max ( dot ( hK , hL ) , gL ) ; hP = ( gM - hO ) * hQ + hO ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"hC ( hQ , hK , hL , hM , hN [ 0 ] , hP ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} void hY ( vec3 hS , vec3 hT , vec3 hU , float hV , vec2 hW , out float hX ) {".split(" ")},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"hX = gW ( hS , hT , hU , hV , hW [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"hX = hf ( hS , hT , hU , hW [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"hX = hn ( hS , hT , hU , hW [ 0 ] , hW [ 1 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["hX","=","gL",";"]}]}}]},{type:"textline",b:"} void iv ( vec3 hZ , vec3 h_ , vec3 ia , vec2 ib , vec4 ic , vec3 id , vec3 ie , vec3 ig , inout gO ih , float ii , vec2 ij , vec2 ik , float il ) { float im , io , ip , iq , ir , is , it , iu ; im = gL ; if ( ib . r != gL ) hR ( ia , h_ , hZ , ij , il , im ) ; io = gL ; if ( ib . g != gL ) hY ( h_ , hZ , ia , il , ik , io ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],
group:{type:"group",a:[{type:"textline",b:"if ( dot ( h_ , ia ) * dot ( hZ , ia ) < gL ) { ip = ic . x ; iq = ic . y ; ir = ic . z ; is = ic . w ; it = clamp ( abs ( dot ( h_ , ia ) ) , gL , gM ) ; iu = clamp ( dot ( hZ , - h_ ) , gL , gM ) ; iu = pow ( iu , iq ) ; ih . a += ii * vec4 ( ig * it * pow ( id , vec3 ( ip ) ) , gM ) ; ih . a += ir * mix ( vec4 ( id , gM ) , vec4 ( gM ) , is ) * ii * vec4 ( ig * it * vec3 ( iu ) , gM ) ; } else { ih . b += ig * ie * io ; ih . a += vec4 ( ig * id * im , io ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ih . b += ig * ie * io ; ih . a += vec4 ( ig * id * im , io ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"lamp",name:"POINT",f:[{type:"textline",b:"iY = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iQ = iG [ LAMP_IND ] ; iR = iI [ LAMP_IND ] ; iM = gL ;".split(" ")},{type:"textline",b:"iR = iR ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iR *= iF ; iQ = iQ - iA ;".split(" ")},{type:"textline",b:"iN = length ( iQ ) ; iR *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + iN * iN ) ; iQ = normalize ( iQ ) ; iv ( iC , iQ , iB , iY , iL , iy , iz , iR , jb , iK , iE , iD , iM ) ;".split(" ")}]},
{type:"lamp",name:"SPOT",f:[{type:"textline",b:"iZ = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iS = iG [ LAMP_IND ] ; iT = iI [ LAMP_IND ] ; iU = iH [ LAMP_IND ] ; iN = gL ;".split(" ")},{type:"textline",b:"iT = iT ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iT *= iF ; iS = iS - iA ;".split(" ")},{type:"textline",b:"iO = length ( iS ) ; iT *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + iO * iO ) ; iS = normalize ( iS ) ;".split(" ")},{type:"textline",b:"iO = dot ( iS , iU ) ; iO *= smoothstep ( gL , gM , ( iO - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; iT *= iO ; iv ( iC , iS , iB , iZ , iL , iy , iz , iT , jb , iK , iE , iD , iN ) ;".split(" ")}]},
{type:"lamp",name:"SUN",f:[{type:"textline",b:"i_ = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iU = iI [ LAMP_IND ] ; iV = iH [ LAMP_IND ] ; iO = gL ;".split(" ")},{type:"textline",b:"iU = iU ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iU *= iF ; iv ( iC , iV , iB , i_ , iL , iy , iz , iU , jb , iK , iE , iD , iO ) ;".split(" ")}]},{type:"lamp",name:"HEMI",f:[{type:"textline",b:"ja = iJ [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; iW = iI [ LAMP_IND ] ; iX = iH [ LAMP_IND ] ; iP = gN ;".split(" ")},
{type:"textline",b:"iW = iW ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) iW *= iF ; iv ( iC , iX , iB , ja , iL , iy , iz , iW , jb , iK , iE , iD , iP ) ;".split(" ")}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gO jc ( vec3 iw , vec3 ix , vec3 iy , vec3 iz , vec3 iA , vec3 iB , vec3 iC , vec2 iD , vec2 iE , float iF , vec3 iG [ NUM_LIGHTS ] , vec3 iH [ NUM_LIGHTS ] , vec3 iI [ NUM_LIGHTS ] , vec4 iJ [ NUM_LFACTORS ] , float iK , vec4 iL ) { float iM , iN , iO , iP ; vec3 iQ , iR , iS , iT , iU , iV , iW , iX ; vec2 iY , iZ , i_ , ja ; gO jb ; jb . a = vec4 ( iw + iy * ix , gL ) ; jb . b = vec3 ( gL ) ;".split(" ")},
{type:"lamps_main"},{type:"textline",b:["return","jb",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gO jh ( vec3 jd , vec3 je , vec3 jf ) { gO jg ; jg . a = vec4 ( jd + jf * je , gL ) ; jg . b = vec3 ( gL ) ; return jg ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},
{type:"textline",b:"void jA ( inout vec3 ji , float jj , float jk , float jl , vec3 jm , vec3 jn , vec3 jo , vec4 jp , vec3 jq , float jr ) { mat3 js ; float jt , ju , jv , jw ; vec2 jx ; vec3 jy ; vec4 jz ; if ( jr > CAUSTICS_VIEW_DISTANCE ) return ; jz = jp ; jy = jq + jm ; jy . xz = 10.0 * sin ( 0.1 * jy . xz ) ; jy = jy + 2.0 * cross ( - jz . xyz , cross ( - jz . xyz , jy ) + jz . w * jy ) ; jx = jy . xz ; jy = jn ; jt = max ( dot ( jm , jy ) , 0.0 ) ; ju = 0.025 ; jx . s += 0.5 * sin ( dot ( jq + jk , vec3 ( 1.0 ) ) ) ; jx . t += 0.7 * ( - sin ( dot ( jq - jk , vec3 ( - 0.7 ) ) ) ) ; jx . st += 0.23 * cos ( 4.0 * jj - CAUST_SPEED . x * jk ) ; jx . st += 3.0 * sin ( jj - 0.3 * CAUST_SPEED . y * jk ) ; jv = CAUST_SCALE * ( 1.0 + max ( 0.1 * jj , 0.0 ) ) ; js = dj ( ( jx / jv ) , ju ) ; jv = ( js * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; ju = ( js * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; jw = ( js * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; jy = CAUST_BRIGHT * vec3 ( jv , ju , jw ) ; jv = jl * jt ; ju = max ( sign ( jj ) , 0.0 ) ; jv = min ( jv + 0.5 * sign ( - jm . y ) * ju , 1.0 ) ; jv *= 1.0 - ju * ( 0.1 * jj ) ; jy *= jv ; jy *= jy ; jw = min ( - jj + 10.0 , 1.0 ) ; ji += max ( ( 2.0 * jo * jy ) * jw , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:"REFLECTION_TYPE == REFL_PLANE || REFLECTION_TYPE == REFL_CUBE || REFLECTION_TYPE == REFL_MIRRORMAP".split(" "),group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float jN ( in vec3 jH , vec3 jI , float jJ , float jK ) { float jL ; vec3 jM ; jM = normalize ( jI + jH ) ; jL = 1.0 - dot ( jH , jM ) ; jL = jK + ( 1.0 - jK ) * pow ( jL , jJ ) ; return jL ; } void j_ ( inout vec3 jO , vec3 jP , vec3 jQ , float jR ) { vec2 jS , jT ; float jU , jV , jW ; vec3 jX , jY , jZ ; jX = reflect ( - jP , jQ ) ; jU = u_fresnel_params [ 2 ] ; jV = u_fresnel_params [ 3 ] ; jW = 1.0 ; if ( jU != 0.0 ) jW = jN ( jP , jX , jU , jV ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","==","REFL_CUBE"],group:{type:"group",a:[{type:"textline",b:"jY = textureCube ( u_cube_reflection , jX ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","==","REFL_PLANE"],group:{type:"group",a:[{type:"textline",b:"jZ = u_refl_plane . xyz * dot ( jQ , u_refl_plane . xyz ) ; jZ = jQ - jZ ; jS = ( u_view_matrix_frag * vec4 ( jZ , 0.0 ) ) . xy ; jT = cI . xy / cI . z ; jT += jS * REFL_BUMP ; jY = texture2D ( u_plane_reflection , jT ) . rgb ;".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","==","REFL_MIRRORMAP"],group:{type:"group",a:[{type:"textline",b:"jY = textureCube ( u_mirrormap , jX ) . xyz ; jR = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"fV ( jY . rgb ) ; jO = mix ( jO , jY , jR * jW ) ; }".split(" ")}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",
b:"float kf ( in float ka , inout vec2 kb , in vec2 kc ) { float kd ; vec4 ke ; ke = texture2D ( u_scene_depth , kb ) ; kd = cu ( ke ) ; if ( kd < jG ) { kb = kc ; return ka ; } else { return kd ; } return ka ; }".split(" ")}]}}]},{type:"textline",b:"vec3 kn ( in vec3 kg , in vec2 kh ) { vec3 ki ; float kj ; vec4 kk ; vec2 kl , km ; kl = kg . xy / kg . z ; km = kl + kh ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"kk = texture2DProj ( u_scene_depth , kg ) ; kj = cu ( kk ) ; kf ( kj , km , kl ) ;".split(" ")}]}}]},
{type:"textline",b:"ki = texture2D ( u_refractmap , km ) . rgb ; fV ( ki ) ; return ki ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 kq ( vec3 ko ) { float kp ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , ko ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",
a:[{type:"textline",b:"kp = 0.5 * ko . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , kp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct kU { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void k_ ( inout float kV , float kW , vec2 kX , vec2 kY ) { float kZ ; kZ = kY . x - kX . x ; kZ = ( kW - kX . x ) / kZ ; kV = mix ( kV , kY . y , clamp ( kZ , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void lf ( inout vec3 la , float lb , vec4 lc , vec4 ld ) { float le ; le = ld . x - lc . x ; le = ( lb - lc . x ) / le ; la = mix ( la , ld . yzw , clamp ( le , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float ll ( float lg , float lh , vec2 li [ SIZE_RAMP_LENGTH ] ) { float lj , lk ; lj = lg / lh ; lk = li [ 0 ] . y ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"k_ ( lk , lj , li [ 0 ] , li [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",
b:"k_ ( lk , lj , li [ 1 ] , li [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"k_ ( lk , lj , li [ 2 ] , li [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","lk",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lr ( float lm , float ln , vec4 lo [ COLOR_RAMP_LENGTH ] ) { vec3 lp ; float lq ; lq = lm / ln ; lp = lo [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"lf ( lp , lq , lo [ 0 ] , lo [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"lf ( lp , lq , lo [ 1 ] , lo [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"lf ( lp , lq , lo [ 2 ] , lo [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",
b:["return","lp",";","}"]}]}}]},{type:"textline",b:"float lz ( float ls , float lt , float lu , float lv ) { float lw , lx , ly ; lw = max ( 0.01 , min ( lt , lu ) ) ; lx = max ( 0.01 , min ( lt , lv ) ) ; ly = lt - lx ; lw = clamp ( ls / lw , 0.0 , 1.0 ) - step ( ly , ls ) * ( ls - ly ) / lx ; return lw ; } kU lF ( ) { vec3 lA , lB ; float lC , lD ; kU lE ; if ( u_p_cyclic == 1 ) { lC = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( lC < 0.0 ) lC += u_p_length ; } if ( u_p_cyclic != 1 ) { lC = u_p_time - a_p_delay ; } if ( lC < 0.0 || lC >= a_p_lifetime ) { lE . a = 0.0001 ; lE . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( lC < 0.0 || lC >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"lA = a_position ; lB = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lA = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; lB = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"lA += u_p_nfactor * lC * lB ; lA += a_p_vels . xyz * lC ; lA . y -= u_p_gravity * lC * lC / 2.0 ; lD = max ( u_p_mass , EPSILON ) ; lA += ( u_p_wind / lD ) * lC * lC / 2.0 ; lE . b = lA ; lE . e = a_p_vels . w * lC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lE . a = ll ( lC , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lE . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lE . d = lr ( lC , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lE . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"lE . c = lz ( lC , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return lE ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float lH = 0.0 ; float lI = 1.0 ; vec3 lJ = vec3 ( lH ) ; vec3 lK = vec3 ( lI ) ; vec3 lP ( vec3 lL ) { float lM , lN ; vec4 lO ; lO = vec4 ( lH , - lI / 3.0 , 2.0 / 3.0 , - lI ) ; lO = mix ( vec4 ( lL . bg , lO . wz ) , vec4 ( lL . gb , lO . xy ) , step ( lL . b , lL . g ) ) ; lO = mix ( vec4 ( lO . xyw , lL . r ) , vec4 ( lL . r , lO . yzx ) , step ( lO . x , lL . r ) ) ; lM = lO . x - min ( lO . w , lO . y ) ; lN = 1.0e-10 ; return vec3 ( abs ( lO . z + ( lO . w - lO . y ) / ( 6.0 * lM + lN ) ) , lM / ( lO . x + lN ) , lO . x ) ; } vec3 lT ( vec3 lQ ) { vec3 lR ; vec4 lS ; lS = vec4 ( lI , 2.0 / 3.0 , lI / 3.0 , 3.0 ) ; lR = abs ( fract ( vec3 ( lQ . r , lQ . r , lQ . r ) + lS . xyz ) * 6.0 - lS . www ) ; return lQ . b * mix ( lS . xxx , clamp ( lR - lS . xxx , lH , lI ) , lQ . g ) ; } vec3 lX ( vec3 lU , vec3 lV , float lW ) { return mix ( lU , lV , lW ) ; } vec3 ma ( vec3 lY , vec3 lZ , float l_ ) { return l_ * lY + lZ ; } vec3 me ( vec3 mb , vec3 mc , float md ) { return mc - md * mb ; } vec3 mj ( vec3 mf , vec3 mg , float mh ) { float mi ; mi = lI - mh ; return ( vec3 ( mi ) + mh * mf ) * mg ; } vec3 mo ( vec3 mk , vec3 ml , float mm ) { vec3 mn ; mn = vec3 ( lI - mm ) ; return lK - ( mn + mm * ( lK - mk ) ) * ( lK - ml ) ; } vec3 mt ( vec3 mp , vec3 mq , float mr ) { vec3 ms ; ms = vec3 ( lI - mr ) ; return mix ( mq * ( ms + 2.0 * mr * mp ) , lK - ( ms + 2.0 * mr * ( lK - mp ) ) * ( lK - mq ) , step ( 0.5 , mq ) ) ; } vec3 mx ( vec3 mu , vec3 mv , float mw ) { return mix ( mv , abs ( mu - mv ) , mw ) ; } vec3 mB ( vec3 my , vec3 mz , float mA ) { return mix ( mz , mz / ( my + step ( my , lJ ) ) , mA ) ; } vec3 mF ( vec3 mC , vec3 mD , float mE ) { return mix ( mD , min ( mC , mD ) , mE ) ; } vec3 mJ ( vec3 mG , vec3 mH , float mI ) { return max ( mI * mG , mH ) ; } vec3 mP ( vec3 mK , vec3 mL , float mM ) { vec3 mN , mO ; mN = lP ( mL ) ; if ( mN . y != lH ) { mO = lP ( mK ) ; mN = lT ( vec3 ( mN . x , mO . yz ) ) ; return mix ( mK , mN , mM ) ; } return mK ; } vec3 mV ( vec3 mQ , vec3 mR , float mS ) { vec3 mT , mU ; mT = lP ( mQ ) ; if ( mT . y != lH ) { mU = lP ( mR ) ; return lT ( vec3 ( mT . x , mix ( mT . y , mU . y , mS ) , mT . z ) ) ; } return mQ ; } vec3 na ( vec3 mW , vec3 mX , float mY ) { vec3 mZ , m_ ; mZ = lP ( mW ) ; m_ = lP ( mX ) ; return lT ( vec3 ( mZ . xy , mix ( mZ . z , m_ . z , mY ) ) ) ; } vec3 ng ( vec3 nb , vec3 nc , float nd ) { vec3 ne , nf ; ne = lP ( nc ) ; if ( ne . y != lH ) { nf = lP ( nb ) ; ne = lT ( vec3 ( ne . xy , nf . z ) ) ; return mix ( nb , ne , nd ) ; } return nb ; } vec3 nl ( vec3 nh , vec3 ni , float nj ) { vec3 nk ; nk = lK - ( lK - ni ) * ( lK - nh ) ; return mix ( nh , ( ( lK - nh ) * ni * nh ) + nh * nk , nj ) ; } vec3 np ( vec3 nm , vec3 nn , float no ) { return nm + no * ( 2.0 * nn - lI ) ; } float nv ( float nq , float nr , float ns , float nt ) { float nu ; nu = lI - nt ; return ( nu + ns * nq ) * nr ; } float nB ( float nw , float nx , float ny , float nz ) { float nA ; nA = lI - nz ; return lI - ( nA + ny * ( lI - nw ) ) * ( lI - nx ) ; } float nH ( float nC , float nD , float nE , float nF ) { float nG ; nG = lI - nF ; return mix ( nD * ( nG + 2.0 * nE * nC ) , lI - ( nG + 2.0 * nE * ( lI - nC ) ) * ( lI - nD ) , step ( 0.5 , nD ) ) ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float nS ( in sampler2D nM , in vec2 nN , in vec2 nO ) { float nP , nQ , nR ; nP = texture2D ( nM , nN ) . r ; nQ = nO . x ; nR = nO . y ; nP = 2.0 * nQ / ( nQ + nR - ( 2.0 * nP - 1.0 ) * ( nR - nQ ) ) ; return nP ; }".split(" ")}]}};b4w.module.animation=function(a,p){var d=p("__animation"),b=p("__constraints");p("__physics");var c=p("__print"),e=p("__util");a.SLOT_0=d.SLOT_0;a.SLOT_1=d.SLOT_1;a.SLOT_2=d.SLOT_2;a.SLOT_3=d.SLOT_3;a.SLOT_4=d.SLOT_4;a.SLOT_5=d.SLOT_5;a.SLOT_6=d.SLOT_6;a.SLOT_7=d.SLOT_7;a.SLOT_ALL=d.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=d.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=d.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=d.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=d.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
d.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=d.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=d.AB_CYCLIC;a.AB_FINISH_RESET=d.AB_FINISH_RESET;a.AB_FINISH_STOP=d.AB_FINISH_STOP;var h=new Float32Array(4);a.is_animated=function(a){return d.is_animated(a)};a.get_actions=function(){c.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],b=d.kq(),e=0;e<b.length;e++)a.push(d.JA(b[e].name));return a};a.get_current_action=function(b,d){c.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(b,d)};a.get_anim_names=function(a){return d.Vj(a)?d.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.Kx(a,b)};a.apply=function(a,b,e){if(e>d.SLOT_7)c.error("Can't apply animation to slot "+e+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{e=e||d.SLOT_0;if(d.is_animated(a)){var g=d.get_slot_num_by_anim(a,b);if(-1!=g&&g!=e){c.error('Animation "'+b+'" is already applied to object "'+
a.name+'" (slot "'+g+'").');return}}d.LB(a,b)?d.apply(a,b,e):c.error('No fcurves in action "'+b+'"')}};a.remove=function(a){d.remove(a)};a.remove_slot_animation=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.remove_slot_animation(a,b))};a.apply_def=function(a){d.apply_def(a)};a.play=function(a,b,e){d.is_animated(a)?(e=e||d.SLOT_0,d.play(a,b,e),d.update_object_animation(a,0,e,!0)):c.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.stop(a,
b))};a.is_play=function(a,b){if(!d.is_animated(a))return!1;b=b||d.SLOT_0;return d.is_play(a,b)};a.set_current_frame_float=function(b,d,e){c.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(b,d,e)};a.get_current_frame_float=function(b,d){c.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(b,d)};a.set_frame=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_current_frame_float(a,b,c),d.update_object_animation(a,0,c,!0))};
a.get_frame=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return d.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return a.C[b]?d.get_speed(a,b):0};a.get_frame_range=function(a,b){c.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(d.is_animated(a)){b=b||d.SLOT_0;var e=a.C[b];if(e)return[e.start,e.start+
e.length]}return null};a.get_anim_start_frame=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.C[b])?d.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.C[b])?d.get_anim_length(a,b):-1};a.cyclic=function(b,e,h){c.error("cyclic() deprecated, use set_behavior() instead");a.set_behavior(b,e?d.AB_CYCLIC:d.AB_FINISH_RESET,h)};a.is_cyclic=function(a,b){c.error("is_cyclic() deprecated, use get_behavior() instead");if(!d.is_animated(a))return!1;
b=b||d.SLOT_0;return d.is_cyclic(a,b)};a.set_behavior=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,e){e=e||d.SLOT_0;d.is_animated(a)&&d.apply_smoothing(a,b,c,e)};a.update_object_animation=function(a,b,c,e){d.is_animated(a)&&(c=c||d.SLOT_0,d.update_object_animation(a,b||0,c,e||!1))};a.frame_to_sec=function(a){return d.frame_to_sec(a)};
a.get_bone_translation=function(a,c,d){if(!e.is_armature(a))return null;d||(d=new Float32Array(3));b.Ox(a,c,!1,h,null);d[0]=h[0];d[1]=h[1];d[2]=h[2];return d};a.get_first_armature_object=function(a){return e.is_mesh(a)?d.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return d.is_animated(a)&&b?d.get_slot_num_by_anim(a,b):null};a.get_anim_type=function(a,b){return d.is_animated(a)?d.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return d.apply_to_first_empty_slot(a,
b)};a.get_skel_mix_factor=function(a){return a.d.ze};a.set_skel_mix_factor=function(a,b,h){e.is_armature(a)?(b=Math.min(Math.max(b,0),1),a.d.ze!=b&&d.set_skel_mix_factor(a,b,h||0)):c.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var d=p("__anchors");p("__print");a.attach_move_cb=d.attach_move_cb;a.detach_move_cb=d.detach_move_cb};b4w.module.assets=function(a,p){var d=p("__assets");a.AT_ARRAYBUFFER=d.AT_ARRAYBUFFER;a.AT_JSON=d.AT_JSON;a.AT_TEXT=d.AT_TEXT;a.AT_AUDIOBUFFER=d.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=d.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=d.AT_AUDIO_ELEMENT;a.enqueue=function(a,c,e){d.enqueue(a,c,e)}};b4w.module.camera=function(a,p){function d(a,b){if(c.is_camera(a))return b||(b=new Float32Array(3)),g.copy(a.d.g,b),b;h.error("get_eye(): Wrong object")}function b(a,b){c.is_target_camera(a)?(g.copy(b,a.d.Fb),f.w(a),e.sync_transform(a)):h.error("set_pivot(): Wrong object or camera move style")}var c=p("__camera");p("__config");var e=p("__physics"),h=p("__print"),k=p("__constraints"),f=p("__transform"),l=p("__util"),g=p("vec3"),m=p("vec4");p("quat");var n=p("mat3"),r=p("mat4"),A=new Float32Array(2),
v=new Float32Array(3),E=new Float32Array(3),B=new Float32Array(4),w=new Float32Array(9);a.MS_STATIC=c.MS_STATIC;a.MS_ANIMATION=c.MS_STATIC;a.MS_TARGET_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=c.MS_HOVER_CONTROLS;a.is_camera=c.is_camera;a.is_target_camera=c.is_target_camera;a.is_eye_camera=c.is_eye_camera;a.is_hover_camera=c.is_hover_camera;a.set_move_style=function(a,b){if(!c.is_camera(a))return h.error("set_move_style(): Wrong object"),!1;if(b!=c.MS_STATIC&&
b!=c.MS_EYE_CONTROLS&&b!=c.MS_HOVER_CONTROLS&&b!=c.MS_TARGET_CONTROLS)return h.error("set_move_style(): Wrong camera move style"),!1;a.d.ra=b;a.d.Pb=null;a.d.Zc=null;a.d.tb=null;a.d.Oa=!1;c.uy(a);switch(b){case c.MS_TARGET_CONTROLS:var k=d(a,v),m=l.quat_to_dir(a.d.quat,l.AXIS_MY,E),k=g.scaleAndAdd(k,m,10,m);g.copy(k,a.d.Fb)}f.w(a);e.sync_transform(a);return!0};a.get_move_style=function(a){return c.is_camera(a)?c.get_move_style(a):(h.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=
function(a,b){if(!c.is_target_camera(a)&&!c.is_eye_camera(a)&&!c.is_hover_camera(a))return h.error("set_velocity_params(): Wrong object or camera move style"),null;var d=a.d;d.lo=l.clamp(b[0],0,Infinity);d.ko=l.clamp(b[1],0,Infinity);d.mo=l.clamp(b[2],0,1)};a.get_velocity_params=function(a,b){if(!c.is_target_camera(a)&&!c.is_eye_camera(a)&&!c.is_hover_camera(a))return h.error("get_velocity_params(): Wrong object or camera move style"),null;b||(b=new Float32Array(3));var d=a.d;b[0]=d.lo;b[1]=d.ko;
b[2]=d.mo;return b};a.set_look_at=function(a,b,d,g){var h=a.d;c.kx(b,d,g,h.g,h.quat);f.w(a);e.sync_transform(a)};a.get_eye=d;a.set_pivot=b;a.set_trans_pivot=function(a,b,d){c.is_target_camera(a)?(g.copy(b,a.d.g),g.copy(d,a.d.Fb),f.w(a),e.sync_transform(a)):h.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,b){if(c.is_target_camera(a))return b||(b=new Float32Array(3)),g.copy(a.d.Fb,b),b;h.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(b,
c,d){h.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,d)};a.move_pivot=function(a,b,d){if(c.is_target_camera(a)){var k=a.d;if(k.et){var m=n.fromMat4(k.T,w),l=g.subtract(k.g,k.Fb,E);v[0]=b;v[1]=0;v[2]=d;g.scale(v,g.len(l),v);g.transformMat3(v,m,v);g.add(k.Fb,v,k.Fb);g.add(k.g,v,k.g);f.w(a);e.sync_transform(a)}}else h.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){h.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){h.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return c.is_hover_camera(a)?-c.get_camera_angles(a,A)[1]:(h.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,b){h.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(c.is_hover_camera(a))if(a.d.Oa){var d=c.get_camera_angles(a,A);(d=-b-d[1])&&c.rotate_hover_camera(a,
0,d);f.w(a);e.sync_transform(a)}else h.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else h.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,b){if(c.is_hover_camera(a))return a.d.tb?(b||(b=new Float32Array(2)),b[0]=a.d.tb.La,b[1]=a.d.tb.Va):h.error("get_hover_angle_limits(): camera hasn't angle limits"),b;h.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,b){if(c.is_hover_camera(a)||
c.is_target_camera(a))return a.d.Oa?(b||(b=new Float32Array(2)),b[0]=a.d.Gf,b[1]=a.d.Wd):h.error("get_cam_dist_limits(): camera hasn't distance limits"),b;h.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(b,c){h.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,b){if(c.is_hover_camera(a)){var d=a.d;if(d.Oa){var k=g.subtract(b,d.g,v);g.add(k,d.Qb,d.Qb)}f.set_translation(a,
b);f.w(a);e.sync_transform(a)}else h.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,b){if(c.is_hover_camera(a)){var d=a.d;if(d.Oa&&d.tb){var k=g.subtract(b,d.Qb,v),k=g.add(k,d.g,k);f.set_translation(a,k)}g.copy(b,d.Qb);f.w(a);e.sync_transform(a)}else h.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_cam_pivot=function(a,b){if(!c.is_hover_camera(a))return h.error("get_hover_cam_pivot(): wrong object"),null;b||(b=new Float32Array(3));g.copy(a.d.Qb,
b);return b};a.has_distance_limits=function(a){return c.is_target_camera(a)||c.is_hover_camera(a)?a.d.Oa:(h.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,b,d,g){switch(c.get_move_style(a)){case c.MS_TARGET_CONTROLS:case c.MS_EYE_CONTROLS:g|=f.SPACE_WORLD;break;case c.MS_HOVER_CONTROLS:if(b>d){h.error("apply_vertical_limits(): wrong vertical limits");return}break;default:h.error("apply_vertical_limits(): wrong object");return}a.d.Zc={La:b,Va:d};c.sz(a,g==f.SPACE_LOCAL);
f.w(a);e.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.Zc=null};a.apply_horizontal_limits=function(a,b,d,g){switch(c.get_move_style(a)){case c.MS_TARGET_CONTROLS:case c.MS_EYE_CONTROLS:g|=f.SPACE_WORLD;break;case c.MS_HOVER_CONTROLS:if(b>d){h.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:h.error("apply_horizontal_limits(): wrong object");return}a.d.Pb={left:b,right:d};c.oz(a,g==f.SPACE_LOCAL);f.w(a);e.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.Pb=
null};a.get_horizontal_limits=function(a,b){if(c.is_target_camera(a)||c.is_eye_camera(a)||c.is_hover_camera(a)){var d=a.d;b=b||new Float32Array(2);if(d.Pb)return b[0]=d.Pb.left,b[1]=d.Pb.right,b}else h.error("get_horizontal_limits(): wrong object")};a.has_horizontal_limits=function(a){if(c.is_target_camera(a)||c.is_eye_camera(a)||c.is_hover_camera(a))return Boolean(a.d.Pb);h.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,b,d){c.is_hover_camera(a)?b<d?h.error("apply_hover_angle_limits(): wrong hover angle limits"):
(b=l.angle_wrap_periodic(b,-Math.PI,Math.PI),d=l.angle_wrap_periodic(d,-Math.PI,Math.PI),b=l.clamp(b,-Math.PI/2,0),d=l.clamp(d,-Math.PI/2,0),a.d.tb={La:b,Va:d},c.ty(a),f.w(a),e.sync_transform(a)):h.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){c.is_hover_camera(a)?a.d.tb=null:h.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,b,d){if(c.is_target_camera(a)||c.is_hover_camera(a))if(b>d)h.error("apply_distance_limits(): wrong distance limits");
else{var g=a.d;g.Oa=!0;g.Wd=b;g.Gf=d;f.w(a);e.sync_transform(a)}else h.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){c.is_target_camera(a)||c.is_hover_camera(a)?a.d.Oa=!1:h.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(b,c,d){h.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-d)};a.is_look_up=function(a){l.quat_to_dir(a.d.quat,l.AXIS_MY,v);return 0<=v[1]?!0:!1};
a.rotate_camera=function(b,d,g,k,m){switch(a.get_move_style(b)){case c.MS_STATIC:break;case c.MS_TARGET_CONTROLS:c.rotate_target_camera(b,d,g,k,m);break;case c.MS_EYE_CONTROLS:c.rotate_eye_camera(b,d,g,k,m);break;case c.MS_HOVER_CONTROLS:c.rotate_hover_camera(b,d,g,k,m);break;default:h.error("rotate_camera(): Wrong object")}f.w(b);e.sync_transform(b)};a.rotate_target_camera=function(a,b,d,g,k){c.is_target_camera(a)?(c.rotate_target_camera(a,b,d,g,k),f.w(a),e.sync_transform(a)):h.error("rotate_target_camera(): wrong object")};
a.rotate_eye_camera=function(a,b,d,g,k){c.is_eye_camera(a)?(c.rotate_eye_camera(a,b,d,g,k),f.w(a),e.sync_transform(a)):h.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,b,d,g,k){c.is_hover_camera(a)?(c.rotate_hover_camera(a,b,d,g,k),f.w(a),e.sync_transform(a)):h.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){h.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-d)};a.get_camera_angles=function(a,
b){b||(b=new Float32Array(2));c.get_camera_angles(a,b);return b};a.get_camera_angles_char=function(a,b){b||(b=new Float32Array(2));c.get_camera_angles_char(a,b);return b};a.get_angles=function(a,b){h.error("get_angles() deprecated, use get_camera_angles() instead");b||(b=new Float32Array(2));c.get_angles(a,b);return b};a.set_stereo_distance=function(a,b){for(var d=a.d.G,e=0;e<d.length;e++){var f=d[e];f.type!=c.qb&&f.type!=c.zb||c.eA(f,b,f.zd)}};a.get_stereo_distance=function(a){a=a.d.G;for(var b=
0;b<a.length;b++){var d=a[b];if(d.type==c.qb||d.type==c.zb)return d.Pi}return 0};a.is_underwater=function(a){h.error("is_underwater() deprecated, always returns false");return a.d.Xs};a.translate_view=function(a,b,d,e){a=a.d.G;for(var f=0;f<a.length;f++){var g=a[f];g.cc||c.$e(g,g.ta);var h=v;h[0]=-b;h[1]=-d;h[2]=0;r.translate(g.pa,h,g.pa);r.rotateZ(g.pa,e,g.pa);r.multiply(g.pa,g.ea,g.Dd);c.mp(g);c.yl(g)}};a.get_fov=function(a){return l.yk(a.d.G[0].pc)};a.set_fov=function(a,b){for(var d=a.d.G,e=0;e<
d.length;e++){var f=d[e];f.pc=l.Qw(b);f.cc||c.$e(f,f.ta);r.multiply(f.pa,f.ea,f.Dd);c.mp(f);c.yl(f)}};a.correct_up=function(a,b){b||(b=l.AXIS_Y);k.correct_up(a,b)};a.zoom_object=function(a,d){if(c.is_target_camera(a)){f.get_object_center(d,!1,v);b(a,v);f.w(a);var g=f.get_object_size(d),k=c.Jx(a)/2,g=g/Math.sin(k),k=f.fz(a,v);f.move_local(a,0,g-k,0);f.w(a);e.sync_transform(a)}else h.error("zoom_object(): wrong object")};a.set_ortho_scale=function(b,d){if(c.is_camera(b)&&a.is_ortho_camera(b)){var e=
b.d;if(c.is_target_camera(b)){var f=g.dist(e.g,e.Fb);e.$g=d/2*e.Zg/f}else c.is_hover_camera(b)&&a.has_distance_limits(b)?(f=g.distance(e.g,e.Qb),e.$g=d/2*e.Zg/f):b.d.G[0].top=d/2;c.qB(b)}else h.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(b){if(c.is_camera(b)&&a.is_ortho_camera(b))return 2*b.d.G[0].top;h.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(c.is_camera(a))return a.d.G[0].type==c.Dc;h.error("is_ortho_camera(): wrong object")};a.calc_ray=
function(a,b,d,e){e||(e=new Float32Array(3));var f=a.d.G[0];switch(f.type){case c.Lb:case c.Id:case c.qb:case c.zb:var k=Math.tan(f.pc*Math.PI/360);B[0]=(2*b/f.width-1)*k*f.ta;B[1]=-1;B[2]=(2*d/f.height-1)*k;B[3]=0;m.transformMat4(B,a.d.T,B);e[0]=B[0];e[1]=B[1];e[2]=B[2];g.normalize(e,e);return e;default:return h.error("Non-compatible camera"),e}};a.project_point=function(a,b,d){d||(d=new Float32Array(2));return c.project_point(a,b,d)}};b4w.module.config=function(a,p){var d=p("__config");a.P_LOW=d.P_LOW;a.P_HIGH=d.P_HIGH;a.P_ULTRA=d.P_ULTRA;a.P_CUSTOM=d.P_CUSTOM;a.set=d.set;a.get=d.get;a.reset=d.reset;a.get_std_assets_path=d.get_std_assets_path};b4w.module.controls=function(a,p){var d=p("__controls"),b=p("__print");a.CT_CONTINUOUS=d.CT_CONTINUOUS;a.CT_TRIGGER=d.CT_TRIGGER;a.CT_SHOT=d.CT_SHOT;a.CT_LEVEL=d.CT_LEVEL;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=65;a.KEY_B=66;a.KEY_C=
67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=
190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=d.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=d.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=d.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=d.create_custom_sensor;a.create_keyboard_sensor=d.create_keyboard_sensor;a.create_collision_sensor=d.create_collision_sensor;a.create_collision_impulse_sensor=d.create_collision_impulse_sensor;
a.create_ray_sensor=d.create_ray_sensor;a.create_mouse_click_sensor=d.create_mouse_click_sensor;a.create_mouse_wheel_sensor=d.create_mouse_wheel_sensor;a.create_mouse_move_sensor=d.create_mouse_move_sensor;a.create_touch_move_sensor=d.create_touch_move_sensor;a.create_touch_zoom_sensor=d.create_touch_zoom_sensor;a.create_motion_sensor=d.create_motion_sensor;a.create_vertical_velocity_sensor=d.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=d.create_gyro_angles_sensor;a.create_gyro_delta_sensor=
d.create_gyro_delta_sensor;a.create_timer_sensor=function(a,b){return d.create_timer_sensor(a,b||!1)};a.reset_timer_sensor=d.reset_timer_sensor;a.create_elapsed_sensor=d.create_elapsed_sensor;a.create_timeline_sensor=d.create_timeline_sensor;a.create_selection_sensor=function(a,b){return d.create_selection_sensor(a,b||!1)};a.set_custom_sensor=function(a,b){d.Sz(a,b)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=d.get_sensor_value;a.get_sensor_payload=d.get_sensor_payload;a.create_sensor_lock=
function(a,e,h){b.error("create_sensor_lock() deprecated");a.an=e.slice(0);a.$m=Array(e.length);a.bk=h||d.Vl};a.remove_sensor_lock=function(a){b.error("remove_sensor_lock() deprecated");a.an=null;a.$m=null;a.bk=null};a.create_sensor_manifold=function(a,b,h,k,f,l,g){f=f||d.Vl;d.create_sensor_manifold(a,b,h,k,f,l,void 0===g?null:g)};a.create_kb_sensor_manifold=function(a,b,h,k,f,l){k=d.create_keyboard_sensor(k);d.create_sensor_manifold(a,b,h,[k],d.Vl,f,void 0===l?null:l)};a.check_sensor_manifolds=function(a){return d.check_sensor_manifold(a,
null)};a.check_sensor_manifold=d.check_sensor_manifold;a.remove_sensor_manifolds=function(a){b.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");d.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=d.remove_sensor_manifold;a.reset=d.reset;a.register_keyboard_events=d.register_keyboard_events;a.register_mouse_events=function(a,b,h){d.register_mouse_events(a,b,!!h)};a.register_wheel_events=d.register_wheel_events;a.register_touch_events=d.register_touch_events;
a.register_device_orientation=d.register_device_orientation;a.unregister_keyboard_events=d.unregister_keyboard_events;a.unregister_mouse_events=d.unregister_mouse_events;a.unregister_wheel_events=d.unregister_wheel_events;a.unregister_touch_events=d.unregister_touch_events;a.unregister_device_orientation=d.unregister_device_orientation};b4w.module.constraints=function(a,p){var d=p("__camera"),b=p("__constraints"),c=p("__physics"),e=p("__print"),h=p("__transform");a.append_stiff=function(a,d,e,g,m){m=m||1;d instanceof Array&&2==d.length?b.Ro(a,d[0],d[1],e,g,m):b.So(a,d,e,g,m);h.w(a);c.sync_transform(a)};a.append_semi_stiff=function(a,d,e,g){b.Uu(a,d,e,g);h.w(a);c.sync_transform(a)};a.append_semi_stiff_cam=function(a,f,l,g,m,n,r,p){if(!d.is_eye_camera(a))return e.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented."),
null;b.Tu(a,f,l,g,m,n,r,p);h.w(a);c.sync_transform(a)};a.append_semi_soft_cam=function(a,f,l,g){if(!d.is_eye_camera(a))return e.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented."),null;if(!g||0>g)g=.25;b.Su(a,f,l,g);h.w(a);c.sync_transform(a)};a.append_stiff_trans=function(a,d,e){b.Vu(a,d,e);h.w(a);c.sync_transform(a)};a.append_copy_trans=function(a,d,e){b.Ou(a,d,e);h.w(a);c.sync_transform(a)};a.append_stiff_trans_rot=function(a,d,e,g){b.Wu(a,d,e,g);h.w(a);
c.sync_transform(a)};a.append_track=function(a,d){3==d.length?b.Zu(a,d):b.Yu(a,d);h.w(a);c.sync_transform(a)};a.append_follow=function(a,d,e,g){3==d.length?b.Qu(a,d,e,g):b.Pu(a,d,e,g);h.w(a);c.sync_transform(a)};a.append_stiff_viewport=function(a,d,e){b.append_stiff_viewport(a,d,e);h.w(a);c.sync_transform(a)};a.remove=function(a){a.Qa&&b.remove(a)};a.get_parent=b.get_parent};b4w.module.container=function(a,p){var d=p("__container"),b=p("__print");a.get_canvas=d.get_canvas;a.get_container=d.get_container;a.insert_to_container=function(a,e){2!=arguments.length?b.error("insert_to_container(): two arguments required"):a&&e&&d.insert_to_container(a,e)}};b4w.module.data=function(a,p){var d=p("__data");p("__print");p("__util");a.load=d.load;a.unload=function(a){d.unload(a|0)};a.set_debug_resources_root=d.set_debug_resources_root;a.is_primary_loaded=d.is_primary_loaded;a.load_and_add_new=d.load;a.cleanup=a.unload};b4w.module.debug=function(a,p){p("__batch");p("__config");var d=p("__controls"),b=p("__debug"),c=p("__physics"),e=p("__print"),h=p("__scenegraph"),k=p("__scenes"),f=p("__shaders"),l=p("__sfx"),g=p("__textures"),m=p("__util"),n=p("vec3");a.physics_stats=function(){c.Mw()};a.physics_id=function(a){e.log("O",c.mx(a));for(var b=c.Ix().m.p,d=0;d<b.length;d++){var f=b[d];f.ub.N==a&&e.log("B",f)}};a.visible_objects=function(){for(var a=k.get_active(),b=k.Ga(a,"MESH",k.DATA_ID_ALL),a=k.ha(a,"MAIN_OPAQUE").p,
c=0;c<b.length;c++){var d=b[c],f=d.d;if("DYNAMIC"==f.type)for(var g=0;g<a.length;g++){var h=a[g];if(h.Ra&&h.qd==f){e.log(d.name,d);break}}}};a.object_info=function(a){for(var b=k.get_active(),c=k.Ga(b,"MESH",k.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];if(f.name==a){e.log("Object",f);for(var g=k.um(b),h=0;h<g.length;h++){for(var m=g[h],l=m.p,n=[],q=0;q<l.length;q++)l[q].qd==f.d&&n.push(l[q]);e.log("Subscene "+m.type,n)}}}};a.objects_stat=function(){var a=k.get_active();console.log("Armatures: "+
k.Ga(a,"ARMATURE",k.DATA_ID_ALL).length);console.log("Cameras: "+k.Ga(a,"CAMERA",k.DATA_ID_ALL).length);console.log("Curves: "+k.Ga(a,"CURVE",k.DATA_ID_ALL).length);console.log("Empties: "+k.Ga(a,"EMPTY",k.DATA_ID_ALL).length);console.log("Lamps: "+k.Ga(a,"LAMP",k.DATA_ID_ALL).length);console.log("Meshes: "+k.Ga(a,"MESH",k.DATA_ID_ALL).length);console.log("Speakers: "+k.Ga(a,"SPEAKER",k.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=k.get_active(),b=[k.ha(b,"MAIN_OPAQUE"),k.ha(b,"MAIN_BLEND")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,e=0;e<d.length;e++){var f=d[e].D;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=k.get_active(),b=[k.ha(b,"MAIN_OPAQUE"),k.ha(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,e=0;e<d.length;e++){var f=d[e].D;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=k.get_active(),a=[k.ha(a,"MAIN_OPAQUE"),k.ha(a,"MAIN_BLEND")];return a[0].p.length+a[1].p.length};a.num_shaders=function(){return m.ld(f.nq())};
a.geometry_stats=function(){for(var a=k.get_active(),b=k.um(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.p,f=0;f<e.length;f++){var g=e[f].D,h=e[f].qd;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||h.lk||h.kk)&&(a[g.id]=g)}}var e=d=c=b=0,m;for(m in a)g=a[m],g=g.R,g.Fj&&(d++,e+=g.Fj/1048576),b++,c+=g.Lp/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=k.get_active(),c=[k.ha(c,"MAIN_OPAQUE"),
k.ha(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.p,f=0;f<e.length;f++){var g=e[f].D;if(g)for(var g=g.M,h=0;h<g.length;h++){var m=g[h];if("IMAGE"===m.source||"ENVIRONMENT_MAP"===m.source){var l=m.Pa;-1===a.indexOf(l)&&(a.push(l),m=m.width*m.height*4/1048576/m.Jl,m*=1.3333,b+=m)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=k.get_active(),c=k.um(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.h,h=[f.ab,f.Hc];h.push.apply(h,
e.Ad);for(e=0;e<h.length;e++){var m=h[e];g.ri(m)&&-1==a.indexOf(m)&&(a.push(m),b+=f.width*f.height*g.gy(m))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=k.get_active();(a=k.ha(a,"MAIN_OPAQUE"))&&k.kr(a.h,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=k.get_active(),b=k.ha(a,"MAIN_OPAQUE"),a=k.OA(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=
[1,0,1]}k.kr(d.h,b,e)}};a.scenegraph_to_dot=function(){for(var a=k.mi(),b=0;b<a.length;b++)e.log("\n"+h.Jw(k.wm(a[b])))};a.scenes_to_dot=function(){};a.controls_info=d.debug;a.object_distance=function(a,b){return n.dist(a.d.g,b.d.g)};a.msg=b.msg;a.fbmsg=b.fbmsg;a.print_telemetry=b.print_telemetry;a.plot_telemetry=b.plot_telemetry;a.fbres=function(a,c){function d(){b.fbmsg("FBRES",a());setTimeout(d,c)}c||(c=16);d()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,
1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!m.De(a,m.Bu))throw"Wrong VEC3_IDENT";if(!m.De(b,m.vu))throw"Wrong QUAT4_IDENT";if(!m.De(c,m.AXIS_X))throw"Wrong AXIS_X";if(!m.De(d,m.AXIS_Y))throw"Wrong AXIS_Y";if(!m.De(e,m.AXIS_Z))throw"Wrong AXIS_Z";if(!m.De(f,m.AXIS_MX))throw"Wrong AXIS_MX";if(!m.De(g,m.AXIS_MY))throw"Wrong AXIS_MY";if(!m.De(h,m.AXIS_MZ))throw"Wrong AXIS_MZ";
};a.mute_music=function(){for(var a=l.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==l.ym(c)&&l.mute(c,!0)}};a.check_finite=function(a){b.check_finite(a)};a.set_debug_params=function(a){var b=k.get_active();if(b=k.ha(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&k.kA(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&k.jA(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return e.Vx()};a.get_warning_quantity=
function(){return e.jy()};a.clear_errors_warnings=function(){return e.clear_errors_warnings()}};b4w.module.geometry=function(a,p){var d=p("__batch"),b=p("__geometry"),c=p("__print"),e=p("__renderer");a.extract_vertex_array=function(a,e,f){if(!b.ni(a))return c.error("Wrong object:",a.name),null;if(a=d.Z(a,e,"MAIN")||d.Z(a,e,"NODES")){if((e=a.R)&&e.Tb&&e.Tb[f])return b.fx(e,f);c.error("Attribute not found:"+f);return null}c.error("Wrong material:",e);return null};a.extract_index_array=function(a,e){if(!b.ni(a))return c.error("Wrong object:",a.name),null;var f=d.Z(a,e,"MAIN")||d.Z(a,e,"NODES");
if(f){if((f=f.R)&&f.Tb)return f.Pe;c.error("Buffer data not found");return null}c.error("Wrong material:",e);return null};a.update_vertex_array=function(a,e,f,l){var g=["MAIN","NODES","DEPTH","COLOR_ID"];if(b.ni(a))for(var m=0;m<g.length;m++){var n=d.Z(a,e,g[m]);n&&(n=n.R)&&n.Tb&&n.Tb[f]&&b.Ok(n,f,0,l)}else c.error("Wrong object:",a.name)};a.override_geometry=function(a,k,f,l,g){var m=["MAIN","NODES","DEPTH","COLOR_ID"];if(b.ni(a))if(f instanceof Uint16Array||f instanceof Uint32Array)if(l instanceof
Float32Array)for(var n=0;n<m.length;n++){var r=d.Z(a,k,m[n]);if(r){var p=r.R;if(p){b.hB(p,r.Yd,f);var v=0,E;for(E in p.Tb)var B=p.Tb[E],v=v+l.length/3*B.pd;p.Yc=new Float32Array(v);var v=p.Yc,w=0;for(E in p.Tb)switch(B=p.Tb[E],E){case "a_position":v.set(l,w);B.offset=w;B.length=l.length;w+=B.length;break;case "a_normal":var t;g&&(t=b.lp(f,l,l));var x=b.jp(f,l,t);v.set(x,w);B.offset=w;B.length=l.length;w+=B.length;break;case "a_tangent":B.offset=w;B.length=l.length/3*B.pd;for(var x=new Float32Array(B.length),
G=0;G<x.length;G+=4)x[G]=1,x[G+3]=1;v.set(x,w);w+=B.length;break;default:B.offset=w,B.length=l.length/3*B.pd,x=new Float32Array(B.length),v.set(x,w),w+=B.length}b.at(p);e.Uo(r);(r=d.oc(a,r))&&r.R&&(r.R=p)}}}else c.error("Wrong positions_array type");else c.error("Wrong ibo_array type");else c.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,d,e){if(!b.check_shape_keys(a))return c.error("Wrong object:",a.name),null;if(!b.Lq(a,d))return c.error("Wrong key name:",d),null;b.ev(a,d,parseFloat(e))};
a.check_shape_keys=function(a){return b.check_shape_keys(a)};a.get_shape_keys_names=function(a){return b.check_shape_keys(a)?b.get_shape_keys_names(a):(c.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,d){return b.check_shape_keys(a)?b.Lq(a,d)?b.get_shape_key_value(a,d):(c.error("Wrong key name:",d),null):(c.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,p){var d=p("__hud");p("__print");a.draw_mixer_strip=d.draw_mixer_strip;a.plot_array=d.plot_array};b4w.module.lights=function(a,p){function d(a){for(var b=h.get_active(),d=h.Ga(b,"LAMP",h.DATA_ID_ALL),m=0;m<d.length;m++){var n=d[m];if("SUN"==n.la.type){var p=n;break}}if(!p)return c.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,m=p.d,k.set_rotation_euler(p,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),f.quat_to_dir(m.quat,f.AXIS_Y,a),m=l.length(m.g),l.copy(a,g),l.scale(g,m,g),k.set_translation(p,
g),k.w(p),a=p.la,a.Rp&&(n=p.data.energy,m=b.world.light_settings.environment_energy,d=Math.cos(Math.abs(d)),n*=Math.max(Math.min(3*d,1),0),d=Math.max(d,.1)*m,e.ms(a,n),h.set_environment_colors(b,d,null,null)),h.rg(p,b))}function b(a){if(e.Om(a))return a.la.type;c.error("get_light_type(): Wrong object");return!1}var c=p("__print"),e=p("__lights"),h=p("__scenes");p("__batch");var k=p("__transform"),f=p("__util"),l=p("vec3"),g=new Float32Array(3),m,n=60;a.get_lamps=function(a){var b=h.get_active(),b=
h.Ga(b,"LAMP",h.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.la.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=h.get_active(),a=h.Ga(a,"LAMP",h.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.la.type){b=d;break}}return b?(b=b.la.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=d;a.set_day_time=
function(a){for(var b=h.get_active(),b=h.Ga(b,"LAMP",h.DATA_ID_ALL),e=0;e<b.length;e++){var f=b[e];if("SUN"==f.la.type){var g=f;break}}if(!g)return c.error("There is no sun on the scene"),null;g=-Math.cos(a/12*Math.PI)*n;b={};b.hor_position=12>a?15*a:15*(a-24);b.vert_position=g;d(b)};a.set_date=function(a){(m=a.getDate())?1582==m&&10==a.YD&&4<a.Iw&&15>a.Iw&&c.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):c.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=
function(a){n=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(e.Om(a))var d=a.la;else return c.error("get_light_params(): Wrong object"),!1;if(a=b(a))switch(a){case "SPOT":var f={light_type:a,light_color:d.color,light_energy:d.Je,light_spot_blend:d.pg,light_spot_size:d.Xc,light_distance:d.distance};break;case "POINT":f={light_type:a,light_color:d.color,light_energy:d.Je,light_distance:d.distance};break;default:f={light_type:a,light_color:d.color,light_energy:d.Je}}return f?f:!1};a.get_light_type=
b;a.set_light_params=function(a,b){if(e.Om(a))var d=a.la;else return c.error("set_light_params(): Wrong object"),!1;var f=h.get_active();"number"==typeof b.light_energy&&(e.ms(d,b.light_energy),h.rg(a,f));"object"==typeof b.light_color&&(e.Zz(d,b.light_color),h.rg(a,f));"number"==typeof b.light_spot_blend&&(e.aA(d,b.light_spot_blend),h.rg(a,f));"number"==typeof b.light_spot_size&&(e.bA(d,b.light_spot_size),h.rg(a,f));"number"==typeof b.light_distance&&(e.$z(d,b.light_distance),h.rg(a,f));h.cB()}};b4w.module.material=function(a,p){function d(a,b){for(var c=a.n,d=0;d<c.length;d++){var e=c[d];if(-1<e.Kc.indexOf(b))return"MAIN"==e.type}return!1}function b(a,b){var c=e.Z(a,b,"MAIN");return Boolean(c&&c.fc[0])}function c(a,b){var c=e.Z(a,b,"MAIN");return Boolean(c&&c.fc[1])}var e=p("__batch"),h=p("__config"),k=p("__print"),f=p("__objects"),l=p("__shaders");p("__util");p("vec4");var g=h.o,m="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.inherit_material=function(a,
b,c,d){if(f.oi(c)&&f.oi(a)){for(var g=["MAIN","DEPTH","COLOR_ID"],h=!1,l=0;l<g.length;l++){var p=g[l],x=e.Z(a,b,p),G=e.Z(c,d,p);if(x&&G){var h=!0,C=e.oc(c,d,p);"MAIN"==p&&(e.ns(G,x),C&&e.ns(C,x));for(p=0;p<G.Jb.length;p++){var q=G.Jb[p];if(-1!==m.indexOf(q)){var y=x.Jb.indexOf(q);-1!==y&&(G.M[p]=x.M[y],C&&(q=C.Jb.indexOf(q),-1!==q&&(C.M[q]=x.M[y])))}}}}h||k.error("Wrong objects for inheriting material!")}else k.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.n;
for(var c=0;c<a.length;c++)for(var d=0;d<a[c].Kc.length;d++)-1==b.indexOf(a[c].Kc[d])&&b.push(a[c].Kc[d]);return b};a.set_diffuse_color=function(a,b,c){var d=e.Z(a,b,"MAIN");d?(d.Nb.set(c),(a=e.oc(a,b,"MAIN"))&&a.Nb.set(c)):k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=e.Z(a,b,"MAIN");if(c){var d=Array(4);d[0]=c.Nb[0];d[1]=c.Nb[1];d[2]=c.Nb[2];d[3]=c.Nb[3];return d}k.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,
b,c){var d=e.Z(a,b,"MAIN");if(d){if(d.Ge=c,a=e.oc(a,b,"MAIN"))a.Ge=c}else k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=e.Z(a,b,"MAIN");if(c)return c.Ge;k.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=e.Z(a,b,"MAIN");d?(d.xd.set(c),(a=e.oc(a,b,"MAIN"))&&a.xd.set(c)):k.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=e.Z(a,b,"MAIN");if(c){var d=Array(3);d[0]=
c.xd[0];d[1]=c.xd[1];d[2]=c.xd[2];return d}k.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,c,d){b(a,c)||k.error('Property "specular_intensity" is missing!');e.Z(a,c,"MAIN").fc[0]=d;(a=e.oc(a,c,"MAIN"))&&(a.fc[0]=d)};a.get_specular_intensity=function(a,c){b(a,c)||k.error('Property "specular_intensity" is missing!');return e.Z(a,c,"MAIN").fc[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,d){c(a,b)||k.error('Property "specular_hardness" is missing!');
e.Z(a,b,"MAIN").fc[1]=d;(a=e.oc(a,b,"MAIN"))&&(a.fc[1]=d)};a.get_specular_hardness=function(a,b){c(a,b)||k.error('Property "specular_hardness" is missing!');return e.Z(a,b,"MAIN").fc[1]};a.check_specular_hardness=c;a.set_emit_factor=function(a,b,c){var d=e.Z(a,b,"MAIN");if(d){if(d.Zd=c,a=e.oc(a,b,"MAIN"))a.Zd=c}else k.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=e.Z(a,b,"MAIN");if(c)return c.Zd;k.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=
function(a,b,c){var d=e.Z(a,b,"MAIN");if(d){if(d.Ld=c,a=e.oc(a,b,"MAIN"))a.Ld=c}else k.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=e.Z(a,b,"MAIN");if(c)return c.Ld;k.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=e.Z(a,b,"MAIN");if(d){if(d.Fe=c,a=e.oc(a,b,"MAIN"))a.Fe=c}else k.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=e.Z(a,b,"MAIN");if(c)return c.Fe;
k.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=e.Z(a,b,"MAIN");if(d){if(d.ye=c,a=e.oc(a,b,"MAIN"))a.ye=c}else k.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=e.Z(a,b,"MAIN");if(c)return c.ye;k.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_material_params"),null;if(!d(a,b))return null;var c=e.Z(a,b,"MAIN");
if(!c)return null;var f={};"MAIN"==c.type&&(f.kg=c.kg,f.jD=c.Sc[2],f.kD=5*(1-c.Sc[3]),f.gg=c.gg,f.eE=e.sb(c,"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_water_material_params"),null;if(!d(a,b))return null;var c=e.Z(a,b,"MAIN");if(!c||!c.pf)return null;if(!c)return k.error("material not found"),null;var f={};if("MAIN"==c.type){if(g.rh){var h=f.shallow_water_col=Array(3);h[0]=c.shallow_water_col[0];h[1]=c.shallow_water_col[1];
h[2]=c.shallow_water_col[2];h=f.shore_water_col=Array(3);h[0]=c.shore_water_col[0];h[1]=c.shore_water_col[1];h[2]=c.shore_water_col[2];f.shallow_water_col_fac=c.shallow_water_col_fac;f.shore_water_col_fac=c.shore_water_col_fac}f.foam_factor=c.foam_factor;f.norm_uv_velocity=c.Lh;f.absorb_factor=e.sb(c,"ABSORB")[1];f.sss_strength=e.sb(c,"SSS_STRENGTH")[1];f.sss_width=e.sb(c,"SSS_WIDTH")[1];f.dst_noise_scale0=e.sb(c,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=e.sb(c,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=
e.sb(c,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=e.sb(c,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=e.sb(c,"DIR_MIN_SHR_FAC")[1];f.dir_freq=e.sb(c,"DIR_FREQ")[1];f.dir_noise_scale=e.sb(c,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=e.sb(c,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=e.sb(c,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=e.sb(c,"DST_MIN_FAC")[1];f.waves_hor_fac=e.sb(c,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,b,c){if(a&&b&&c){if(!d(a,b))return k.error("setting material params is not possible"),
null;var f=e.Z(a,b,"MAIN");if(f){var g=[f];(f=e.oc(a,b,"MAIN"))&&g.push(f);for(a=0;a<g.length;a++)f=g[a],"number"==typeof c.material_reflectivity&&(f.kg=c.material_reflectivity),"number"==typeof c.material_fresnel&&(f.Sc[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(f.Sc[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(f.gg=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=l.u(parseFloat(c.material_parallax_steps)),e.ja(f,
"PARALLAX_STEPS",b),e.yb(f,!0))}else k.error("material not found")}else k.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,c){if(!a||!b||!c)return k.error("missing arguments in set_water_material_params"),null;if(!d(a,b))return k.error("setting water material params is not possible"),null;var f=e.Z(a,b,"MAIN");if(!f)return k.error("material not found"),null;var h=[f];(f=e.oc(a,b,"MAIN"))&&h.push(f);for(a=0;a<h.length;a++)f=h[a],g.rh&&("object"==typeof c.shallow_water_col&&
f.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(f.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&f.shore_water_col.set(c.shore_water_col),"number"==typeof c.shore_water_col_fac&&(f.shore_water_col_fac=c.shore_water_col_fac)),g.shore_smoothing&&f.ro&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?e.ja(f,"SHORE_SMOOTHING",1):e.ja(f,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=l.u(parseFloat(c.absorb_factor)),
e.ja(f,"ABSORB",b))),"number"==typeof c.foam_factor&&g.Qg&&(f.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&(f.Lh=c.norm_uv_velocity),g.water_dynamic&&f.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?e.ja(f,"DYNAMIC",1):e.ja(f,"DYNAMIC",0)),"number"==typeof c.waves_height&&(b=l.u(parseFloat(c.waves_height)),e.ja(f,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=l.u(parseFloat(c.waves_length)),e.ja(f,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&
(b=l.u(parseFloat(c.sss_strength)),e.ja(f,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=l.u(parseFloat(c.sss_width)),e.ja(f,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=l.u(parseFloat(c.dst_noise_scale0)),e.ja(f,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=l.u(parseFloat(c.dst_noise_scale1)),e.ja(f,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=l.u(parseFloat(c.dst_noise_freq0)),e.ja(f,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=
l.u(parseFloat(c.dst_noise_freq1)),e.ja(f,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=l.u(parseFloat(c.dir_min_shore_fac)),e.ja(f,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=l.u(parseFloat(c.dir_freq)),e.ja(f,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=l.u(parseFloat(c.dir_noise_scale)),e.ja(f,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=l.u(parseFloat(c.dir_noise_freq)),e.ja(f,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=l.u(parseFloat(c.dir_min_noise_fac)),
e.ja(f,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=l.u(parseFloat(c.dst_min_fac)),e.ja(f,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=l.u(parseFloat(c.waves_hor_fac)),e.ja(f,"WAVES_HOR_FAC",b))),e.yb(f,!0);return!0}};b4w.module.particles=function(a,p){var d=p("__particles"),b=p("__print");a.set_size=function(a,e,h){d.Xg(a)?d.set_size(a,e,h):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,e,h){d.Xg(a)?d.set_normal_factor(a,e,h):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,e,h){d.Xg(a)?(h=Math.min(h,1),h=Math.max(h,0),d.set_factor(a,e,h)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){var d=p("__print"),b=p("__physics"),c=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.has_physics(a)?b.enable_simulation(a):d.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.has_physics(a)?b.disable_simulation(a):d.error("No physics for object "+a.name)};a.has_physics=function(a){return b.has_physics(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,c){b.has_physics(a)?b.set_gravity(a,c):d.error("No physics for object "+a.name)};a.set_damping=function(a,c,k){b.has_physics(a)?b.t("set_damping",a.m.N,c,k):d.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.has_physics(a)){var c=a.game;b.t("set_damping",a.m.N,c.damping,c.rotation_damping)}else d.error("No physics for object "+a.name)};a.set_transform=function(a,c,k){b.has_physics(a)?b.set_transform.apply(this,
arguments):d.error("No physics for object "+a.name)};a.sync_transform=function(a){b.has_physics(a)?b.sync_transform(a):d.error("No physics for object "+a.name)};a.apply_velocity=function(a){b.has_physics(a)?b.apply_velocity.apply(this,arguments):d.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){b.has_physics(a)?b.apply_velocity_world.apply(this,arguments):d.error("No physics for object "+a.name)};a.apply_force=function(a,c,k,f){b.has_physics(a)?b.apply_force.apply(this,
arguments):d.error("No physics for object "+a.name)};a.apply_torque=function(a,c,k,f){b.has_physics(a)?b.apply_torque.apply(this,arguments):d.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,h){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||d.error("Wrong object"),b.vehicle_throttle(a,c.clamp(h,-1,1))):d.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,h,k){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||d.error("Wrong object");
h=c.clamp(h,0,1);var f=a.j.Pg;-1==k||1==k?f=Math.max(-1,Math.min(f+k*h,1)):0==k&&0<=f?(f-=h,f=Math.max(0,f)):0==k&&0>f?(f+=h,f=Math.min(0,f)):d.error("Wrong steering direction");b.vehicle_throttle(a,c.clamp(f,-1,1))}else d.error("No physics for object "+a.name)};a.vehicle_steer=function(a,h){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||d.error("Wrong object"),b.vehicle_steer(a,c.clamp(h,-1,1))):d.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,h,k){if(b.has_physics(a)){b.is_vehicle_chassis(a)||
b.is_vehicle_hull(a)||d.error("Wrong object");h=c.clamp(h,0,1);var f=a.j.yh;-1==k||1==k?f=Math.max(-1,Math.min(f+k*h,1)):0==k&&0<=f?(f-=h,f=Math.max(0,f)):0==k&&0>f?(f+=h,f=Math.min(0,f)):d.error("Wrong steering direction");b.vehicle_steer(a,c.clamp(f,-1,1))}else d.error("No physics for object "+a.name)};a.vehicle_brake=function(a,h){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||d.error("Wrong object"),b.vehicle_brake(a,c.clamp(h,0,1))):d.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,h){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||d.error("Wrong object");h=c.clamp(h,-1,1);var k=a.j.Uh;b.vehicle_brake(a,c.clamp(k+k*h,0,1))}else d.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.has_physics(a))return d.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
d.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.has_physics(a))return d.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.j.Pg;d.error("Wrong object")};a.get_vehicle_steering=function(a){if(!b.has_physics(a))return d.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.j.yh;d.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.has_physics(a))return d.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.j.Uh;d.error("Wrong object")};a.get_vehicle_speed=function(a){if(!b.has_physics(a))return d.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);d.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,c,k){b.has_physics(a)?b.set_character_move_dir(a,c,k):d.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,c){b.has_physics(a)?b.set_character_move_type(a,c):d.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,c){b.has_physics(a)?b.set_character_walk_velocity(a,c):d.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,c){b.has_physics(a)?b.set_character_run_velocity(a,c):d.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,c){b.has_physics(a)?b.set_character_fly_velocity(a,c):d.error("No physics for object "+
a.name)};a.character_jump=function(a){b.has_physics(a)?b.character_jump(a):d.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,c,k){b.has_physics(a)?b.character_rotation_inc(a,c,k):d.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,c){b.has_physics(a)?b.set_character_rotation_quat(a,c):d.error("No physics for object "+a.name)};a.set_character_rotation=function(a,c,k){b.has_physics(a)?b.set_character_rotation(a,c,k):d.error("No physics for object "+
a.name)};a.set_character_rotation_v=function(a,c){b.has_physics(a)?b.set_character_rotation_v(a,c):d.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,c){b.has_physics(a)?b.set_character_rotation_h(a,c):d.error("No physics for object "+a.name)};a.append_collision_test=function(a,c,k,f){b.has_physics(a)?b.append_collision_test(a,c,k,f||!1):d.error("No physics for object "+a.name)};a.remove_collision_test=function(a,c){b.has_physics(a)?b.remove_collision_test(a,c):d.error("No physics for object "+
a.name)};a.apply_collision_impulse_test=function(a,c){b.has_physics(a)?b.apply_collision_impulse_test(a,c):d.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.has_physics(a)?b.clear_collision_impulse_test(a):d.error("No physics for object "+a.name)};a.append_ray_test=function(a,c,k,f,l,g){b.has_physics(a)?b.append_ray_test(a,c,k,f,l,g):d.error("No physics for object "+a.name)};a.remove_ray_test=function(a,c,k,f,l){b.has_physics(a)?b.remove_ray_test(a,c,k,f,l):d.error("No physics for object "+
a.name)};a.apply_constraint=function(a,c,k,f,l,g,m,n,p,A){b.has_physics(c)&&b.has_physics(l)?b.apply_constraint(a,c,k,f,l,g,m,n,p,A):d.error("Wrong objects")};a.clear_constraint=function(a){b.has_physics(a)&&b.oy(a)?b.clear_constraint(a):d.error("Wrong object")};a.pull_to_constraint_pivot=function(a,c,k,f,l,g){b.has_physics(a)&&b.has_physics(f)?b.pull_to_constraint_pivot(a,c,k,f,l,g):d.error("Wrong objects")}};b4w.module.scenes=function(a,p){var d=p("__batch"),b=p("__camera"),c=p("__graph"),e=p("__objects"),h=p("__print"),k=p("__physics"),f=p("__scenes"),l=p("__util");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=f.mi();f.set_active(l.keysearch("name",a,b))};a.get_active=function(){return f.fa()?f.get_active().name:""};a.get_scenes=function(){for(var a=f.mi(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(f.fa())return f.Lj(f.get_active());h.error("No active scene");
return!1};a.get_object_by_name=function(a,b){var c=f.md(f.tf,a,b|0);if(c)return c;h.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=f.md(f.Wk,a,b,c|0))return a;h.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=f.md(f.Xk,a,b|0);if(c)return c;h.error("get object "+a+": not found")};a.get_object_data_id=function(a){return f.get_object_data_id(a)};a.pick_object=f.pick_object;a.outlining_is_enabled=function(a){return a&&a.d&&
a.d.Cb};a.set_outline_intensity=function(a,b){a&&a.d&&a.d.Cb?a.d.Tc=b:h.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.d&&a.d.Cb)return a.d.Tc;h.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.d&&a.d.Cb?f.apply_outline_anim(a,b,c,d):h.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.d&&a.d.Cb){var b=a.d.wi;f.apply_outline_anim(a,b.mk,b.nk,b.ok)}else h.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.d&&a.d.Cb?f.clear_outline_anim(a):h.error("clear_outline_anim(): wrong object")};a.set_outline_color=f.set_outline_color;a.get_outline_color=function(a){var b=f.get_active();if(b=f.ha(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.Ve),a};a.set_glow_intensity=function(b,c){h.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){h.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,e){h.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){h.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){h.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){h.error("set_glow_color() deprecated, use set_outline_color() instead");
a.set_outline_color(b)};a.get_glow_color=function(b){h.error("get_glow_color() deprecated, use get_outline_color() instead");a.get_outline_color(b)};a.get_shadow_params=function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active(),b=f.ha(a,"SHADOW_CAST");if(!b)return null;var c=a.d.ud,d=f.ha(a,"MAIN_OPAQUE"),e=f.ha(a,"DEPTH"),k={};k.csm_resolution=c.csm_resolution;k.self_shadow_polygon_offset=b.self_shadow_polygon_offset;e&&(k.self_shadow_normal_offset=e.self_shadow_normal_offset);
k.enable_csm=c.enable_csm;k.csm_num=c.csm_num;k.csm_first_cascade_border=c.csm_first_cascade_border;k.first_cascade_blur_radius=c.first_cascade_blur_radius;k.csm_last_cascade_border=c.csm_last_cascade_border;k.last_cascade_blur_radius=c.last_cascade_blur_radius;k.fade_last_cascade=c.fade_last_cascade;k.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(k.csm_borders=f.Sx(a,d.h),k.blur_radii=new Float32Array(c.csm_num),k.blur_radii.set(d.h.uk.subarray(0,c.csm_num))):(k.csm_borders=null,
k.blur_radii=null);return k};a.set_shadow_params=function(a){if(!f.fa())return h.error("No active scene"),!1;var e=f.get_active();"number"==typeof a.self_shadow_polygon_offset&&c.S(e.d.mb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var k=f.ha(e,"DEPTH");k&&("number"==typeof a.self_shadow_normal_offset&&(k.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(k.pcf_blur_radius=a.pcf_blur_radius));var l=f.ha(e,
"MAIN_BLEND");l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius),l.ia=!0);l=e.d.ud;"number"==typeof a.csm_first_cascade_border&&(l.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(l.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(l.csm_last_cascade_border=a.csm_last_cascade_border);
"number"==typeof a.last_cascade_blur_radius&&(l.last_cascade_blur_radius=a.last_cascade_blur_radius);if(k){for(var p=k.p,v=0;v<p.length;v++){var E=p[v];E.qd.Ib&&(E=E.D,d.kl(E,l),d.yb(E))}k.ia=!0}k=e.camera.d.G;for(v=0;v<k.length;v++)b.eo(k[v],l);f.Dn(e)};a.get_environment_colors=function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active();return f.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!f.fa())return h.error("No active scene"),!1;var d=f.get_active();
f.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=f.get_active();return f.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=f.get_active();f.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active();return f.get_ssao_params(a)};a.set_ssao_params=function(a){if(!f.fa())return h.error("No active scene"),
!1;var b=f.get_active();f.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!f.fa())return h.error("No active scene"),null;var a=f.get_active(),a=f.ha(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!f.fa())return h.error("No active scene"),null;var b=f.get_active(),b=f.ha(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&
(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.ia=!0};a.get_sky_params=function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active();return f.get_sky_params(a)};a.set_sky_params=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=f.get_active();f.set_sky_params(b,a)};a.get_dof_params=function(){if(!f.fa())return h.error("No active scene"),
!1;var a=f.get_active();return f.ha(a,"DOF")?f.get_dof_params(a):null};a.set_dof_params=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=f.get_active();f.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active();return f.ha(a,"GOD_RAYS")?f.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=f.get_active();f.set_god_rays_params(b,a)};a.get_bloom_params=
function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active();return f.ha(a,"BLOOM")?f.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=f.get_active();f.set_bloom_params(b,a)};a.get_glow_material_params=function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active();return f.ha(a,"GLOW_COMBINE")?f.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(!f.fa())return h.error("No active scene"),
!1;var b=f.get_active();f.set_glow_material_params(b,a)};a.get_wind_params=function(){return f.get_wind_params()};a.set_wind_params=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=f.get_active();f.set_wind_params(b,a)};a.get_water_surface_level=f.get_water_surface_level;a.set_water_params=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=f.get_active();f.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!f.fa())return h.error("No active scene"),!1;var b=
f.get_active();f.get_water_mat_params(b,a)};a.update_scene_materials_params=function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active();f.ct(a)};a.hide_object=function(a){e.oi(a)||l.Wj(a)?f.hide_object(a):h.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){e.oi(a)||l.Wj(a)?f.show_object(a):h.error("show/hide is only supported for dynamic meshes/empties")};a.is_hidden=function(a){if(e.oi(a)||l.Wj(a))return f.is_hidden(a);h.error("show/hide is only supported for dynamic meshes/empties");
return!1};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return f.fa()?f.check_object(a,f.get_active()):(h.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return f.md(f.tf,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return f.md(f.Wk,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return f.md(f.Xk,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=f.get_active();a||(a="ALL");b||0===b||(b=f.DATA_ID_ALL);return f.Ga(c,a,b)};
a.get_object_name=function(a){return a?a.name:(h.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(h.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.xa};a.get_object_children=function(a){return a.Ec.slice(0)};a.get_first_character=function(){for(var a=f.Ga(f.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(k.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return f.get_shore_dist(a,
b)};a.get_cam_water_depth=function(){return f.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.get_meta_tags=function(){if(!f.fa())return h.error("No active scene"),!1;var a=f.get_active();return f.get_meta_tags(a)};a.append_object=function(a){if(!a.d.Mm)return h.error('object "'+a.name+'" has been created not by coping.'),!1;var b=a.name;if(f.md(f.tf,a.name,0))for(var c=1;;){b=a.name+(3>String(c).length?"."+("000"+String(c)).slice(-3):"."+String(c));
if(!f.md(f.tf,b,0)){a.name=b;h.error('object "'+a.name+'" already exists. Name was replaced by "'+b+'".');break}c++}f.append_object(f.get_active(),a,!0)};a.remove_object=function(a){f.remove_object(a)||h.error('object "'+a.name+'" was not copied.')}};b4w.module.sfx=function(a,p){var d=p("__scenes"),b=p("__sfx"),c=p("__print");a.play=function(a,c,d){b.play(a,c,d)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_play(a)};a.speaker_play=function(a,d,k,f){c.error("speaker_play() deprecated, use play() or play_def() instead");b.cyclic(a,d);f&&b.playrate(a,f);b.play(a,0,k)};a.speaker_stop=function(a){c.error("speaker_stop() deprecated, use stop() instead");b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.wA(a)};
a.resume=function(a){b.yA(a)};a.speaker_playback_rate=function(a,d){c.error("speaker_playback_rate() deprecated, use playrate() instead");b.playrate(a,d)};a.playrate=function(a,c){b.playrate(a,c)};a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,d){b.speaker_reset_speed(a,c,d)};a.get_volume=function(a){return a&&
"object"===typeof a?b.get_volume(a):b.Zx()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.cA(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.Zy(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):b.Ey()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.get_speakers=function(){c.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=b.check_active_speakers;
a.set_compressor_params=function(a){b.set_compressor_params(d.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(d.get_active())};a.duck=function(a,c,d){a&&"object"===typeof a?b.duck(a,c,d):b.Xw(c,d)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.bB()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;
a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&b.ee(a))return b.get_duration(a);c.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.shaders=function(a,p){function d(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function c(a){for(var b=f.mi(),c=0;c<b.length;c++)for(var d=f.Ga(b[c],"MESH",f.DATA_ID_ALL),e=0;e<d.length;e++){var h=d[e];if(h.n)for(var k=0;k<h.n.length;k++){var l=h.n[k];if(l.Wb==a&&l.Kc.length)return l.Kc}}return null}function e(a){a.sort(function(a,b){return b.qm.ALU_OPS-a.qm.ALU_OPS});for(var b=0;b<a.length;b++){var d=a[b],e=d.qm,f=d.QB,k=c(d.Gw),k=k?"\t\t("+k.join(", ")+")":"\t\t(NA)";h.groupCollapsed("FRAG --\x3e",
"ALU",e.ALU_OPS,"TEX",e.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,k);h.groupCollapsed("directives");for(var k=d.fb.He,l=0;l<k.length;l++){var p=k[l];h.log(p[0],p[1])}h.groupEnd();h.groupCollapsed("vert src");h.log(d.PB);h.groupEnd();h.groupCollapsed("vert stats");for(var w in f)"ALU_OPS"!=w&&"TEX_OPS"!=w&&h.log(w,f[w]);h.groupEnd();h.groupCollapsed("frag src");h.log(d.ux);h.groupEnd();h.groupCollapsed("frag stats");for(w in e)"ALU_OPS"!=w&&"TEX_OPS"!=w&&h.log(w,e[w]);h.groupEnd();
h.groupEnd()}}p("__config");var h=p("__print"),k=p("__extensions"),f=p("__scenes"),l=p("__shaders");p("__util");a.report_repeatful_compilation=function(){var a=l.Kw(),b=0,c;for(c in a){var d=a[c],e=d.count;1<e&&h.log(e-1,d.mE,d.DD);b+=e-1}h.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var c=l.nq(),f=0,p;for(p in c)a&&-1===p.indexOf(a)||f++;var f="of "+f+" analyzing...",A={};for(p in c)if(!a||-1!==p.indexOf(a)){var v=c[p],E;var B=v.oo;E=v.fq;var w=k.oq();if(w){B=w.getTranslatedShaderSource(B);
E=w.getTranslatedShaderSource(E);var w=b("/nvidia_vert",B),t=d(w),x=b("/nvidia_frag",E),G=d(x);E={PB:B,zE:w,QB:t,ux:E,iD:x,qm:G}}else h.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),E=void 0;w=v.fb;B=w.Ui+" + "+w.hi;E.Gw=v;E.fb=w;v=A[B]=A[B]||[];v.push(E);h.log(f)}for(B in A)h.group("%c"+B,"color: #800"),v=A[B],e(v),h.groupEnd()}};b4w.module.textures=function(a,p){var d=p("__textures"),b=p("__print");a.get_canvas_texture_context=function(a,e){e||(e=0);var h=d.Px(a,e);if(h)return h;b.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,e){e||(e=0);d.kB(a,e)||b.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,e){e||(e=0);d.play_video(a,e)||b.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,e){e||(e=0);d.pause_video(a,e)||b.error('Texture with name "'+
a+'" not found!')};a.reset_video=function(a,e){e||(e=0);d.reset_video(a,e)||b.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,p){var d=p("__time");a.set_timeout=d.set_timeout;a.clear_timeout=d.clear_timeout;a.get_timeline=d.get_timeline;a.animate=d.animate};b4w.module.transform=function(a,p){var d=p("__print"),b=p("__physics"),c=p("__transform"),e=p("__util"),h=p("__objects"),k=new Float32Array(3),f=new Float32Array(4);a.SPACE_LOCAL=c.SPACE_LOCAL;a.SPACE_WORLD=c.SPACE_WORLD;a.set_translation=function(a,e,f,n){h.$b(a)?(k[0]=e,k[1]=f,k[2]=n,c.set_translation(a,k),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,e){h.$b(a)?(c.set_translation(a,e),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_translation_rel=function(a,f,m,n,p){h.$b(a)?(k[0]=f,k[1]=m,k[2]=n,e.transform_vec3(k,1,p.d.quat,p.d.g,k),c.set_translation(a,k),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));c.get_translation(a,b);return b};a.set_rotation=function(a,e,k,n,p){h.$b(a)?(f[0]=e,f[1]=k,f[2]=n,f[3]=p,c.set_rotation(a,f),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_rotation_quat=function(){d.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,e){h.$b(a)?(c.set_rotation(a,e),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){d.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));c.get_rotation(a,b);return b};a.get_rotation_quat=
function(){d.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=function(a,e,f,n){h.$b(a)?(k[0]=e,k[1]=f,k[2]=n,c.set_rotation_euler(a,k),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,e){h.$b(a)?(c.set_rotation_euler(a,e),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,b){h.$b(a)?(c.set_scale(a,b),c.w(a)):d.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.get_scale=function(a){return c.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return d.error("Wrong object: "+a.name),!1;for(var e=0;e<a.Ec.length;e++)if(!h.$b(a.Ec[e])){d.error('Wrong object: "'+a.Ec[e].name+'" is not dynamic.');return}c.set_translation(a,[0,0,0]);c.set_rotation(a,[0,0,0,1]);c.set_scale(a,1);c.w(a);b.sync_transform(a)};a.get_object_size=function(a){return e.is_mesh(a)?c.get_object_size(a):(d.error("Wrong object: "+a.name),0)};
a.get_object_center=function(a,b,f){return e.is_mesh(a)?c.get_object_center(a,b,f):(d.error("Wrong object: "+a.name),null)};a.move_local=function(a,e,f,k){h.$b(a)?(c.move_local(a,e,f,k),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return c.get_object_bounding_box(a)};a.get_tsr=function(a,b){b||(b=new Float32Array(8));if(h.$b(a))return c.get_tsr(a,b),b;d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr=function(a,
e){h.$b(a)?(c.set_tsr(a,e),c.w(a),b.sync_transform(a)):d.error('Wrong object: "'+a.name+'" is not dynamic.')};a.distance=function(a,b){return c.distance(a,b)}};b4w.module.tsr=function(a,p){p("__print");var d=p("__tsr");a.create=d.create;a.copy=d.copy;a.identity=d.identity;a.create_sep=d.create_sep;a.set_sep=d.set_sep;a.set_trans=d.set_trans;a.set_scale=d.set_scale;a.set_transcale=d.set_transcale;a.set_quat=d.set_quat;a.get_trans_view=d.get_trans_view;a.get_scale=d.get_scale;a.get_quat_view=d.get_quat_view;a.invert=d.invert;a.from_mat4=d.from_mat4;a.multiply=d.multiply;a.transform_vec3=d.transform_vec3;a.transform_vec3_inv=d.transform_vec3_inv;a.transform_vectors=
d.transform_vectors;a.transform_dir_vectors=d.transform_dir_vectors;a.transform_dir_vec3=d.transform_dir_vec3;a.transform_tangents=d.transform_tangents;a.translate=d.translate;a.interpolate=d.interpolate};b4w.module.util=function(a,p){var d=p("__print"),b=p("__util"),c=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=
function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,h,k,f,l){return 0!=c.dot(k,f)?(d.error("Wrong in-plane direction"),null):b.quat_project(a,h,k,f,l)};a.hash_code=b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;
a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=b.is_mesh;a.is_armature=b.is_armature;a.angle_wrap_0_2pi=b.angle_wrap_0_2pi;a.angle_wrap_periodic=b.angle_wrap_periodic;a.smooth_step=b.smooth_step};"object"==typeof module&&module.em&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var d=p("__version");a.version=d.version;a.type=d.type;a.date=d.date};"object"==typeof module&&module.em&&b4w.module.version(exports);b4w.module.objects=function(a,p){var d=p("__objects"),b=p("__print"),c=p("__util"),e=p("__scenes"),h=p("__geometry");a.get_meta_tags=function(a){if(a&&a.b4w_object_tags)return d.get_meta_tags(a)};a.copy=function(a,f,l){return c.is_mesh(a)?a.Ho?(b.error('object "'+a.name+'" is meta-object.'),!1):d.$b(a)?h.ni(a)||h.check_shape_keys(a)||!l?-1==e.Ga(e.get_active(),"MESH",e.DATA_ID_ALL).indexOf(a)?(b.error('object "'+a.name+'" does not belong to the active scene.'),!1):d.copy(a,f||"",l):(b.error('object "'+
a.name+'" has not dynamic geometry for deep copying.'),!1):(b.error('object "'+a.name+'" is not dynamic.'),!1):(b.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,e,h){if(!c.is_mesh(a))return b.error('object "'+a.name+'" is not of type "MESH".'),null;e=e.join("%join%");var g=d.hy(a,e);null!=g?a.d.ge[g]=h:b.error('value "'+e+'" was not found in "'+a.name+'" object.')};a.set_nodemat_rgb=function(a,e,h,g,m){if(!c.is_mesh(a))return b.error('object "'+a.name+'" is not of type "MESH".'),
null;e=e.join("%join%");var n=d.by(a,e);null!=n?(a.d.qc[n]=h,a.d.qc[n+1]=g,a.d.qc[n+2]=m):b.error('rgb "'+e+'" was not found in "'+a.name+'" object.')}};b4w.module.main=function(a,p){function d(){}function b(){}function c(){}function e(){window.performance||(t.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(t.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});S.os(0)}function h(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();t.error("WebGL context lost");g()},!1);y.Vc(c);var d=y.uq();d&&t.log("%cRENDERER INFO:","color: #00a",
c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));F.Vc(c);H.Vc(c);ca.Vc(c);R.Vc(c);q.Vc(c);C.lA(c.canvas);I.qs(a.width,a.height,1,k("x"),k("y"));M.init();b=A();n()}function k(a){if("x"==a)var b=u.offsetLeft;else if("y"==a)b=u.offsetTop;else return 0;return f(b,u,a)}function f(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=f(a+d,b,c)}return a}function l(){d=function(){}}function g(){m()||(ja=performance.now()/1E3,
M.pause(),L.pause(),ca.pause(),v.pause())}function m(){return Z<ja}function n(){sa(n);var a=performance.now()/1E3;ea||(ea=a);var c=a-ea;if(!(c<1/P.nd)){for(var d=S.get_timeline(),e=0;e<oa.length;e++)oa[e](d,c);m()||(Z>ea&&(c-=Z-Math.max(ja,ea)),d+=c,S.os(d),q.update(),O.update(),C.update(),r(d,c),b(c));ea=a}}function r(a,b){C.is_primary_loaded()&&(z.reset(),Y.update(b),N.update(a,b),M.update(a,b),b&&E.update(b),C.is_primary_loaded()&&(L.update(a,b),C.is_primary_loaded()&&(d(b,a),C.is_primary_loaded()&&
(G.update(a,b),C.is_primary_loaded()&&(v.update(),I.update(a,b),v.xB(),K&&(K(u.toDataURL()),K=null))))))}function A(){var a=60,b=0,d=P.dq,e=P.ox;return function(f){a=W.smooth(1/f,a,f,d);f=L.Xx();b=(b+1)%e;0==b&&c(Math.round(a),f)}}var v=p("__anchors"),E=p("__animation"),B=p("__compat"),w=p("__config"),t=p("__print"),x=p("__container"),G=p("__controls"),C=p("__data"),q=p("__debug"),y=p("__extensions"),H=p("__geometry"),z=p("__hud"),N=p("__nla"),O=p("__assets"),L=p("__physics"),F=p("__renderer"),I=
p("__scenes"),M=p("__sfx"),R=p("__shaders"),ca=p("__textures"),S=p("__time"),Y=p("__transform"),W=p("__util"),ia=p("__version"),ma=w.context,P=w.o,u=null,qa=null,ea=0,ja=0,Z=0,oa=[],K=null,U=["webgl","experimental-webgl"],X=null,sa=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/P.nd)}}();a.init=function(a,b){w.dA();t.hA(P.console_verbose);
var c=ia.version()+" "+ia.type()+" ("+ia.date()+")";t.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;e();u=a;B.bv();for(var c=null,d=0;d<U.length;d++){var f=U[d];try{c=a.getContext(f,ma)}catch(g){}if(c)break}if(!c)return null;X=c;h(u,c);w.dv();B.Yz(c);P.Im&&(a.style["touch-action"]="none");t.log("%cSET PRECISION:","color: #00a",P.precision);b?(z.init(b),qa=b):(w.o.show_hud_debug_info=!1,w.Wc.gk=!1);x.init(a);return c};a.set_check_gl_errors=function(a){q.set_check_gl_errors(a)};
a.resize=function(a,b,c){!1!==c&&(u.style.width=a+"px",u.style.height=b+"px",qa&&(qa.style.width=a+"px",qa.style.height=b+"px"));qa&&(qa.width=a,qa.height=b,z.Hh());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))P.canvas_resolution_factor=1;c=a*P.canvas_resolution_factor;b*=P.canvas_resolution_factor;P.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);u.width=c;u.height=b;if(c>X.drawingBufferWidth||
b>X.drawingBufferHeight){t.warn("Canvas size exceeds platform limits, downscaling");var d=Math.min(X.drawingBufferWidth/c,X.drawingBufferHeight/b);c*=d;b*=d;u.width=c;u.height=b}I.qs(c,b,c/a,k("x"),k("y"));I.fa()&&Y.w(I.get_active().camera);r(S.get_timeline(),0);C.oB(u.width,u.height)};a.set_fps_callback=function(a){c=a};a.clear_fps_callback=function(){c=function(){}};a.set_on_before_render_callback=function(a){t.error("set_on_before_render_callback() deprecated, use set_render_callback() instead");
d=a};a.set_render_callback=function(a){d=a};a.clear_on_before_render_callback=function(){t.error("clear_on_before_render_callback() deprecated, use clear_render_callback() instead");l()};a.clear_render_callback=function(){l()};a.global_timeline=function(){return S.get_timeline()};a.redraw=function(){t.error("redraw() deprecated");r(S.get_timeline(),0)};a.pause=g;a.resume=function(){m()&&(Z=performance.now()/1E3,M.resume(),L.resume(),ca.play(!0),v.resume())};a.is_paused=m;a.reset=function(){C.unload(0);
qa=u=null;Z=ja=ea=0;c=function(){};b=function(){};d=function(){};oa.length=0;X=null;S.reset()};a.canvas_data_url=function(a){K=a};a.get_canvas_elem=function(){return u};a.detect_mobile=function(){return B.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<oa.length;b++)if(oa[b]==a)return;oa.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<oa.length;b++)if(oa[b]==a){oa.splice(b,1);break}}};b4w.module.nla=function(a,p){var d=p("__nla"),b=p("__time"),c=p("__print");a.set_frame=function(a){0>a?c.error("Value must be non-negative."):d.check_nla_scripts()?c.error("The active scene is using NLA script."):d.set_frame(a,b.get_timeline())};a.get_frame=function(){return d.get_frame(b.get_timeline())};a.stop=function(){d.check_nla_scripts()?c.error("The active scene is using NLA script."):d.IA()};a.play=function(){d.check_nla_scripts()?c.error("The active scene is using NLA script."):d.mz()};
a.is_play=function(){return d.is_play()};a.get_frame_start=function(){return d.get_frame_start()};a.get_frame_end=function(){return d.get_frame_end()};a.check_nla=function(){return d.check_nla()};a.check_nla_scripts=function(){return d.check_nla_scripts()}};
